var QH=Object.defineProperty;var jH=(a,e,t)=>e in a?QH(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var E=(a,e,t)=>(jH(a,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerpolicy&&(r.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?r.credentials="include":i.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(i){if(i.ep)return;i.ep=!0;const r=t(i);fetch(i.href,r)}})();/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const Ey="145",Kh={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},$h={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},EB=0,Ob=1,CB=2,qH=3,XH=0,JE=1,ZE=2,$d=3,Oo=0,Ur=1,er=2,Lc=0,gu=1,G_=2,Fb=3,kb=4,SB=5,ru=100,MB=101,TB=102,Nb=103,Ub=104,IB=200,RB=201,PB=202,BB=203,KE=204,$E=205,LB=206,DB=207,OB=208,FB=209,kB=210,NB=0,UB=1,zB=2,H_=3,GB=4,HB=5,VB=6,WB=7,dg=0,QB=1,jB=2,ca=0,V_=1,eC=2,qB=3,tC=4,XB=5,Cy=300,jl=301,ql=302,ka=303,gf=304,Mf=306,Fc=1e3,$s=1001,Cu=1002,Ki=1003,Af=1004,YH=1004,_f=1005,JH=1005,yi=1006,fg=1007,ZH=1007,fa=1008,KH=1008,Er=1009,YB=1010,JB=1011,nC=1012,ZB=1013,Fl=1014,Ms=1015,Os=1016,KB=1017,$B=1018,Au=1020,eL=1021,tL=1022,us=1023,nL=1024,iL=1025,Gl=1026,Su=1027,lu=1028,sL=1029,ef=1030,rL=1031,oL=1033,wm=33776,v_=33777,x_=33778,bm=33779,W_=35840,zb=35841,Q_=35842,Gb=35843,iC=36196,j_=37492,q_=37496,X_=37808,Hb=37809,Vb=37810,Wb=37811,Qb=37812,jb=37813,qb=37814,Xb=37815,Yb=37816,Jb=37817,Zb=37818,Kb=37819,$b=37820,eE=37821,Y_=36492,Sy=2200,sC=2201,aL=2202,Mu=2300,kc=2301,w_=2302,hu=2400,uu=2401,Vm=2402,My=2500,rC=2501,$H=0,cL=1,oC=2,pr=3e3,Gn=3001,lL=3200,hL=3201,Gc=0,uL=1,e5="",Ra="srgb",kl="srgb-linear",dL=0,Em=7680,fL=7681,pL=7682,mL=7683,gL=34055,AL=34056,_L=5386,yL=512,vL=513,xL=514,wL=515,bL=516,EL=517,CL=518,aC=519,Wm=35044,t5=35048,n5=35040,i5=35045,s5=35049,r5=35041,o5=35046,a5=35050,c5=35042,l5="100",tE="300 es",J_=1035;class Uo{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const n=this._listeners;return n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const i=this._listeners[e];if(i!==void 0){const r=i.indexOf(t);r!==-1&&i.splice(r,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const n=this._listeners[e.type];if(n!==void 0){e.target=this;const i=n.slice(0);for(let r=0,o=i.length;r<o;r++)i[r].call(this,e);e.target=null}}}const ar=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let uI=1234567;const _u=Math.PI/180,Qm=180/Math.PI;function so(){const a=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(ar[a&255]+ar[a>>8&255]+ar[a>>16&255]+ar[a>>24&255]+"-"+ar[e&255]+ar[e>>8&255]+"-"+ar[e>>16&15|64]+ar[e>>24&255]+"-"+ar[t&63|128]+ar[t>>8&255]+"-"+ar[t>>16&255]+ar[t>>24&255]+ar[n&255]+ar[n>>8&255]+ar[n>>16&255]+ar[n>>24&255]).toLowerCase()}function As(a,e,t){return Math.max(e,Math.min(t,a))}function cC(a,e){return(a%e+e)%e}function h5(a,e,t,n,i){return n+(a-e)*(i-n)/(t-e)}function u5(a,e,t){return a!==e?(t-a)/(e-a):0}function Cm(a,e,t){return(1-t)*a+t*e}function d5(a,e,t,n){return Cm(a,e,1-Math.exp(-t*n))}function f5(a,e=1){return e-Math.abs(cC(a,e*2)-e)}function p5(a,e,t){return a<=e?0:a>=t?1:(a=(a-e)/(t-e),a*a*(3-2*a))}function m5(a,e,t){return a<=e?0:a>=t?1:(a=(a-e)/(t-e),a*a*a*(a*(a*6-15)+10))}function g5(a,e){return a+Math.floor(Math.random()*(e-a+1))}function A5(a,e){return a+Math.random()*(e-a)}function _5(a){return a*(.5-Math.random())}function y5(a){a!==void 0&&(uI=a);let e=uI+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function v5(a){return a*_u}function x5(a){return a*Qm}function nE(a){return(a&a-1)===0&&a!==0}function SL(a){return Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))}function Z_(a){return Math.pow(2,Math.floor(Math.log(a)/Math.LN2))}function w5(a,e,t,n,i){const r=Math.cos,o=Math.sin,l=r(t/2),h=o(t/2),u=r((e+n)/2),f=o((e+n)/2),g=r((e-n)/2),m=o((e-n)/2),A=r((n-e)/2),v=o((n-e)/2);switch(i){case"XYX":a.set(l*f,h*g,h*m,l*u);break;case"YZY":a.set(h*m,l*f,h*g,l*u);break;case"ZXZ":a.set(h*g,h*m,l*f,l*u);break;case"XZX":a.set(l*f,h*v,h*A,l*u);break;case"YXY":a.set(h*A,l*f,h*v,l*u);break;case"ZYZ":a.set(h*v,h*A,l*f,l*u);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}function Tc(a,e){switch(e.constructor){case Float32Array:return a;case Uint16Array:return a/65535;case Uint8Array:return a/255;case Int16Array:return Math.max(a/32767,-1);case Int8Array:return Math.max(a/127,-1);default:throw new Error("Invalid component type.")}}function zi(a,e){switch(e.constructor){case Float32Array:return a;case Uint16Array:return Math.round(a*65535);case Uint8Array:return Math.round(a*255);case Int16Array:return Math.round(a*32767);case Int8Array:return Math.round(a*127);default:throw new Error("Invalid component type.")}}var Tu=Object.freeze({__proto__:null,DEG2RAD:_u,RAD2DEG:Qm,generateUUID:so,clamp:As,euclideanModulo:cC,mapLinear:h5,inverseLerp:u5,lerp:Cm,damp:d5,pingpong:f5,smoothstep:p5,smootherstep:m5,randInt:g5,randFloat:A5,randFloatSpread:_5,seededRandom:y5,degToRad:v5,radToDeg:x5,isPowerOfTwo:nE,ceilPowerOfTwo:SL,floorPowerOfTwo:Z_,setQuaternionFromProperEuler:w5,normalize:zi,denormalize:Tc});class Xe{constructor(e=0,t=0){Xe.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),i=Math.sin(t),r=this.x-e.x,o=this.y-e.y;return this.x=r*n-o*i+e.x,this.y=r*i+o*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class kr{constructor(){kr.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,t,n,i,r,o,l,h,u){const f=this.elements;return f[0]=e,f[1]=i,f[2]=l,f[3]=t,f[4]=r,f[5]=h,f[6]=n,f[7]=o,f[8]=u,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,o=n[0],l=n[3],h=n[6],u=n[1],f=n[4],g=n[7],m=n[2],A=n[5],v=n[8],w=i[0],b=i[3],S=i[6],R=i[1],M=i[4],I=i[7],T=i[2],B=i[5],F=i[8];return r[0]=o*w+l*R+h*T,r[3]=o*b+l*M+h*B,r[6]=o*S+l*I+h*F,r[1]=u*w+f*R+g*T,r[4]=u*b+f*M+g*B,r[7]=u*S+f*I+g*F,r[2]=m*w+A*R+v*T,r[5]=m*b+A*M+v*B,r[8]=m*S+A*I+v*F,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],l=e[5],h=e[6],u=e[7],f=e[8];return t*o*f-t*l*u-n*r*f+n*l*h+i*r*u-i*o*h}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],l=e[5],h=e[6],u=e[7],f=e[8],g=f*o-l*u,m=l*h-f*r,A=u*r-o*h,v=t*g+n*m+i*A;if(v===0)return this.set(0,0,0,0,0,0,0,0,0);const w=1/v;return e[0]=g*w,e[1]=(i*u-f*n)*w,e[2]=(l*n-i*o)*w,e[3]=m*w,e[4]=(f*t-i*h)*w,e[5]=(i*r-l*t)*w,e[6]=A*w,e[7]=(n*h-u*t)*w,e[8]=(o*t-n*r)*w,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,i,r,o,l){const h=Math.cos(r),u=Math.sin(r);return this.set(n*h,n*u,-n*(h*o+u*l)+o+e,-i*u,i*h,-i*(-u*o+h*l)+l+t,0,0,1),this}scale(e,t){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}rotate(e){const t=Math.cos(e),n=Math.sin(e),i=this.elements,r=i[0],o=i[3],l=i[6],h=i[1],u=i[4],f=i[7];return i[0]=t*r+n*h,i[3]=t*o+n*u,i[6]=t*l+n*f,i[1]=-n*r+t*h,i[4]=-n*o+t*u,i[7]=-n*l+t*f,this}translate(e,t){const n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<9;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}}function ML(a){for(let e=a.length-1;e>=0;--e)if(a[e]>=65535)return!0;return!1}const b5={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function tf(a,e){return new b5[a](e)}function jm(a){return document.createElementNS("http://www.w3.org/1999/xhtml",a)}function yu(a){return a<.04045?a*.0773993808:Math.pow(a*.9478672986+.0521327014,2.4)}function b_(a){return a<.0031308?a*12.92:1.055*Math.pow(a,.41666)-.055}const lw={[Ra]:{[kl]:yu},[kl]:{[Ra]:b_}},So={legacyMode:!0,get workingColorSpace(){return kl},set workingColorSpace(a){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(a,e,t){if(this.legacyMode||e===t||!e||!t)return a;if(lw[e]&&lw[e][t]!==void 0){const n=lw[e][t];return a.r=n(a.r),a.g=n(a.g),a.b=n(a.b),a}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(a,e){return this.convert(a,this.workingColorSpace,e)},toWorkingColorSpace:function(a,e){return this.convert(a,e,this.workingColorSpace)}},TL={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ds={r:0,g:0,b:0},Yo={h:0,s:0,l:0},f0={h:0,s:0,l:0};function hw(a,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?a+(e-a)*6*t:t<1/2?e:t<2/3?a+(e-a)*6*(2/3-t):a}function p0(a,e){return e.r=a.r,e.g=a.g,e.b=a.b,e}class _e{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,t===void 0&&n===void 0?this.set(e):this.setRGB(e,t,n)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Ra){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,So.toWorkingColorSpace(this,t),this}setRGB(e,t,n,i=kl){return this.r=e,this.g=t,this.b=n,So.toWorkingColorSpace(this,i),this}setHSL(e,t,n,i=kl){if(e=cC(e,1),t=As(t,0,1),n=As(n,0,1),t===0)this.r=this.g=this.b=n;else{const r=n<=.5?n*(1+t):n+t-n*t,o=2*n-r;this.r=hw(o,r,e+1/3),this.g=hw(o,r,e),this.b=hw(o,r,e-1/3)}return So.toWorkingColorSpace(this,i),this}setStyle(e,t=Ra){function n(r){r!==void 0&&parseFloat(r)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let r;const o=i[1],l=i[2];switch(o){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,So.toWorkingColorSpace(this,t),n(r[4]),this;if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,So.toWorkingColorSpace(this,t),n(r[4]),this;break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l)){const h=parseFloat(r[1])/360,u=parseFloat(r[2])/100,f=parseFloat(r[3])/100;return n(r[4]),this.setHSL(h,u,f,t)}break}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const r=i[1],o=r.length;if(o===3)return this.r=parseInt(r.charAt(0)+r.charAt(0),16)/255,this.g=parseInt(r.charAt(1)+r.charAt(1),16)/255,this.b=parseInt(r.charAt(2)+r.charAt(2),16)/255,So.toWorkingColorSpace(this,t),this;if(o===6)return this.r=parseInt(r.charAt(0)+r.charAt(1),16)/255,this.g=parseInt(r.charAt(2)+r.charAt(3),16)/255,this.b=parseInt(r.charAt(4)+r.charAt(5),16)/255,So.toWorkingColorSpace(this,t),this}return e&&e.length>0?this.setColorName(e,t):this}setColorName(e,t=Ra){const n=TL[e.toLowerCase()];return n!==void 0?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=yu(e.r),this.g=yu(e.g),this.b=yu(e.b),this}copyLinearToSRGB(e){return this.r=b_(e.r),this.g=b_(e.g),this.b=b_(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Ra){return So.fromWorkingColorSpace(p0(this,Ds),e),As(Ds.r*255,0,255)<<16^As(Ds.g*255,0,255)<<8^As(Ds.b*255,0,255)<<0}getHexString(e=Ra){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=kl){So.fromWorkingColorSpace(p0(this,Ds),t);const n=Ds.r,i=Ds.g,r=Ds.b,o=Math.max(n,i,r),l=Math.min(n,i,r);let h,u;const f=(l+o)/2;if(l===o)h=0,u=0;else{const g=o-l;switch(u=f<=.5?g/(o+l):g/(2-o-l),o){case n:h=(i-r)/g+(i<r?6:0);break;case i:h=(r-n)/g+2;break;case r:h=(n-i)/g+4;break}h/=6}return e.h=h,e.s=u,e.l=f,e}getRGB(e,t=kl){return So.fromWorkingColorSpace(p0(this,Ds),t),e.r=Ds.r,e.g=Ds.g,e.b=Ds.b,e}getStyle(e=Ra){return So.fromWorkingColorSpace(p0(this,Ds),e),e!==Ra?`color(${e} ${Ds.r} ${Ds.g} ${Ds.b})`:`rgb(${Ds.r*255|0},${Ds.g*255|0},${Ds.b*255|0})`}offsetHSL(e,t,n){return this.getHSL(Yo),Yo.h+=e,Yo.s+=t,Yo.l+=n,this.setHSL(Yo.h,Yo.s,Yo.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(Yo),e.getHSL(f0);const n=Cm(Yo.h,f0.h,t),i=Cm(Yo.s,f0.s,t),r=Cm(Yo.l,f0.l,t);return this.setHSL(n,i,r),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}_e.NAMES=TL;let bd;class lC{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{bd===void 0&&(bd=jm("canvas")),bd.width=e.width,bd.height=e.height;const n=bd.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=bd}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=jm("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const i=n.getImageData(0,0,e.width,e.height),r=i.data;for(let o=0;o<r.length;o++)r[o]=yu(r[o]/255)*255;return n.putImageData(i,0,0),t}else if(e.data){const t=e.data.slice(0);for(let n=0;n<t.length;n++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[n]=Math.floor(yu(t[n]/255)*255):t[n]=yu(t[n]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}class Nl{constructor(e=null){this.isSource=!0,this.uuid=so(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const n={uuid:this.uuid,url:""},i=this.data;if(i!==null){let r;if(Array.isArray(i)){r=[];for(let o=0,l=i.length;o<l;o++)i[o].isDataTexture?r.push(uw(i[o].image)):r.push(uw(i[o]))}else r=uw(i);n.url=r}return t||(e.images[this.uuid]=n),n}}function uw(a){return typeof HTMLImageElement<"u"&&a instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&a instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&a instanceof ImageBitmap?lC.getDataURL(a):a.data?{data:Array.from(a.data),width:a.width,height:a.height,type:a.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let E5=0;class Vi extends Uo{constructor(e=Vi.DEFAULT_IMAGE,t=Vi.DEFAULT_MAPPING,n=$s,i=$s,r=yi,o=fa,l=us,h=Er,u=1,f=pr){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:E5++}),this.uuid=so(),this.name="",this.source=new Nl(e),this.mipmaps=[],this.mapping=t,this.wrapS=n,this.wrapT=i,this.magFilter=r,this.minFilter=o,this.anisotropy=u,this.format=l,this.internalFormat=null,this.type=h,this.offset=new Xe(0,0),this.repeat=new Xe(1,1),this.center=new Xe(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new kr,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=f,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return JSON.stringify(this.userData)!=="{}"&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==Cy)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Fc:e.x=e.x-Math.floor(e.x);break;case $s:e.x=e.x<0?0:1;break;case Cu:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Fc:e.y=e.y-Math.floor(e.y);break;case $s:e.y=e.y<0?0:1;break;case Cu:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}}Vi.DEFAULT_IMAGE=null;Vi.DEFAULT_MAPPING=Cy;class On{constructor(e=0,t=0,n=0,i=1){On.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,r=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*i+o[12]*r,this.y=o[1]*t+o[5]*n+o[9]*i+o[13]*r,this.z=o[2]*t+o[6]*n+o[10]*i+o[14]*r,this.w=o[3]*t+o[7]*n+o[11]*i+o[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,i,r;const h=e.elements,u=h[0],f=h[4],g=h[8],m=h[1],A=h[5],v=h[9],w=h[2],b=h[6],S=h[10];if(Math.abs(f-m)<.01&&Math.abs(g-w)<.01&&Math.abs(v-b)<.01){if(Math.abs(f+m)<.1&&Math.abs(g+w)<.1&&Math.abs(v+b)<.1&&Math.abs(u+A+S-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const M=(u+1)/2,I=(A+1)/2,T=(S+1)/2,B=(f+m)/4,F=(g+w)/4,D=(v+b)/4;return M>I&&M>T?M<.01?(n=0,i=.707106781,r=.707106781):(n=Math.sqrt(M),i=B/n,r=F/n):I>T?I<.01?(n=.707106781,i=0,r=.707106781):(i=Math.sqrt(I),n=B/i,r=D/i):T<.01?(n=.707106781,i=.707106781,r=0):(r=Math.sqrt(T),n=F/r,i=D/r),this.set(n,i,r,t),this}let R=Math.sqrt((b-v)*(b-v)+(g-w)*(g-w)+(m-f)*(m-f));return Math.abs(R)<.001&&(R=1),this.x=(b-v)/R,this.y=(g-w)/R,this.z=(m-f)/R,this.w=Math.acos((u+A+S-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Hr extends Uo{constructor(e,t,n={}){super(),this.isWebGLRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new On(0,0,e,t),this.scissorTest=!1,this.viewport=new On(0,0,e,t);const i={width:e,height:t,depth:1};this.texture=new Vi(i,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=n.generateMipmaps!==void 0?n.generateMipmaps:!1,this.texture.internalFormat=n.internalFormat!==void 0?n.internalFormat:null,this.texture.minFilter=n.minFilter!==void 0?n.minFilter:yi,this.depthBuffer=n.depthBuffer!==void 0?n.depthBuffer:!0,this.stencilBuffer=n.stencilBuffer!==void 0?n.stencilBuffer:!1,this.depthTexture=n.depthTexture!==void 0?n.depthTexture:null,this.samples=n.samples!==void 0?n.samples:0}setSize(e,t,n=1){(this.width!==e||this.height!==t||this.depth!==n)&&(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new Nl(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class pg extends Vi{constructor(e=null,t=1,n=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=Ki,this.minFilter=Ki,this.wrapR=$s,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class C5 extends Hr{constructor(e,t,n){super(e,t),this.isWebGLArrayRenderTarget=!0,this.depth=n,this.texture=new pg(null,e,t,n),this.texture.isRenderTargetTexture=!0}}class mg extends Vi{constructor(e=null,t=1,n=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=Ki,this.minFilter=Ki,this.wrapR=$s,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class S5 extends Hr{constructor(e,t,n){super(e,t),this.isWebGL3DRenderTarget=!0,this.depth=n,this.texture=new mg(null,e,t,n),this.texture.isRenderTargetTexture=!0}}class M5 extends Hr{constructor(e,t,n,i={}){super(e,t,i),this.isWebGLMultipleRenderTargets=!0;const r=this.texture;this.texture=[];for(let o=0;o<n;o++)this.texture[o]=r.clone(),this.texture[o].isRenderTargetTexture=!0}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let i=0,r=this.texture.length;i<r;i++)this.texture[i].image.width=e,this.texture[i].image.height=t,this.texture[i].image.depth=n;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.texture.length=0;for(let t=0,n=e.texture.length;t<n;t++)this.texture[t]=e.texture[t].clone(),this.texture[t].isRenderTargetTexture=!0;return this}}class Ot{constructor(e=0,t=0,n=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=i}static slerpFlat(e,t,n,i,r,o,l){let h=n[i+0],u=n[i+1],f=n[i+2],g=n[i+3];const m=r[o+0],A=r[o+1],v=r[o+2],w=r[o+3];if(l===0){e[t+0]=h,e[t+1]=u,e[t+2]=f,e[t+3]=g;return}if(l===1){e[t+0]=m,e[t+1]=A,e[t+2]=v,e[t+3]=w;return}if(g!==w||h!==m||u!==A||f!==v){let b=1-l;const S=h*m+u*A+f*v+g*w,R=S>=0?1:-1,M=1-S*S;if(M>Number.EPSILON){const T=Math.sqrt(M),B=Math.atan2(T,S*R);b=Math.sin(b*B)/T,l=Math.sin(l*B)/T}const I=l*R;if(h=h*b+m*I,u=u*b+A*I,f=f*b+v*I,g=g*b+w*I,b===1-l){const T=1/Math.sqrt(h*h+u*u+f*f+g*g);h*=T,u*=T,f*=T,g*=T}}e[t]=h,e[t+1]=u,e[t+2]=f,e[t+3]=g}static multiplyQuaternionsFlat(e,t,n,i,r,o){const l=n[i],h=n[i+1],u=n[i+2],f=n[i+3],g=r[o],m=r[o+1],A=r[o+2],v=r[o+3];return e[t]=l*v+f*g+h*A-u*m,e[t+1]=h*v+f*m+u*g-l*A,e[t+2]=u*v+f*A+l*m-h*g,e[t+3]=f*v-l*g-h*m-u*A,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){const n=e._x,i=e._y,r=e._z,o=e._order,l=Math.cos,h=Math.sin,u=l(n/2),f=l(i/2),g=l(r/2),m=h(n/2),A=h(i/2),v=h(r/2);switch(o){case"XYZ":this._x=m*f*g+u*A*v,this._y=u*A*g-m*f*v,this._z=u*f*v+m*A*g,this._w=u*f*g-m*A*v;break;case"YXZ":this._x=m*f*g+u*A*v,this._y=u*A*g-m*f*v,this._z=u*f*v-m*A*g,this._w=u*f*g+m*A*v;break;case"ZXY":this._x=m*f*g-u*A*v,this._y=u*A*g+m*f*v,this._z=u*f*v+m*A*g,this._w=u*f*g-m*A*v;break;case"ZYX":this._x=m*f*g-u*A*v,this._y=u*A*g+m*f*v,this._z=u*f*v-m*A*g,this._w=u*f*g+m*A*v;break;case"YZX":this._x=m*f*g+u*A*v,this._y=u*A*g+m*f*v,this._z=u*f*v-m*A*g,this._w=u*f*g-m*A*v;break;case"XZY":this._x=m*f*g-u*A*v,this._y=u*A*g-m*f*v,this._z=u*f*v+m*A*g,this._w=u*f*g+m*A*v;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],i=t[4],r=t[8],o=t[1],l=t[5],h=t[9],u=t[2],f=t[6],g=t[10],m=n+l+g;if(m>0){const A=.5/Math.sqrt(m+1);this._w=.25/A,this._x=(f-h)*A,this._y=(r-u)*A,this._z=(o-i)*A}else if(n>l&&n>g){const A=2*Math.sqrt(1+n-l-g);this._w=(f-h)/A,this._x=.25*A,this._y=(i+o)/A,this._z=(r+u)/A}else if(l>g){const A=2*Math.sqrt(1+l-n-g);this._w=(r-u)/A,this._x=(i+o)/A,this._y=.25*A,this._z=(h+f)/A}else{const A=2*Math.sqrt(1+g-n-l);this._w=(o-i)/A,this._x=(r+u)/A,this._y=(h+f)/A,this._z=.25*A}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(As(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(n===0)return this;const i=Math.min(1,t/n);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,i=e._y,r=e._z,o=e._w,l=t._x,h=t._y,u=t._z,f=t._w;return this._x=n*f+o*l+i*u-r*h,this._y=i*f+o*h+r*l-n*u,this._z=r*f+o*u+n*h-i*l,this._w=o*f-n*l-i*h-r*u,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const n=this._x,i=this._y,r=this._z,o=this._w;let l=o*e._w+n*e._x+i*e._y+r*e._z;if(l<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,l=-l):this.copy(e),l>=1)return this._w=o,this._x=n,this._y=i,this._z=r,this;const h=1-l*l;if(h<=Number.EPSILON){const A=1-t;return this._w=A*o+t*this._w,this._x=A*n+t*this._x,this._y=A*i+t*this._y,this._z=A*r+t*this._z,this.normalize(),this._onChangeCallback(),this}const u=Math.sqrt(h),f=Math.atan2(u,l),g=Math.sin((1-t)*f)/u,m=Math.sin(t*f)/u;return this._w=o*g+this._w*m,this._x=n*g+this._x*m,this._y=i*g+this._y*m,this._z=r*g+this._z*m,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),i=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(t*Math.cos(i),n*Math.sin(r),n*Math.cos(r),t*Math.sin(i))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class q{constructor(e=0,t=0,n=0){q.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return n===void 0&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(dI.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(dI.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*i,this.y=r[1]*t+r[4]*n+r[7]*i,this.z=r[2]*t+r[5]*n+r[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,r=e.elements,o=1/(r[3]*t+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*i+r[12])*o,this.y=(r[1]*t+r[5]*n+r[9]*i+r[13])*o,this.z=(r[2]*t+r[6]*n+r[10]*i+r[14])*o,this}applyQuaternion(e){const t=this.x,n=this.y,i=this.z,r=e.x,o=e.y,l=e.z,h=e.w,u=h*t+o*i-l*n,f=h*n+l*t-r*i,g=h*i+r*n-o*t,m=-r*t-o*n-l*i;return this.x=u*h+m*-r+f*-l-g*-o,this.y=f*h+m*-o+g*-r-u*-l,this.z=g*h+m*-l+u*-o-f*-r,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i,this.y=r[1]*t+r[5]*n+r[9]*i,this.z=r[2]*t+r[6]*n+r[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,i=e.y,r=e.z,o=t.x,l=t.y,h=t.z;return this.x=i*h-r*l,this.y=r*o-n*h,this.z=n*l-i*o,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return dw.copy(this).projectOnVector(e),this.sub(dw)}reflect(e){return this.sub(dw.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(As(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,n=Math.sqrt(1-e**2);return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const dw=new q,dI=new Ot;class Mr{constructor(e=new q(1/0,1/0,1/0),t=new q(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,n=1/0,i=1/0,r=-1/0,o=-1/0,l=-1/0;for(let h=0,u=e.length;h<u;h+=3){const f=e[h],g=e[h+1],m=e[h+2];f<t&&(t=f),g<n&&(n=g),m<i&&(i=m),f>r&&(r=f),g>o&&(o=g),m>l&&(l=m)}return this.min.set(t,n,i),this.max.set(r,o,l),this}setFromBufferAttribute(e){let t=1/0,n=1/0,i=1/0,r=-1/0,o=-1/0,l=-1/0;for(let h=0,u=e.count;h<u;h++){const f=e.getX(h),g=e.getY(h),m=e.getZ(h);f<t&&(t=f),g<n&&(n=g),m<i&&(i=m),f>r&&(r=f),g>o&&(o=g),m>l&&(l=m)}return this.min.set(t,n,i),this.max.set(r,o,l),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=Uh.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(n!==void 0)if(t&&n.attributes!=null&&n.attributes.position!==void 0){const r=n.attributes.position;for(let o=0,l=r.count;o<l;o++)Uh.fromBufferAttribute(r,o).applyMatrix4(e.matrixWorld),this.expandByPoint(Uh)}else n.boundingBox===null&&n.computeBoundingBox(),fw.copy(n.boundingBox),fw.applyMatrix4(e.matrixWorld),this.union(fw);const i=e.children;for(let r=0,o=i.length;r<o;r++)this.expandByObject(i[r],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Uh),Uh.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Wp),m0.subVectors(this.max,Wp),Ed.subVectors(e.a,Wp),Cd.subVectors(e.b,Wp),Sd.subVectors(e.c,Wp),ul.subVectors(Cd,Ed),dl.subVectors(Sd,Cd),zh.subVectors(Ed,Sd);let t=[0,-ul.z,ul.y,0,-dl.z,dl.y,0,-zh.z,zh.y,ul.z,0,-ul.x,dl.z,0,-dl.x,zh.z,0,-zh.x,-ul.y,ul.x,0,-dl.y,dl.x,0,-zh.y,zh.x,0];return!pw(t,Ed,Cd,Sd,m0)||(t=[1,0,0,0,1,0,0,0,1],!pw(t,Ed,Cd,Sd,m0))?!1:(g0.crossVectors(ul,dl),t=[g0.x,g0.y,g0.z],pw(t,Ed,Cd,Sd,m0))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Uh.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=this.getSize(Uh).length()*.5,e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(lc[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),lc[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),lc[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),lc[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),lc[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),lc[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),lc[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),lc[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(lc),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const lc=[new q,new q,new q,new q,new q,new q,new q,new q],Uh=new q,fw=new Mr,Ed=new q,Cd=new q,Sd=new q,ul=new q,dl=new q,zh=new q,Wp=new q,m0=new q,g0=new q,Gh=new q;function pw(a,e,t,n,i){for(let r=0,o=a.length-3;r<=o;r+=3){Gh.fromArray(a,r);const l=i.x*Math.abs(Gh.x)+i.y*Math.abs(Gh.y)+i.z*Math.abs(Gh.z),h=e.dot(Gh),u=t.dot(Gh),f=n.dot(Gh);if(Math.max(-Math.max(h,u,f),Math.min(h,u,f))>l)return!1}return!0}const T5=new Mr,fI=new q,A0=new q,mw=new q;class Qa{constructor(e=new q,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;t!==void 0?n.copy(t):T5.setFromPoints(e).getCenter(n);let i=0;for(let r=0,o=e.length;r<o;r++)i=Math.max(i,n.distanceToSquared(e[r]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;mw.subVectors(e,this.center);const t=mw.lengthSq();if(t>this.radius*this.radius){const n=Math.sqrt(t),i=(n-this.radius)*.5;this.center.add(mw.multiplyScalar(i/n)),this.radius+=i}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?A0.set(0,0,1).multiplyScalar(e.radius):A0.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(fI.copy(e.center).add(A0)),this.expandByPoint(fI.copy(e.center).sub(A0)),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const hc=new q,gw=new q,_0=new q,fl=new q,Aw=new q,y0=new q,_w=new q;class Pu{constructor(e=new q,t=new q(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,hc)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=hc.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(hc.copy(this.direction).multiplyScalar(t).add(this.origin),hc.distanceToSquared(e))}distanceSqToSegment(e,t,n,i){gw.copy(e).add(t).multiplyScalar(.5),_0.copy(t).sub(e).normalize(),fl.copy(this.origin).sub(gw);const r=e.distanceTo(t)*.5,o=-this.direction.dot(_0),l=fl.dot(this.direction),h=-fl.dot(_0),u=fl.lengthSq(),f=Math.abs(1-o*o);let g,m,A,v;if(f>0)if(g=o*h-l,m=o*l-h,v=r*f,g>=0)if(m>=-v)if(m<=v){const w=1/f;g*=w,m*=w,A=g*(g+o*m+2*l)+m*(o*g+m+2*h)+u}else m=r,g=Math.max(0,-(o*m+l)),A=-g*g+m*(m+2*h)+u;else m=-r,g=Math.max(0,-(o*m+l)),A=-g*g+m*(m+2*h)+u;else m<=-v?(g=Math.max(0,-(-o*r+l)),m=g>0?-r:Math.min(Math.max(-r,-h),r),A=-g*g+m*(m+2*h)+u):m<=v?(g=0,m=Math.min(Math.max(-r,-h),r),A=m*(m+2*h)+u):(g=Math.max(0,-(o*r+l)),m=g>0?r:Math.min(Math.max(-r,-h),r),A=-g*g+m*(m+2*h)+u);else m=o>0?-r:r,g=Math.max(0,-(o*m+l)),A=-g*g+m*(m+2*h)+u;return n&&n.copy(this.direction).multiplyScalar(g).add(this.origin),i&&i.copy(_0).multiplyScalar(m).add(gw),A}intersectSphere(e,t){hc.subVectors(e.center,this.origin);const n=hc.dot(this.direction),i=hc.dot(hc)-n*n,r=e.radius*e.radius;if(i>r)return null;const o=Math.sqrt(r-i),l=n-o,h=n+o;return l<0&&h<0?null:l<0?this.at(h,t):this.at(l,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return n===null?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,i,r,o,l,h;const u=1/this.direction.x,f=1/this.direction.y,g=1/this.direction.z,m=this.origin;return u>=0?(n=(e.min.x-m.x)*u,i=(e.max.x-m.x)*u):(n=(e.max.x-m.x)*u,i=(e.min.x-m.x)*u),f>=0?(r=(e.min.y-m.y)*f,o=(e.max.y-m.y)*f):(r=(e.max.y-m.y)*f,o=(e.min.y-m.y)*f),n>o||r>i||((r>n||n!==n)&&(n=r),(o<i||i!==i)&&(i=o),g>=0?(l=(e.min.z-m.z)*g,h=(e.max.z-m.z)*g):(l=(e.max.z-m.z)*g,h=(e.min.z-m.z)*g),n>h||l>i)||((l>n||n!==n)&&(n=l),(h<i||i!==i)&&(i=h),i<0)?null:this.at(n>=0?n:i,t)}intersectsBox(e){return this.intersectBox(e,hc)!==null}intersectTriangle(e,t,n,i,r){Aw.subVectors(t,e),y0.subVectors(n,e),_w.crossVectors(Aw,y0);let o=this.direction.dot(_w),l;if(o>0){if(i)return null;l=1}else if(o<0)l=-1,o=-o;else return null;fl.subVectors(this.origin,e);const h=l*this.direction.dot(y0.crossVectors(fl,y0));if(h<0)return null;const u=l*this.direction.dot(Aw.cross(fl));if(u<0||h+u>o)return null;const f=-l*fl.dot(_w);return f<0?null:this.at(f/o,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class xn{constructor(){xn.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(e,t,n,i,r,o,l,h,u,f,g,m,A,v,w,b){const S=this.elements;return S[0]=e,S[4]=t,S[8]=n,S[12]=i,S[1]=r,S[5]=o,S[9]=l,S[13]=h,S[2]=u,S[6]=f,S[10]=g,S[14]=m,S[3]=A,S[7]=v,S[11]=w,S[15]=b,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new xn().fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,i=1/Md.setFromMatrixColumn(e,0).length(),r=1/Md.setFromMatrixColumn(e,1).length(),o=1/Md.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[7]=0,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,i=e.y,r=e.z,o=Math.cos(n),l=Math.sin(n),h=Math.cos(i),u=Math.sin(i),f=Math.cos(r),g=Math.sin(r);if(e.order==="XYZ"){const m=o*f,A=o*g,v=l*f,w=l*g;t[0]=h*f,t[4]=-h*g,t[8]=u,t[1]=A+v*u,t[5]=m-w*u,t[9]=-l*h,t[2]=w-m*u,t[6]=v+A*u,t[10]=o*h}else if(e.order==="YXZ"){const m=h*f,A=h*g,v=u*f,w=u*g;t[0]=m+w*l,t[4]=v*l-A,t[8]=o*u,t[1]=o*g,t[5]=o*f,t[9]=-l,t[2]=A*l-v,t[6]=w+m*l,t[10]=o*h}else if(e.order==="ZXY"){const m=h*f,A=h*g,v=u*f,w=u*g;t[0]=m-w*l,t[4]=-o*g,t[8]=v+A*l,t[1]=A+v*l,t[5]=o*f,t[9]=w-m*l,t[2]=-o*u,t[6]=l,t[10]=o*h}else if(e.order==="ZYX"){const m=o*f,A=o*g,v=l*f,w=l*g;t[0]=h*f,t[4]=v*u-A,t[8]=m*u+w,t[1]=h*g,t[5]=w*u+m,t[9]=A*u-v,t[2]=-u,t[6]=l*h,t[10]=o*h}else if(e.order==="YZX"){const m=o*h,A=o*u,v=l*h,w=l*u;t[0]=h*f,t[4]=w-m*g,t[8]=v*g+A,t[1]=g,t[5]=o*f,t[9]=-l*f,t[2]=-u*f,t[6]=A*g+v,t[10]=m-w*g}else if(e.order==="XZY"){const m=o*h,A=o*u,v=l*h,w=l*u;t[0]=h*f,t[4]=-g,t[8]=u*f,t[1]=m*g+w,t[5]=o*f,t[9]=A*g-v,t[2]=v*g-A,t[6]=l*f,t[10]=w*g+m}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(I5,e,R5)}lookAt(e,t,n){const i=this.elements;return Kr.subVectors(e,t),Kr.lengthSq()===0&&(Kr.z=1),Kr.normalize(),pl.crossVectors(n,Kr),pl.lengthSq()===0&&(Math.abs(n.z)===1?Kr.x+=1e-4:Kr.z+=1e-4,Kr.normalize(),pl.crossVectors(n,Kr)),pl.normalize(),v0.crossVectors(Kr,pl),i[0]=pl.x,i[4]=v0.x,i[8]=Kr.x,i[1]=pl.y,i[5]=v0.y,i[9]=Kr.y,i[2]=pl.z,i[6]=v0.z,i[10]=Kr.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,o=n[0],l=n[4],h=n[8],u=n[12],f=n[1],g=n[5],m=n[9],A=n[13],v=n[2],w=n[6],b=n[10],S=n[14],R=n[3],M=n[7],I=n[11],T=n[15],B=i[0],F=i[4],D=i[8],U=i[12],W=i[1],J=i[5],ee=i[9],Q=i[13],Y=i[2],se=i[6],ae=i[10],ve=i[14],xe=i[3],Ae=i[7],Me=i[11],Be=i[15];return r[0]=o*B+l*W+h*Y+u*xe,r[4]=o*F+l*J+h*se+u*Ae,r[8]=o*D+l*ee+h*ae+u*Me,r[12]=o*U+l*Q+h*ve+u*Be,r[1]=f*B+g*W+m*Y+A*xe,r[5]=f*F+g*J+m*se+A*Ae,r[9]=f*D+g*ee+m*ae+A*Me,r[13]=f*U+g*Q+m*ve+A*Be,r[2]=v*B+w*W+b*Y+S*xe,r[6]=v*F+w*J+b*se+S*Ae,r[10]=v*D+w*ee+b*ae+S*Me,r[14]=v*U+w*Q+b*ve+S*Be,r[3]=R*B+M*W+I*Y+T*xe,r[7]=R*F+M*J+I*se+T*Ae,r[11]=R*D+M*ee+I*ae+T*Me,r[15]=R*U+M*Q+I*ve+T*Be,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],i=e[8],r=e[12],o=e[1],l=e[5],h=e[9],u=e[13],f=e[2],g=e[6],m=e[10],A=e[14],v=e[3],w=e[7],b=e[11],S=e[15];return v*(+r*h*g-i*u*g-r*l*m+n*u*m+i*l*A-n*h*A)+w*(+t*h*A-t*u*m+r*o*m-i*o*A+i*u*f-r*h*f)+b*(+t*u*g-t*l*A-r*o*g+n*o*A+r*l*f-n*u*f)+S*(-i*l*f-t*h*g+t*l*m+i*o*g-n*o*m+n*h*f)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],l=e[5],h=e[6],u=e[7],f=e[8],g=e[9],m=e[10],A=e[11],v=e[12],w=e[13],b=e[14],S=e[15],R=g*b*u-w*m*u+w*h*A-l*b*A-g*h*S+l*m*S,M=v*m*u-f*b*u-v*h*A+o*b*A+f*h*S-o*m*S,I=f*w*u-v*g*u+v*l*A-o*w*A-f*l*S+o*g*S,T=v*g*h-f*w*h-v*l*m+o*w*m+f*l*b-o*g*b,B=t*R+n*M+i*I+r*T;if(B===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const F=1/B;return e[0]=R*F,e[1]=(w*m*r-g*b*r-w*i*A+n*b*A+g*i*S-n*m*S)*F,e[2]=(l*b*r-w*h*r+w*i*u-n*b*u-l*i*S+n*h*S)*F,e[3]=(g*h*r-l*m*r-g*i*u+n*m*u+l*i*A-n*h*A)*F,e[4]=M*F,e[5]=(f*b*r-v*m*r+v*i*A-t*b*A-f*i*S+t*m*S)*F,e[6]=(v*h*r-o*b*r-v*i*u+t*b*u+o*i*S-t*h*S)*F,e[7]=(o*m*r-f*h*r+f*i*u-t*m*u-o*i*A+t*h*A)*F,e[8]=I*F,e[9]=(v*g*r-f*w*r-v*n*A+t*w*A+f*n*S-t*g*S)*F,e[10]=(o*w*r-v*l*r+v*n*u-t*w*u-o*n*S+t*l*S)*F,e[11]=(f*l*r-o*g*r-f*n*u+t*g*u+o*n*A-t*l*A)*F,e[12]=T*F,e[13]=(f*w*i-v*g*i+v*n*m-t*w*m-f*n*b+t*g*b)*F,e[14]=(v*l*i-o*w*i-v*n*h+t*w*h+o*n*b-t*l*b)*F,e[15]=(o*g*i-f*l*i+f*n*h-t*g*h-o*n*m+t*l*m)*F,this}scale(e){const t=this.elements,n=e.x,i=e.y,r=e.z;return t[0]*=n,t[4]*=i,t[8]*=r,t[1]*=n,t[5]*=i,t[9]*=r,t[2]*=n,t[6]*=i,t[10]*=r,t[3]*=n,t[7]*=i,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))}makeTranslation(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),i=Math.sin(t),r=1-n,o=e.x,l=e.y,h=e.z,u=r*o,f=r*l;return this.set(u*o+n,u*l-i*h,u*h+i*l,0,u*l+i*h,f*l+n,f*h-i*o,0,u*h-i*l,f*h+i*o,r*h*h+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,i,r,o){return this.set(1,n,r,0,e,1,o,0,t,i,1,0,0,0,0,1),this}compose(e,t,n){const i=this.elements,r=t._x,o=t._y,l=t._z,h=t._w,u=r+r,f=o+o,g=l+l,m=r*u,A=r*f,v=r*g,w=o*f,b=o*g,S=l*g,R=h*u,M=h*f,I=h*g,T=n.x,B=n.y,F=n.z;return i[0]=(1-(w+S))*T,i[1]=(A+I)*T,i[2]=(v-M)*T,i[3]=0,i[4]=(A-I)*B,i[5]=(1-(m+S))*B,i[6]=(b+R)*B,i[7]=0,i[8]=(v+M)*F,i[9]=(b-R)*F,i[10]=(1-(m+w))*F,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,n){const i=this.elements;let r=Md.set(i[0],i[1],i[2]).length();const o=Md.set(i[4],i[5],i[6]).length(),l=Md.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),e.x=i[12],e.y=i[13],e.z=i[14],Jo.copy(this);const u=1/r,f=1/o,g=1/l;return Jo.elements[0]*=u,Jo.elements[1]*=u,Jo.elements[2]*=u,Jo.elements[4]*=f,Jo.elements[5]*=f,Jo.elements[6]*=f,Jo.elements[8]*=g,Jo.elements[9]*=g,Jo.elements[10]*=g,t.setFromRotationMatrix(Jo),n.x=r,n.y=o,n.z=l,this}makePerspective(e,t,n,i,r,o){const l=this.elements,h=2*r/(t-e),u=2*r/(n-i),f=(t+e)/(t-e),g=(n+i)/(n-i),m=-(o+r)/(o-r),A=-2*o*r/(o-r);return l[0]=h,l[4]=0,l[8]=f,l[12]=0,l[1]=0,l[5]=u,l[9]=g,l[13]=0,l[2]=0,l[6]=0,l[10]=m,l[14]=A,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,t,n,i,r,o){const l=this.elements,h=1/(t-e),u=1/(n-i),f=1/(o-r),g=(t+e)*h,m=(n+i)*u,A=(o+r)*f;return l[0]=2*h,l[4]=0,l[8]=0,l[12]=-g,l[1]=0,l[5]=2*u,l[9]=0,l[13]=-m,l[2]=0,l[6]=0,l[10]=-2*f,l[14]=-A,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<16;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const Md=new q,Jo=new xn,I5=new q(0,0,0),R5=new q(1,1,1),pl=new q,v0=new q,Kr=new q,pI=new xn,mI=new Ot;class vs{constructor(e=0,t=0,n=0,i=vs.DefaultOrder){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,i=this._order){return this._x=e,this._y=t,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const i=e.elements,r=i[0],o=i[4],l=i[8],h=i[1],u=i[5],f=i[9],g=i[2],m=i[6],A=i[10];switch(t){case"XYZ":this._y=Math.asin(As(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-f,A),this._z=Math.atan2(-o,r)):(this._x=Math.atan2(m,u),this._z=0);break;case"YXZ":this._x=Math.asin(-As(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(l,A),this._z=Math.atan2(h,u)):(this._y=Math.atan2(-g,r),this._z=0);break;case"ZXY":this._x=Math.asin(As(m,-1,1)),Math.abs(m)<.9999999?(this._y=Math.atan2(-g,A),this._z=Math.atan2(-o,u)):(this._y=0,this._z=Math.atan2(h,r));break;case"ZYX":this._y=Math.asin(-As(g,-1,1)),Math.abs(g)<.9999999?(this._x=Math.atan2(m,A),this._z=Math.atan2(h,r)):(this._x=0,this._z=Math.atan2(-o,u));break;case"YZX":this._z=Math.asin(As(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(-f,u),this._y=Math.atan2(-g,r)):(this._x=0,this._y=Math.atan2(l,A));break;case"XZY":this._z=Math.asin(-As(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(m,u),this._y=Math.atan2(l,r)):(this._x=Math.atan2(-f,A),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return pI.makeRotationFromQuaternion(e),this.setFromRotationMatrix(pI,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return mI.setFromEuler(this),this.setFromQuaternion(mI,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}toVector3(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")}}vs.DefaultOrder="XYZ";vs.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class Va{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let P5=0;const gI=new q,Td=new Ot,uc=new xn,x0=new q,Qp=new q,B5=new q,L5=new Ot,AI=new q(1,0,0),_I=new q(0,1,0),yI=new q(0,0,1),D5={type:"added"},vI={type:"removed"};class qt extends Uo{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:P5++}),this.uuid=so(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=qt.DefaultUp.clone();const e=new q,t=new vs,n=new Ot,i=new q(1,1,1);function r(){n.setFromEuler(t,!1)}function o(){t.setFromQuaternion(n,void 0,!1)}t._onChange(r),n._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new xn},normalMatrix:{value:new kr}}),this.matrix=new xn,this.matrixWorld=new xn,this.matrixAutoUpdate=qt.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=qt.DefaultMatrixWorldAutoUpdate,this.layers=new Va,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Td.setFromAxisAngle(e,t),this.quaternion.multiply(Td),this}rotateOnWorldAxis(e,t){return Td.setFromAxisAngle(e,t),this.quaternion.premultiply(Td),this}rotateX(e){return this.rotateOnAxis(AI,e)}rotateY(e){return this.rotateOnAxis(_I,e)}rotateZ(e){return this.rotateOnAxis(yI,e)}translateOnAxis(e,t){return gI.copy(e).applyQuaternion(this.quaternion),this.position.add(gI.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(AI,e)}translateY(e){return this.translateOnAxis(_I,e)}translateZ(e){return this.translateOnAxis(yI,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(uc.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?x0.copy(e):x0.set(e,t,n);const i=this.parent;this.updateWorldMatrix(!0,!1),Qp.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?uc.lookAt(Qp,x0,this.up):uc.lookAt(x0,Qp,this.up),this.quaternion.setFromRotationMatrix(uc),i&&(uc.extractRotation(i.matrixWorld),Td.setFromRotationMatrix(uc),this.quaternion.premultiply(Td.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(D5)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(vI)),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(vI)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),uc.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),uc.multiply(e.parent.matrixWorld)),e.applyMatrix4(uc),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,i=this.children.length;n<i;n++){const o=this.children[n].getObjectByProperty(e,t);if(o!==void 0)return o}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Qp,e,B5),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Qp,L5,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,i=t.length;n<i;n++){const r=t[n];(r.matrixWorldAutoUpdate===!0||e===!0)&&r.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const n=this.parent;if(e===!0&&n!==null&&n.matrixWorldAutoUpdate===!0&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const i=this.children;for(let r=0,o=i.length;r<o;r++){const l=i[r];l.matrixWorldAutoUpdate===!0&&l.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=e===void 0||typeof e=="string",n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON()));function r(l,h){return l[h.uuid]===void 0&&(l[h.uuid]=h.toJSON(e)),h.uuid}if(this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=r(e.geometries,this.geometry);const l=this.geometry.parameters;if(l!==void 0&&l.shapes!==void 0){const h=l.shapes;if(Array.isArray(h))for(let u=0,f=h.length;u<f;u++){const g=h[u];r(e.shapes,g)}else r(e.shapes,h)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(r(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const l=[];for(let h=0,u=this.material.length;h<u;h++)l.push(r(e.materials,this.material[h]));i.material=l}else i.material=r(e.materials,this.material);if(this.children.length>0){i.children=[];for(let l=0;l<this.children.length;l++)i.children.push(this.children[l].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let l=0;l<this.animations.length;l++){const h=this.animations[l];i.animations.push(r(e.animations,h))}}if(t){const l=o(e.geometries),h=o(e.materials),u=o(e.textures),f=o(e.images),g=o(e.shapes),m=o(e.skeletons),A=o(e.animations),v=o(e.nodes);l.length>0&&(n.geometries=l),h.length>0&&(n.materials=h),u.length>0&&(n.textures=u),f.length>0&&(n.images=f),g.length>0&&(n.shapes=g),m.length>0&&(n.skeletons=m),A.length>0&&(n.animations=A),v.length>0&&(n.nodes=v)}return n.object=i,n;function o(l){const h=[];for(const u in l){const f=l[u];delete f.metadata,h.push(f)}return h}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let n=0;n<e.children.length;n++){const i=e.children[n];this.add(i.clone())}return this}}qt.DefaultUp=new q(0,1,0);qt.DefaultMatrixAutoUpdate=!0;qt.DefaultMatrixWorldAutoUpdate=!0;const Zo=new q,dc=new q,yw=new q,fc=new q,Id=new q,Rd=new q,xI=new q,vw=new q,xw=new q,ww=new q;class Bo{constructor(e=new q,t=new q,n=new q){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,i){i.subVectors(n,t),Zo.subVectors(e,t),i.cross(Zo);const r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}static getBarycoord(e,t,n,i,r){Zo.subVectors(i,t),dc.subVectors(n,t),yw.subVectors(e,t);const o=Zo.dot(Zo),l=Zo.dot(dc),h=Zo.dot(yw),u=dc.dot(dc),f=dc.dot(yw),g=o*u-l*l;if(g===0)return r.set(-2,-1,-1);const m=1/g,A=(u*h-l*f)*m,v=(o*f-l*h)*m;return r.set(1-A-v,v,A)}static containsPoint(e,t,n,i){return this.getBarycoord(e,t,n,i,fc),fc.x>=0&&fc.y>=0&&fc.x+fc.y<=1}static getUV(e,t,n,i,r,o,l,h){return this.getBarycoord(e,t,n,i,fc),h.set(0,0),h.addScaledVector(r,fc.x),h.addScaledVector(o,fc.y),h.addScaledVector(l,fc.z),h}static isFrontFacing(e,t,n,i){return Zo.subVectors(n,t),dc.subVectors(e,t),Zo.cross(dc).dot(i)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,n,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Zo.subVectors(this.c,this.b),dc.subVectors(this.a,this.b),Zo.cross(dc).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Bo.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Bo.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,i,r){return Bo.getUV(e,this.a,this.b,this.c,t,n,i,r)}containsPoint(e){return Bo.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Bo.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,i=this.b,r=this.c;let o,l;Id.subVectors(i,n),Rd.subVectors(r,n),vw.subVectors(e,n);const h=Id.dot(vw),u=Rd.dot(vw);if(h<=0&&u<=0)return t.copy(n);xw.subVectors(e,i);const f=Id.dot(xw),g=Rd.dot(xw);if(f>=0&&g<=f)return t.copy(i);const m=h*g-f*u;if(m<=0&&h>=0&&f<=0)return o=h/(h-f),t.copy(n).addScaledVector(Id,o);ww.subVectors(e,r);const A=Id.dot(ww),v=Rd.dot(ww);if(v>=0&&A<=v)return t.copy(r);const w=A*u-h*v;if(w<=0&&u>=0&&v<=0)return l=u/(u-v),t.copy(n).addScaledVector(Rd,l);const b=f*v-A*g;if(b<=0&&g-f>=0&&A-v>=0)return xI.subVectors(r,i),l=(g-f)/(g-f+(A-v)),t.copy(i).addScaledVector(xI,l);const S=1/(b+w+m);return o=w*S,l=m*S,t.copy(n).addScaledVector(Id,o).addScaledVector(Rd,l)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let O5=0;class Ts extends Uo{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:O5++}),this.uuid=so(),this.name="",this.type="Material",this.blending=gu,this.side=Oo,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=KE,this.blendDst=$E,this.blendEquation=ru,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=H_,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=aC,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Em,this.stencilZFail=Em,this.stencilZPass=Em,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const n=e[t];if(n===void 0){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}const i=this[t];if(i===void 0){console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.");continue}i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen!==void 0&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(n.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(n.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==gu&&(n.blending=this.blending),this.side!==Oo&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(n.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=this.flatShading),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),this.fog===!1&&(n.fog=!1),JSON.stringify(this.userData)!=="{}"&&(n.userData=this.userData);function i(r){const o=[];for(const l in r){const h=r[l];delete h.metadata,o.push(h)}return o}if(t){const r=i(e.textures),o=i(e.images);r.length>0&&(n.textures=r),o.length>0&&(n.images=o)}return n}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(t!==null){const i=t.length;n=new Array(i);for(let r=0;r!==i;++r)n[r]=t[r].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class Hi extends Ts{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new _e(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=dg,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const bs=new q,w0=new Xe;class Jn{constructor(e,t,n){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=n===!0,this.usage=Wm,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let i=0,r=this.itemSize;i<r;i++)this.array[e+i]=t.array[n+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,n=this.count;t<n;t++)w0.fromBufferAttribute(this,t),w0.applyMatrix3(e),this.setXY(t,w0.x,w0.y);else if(this.itemSize===3)for(let t=0,n=this.count;t<n;t++)bs.fromBufferAttribute(this,t),bs.applyMatrix3(e),this.setXYZ(t,bs.x,bs.y,bs.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)bs.fromBufferAttribute(this,t),bs.applyMatrix4(e),this.setXYZ(t,bs.x,bs.y,bs.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)bs.fromBufferAttribute(this,t),bs.applyNormalMatrix(e),this.setXYZ(t,bs.x,bs.y,bs.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)bs.fromBufferAttribute(this,t),bs.transformDirection(e),this.setXYZ(t,bs.x,bs.y,bs.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Tc(t,this.array)),t}setX(e,t){return this.normalized&&(t=zi(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Tc(t,this.array)),t}setY(e,t){return this.normalized&&(t=zi(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Tc(t,this.array)),t}setZ(e,t){return this.normalized&&(t=zi(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Tc(t,this.array)),t}setW(e,t){return this.normalized&&(t=zi(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=zi(t,this.array),n=zi(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,i){return e*=this.itemSize,this.normalized&&(t=zi(t,this.array),n=zi(n,this.array),i=zi(i,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e*=this.itemSize,this.normalized&&(t=zi(t,this.array),n=zi(n,this.array),i=zi(i,this.array),r=zi(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==Wm&&(e.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(e.updateRange=this.updateRange),e}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class F5 extends Jn{constructor(e,t,n){super(new Int8Array(e),t,n)}}class k5 extends Jn{constructor(e,t,n){super(new Uint8Array(e),t,n)}}class N5 extends Jn{constructor(e,t,n){super(new Uint8ClampedArray(e),t,n)}}class U5 extends Jn{constructor(e,t,n){super(new Int16Array(e),t,n)}}class hC extends Jn{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class z5 extends Jn{constructor(e,t,n){super(new Int32Array(e),t,n)}}class uC extends Jn{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class G5 extends Jn{constructor(e,t,n){super(new Uint16Array(e),t,n),this.isFloat16BufferAttribute=!0}}class tn extends Jn{constructor(e,t,n){super(new Float32Array(e),t,n)}}class H5 extends Jn{constructor(e,t,n){super(new Float64Array(e),t,n)}}let V5=0;const Eo=new xn,bw=new qt,Pd=new q,$r=new Mr,jp=new Mr,Hs=new q;class Sn extends Uo{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:V5++}),this.uuid=so(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(ML(e)?uC:hC)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const r=new kr().getNormalMatrix(e);n.applyNormalMatrix(r),n.needsUpdate=!0}const i=this.attributes.tangent;return i!==void 0&&(i.transformDirection(e),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Eo.makeRotationFromQuaternion(e),this.applyMatrix4(Eo),this}rotateX(e){return Eo.makeRotationX(e),this.applyMatrix4(Eo),this}rotateY(e){return Eo.makeRotationY(e),this.applyMatrix4(Eo),this}rotateZ(e){return Eo.makeRotationZ(e),this.applyMatrix4(Eo),this}translate(e,t,n){return Eo.makeTranslation(e,t,n),this.applyMatrix4(Eo),this}scale(e,t,n){return Eo.makeScale(e,t,n),this.applyMatrix4(Eo),this}lookAt(e){return bw.lookAt(e),bw.updateMatrix(),this.applyMatrix4(bw.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Pd).negate(),this.translate(Pd.x,Pd.y,Pd.z),this}setFromPoints(e){const t=[];for(let n=0,i=e.length;n<i;n++){const r=e[n];t.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new tn(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Mr);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new q(-1/0,-1/0,-1/0),new q(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,i=t.length;n<i;n++){const r=t[n];$r.setFromBufferAttribute(r),this.morphTargetsRelative?(Hs.addVectors(this.boundingBox.min,$r.min),this.boundingBox.expandByPoint(Hs),Hs.addVectors(this.boundingBox.max,$r.max),this.boundingBox.expandByPoint(Hs)):(this.boundingBox.expandByPoint($r.min),this.boundingBox.expandByPoint($r.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Qa);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new q,1/0);return}if(e){const n=this.boundingSphere.center;if($r.setFromBufferAttribute(e),t)for(let r=0,o=t.length;r<o;r++){const l=t[r];jp.setFromBufferAttribute(l),this.morphTargetsRelative?(Hs.addVectors($r.min,jp.min),$r.expandByPoint(Hs),Hs.addVectors($r.max,jp.max),$r.expandByPoint(Hs)):($r.expandByPoint(jp.min),$r.expandByPoint(jp.max))}$r.getCenter(n);let i=0;for(let r=0,o=e.count;r<o;r++)Hs.fromBufferAttribute(e,r),i=Math.max(i,n.distanceToSquared(Hs));if(t)for(let r=0,o=t.length;r<o;r++){const l=t[r],h=this.morphTargetsRelative;for(let u=0,f=l.count;u<f;u++)Hs.fromBufferAttribute(l,u),h&&(Pd.fromBufferAttribute(e,u),Hs.add(Pd)),i=Math.max(i,n.distanceToSquared(Hs))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=e.array,i=t.position.array,r=t.normal.array,o=t.uv.array,l=i.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Jn(new Float32Array(4*l),4));const h=this.getAttribute("tangent").array,u=[],f=[];for(let W=0;W<l;W++)u[W]=new q,f[W]=new q;const g=new q,m=new q,A=new q,v=new Xe,w=new Xe,b=new Xe,S=new q,R=new q;function M(W,J,ee){g.fromArray(i,W*3),m.fromArray(i,J*3),A.fromArray(i,ee*3),v.fromArray(o,W*2),w.fromArray(o,J*2),b.fromArray(o,ee*2),m.sub(g),A.sub(g),w.sub(v),b.sub(v);const Q=1/(w.x*b.y-b.x*w.y);!isFinite(Q)||(S.copy(m).multiplyScalar(b.y).addScaledVector(A,-w.y).multiplyScalar(Q),R.copy(A).multiplyScalar(w.x).addScaledVector(m,-b.x).multiplyScalar(Q),u[W].add(S),u[J].add(S),u[ee].add(S),f[W].add(R),f[J].add(R),f[ee].add(R))}let I=this.groups;I.length===0&&(I=[{start:0,count:n.length}]);for(let W=0,J=I.length;W<J;++W){const ee=I[W],Q=ee.start,Y=ee.count;for(let se=Q,ae=Q+Y;se<ae;se+=3)M(n[se+0],n[se+1],n[se+2])}const T=new q,B=new q,F=new q,D=new q;function U(W){F.fromArray(r,W*3),D.copy(F);const J=u[W];T.copy(J),T.sub(F.multiplyScalar(F.dot(J))).normalize(),B.crossVectors(D,J);const Q=B.dot(f[W])<0?-1:1;h[W*4]=T.x,h[W*4+1]=T.y,h[W*4+2]=T.z,h[W*4+3]=Q}for(let W=0,J=I.length;W<J;++W){const ee=I[W],Q=ee.start,Y=ee.count;for(let se=Q,ae=Q+Y;se<ae;se+=3)U(n[se+0]),U(n[se+1]),U(n[se+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new Jn(new Float32Array(t.count*3),3),this.setAttribute("normal",n);else for(let m=0,A=n.count;m<A;m++)n.setXYZ(m,0,0,0);const i=new q,r=new q,o=new q,l=new q,h=new q,u=new q,f=new q,g=new q;if(e)for(let m=0,A=e.count;m<A;m+=3){const v=e.getX(m+0),w=e.getX(m+1),b=e.getX(m+2);i.fromBufferAttribute(t,v),r.fromBufferAttribute(t,w),o.fromBufferAttribute(t,b),f.subVectors(o,r),g.subVectors(i,r),f.cross(g),l.fromBufferAttribute(n,v),h.fromBufferAttribute(n,w),u.fromBufferAttribute(n,b),l.add(f),h.add(f),u.add(f),n.setXYZ(v,l.x,l.y,l.z),n.setXYZ(w,h.x,h.y,h.z),n.setXYZ(b,u.x,u.y,u.z)}else for(let m=0,A=t.count;m<A;m+=3)i.fromBufferAttribute(t,m+0),r.fromBufferAttribute(t,m+1),o.fromBufferAttribute(t,m+2),f.subVectors(o,r),g.subVectors(i,r),f.cross(g),n.setXYZ(m+0,f.x,f.y,f.z),n.setXYZ(m+1,f.x,f.y,f.z),n.setXYZ(m+2,f.x,f.y,f.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)Hs.fromBufferAttribute(e,t),Hs.normalize(),e.setXYZ(t,Hs.x,Hs.y,Hs.z)}toNonIndexed(){function e(l,h){const u=l.array,f=l.itemSize,g=l.normalized,m=new u.constructor(h.length*f);let A=0,v=0;for(let w=0,b=h.length;w<b;w++){l.isInterleavedBufferAttribute?A=h[w]*l.data.stride+l.offset:A=h[w]*f;for(let S=0;S<f;S++)m[v++]=u[A++]}return new Jn(m,f,g)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Sn,n=this.index.array,i=this.attributes;for(const l in i){const h=i[l],u=e(h,n);t.setAttribute(l,u)}const r=this.morphAttributes;for(const l in r){const h=[],u=r[l];for(let f=0,g=u.length;f<g;f++){const m=u[f],A=e(m,n);h.push(A)}t.morphAttributes[l]=h}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let l=0,h=o.length;l<h;l++){const u=o[l];t.addGroup(u.start,u.count,u.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const h=this.parameters;for(const u in h)h[u]!==void 0&&(e[u]=h[u]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const h in n){const u=n[h];e.data.attributes[h]=u.toJSON(e.data)}const i={};let r=!1;for(const h in this.morphAttributes){const u=this.morphAttributes[h],f=[];for(let g=0,m=u.length;g<m;g++){const A=u[g];f.push(A.toJSON(e.data))}f.length>0&&(i[h]=f,r=!0)}r&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const l=this.boundingSphere;return l!==null&&(e.data.boundingSphere={center:l.center.toArray(),radius:l.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;n!==null&&this.setIndex(n.clone(t));const i=e.attributes;for(const u in i){const f=i[u];this.setAttribute(u,f.clone(t))}const r=e.morphAttributes;for(const u in r){const f=[],g=r[u];for(let m=0,A=g.length;m<A;m++)f.push(g[m].clone(t));this.morphAttributes[u]=f}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let u=0,f=o.length;u<f;u++){const g=o[u];this.addGroup(g.start,g.count,g.materialIndex)}const l=e.boundingBox;l!==null&&(this.boundingBox=l.clone());const h=e.boundingSphere;return h!==null&&(this.boundingSphere=h.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,e.parameters!==void 0&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}const wI=new xn,Bd=new Pu,Ew=new Qa,ml=new q,gl=new q,Al=new q,Cw=new q,Sw=new q,Mw=new q,b0=new q,E0=new q,C0=new q,S0=new Xe,M0=new Xe,T0=new Xe,Tw=new q,I0=new q;class _t extends qt{constructor(e=new Sn,t=new Hi){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const i=t[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=i.length;r<o;r++){const l=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[l]=r}}}}raycast(e,t){const n=this.geometry,i=this.material,r=this.matrixWorld;if(i===void 0||(n.boundingSphere===null&&n.computeBoundingSphere(),Ew.copy(n.boundingSphere),Ew.applyMatrix4(r),e.ray.intersectsSphere(Ew)===!1)||(wI.copy(r).invert(),Bd.copy(e.ray).applyMatrix4(wI),n.boundingBox!==null&&Bd.intersectsBox(n.boundingBox)===!1))return;let o;const l=n.index,h=n.attributes.position,u=n.morphAttributes.position,f=n.morphTargetsRelative,g=n.attributes.uv,m=n.attributes.uv2,A=n.groups,v=n.drawRange;if(l!==null)if(Array.isArray(i))for(let w=0,b=A.length;w<b;w++){const S=A[w],R=i[S.materialIndex],M=Math.max(S.start,v.start),I=Math.min(l.count,Math.min(S.start+S.count,v.start+v.count));for(let T=M,B=I;T<B;T+=3){const F=l.getX(T),D=l.getX(T+1),U=l.getX(T+2);o=R0(this,R,e,Bd,h,u,f,g,m,F,D,U),o&&(o.faceIndex=Math.floor(T/3),o.face.materialIndex=S.materialIndex,t.push(o))}}else{const w=Math.max(0,v.start),b=Math.min(l.count,v.start+v.count);for(let S=w,R=b;S<R;S+=3){const M=l.getX(S),I=l.getX(S+1),T=l.getX(S+2);o=R0(this,i,e,Bd,h,u,f,g,m,M,I,T),o&&(o.faceIndex=Math.floor(S/3),t.push(o))}}else if(h!==void 0)if(Array.isArray(i))for(let w=0,b=A.length;w<b;w++){const S=A[w],R=i[S.materialIndex],M=Math.max(S.start,v.start),I=Math.min(h.count,Math.min(S.start+S.count,v.start+v.count));for(let T=M,B=I;T<B;T+=3){const F=T,D=T+1,U=T+2;o=R0(this,R,e,Bd,h,u,f,g,m,F,D,U),o&&(o.faceIndex=Math.floor(T/3),o.face.materialIndex=S.materialIndex,t.push(o))}}else{const w=Math.max(0,v.start),b=Math.min(h.count,v.start+v.count);for(let S=w,R=b;S<R;S+=3){const M=S,I=S+1,T=S+2;o=R0(this,i,e,Bd,h,u,f,g,m,M,I,T),o&&(o.faceIndex=Math.floor(S/3),t.push(o))}}}}function W5(a,e,t,n,i,r,o,l){let h;if(e.side===Ur?h=n.intersectTriangle(o,r,i,!0,l):h=n.intersectTriangle(i,r,o,e.side!==er,l),h===null)return null;I0.copy(l),I0.applyMatrix4(a.matrixWorld);const u=t.ray.origin.distanceTo(I0);return u<t.near||u>t.far?null:{distance:u,point:I0.clone(),object:a}}function R0(a,e,t,n,i,r,o,l,h,u,f,g){ml.fromBufferAttribute(i,u),gl.fromBufferAttribute(i,f),Al.fromBufferAttribute(i,g);const m=a.morphTargetInfluences;if(r&&m){b0.set(0,0,0),E0.set(0,0,0),C0.set(0,0,0);for(let v=0,w=r.length;v<w;v++){const b=m[v],S=r[v];b!==0&&(Cw.fromBufferAttribute(S,u),Sw.fromBufferAttribute(S,f),Mw.fromBufferAttribute(S,g),o?(b0.addScaledVector(Cw,b),E0.addScaledVector(Sw,b),C0.addScaledVector(Mw,b)):(b0.addScaledVector(Cw.sub(ml),b),E0.addScaledVector(Sw.sub(gl),b),C0.addScaledVector(Mw.sub(Al),b)))}ml.add(b0),gl.add(E0),Al.add(C0)}a.isSkinnedMesh&&(a.boneTransform(u,ml),a.boneTransform(f,gl),a.boneTransform(g,Al));const A=W5(a,e,t,n,ml,gl,Al,Tw);if(A){l&&(S0.fromBufferAttribute(l,u),M0.fromBufferAttribute(l,f),T0.fromBufferAttribute(l,g),A.uv=Bo.getUV(Tw,ml,gl,Al,S0,M0,T0,new Xe)),h&&(S0.fromBufferAttribute(h,u),M0.fromBufferAttribute(h,f),T0.fromBufferAttribute(h,g),A.uv2=Bo.getUV(Tw,ml,gl,Al,S0,M0,T0,new Xe));const v={a:u,b:f,c:g,normal:new q,materialIndex:0};Bo.getNormal(ml,gl,Al,v.normal),A.face=v}return A}class Ui extends Sn{constructor(e=1,t=1,n=1,i=1,r=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:r,depthSegments:o};const l=this;i=Math.floor(i),r=Math.floor(r),o=Math.floor(o);const h=[],u=[],f=[],g=[];let m=0,A=0;v("z","y","x",-1,-1,n,t,e,o,r,0),v("z","y","x",1,-1,n,t,-e,o,r,1),v("x","z","y",1,1,e,n,t,i,o,2),v("x","z","y",1,-1,e,n,-t,i,o,3),v("x","y","z",1,-1,e,t,n,i,r,4),v("x","y","z",-1,-1,e,t,-n,i,r,5),this.setIndex(h),this.setAttribute("position",new tn(u,3)),this.setAttribute("normal",new tn(f,3)),this.setAttribute("uv",new tn(g,2));function v(w,b,S,R,M,I,T,B,F,D,U){const W=I/F,J=T/D,ee=I/2,Q=T/2,Y=B/2,se=F+1,ae=D+1;let ve=0,xe=0;const Ae=new q;for(let Me=0;Me<ae;Me++){const Be=Me*J-Q;for(let Le=0;Le<se;Le++){const $e=Le*W-ee;Ae[w]=$e*R,Ae[b]=Be*M,Ae[S]=Y,u.push(Ae.x,Ae.y,Ae.z),Ae[w]=0,Ae[b]=0,Ae[S]=B>0?1:-1,f.push(Ae.x,Ae.y,Ae.z),g.push(Le/F),g.push(1-Me/D),ve+=1}}for(let Me=0;Me<D;Me++)for(let Be=0;Be<F;Be++){const Le=m+Be+se*Me,$e=m+Be+se*(Me+1),yt=m+(Be+1)+se*(Me+1),Nt=m+(Be+1)+se*Me;h.push(Le,$e,Nt),h.push($e,yt,Nt),xe+=6}l.addGroup(A,xe,U),A+=xe,m+=ve}}static fromJSON(e){return new Ui(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function yf(a){const e={};for(const t in a){e[t]={};for(const n in a[t]){const i=a[t][n];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?e[t][n]=i.clone():Array.isArray(i)?e[t][n]=i.slice():e[t][n]=i}}return e}function cr(a){const e={};for(let t=0;t<a.length;t++){const n=yf(a[t]);for(const i in n)e[i]=n[i]}return e}function Q5(a){const e=[];for(let t=0;t<a.length;t++)e.push(a[t].clone());return e}const dC={clone:yf,merge:cr};var j5=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,q5=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class nr extends Ts{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=j5,this.fragmentShader=q5,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=yf(e.uniforms),this.uniformsGroups=Q5(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const o=this.uniforms[i].value;o&&o.isTexture?t.uniforms[i]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?t.uniforms[i]={type:"c",value:o.getHex()}:o&&o.isVector2?t.uniforms[i]={type:"v2",value:o.toArray()}:o&&o.isVector3?t.uniforms[i]={type:"v3",value:o.toArray()}:o&&o.isVector4?t.uniforms[i]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?t.uniforms[i]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?t.uniforms[i]={type:"m4",value:o.toArray()}:t.uniforms[i]={value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const n={};for(const i in this.extensions)this.extensions[i]===!0&&(n[i]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class Ty extends qt{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new xn,this.projectionMatrix=new xn,this.projectionMatrixInverse=new xn}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}class ts extends Ty{constructor(e=50,t=1,n=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=Qm*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(_u*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return Qm*2*Math.atan(Math.tan(_u*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,n,i,r,o){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(_u*.5*this.fov)/this.zoom,n=2*t,i=this.aspect*n,r=-.5*i;const o=this.view;if(this.view!==null&&this.view.enabled){const h=o.fullWidth,u=o.fullHeight;r+=o.offsetX*i/h,t-=o.offsetY*n/u,i*=o.width/h,n*=o.height/u}const l=this.filmOffset;l!==0&&(r+=e*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,t,t-n,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const Ld=90,Dd=1;class IL extends qt{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n;const i=new ts(Ld,Dd,e,t);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new q(1,0,0)),this.add(i);const r=new ts(Ld,Dd,e,t);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new q(-1,0,0)),this.add(r);const o=new ts(Ld,Dd,e,t);o.layers=this.layers,o.up.set(0,0,1),o.lookAt(new q(0,1,0)),this.add(o);const l=new ts(Ld,Dd,e,t);l.layers=this.layers,l.up.set(0,0,-1),l.lookAt(new q(0,-1,0)),this.add(l);const h=new ts(Ld,Dd,e,t);h.layers=this.layers,h.up.set(0,-1,0),h.lookAt(new q(0,0,1)),this.add(h);const u=new ts(Ld,Dd,e,t);u.layers=this.layers,u.up.set(0,-1,0),u.lookAt(new q(0,0,-1)),this.add(u)}update(e,t){this.parent===null&&this.updateMatrixWorld();const n=this.renderTarget,[i,r,o,l,h,u]=this.children,f=e.getRenderTarget(),g=e.toneMapping,m=e.xr.enabled;e.toneMapping=ca,e.xr.enabled=!1;const A=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,i),e.setRenderTarget(n,1),e.render(t,r),e.setRenderTarget(n,2),e.render(t,o),e.setRenderTarget(n,3),e.render(t,l),e.setRenderTarget(n,4),e.render(t,h),n.texture.generateMipmaps=A,e.setRenderTarget(n,5),e.render(t,u),e.setRenderTarget(f),e.toneMapping=g,e.xr.enabled=m,n.texture.needsPMREMUpdate=!0}}class gg extends Vi{constructor(e,t,n,i,r,o,l,h,u,f){e=e!==void 0?e:[],t=t!==void 0?t:jl,super(e,t,n,i,r,o,l,h,u,f),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class fC extends Hr{constructor(e,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},i=[n,n,n,n,n,n];this.texture=new gg(i,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:yi}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},i=new Ui(5,5,5),r=new nr({name:"CubemapFromEquirect",uniforms:yf(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:Ur,blending:Lc});r.uniforms.tEquirect.value=t;const o=new _t(i,r),l=t.minFilter;return t.minFilter===fa&&(t.minFilter=yi),new IL(1,10,this).update(e,o),t.minFilter=l,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,n,i){const r=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,n,i);e.setRenderTarget(r)}}const Iw=new q,X5=new q,Y5=new kr;class Po{constructor(e=new q(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const i=Iw.subVectors(n,t).cross(X5.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){const n=e.delta(Iw),i=this.normal.dot(n);if(i===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/i;return r<0||r>1?null:t.copy(n).multiplyScalar(r).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||Y5.getNormalMatrix(e),i=this.coplanarPoint(Iw).applyMatrix4(e),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Od=new Qa,P0=new q;class Iy{constructor(e=new Po,t=new Po,n=new Po,i=new Po,r=new Po,o=new Po){this.planes=[e,t,n,i,r,o]}set(e,t,n,i,r,o){const l=this.planes;return l[0].copy(e),l[1].copy(t),l[2].copy(n),l[3].copy(i),l[4].copy(r),l[5].copy(o),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e){const t=this.planes,n=e.elements,i=n[0],r=n[1],o=n[2],l=n[3],h=n[4],u=n[5],f=n[6],g=n[7],m=n[8],A=n[9],v=n[10],w=n[11],b=n[12],S=n[13],R=n[14],M=n[15];return t[0].setComponents(l-i,g-h,w-m,M-b).normalize(),t[1].setComponents(l+i,g+h,w+m,M+b).normalize(),t[2].setComponents(l+r,g+u,w+A,M+S).normalize(),t[3].setComponents(l-r,g-u,w-A,M-S).normalize(),t[4].setComponents(l-o,g-f,w-v,M-R).normalize(),t[5].setComponents(l+o,g+f,w+v,M+R).normalize(),this}intersectsObject(e){const t=e.geometry;return t.boundingSphere===null&&t.computeBoundingSphere(),Od.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Od)}intersectsSprite(e){return Od.center.set(0,0,0),Od.radius=.7071067811865476,Od.applyMatrix4(e.matrixWorld),this.intersectsSphere(Od)}intersectsSphere(e){const t=this.planes,n=e.center,i=-e.radius;for(let r=0;r<6;r++)if(t[r].distanceToPoint(n)<i)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const i=t[n];if(P0.x=i.normal.x>0?e.max.x:e.min.x,P0.y=i.normal.y>0?e.max.y:e.min.y,P0.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(P0)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function RL(){let a=null,e=!1,t=null,n=null;function i(r,o){t(r,o),n=a.requestAnimationFrame(i)}return{start:function(){e!==!0&&t!==null&&(n=a.requestAnimationFrame(i),e=!0)},stop:function(){a.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(r){t=r},setContext:function(r){a=r}}}function J5(a,e){const t=e.isWebGL2,n=new WeakMap;function i(u,f){const g=u.array,m=u.usage,A=a.createBuffer();a.bindBuffer(f,A),a.bufferData(f,g,m),u.onUploadCallback();let v;if(g instanceof Float32Array)v=5126;else if(g instanceof Uint16Array)if(u.isFloat16BufferAttribute)if(t)v=5131;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else v=5123;else if(g instanceof Int16Array)v=5122;else if(g instanceof Uint32Array)v=5125;else if(g instanceof Int32Array)v=5124;else if(g instanceof Int8Array)v=5120;else if(g instanceof Uint8Array)v=5121;else if(g instanceof Uint8ClampedArray)v=5121;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+g);return{buffer:A,type:v,bytesPerElement:g.BYTES_PER_ELEMENT,version:u.version}}function r(u,f,g){const m=f.array,A=f.updateRange;a.bindBuffer(g,u),A.count===-1?a.bufferSubData(g,0,m):(t?a.bufferSubData(g,A.offset*m.BYTES_PER_ELEMENT,m,A.offset,A.count):a.bufferSubData(g,A.offset*m.BYTES_PER_ELEMENT,m.subarray(A.offset,A.offset+A.count)),A.count=-1)}function o(u){return u.isInterleavedBufferAttribute&&(u=u.data),n.get(u)}function l(u){u.isInterleavedBufferAttribute&&(u=u.data);const f=n.get(u);f&&(a.deleteBuffer(f.buffer),n.delete(u))}function h(u,f){if(u.isGLBufferAttribute){const m=n.get(u);(!m||m.version<u.version)&&n.set(u,{buffer:u.buffer,type:u.type,bytesPerElement:u.elementSize,version:u.version});return}u.isInterleavedBufferAttribute&&(u=u.data);const g=n.get(u);g===void 0?n.set(u,i(u,f)):g.version<u.version&&(r(g.buffer,u,f),g.version=u.version)}return{get:o,remove:l,update:h}}class lo extends Sn{constructor(e=1,t=1,n=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i};const r=e/2,o=t/2,l=Math.floor(n),h=Math.floor(i),u=l+1,f=h+1,g=e/l,m=t/h,A=[],v=[],w=[],b=[];for(let S=0;S<f;S++){const R=S*m-o;for(let M=0;M<u;M++){const I=M*g-r;v.push(I,-R,0),w.push(0,0,1),b.push(M/l),b.push(1-S/h)}}for(let S=0;S<h;S++)for(let R=0;R<l;R++){const M=R+u*S,I=R+u*(S+1),T=R+1+u*(S+1),B=R+1+u*S;A.push(M,I,B),A.push(I,T,B)}this.setIndex(A),this.setAttribute("position",new tn(v,3)),this.setAttribute("normal",new tn(w,3)),this.setAttribute("uv",new tn(b,2))}static fromJSON(e){return new lo(e.width,e.height,e.widthSegments,e.heightSegments)}}var Z5=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,K5=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,$5=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,eV=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,tV=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,nV=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,iV="vec3 transformed = vec3( position );",sV=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,rV=`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
#ifdef USE_IRIDESCENCE
	vec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,oV=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,aV=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,cV=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,lV=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,hV=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,uV=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,dV=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,fV=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,pV=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,mV=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,gV=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,AV=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,_V=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,yV=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,vV=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,xV=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,wV=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,bV="gl_FragColor = linearToOutputTexel( gl_FragColor );",EV=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,CV=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,SV=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,MV=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,TV=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,IV=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,RV=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,PV=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,BV=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,LV=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,DV=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,OV=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,FV=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,kV=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,NV=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert
#define Material_LightProbeLOD( material )	(0)`,UV=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,zV=`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,GV=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,HV=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,VV=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,WV=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,QV=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,jV=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	#ifdef USE_IRIDESCENCE
		reflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );
	#else
		reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,qV=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,XV=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,YV=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,JV=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,ZV=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,KV=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,$V=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,eW=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,tW=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,nW=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,iW=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,sW=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,rW=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,oW=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,aW=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,cW=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,lW=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,hW=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,uW=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,dW=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,fW=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,pW=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,mW=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,gW=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,AW=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,_W=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,yW=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,vW=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,xW=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,wW=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,bW=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,EW=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,CW=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,SW=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,MW=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,TW=`#if NUM_SPOT_LIGHT_COORDS > 0
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,IW=`#if NUM_SPOT_LIGHT_COORDS > 0
  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,RW=`#if defined( USE_SHADOWMAP ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_COORDS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,PW=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,BW=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,LW=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,DW=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,OW=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,FW=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,kW=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,NW=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,UW=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,zW=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
#endif`,GW=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef texture2DLodEXT
			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#else
			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#endif
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,HW=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,VW=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,WW=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,QW=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,jW=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,qW=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,XW=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const YW=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,JW=`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	gl_FragColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		gl_FragColor = vec4( mix( pow( gl_FragColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), gl_FragColor.rgb * 0.0773993808, vec3( lessThanEqual( gl_FragColor.rgb, vec3( 0.04045 ) ) ) ), gl_FragColor.w );
	#endif
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,ZW=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,KW=`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,$W=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,eQ=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,tQ=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,nQ=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,iQ=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,sQ=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,rQ=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,oQ=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,aQ=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,cQ=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,lQ=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,hQ=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,uQ=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,dQ=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,fQ=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,pQ=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,mQ=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,gQ=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,AQ=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,_Q=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,yQ=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,vQ=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,xQ=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,wQ=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,bQ=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,EQ=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,CQ=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,SQ=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,qn={alphamap_fragment:Z5,alphamap_pars_fragment:K5,alphatest_fragment:$5,alphatest_pars_fragment:eV,aomap_fragment:tV,aomap_pars_fragment:nV,begin_vertex:iV,beginnormal_vertex:sV,bsdfs:rV,iridescence_fragment:oV,bumpmap_pars_fragment:aV,clipping_planes_fragment:cV,clipping_planes_pars_fragment:lV,clipping_planes_pars_vertex:hV,clipping_planes_vertex:uV,color_fragment:dV,color_pars_fragment:fV,color_pars_vertex:pV,color_vertex:mV,common:gV,cube_uv_reflection_fragment:AV,defaultnormal_vertex:_V,displacementmap_pars_vertex:yV,displacementmap_vertex:vV,emissivemap_fragment:xV,emissivemap_pars_fragment:wV,encodings_fragment:bV,encodings_pars_fragment:EV,envmap_fragment:CV,envmap_common_pars_fragment:SV,envmap_pars_fragment:MV,envmap_pars_vertex:TV,envmap_physical_pars_fragment:zV,envmap_vertex:IV,fog_vertex:RV,fog_pars_vertex:PV,fog_fragment:BV,fog_pars_fragment:LV,gradientmap_pars_fragment:DV,lightmap_fragment:OV,lightmap_pars_fragment:FV,lights_lambert_fragment:kV,lights_lambert_pars_fragment:NV,lights_pars_begin:UV,lights_toon_fragment:GV,lights_toon_pars_fragment:HV,lights_phong_fragment:VV,lights_phong_pars_fragment:WV,lights_physical_fragment:QV,lights_physical_pars_fragment:jV,lights_fragment_begin:qV,lights_fragment_maps:XV,lights_fragment_end:YV,logdepthbuf_fragment:JV,logdepthbuf_pars_fragment:ZV,logdepthbuf_pars_vertex:KV,logdepthbuf_vertex:$V,map_fragment:eW,map_pars_fragment:tW,map_particle_fragment:nW,map_particle_pars_fragment:iW,metalnessmap_fragment:sW,metalnessmap_pars_fragment:rW,morphcolor_vertex:oW,morphnormal_vertex:aW,morphtarget_pars_vertex:cW,morphtarget_vertex:lW,normal_fragment_begin:hW,normal_fragment_maps:uW,normal_pars_fragment:dW,normal_pars_vertex:fW,normal_vertex:pW,normalmap_pars_fragment:mW,clearcoat_normal_fragment_begin:gW,clearcoat_normal_fragment_maps:AW,clearcoat_pars_fragment:_W,iridescence_pars_fragment:yW,output_fragment:vW,packing:xW,premultiplied_alpha_fragment:wW,project_vertex:bW,dithering_fragment:EW,dithering_pars_fragment:CW,roughnessmap_fragment:SW,roughnessmap_pars_fragment:MW,shadowmap_pars_fragment:TW,shadowmap_pars_vertex:IW,shadowmap_vertex:RW,shadowmask_pars_fragment:PW,skinbase_vertex:BW,skinning_pars_vertex:LW,skinning_vertex:DW,skinnormal_vertex:OW,specularmap_fragment:FW,specularmap_pars_fragment:kW,tonemapping_fragment:NW,tonemapping_pars_fragment:UW,transmission_fragment:zW,transmission_pars_fragment:GW,uv_pars_fragment:HW,uv_pars_vertex:VW,uv_vertex:WW,uv2_pars_fragment:QW,uv2_pars_vertex:jW,uv2_vertex:qW,worldpos_vertex:XW,background_vert:YW,background_frag:JW,cube_vert:ZW,cube_frag:KW,depth_vert:$W,depth_frag:eQ,distanceRGBA_vert:tQ,distanceRGBA_frag:nQ,equirect_vert:iQ,equirect_frag:sQ,linedashed_vert:rQ,linedashed_frag:oQ,meshbasic_vert:aQ,meshbasic_frag:cQ,meshlambert_vert:lQ,meshlambert_frag:hQ,meshmatcap_vert:uQ,meshmatcap_frag:dQ,meshnormal_vert:fQ,meshnormal_frag:pQ,meshphong_vert:mQ,meshphong_frag:gQ,meshphysical_vert:AQ,meshphysical_frag:_Q,meshtoon_vert:yQ,meshtoon_frag:vQ,points_vert:xQ,points_frag:wQ,shadow_vert:bQ,shadow_frag:EQ,sprite_vert:CQ,sprite_frag:SQ},Gt={common:{diffuse:{value:new _e(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new kr},uv2Transform:{value:new kr},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Xe(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new _e(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new _e(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new kr}},sprite:{diffuse:{value:new _e(16777215)},opacity:{value:1},center:{value:new Xe(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new kr}}},na={basic:{uniforms:cr([Gt.common,Gt.specularmap,Gt.envmap,Gt.aomap,Gt.lightmap,Gt.fog]),vertexShader:qn.meshbasic_vert,fragmentShader:qn.meshbasic_frag},lambert:{uniforms:cr([Gt.common,Gt.specularmap,Gt.envmap,Gt.aomap,Gt.lightmap,Gt.emissivemap,Gt.bumpmap,Gt.normalmap,Gt.displacementmap,Gt.fog,Gt.lights,{emissive:{value:new _e(0)}}]),vertexShader:qn.meshlambert_vert,fragmentShader:qn.meshlambert_frag},phong:{uniforms:cr([Gt.common,Gt.specularmap,Gt.envmap,Gt.aomap,Gt.lightmap,Gt.emissivemap,Gt.bumpmap,Gt.normalmap,Gt.displacementmap,Gt.fog,Gt.lights,{emissive:{value:new _e(0)},specular:{value:new _e(1118481)},shininess:{value:30}}]),vertexShader:qn.meshphong_vert,fragmentShader:qn.meshphong_frag},standard:{uniforms:cr([Gt.common,Gt.envmap,Gt.aomap,Gt.lightmap,Gt.emissivemap,Gt.bumpmap,Gt.normalmap,Gt.displacementmap,Gt.roughnessmap,Gt.metalnessmap,Gt.fog,Gt.lights,{emissive:{value:new _e(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:qn.meshphysical_vert,fragmentShader:qn.meshphysical_frag},toon:{uniforms:cr([Gt.common,Gt.aomap,Gt.lightmap,Gt.emissivemap,Gt.bumpmap,Gt.normalmap,Gt.displacementmap,Gt.gradientmap,Gt.fog,Gt.lights,{emissive:{value:new _e(0)}}]),vertexShader:qn.meshtoon_vert,fragmentShader:qn.meshtoon_frag},matcap:{uniforms:cr([Gt.common,Gt.bumpmap,Gt.normalmap,Gt.displacementmap,Gt.fog,{matcap:{value:null}}]),vertexShader:qn.meshmatcap_vert,fragmentShader:qn.meshmatcap_frag},points:{uniforms:cr([Gt.points,Gt.fog]),vertexShader:qn.points_vert,fragmentShader:qn.points_frag},dashed:{uniforms:cr([Gt.common,Gt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:qn.linedashed_vert,fragmentShader:qn.linedashed_frag},depth:{uniforms:cr([Gt.common,Gt.displacementmap]),vertexShader:qn.depth_vert,fragmentShader:qn.depth_frag},normal:{uniforms:cr([Gt.common,Gt.bumpmap,Gt.normalmap,Gt.displacementmap,{opacity:{value:1}}]),vertexShader:qn.meshnormal_vert,fragmentShader:qn.meshnormal_frag},sprite:{uniforms:cr([Gt.sprite,Gt.fog]),vertexShader:qn.sprite_vert,fragmentShader:qn.sprite_frag},background:{uniforms:{uvTransform:{value:new kr},t2D:{value:null}},vertexShader:qn.background_vert,fragmentShader:qn.background_frag},cube:{uniforms:cr([Gt.envmap,{opacity:{value:1}}]),vertexShader:qn.cube_vert,fragmentShader:qn.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:qn.equirect_vert,fragmentShader:qn.equirect_frag},distanceRGBA:{uniforms:cr([Gt.common,Gt.displacementmap,{referencePosition:{value:new q},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:qn.distanceRGBA_vert,fragmentShader:qn.distanceRGBA_frag},shadow:{uniforms:cr([Gt.lights,Gt.fog,{color:{value:new _e(0)},opacity:{value:1}}]),vertexShader:qn.shadow_vert,fragmentShader:qn.shadow_frag}};na.physical={uniforms:cr([na.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Xe(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new _e(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Xe},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new _e(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new _e(1,1,1)},specularColorMap:{value:null}}]),vertexShader:qn.meshphysical_vert,fragmentShader:qn.meshphysical_frag};function MQ(a,e,t,n,i,r){const o=new _e(0);let l=i===!0?0:1,h,u,f=null,g=0,m=null;function A(w,b){let S=!1,R=b.isScene===!0?b.background:null;R&&R.isTexture&&(R=e.get(R));const M=a.xr,I=M.getSession&&M.getSession();I&&I.environmentBlendMode==="additive"&&(R=null),R===null?v(o,l):R&&R.isColor&&(v(R,1),S=!0),(a.autoClear||S)&&a.clear(a.autoClearColor,a.autoClearDepth,a.autoClearStencil),R&&(R.isCubeTexture||R.mapping===Mf)?(u===void 0&&(u=new _t(new Ui(1,1,1),new nr({name:"BackgroundCubeMaterial",uniforms:yf(na.cube.uniforms),vertexShader:na.cube.vertexShader,fragmentShader:na.cube.fragmentShader,side:Ur,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(T,B,F){this.matrixWorld.copyPosition(F.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(u)),u.material.uniforms.envMap.value=R,u.material.uniforms.flipEnvMap.value=R.isCubeTexture&&R.isRenderTargetTexture===!1?-1:1,(f!==R||g!==R.version||m!==a.toneMapping)&&(u.material.needsUpdate=!0,f=R,g=R.version,m=a.toneMapping),u.layers.enableAll(),w.unshift(u,u.geometry,u.material,0,0,null)):R&&R.isTexture&&(h===void 0&&(h=new _t(new lo(2,2),new nr({name:"BackgroundMaterial",uniforms:yf(na.background.uniforms),vertexShader:na.background.vertexShader,fragmentShader:na.background.fragmentShader,side:Oo,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),Object.defineProperty(h.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(h)),h.material.uniforms.t2D.value=R,R.matrixAutoUpdate===!0&&R.updateMatrix(),h.material.uniforms.uvTransform.value.copy(R.matrix),(f!==R||g!==R.version||m!==a.toneMapping)&&(h.material.needsUpdate=!0,f=R,g=R.version,m=a.toneMapping),h.layers.enableAll(),w.unshift(h,h.geometry,h.material,0,0,null))}function v(w,b){t.buffers.color.setClear(w.r,w.g,w.b,b,r)}return{getClearColor:function(){return o},setClearColor:function(w,b=1){o.set(w),l=b,v(o,l)},getClearAlpha:function(){return l},setClearAlpha:function(w){l=w,v(o,l)},render:A}}function TQ(a,e,t,n){const i=a.getParameter(34921),r=n.isWebGL2?null:e.get("OES_vertex_array_object"),o=n.isWebGL2||r!==null,l={},h=b(null);let u=h,f=!1;function g(Y,se,ae,ve,xe){let Ae=!1;if(o){const Me=w(ve,ae,se);u!==Me&&(u=Me,A(u.object)),Ae=S(Y,ve,ae,xe),Ae&&R(Y,ve,ae,xe)}else{const Me=se.wireframe===!0;(u.geometry!==ve.id||u.program!==ae.id||u.wireframe!==Me)&&(u.geometry=ve.id,u.program=ae.id,u.wireframe=Me,Ae=!0)}xe!==null&&t.update(xe,34963),(Ae||f)&&(f=!1,D(Y,se,ae,ve),xe!==null&&a.bindBuffer(34963,t.get(xe).buffer))}function m(){return n.isWebGL2?a.createVertexArray():r.createVertexArrayOES()}function A(Y){return n.isWebGL2?a.bindVertexArray(Y):r.bindVertexArrayOES(Y)}function v(Y){return n.isWebGL2?a.deleteVertexArray(Y):r.deleteVertexArrayOES(Y)}function w(Y,se,ae){const ve=ae.wireframe===!0;let xe=l[Y.id];xe===void 0&&(xe={},l[Y.id]=xe);let Ae=xe[se.id];Ae===void 0&&(Ae={},xe[se.id]=Ae);let Me=Ae[ve];return Me===void 0&&(Me=b(m()),Ae[ve]=Me),Me}function b(Y){const se=[],ae=[],ve=[];for(let xe=0;xe<i;xe++)se[xe]=0,ae[xe]=0,ve[xe]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:se,enabledAttributes:ae,attributeDivisors:ve,object:Y,attributes:{},index:null}}function S(Y,se,ae,ve){const xe=u.attributes,Ae=se.attributes;let Me=0;const Be=ae.getAttributes();for(const Le in Be)if(Be[Le].location>=0){const yt=xe[Le];let Nt=Ae[Le];if(Nt===void 0&&(Le==="instanceMatrix"&&Y.instanceMatrix&&(Nt=Y.instanceMatrix),Le==="instanceColor"&&Y.instanceColor&&(Nt=Y.instanceColor)),yt===void 0||yt.attribute!==Nt||Nt&&yt.data!==Nt.data)return!0;Me++}return u.attributesNum!==Me||u.index!==ve}function R(Y,se,ae,ve){const xe={},Ae=se.attributes;let Me=0;const Be=ae.getAttributes();for(const Le in Be)if(Be[Le].location>=0){let yt=Ae[Le];yt===void 0&&(Le==="instanceMatrix"&&Y.instanceMatrix&&(yt=Y.instanceMatrix),Le==="instanceColor"&&Y.instanceColor&&(yt=Y.instanceColor));const Nt={};Nt.attribute=yt,yt&&yt.data&&(Nt.data=yt.data),xe[Le]=Nt,Me++}u.attributes=xe,u.attributesNum=Me,u.index=ve}function M(){const Y=u.newAttributes;for(let se=0,ae=Y.length;se<ae;se++)Y[se]=0}function I(Y){T(Y,0)}function T(Y,se){const ae=u.newAttributes,ve=u.enabledAttributes,xe=u.attributeDivisors;ae[Y]=1,ve[Y]===0&&(a.enableVertexAttribArray(Y),ve[Y]=1),xe[Y]!==se&&((n.isWebGL2?a:e.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](Y,se),xe[Y]=se)}function B(){const Y=u.newAttributes,se=u.enabledAttributes;for(let ae=0,ve=se.length;ae<ve;ae++)se[ae]!==Y[ae]&&(a.disableVertexAttribArray(ae),se[ae]=0)}function F(Y,se,ae,ve,xe,Ae){n.isWebGL2===!0&&(ae===5124||ae===5125)?a.vertexAttribIPointer(Y,se,ae,xe,Ae):a.vertexAttribPointer(Y,se,ae,ve,xe,Ae)}function D(Y,se,ae,ve){if(n.isWebGL2===!1&&(Y.isInstancedMesh||ve.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;M();const xe=ve.attributes,Ae=ae.getAttributes(),Me=se.defaultAttributeValues;for(const Be in Ae){const Le=Ae[Be];if(Le.location>=0){let $e=xe[Be];if($e===void 0&&(Be==="instanceMatrix"&&Y.instanceMatrix&&($e=Y.instanceMatrix),Be==="instanceColor"&&Y.instanceColor&&($e=Y.instanceColor)),$e!==void 0){const yt=$e.normalized,Nt=$e.itemSize,He=t.get($e);if(He===void 0)continue;const mn=He.buffer,Xt=He.type,pn=He.bytesPerElement;if($e.isInterleavedBufferAttribute){const Ft=$e.data,yn=Ft.stride,it=$e.offset;if(Ft.isInstancedInterleavedBuffer){for(let tt=0;tt<Le.locationSize;tt++)T(Le.location+tt,Ft.meshPerAttribute);Y.isInstancedMesh!==!0&&ve._maxInstanceCount===void 0&&(ve._maxInstanceCount=Ft.meshPerAttribute*Ft.count)}else for(let tt=0;tt<Le.locationSize;tt++)I(Le.location+tt);a.bindBuffer(34962,mn);for(let tt=0;tt<Le.locationSize;tt++)F(Le.location+tt,Nt/Le.locationSize,Xt,yt,yn*pn,(it+Nt/Le.locationSize*tt)*pn)}else{if($e.isInstancedBufferAttribute){for(let Ft=0;Ft<Le.locationSize;Ft++)T(Le.location+Ft,$e.meshPerAttribute);Y.isInstancedMesh!==!0&&ve._maxInstanceCount===void 0&&(ve._maxInstanceCount=$e.meshPerAttribute*$e.count)}else for(let Ft=0;Ft<Le.locationSize;Ft++)I(Le.location+Ft);a.bindBuffer(34962,mn);for(let Ft=0;Ft<Le.locationSize;Ft++)F(Le.location+Ft,Nt/Le.locationSize,Xt,yt,Nt*pn,Nt/Le.locationSize*Ft*pn)}}else if(Me!==void 0){const yt=Me[Be];if(yt!==void 0)switch(yt.length){case 2:a.vertexAttrib2fv(Le.location,yt);break;case 3:a.vertexAttrib3fv(Le.location,yt);break;case 4:a.vertexAttrib4fv(Le.location,yt);break;default:a.vertexAttrib1fv(Le.location,yt)}}}}B()}function U(){ee();for(const Y in l){const se=l[Y];for(const ae in se){const ve=se[ae];for(const xe in ve)v(ve[xe].object),delete ve[xe];delete se[ae]}delete l[Y]}}function W(Y){if(l[Y.id]===void 0)return;const se=l[Y.id];for(const ae in se){const ve=se[ae];for(const xe in ve)v(ve[xe].object),delete ve[xe];delete se[ae]}delete l[Y.id]}function J(Y){for(const se in l){const ae=l[se];if(ae[Y.id]===void 0)continue;const ve=ae[Y.id];for(const xe in ve)v(ve[xe].object),delete ve[xe];delete ae[Y.id]}}function ee(){Q(),f=!0,u!==h&&(u=h,A(u.object))}function Q(){h.geometry=null,h.program=null,h.wireframe=!1}return{setup:g,reset:ee,resetDefaultState:Q,dispose:U,releaseStatesOfGeometry:W,releaseStatesOfProgram:J,initAttributes:M,enableAttribute:I,disableUnusedAttributes:B}}function IQ(a,e,t,n){const i=n.isWebGL2;let r;function o(u){r=u}function l(u,f){a.drawArrays(r,u,f),t.update(f,r,1)}function h(u,f,g){if(g===0)return;let m,A;if(i)m=a,A="drawArraysInstanced";else if(m=e.get("ANGLE_instanced_arrays"),A="drawArraysInstancedANGLE",m===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}m[A](r,u,f,g),t.update(f,r,g)}this.setMode=o,this.render=l,this.renderInstances=h}function RQ(a,e,t){let n;function i(){if(n!==void 0)return n;if(e.has("EXT_texture_filter_anisotropic")===!0){const F=e.get("EXT_texture_filter_anisotropic");n=a.getParameter(F.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n}function r(F){if(F==="highp"){if(a.getShaderPrecisionFormat(35633,36338).precision>0&&a.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";F="mediump"}return F==="mediump"&&a.getShaderPrecisionFormat(35633,36337).precision>0&&a.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const o=typeof WebGL2RenderingContext<"u"&&a instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext<"u"&&a instanceof WebGL2ComputeRenderingContext;let l=t.precision!==void 0?t.precision:"highp";const h=r(l);h!==l&&(console.warn("THREE.WebGLRenderer:",l,"not supported, using",h,"instead."),l=h);const u=o||e.has("WEBGL_draw_buffers"),f=t.logarithmicDepthBuffer===!0,g=a.getParameter(34930),m=a.getParameter(35660),A=a.getParameter(3379),v=a.getParameter(34076),w=a.getParameter(34921),b=a.getParameter(36347),S=a.getParameter(36348),R=a.getParameter(36349),M=m>0,I=o||e.has("OES_texture_float"),T=M&&I,B=o?a.getParameter(36183):0;return{isWebGL2:o,drawBuffers:u,getMaxAnisotropy:i,getMaxPrecision:r,precision:l,logarithmicDepthBuffer:f,maxTextures:g,maxVertexTextures:m,maxTextureSize:A,maxCubemapSize:v,maxAttributes:w,maxVertexUniforms:b,maxVaryings:S,maxFragmentUniforms:R,vertexTextures:M,floatFragmentTextures:I,floatVertexTextures:T,maxSamples:B}}function PQ(a){const e=this;let t=null,n=0,i=!1,r=!1;const o=new Po,l=new kr,h={value:null,needsUpdate:!1};this.uniform=h,this.numPlanes=0,this.numIntersection=0,this.init=function(g,m,A){const v=g.length!==0||m||n!==0||i;return i=m,t=f(g,A,0),n=g.length,v},this.beginShadows=function(){r=!0,f(null)},this.endShadows=function(){r=!1,u()},this.setState=function(g,m,A){const v=g.clippingPlanes,w=g.clipIntersection,b=g.clipShadows,S=a.get(g);if(!i||v===null||v.length===0||r&&!b)r?f(null):u();else{const R=r?0:n,M=R*4;let I=S.clippingState||null;h.value=I,I=f(v,m,M,A);for(let T=0;T!==M;++T)I[T]=t[T];S.clippingState=I,this.numIntersection=w?this.numPlanes:0,this.numPlanes+=R}};function u(){h.value!==t&&(h.value=t,h.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function f(g,m,A,v){const w=g!==null?g.length:0;let b=null;if(w!==0){if(b=h.value,v!==!0||b===null){const S=A+w*4,R=m.matrixWorldInverse;l.getNormalMatrix(R),(b===null||b.length<S)&&(b=new Float32Array(S));for(let M=0,I=A;M!==w;++M,I+=4)o.copy(g[M]).applyMatrix4(R,l),o.normal.toArray(b,I),b[I+3]=o.constant}h.value=b,h.needsUpdate=!0}return e.numPlanes=w,e.numIntersection=0,b}}function BQ(a){let e=new WeakMap;function t(o,l){return l===ka?o.mapping=jl:l===gf&&(o.mapping=ql),o}function n(o){if(o&&o.isTexture&&o.isRenderTargetTexture===!1){const l=o.mapping;if(l===ka||l===gf)if(e.has(o)){const h=e.get(o).texture;return t(h,o.mapping)}else{const h=o.image;if(h&&h.height>0){const u=new fC(h.height/2);return u.fromEquirectangularTexture(a,o),e.set(o,u),o.addEventListener("dispose",i),t(u.texture,o.mapping)}else return null}}return o}function i(o){const l=o.target;l.removeEventListener("dispose",i);const h=e.get(l);h!==void 0&&(e.delete(l),h.dispose())}function r(){e=new WeakMap}return{get:n,dispose:r}}class nh extends Ty{constructor(e=-1,t=1,n=1,i=-1,r=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=i,this.near=r,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,n,i,r,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let r=n-e,o=n+e,l=i+t,h=i-t;if(this.view!==null&&this.view.enabled){const u=(this.right-this.left)/this.view.fullWidth/this.zoom,f=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=u*this.view.offsetX,o=r+u*this.view.width,l-=f*this.view.offsetY,h=l-f*this.view.height}this.projectionMatrix.makeOrthographic(r,o,l,h,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}const nf=4,bI=[.125,.215,.35,.446,.526,.582],ou=20,Rw=new nh,EI=new _e;let Pw=null;const eu=(1+Math.sqrt(5))/2,Fd=1/eu,CI=[new q(1,1,1),new q(-1,1,1),new q(1,1,-1),new q(-1,1,-1),new q(0,eu,Fd),new q(0,eu,-Fd),new q(Fd,0,eu),new q(-Fd,0,eu),new q(eu,Fd,0),new q(-eu,Fd,0)];class iE{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,i=100){Pw=this._renderer.getRenderTarget(),this._setSize(256);const r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(e,n,i,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=TI(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=MI(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(Pw),e.scissorTest=!1,B0(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===jl||e.mapping===ql?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),Pw=this._renderer.getRenderTarget();const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:yi,minFilter:yi,generateMipmaps:!1,type:Os,format:us,encoding:pr,depthBuffer:!1},i=SI(e,t,n);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=SI(e,t,n);const{_lodMax:r}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=LQ(r)),this._blurMaterial=DQ(r,e,t)}return i}_compileMaterial(e){const t=new _t(this._lodPlanes[0],e);this._renderer.compile(t,Rw)}_sceneToCubeUV(e,t,n,i){const l=new ts(90,1,t,n),h=[1,-1,1,1,1,1],u=[1,1,1,-1,-1,-1],f=this._renderer,g=f.autoClear,m=f.toneMapping;f.getClearColor(EI),f.toneMapping=ca,f.autoClear=!1;const A=new Hi({name:"PMREM.Background",side:Ur,depthWrite:!1,depthTest:!1}),v=new _t(new Ui,A);let w=!1;const b=e.background;b?b.isColor&&(A.color.copy(b),e.background=null,w=!0):(A.color.copy(EI),w=!0);for(let S=0;S<6;S++){const R=S%3;R===0?(l.up.set(0,h[S],0),l.lookAt(u[S],0,0)):R===1?(l.up.set(0,0,h[S]),l.lookAt(0,u[S],0)):(l.up.set(0,h[S],0),l.lookAt(0,0,u[S]));const M=this._cubeSize;B0(i,R*M,S>2?M:0,M,M),f.setRenderTarget(i),w&&f.render(v,l),f.render(e,l)}v.geometry.dispose(),v.material.dispose(),f.toneMapping=m,f.autoClear=g,e.background=b}_textureToCubeUV(e,t){const n=this._renderer,i=e.mapping===jl||e.mapping===ql;i?(this._cubemapMaterial===null&&(this._cubemapMaterial=TI()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=MI());const r=i?this._cubemapMaterial:this._equirectMaterial,o=new _t(this._lodPlanes[0],r),l=r.uniforms;l.envMap.value=e;const h=this._cubeSize;B0(t,0,0,3*h,2*h),n.setRenderTarget(t),n.render(o,Rw)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;for(let i=1;i<this._lodPlanes.length;i++){const r=Math.sqrt(this._sigmas[i]*this._sigmas[i]-this._sigmas[i-1]*this._sigmas[i-1]),o=CI[(i-1)%CI.length];this._blur(e,i-1,i,r,o)}t.autoClear=n}_blur(e,t,n,i,r){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,n,i,"latitudinal",r),this._halfBlur(o,e,n,n,i,"longitudinal",r)}_halfBlur(e,t,n,i,r,o,l){const h=this._renderer,u=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const f=3,g=new _t(this._lodPlanes[i],u),m=u.uniforms,A=this._sizeLods[n]-1,v=isFinite(r)?Math.PI/(2*A):2*Math.PI/(2*ou-1),w=r/v,b=isFinite(r)?1+Math.floor(f*w):ou;b>ou&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${b} samples when the maximum is set to ${ou}`);const S=[];let R=0;for(let F=0;F<ou;++F){const D=F/w,U=Math.exp(-D*D/2);S.push(U),F===0?R+=U:F<b&&(R+=2*U)}for(let F=0;F<S.length;F++)S[F]=S[F]/R;m.envMap.value=e.texture,m.samples.value=b,m.weights.value=S,m.latitudinal.value=o==="latitudinal",l&&(m.poleAxis.value=l);const{_lodMax:M}=this;m.dTheta.value=v,m.mipInt.value=M-n;const I=this._sizeLods[i],T=3*I*(i>M-nf?i-M+nf:0),B=4*(this._cubeSize-I);B0(t,T,B,3*I,2*I),h.setRenderTarget(t),h.render(g,Rw)}}function LQ(a){const e=[],t=[],n=[];let i=a;const r=a-nf+1+bI.length;for(let o=0;o<r;o++){const l=Math.pow(2,i);t.push(l);let h=1/l;o>a-nf?h=bI[o-a+nf-1]:o===0&&(h=0),n.push(h);const u=1/(l-2),f=-u,g=1+u,m=[f,f,g,f,g,g,f,f,g,g,f,g],A=6,v=6,w=3,b=2,S=1,R=new Float32Array(w*v*A),M=new Float32Array(b*v*A),I=new Float32Array(S*v*A);for(let B=0;B<A;B++){const F=B%3*2/3-1,D=B>2?0:-1,U=[F,D,0,F+2/3,D,0,F+2/3,D+1,0,F,D,0,F+2/3,D+1,0,F,D+1,0];R.set(U,w*v*B),M.set(m,b*v*B);const W=[B,B,B,B,B,B];I.set(W,S*v*B)}const T=new Sn;T.setAttribute("position",new Jn(R,w)),T.setAttribute("uv",new Jn(M,b)),T.setAttribute("faceIndex",new Jn(I,S)),e.push(T),i>nf&&i--}return{lodPlanes:e,sizeLods:t,sigmas:n}}function SI(a,e,t){const n=new Hr(a,e,t);return n.texture.mapping=Mf,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function B0(a,e,t,n,i){a.viewport.set(e,t,n,i),a.scissor.set(e,t,n,i)}function DQ(a,e,t){const n=new Float32Array(ou),i=new q(0,1,0);return new nr({name:"SphericalGaussianBlur",defines:{n:ou,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${a}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:pC(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Lc,depthTest:!1,depthWrite:!1})}function MI(){return new nr({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:pC(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Lc,depthTest:!1,depthWrite:!1})}function TI(){return new nr({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:pC(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Lc,depthTest:!1,depthWrite:!1})}function pC(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function OQ(a){let e=new WeakMap,t=null;function n(l){if(l&&l.isTexture){const h=l.mapping,u=h===ka||h===gf,f=h===jl||h===ql;if(u||f)if(l.isRenderTargetTexture&&l.needsPMREMUpdate===!0){l.needsPMREMUpdate=!1;let g=e.get(l);return t===null&&(t=new iE(a)),g=u?t.fromEquirectangular(l,g):t.fromCubemap(l,g),e.set(l,g),g.texture}else{if(e.has(l))return e.get(l).texture;{const g=l.image;if(u&&g&&g.height>0||f&&g&&i(g)){t===null&&(t=new iE(a));const m=u?t.fromEquirectangular(l):t.fromCubemap(l);return e.set(l,m),l.addEventListener("dispose",r),m.texture}else return null}}}return l}function i(l){let h=0;const u=6;for(let f=0;f<u;f++)l[f]!==void 0&&h++;return h===u}function r(l){const h=l.target;h.removeEventListener("dispose",r);const u=e.get(h);u!==void 0&&(e.delete(h),u.dispose())}function o(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:n,dispose:o}}function FQ(a){const e={};function t(n){if(e[n]!==void 0)return e[n];let i;switch(n){case"WEBGL_depth_texture":i=a.getExtension("WEBGL_depth_texture")||a.getExtension("MOZ_WEBGL_depth_texture")||a.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=a.getExtension("WEBGL_compressed_texture_s3tc")||a.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||a.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=a.getExtension("WEBGL_compressed_texture_pvrtc")||a.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=a.getExtension(n)}return e[n]=i,i}return{has:function(n){return t(n)!==null},init:function(n){n.isWebGL2?t("EXT_color_buffer_float"):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture")},get:function(n){const i=t(n);return i===null&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),i}}}function kQ(a,e,t,n){const i={},r=new WeakMap;function o(g){const m=g.target;m.index!==null&&e.remove(m.index);for(const v in m.attributes)e.remove(m.attributes[v]);m.removeEventListener("dispose",o),delete i[m.id];const A=r.get(m);A&&(e.remove(A),r.delete(m)),n.releaseStatesOfGeometry(m),m.isInstancedBufferGeometry===!0&&delete m._maxInstanceCount,t.memory.geometries--}function l(g,m){return i[m.id]===!0||(m.addEventListener("dispose",o),i[m.id]=!0,t.memory.geometries++),m}function h(g){const m=g.attributes;for(const v in m)e.update(m[v],34962);const A=g.morphAttributes;for(const v in A){const w=A[v];for(let b=0,S=w.length;b<S;b++)e.update(w[b],34962)}}function u(g){const m=[],A=g.index,v=g.attributes.position;let w=0;if(A!==null){const R=A.array;w=A.version;for(let M=0,I=R.length;M<I;M+=3){const T=R[M+0],B=R[M+1],F=R[M+2];m.push(T,B,B,F,F,T)}}else{const R=v.array;w=v.version;for(let M=0,I=R.length/3-1;M<I;M+=3){const T=M+0,B=M+1,F=M+2;m.push(T,B,B,F,F,T)}}const b=new(ML(m)?uC:hC)(m,1);b.version=w;const S=r.get(g);S&&e.remove(S),r.set(g,b)}function f(g){const m=r.get(g);if(m){const A=g.index;A!==null&&m.version<A.version&&u(g)}else u(g);return r.get(g)}return{get:l,update:h,getWireframeAttribute:f}}function NQ(a,e,t,n){const i=n.isWebGL2;let r;function o(m){r=m}let l,h;function u(m){l=m.type,h=m.bytesPerElement}function f(m,A){a.drawElements(r,A,l,m*h),t.update(A,r,1)}function g(m,A,v){if(v===0)return;let w,b;if(i)w=a,b="drawElementsInstanced";else if(w=e.get("ANGLE_instanced_arrays"),b="drawElementsInstancedANGLE",w===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}w[b](r,A,l,m*h,v),t.update(A,r,v)}this.setMode=o,this.setIndex=u,this.render=f,this.renderInstances=g}function UQ(a){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function n(r,o,l){switch(t.calls++,o){case 4:t.triangles+=l*(r/3);break;case 1:t.lines+=l*(r/2);break;case 3:t.lines+=l*(r-1);break;case 2:t.lines+=l*r;break;case 0:t.points+=l*r;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}function i(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:i,update:n}}function zQ(a,e){return a[0]-e[0]}function GQ(a,e){return Math.abs(e[1])-Math.abs(a[1])}function HQ(a,e,t){const n={},i=new Float32Array(8),r=new WeakMap,o=new On,l=[];for(let u=0;u<8;u++)l[u]=[u,0];function h(u,f,g,m){const A=u.morphTargetInfluences;if(e.isWebGL2===!0){const w=f.morphAttributes.position||f.morphAttributes.normal||f.morphAttributes.color,b=w!==void 0?w.length:0;let S=r.get(f);if(S===void 0||S.count!==b){let ae=function(){Y.dispose(),r.delete(f),f.removeEventListener("dispose",ae)};var v=ae;S!==void 0&&S.texture.dispose();const I=f.morphAttributes.position!==void 0,T=f.morphAttributes.normal!==void 0,B=f.morphAttributes.color!==void 0,F=f.morphAttributes.position||[],D=f.morphAttributes.normal||[],U=f.morphAttributes.color||[];let W=0;I===!0&&(W=1),T===!0&&(W=2),B===!0&&(W=3);let J=f.attributes.position.count*W,ee=1;J>e.maxTextureSize&&(ee=Math.ceil(J/e.maxTextureSize),J=e.maxTextureSize);const Q=new Float32Array(J*ee*4*b),Y=new pg(Q,J,ee,b);Y.type=Ms,Y.needsUpdate=!0;const se=W*4;for(let ve=0;ve<b;ve++){const xe=F[ve],Ae=D[ve],Me=U[ve],Be=J*ee*4*ve;for(let Le=0;Le<xe.count;Le++){const $e=Le*se;I===!0&&(o.fromBufferAttribute(xe,Le),Q[Be+$e+0]=o.x,Q[Be+$e+1]=o.y,Q[Be+$e+2]=o.z,Q[Be+$e+3]=0),T===!0&&(o.fromBufferAttribute(Ae,Le),Q[Be+$e+4]=o.x,Q[Be+$e+5]=o.y,Q[Be+$e+6]=o.z,Q[Be+$e+7]=0),B===!0&&(o.fromBufferAttribute(Me,Le),Q[Be+$e+8]=o.x,Q[Be+$e+9]=o.y,Q[Be+$e+10]=o.z,Q[Be+$e+11]=Me.itemSize===4?o.w:1)}}S={count:b,texture:Y,size:new Xe(J,ee)},r.set(f,S),f.addEventListener("dispose",ae)}let R=0;for(let I=0;I<A.length;I++)R+=A[I];const M=f.morphTargetsRelative?1:1-R;m.getUniforms().setValue(a,"morphTargetBaseInfluence",M),m.getUniforms().setValue(a,"morphTargetInfluences",A),m.getUniforms().setValue(a,"morphTargetsTexture",S.texture,t),m.getUniforms().setValue(a,"morphTargetsTextureSize",S.size)}else{const w=A===void 0?0:A.length;let b=n[f.id];if(b===void 0||b.length!==w){b=[];for(let T=0;T<w;T++)b[T]=[T,0];n[f.id]=b}for(let T=0;T<w;T++){const B=b[T];B[0]=T,B[1]=A[T]}b.sort(GQ);for(let T=0;T<8;T++)T<w&&b[T][1]?(l[T][0]=b[T][0],l[T][1]=b[T][1]):(l[T][0]=Number.MAX_SAFE_INTEGER,l[T][1]=0);l.sort(zQ);const S=f.morphAttributes.position,R=f.morphAttributes.normal;let M=0;for(let T=0;T<8;T++){const B=l[T],F=B[0],D=B[1];F!==Number.MAX_SAFE_INTEGER&&D?(S&&f.getAttribute("morphTarget"+T)!==S[F]&&f.setAttribute("morphTarget"+T,S[F]),R&&f.getAttribute("morphNormal"+T)!==R[F]&&f.setAttribute("morphNormal"+T,R[F]),i[T]=D,M+=D):(S&&f.hasAttribute("morphTarget"+T)===!0&&f.deleteAttribute("morphTarget"+T),R&&f.hasAttribute("morphNormal"+T)===!0&&f.deleteAttribute("morphNormal"+T),i[T]=0)}const I=f.morphTargetsRelative?1:1-M;m.getUniforms().setValue(a,"morphTargetBaseInfluence",I),m.getUniforms().setValue(a,"morphTargetInfluences",i)}}return{update:h}}function VQ(a,e,t,n){let i=new WeakMap;function r(h){const u=n.render.frame,f=h.geometry,g=e.get(h,f);return i.get(g)!==u&&(e.update(g),i.set(g,u)),h.isInstancedMesh&&(h.hasEventListener("dispose",l)===!1&&h.addEventListener("dispose",l),t.update(h.instanceMatrix,34962),h.instanceColor!==null&&t.update(h.instanceColor,34962)),g}function o(){i=new WeakMap}function l(h){const u=h.target;u.removeEventListener("dispose",l),t.remove(u.instanceMatrix),u.instanceColor!==null&&t.remove(u.instanceColor)}return{update:r,dispose:o}}const PL=new Vi,BL=new pg,LL=new mg,DL=new gg,II=[],RI=[],PI=new Float32Array(16),BI=new Float32Array(9),LI=new Float32Array(4);function Tf(a,e,t){const n=a[0];if(n<=0||n>0)return a;const i=e*t;let r=II[i];if(r===void 0&&(r=new Float32Array(i),II[i]=r),e!==0){n.toArray(r,0);for(let o=1,l=0;o!==e;++o)l+=t,a[o].toArray(r,l)}return r}function ks(a,e){if(a.length!==e.length)return!1;for(let t=0,n=a.length;t<n;t++)if(a[t]!==e[t])return!1;return!0}function Ns(a,e){for(let t=0,n=e.length;t<n;t++)a[t]=e[t]}function Ry(a,e){let t=RI[e];t===void 0&&(t=new Int32Array(e),RI[e]=t);for(let n=0;n!==e;++n)t[n]=a.allocateTextureUnit();return t}function WQ(a,e){const t=this.cache;t[0]!==e&&(a.uniform1f(this.addr,e),t[0]=e)}function QQ(a,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(a.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(ks(t,e))return;a.uniform2fv(this.addr,e),Ns(t,e)}}function jQ(a,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(a.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(a.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(ks(t,e))return;a.uniform3fv(this.addr,e),Ns(t,e)}}function qQ(a,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(a.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(ks(t,e))return;a.uniform4fv(this.addr,e),Ns(t,e)}}function XQ(a,e){const t=this.cache,n=e.elements;if(n===void 0){if(ks(t,e))return;a.uniformMatrix2fv(this.addr,!1,e),Ns(t,e)}else{if(ks(t,n))return;LI.set(n),a.uniformMatrix2fv(this.addr,!1,LI),Ns(t,n)}}function YQ(a,e){const t=this.cache,n=e.elements;if(n===void 0){if(ks(t,e))return;a.uniformMatrix3fv(this.addr,!1,e),Ns(t,e)}else{if(ks(t,n))return;BI.set(n),a.uniformMatrix3fv(this.addr,!1,BI),Ns(t,n)}}function JQ(a,e){const t=this.cache,n=e.elements;if(n===void 0){if(ks(t,e))return;a.uniformMatrix4fv(this.addr,!1,e),Ns(t,e)}else{if(ks(t,n))return;PI.set(n),a.uniformMatrix4fv(this.addr,!1,PI),Ns(t,n)}}function ZQ(a,e){const t=this.cache;t[0]!==e&&(a.uniform1i(this.addr,e),t[0]=e)}function KQ(a,e){const t=this.cache;ks(t,e)||(a.uniform2iv(this.addr,e),Ns(t,e))}function $Q(a,e){const t=this.cache;ks(t,e)||(a.uniform3iv(this.addr,e),Ns(t,e))}function e8(a,e){const t=this.cache;ks(t,e)||(a.uniform4iv(this.addr,e),Ns(t,e))}function t8(a,e){const t=this.cache;t[0]!==e&&(a.uniform1ui(this.addr,e),t[0]=e)}function n8(a,e){const t=this.cache;ks(t,e)||(a.uniform2uiv(this.addr,e),Ns(t,e))}function i8(a,e){const t=this.cache;ks(t,e)||(a.uniform3uiv(this.addr,e),Ns(t,e))}function s8(a,e){const t=this.cache;ks(t,e)||(a.uniform4uiv(this.addr,e),Ns(t,e))}function r8(a,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(a.uniform1i(this.addr,i),n[0]=i),t.setTexture2D(e||PL,i)}function o8(a,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(a.uniform1i(this.addr,i),n[0]=i),t.setTexture3D(e||LL,i)}function a8(a,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(a.uniform1i(this.addr,i),n[0]=i),t.setTextureCube(e||DL,i)}function c8(a,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(a.uniform1i(this.addr,i),n[0]=i),t.setTexture2DArray(e||BL,i)}function l8(a){switch(a){case 5126:return WQ;case 35664:return QQ;case 35665:return jQ;case 35666:return qQ;case 35674:return XQ;case 35675:return YQ;case 35676:return JQ;case 5124:case 35670:return ZQ;case 35667:case 35671:return KQ;case 35668:case 35672:return $Q;case 35669:case 35673:return e8;case 5125:return t8;case 36294:return n8;case 36295:return i8;case 36296:return s8;case 35678:case 36198:case 36298:case 36306:case 35682:return r8;case 35679:case 36299:case 36307:return o8;case 35680:case 36300:case 36308:case 36293:return a8;case 36289:case 36303:case 36311:case 36292:return c8}}function h8(a,e){a.uniform1fv(this.addr,e)}function u8(a,e){const t=Tf(e,this.size,2);a.uniform2fv(this.addr,t)}function d8(a,e){const t=Tf(e,this.size,3);a.uniform3fv(this.addr,t)}function f8(a,e){const t=Tf(e,this.size,4);a.uniform4fv(this.addr,t)}function p8(a,e){const t=Tf(e,this.size,4);a.uniformMatrix2fv(this.addr,!1,t)}function m8(a,e){const t=Tf(e,this.size,9);a.uniformMatrix3fv(this.addr,!1,t)}function g8(a,e){const t=Tf(e,this.size,16);a.uniformMatrix4fv(this.addr,!1,t)}function A8(a,e){a.uniform1iv(this.addr,e)}function _8(a,e){a.uniform2iv(this.addr,e)}function y8(a,e){a.uniform3iv(this.addr,e)}function v8(a,e){a.uniform4iv(this.addr,e)}function x8(a,e){a.uniform1uiv(this.addr,e)}function w8(a,e){a.uniform2uiv(this.addr,e)}function b8(a,e){a.uniform3uiv(this.addr,e)}function E8(a,e){a.uniform4uiv(this.addr,e)}function C8(a,e,t){const n=this.cache,i=e.length,r=Ry(t,i);ks(n,r)||(a.uniform1iv(this.addr,r),Ns(n,r));for(let o=0;o!==i;++o)t.setTexture2D(e[o]||PL,r[o])}function S8(a,e,t){const n=this.cache,i=e.length,r=Ry(t,i);ks(n,r)||(a.uniform1iv(this.addr,r),Ns(n,r));for(let o=0;o!==i;++o)t.setTexture3D(e[o]||LL,r[o])}function M8(a,e,t){const n=this.cache,i=e.length,r=Ry(t,i);ks(n,r)||(a.uniform1iv(this.addr,r),Ns(n,r));for(let o=0;o!==i;++o)t.setTextureCube(e[o]||DL,r[o])}function T8(a,e,t){const n=this.cache,i=e.length,r=Ry(t,i);ks(n,r)||(a.uniform1iv(this.addr,r),Ns(n,r));for(let o=0;o!==i;++o)t.setTexture2DArray(e[o]||BL,r[o])}function I8(a){switch(a){case 5126:return h8;case 35664:return u8;case 35665:return d8;case 35666:return f8;case 35674:return p8;case 35675:return m8;case 35676:return g8;case 5124:case 35670:return A8;case 35667:case 35671:return _8;case 35668:case 35672:return y8;case 35669:case 35673:return v8;case 5125:return x8;case 36294:return w8;case 36295:return b8;case 36296:return E8;case 35678:case 36198:case 36298:case 36306:case 35682:return C8;case 35679:case 36299:case 36307:return S8;case 35680:case 36300:case 36308:case 36293:return M8;case 36289:case 36303:case 36311:case 36292:return T8}}class R8{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=l8(t.type)}}class P8{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=I8(t.type)}}class B8{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const i=this.seq;for(let r=0,o=i.length;r!==o;++r){const l=i[r];l.setValue(e,t[l.id],n)}}}const Bw=/(\w+)(\])?(\[|\.)?/g;function DI(a,e){a.seq.push(e),a.map[e.id]=e}function L8(a,e,t){const n=a.name,i=n.length;for(Bw.lastIndex=0;;){const r=Bw.exec(n),o=Bw.lastIndex;let l=r[1];const h=r[2]==="]",u=r[3];if(h&&(l=l|0),u===void 0||u==="["&&o+2===i){DI(t,u===void 0?new R8(l,a,e):new P8(l,a,e));break}else{let g=t.map[l];g===void 0&&(g=new B8(l),DI(t,g)),t=g}}}class E_{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,35718);for(let i=0;i<n;++i){const r=e.getActiveUniform(t,i),o=e.getUniformLocation(t,r.name);L8(r,o,this)}}setValue(e,t,n,i){const r=this.map[t];r!==void 0&&r.setValue(e,n,i)}setOptional(e,t,n){const i=t[n];i!==void 0&&this.setValue(e,n,i)}static upload(e,t,n,i){for(let r=0,o=t.length;r!==o;++r){const l=t[r],h=n[l.id];h.needsUpdate!==!1&&l.setValue(e,h.value,i)}}static seqWithValue(e,t){const n=[];for(let i=0,r=e.length;i!==r;++i){const o=e[i];o.id in t&&n.push(o)}return n}}function OI(a,e,t){const n=a.createShader(e);return a.shaderSource(n,t),a.compileShader(n),n}let D8=0;function O8(a,e){const t=a.split(`
`),n=[],i=Math.max(e-6,0),r=Math.min(e+6,t.length);for(let o=i;o<r;o++){const l=o+1;n.push(`${l===e?">":" "} ${l}: ${t[o]}`)}return n.join(`
`)}function F8(a){switch(a){case pr:return["Linear","( value )"];case Gn:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",a),["Linear","( value )"]}}function FI(a,e,t){const n=a.getShaderParameter(e,35713),i=a.getShaderInfoLog(e).trim();if(n&&i==="")return"";const r=/ERROR: 0:(\d+)/.exec(i);if(r){const o=parseInt(r[1]);return t.toUpperCase()+`

`+i+`

`+O8(a.getShaderSource(e),o)}else return i}function k8(a,e){const t=F8(e);return"vec4 "+a+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}function N8(a,e){let t;switch(e){case V_:t="Linear";break;case eC:t="Reinhard";break;case qB:t="OptimizedCineon";break;case tC:t="ACESFilmic";break;case XB:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+a+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function U8(a){return[a.extensionDerivatives||!!a.envMapCubeUVHeight||a.bumpMap||a.tangentSpaceNormalMap||a.clearcoatNormalMap||a.flatShading||a.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(a.extensionFragDepth||a.logarithmicDepthBuffer)&&a.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",a.extensionDrawBuffers&&a.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(a.extensionShaderTextureLOD||a.envMap||a.transmission)&&a.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(mm).join(`
`)}function z8(a){const e=[];for(const t in a){const n=a[t];n!==!1&&e.push("#define "+t+" "+n)}return e.join(`
`)}function G8(a,e){const t={},n=a.getProgramParameter(e,35721);for(let i=0;i<n;i++){const r=a.getActiveAttrib(e,i),o=r.name;let l=1;r.type===35674&&(l=2),r.type===35675&&(l=3),r.type===35676&&(l=4),t[o]={type:r.type,location:a.getAttribLocation(e,o),locationSize:l}}return t}function mm(a){return a!==""}function kI(a,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return a.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function NI(a,e){return a.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const H8=/^[ \t]*#include +<([\w\d./]+)>/gm;function sE(a){return a.replace(H8,V8)}function V8(a,e){const t=qn[e];if(t===void 0)throw new Error("Can not resolve #include <"+e+">");return sE(t)}const W8=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function UI(a){return a.replace(W8,Q8)}function Q8(a,e,t,n){let i="";for(let r=parseInt(e);r<parseInt(t);r++)i+=n.replace(/\[\s*i\s*\]/g,"[ "+r+" ]").replace(/UNROLLED_LOOP_INDEX/g,r);return i}function zI(a){let e="precision "+a.precision+` float;
precision `+a.precision+" int;";return a.precision==="highp"?e+=`
#define HIGH_PRECISION`:a.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:a.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function j8(a){let e="SHADOWMAP_TYPE_BASIC";return a.shadowMapType===JE?e="SHADOWMAP_TYPE_PCF":a.shadowMapType===ZE?e="SHADOWMAP_TYPE_PCF_SOFT":a.shadowMapType===$d&&(e="SHADOWMAP_TYPE_VSM"),e}function q8(a){let e="ENVMAP_TYPE_CUBE";if(a.envMap)switch(a.envMapMode){case jl:case ql:e="ENVMAP_TYPE_CUBE";break;case Mf:e="ENVMAP_TYPE_CUBE_UV";break}return e}function X8(a){let e="ENVMAP_MODE_REFLECTION";if(a.envMap)switch(a.envMapMode){case ql:e="ENVMAP_MODE_REFRACTION";break}return e}function Y8(a){let e="ENVMAP_BLENDING_NONE";if(a.envMap)switch(a.combine){case dg:e="ENVMAP_BLENDING_MULTIPLY";break;case QB:e="ENVMAP_BLENDING_MIX";break;case jB:e="ENVMAP_BLENDING_ADD";break}return e}function J8(a){const e=a.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:n,maxMip:t}}function Z8(a,e,t,n){const i=a.getContext(),r=t.defines;let o=t.vertexShader,l=t.fragmentShader;const h=j8(t),u=q8(t),f=X8(t),g=Y8(t),m=J8(t),A=t.isWebGL2?"":U8(t),v=z8(r),w=i.createProgram();let b,S,R=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(b=[v].filter(mm).join(`
`),b.length>0&&(b+=`
`),S=[A,v].filter(mm).join(`
`),S.length>0&&(S+=`
`)):(b=[zI(t),"#define SHADER_NAME "+t.shaderName,v,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.supportsVertexTextures?"#define VERTEX_TEXTURES":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+f:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.displacementMap&&t.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEENCOLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors&&t.isWebGL2?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+h:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(mm).join(`
`),S=[A,zI(t),"#define SHADER_NAME "+t.shaderName,v,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.envMap?"#define "+f:"",t.envMap?"#define "+g:"",m?"#define CUBEUV_TEXEL_WIDTH "+m.texelWidth:"",m?"#define CUBEUV_TEXEL_HEIGHT "+m.texelHeight:"",m?"#define CUBEUV_MAX_MIP "+m.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEENCOLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+h:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==ca?"#define TONE_MAPPING":"",t.toneMapping!==ca?qn.tonemapping_pars_fragment:"",t.toneMapping!==ca?N8("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",qn.encodings_pars_fragment,k8("linearToOutputTexel",t.outputEncoding),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(mm).join(`
`)),o=sE(o),o=kI(o,t),o=NI(o,t),l=sE(l),l=kI(l,t),l=NI(l,t),o=UI(o),l=UI(l),t.isWebGL2&&t.isRawShaderMaterial!==!0&&(R=`#version 300 es
`,b=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+b,S=["#define varying in",t.glslVersion===tE?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===tE?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+S);const M=R+b+o,I=R+S+l,T=OI(i,35633,M),B=OI(i,35632,I);if(i.attachShader(w,T),i.attachShader(w,B),t.index0AttributeName!==void 0?i.bindAttribLocation(w,0,t.index0AttributeName):t.morphTargets===!0&&i.bindAttribLocation(w,0,"position"),i.linkProgram(w),a.debug.checkShaderErrors){const U=i.getProgramInfoLog(w).trim(),W=i.getShaderInfoLog(T).trim(),J=i.getShaderInfoLog(B).trim();let ee=!0,Q=!0;if(i.getProgramParameter(w,35714)===!1){ee=!1;const Y=FI(i,T,"vertex"),se=FI(i,B,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(w,35715)+`

Program Info Log: `+U+`
`+Y+`
`+se)}else U!==""?console.warn("THREE.WebGLProgram: Program Info Log:",U):(W===""||J==="")&&(Q=!1);Q&&(this.diagnostics={runnable:ee,programLog:U,vertexShader:{log:W,prefix:b},fragmentShader:{log:J,prefix:S}})}i.deleteShader(T),i.deleteShader(B);let F;this.getUniforms=function(){return F===void 0&&(F=new E_(i,w)),F};let D;return this.getAttributes=function(){return D===void 0&&(D=G8(i,w)),D},this.destroy=function(){n.releaseStatesOfProgram(this),i.deleteProgram(w),this.program=void 0},this.name=t.shaderName,this.id=D8++,this.cacheKey=e,this.usedTimes=1,this.program=w,this.vertexShader=T,this.fragmentShader=B,this}let K8=0;class $8{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,i=this._getShaderStage(t),r=this._getShaderStage(n),o=this._getShaderCacheForMaterial(e);return o.has(i)===!1&&(o.add(i),i.usedTimes++),o.has(r)===!1&&(o.add(r),r.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,n.usedTimes===0&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return n===void 0&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return n===void 0&&(n=new e6(e),t.set(e,n)),n}}class e6{constructor(e){this.id=K8++,this.code=e,this.usedTimes=0}}function t6(a,e,t,n,i,r,o){const l=new Va,h=new $8,u=[],f=i.isWebGL2,g=i.logarithmicDepthBuffer,m=i.vertexTextures;let A=i.precision;const v={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function w(D,U,W,J,ee){const Q=J.fog,Y=ee.geometry,se=D.isMeshStandardMaterial?J.environment:null,ae=(D.isMeshStandardMaterial?t:e).get(D.envMap||se),ve=!!ae&&ae.mapping===Mf?ae.image.height:null,xe=v[D.type];D.precision!==null&&(A=i.getMaxPrecision(D.precision),A!==D.precision&&console.warn("THREE.WebGLProgram.getParameters:",D.precision,"not supported, using",A,"instead."));const Ae=Y.morphAttributes.position||Y.morphAttributes.normal||Y.morphAttributes.color,Me=Ae!==void 0?Ae.length:0;let Be=0;Y.morphAttributes.position!==void 0&&(Be=1),Y.morphAttributes.normal!==void 0&&(Be=2),Y.morphAttributes.color!==void 0&&(Be=3);let Le,$e,yt,Nt;if(xe){const yn=na[xe];Le=yn.vertexShader,$e=yn.fragmentShader}else Le=D.vertexShader,$e=D.fragmentShader,h.update(D),yt=h.getVertexShaderID(D),Nt=h.getFragmentShaderID(D);const He=a.getRenderTarget(),mn=D.alphaTest>0,Xt=D.clearcoat>0,pn=D.iridescence>0;return{isWebGL2:f,shaderID:xe,shaderName:D.type,vertexShader:Le,fragmentShader:$e,defines:D.defines,customVertexShaderID:yt,customFragmentShaderID:Nt,isRawShaderMaterial:D.isRawShaderMaterial===!0,glslVersion:D.glslVersion,precision:A,instancing:ee.isInstancedMesh===!0,instancingColor:ee.isInstancedMesh===!0&&ee.instanceColor!==null,supportsVertexTextures:m,outputEncoding:He===null?a.outputEncoding:He.isXRRenderTarget===!0?He.texture.encoding:pr,map:!!D.map,matcap:!!D.matcap,envMap:!!ae,envMapMode:ae&&ae.mapping,envMapCubeUVHeight:ve,lightMap:!!D.lightMap,aoMap:!!D.aoMap,emissiveMap:!!D.emissiveMap,bumpMap:!!D.bumpMap,normalMap:!!D.normalMap,objectSpaceNormalMap:D.normalMapType===uL,tangentSpaceNormalMap:D.normalMapType===Gc,decodeVideoTexture:!!D.map&&D.map.isVideoTexture===!0&&D.map.encoding===Gn,clearcoat:Xt,clearcoatMap:Xt&&!!D.clearcoatMap,clearcoatRoughnessMap:Xt&&!!D.clearcoatRoughnessMap,clearcoatNormalMap:Xt&&!!D.clearcoatNormalMap,iridescence:pn,iridescenceMap:pn&&!!D.iridescenceMap,iridescenceThicknessMap:pn&&!!D.iridescenceThicknessMap,displacementMap:!!D.displacementMap,roughnessMap:!!D.roughnessMap,metalnessMap:!!D.metalnessMap,specularMap:!!D.specularMap,specularIntensityMap:!!D.specularIntensityMap,specularColorMap:!!D.specularColorMap,opaque:D.transparent===!1&&D.blending===gu,alphaMap:!!D.alphaMap,alphaTest:mn,gradientMap:!!D.gradientMap,sheen:D.sheen>0,sheenColorMap:!!D.sheenColorMap,sheenRoughnessMap:!!D.sheenRoughnessMap,transmission:D.transmission>0,transmissionMap:!!D.transmissionMap,thicknessMap:!!D.thicknessMap,combine:D.combine,vertexTangents:!!D.normalMap&&!!Y.attributes.tangent,vertexColors:D.vertexColors,vertexAlphas:D.vertexColors===!0&&!!Y.attributes.color&&Y.attributes.color.itemSize===4,vertexUvs:!!D.map||!!D.bumpMap||!!D.normalMap||!!D.specularMap||!!D.alphaMap||!!D.emissiveMap||!!D.roughnessMap||!!D.metalnessMap||!!D.clearcoatMap||!!D.clearcoatRoughnessMap||!!D.clearcoatNormalMap||!!D.iridescenceMap||!!D.iridescenceThicknessMap||!!D.displacementMap||!!D.transmissionMap||!!D.thicknessMap||!!D.specularIntensityMap||!!D.specularColorMap||!!D.sheenColorMap||!!D.sheenRoughnessMap,uvsVertexOnly:!(!!D.map||!!D.bumpMap||!!D.normalMap||!!D.specularMap||!!D.alphaMap||!!D.emissiveMap||!!D.roughnessMap||!!D.metalnessMap||!!D.clearcoatNormalMap||!!D.iridescenceMap||!!D.iridescenceThicknessMap||D.transmission>0||!!D.transmissionMap||!!D.thicknessMap||!!D.specularIntensityMap||!!D.specularColorMap||D.sheen>0||!!D.sheenColorMap||!!D.sheenRoughnessMap)&&!!D.displacementMap,fog:!!Q,useFog:D.fog===!0,fogExp2:Q&&Q.isFogExp2,flatShading:!!D.flatShading,sizeAttenuation:D.sizeAttenuation,logarithmicDepthBuffer:g,skinning:ee.isSkinnedMesh===!0,morphTargets:Y.morphAttributes.position!==void 0,morphNormals:Y.morphAttributes.normal!==void 0,morphColors:Y.morphAttributes.color!==void 0,morphTargetsCount:Me,morphTextureStride:Be,numDirLights:U.directional.length,numPointLights:U.point.length,numSpotLights:U.spot.length,numSpotLightMaps:U.spotLightMap.length,numRectAreaLights:U.rectArea.length,numHemiLights:U.hemi.length,numDirLightShadows:U.directionalShadowMap.length,numPointLightShadows:U.pointShadowMap.length,numSpotLightShadows:U.spotShadowMap.length,numSpotLightShadowsWithMaps:U.numSpotLightShadowsWithMaps,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:D.dithering,shadowMapEnabled:a.shadowMap.enabled&&W.length>0,shadowMapType:a.shadowMap.type,toneMapping:D.toneMapped?a.toneMapping:ca,physicallyCorrectLights:a.physicallyCorrectLights,premultipliedAlpha:D.premultipliedAlpha,doubleSided:D.side===er,flipSided:D.side===Ur,useDepthPacking:!!D.depthPacking,depthPacking:D.depthPacking||0,index0AttributeName:D.index0AttributeName,extensionDerivatives:D.extensions&&D.extensions.derivatives,extensionFragDepth:D.extensions&&D.extensions.fragDepth,extensionDrawBuffers:D.extensions&&D.extensions.drawBuffers,extensionShaderTextureLOD:D.extensions&&D.extensions.shaderTextureLOD,rendererExtensionFragDepth:f||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:f||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:f||n.has("EXT_shader_texture_lod"),customProgramCacheKey:D.customProgramCacheKey()}}function b(D){const U=[];if(D.shaderID?U.push(D.shaderID):(U.push(D.customVertexShaderID),U.push(D.customFragmentShaderID)),D.defines!==void 0)for(const W in D.defines)U.push(W),U.push(D.defines[W]);return D.isRawShaderMaterial===!1&&(S(U,D),R(U,D),U.push(a.outputEncoding)),U.push(D.customProgramCacheKey),U.join()}function S(D,U){D.push(U.precision),D.push(U.outputEncoding),D.push(U.envMapMode),D.push(U.envMapCubeUVHeight),D.push(U.combine),D.push(U.vertexUvs),D.push(U.fogExp2),D.push(U.sizeAttenuation),D.push(U.morphTargetsCount),D.push(U.morphAttributeCount),D.push(U.numDirLights),D.push(U.numPointLights),D.push(U.numSpotLights),D.push(U.numSpotLightMaps),D.push(U.numHemiLights),D.push(U.numRectAreaLights),D.push(U.numDirLightShadows),D.push(U.numPointLightShadows),D.push(U.numSpotLightShadows),D.push(U.numSpotLightShadowsWithMaps),D.push(U.shadowMapType),D.push(U.toneMapping),D.push(U.numClippingPlanes),D.push(U.numClipIntersection),D.push(U.depthPacking)}function R(D,U){l.disableAll(),U.isWebGL2&&l.enable(0),U.supportsVertexTextures&&l.enable(1),U.instancing&&l.enable(2),U.instancingColor&&l.enable(3),U.map&&l.enable(4),U.matcap&&l.enable(5),U.envMap&&l.enable(6),U.lightMap&&l.enable(7),U.aoMap&&l.enable(8),U.emissiveMap&&l.enable(9),U.bumpMap&&l.enable(10),U.normalMap&&l.enable(11),U.objectSpaceNormalMap&&l.enable(12),U.tangentSpaceNormalMap&&l.enable(13),U.clearcoat&&l.enable(14),U.clearcoatMap&&l.enable(15),U.clearcoatRoughnessMap&&l.enable(16),U.clearcoatNormalMap&&l.enable(17),U.iridescence&&l.enable(18),U.iridescenceMap&&l.enable(19),U.iridescenceThicknessMap&&l.enable(20),U.displacementMap&&l.enable(21),U.specularMap&&l.enable(22),U.roughnessMap&&l.enable(23),U.metalnessMap&&l.enable(24),U.gradientMap&&l.enable(25),U.alphaMap&&l.enable(26),U.alphaTest&&l.enable(27),U.vertexColors&&l.enable(28),U.vertexAlphas&&l.enable(29),U.vertexUvs&&l.enable(30),U.vertexTangents&&l.enable(31),U.uvsVertexOnly&&l.enable(32),D.push(l.mask),l.disableAll(),U.fog&&l.enable(0),U.useFog&&l.enable(1),U.flatShading&&l.enable(2),U.logarithmicDepthBuffer&&l.enable(3),U.skinning&&l.enable(4),U.morphTargets&&l.enable(5),U.morphNormals&&l.enable(6),U.morphColors&&l.enable(7),U.premultipliedAlpha&&l.enable(8),U.shadowMapEnabled&&l.enable(9),U.physicallyCorrectLights&&l.enable(10),U.doubleSided&&l.enable(11),U.flipSided&&l.enable(12),U.useDepthPacking&&l.enable(13),U.dithering&&l.enable(14),U.specularIntensityMap&&l.enable(15),U.specularColorMap&&l.enable(16),U.transmission&&l.enable(17),U.transmissionMap&&l.enable(18),U.thicknessMap&&l.enable(19),U.sheen&&l.enable(20),U.sheenColorMap&&l.enable(21),U.sheenRoughnessMap&&l.enable(22),U.decodeVideoTexture&&l.enable(23),U.opaque&&l.enable(24),D.push(l.mask)}function M(D){const U=v[D.type];let W;if(U){const J=na[U];W=dC.clone(J.uniforms)}else W=D.uniforms;return W}function I(D,U){let W;for(let J=0,ee=u.length;J<ee;J++){const Q=u[J];if(Q.cacheKey===U){W=Q,++W.usedTimes;break}}return W===void 0&&(W=new Z8(a,U,D,r),u.push(W)),W}function T(D){if(--D.usedTimes===0){const U=u.indexOf(D);u[U]=u[u.length-1],u.pop(),D.destroy()}}function B(D){h.remove(D)}function F(){h.dispose()}return{getParameters:w,getProgramCacheKey:b,getUniforms:M,acquireProgram:I,releaseProgram:T,releaseShaderCache:B,programs:u,dispose:F}}function n6(){let a=new WeakMap;function e(r){let o=a.get(r);return o===void 0&&(o={},a.set(r,o)),o}function t(r){a.delete(r)}function n(r,o,l){a.get(r)[o]=l}function i(){a=new WeakMap}return{get:e,remove:t,update:n,dispose:i}}function i6(a,e){return a.groupOrder!==e.groupOrder?a.groupOrder-e.groupOrder:a.renderOrder!==e.renderOrder?a.renderOrder-e.renderOrder:a.material.id!==e.material.id?a.material.id-e.material.id:a.z!==e.z?a.z-e.z:a.id-e.id}function GI(a,e){return a.groupOrder!==e.groupOrder?a.groupOrder-e.groupOrder:a.renderOrder!==e.renderOrder?a.renderOrder-e.renderOrder:a.z!==e.z?e.z-a.z:a.id-e.id}function HI(){const a=[];let e=0;const t=[],n=[],i=[];function r(){e=0,t.length=0,n.length=0,i.length=0}function o(g,m,A,v,w,b){let S=a[e];return S===void 0?(S={id:g.id,object:g,geometry:m,material:A,groupOrder:v,renderOrder:g.renderOrder,z:w,group:b},a[e]=S):(S.id=g.id,S.object=g,S.geometry=m,S.material=A,S.groupOrder=v,S.renderOrder=g.renderOrder,S.z=w,S.group=b),e++,S}function l(g,m,A,v,w,b){const S=o(g,m,A,v,w,b);A.transmission>0?n.push(S):A.transparent===!0?i.push(S):t.push(S)}function h(g,m,A,v,w,b){const S=o(g,m,A,v,w,b);A.transmission>0?n.unshift(S):A.transparent===!0?i.unshift(S):t.unshift(S)}function u(g,m){t.length>1&&t.sort(g||i6),n.length>1&&n.sort(m||GI),i.length>1&&i.sort(m||GI)}function f(){for(let g=e,m=a.length;g<m;g++){const A=a[g];if(A.id===null)break;A.id=null,A.object=null,A.geometry=null,A.material=null,A.group=null}}return{opaque:t,transmissive:n,transparent:i,init:r,push:l,unshift:h,finish:f,sort:u}}function s6(){let a=new WeakMap;function e(n,i){const r=a.get(n);let o;return r===void 0?(o=new HI,a.set(n,[o])):i>=r.length?(o=new HI,r.push(o)):o=r[i],o}function t(){a=new WeakMap}return{get:e,dispose:t}}function r6(){const a={};return{get:function(e){if(a[e.id]!==void 0)return a[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new q,color:new _e};break;case"SpotLight":t={position:new q,direction:new q,color:new _e,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new q,color:new _e,distance:0,decay:0};break;case"HemisphereLight":t={direction:new q,skyColor:new _e,groundColor:new _e};break;case"RectAreaLight":t={color:new _e,position:new q,halfWidth:new q,halfHeight:new q};break}return a[e.id]=t,t}}}function o6(){const a={};return{get:function(e){if(a[e.id]!==void 0)return a[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Xe};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Xe};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Xe,shadowCameraNear:1,shadowCameraFar:1e3};break}return a[e.id]=t,t}}}let a6=0;function c6(a,e){return(e.castShadow?2:0)-(a.castShadow?2:0)+(e.map?1:0)-(a.map?1:0)}function l6(a,e){const t=new r6,n=o6(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let f=0;f<9;f++)i.probe.push(new q);const r=new q,o=new xn,l=new xn;function h(f,g){let m=0,A=0,v=0;for(let J=0;J<9;J++)i.probe[J].set(0,0,0);let w=0,b=0,S=0,R=0,M=0,I=0,T=0,B=0,F=0,D=0;f.sort(c6);const U=g!==!0?Math.PI:1;for(let J=0,ee=f.length;J<ee;J++){const Q=f[J],Y=Q.color,se=Q.intensity,ae=Q.distance,ve=Q.shadow&&Q.shadow.map?Q.shadow.map.texture:null;if(Q.isAmbientLight)m+=Y.r*se*U,A+=Y.g*se*U,v+=Y.b*se*U;else if(Q.isLightProbe)for(let xe=0;xe<9;xe++)i.probe[xe].addScaledVector(Q.sh.coefficients[xe],se);else if(Q.isDirectionalLight){const xe=t.get(Q);if(xe.color.copy(Q.color).multiplyScalar(Q.intensity*U),Q.castShadow){const Ae=Q.shadow,Me=n.get(Q);Me.shadowBias=Ae.bias,Me.shadowNormalBias=Ae.normalBias,Me.shadowRadius=Ae.radius,Me.shadowMapSize=Ae.mapSize,i.directionalShadow[w]=Me,i.directionalShadowMap[w]=ve,i.directionalShadowMatrix[w]=Q.shadow.matrix,I++}i.directional[w]=xe,w++}else if(Q.isSpotLight){const xe=t.get(Q);xe.position.setFromMatrixPosition(Q.matrixWorld),xe.color.copy(Y).multiplyScalar(se*U),xe.distance=ae,xe.coneCos=Math.cos(Q.angle),xe.penumbraCos=Math.cos(Q.angle*(1-Q.penumbra)),xe.decay=Q.decay,i.spot[S]=xe;const Ae=Q.shadow;if(Q.map&&(i.spotLightMap[F]=Q.map,F++,Ae.updateMatrices(Q),Q.castShadow&&D++),i.spotLightMatrix[S]=Ae.matrix,Q.castShadow){const Me=n.get(Q);Me.shadowBias=Ae.bias,Me.shadowNormalBias=Ae.normalBias,Me.shadowRadius=Ae.radius,Me.shadowMapSize=Ae.mapSize,i.spotShadow[S]=Me,i.spotShadowMap[S]=ve,B++}S++}else if(Q.isRectAreaLight){const xe=t.get(Q);xe.color.copy(Y).multiplyScalar(se),xe.halfWidth.set(Q.width*.5,0,0),xe.halfHeight.set(0,Q.height*.5,0),i.rectArea[R]=xe,R++}else if(Q.isPointLight){const xe=t.get(Q);if(xe.color.copy(Q.color).multiplyScalar(Q.intensity*U),xe.distance=Q.distance,xe.decay=Q.decay,Q.castShadow){const Ae=Q.shadow,Me=n.get(Q);Me.shadowBias=Ae.bias,Me.shadowNormalBias=Ae.normalBias,Me.shadowRadius=Ae.radius,Me.shadowMapSize=Ae.mapSize,Me.shadowCameraNear=Ae.camera.near,Me.shadowCameraFar=Ae.camera.far,i.pointShadow[b]=Me,i.pointShadowMap[b]=ve,i.pointShadowMatrix[b]=Q.shadow.matrix,T++}i.point[b]=xe,b++}else if(Q.isHemisphereLight){const xe=t.get(Q);xe.skyColor.copy(Q.color).multiplyScalar(se*U),xe.groundColor.copy(Q.groundColor).multiplyScalar(se*U),i.hemi[M]=xe,M++}}R>0&&(e.isWebGL2||a.has("OES_texture_float_linear")===!0?(i.rectAreaLTC1=Gt.LTC_FLOAT_1,i.rectAreaLTC2=Gt.LTC_FLOAT_2):a.has("OES_texture_half_float_linear")===!0?(i.rectAreaLTC1=Gt.LTC_HALF_1,i.rectAreaLTC2=Gt.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),i.ambient[0]=m,i.ambient[1]=A,i.ambient[2]=v;const W=i.hash;(W.directionalLength!==w||W.pointLength!==b||W.spotLength!==S||W.rectAreaLength!==R||W.hemiLength!==M||W.numDirectionalShadows!==I||W.numPointShadows!==T||W.numSpotShadows!==B||W.numSpotMaps!==F)&&(i.directional.length=w,i.spot.length=S,i.rectArea.length=R,i.point.length=b,i.hemi.length=M,i.directionalShadow.length=I,i.directionalShadowMap.length=I,i.pointShadow.length=T,i.pointShadowMap.length=T,i.spotShadow.length=B,i.spotShadowMap.length=B,i.directionalShadowMatrix.length=I,i.pointShadowMatrix.length=T,i.spotLightMatrix.length=B+F-D,i.spotLightMap.length=F,i.numSpotLightShadowsWithMaps=D,W.directionalLength=w,W.pointLength=b,W.spotLength=S,W.rectAreaLength=R,W.hemiLength=M,W.numDirectionalShadows=I,W.numPointShadows=T,W.numSpotShadows=B,W.numSpotMaps=F,i.version=a6++)}function u(f,g){let m=0,A=0,v=0,w=0,b=0;const S=g.matrixWorldInverse;for(let R=0,M=f.length;R<M;R++){const I=f[R];if(I.isDirectionalLight){const T=i.directional[m];T.direction.setFromMatrixPosition(I.matrixWorld),r.setFromMatrixPosition(I.target.matrixWorld),T.direction.sub(r),T.direction.transformDirection(S),m++}else if(I.isSpotLight){const T=i.spot[v];T.position.setFromMatrixPosition(I.matrixWorld),T.position.applyMatrix4(S),T.direction.setFromMatrixPosition(I.matrixWorld),r.setFromMatrixPosition(I.target.matrixWorld),T.direction.sub(r),T.direction.transformDirection(S),v++}else if(I.isRectAreaLight){const T=i.rectArea[w];T.position.setFromMatrixPosition(I.matrixWorld),T.position.applyMatrix4(S),l.identity(),o.copy(I.matrixWorld),o.premultiply(S),l.extractRotation(o),T.halfWidth.set(I.width*.5,0,0),T.halfHeight.set(0,I.height*.5,0),T.halfWidth.applyMatrix4(l),T.halfHeight.applyMatrix4(l),w++}else if(I.isPointLight){const T=i.point[A];T.position.setFromMatrixPosition(I.matrixWorld),T.position.applyMatrix4(S),A++}else if(I.isHemisphereLight){const T=i.hemi[b];T.direction.setFromMatrixPosition(I.matrixWorld),T.direction.transformDirection(S),b++}}}return{setup:h,setupView:u,state:i}}function VI(a,e){const t=new l6(a,e),n=[],i=[];function r(){n.length=0,i.length=0}function o(g){n.push(g)}function l(g){i.push(g)}function h(g){t.setup(n,g)}function u(g){t.setupView(n,g)}return{init:r,state:{lightsArray:n,shadowsArray:i,lights:t},setupLights:h,setupLightsView:u,pushLight:o,pushShadow:l}}function h6(a,e){let t=new WeakMap;function n(r,o){const l=t.get(r);let h;return l===void 0?(h=new VI(a,e),t.set(r,[h])):o>=l.length?(h=new VI(a,e),l.push(h)):h=l[o],h}function i(){t=new WeakMap}return{get:n,dispose:i}}class mC extends Ts{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=lL,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class gC extends Ts{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new q,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const u6=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,d6=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function f6(a,e,t){let n=new Iy;const i=new Xe,r=new Xe,o=new On,l=new mC({depthPacking:hL}),h=new gC,u={},f=t.maxTextureSize,g={0:Ur,1:Oo,2:er},m=new nr({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Xe},radius:{value:4}},vertexShader:u6,fragmentShader:d6}),A=m.clone();A.defines.HORIZONTAL_PASS=1;const v=new Sn;v.setAttribute("position",new Jn(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const w=new _t(v,m),b=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=JE,this.render=function(I,T,B){if(b.enabled===!1||b.autoUpdate===!1&&b.needsUpdate===!1||I.length===0)return;const F=a.getRenderTarget(),D=a.getActiveCubeFace(),U=a.getActiveMipmapLevel(),W=a.state;W.setBlending(Lc),W.buffers.color.setClear(1,1,1,1),W.buffers.depth.setTest(!0),W.setScissorTest(!1);for(let J=0,ee=I.length;J<ee;J++){const Q=I[J],Y=Q.shadow;if(Y===void 0){console.warn("THREE.WebGLShadowMap:",Q,"has no shadow.");continue}if(Y.autoUpdate===!1&&Y.needsUpdate===!1)continue;i.copy(Y.mapSize);const se=Y.getFrameExtents();if(i.multiply(se),r.copy(Y.mapSize),(i.x>f||i.y>f)&&(i.x>f&&(r.x=Math.floor(f/se.x),i.x=r.x*se.x,Y.mapSize.x=r.x),i.y>f&&(r.y=Math.floor(f/se.y),i.y=r.y*se.y,Y.mapSize.y=r.y)),Y.map===null){const ve=this.type!==$d?{minFilter:Ki,magFilter:Ki}:{};Y.map=new Hr(i.x,i.y,ve),Y.map.texture.name=Q.name+".shadowMap",Y.camera.updateProjectionMatrix()}a.setRenderTarget(Y.map),a.clear();const ae=Y.getViewportCount();for(let ve=0;ve<ae;ve++){const xe=Y.getViewport(ve);o.set(r.x*xe.x,r.y*xe.y,r.x*xe.z,r.y*xe.w),W.viewport(o),Y.updateMatrices(Q,ve),n=Y.getFrustum(),M(T,B,Y.camera,Q,this.type)}Y.isPointLightShadow!==!0&&this.type===$d&&S(Y,B),Y.needsUpdate=!1}b.needsUpdate=!1,a.setRenderTarget(F,D,U)};function S(I,T){const B=e.update(w);m.defines.VSM_SAMPLES!==I.blurSamples&&(m.defines.VSM_SAMPLES=I.blurSamples,A.defines.VSM_SAMPLES=I.blurSamples,m.needsUpdate=!0,A.needsUpdate=!0),I.mapPass===null&&(I.mapPass=new Hr(i.x,i.y)),m.uniforms.shadow_pass.value=I.map.texture,m.uniforms.resolution.value=I.mapSize,m.uniforms.radius.value=I.radius,a.setRenderTarget(I.mapPass),a.clear(),a.renderBufferDirect(T,null,B,m,w,null),A.uniforms.shadow_pass.value=I.mapPass.texture,A.uniforms.resolution.value=I.mapSize,A.uniforms.radius.value=I.radius,a.setRenderTarget(I.map),a.clear(),a.renderBufferDirect(T,null,B,A,w,null)}function R(I,T,B,F,D,U){let W=null;const J=B.isPointLight===!0?I.customDistanceMaterial:I.customDepthMaterial;if(J!==void 0?W=J:W=B.isPointLight===!0?h:l,a.localClippingEnabled&&T.clipShadows===!0&&Array.isArray(T.clippingPlanes)&&T.clippingPlanes.length!==0||T.displacementMap&&T.displacementScale!==0||T.alphaMap&&T.alphaTest>0){const ee=W.uuid,Q=T.uuid;let Y=u[ee];Y===void 0&&(Y={},u[ee]=Y);let se=Y[Q];se===void 0&&(se=W.clone(),Y[Q]=se),W=se}return W.visible=T.visible,W.wireframe=T.wireframe,U===$d?W.side=T.shadowSide!==null?T.shadowSide:T.side:W.side=T.shadowSide!==null?T.shadowSide:g[T.side],W.alphaMap=T.alphaMap,W.alphaTest=T.alphaTest,W.clipShadows=T.clipShadows,W.clippingPlanes=T.clippingPlanes,W.clipIntersection=T.clipIntersection,W.displacementMap=T.displacementMap,W.displacementScale=T.displacementScale,W.displacementBias=T.displacementBias,W.wireframeLinewidth=T.wireframeLinewidth,W.linewidth=T.linewidth,B.isPointLight===!0&&W.isMeshDistanceMaterial===!0&&(W.referencePosition.setFromMatrixPosition(B.matrixWorld),W.nearDistance=F,W.farDistance=D),W}function M(I,T,B,F,D){if(I.visible===!1)return;if(I.layers.test(T.layers)&&(I.isMesh||I.isLine||I.isPoints)&&(I.castShadow||I.receiveShadow&&D===$d)&&(!I.frustumCulled||n.intersectsObject(I))){I.modelViewMatrix.multiplyMatrices(B.matrixWorldInverse,I.matrixWorld);const J=e.update(I),ee=I.material;if(Array.isArray(ee)){const Q=J.groups;for(let Y=0,se=Q.length;Y<se;Y++){const ae=Q[Y],ve=ee[ae.materialIndex];if(ve&&ve.visible){const xe=R(I,ve,F,B.near,B.far,D);a.renderBufferDirect(B,null,J,xe,I,ae)}}}else if(ee.visible){const Q=R(I,ee,F,B.near,B.far,D);a.renderBufferDirect(B,null,J,Q,I,null)}}const W=I.children;for(let J=0,ee=W.length;J<ee;J++)M(W[J],T,B,F,D)}}function p6(a,e,t){const n=t.isWebGL2;function i(){let Ce=!1;const Rt=new On;let kt=null;const Ie=new On(0,0,0,0);return{setMask:function(Ct){kt!==Ct&&!Ce&&(a.colorMask(Ct,Ct,Ct,Ct),kt=Ct)},setLocked:function(Ct){Ce=Ct},setClear:function(Ct,wn,di,Gi,jr){jr===!0&&(Ct*=Gi,wn*=Gi,di*=Gi),Rt.set(Ct,wn,di,Gi),Ie.equals(Rt)===!1&&(a.clearColor(Ct,wn,di,Gi),Ie.copy(Rt))},reset:function(){Ce=!1,kt=null,Ie.set(-1,0,0,0)}}}function r(){let Ce=!1,Rt=null,kt=null,Ie=null;return{setTest:function(Ct){Ct?mn(2929):Xt(2929)},setMask:function(Ct){Rt!==Ct&&!Ce&&(a.depthMask(Ct),Rt=Ct)},setFunc:function(Ct){if(kt!==Ct){switch(Ct){case NB:a.depthFunc(512);break;case UB:a.depthFunc(519);break;case zB:a.depthFunc(513);break;case H_:a.depthFunc(515);break;case GB:a.depthFunc(514);break;case HB:a.depthFunc(518);break;case VB:a.depthFunc(516);break;case WB:a.depthFunc(517);break;default:a.depthFunc(515)}kt=Ct}},setLocked:function(Ct){Ce=Ct},setClear:function(Ct){Ie!==Ct&&(a.clearDepth(Ct),Ie=Ct)},reset:function(){Ce=!1,Rt=null,kt=null,Ie=null}}}function o(){let Ce=!1,Rt=null,kt=null,Ie=null,Ct=null,wn=null,di=null,Gi=null,jr=null;return{setTest:function(vi){Ce||(vi?mn(2960):Xt(2960))},setMask:function(vi){Rt!==vi&&!Ce&&(a.stencilMask(vi),Rt=vi)},setFunc:function(vi,Ir,js){(kt!==vi||Ie!==Ir||Ct!==js)&&(a.stencilFunc(vi,Ir,js),kt=vi,Ie=Ir,Ct=js)},setOp:function(vi,Ir,js){(wn!==vi||di!==Ir||Gi!==js)&&(a.stencilOp(vi,Ir,js),wn=vi,di=Ir,Gi=js)},setLocked:function(vi){Ce=vi},setClear:function(vi){jr!==vi&&(a.clearStencil(vi),jr=vi)},reset:function(){Ce=!1,Rt=null,kt=null,Ie=null,Ct=null,wn=null,di=null,Gi=null,jr=null}}}const l=new i,h=new r,u=new o,f=new WeakMap,g=new WeakMap;let m={},A={},v=new WeakMap,w=[],b=null,S=!1,R=null,M=null,I=null,T=null,B=null,F=null,D=null,U=!1,W=null,J=null,ee=null,Q=null,Y=null;const se=a.getParameter(35661);let ae=!1,ve=0;const xe=a.getParameter(7938);xe.indexOf("WebGL")!==-1?(ve=parseFloat(/^WebGL (\d)/.exec(xe)[1]),ae=ve>=1):xe.indexOf("OpenGL ES")!==-1&&(ve=parseFloat(/^OpenGL ES (\d)/.exec(xe)[1]),ae=ve>=2);let Ae=null,Me={};const Be=a.getParameter(3088),Le=a.getParameter(2978),$e=new On().fromArray(Be),yt=new On().fromArray(Le);function Nt(Ce,Rt,kt){const Ie=new Uint8Array(4),Ct=a.createTexture();a.bindTexture(Ce,Ct),a.texParameteri(Ce,10241,9728),a.texParameteri(Ce,10240,9728);for(let wn=0;wn<kt;wn++)a.texImage2D(Rt+wn,0,6408,1,1,0,6408,5121,Ie);return Ct}const He={};He[3553]=Nt(3553,3553,1),He[34067]=Nt(34067,34069,6),l.setClear(0,0,0,1),h.setClear(1),u.setClear(0),mn(2929),h.setFunc(H_),Lt(!1),En(Ob),mn(2884),vt(Lc);function mn(Ce){m[Ce]!==!0&&(a.enable(Ce),m[Ce]=!0)}function Xt(Ce){m[Ce]!==!1&&(a.disable(Ce),m[Ce]=!1)}function pn(Ce,Rt){return A[Ce]!==Rt?(a.bindFramebuffer(Ce,Rt),A[Ce]=Rt,n&&(Ce===36009&&(A[36160]=Rt),Ce===36160&&(A[36009]=Rt)),!0):!1}function Ft(Ce,Rt){let kt=w,Ie=!1;if(Ce)if(kt=v.get(Rt),kt===void 0&&(kt=[],v.set(Rt,kt)),Ce.isWebGLMultipleRenderTargets){const Ct=Ce.texture;if(kt.length!==Ct.length||kt[0]!==36064){for(let wn=0,di=Ct.length;wn<di;wn++)kt[wn]=36064+wn;kt.length=Ct.length,Ie=!0}}else kt[0]!==36064&&(kt[0]=36064,Ie=!0);else kt[0]!==1029&&(kt[0]=1029,Ie=!0);Ie&&(t.isWebGL2?a.drawBuffers(kt):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(kt))}function yn(Ce){return b!==Ce?(a.useProgram(Ce),b=Ce,!0):!1}const it={[ru]:32774,[MB]:32778,[TB]:32779};if(n)it[Nb]=32775,it[Ub]=32776;else{const Ce=e.get("EXT_blend_minmax");Ce!==null&&(it[Nb]=Ce.MIN_EXT,it[Ub]=Ce.MAX_EXT)}const tt={[IB]:0,[RB]:1,[PB]:768,[KE]:770,[kB]:776,[OB]:774,[LB]:772,[BB]:769,[$E]:771,[FB]:775,[DB]:773};function vt(Ce,Rt,kt,Ie,Ct,wn,di,Gi){if(Ce===Lc){S===!0&&(Xt(3042),S=!1);return}if(S===!1&&(mn(3042),S=!0),Ce!==SB){if(Ce!==R||Gi!==U){if((M!==ru||B!==ru)&&(a.blendEquation(32774),M=ru,B=ru),Gi)switch(Ce){case gu:a.blendFuncSeparate(1,771,1,771);break;case G_:a.blendFunc(1,1);break;case Fb:a.blendFuncSeparate(0,769,0,1);break;case kb:a.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",Ce);break}else switch(Ce){case gu:a.blendFuncSeparate(770,771,1,771);break;case G_:a.blendFunc(770,1);break;case Fb:a.blendFuncSeparate(0,769,0,1);break;case kb:a.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",Ce);break}I=null,T=null,F=null,D=null,R=Ce,U=Gi}return}Ct=Ct||Rt,wn=wn||kt,di=di||Ie,(Rt!==M||Ct!==B)&&(a.blendEquationSeparate(it[Rt],it[Ct]),M=Rt,B=Ct),(kt!==I||Ie!==T||wn!==F||di!==D)&&(a.blendFuncSeparate(tt[kt],tt[Ie],tt[wn],tt[di]),I=kt,T=Ie,F=wn,D=di),R=Ce,U=null}function Jt(Ce,Rt){Ce.side===er?Xt(2884):mn(2884);let kt=Ce.side===Ur;Rt&&(kt=!kt),Lt(kt),Ce.blending===gu&&Ce.transparent===!1?vt(Lc):vt(Ce.blending,Ce.blendEquation,Ce.blendSrc,Ce.blendDst,Ce.blendEquationAlpha,Ce.blendSrcAlpha,Ce.blendDstAlpha,Ce.premultipliedAlpha),h.setFunc(Ce.depthFunc),h.setTest(Ce.depthTest),h.setMask(Ce.depthWrite),l.setMask(Ce.colorWrite);const Ie=Ce.stencilWrite;u.setTest(Ie),Ie&&(u.setMask(Ce.stencilWriteMask),u.setFunc(Ce.stencilFunc,Ce.stencilRef,Ce.stencilFuncMask),u.setOp(Ce.stencilFail,Ce.stencilZFail,Ce.stencilZPass)),ln(Ce.polygonOffset,Ce.polygonOffsetFactor,Ce.polygonOffsetUnits),Ce.alphaToCoverage===!0?mn(32926):Xt(32926)}function Lt(Ce){W!==Ce&&(Ce?a.frontFace(2304):a.frontFace(2305),W=Ce)}function En(Ce){Ce!==EB?(mn(2884),Ce!==J&&(Ce===Ob?a.cullFace(1029):Ce===CB?a.cullFace(1028):a.cullFace(1032))):Xt(2884),J=Ce}function Zt(Ce){Ce!==ee&&(ae&&a.lineWidth(Ce),ee=Ce)}function ln(Ce,Rt,kt){Ce?(mn(32823),(Q!==Rt||Y!==kt)&&(a.polygonOffset(Rt,kt),Q=Rt,Y=kt)):Xt(32823)}function ii(Ce){Ce?mn(3089):Xt(3089)}function Zn(Ce){Ce===void 0&&(Ce=33984+se-1),Ae!==Ce&&(a.activeTexture(Ce),Ae=Ce)}function me(Ce,Rt,kt){kt===void 0&&(Ae===null?kt=33984+se-1:kt=Ae);let Ie=Me[kt];Ie===void 0&&(Ie={type:void 0,texture:void 0},Me[kt]=Ie),(Ie.type!==Ce||Ie.texture!==Rt)&&(Ae!==kt&&(a.activeTexture(kt),Ae=kt),a.bindTexture(Ce,Rt||He[Ce]),Ie.type=Ce,Ie.texture=Rt)}function ce(){const Ce=Me[Ae];Ce!==void 0&&Ce.type!==void 0&&(a.bindTexture(Ce.type,null),Ce.type=void 0,Ce.texture=void 0)}function Qe(){try{a.compressedTexImage2D.apply(a,arguments)}catch(Ce){console.error("THREE.WebGLState:",Ce)}}function At(){try{a.texSubImage2D.apply(a,arguments)}catch(Ce){console.error("THREE.WebGLState:",Ce)}}function pt(){try{a.texSubImage3D.apply(a,arguments)}catch(Ce){console.error("THREE.WebGLState:",Ce)}}function zt(){try{a.compressedTexSubImage2D.apply(a,arguments)}catch(Ce){console.error("THREE.WebGLState:",Ce)}}function Mn(){try{a.texStorage2D.apply(a,arguments)}catch(Ce){console.error("THREE.WebGLState:",Ce)}}function we(){try{a.texStorage3D.apply(a,arguments)}catch(Ce){console.error("THREE.WebGLState:",Ce)}}function Fe(){try{a.texImage2D.apply(a,arguments)}catch(Ce){console.error("THREE.WebGLState:",Ce)}}function bt(){try{a.texImage3D.apply(a,arguments)}catch(Ce){console.error("THREE.WebGLState:",Ce)}}function hn(Ce){$e.equals(Ce)===!1&&(a.scissor(Ce.x,Ce.y,Ce.z,Ce.w),$e.copy(Ce))}function nn(Ce){yt.equals(Ce)===!1&&(a.viewport(Ce.x,Ce.y,Ce.z,Ce.w),yt.copy(Ce))}function Ht(Ce,Rt){let kt=g.get(Rt);kt===void 0&&(kt=new WeakMap,g.set(Rt,kt));let Ie=kt.get(Ce);Ie===void 0&&(Ie=a.getUniformBlockIndex(Rt,Ce.name),kt.set(Ce,Ie))}function Bn(Ce,Rt){const Ie=g.get(Rt).get(Ce);f.get(Ce)!==Ie&&(a.uniformBlockBinding(Rt,Ie,Ce.__bindingPointIndex),f.set(Ce,Ie))}function Ln(){a.disable(3042),a.disable(2884),a.disable(2929),a.disable(32823),a.disable(3089),a.disable(2960),a.disable(32926),a.blendEquation(32774),a.blendFunc(1,0),a.blendFuncSeparate(1,0,1,0),a.colorMask(!0,!0,!0,!0),a.clearColor(0,0,0,0),a.depthMask(!0),a.depthFunc(513),a.clearDepth(1),a.stencilMask(4294967295),a.stencilFunc(519,0,4294967295),a.stencilOp(7680,7680,7680),a.clearStencil(0),a.cullFace(1029),a.frontFace(2305),a.polygonOffset(0,0),a.activeTexture(33984),a.bindFramebuffer(36160,null),n===!0&&(a.bindFramebuffer(36009,null),a.bindFramebuffer(36008,null)),a.useProgram(null),a.lineWidth(1),a.scissor(0,0,a.canvas.width,a.canvas.height),a.viewport(0,0,a.canvas.width,a.canvas.height),m={},Ae=null,Me={},A={},v=new WeakMap,w=[],b=null,S=!1,R=null,M=null,I=null,T=null,B=null,F=null,D=null,U=!1,W=null,J=null,ee=null,Q=null,Y=null,$e.set(0,0,a.canvas.width,a.canvas.height),yt.set(0,0,a.canvas.width,a.canvas.height),l.reset(),h.reset(),u.reset()}return{buffers:{color:l,depth:h,stencil:u},enable:mn,disable:Xt,bindFramebuffer:pn,drawBuffers:Ft,useProgram:yn,setBlending:vt,setMaterial:Jt,setFlipSided:Lt,setCullFace:En,setLineWidth:Zt,setPolygonOffset:ln,setScissorTest:ii,activeTexture:Zn,bindTexture:me,unbindTexture:ce,compressedTexImage2D:Qe,texImage2D:Fe,texImage3D:bt,updateUBOMapping:Ht,uniformBlockBinding:Bn,texStorage2D:Mn,texStorage3D:we,texSubImage2D:At,texSubImage3D:pt,compressedTexSubImage2D:zt,scissor:hn,viewport:nn,reset:Ln}}function m6(a,e,t,n,i,r,o){const l=i.isWebGL2,h=i.maxTextures,u=i.maxCubemapSize,f=i.maxTextureSize,g=i.maxSamples,m=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,A=/OculusBrowser/g.test(navigator.userAgent),v=new WeakMap;let w;const b=new WeakMap;let S=!1;try{S=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function R(me,ce){return S?new OffscreenCanvas(me,ce):jm("canvas")}function M(me,ce,Qe,At){let pt=1;if((me.width>At||me.height>At)&&(pt=At/Math.max(me.width,me.height)),pt<1||ce===!0)if(typeof HTMLImageElement<"u"&&me instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&me instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&me instanceof ImageBitmap){const zt=ce?Z_:Math.floor,Mn=zt(pt*me.width),we=zt(pt*me.height);w===void 0&&(w=R(Mn,we));const Fe=Qe?R(Mn,we):w;return Fe.width=Mn,Fe.height=we,Fe.getContext("2d").drawImage(me,0,0,Mn,we),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+me.width+"x"+me.height+") to ("+Mn+"x"+we+")."),Fe}else return"data"in me&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+me.width+"x"+me.height+")."),me;return me}function I(me){return nE(me.width)&&nE(me.height)}function T(me){return l?!1:me.wrapS!==$s||me.wrapT!==$s||me.minFilter!==Ki&&me.minFilter!==yi}function B(me,ce){return me.generateMipmaps&&ce&&me.minFilter!==Ki&&me.minFilter!==yi}function F(me){a.generateMipmap(me)}function D(me,ce,Qe,At,pt=!1){if(l===!1)return ce;if(me!==null){if(a[me]!==void 0)return a[me];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+me+"'")}let zt=ce;return ce===6403&&(Qe===5126&&(zt=33326),Qe===5131&&(zt=33325),Qe===5121&&(zt=33321)),ce===33319&&(Qe===5126&&(zt=33328),Qe===5131&&(zt=33327),Qe===5121&&(zt=33323)),ce===6408&&(Qe===5126&&(zt=34836),Qe===5131&&(zt=34842),Qe===5121&&(zt=At===Gn&&pt===!1?35907:32856),Qe===32819&&(zt=32854),Qe===32820&&(zt=32855)),(zt===33325||zt===33326||zt===33327||zt===33328||zt===34842||zt===34836)&&e.get("EXT_color_buffer_float"),zt}function U(me,ce,Qe){return B(me,Qe)===!0||me.isFramebufferTexture&&me.minFilter!==Ki&&me.minFilter!==yi?Math.log2(Math.max(ce.width,ce.height))+1:me.mipmaps!==void 0&&me.mipmaps.length>0?me.mipmaps.length:me.isCompressedTexture&&Array.isArray(me.image)?ce.mipmaps.length:1}function W(me){return me===Ki||me===Af||me===_f?9728:9729}function J(me){const ce=me.target;ce.removeEventListener("dispose",J),Q(ce),ce.isVideoTexture&&v.delete(ce)}function ee(me){const ce=me.target;ce.removeEventListener("dispose",ee),se(ce)}function Q(me){const ce=n.get(me);if(ce.__webglInit===void 0)return;const Qe=me.source,At=b.get(Qe);if(At){const pt=At[ce.__cacheKey];pt.usedTimes--,pt.usedTimes===0&&Y(me),Object.keys(At).length===0&&b.delete(Qe)}n.remove(me)}function Y(me){const ce=n.get(me);a.deleteTexture(ce.__webglTexture);const Qe=me.source,At=b.get(Qe);delete At[ce.__cacheKey],o.memory.textures--}function se(me){const ce=me.texture,Qe=n.get(me),At=n.get(ce);if(At.__webglTexture!==void 0&&(a.deleteTexture(At.__webglTexture),o.memory.textures--),me.depthTexture&&me.depthTexture.dispose(),me.isWebGLCubeRenderTarget)for(let pt=0;pt<6;pt++)a.deleteFramebuffer(Qe.__webglFramebuffer[pt]),Qe.__webglDepthbuffer&&a.deleteRenderbuffer(Qe.__webglDepthbuffer[pt]);else{if(a.deleteFramebuffer(Qe.__webglFramebuffer),Qe.__webglDepthbuffer&&a.deleteRenderbuffer(Qe.__webglDepthbuffer),Qe.__webglMultisampledFramebuffer&&a.deleteFramebuffer(Qe.__webglMultisampledFramebuffer),Qe.__webglColorRenderbuffer)for(let pt=0;pt<Qe.__webglColorRenderbuffer.length;pt++)Qe.__webglColorRenderbuffer[pt]&&a.deleteRenderbuffer(Qe.__webglColorRenderbuffer[pt]);Qe.__webglDepthRenderbuffer&&a.deleteRenderbuffer(Qe.__webglDepthRenderbuffer)}if(me.isWebGLMultipleRenderTargets)for(let pt=0,zt=ce.length;pt<zt;pt++){const Mn=n.get(ce[pt]);Mn.__webglTexture&&(a.deleteTexture(Mn.__webglTexture),o.memory.textures--),n.remove(ce[pt])}n.remove(ce),n.remove(me)}let ae=0;function ve(){ae=0}function xe(){const me=ae;return me>=h&&console.warn("THREE.WebGLTextures: Trying to use "+me+" texture units while this GPU supports only "+h),ae+=1,me}function Ae(me){const ce=[];return ce.push(me.wrapS),ce.push(me.wrapT),ce.push(me.magFilter),ce.push(me.minFilter),ce.push(me.anisotropy),ce.push(me.internalFormat),ce.push(me.format),ce.push(me.type),ce.push(me.generateMipmaps),ce.push(me.premultiplyAlpha),ce.push(me.flipY),ce.push(me.unpackAlignment),ce.push(me.encoding),ce.join()}function Me(me,ce){const Qe=n.get(me);if(me.isVideoTexture&&ii(me),me.isRenderTargetTexture===!1&&me.version>0&&Qe.__version!==me.version){const At=me.image;if(At===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(At.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Xt(Qe,me,ce);return}}t.bindTexture(3553,Qe.__webglTexture,33984+ce)}function Be(me,ce){const Qe=n.get(me);if(me.version>0&&Qe.__version!==me.version){Xt(Qe,me,ce);return}t.bindTexture(35866,Qe.__webglTexture,33984+ce)}function Le(me,ce){const Qe=n.get(me);if(me.version>0&&Qe.__version!==me.version){Xt(Qe,me,ce);return}t.bindTexture(32879,Qe.__webglTexture,33984+ce)}function $e(me,ce){const Qe=n.get(me);if(me.version>0&&Qe.__version!==me.version){pn(Qe,me,ce);return}t.bindTexture(34067,Qe.__webglTexture,33984+ce)}const yt={[Fc]:10497,[$s]:33071,[Cu]:33648},Nt={[Ki]:9728,[Af]:9984,[_f]:9986,[yi]:9729,[fg]:9985,[fa]:9987};function He(me,ce,Qe){if(Qe?(a.texParameteri(me,10242,yt[ce.wrapS]),a.texParameteri(me,10243,yt[ce.wrapT]),(me===32879||me===35866)&&a.texParameteri(me,32882,yt[ce.wrapR]),a.texParameteri(me,10240,Nt[ce.magFilter]),a.texParameteri(me,10241,Nt[ce.minFilter])):(a.texParameteri(me,10242,33071),a.texParameteri(me,10243,33071),(me===32879||me===35866)&&a.texParameteri(me,32882,33071),(ce.wrapS!==$s||ce.wrapT!==$s)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),a.texParameteri(me,10240,W(ce.magFilter)),a.texParameteri(me,10241,W(ce.minFilter)),ce.minFilter!==Ki&&ce.minFilter!==yi&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),e.has("EXT_texture_filter_anisotropic")===!0){const At=e.get("EXT_texture_filter_anisotropic");if(ce.type===Ms&&e.has("OES_texture_float_linear")===!1||l===!1&&ce.type===Os&&e.has("OES_texture_half_float_linear")===!1)return;(ce.anisotropy>1||n.get(ce).__currentAnisotropy)&&(a.texParameterf(me,At.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(ce.anisotropy,i.getMaxAnisotropy())),n.get(ce).__currentAnisotropy=ce.anisotropy)}}function mn(me,ce){let Qe=!1;me.__webglInit===void 0&&(me.__webglInit=!0,ce.addEventListener("dispose",J));const At=ce.source;let pt=b.get(At);pt===void 0&&(pt={},b.set(At,pt));const zt=Ae(ce);if(zt!==me.__cacheKey){pt[zt]===void 0&&(pt[zt]={texture:a.createTexture(),usedTimes:0},o.memory.textures++,Qe=!0),pt[zt].usedTimes++;const Mn=pt[me.__cacheKey];Mn!==void 0&&(pt[me.__cacheKey].usedTimes--,Mn.usedTimes===0&&Y(ce)),me.__cacheKey=zt,me.__webglTexture=pt[zt].texture}return Qe}function Xt(me,ce,Qe){let At=3553;ce.isDataArrayTexture&&(At=35866),ce.isData3DTexture&&(At=32879);const pt=mn(me,ce),zt=ce.source;t.bindTexture(At,me.__webglTexture,33984+Qe);const Mn=n.get(zt);if(zt.version!==Mn.__version||pt===!0){t.activeTexture(33984+Qe),a.pixelStorei(37440,ce.flipY),a.pixelStorei(37441,ce.premultiplyAlpha),a.pixelStorei(3317,ce.unpackAlignment),a.pixelStorei(37443,0);const we=T(ce)&&I(ce.image)===!1;let Fe=M(ce.image,we,!1,f);Fe=Zn(ce,Fe);const bt=I(Fe)||l,hn=r.convert(ce.format,ce.encoding);let nn=r.convert(ce.type),Ht=D(ce.internalFormat,hn,nn,ce.encoding,ce.isVideoTexture);He(At,ce,bt);let Bn;const Ln=ce.mipmaps,Ce=l&&ce.isVideoTexture!==!0,Rt=Mn.__version===void 0||pt===!0,kt=U(ce,Fe,bt);if(ce.isDepthTexture)Ht=6402,l?ce.type===Ms?Ht=36012:ce.type===Fl?Ht=33190:ce.type===Au?Ht=35056:Ht=33189:ce.type===Ms&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),ce.format===Gl&&Ht===6402&&ce.type!==nC&&ce.type!==Fl&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),ce.type=Fl,nn=r.convert(ce.type)),ce.format===Su&&Ht===6402&&(Ht=34041,ce.type!==Au&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),ce.type=Au,nn=r.convert(ce.type))),Rt&&(Ce?t.texStorage2D(3553,1,Ht,Fe.width,Fe.height):t.texImage2D(3553,0,Ht,Fe.width,Fe.height,0,hn,nn,null));else if(ce.isDataTexture)if(Ln.length>0&&bt){Ce&&Rt&&t.texStorage2D(3553,kt,Ht,Ln[0].width,Ln[0].height);for(let Ie=0,Ct=Ln.length;Ie<Ct;Ie++)Bn=Ln[Ie],Ce?t.texSubImage2D(3553,Ie,0,0,Bn.width,Bn.height,hn,nn,Bn.data):t.texImage2D(3553,Ie,Ht,Bn.width,Bn.height,0,hn,nn,Bn.data);ce.generateMipmaps=!1}else Ce?(Rt&&t.texStorage2D(3553,kt,Ht,Fe.width,Fe.height),t.texSubImage2D(3553,0,0,0,Fe.width,Fe.height,hn,nn,Fe.data)):t.texImage2D(3553,0,Ht,Fe.width,Fe.height,0,hn,nn,Fe.data);else if(ce.isCompressedTexture){Ce&&Rt&&t.texStorage2D(3553,kt,Ht,Ln[0].width,Ln[0].height);for(let Ie=0,Ct=Ln.length;Ie<Ct;Ie++)Bn=Ln[Ie],ce.format!==us?hn!==null?Ce?t.compressedTexSubImage2D(3553,Ie,0,0,Bn.width,Bn.height,hn,Bn.data):t.compressedTexImage2D(3553,Ie,Ht,Bn.width,Bn.height,0,Bn.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Ce?t.texSubImage2D(3553,Ie,0,0,Bn.width,Bn.height,hn,nn,Bn.data):t.texImage2D(3553,Ie,Ht,Bn.width,Bn.height,0,hn,nn,Bn.data)}else if(ce.isDataArrayTexture)Ce?(Rt&&t.texStorage3D(35866,kt,Ht,Fe.width,Fe.height,Fe.depth),t.texSubImage3D(35866,0,0,0,0,Fe.width,Fe.height,Fe.depth,hn,nn,Fe.data)):t.texImage3D(35866,0,Ht,Fe.width,Fe.height,Fe.depth,0,hn,nn,Fe.data);else if(ce.isData3DTexture)Ce?(Rt&&t.texStorage3D(32879,kt,Ht,Fe.width,Fe.height,Fe.depth),t.texSubImage3D(32879,0,0,0,0,Fe.width,Fe.height,Fe.depth,hn,nn,Fe.data)):t.texImage3D(32879,0,Ht,Fe.width,Fe.height,Fe.depth,0,hn,nn,Fe.data);else if(ce.isFramebufferTexture){if(Rt)if(Ce)t.texStorage2D(3553,kt,Ht,Fe.width,Fe.height);else{let Ie=Fe.width,Ct=Fe.height;for(let wn=0;wn<kt;wn++)t.texImage2D(3553,wn,Ht,Ie,Ct,0,hn,nn,null),Ie>>=1,Ct>>=1}}else if(Ln.length>0&&bt){Ce&&Rt&&t.texStorage2D(3553,kt,Ht,Ln[0].width,Ln[0].height);for(let Ie=0,Ct=Ln.length;Ie<Ct;Ie++)Bn=Ln[Ie],Ce?t.texSubImage2D(3553,Ie,0,0,hn,nn,Bn):t.texImage2D(3553,Ie,Ht,hn,nn,Bn);ce.generateMipmaps=!1}else Ce?(Rt&&t.texStorage2D(3553,kt,Ht,Fe.width,Fe.height),t.texSubImage2D(3553,0,0,0,hn,nn,Fe)):t.texImage2D(3553,0,Ht,hn,nn,Fe);B(ce,bt)&&F(At),Mn.__version=zt.version,ce.onUpdate&&ce.onUpdate(ce)}me.__version=ce.version}function pn(me,ce,Qe){if(ce.image.length!==6)return;const At=mn(me,ce),pt=ce.source;t.bindTexture(34067,me.__webglTexture,33984+Qe);const zt=n.get(pt);if(pt.version!==zt.__version||At===!0){t.activeTexture(33984+Qe),a.pixelStorei(37440,ce.flipY),a.pixelStorei(37441,ce.premultiplyAlpha),a.pixelStorei(3317,ce.unpackAlignment),a.pixelStorei(37443,0);const Mn=ce.isCompressedTexture||ce.image[0].isCompressedTexture,we=ce.image[0]&&ce.image[0].isDataTexture,Fe=[];for(let Ie=0;Ie<6;Ie++)!Mn&&!we?Fe[Ie]=M(ce.image[Ie],!1,!0,u):Fe[Ie]=we?ce.image[Ie].image:ce.image[Ie],Fe[Ie]=Zn(ce,Fe[Ie]);const bt=Fe[0],hn=I(bt)||l,nn=r.convert(ce.format,ce.encoding),Ht=r.convert(ce.type),Bn=D(ce.internalFormat,nn,Ht,ce.encoding),Ln=l&&ce.isVideoTexture!==!0,Ce=zt.__version===void 0||At===!0;let Rt=U(ce,bt,hn);He(34067,ce,hn);let kt;if(Mn){Ln&&Ce&&t.texStorage2D(34067,Rt,Bn,bt.width,bt.height);for(let Ie=0;Ie<6;Ie++){kt=Fe[Ie].mipmaps;for(let Ct=0;Ct<kt.length;Ct++){const wn=kt[Ct];ce.format!==us?nn!==null?Ln?t.compressedTexSubImage2D(34069+Ie,Ct,0,0,wn.width,wn.height,nn,wn.data):t.compressedTexImage2D(34069+Ie,Ct,Bn,wn.width,wn.height,0,wn.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Ln?t.texSubImage2D(34069+Ie,Ct,0,0,wn.width,wn.height,nn,Ht,wn.data):t.texImage2D(34069+Ie,Ct,Bn,wn.width,wn.height,0,nn,Ht,wn.data)}}}else{kt=ce.mipmaps,Ln&&Ce&&(kt.length>0&&Rt++,t.texStorage2D(34067,Rt,Bn,Fe[0].width,Fe[0].height));for(let Ie=0;Ie<6;Ie++)if(we){Ln?t.texSubImage2D(34069+Ie,0,0,0,Fe[Ie].width,Fe[Ie].height,nn,Ht,Fe[Ie].data):t.texImage2D(34069+Ie,0,Bn,Fe[Ie].width,Fe[Ie].height,0,nn,Ht,Fe[Ie].data);for(let Ct=0;Ct<kt.length;Ct++){const di=kt[Ct].image[Ie].image;Ln?t.texSubImage2D(34069+Ie,Ct+1,0,0,di.width,di.height,nn,Ht,di.data):t.texImage2D(34069+Ie,Ct+1,Bn,di.width,di.height,0,nn,Ht,di.data)}}else{Ln?t.texSubImage2D(34069+Ie,0,0,0,nn,Ht,Fe[Ie]):t.texImage2D(34069+Ie,0,Bn,nn,Ht,Fe[Ie]);for(let Ct=0;Ct<kt.length;Ct++){const wn=kt[Ct];Ln?t.texSubImage2D(34069+Ie,Ct+1,0,0,nn,Ht,wn.image[Ie]):t.texImage2D(34069+Ie,Ct+1,Bn,nn,Ht,wn.image[Ie])}}}B(ce,hn)&&F(34067),zt.__version=pt.version,ce.onUpdate&&ce.onUpdate(ce)}me.__version=ce.version}function Ft(me,ce,Qe,At,pt){const zt=r.convert(Qe.format,Qe.encoding),Mn=r.convert(Qe.type),we=D(Qe.internalFormat,zt,Mn,Qe.encoding);n.get(ce).__hasExternalTextures||(pt===32879||pt===35866?t.texImage3D(pt,0,we,ce.width,ce.height,ce.depth,0,zt,Mn,null):t.texImage2D(pt,0,we,ce.width,ce.height,0,zt,Mn,null)),t.bindFramebuffer(36160,me),ln(ce)?m.framebufferTexture2DMultisampleEXT(36160,At,pt,n.get(Qe).__webglTexture,0,Zt(ce)):a.framebufferTexture2D(36160,At,pt,n.get(Qe).__webglTexture,0),t.bindFramebuffer(36160,null)}function yn(me,ce,Qe){if(a.bindRenderbuffer(36161,me),ce.depthBuffer&&!ce.stencilBuffer){let At=33189;if(Qe||ln(ce)){const pt=ce.depthTexture;pt&&pt.isDepthTexture&&(pt.type===Ms?At=36012:pt.type===Fl&&(At=33190));const zt=Zt(ce);ln(ce)?m.renderbufferStorageMultisampleEXT(36161,zt,At,ce.width,ce.height):a.renderbufferStorageMultisample(36161,zt,At,ce.width,ce.height)}else a.renderbufferStorage(36161,At,ce.width,ce.height);a.framebufferRenderbuffer(36160,36096,36161,me)}else if(ce.depthBuffer&&ce.stencilBuffer){const At=Zt(ce);Qe&&ln(ce)===!1?a.renderbufferStorageMultisample(36161,At,35056,ce.width,ce.height):ln(ce)?m.renderbufferStorageMultisampleEXT(36161,At,35056,ce.width,ce.height):a.renderbufferStorage(36161,34041,ce.width,ce.height),a.framebufferRenderbuffer(36160,33306,36161,me)}else{const At=ce.isWebGLMultipleRenderTargets===!0?ce.texture:[ce.texture];for(let pt=0;pt<At.length;pt++){const zt=At[pt],Mn=r.convert(zt.format,zt.encoding),we=r.convert(zt.type),Fe=D(zt.internalFormat,Mn,we,zt.encoding),bt=Zt(ce);Qe&&ln(ce)===!1?a.renderbufferStorageMultisample(36161,bt,Fe,ce.width,ce.height):ln(ce)?m.renderbufferStorageMultisampleEXT(36161,bt,Fe,ce.width,ce.height):a.renderbufferStorage(36161,Fe,ce.width,ce.height)}}a.bindRenderbuffer(36161,null)}function it(me,ce){if(ce&&ce.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,me),!(ce.depthTexture&&ce.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!n.get(ce.depthTexture).__webglTexture||ce.depthTexture.image.width!==ce.width||ce.depthTexture.image.height!==ce.height)&&(ce.depthTexture.image.width=ce.width,ce.depthTexture.image.height=ce.height,ce.depthTexture.needsUpdate=!0),Me(ce.depthTexture,0);const At=n.get(ce.depthTexture).__webglTexture,pt=Zt(ce);if(ce.depthTexture.format===Gl)ln(ce)?m.framebufferTexture2DMultisampleEXT(36160,36096,3553,At,0,pt):a.framebufferTexture2D(36160,36096,3553,At,0);else if(ce.depthTexture.format===Su)ln(ce)?m.framebufferTexture2DMultisampleEXT(36160,33306,3553,At,0,pt):a.framebufferTexture2D(36160,33306,3553,At,0);else throw new Error("Unknown depthTexture format")}function tt(me){const ce=n.get(me),Qe=me.isWebGLCubeRenderTarget===!0;if(me.depthTexture&&!ce.__autoAllocateDepthBuffer){if(Qe)throw new Error("target.depthTexture not supported in Cube render targets");it(ce.__webglFramebuffer,me)}else if(Qe){ce.__webglDepthbuffer=[];for(let At=0;At<6;At++)t.bindFramebuffer(36160,ce.__webglFramebuffer[At]),ce.__webglDepthbuffer[At]=a.createRenderbuffer(),yn(ce.__webglDepthbuffer[At],me,!1)}else t.bindFramebuffer(36160,ce.__webglFramebuffer),ce.__webglDepthbuffer=a.createRenderbuffer(),yn(ce.__webglDepthbuffer,me,!1);t.bindFramebuffer(36160,null)}function vt(me,ce,Qe){const At=n.get(me);ce!==void 0&&Ft(At.__webglFramebuffer,me,me.texture,36064,3553),Qe!==void 0&&tt(me)}function Jt(me){const ce=me.texture,Qe=n.get(me),At=n.get(ce);me.addEventListener("dispose",ee),me.isWebGLMultipleRenderTargets!==!0&&(At.__webglTexture===void 0&&(At.__webglTexture=a.createTexture()),At.__version=ce.version,o.memory.textures++);const pt=me.isWebGLCubeRenderTarget===!0,zt=me.isWebGLMultipleRenderTargets===!0,Mn=I(me)||l;if(pt){Qe.__webglFramebuffer=[];for(let we=0;we<6;we++)Qe.__webglFramebuffer[we]=a.createFramebuffer()}else{if(Qe.__webglFramebuffer=a.createFramebuffer(),zt)if(i.drawBuffers){const we=me.texture;for(let Fe=0,bt=we.length;Fe<bt;Fe++){const hn=n.get(we[Fe]);hn.__webglTexture===void 0&&(hn.__webglTexture=a.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(l&&me.samples>0&&ln(me)===!1){const we=zt?ce:[ce];Qe.__webglMultisampledFramebuffer=a.createFramebuffer(),Qe.__webglColorRenderbuffer=[],t.bindFramebuffer(36160,Qe.__webglMultisampledFramebuffer);for(let Fe=0;Fe<we.length;Fe++){const bt=we[Fe];Qe.__webglColorRenderbuffer[Fe]=a.createRenderbuffer(),a.bindRenderbuffer(36161,Qe.__webglColorRenderbuffer[Fe]);const hn=r.convert(bt.format,bt.encoding),nn=r.convert(bt.type),Ht=D(bt.internalFormat,hn,nn,bt.encoding,me.isXRRenderTarget===!0),Bn=Zt(me);a.renderbufferStorageMultisample(36161,Bn,Ht,me.width,me.height),a.framebufferRenderbuffer(36160,36064+Fe,36161,Qe.__webglColorRenderbuffer[Fe])}a.bindRenderbuffer(36161,null),me.depthBuffer&&(Qe.__webglDepthRenderbuffer=a.createRenderbuffer(),yn(Qe.__webglDepthRenderbuffer,me,!0)),t.bindFramebuffer(36160,null)}}if(pt){t.bindTexture(34067,At.__webglTexture),He(34067,ce,Mn);for(let we=0;we<6;we++)Ft(Qe.__webglFramebuffer[we],me,ce,36064,34069+we);B(ce,Mn)&&F(34067),t.unbindTexture()}else if(zt){const we=me.texture;for(let Fe=0,bt=we.length;Fe<bt;Fe++){const hn=we[Fe],nn=n.get(hn);t.bindTexture(3553,nn.__webglTexture),He(3553,hn,Mn),Ft(Qe.__webglFramebuffer,me,hn,36064+Fe,3553),B(hn,Mn)&&F(3553)}t.unbindTexture()}else{let we=3553;(me.isWebGL3DRenderTarget||me.isWebGLArrayRenderTarget)&&(l?we=me.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),t.bindTexture(we,At.__webglTexture),He(we,ce,Mn),Ft(Qe.__webglFramebuffer,me,ce,36064,we),B(ce,Mn)&&F(we),t.unbindTexture()}me.depthBuffer&&tt(me)}function Lt(me){const ce=I(me)||l,Qe=me.isWebGLMultipleRenderTargets===!0?me.texture:[me.texture];for(let At=0,pt=Qe.length;At<pt;At++){const zt=Qe[At];if(B(zt,ce)){const Mn=me.isWebGLCubeRenderTarget?34067:3553,we=n.get(zt).__webglTexture;t.bindTexture(Mn,we),F(Mn),t.unbindTexture()}}}function En(me){if(l&&me.samples>0&&ln(me)===!1){const ce=me.isWebGLMultipleRenderTargets?me.texture:[me.texture],Qe=me.width,At=me.height;let pt=16384;const zt=[],Mn=me.stencilBuffer?33306:36096,we=n.get(me),Fe=me.isWebGLMultipleRenderTargets===!0;if(Fe)for(let bt=0;bt<ce.length;bt++)t.bindFramebuffer(36160,we.__webglMultisampledFramebuffer),a.framebufferRenderbuffer(36160,36064+bt,36161,null),t.bindFramebuffer(36160,we.__webglFramebuffer),a.framebufferTexture2D(36009,36064+bt,3553,null,0);t.bindFramebuffer(36008,we.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,we.__webglFramebuffer);for(let bt=0;bt<ce.length;bt++){zt.push(36064+bt),me.depthBuffer&&zt.push(Mn);const hn=we.__ignoreDepthValues!==void 0?we.__ignoreDepthValues:!1;if(hn===!1&&(me.depthBuffer&&(pt|=256),me.stencilBuffer&&(pt|=1024)),Fe&&a.framebufferRenderbuffer(36008,36064,36161,we.__webglColorRenderbuffer[bt]),hn===!0&&(a.invalidateFramebuffer(36008,[Mn]),a.invalidateFramebuffer(36009,[Mn])),Fe){const nn=n.get(ce[bt]).__webglTexture;a.framebufferTexture2D(36009,36064,3553,nn,0)}a.blitFramebuffer(0,0,Qe,At,0,0,Qe,At,pt,9728),A&&a.invalidateFramebuffer(36008,zt)}if(t.bindFramebuffer(36008,null),t.bindFramebuffer(36009,null),Fe)for(let bt=0;bt<ce.length;bt++){t.bindFramebuffer(36160,we.__webglMultisampledFramebuffer),a.framebufferRenderbuffer(36160,36064+bt,36161,we.__webglColorRenderbuffer[bt]);const hn=n.get(ce[bt]).__webglTexture;t.bindFramebuffer(36160,we.__webglFramebuffer),a.framebufferTexture2D(36009,36064+bt,3553,hn,0)}t.bindFramebuffer(36009,we.__webglMultisampledFramebuffer)}}function Zt(me){return Math.min(g,me.samples)}function ln(me){const ce=n.get(me);return l&&me.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&ce.__useRenderToTexture!==!1}function ii(me){const ce=o.render.frame;v.get(me)!==ce&&(v.set(me,ce),me.update())}function Zn(me,ce){const Qe=me.encoding,At=me.format,pt=me.type;return me.isCompressedTexture===!0||me.isVideoTexture===!0||me.format===J_||Qe!==pr&&(Qe===Gn?l===!1?e.has("EXT_sRGB")===!0&&At===us?(me.format=J_,me.minFilter=yi,me.generateMipmaps=!1):ce=lC.sRGBToLinear(ce):(At!==us||pt!==Er)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",Qe)),ce}this.allocateTextureUnit=xe,this.resetTextureUnits=ve,this.setTexture2D=Me,this.setTexture2DArray=Be,this.setTexture3D=Le,this.setTextureCube=$e,this.rebindTextures=vt,this.setupRenderTarget=Jt,this.updateRenderTargetMipmap=Lt,this.updateMultisampleRenderTarget=En,this.setupDepthRenderbuffer=tt,this.setupFrameBufferTexture=Ft,this.useMultisampledRTT=ln}function OL(a,e,t){const n=t.isWebGL2;function i(r,o=null){let l;if(r===Er)return 5121;if(r===KB)return 32819;if(r===$B)return 32820;if(r===YB)return 5120;if(r===JB)return 5122;if(r===nC)return 5123;if(r===ZB)return 5124;if(r===Fl)return 5125;if(r===Ms)return 5126;if(r===Os)return n?5131:(l=e.get("OES_texture_half_float"),l!==null?l.HALF_FLOAT_OES:null);if(r===eL)return 6406;if(r===us)return 6408;if(r===nL)return 6409;if(r===iL)return 6410;if(r===Gl)return 6402;if(r===Su)return 34041;if(r===lu)return 6403;if(r===tL)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(r===J_)return l=e.get("EXT_sRGB"),l!==null?l.SRGB_ALPHA_EXT:null;if(r===sL)return 36244;if(r===ef)return 33319;if(r===rL)return 33320;if(r===oL)return 36249;if(r===wm||r===v_||r===x_||r===bm)if(o===Gn)if(l=e.get("WEBGL_compressed_texture_s3tc_srgb"),l!==null){if(r===wm)return l.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(r===v_)return l.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(r===x_)return l.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(r===bm)return l.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(l=e.get("WEBGL_compressed_texture_s3tc"),l!==null){if(r===wm)return l.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===v_)return l.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===x_)return l.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===bm)return l.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(r===W_||r===zb||r===Q_||r===Gb)if(l=e.get("WEBGL_compressed_texture_pvrtc"),l!==null){if(r===W_)return l.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===zb)return l.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===Q_)return l.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===Gb)return l.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(r===iC)return l=e.get("WEBGL_compressed_texture_etc1"),l!==null?l.COMPRESSED_RGB_ETC1_WEBGL:null;if(r===j_||r===q_)if(l=e.get("WEBGL_compressed_texture_etc"),l!==null){if(r===j_)return o===Gn?l.COMPRESSED_SRGB8_ETC2:l.COMPRESSED_RGB8_ETC2;if(r===q_)return o===Gn?l.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:l.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(r===X_||r===Hb||r===Vb||r===Wb||r===Qb||r===jb||r===qb||r===Xb||r===Yb||r===Jb||r===Zb||r===Kb||r===$b||r===eE)if(l=e.get("WEBGL_compressed_texture_astc"),l!==null){if(r===X_)return o===Gn?l.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:l.COMPRESSED_RGBA_ASTC_4x4_KHR;if(r===Hb)return o===Gn?l.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:l.COMPRESSED_RGBA_ASTC_5x4_KHR;if(r===Vb)return o===Gn?l.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:l.COMPRESSED_RGBA_ASTC_5x5_KHR;if(r===Wb)return o===Gn?l.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:l.COMPRESSED_RGBA_ASTC_6x5_KHR;if(r===Qb)return o===Gn?l.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:l.COMPRESSED_RGBA_ASTC_6x6_KHR;if(r===jb)return o===Gn?l.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:l.COMPRESSED_RGBA_ASTC_8x5_KHR;if(r===qb)return o===Gn?l.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:l.COMPRESSED_RGBA_ASTC_8x6_KHR;if(r===Xb)return o===Gn?l.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:l.COMPRESSED_RGBA_ASTC_8x8_KHR;if(r===Yb)return o===Gn?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:l.COMPRESSED_RGBA_ASTC_10x5_KHR;if(r===Jb)return o===Gn?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:l.COMPRESSED_RGBA_ASTC_10x6_KHR;if(r===Zb)return o===Gn?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:l.COMPRESSED_RGBA_ASTC_10x8_KHR;if(r===Kb)return o===Gn?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:l.COMPRESSED_RGBA_ASTC_10x10_KHR;if(r===$b)return o===Gn?l.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:l.COMPRESSED_RGBA_ASTC_12x10_KHR;if(r===eE)return o===Gn?l.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:l.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(r===Y_)if(l=e.get("EXT_texture_compression_bptc"),l!==null){if(r===Y_)return o===Gn?l.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:l.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;return r===Au?n?34042:(l=e.get("WEBGL_depth_texture"),l!==null?l.UNSIGNED_INT_24_8_WEBGL:null):a[r]!==void 0?a[r]:null}return{convert:i}}class FL extends ts{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class sa extends qt{constructor(){super(),this.isGroup=!0,this.type="Group"}}const g6={type:"move"};class Lw{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new sa,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new sa,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new q,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new q),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new sa,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new q,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new q),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,n){let i=null,r=null,o=null;const l=this._targetRay,h=this._grip,u=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(u&&e.hand){o=!0;for(const w of e.hand.values()){const b=t.getJointPose(w,n);if(u.joints[w.jointName]===void 0){const R=new sa;R.matrixAutoUpdate=!1,R.visible=!1,u.joints[w.jointName]=R,u.add(R)}const S=u.joints[w.jointName];b!==null&&(S.matrix.fromArray(b.transform.matrix),S.matrix.decompose(S.position,S.rotation,S.scale),S.jointRadius=b.radius),S.visible=b!==null}const f=u.joints["index-finger-tip"],g=u.joints["thumb-tip"],m=f.position.distanceTo(g.position),A=.02,v=.005;u.inputState.pinching&&m>A+v?(u.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!u.inputState.pinching&&m<=A-v&&(u.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else h!==null&&e.gripSpace&&(r=t.getPose(e.gripSpace,n),r!==null&&(h.matrix.fromArray(r.transform.matrix),h.matrix.decompose(h.position,h.rotation,h.scale),r.linearVelocity?(h.hasLinearVelocity=!0,h.linearVelocity.copy(r.linearVelocity)):h.hasLinearVelocity=!1,r.angularVelocity?(h.hasAngularVelocity=!0,h.angularVelocity.copy(r.angularVelocity)):h.hasAngularVelocity=!1));l!==null&&(i=t.getPose(e.targetRaySpace,n),i===null&&r!==null&&(i=r),i!==null&&(l.matrix.fromArray(i.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),i.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(i.linearVelocity)):l.hasLinearVelocity=!1,i.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(i.angularVelocity)):l.hasAngularVelocity=!1,this.dispatchEvent(g6)))}return l!==null&&(l.visible=i!==null),h!==null&&(h.visible=r!==null),u!==null&&(u.visible=o!==null),this}}class AC extends Vi{constructor(e,t,n,i,r,o,l,h,u,f){if(f=f!==void 0?f:Gl,f!==Gl&&f!==Su)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");n===void 0&&f===Gl&&(n=Fl),n===void 0&&f===Su&&(n=Au),super(null,i,r,o,l,h,f,n,u),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=l!==void 0?l:Ki,this.minFilter=h!==void 0?h:Ki,this.flipY=!1,this.generateMipmaps=!1}}class A6 extends Uo{constructor(e,t){super();const n=this;let i=null,r=1,o=null,l="local-floor",h=null,u=null,f=null,g=null,m=null,A=null;const v=t.getContextAttributes();let w=null,b=null;const S=[],R=[],M=new ts;M.layers.enable(1),M.viewport=new On;const I=new ts;I.layers.enable(2),I.viewport=new On;const T=[M,I],B=new FL;B.layers.enable(1),B.layers.enable(2);let F=null,D=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(Ae){let Me=S[Ae];return Me===void 0&&(Me=new Lw,S[Ae]=Me),Me.getTargetRaySpace()},this.getControllerGrip=function(Ae){let Me=S[Ae];return Me===void 0&&(Me=new Lw,S[Ae]=Me),Me.getGripSpace()},this.getHand=function(Ae){let Me=S[Ae];return Me===void 0&&(Me=new Lw,S[Ae]=Me),Me.getHandSpace()};function U(Ae){const Me=R.indexOf(Ae.inputSource);if(Me===-1)return;const Be=S[Me];Be!==void 0&&Be.dispatchEvent({type:Ae.type,data:Ae.inputSource})}function W(){i.removeEventListener("select",U),i.removeEventListener("selectstart",U),i.removeEventListener("selectend",U),i.removeEventListener("squeeze",U),i.removeEventListener("squeezestart",U),i.removeEventListener("squeezeend",U),i.removeEventListener("end",W),i.removeEventListener("inputsourceschange",J);for(let Ae=0;Ae<S.length;Ae++){const Me=R[Ae];Me!==null&&(R[Ae]=null,S[Ae].disconnect(Me))}F=null,D=null,e.setRenderTarget(w),m=null,g=null,f=null,i=null,b=null,xe.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(Ae){r=Ae,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(Ae){l=Ae,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return h||o},this.setReferenceSpace=function(Ae){h=Ae},this.getBaseLayer=function(){return g!==null?g:m},this.getBinding=function(){return f},this.getFrame=function(){return A},this.getSession=function(){return i},this.setSession=async function(Ae){if(i=Ae,i!==null){if(w=e.getRenderTarget(),i.addEventListener("select",U),i.addEventListener("selectstart",U),i.addEventListener("selectend",U),i.addEventListener("squeeze",U),i.addEventListener("squeezestart",U),i.addEventListener("squeezeend",U),i.addEventListener("end",W),i.addEventListener("inputsourceschange",J),v.xrCompatible!==!0&&await t.makeXRCompatible(),i.renderState.layers===void 0||e.capabilities.isWebGL2===!1){const Me={antialias:i.renderState.layers===void 0?v.antialias:!0,alpha:v.alpha,depth:v.depth,stencil:v.stencil,framebufferScaleFactor:r};m=new XRWebGLLayer(i,t,Me),i.updateRenderState({baseLayer:m}),b=new Hr(m.framebufferWidth,m.framebufferHeight,{format:us,type:Er,encoding:e.outputEncoding,stencilBuffer:v.stencil})}else{let Me=null,Be=null,Le=null;v.depth&&(Le=v.stencil?35056:33190,Me=v.stencil?Su:Gl,Be=v.stencil?Au:Fl);const $e={colorFormat:32856,depthFormat:Le,scaleFactor:r};f=new XRWebGLBinding(i,t),g=f.createProjectionLayer($e),i.updateRenderState({layers:[g]}),b=new Hr(g.textureWidth,g.textureHeight,{format:us,type:Er,depthTexture:new AC(g.textureWidth,g.textureHeight,Be,void 0,void 0,void 0,void 0,void 0,void 0,Me),stencilBuffer:v.stencil,encoding:e.outputEncoding,samples:v.antialias?4:0});const yt=e.properties.get(b);yt.__ignoreDepthValues=g.ignoreDepthValues}b.isXRRenderTarget=!0,this.setFoveation(1),h=null,o=await i.requestReferenceSpace(l),xe.setContext(i),xe.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}};function J(Ae){for(let Me=0;Me<Ae.removed.length;Me++){const Be=Ae.removed[Me],Le=R.indexOf(Be);Le>=0&&(R[Le]=null,S[Le].dispatchEvent({type:"disconnected",data:Be}))}for(let Me=0;Me<Ae.added.length;Me++){const Be=Ae.added[Me];let Le=R.indexOf(Be);if(Le===-1){for(let yt=0;yt<S.length;yt++)if(yt>=R.length){R.push(Be),Le=yt;break}else if(R[yt]===null){R[yt]=Be,Le=yt;break}if(Le===-1)break}const $e=S[Le];$e&&$e.dispatchEvent({type:"connected",data:Be})}}const ee=new q,Q=new q;function Y(Ae,Me,Be){ee.setFromMatrixPosition(Me.matrixWorld),Q.setFromMatrixPosition(Be.matrixWorld);const Le=ee.distanceTo(Q),$e=Me.projectionMatrix.elements,yt=Be.projectionMatrix.elements,Nt=$e[14]/($e[10]-1),He=$e[14]/($e[10]+1),mn=($e[9]+1)/$e[5],Xt=($e[9]-1)/$e[5],pn=($e[8]-1)/$e[0],Ft=(yt[8]+1)/yt[0],yn=Nt*pn,it=Nt*Ft,tt=Le/(-pn+Ft),vt=tt*-pn;Me.matrixWorld.decompose(Ae.position,Ae.quaternion,Ae.scale),Ae.translateX(vt),Ae.translateZ(tt),Ae.matrixWorld.compose(Ae.position,Ae.quaternion,Ae.scale),Ae.matrixWorldInverse.copy(Ae.matrixWorld).invert();const Jt=Nt+tt,Lt=He+tt,En=yn-vt,Zt=it+(Le-vt),ln=mn*He/Lt*Jt,ii=Xt*He/Lt*Jt;Ae.projectionMatrix.makePerspective(En,Zt,ln,ii,Jt,Lt)}function se(Ae,Me){Me===null?Ae.matrixWorld.copy(Ae.matrix):Ae.matrixWorld.multiplyMatrices(Me.matrixWorld,Ae.matrix),Ae.matrixWorldInverse.copy(Ae.matrixWorld).invert()}this.updateCamera=function(Ae){if(i===null)return;B.near=I.near=M.near=Ae.near,B.far=I.far=M.far=Ae.far,(F!==B.near||D!==B.far)&&(i.updateRenderState({depthNear:B.near,depthFar:B.far}),F=B.near,D=B.far);const Me=Ae.parent,Be=B.cameras;se(B,Me);for(let $e=0;$e<Be.length;$e++)se(Be[$e],Me);B.matrixWorld.decompose(B.position,B.quaternion,B.scale),Ae.matrix.copy(B.matrix),Ae.matrix.decompose(Ae.position,Ae.quaternion,Ae.scale);const Le=Ae.children;for(let $e=0,yt=Le.length;$e<yt;$e++)Le[$e].updateMatrixWorld(!0);Be.length===2?Y(B,M,I):B.projectionMatrix.copy(M.projectionMatrix)},this.getCamera=function(){return B},this.getFoveation=function(){if(g!==null)return g.fixedFoveation;if(m!==null)return m.fixedFoveation},this.setFoveation=function(Ae){g!==null&&(g.fixedFoveation=Ae),m!==null&&m.fixedFoveation!==void 0&&(m.fixedFoveation=Ae)};let ae=null;function ve(Ae,Me){if(u=Me.getViewerPose(h||o),A=Me,u!==null){const Be=u.views;m!==null&&(e.setRenderTargetFramebuffer(b,m.framebuffer),e.setRenderTarget(b));let Le=!1;Be.length!==B.cameras.length&&(B.cameras.length=0,Le=!0);for(let $e=0;$e<Be.length;$e++){const yt=Be[$e];let Nt=null;if(m!==null)Nt=m.getViewport(yt);else{const mn=f.getViewSubImage(g,yt);Nt=mn.viewport,$e===0&&(e.setRenderTargetTextures(b,mn.colorTexture,g.ignoreDepthValues?void 0:mn.depthStencilTexture),e.setRenderTarget(b))}let He=T[$e];He===void 0&&(He=new ts,He.layers.enable($e),He.viewport=new On,T[$e]=He),He.matrix.fromArray(yt.transform.matrix),He.projectionMatrix.fromArray(yt.projectionMatrix),He.viewport.set(Nt.x,Nt.y,Nt.width,Nt.height),$e===0&&B.matrix.copy(He.matrix),Le===!0&&B.cameras.push(He)}}for(let Be=0;Be<S.length;Be++){const Le=R[Be],$e=S[Be];Le!==null&&$e!==void 0&&$e.update(Le,Me,h||o)}ae&&ae(Ae,Me),A=null}const xe=new RL;xe.setAnimationLoop(ve),this.setAnimationLoop=function(Ae){ae=Ae},this.dispose=function(){}}}function _6(a,e){function t(w,b){w.fogColor.value.copy(b.color),b.isFog?(w.fogNear.value=b.near,w.fogFar.value=b.far):b.isFogExp2&&(w.fogDensity.value=b.density)}function n(w,b,S,R,M){b.isMeshBasicMaterial||b.isMeshLambertMaterial?i(w,b):b.isMeshToonMaterial?(i(w,b),f(w,b)):b.isMeshPhongMaterial?(i(w,b),u(w,b)):b.isMeshStandardMaterial?(i(w,b),g(w,b),b.isMeshPhysicalMaterial&&m(w,b,M)):b.isMeshMatcapMaterial?(i(w,b),A(w,b)):b.isMeshDepthMaterial?i(w,b):b.isMeshDistanceMaterial?(i(w,b),v(w,b)):b.isMeshNormalMaterial?i(w,b):b.isLineBasicMaterial?(r(w,b),b.isLineDashedMaterial&&o(w,b)):b.isPointsMaterial?l(w,b,S,R):b.isSpriteMaterial?h(w,b):b.isShadowMaterial?(w.color.value.copy(b.color),w.opacity.value=b.opacity):b.isShaderMaterial&&(b.uniformsNeedUpdate=!1)}function i(w,b){w.opacity.value=b.opacity,b.color&&w.diffuse.value.copy(b.color),b.emissive&&w.emissive.value.copy(b.emissive).multiplyScalar(b.emissiveIntensity),b.map&&(w.map.value=b.map),b.alphaMap&&(w.alphaMap.value=b.alphaMap),b.bumpMap&&(w.bumpMap.value=b.bumpMap,w.bumpScale.value=b.bumpScale,b.side===Ur&&(w.bumpScale.value*=-1)),b.displacementMap&&(w.displacementMap.value=b.displacementMap,w.displacementScale.value=b.displacementScale,w.displacementBias.value=b.displacementBias),b.emissiveMap&&(w.emissiveMap.value=b.emissiveMap),b.normalMap&&(w.normalMap.value=b.normalMap,w.normalScale.value.copy(b.normalScale),b.side===Ur&&w.normalScale.value.negate()),b.specularMap&&(w.specularMap.value=b.specularMap),b.alphaTest>0&&(w.alphaTest.value=b.alphaTest);const S=e.get(b).envMap;if(S&&(w.envMap.value=S,w.flipEnvMap.value=S.isCubeTexture&&S.isRenderTargetTexture===!1?-1:1,w.reflectivity.value=b.reflectivity,w.ior.value=b.ior,w.refractionRatio.value=b.refractionRatio),b.lightMap){w.lightMap.value=b.lightMap;const I=a.physicallyCorrectLights!==!0?Math.PI:1;w.lightMapIntensity.value=b.lightMapIntensity*I}b.aoMap&&(w.aoMap.value=b.aoMap,w.aoMapIntensity.value=b.aoMapIntensity);let R;b.map?R=b.map:b.specularMap?R=b.specularMap:b.displacementMap?R=b.displacementMap:b.normalMap?R=b.normalMap:b.bumpMap?R=b.bumpMap:b.roughnessMap?R=b.roughnessMap:b.metalnessMap?R=b.metalnessMap:b.alphaMap?R=b.alphaMap:b.emissiveMap?R=b.emissiveMap:b.clearcoatMap?R=b.clearcoatMap:b.clearcoatNormalMap?R=b.clearcoatNormalMap:b.clearcoatRoughnessMap?R=b.clearcoatRoughnessMap:b.iridescenceMap?R=b.iridescenceMap:b.iridescenceThicknessMap?R=b.iridescenceThicknessMap:b.specularIntensityMap?R=b.specularIntensityMap:b.specularColorMap?R=b.specularColorMap:b.transmissionMap?R=b.transmissionMap:b.thicknessMap?R=b.thicknessMap:b.sheenColorMap?R=b.sheenColorMap:b.sheenRoughnessMap&&(R=b.sheenRoughnessMap),R!==void 0&&(R.isWebGLRenderTarget&&(R=R.texture),R.matrixAutoUpdate===!0&&R.updateMatrix(),w.uvTransform.value.copy(R.matrix));let M;b.aoMap?M=b.aoMap:b.lightMap&&(M=b.lightMap),M!==void 0&&(M.isWebGLRenderTarget&&(M=M.texture),M.matrixAutoUpdate===!0&&M.updateMatrix(),w.uv2Transform.value.copy(M.matrix))}function r(w,b){w.diffuse.value.copy(b.color),w.opacity.value=b.opacity}function o(w,b){w.dashSize.value=b.dashSize,w.totalSize.value=b.dashSize+b.gapSize,w.scale.value=b.scale}function l(w,b,S,R){w.diffuse.value.copy(b.color),w.opacity.value=b.opacity,w.size.value=b.size*S,w.scale.value=R*.5,b.map&&(w.map.value=b.map),b.alphaMap&&(w.alphaMap.value=b.alphaMap),b.alphaTest>0&&(w.alphaTest.value=b.alphaTest);let M;b.map?M=b.map:b.alphaMap&&(M=b.alphaMap),M!==void 0&&(M.matrixAutoUpdate===!0&&M.updateMatrix(),w.uvTransform.value.copy(M.matrix))}function h(w,b){w.diffuse.value.copy(b.color),w.opacity.value=b.opacity,w.rotation.value=b.rotation,b.map&&(w.map.value=b.map),b.alphaMap&&(w.alphaMap.value=b.alphaMap),b.alphaTest>0&&(w.alphaTest.value=b.alphaTest);let S;b.map?S=b.map:b.alphaMap&&(S=b.alphaMap),S!==void 0&&(S.matrixAutoUpdate===!0&&S.updateMatrix(),w.uvTransform.value.copy(S.matrix))}function u(w,b){w.specular.value.copy(b.specular),w.shininess.value=Math.max(b.shininess,1e-4)}function f(w,b){b.gradientMap&&(w.gradientMap.value=b.gradientMap)}function g(w,b){w.roughness.value=b.roughness,w.metalness.value=b.metalness,b.roughnessMap&&(w.roughnessMap.value=b.roughnessMap),b.metalnessMap&&(w.metalnessMap.value=b.metalnessMap),e.get(b).envMap&&(w.envMapIntensity.value=b.envMapIntensity)}function m(w,b,S){w.ior.value=b.ior,b.sheen>0&&(w.sheenColor.value.copy(b.sheenColor).multiplyScalar(b.sheen),w.sheenRoughness.value=b.sheenRoughness,b.sheenColorMap&&(w.sheenColorMap.value=b.sheenColorMap),b.sheenRoughnessMap&&(w.sheenRoughnessMap.value=b.sheenRoughnessMap)),b.clearcoat>0&&(w.clearcoat.value=b.clearcoat,w.clearcoatRoughness.value=b.clearcoatRoughness,b.clearcoatMap&&(w.clearcoatMap.value=b.clearcoatMap),b.clearcoatRoughnessMap&&(w.clearcoatRoughnessMap.value=b.clearcoatRoughnessMap),b.clearcoatNormalMap&&(w.clearcoatNormalScale.value.copy(b.clearcoatNormalScale),w.clearcoatNormalMap.value=b.clearcoatNormalMap,b.side===Ur&&w.clearcoatNormalScale.value.negate())),b.iridescence>0&&(w.iridescence.value=b.iridescence,w.iridescenceIOR.value=b.iridescenceIOR,w.iridescenceThicknessMinimum.value=b.iridescenceThicknessRange[0],w.iridescenceThicknessMaximum.value=b.iridescenceThicknessRange[1],b.iridescenceMap&&(w.iridescenceMap.value=b.iridescenceMap),b.iridescenceThicknessMap&&(w.iridescenceThicknessMap.value=b.iridescenceThicknessMap)),b.transmission>0&&(w.transmission.value=b.transmission,w.transmissionSamplerMap.value=S.texture,w.transmissionSamplerSize.value.set(S.width,S.height),b.transmissionMap&&(w.transmissionMap.value=b.transmissionMap),w.thickness.value=b.thickness,b.thicknessMap&&(w.thicknessMap.value=b.thicknessMap),w.attenuationDistance.value=b.attenuationDistance,w.attenuationColor.value.copy(b.attenuationColor)),w.specularIntensity.value=b.specularIntensity,w.specularColor.value.copy(b.specularColor),b.specularIntensityMap&&(w.specularIntensityMap.value=b.specularIntensityMap),b.specularColorMap&&(w.specularColorMap.value=b.specularColorMap)}function A(w,b){b.matcap&&(w.matcap.value=b.matcap)}function v(w,b){w.referencePosition.value.copy(b.referencePosition),w.nearDistance.value=b.nearDistance,w.farDistance.value=b.farDistance}return{refreshFogUniforms:t,refreshMaterialUniforms:n}}function y6(a,e,t,n){let i={},r={},o=[];const l=t.isWebGL2?a.getParameter(35375):0;function h(R,M){const I=M.program;n.uniformBlockBinding(R,I)}function u(R,M){let I=i[R.id];I===void 0&&(v(R),I=f(R),i[R.id]=I,R.addEventListener("dispose",b));const T=M.program;n.updateUBOMapping(R,T);const B=e.render.frame;r[R.id]!==B&&(m(R),r[R.id]=B)}function f(R){const M=g();R.__bindingPointIndex=M;const I=a.createBuffer(),T=R.__size,B=R.usage;return a.bindBuffer(35345,I),a.bufferData(35345,T,B),a.bindBuffer(35345,null),a.bindBufferBase(35345,M,I),I}function g(){for(let R=0;R<l;R++)if(o.indexOf(R)===-1)return o.push(R),R;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function m(R){const M=i[R.id],I=R.uniforms,T=R.__cache;a.bindBuffer(35345,M);for(let B=0,F=I.length;B<F;B++){const D=I[B];if(A(D,B,T)===!0){const U=D.value,W=D.__offset;typeof U=="number"?(D.__data[0]=U,a.bufferSubData(35345,W,D.__data)):(D.value.isMatrix3?(D.__data[0]=D.value.elements[0],D.__data[1]=D.value.elements[1],D.__data[2]=D.value.elements[2],D.__data[3]=D.value.elements[0],D.__data[4]=D.value.elements[3],D.__data[5]=D.value.elements[4],D.__data[6]=D.value.elements[5],D.__data[7]=D.value.elements[0],D.__data[8]=D.value.elements[6],D.__data[9]=D.value.elements[7],D.__data[10]=D.value.elements[8],D.__data[11]=D.value.elements[0]):U.toArray(D.__data),a.bufferSubData(35345,W,D.__data))}}a.bindBuffer(35345,null)}function A(R,M,I){const T=R.value;if(I[M]===void 0)return typeof T=="number"?I[M]=T:I[M]=T.clone(),!0;if(typeof T=="number"){if(I[M]!==T)return I[M]=T,!0}else{const B=I[M];if(B.equals(T)===!1)return B.copy(T),!0}return!1}function v(R){const M=R.uniforms;let I=0;const T=16;let B=0;for(let F=0,D=M.length;F<D;F++){const U=M[F],W=w(U);if(U.__data=new Float32Array(W.storage/Float32Array.BYTES_PER_ELEMENT),U.__offset=I,F>0){B=I%T;const J=T-B;B!==0&&J-W.boundary<0&&(I+=T-B,U.__offset=I)}I+=W.storage}return B=I%T,B>0&&(I+=T-B),R.__size=I,R.__cache={},this}function w(R){const M=R.value,I={boundary:0,storage:0};return typeof M=="number"?(I.boundary=4,I.storage=4):M.isVector2?(I.boundary=8,I.storage=8):M.isVector3||M.isColor?(I.boundary=16,I.storage=12):M.isVector4?(I.boundary=16,I.storage=16):M.isMatrix3?(I.boundary=48,I.storage=48):M.isMatrix4?(I.boundary=64,I.storage=64):M.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",M),I}function b(R){const M=R.target;M.removeEventListener("dispose",b);const I=o.indexOf(M.__bindingPointIndex);o.splice(I,1),a.deleteBuffer(i[M.id]),delete i[M.id],delete r[M.id]}function S(){for(const R in i)a.deleteBuffer(i[R]);o=[],i={},r={}}return{bind:h,update:u,dispose:S}}function v6(){const a=jm("canvas");return a.style.display="block",a}function Ag(a={}){this.isWebGLRenderer=!0;const e=a.canvas!==void 0?a.canvas:v6(),t=a.context!==void 0?a.context:null,n=a.depth!==void 0?a.depth:!0,i=a.stencil!==void 0?a.stencil:!0,r=a.antialias!==void 0?a.antialias:!1,o=a.premultipliedAlpha!==void 0?a.premultipliedAlpha:!0,l=a.preserveDrawingBuffer!==void 0?a.preserveDrawingBuffer:!1,h=a.powerPreference!==void 0?a.powerPreference:"default",u=a.failIfMajorPerformanceCaveat!==void 0?a.failIfMajorPerformanceCaveat:!1;let f;t!==null?f=t.getContextAttributes().alpha:f=a.alpha!==void 0?a.alpha:!1;let g=null,m=null;const A=[],v=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=pr,this.physicallyCorrectLights=!1,this.toneMapping=ca,this.toneMappingExposure=1,Object.defineProperties(this,{gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}});const w=this;let b=!1,S=0,R=0,M=null,I=-1,T=null;const B=new On,F=new On;let D=null,U=e.width,W=e.height,J=1,ee=null,Q=null;const Y=new On(0,0,U,W),se=new On(0,0,U,W);let ae=!1;const ve=new Iy;let xe=!1,Ae=!1,Me=null;const Be=new xn,Le=new Xe,$e=new q,yt={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Nt(){return M===null?J:1}let He=t;function mn(he,ze){for(let Ue=0;Ue<he.length;Ue++){const ke=he[Ue],nt=e.getContext(ke,ze);if(nt!==null)return nt}return null}try{const he={alpha:!0,depth:n,stencil:i,antialias:r,premultipliedAlpha:o,preserveDrawingBuffer:l,powerPreference:h,failIfMajorPerformanceCaveat:u};if("setAttribute"in e&&e.setAttribute("data-engine",`three.js r${Ey}`),e.addEventListener("webglcontextlost",Ht,!1),e.addEventListener("webglcontextrestored",Bn,!1),e.addEventListener("webglcontextcreationerror",Ln,!1),He===null){const ze=["webgl2","webgl","experimental-webgl"];if(w.isWebGL1Renderer===!0&&ze.shift(),He=mn(ze,he),He===null)throw mn(ze)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}He.getShaderPrecisionFormat===void 0&&(He.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(he){throw console.error("THREE.WebGLRenderer: "+he.message),he}let Xt,pn,Ft,yn,it,tt,vt,Jt,Lt,En,Zt,ln,ii,Zn,me,ce,Qe,At,pt,zt,Mn,we,Fe,bt;function hn(){Xt=new FQ(He),pn=new RQ(He,Xt,a),Xt.init(pn),we=new OL(He,Xt,pn),Ft=new p6(He,Xt,pn),yn=new UQ,it=new n6,tt=new m6(He,Xt,Ft,it,pn,we,yn),vt=new BQ(w),Jt=new OQ(w),Lt=new J5(He,pn),Fe=new TQ(He,Xt,Lt,pn),En=new kQ(He,Lt,yn,Fe),Zt=new VQ(He,En,Lt,yn),pt=new HQ(He,pn,tt),ce=new PQ(it),ln=new t6(w,vt,Jt,Xt,pn,Fe,ce),ii=new _6(w,it),Zn=new s6,me=new h6(Xt,pn),At=new MQ(w,vt,Ft,Zt,f,o),Qe=new f6(w,Zt,pn),bt=new y6(He,yn,pn,Ft),zt=new IQ(He,Xt,yn,pn),Mn=new NQ(He,Xt,yn,pn),yn.programs=ln.programs,w.capabilities=pn,w.extensions=Xt,w.properties=it,w.renderLists=Zn,w.shadowMap=Qe,w.state=Ft,w.info=yn}hn();const nn=new A6(w,He);this.xr=nn,this.getContext=function(){return He},this.getContextAttributes=function(){return He.getContextAttributes()},this.forceContextLoss=function(){const he=Xt.get("WEBGL_lose_context");he&&he.loseContext()},this.forceContextRestore=function(){const he=Xt.get("WEBGL_lose_context");he&&he.restoreContext()},this.getPixelRatio=function(){return J},this.setPixelRatio=function(he){he!==void 0&&(J=he,this.setSize(U,W,!1))},this.getSize=function(he){return he.set(U,W)},this.setSize=function(he,ze,Ue){if(nn.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}U=he,W=ze,e.width=Math.floor(he*J),e.height=Math.floor(ze*J),Ue!==!1&&(e.style.width=he+"px",e.style.height=ze+"px"),this.setViewport(0,0,he,ze)},this.getDrawingBufferSize=function(he){return he.set(U*J,W*J).floor()},this.setDrawingBufferSize=function(he,ze,Ue){U=he,W=ze,J=Ue,e.width=Math.floor(he*Ue),e.height=Math.floor(ze*Ue),this.setViewport(0,0,he,ze)},this.getCurrentViewport=function(he){return he.copy(B)},this.getViewport=function(he){return he.copy(Y)},this.setViewport=function(he,ze,Ue,ke){he.isVector4?Y.set(he.x,he.y,he.z,he.w):Y.set(he,ze,Ue,ke),Ft.viewport(B.copy(Y).multiplyScalar(J).floor())},this.getScissor=function(he){return he.copy(se)},this.setScissor=function(he,ze,Ue,ke){he.isVector4?se.set(he.x,he.y,he.z,he.w):se.set(he,ze,Ue,ke),Ft.scissor(F.copy(se).multiplyScalar(J).floor())},this.getScissorTest=function(){return ae},this.setScissorTest=function(he){Ft.setScissorTest(ae=he)},this.setOpaqueSort=function(he){ee=he},this.setTransparentSort=function(he){Q=he},this.getClearColor=function(he){return he.copy(At.getClearColor())},this.setClearColor=function(){At.setClearColor.apply(At,arguments)},this.getClearAlpha=function(){return At.getClearAlpha()},this.setClearAlpha=function(){At.setClearAlpha.apply(At,arguments)},this.clear=function(he=!0,ze=!0,Ue=!0){let ke=0;he&&(ke|=16384),ze&&(ke|=256),Ue&&(ke|=1024),He.clear(ke)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",Ht,!1),e.removeEventListener("webglcontextrestored",Bn,!1),e.removeEventListener("webglcontextcreationerror",Ln,!1),Zn.dispose(),me.dispose(),it.dispose(),vt.dispose(),Jt.dispose(),Zt.dispose(),Fe.dispose(),bt.dispose(),ln.dispose(),nn.dispose(),nn.removeEventListener("sessionstart",wn),nn.removeEventListener("sessionend",di),Me&&(Me.dispose(),Me=null),Gi.stop()};function Ht(he){he.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),b=!0}function Bn(){console.log("THREE.WebGLRenderer: Context Restored."),b=!1;const he=yn.autoReset,ze=Qe.enabled,Ue=Qe.autoUpdate,ke=Qe.needsUpdate,nt=Qe.type;hn(),yn.autoReset=he,Qe.enabled=ze,Qe.autoUpdate=Ue,Qe.needsUpdate=ke,Qe.type=nt}function Ln(he){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",he.statusMessage)}function Ce(he){const ze=he.target;ze.removeEventListener("dispose",Ce),Rt(ze)}function Rt(he){kt(he),it.remove(he)}function kt(he){const ze=it.get(he).programs;ze!==void 0&&(ze.forEach(function(Ue){ln.releaseProgram(Ue)}),he.isShaderMaterial&&ln.releaseShaderCache(he))}this.renderBufferDirect=function(he,ze,Ue,ke,nt,j){ze===null&&(ze=yt);const ie=nt.isMesh&&nt.matrixWorld.determinant()<0,pe=mo(he,ze,Ue,ke,nt);Ft.setMaterial(ke,ie);let Ee=Ue.index;const Ve=Ue.attributes.position;if(Ee===null){if(Ve===void 0||Ve.count===0)return}else if(Ee.count===0)return;let De=1;ke.wireframe===!0&&(Ee=En.getWireframeAttribute(Ue),De=2),Fe.setup(nt,ke,pe,Ue,Ee);let Ze,lt=zt;Ee!==null&&(Ze=Lt.get(Ee),lt=Mn,lt.setIndex(Ze));const St=Ee!==null?Ee.count:Ve.count,ut=Ue.drawRange.start*De,xt=Ue.drawRange.count*De,Kt=j!==null?j.start*De:0,wt=j!==null?j.count*De:1/0,vn=Math.max(ut,Kt),fn=Math.min(St,ut+xt,Kt+wt)-1,$t=Math.max(0,fn-vn+1);if($t!==0){if(nt.isMesh)ke.wireframe===!0?(Ft.setLineWidth(ke.wireframeLinewidth*Nt()),lt.setMode(1)):lt.setMode(4);else if(nt.isLine){let un=ke.linewidth;un===void 0&&(un=1),Ft.setLineWidth(un*Nt()),nt.isLineSegments?lt.setMode(1):nt.isLineLoop?lt.setMode(2):lt.setMode(3)}else nt.isPoints?lt.setMode(0):nt.isSprite&&lt.setMode(4);if(nt.isInstancedMesh)lt.renderInstances(vn,$t,nt.count);else if(Ue.isInstancedBufferGeometry){const un=Math.min(Ue.instanceCount,Ue._maxInstanceCount);lt.renderInstances(vn,$t,un)}else lt.render(vn,$t)}},this.compile=function(he,ze){function Ue(ke,nt,j){ke.transparent===!0&&ke.side===er?(ke.side=Ur,ke.needsUpdate=!0,Ja(ke,nt,j),ke.side=Oo,ke.needsUpdate=!0,Ja(ke,nt,j),ke.side=er):Ja(ke,nt,j)}m=me.get(he),m.init(),v.push(m),he.traverseVisible(function(ke){ke.isLight&&ke.layers.test(ze.layers)&&(m.pushLight(ke),ke.castShadow&&m.pushShadow(ke))}),m.setupLights(w.physicallyCorrectLights),he.traverse(function(ke){const nt=ke.material;if(nt)if(Array.isArray(nt))for(let j=0;j<nt.length;j++){const ie=nt[j];Ue(ie,he,ke)}else Ue(nt,he,ke)}),v.pop(),m=null};let Ie=null;function Ct(he){Ie&&Ie(he)}function wn(){Gi.stop()}function di(){Gi.start()}const Gi=new RL;Gi.setAnimationLoop(Ct),typeof self<"u"&&Gi.setContext(self),this.setAnimationLoop=function(he){Ie=he,nn.setAnimationLoop(he),he===null?Gi.stop():Gi.start()},nn.addEventListener("sessionstart",wn),nn.addEventListener("sessionend",di),this.render=function(he,ze){if(ze!==void 0&&ze.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(b===!0)return;he.matrixWorldAutoUpdate===!0&&he.updateMatrixWorld(),ze.parent===null&&ze.matrixWorldAutoUpdate===!0&&ze.updateMatrixWorld(),nn.enabled===!0&&nn.isPresenting===!0&&(nn.cameraAutoUpdate===!0&&nn.updateCamera(ze),ze=nn.getCamera()),he.isScene===!0&&he.onBeforeRender(w,he,ze,M),m=me.get(he,v.length),m.init(),v.push(m),Be.multiplyMatrices(ze.projectionMatrix,ze.matrixWorldInverse),ve.setFromProjectionMatrix(Be),Ae=this.localClippingEnabled,xe=ce.init(this.clippingPlanes,Ae,ze),g=Zn.get(he,A.length),g.init(),A.push(g),jr(he,ze,0,w.sortObjects),g.finish(),w.sortObjects===!0&&g.sort(ee,Q),xe===!0&&ce.beginShadows();const Ue=m.state.shadowsArray;if(Qe.render(Ue,he,ze),xe===!0&&ce.endShadows(),this.info.autoReset===!0&&this.info.reset(),At.render(g,he),m.setupLights(w.physicallyCorrectLights),ze.isArrayCamera){const ke=ze.cameras;for(let nt=0,j=ke.length;nt<j;nt++){const ie=ke[nt];vi(g,he,ie,ie.viewport)}}else vi(g,he,ze);M!==null&&(tt.updateMultisampleRenderTarget(M),tt.updateRenderTargetMipmap(M)),he.isScene===!0&&he.onAfterRender(w,he,ze),Fe.resetDefaultState(),I=-1,T=null,v.pop(),v.length>0?m=v[v.length-1]:m=null,A.pop(),A.length>0?g=A[A.length-1]:g=null};function jr(he,ze,Ue,ke){if(he.visible===!1)return;if(he.layers.test(ze.layers)){if(he.isGroup)Ue=he.renderOrder;else if(he.isLOD)he.autoUpdate===!0&&he.update(ze);else if(he.isLight)m.pushLight(he),he.castShadow&&m.pushShadow(he);else if(he.isSprite){if(!he.frustumCulled||ve.intersectsSprite(he)){ke&&$e.setFromMatrixPosition(he.matrixWorld).applyMatrix4(Be);const ie=Zt.update(he),pe=he.material;pe.visible&&g.push(he,ie,pe,Ue,$e.z,null)}}else if((he.isMesh||he.isLine||he.isPoints)&&(he.isSkinnedMesh&&he.skeleton.frame!==yn.render.frame&&(he.skeleton.update(),he.skeleton.frame=yn.render.frame),!he.frustumCulled||ve.intersectsObject(he))){ke&&$e.setFromMatrixPosition(he.matrixWorld).applyMatrix4(Be);const ie=Zt.update(he),pe=he.material;if(Array.isArray(pe)){const Ee=ie.groups;for(let Ve=0,De=Ee.length;Ve<De;Ve++){const Ze=Ee[Ve],lt=pe[Ze.materialIndex];lt&&lt.visible&&g.push(he,ie,lt,Ue,$e.z,Ze)}}else pe.visible&&g.push(he,ie,pe,Ue,$e.z,null)}}const j=he.children;for(let ie=0,pe=j.length;ie<pe;ie++)jr(j[ie],ze,Ue,ke)}function vi(he,ze,Ue,ke){const nt=he.opaque,j=he.transmissive,ie=he.transparent;m.setupLightsView(Ue),j.length>0&&Ir(nt,ze,Ue),ke&&Ft.viewport(B.copy(ke)),nt.length>0&&js(nt,ze,Ue),j.length>0&&js(j,ze,Ue),ie.length>0&&js(ie,ze,Ue),Ft.buffers.depth.setTest(!0),Ft.buffers.depth.setMask(!0),Ft.buffers.color.setMask(!0),Ft.setPolygonOffset(!1)}function Ir(he,ze,Ue){const ke=pn.isWebGL2;Me===null&&(Me=new Hr(1,1,{generateMipmaps:!0,type:Xt.has("EXT_color_buffer_half_float")?Os:Er,minFilter:fa,samples:ke&&r===!0?4:0})),w.getDrawingBufferSize(Le),ke?Me.setSize(Le.x,Le.y):Me.setSize(Z_(Le.x),Z_(Le.y));const nt=w.getRenderTarget();w.setRenderTarget(Me),w.clear();const j=w.toneMapping;w.toneMapping=ca,js(he,ze,Ue),w.toneMapping=j,tt.updateMultisampleRenderTarget(Me),tt.updateRenderTargetMipmap(Me),w.setRenderTarget(nt)}function js(he,ze,Ue){const ke=ze.isScene===!0?ze.overrideMaterial:null;for(let nt=0,j=he.length;nt<j;nt++){const ie=he[nt],pe=ie.object,Ee=ie.geometry,Ve=ke===null?ie.material:ke,De=ie.group;pe.layers.test(Ue.layers)&&ir(pe,ze,Ue,Ee,Ve,De)}}function ir(he,ze,Ue,ke,nt,j){he.onBeforeRender(w,ze,Ue,ke,nt,j),he.modelViewMatrix.multiplyMatrices(Ue.matrixWorldInverse,he.matrixWorld),he.normalMatrix.getNormalMatrix(he.modelViewMatrix),nt.onBeforeRender(w,ze,Ue,ke,he,j),nt.transparent===!0&&nt.side===er?(nt.side=Ur,nt.needsUpdate=!0,w.renderBufferDirect(Ue,ze,ke,nt,he,j),nt.side=Oo,nt.needsUpdate=!0,w.renderBufferDirect(Ue,ze,ke,nt,he,j),nt.side=er):w.renderBufferDirect(Ue,ze,ke,nt,he,j),he.onAfterRender(w,ze,Ue,ke,nt,j)}function Ja(he,ze,Ue){ze.isScene!==!0&&(ze=yt);const ke=it.get(he),nt=m.state.lights,j=m.state.shadowsArray,ie=nt.state.version,pe=ln.getParameters(he,nt.state,j,ze,Ue),Ee=ln.getProgramCacheKey(pe);let Ve=ke.programs;ke.environment=he.isMeshStandardMaterial?ze.environment:null,ke.fog=ze.fog,ke.envMap=(he.isMeshStandardMaterial?Jt:vt).get(he.envMap||ke.environment),Ve===void 0&&(he.addEventListener("dispose",Ce),Ve=new Map,ke.programs=Ve);let De=Ve.get(Ee);if(De!==void 0){if(ke.currentProgram===De&&ke.lightsStateVersion===ie)return fh(he,pe),De}else pe.uniforms=ln.getUniforms(he),he.onBuild(Ue,pe,w),he.onBeforeCompile(pe,w),De=ln.acquireProgram(pe,Ee),Ve.set(Ee,De),ke.uniforms=pe.uniforms;const Ze=ke.uniforms;(!he.isShaderMaterial&&!he.isRawShaderMaterial||he.clipping===!0)&&(Ze.clippingPlanes=ce.uniform),fh(he,pe),ke.needsLights=Gu(he),ke.lightsStateVersion=ie,ke.needsLights&&(Ze.ambientLightColor.value=nt.state.ambient,Ze.lightProbe.value=nt.state.probe,Ze.directionalLights.value=nt.state.directional,Ze.directionalLightShadows.value=nt.state.directionalShadow,Ze.spotLights.value=nt.state.spot,Ze.spotLightShadows.value=nt.state.spotShadow,Ze.rectAreaLights.value=nt.state.rectArea,Ze.ltc_1.value=nt.state.rectAreaLTC1,Ze.ltc_2.value=nt.state.rectAreaLTC2,Ze.pointLights.value=nt.state.point,Ze.pointLightShadows.value=nt.state.pointShadow,Ze.hemisphereLights.value=nt.state.hemi,Ze.directionalShadowMap.value=nt.state.directionalShadowMap,Ze.directionalShadowMatrix.value=nt.state.directionalShadowMatrix,Ze.spotShadowMap.value=nt.state.spotShadowMap,Ze.spotLightMatrix.value=nt.state.spotLightMatrix,Ze.spotLightMap.value=nt.state.spotLightMap,Ze.pointShadowMap.value=nt.state.pointShadowMap,Ze.pointShadowMatrix.value=nt.state.pointShadowMatrix);const lt=De.getUniforms(),St=E_.seqWithValue(lt.seq,Ze);return ke.currentProgram=De,ke.uniformsList=St,De}function fh(he,ze){const Ue=it.get(he);Ue.outputEncoding=ze.outputEncoding,Ue.instancing=ze.instancing,Ue.skinning=ze.skinning,Ue.morphTargets=ze.morphTargets,Ue.morphNormals=ze.morphNormals,Ue.morphColors=ze.morphColors,Ue.morphTargetsCount=ze.morphTargetsCount,Ue.numClippingPlanes=ze.numClippingPlanes,Ue.numIntersection=ze.numClipIntersection,Ue.vertexAlphas=ze.vertexAlphas,Ue.vertexTangents=ze.vertexTangents,Ue.toneMapping=ze.toneMapping}function mo(he,ze,Ue,ke,nt){ze.isScene!==!0&&(ze=yt),tt.resetTextureUnits();const j=ze.fog,ie=ke.isMeshStandardMaterial?ze.environment:null,pe=M===null?w.outputEncoding:M.isXRRenderTarget===!0?M.texture.encoding:pr,Ee=(ke.isMeshStandardMaterial?Jt:vt).get(ke.envMap||ie),Ve=ke.vertexColors===!0&&!!Ue.attributes.color&&Ue.attributes.color.itemSize===4,De=!!ke.normalMap&&!!Ue.attributes.tangent,Ze=!!Ue.morphAttributes.position,lt=!!Ue.morphAttributes.normal,St=!!Ue.morphAttributes.color,ut=ke.toneMapped?w.toneMapping:ca,xt=Ue.morphAttributes.position||Ue.morphAttributes.normal||Ue.morphAttributes.color,Kt=xt!==void 0?xt.length:0,wt=it.get(ke),vn=m.state.lights;if(xe===!0&&(Ae===!0||he!==T)){const In=he===T&&ke.id===I;ce.setState(ke,he,In)}let fn=!1;ke.version===wt.__version?(wt.needsLights&&wt.lightsStateVersion!==vn.state.version||wt.outputEncoding!==pe||nt.isInstancedMesh&&wt.instancing===!1||!nt.isInstancedMesh&&wt.instancing===!0||nt.isSkinnedMesh&&wt.skinning===!1||!nt.isSkinnedMesh&&wt.skinning===!0||wt.envMap!==Ee||ke.fog===!0&&wt.fog!==j||wt.numClippingPlanes!==void 0&&(wt.numClippingPlanes!==ce.numPlanes||wt.numIntersection!==ce.numIntersection)||wt.vertexAlphas!==Ve||wt.vertexTangents!==De||wt.morphTargets!==Ze||wt.morphNormals!==lt||wt.morphColors!==St||wt.toneMapping!==ut||pn.isWebGL2===!0&&wt.morphTargetsCount!==Kt)&&(fn=!0):(fn=!0,wt.__version=ke.version);let $t=wt.currentProgram;fn===!0&&($t=Ja(ke,ze,nt));let un=!1,Fn=!1,Ci=!1;const Kn=$t.getUniforms(),Wi=wt.uniforms;if(Ft.useProgram($t.program)&&(un=!0,Fn=!0,Ci=!0),ke.id!==I&&(I=ke.id,Fn=!0),un||T!==he){if(Kn.setValue(He,"projectionMatrix",he.projectionMatrix),pn.logarithmicDepthBuffer&&Kn.setValue(He,"logDepthBufFC",2/(Math.log(he.far+1)/Math.LN2)),T!==he&&(T=he,Fn=!0,Ci=!0),ke.isShaderMaterial||ke.isMeshPhongMaterial||ke.isMeshToonMaterial||ke.isMeshStandardMaterial||ke.envMap){const In=Kn.map.cameraPosition;In!==void 0&&In.setValue(He,$e.setFromMatrixPosition(he.matrixWorld))}(ke.isMeshPhongMaterial||ke.isMeshToonMaterial||ke.isMeshLambertMaterial||ke.isMeshBasicMaterial||ke.isMeshStandardMaterial||ke.isShaderMaterial)&&Kn.setValue(He,"isOrthographic",he.isOrthographicCamera===!0),(ke.isMeshPhongMaterial||ke.isMeshToonMaterial||ke.isMeshLambertMaterial||ke.isMeshBasicMaterial||ke.isMeshStandardMaterial||ke.isShaderMaterial||ke.isShadowMaterial||nt.isSkinnedMesh)&&Kn.setValue(He,"viewMatrix",he.matrixWorldInverse)}if(nt.isSkinnedMesh){Kn.setOptional(He,nt,"bindMatrix"),Kn.setOptional(He,nt,"bindMatrixInverse");const In=nt.skeleton;In&&(pn.floatVertexTextures?(In.boneTexture===null&&In.computeBoneTexture(),Kn.setValue(He,"boneTexture",In.boneTexture,tt),Kn.setValue(He,"boneTextureSize",In.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const fi=Ue.morphAttributes;if((fi.position!==void 0||fi.normal!==void 0||fi.color!==void 0&&pn.isWebGL2===!0)&&pt.update(nt,Ue,ke,$t),(Fn||wt.receiveShadow!==nt.receiveShadow)&&(wt.receiveShadow=nt.receiveShadow,Kn.setValue(He,"receiveShadow",nt.receiveShadow)),ke.isMeshGouraudMaterial&&ke.envMap!==null&&(Wi.envMap.value=Ee,Wi.flipEnvMap.value=Ee.isCubeTexture&&Ee.isRenderTargetTexture===!1?-1:1),Fn&&(Kn.setValue(He,"toneMappingExposure",w.toneMappingExposure),wt.needsLights&&Rr(Wi,Ci),j&&ke.fog===!0&&ii.refreshFogUniforms(Wi,j),ii.refreshMaterialUniforms(Wi,ke,J,W,Me),E_.upload(He,wt.uniformsList,Wi,tt)),ke.isShaderMaterial&&ke.uniformsNeedUpdate===!0&&(E_.upload(He,wt.uniformsList,Wi,tt),ke.uniformsNeedUpdate=!1),ke.isSpriteMaterial&&Kn.setValue(He,"center",nt.center),Kn.setValue(He,"modelViewMatrix",nt.modelViewMatrix),Kn.setValue(He,"normalMatrix",nt.normalMatrix),Kn.setValue(He,"modelMatrix",nt.matrixWorld),ke.isShaderMaterial||ke.isRawShaderMaterial){const In=ke.uniformsGroups;for(let Li=0,zs=In.length;Li<zs;Li++)if(pn.isWebGL2){const Yi=In[Li];bt.update(Yi,$t),bt.bind(Yi,$t)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return $t}function Rr(he,ze){he.ambientLightColor.needsUpdate=ze,he.lightProbe.needsUpdate=ze,he.directionalLights.needsUpdate=ze,he.directionalLightShadows.needsUpdate=ze,he.pointLights.needsUpdate=ze,he.pointLightShadows.needsUpdate=ze,he.spotLights.needsUpdate=ze,he.spotLightShadows.needsUpdate=ze,he.rectAreaLights.needsUpdate=ze,he.hemisphereLights.needsUpdate=ze}function Gu(he){return he.isMeshLambertMaterial||he.isMeshToonMaterial||he.isMeshPhongMaterial||he.isMeshStandardMaterial||he.isShadowMaterial||he.isShaderMaterial&&he.lights===!0}this.getActiveCubeFace=function(){return S},this.getActiveMipmapLevel=function(){return R},this.getRenderTarget=function(){return M},this.setRenderTargetTextures=function(he,ze,Ue){it.get(he.texture).__webglTexture=ze,it.get(he.depthTexture).__webglTexture=Ue;const ke=it.get(he);ke.__hasExternalTextures=!0,ke.__hasExternalTextures&&(ke.__autoAllocateDepthBuffer=Ue===void 0,ke.__autoAllocateDepthBuffer||Xt.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),ke.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(he,ze){const Ue=it.get(he);Ue.__webglFramebuffer=ze,Ue.__useDefaultFramebuffer=ze===void 0},this.setRenderTarget=function(he,ze=0,Ue=0){M=he,S=ze,R=Ue;let ke=!0;if(he){const Ee=it.get(he);Ee.__useDefaultFramebuffer!==void 0?(Ft.bindFramebuffer(36160,null),ke=!1):Ee.__webglFramebuffer===void 0?tt.setupRenderTarget(he):Ee.__hasExternalTextures&&tt.rebindTextures(he,it.get(he.texture).__webglTexture,it.get(he.depthTexture).__webglTexture)}let nt=null,j=!1,ie=!1;if(he){const Ee=he.texture;(Ee.isData3DTexture||Ee.isDataArrayTexture)&&(ie=!0);const Ve=it.get(he).__webglFramebuffer;he.isWebGLCubeRenderTarget?(nt=Ve[ze],j=!0):pn.isWebGL2&&he.samples>0&&tt.useMultisampledRTT(he)===!1?nt=it.get(he).__webglMultisampledFramebuffer:nt=Ve,B.copy(he.viewport),F.copy(he.scissor),D=he.scissorTest}else B.copy(Y).multiplyScalar(J).floor(),F.copy(se).multiplyScalar(J).floor(),D=ae;if(Ft.bindFramebuffer(36160,nt)&&pn.drawBuffers&&ke&&Ft.drawBuffers(he,nt),Ft.viewport(B),Ft.scissor(F),Ft.setScissorTest(D),j){const Ee=it.get(he.texture);He.framebufferTexture2D(36160,36064,34069+ze,Ee.__webglTexture,Ue)}else if(ie){const Ee=it.get(he.texture),Ve=ze||0;He.framebufferTextureLayer(36160,36064,Ee.__webglTexture,Ue||0,Ve)}I=-1},this.readRenderTargetPixels=function(he,ze,Ue,ke,nt,j,ie){if(!(he&&he.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let pe=it.get(he).__webglFramebuffer;if(he.isWebGLCubeRenderTarget&&ie!==void 0&&(pe=pe[ie]),pe){Ft.bindFramebuffer(36160,pe);try{const Ee=he.texture,Ve=Ee.format,De=Ee.type;if(Ve!==us&&we.convert(Ve)!==He.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const Ze=De===Os&&(Xt.has("EXT_color_buffer_half_float")||pn.isWebGL2&&Xt.has("EXT_color_buffer_float"));if(De!==Er&&we.convert(De)!==He.getParameter(35738)&&!(De===Ms&&(pn.isWebGL2||Xt.has("OES_texture_float")||Xt.has("WEBGL_color_buffer_float")))&&!Ze){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}ze>=0&&ze<=he.width-ke&&Ue>=0&&Ue<=he.height-nt&&He.readPixels(ze,Ue,ke,nt,we.convert(Ve),we.convert(De),j)}finally{const Ee=M!==null?it.get(M).__webglFramebuffer:null;Ft.bindFramebuffer(36160,Ee)}}},this.copyFramebufferToTexture=function(he,ze,Ue=0){const ke=Math.pow(2,-Ue),nt=Math.floor(ze.image.width*ke),j=Math.floor(ze.image.height*ke);tt.setTexture2D(ze,0),He.copyTexSubImage2D(3553,Ue,0,0,he.x,he.y,nt,j),Ft.unbindTexture()},this.copyTextureToTexture=function(he,ze,Ue,ke=0){const nt=ze.image.width,j=ze.image.height,ie=we.convert(Ue.format),pe=we.convert(Ue.type);tt.setTexture2D(Ue,0),He.pixelStorei(37440,Ue.flipY),He.pixelStorei(37441,Ue.premultiplyAlpha),He.pixelStorei(3317,Ue.unpackAlignment),ze.isDataTexture?He.texSubImage2D(3553,ke,he.x,he.y,nt,j,ie,pe,ze.image.data):ze.isCompressedTexture?He.compressedTexSubImage2D(3553,ke,he.x,he.y,ze.mipmaps[0].width,ze.mipmaps[0].height,ie,ze.mipmaps[0].data):He.texSubImage2D(3553,ke,he.x,he.y,ie,pe,ze.image),ke===0&&Ue.generateMipmaps&&He.generateMipmap(3553),Ft.unbindTexture()},this.copyTextureToTexture3D=function(he,ze,Ue,ke,nt=0){if(w.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const j=he.max.x-he.min.x+1,ie=he.max.y-he.min.y+1,pe=he.max.z-he.min.z+1,Ee=we.convert(ke.format),Ve=we.convert(ke.type);let De;if(ke.isData3DTexture)tt.setTexture3D(ke,0),De=32879;else if(ke.isDataArrayTexture)tt.setTexture2DArray(ke,0),De=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}He.pixelStorei(37440,ke.flipY),He.pixelStorei(37441,ke.premultiplyAlpha),He.pixelStorei(3317,ke.unpackAlignment);const Ze=He.getParameter(3314),lt=He.getParameter(32878),St=He.getParameter(3316),ut=He.getParameter(3315),xt=He.getParameter(32877),Kt=Ue.isCompressedTexture?Ue.mipmaps[0]:Ue.image;He.pixelStorei(3314,Kt.width),He.pixelStorei(32878,Kt.height),He.pixelStorei(3316,he.min.x),He.pixelStorei(3315,he.min.y),He.pixelStorei(32877,he.min.z),Ue.isDataTexture||Ue.isData3DTexture?He.texSubImage3D(De,nt,ze.x,ze.y,ze.z,j,ie,pe,Ee,Ve,Kt.data):Ue.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),He.compressedTexSubImage3D(De,nt,ze.x,ze.y,ze.z,j,ie,pe,Ee,Kt.data)):He.texSubImage3D(De,nt,ze.x,ze.y,ze.z,j,ie,pe,Ee,Ve,Kt),He.pixelStorei(3314,Ze),He.pixelStorei(32878,lt),He.pixelStorei(3316,St),He.pixelStorei(3315,ut),He.pixelStorei(32877,xt),nt===0&&ke.generateMipmaps&&He.generateMipmap(De),Ft.unbindTexture()},this.initTexture=function(he){he.isCubeTexture?tt.setTextureCube(he,0):he.isData3DTexture?tt.setTexture3D(he,0):he.isDataArrayTexture?tt.setTexture2DArray(he,0):tt.setTexture2D(he,0),Ft.unbindTexture()},this.resetState=function(){S=0,R=0,M=null,Ft.reset(),Fe.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}class kL extends Ag{}kL.prototype.isWebGL1Renderer=!0;class Py{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new _e(e),this.density=t}clone(){return new Py(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}class By{constructor(e,t=1,n=1e3){this.isFog=!0,this.name="",this.color=new _e(e),this.near=t,this.far=n}clone(){return new By(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}class vu extends qt{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),t}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(e){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=e}}class _g{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=Wm,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=so()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let i=0,r=this.stride;i<r;i++)this.array[e+i]=t.array[n+i];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=so()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=so()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const xr=new q;class Xl{constructor(e,t,n,i=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=i===!0}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)xr.fromBufferAttribute(this,t),xr.applyMatrix4(e),this.setXYZ(t,xr.x,xr.y,xr.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)xr.fromBufferAttribute(this,t),xr.applyNormalMatrix(e),this.setXYZ(t,xr.x,xr.y,xr.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)xr.fromBufferAttribute(this,t),xr.transformDirection(e),this.setXYZ(t,xr.x,xr.y,xr.z);return this}setX(e,t){return this.normalized&&(t=zi(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=zi(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=zi(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=zi(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=Tc(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=Tc(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=Tc(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=Tc(t,this.array)),t}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=zi(t,this.array),n=zi(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=zi(t,this.array),n=zi(n,this.array),i=zi(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=zi(t,this.array),n=zi(n,this.array),i=zi(i,this.array),r=zi(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this.data.array[e+3]=r,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will deinterleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const i=n*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[i+r])}return new Jn(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Xl(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will deinterleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const i=n*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[i+r])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class _C extends Ts{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new _e(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let kd;const qp=new q,Nd=new q,Ud=new q,zd=new Xe,Xp=new Xe,NL=new xn,L0=new q,Yp=new q,D0=new q,WI=new Xe,Dw=new Xe,QI=new Xe;class UL extends qt{constructor(e){if(super(),this.isSprite=!0,this.type="Sprite",kd===void 0){kd=new Sn;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),n=new _g(t,5);kd.setIndex([0,1,2,0,2,3]),kd.setAttribute("position",new Xl(n,3,0,!1)),kd.setAttribute("uv",new Xl(n,2,3,!1))}this.geometry=kd,this.material=e!==void 0?e:new _C,this.center=new Xe(.5,.5)}raycast(e,t){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Nd.setFromMatrixScale(this.matrixWorld),NL.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Ud.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Nd.multiplyScalar(-Ud.z);const n=this.material.rotation;let i,r;n!==0&&(r=Math.cos(n),i=Math.sin(n));const o=this.center;O0(L0.set(-.5,-.5,0),Ud,o,Nd,i,r),O0(Yp.set(.5,-.5,0),Ud,o,Nd,i,r),O0(D0.set(.5,.5,0),Ud,o,Nd,i,r),WI.set(0,0),Dw.set(1,0),QI.set(1,1);let l=e.ray.intersectTriangle(L0,Yp,D0,!1,qp);if(l===null&&(O0(Yp.set(-.5,.5,0),Ud,o,Nd,i,r),Dw.set(0,1),l=e.ray.intersectTriangle(L0,D0,Yp,!1,qp),l===null))return;const h=e.ray.origin.distanceTo(qp);h<e.near||h>e.far||t.push({distance:h,point:qp.clone(),uv:Bo.getUV(qp,L0,Yp,D0,WI,Dw,QI,new Xe),face:null,object:this})}copy(e,t){return super.copy(e,t),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function O0(a,e,t,n,i,r){zd.subVectors(a,t).addScalar(.5).multiply(n),i!==void 0?(Xp.x=r*zd.x-i*zd.y,Xp.y=i*zd.x+r*zd.y):Xp.copy(zd),a.copy(e),a.x+=Xp.x,a.y+=Xp.y,a.applyMatrix4(NL)}const F0=new q,jI=new q;class yC extends qt{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let n=0,i=t.length;n<i;n++){const r=t[n];this.addLevel(r.object.clone(),r.distance)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0){t=Math.abs(t);const n=this.levels;let i;for(i=0;i<n.length&&!(t<n[i].distance);i++);return n.splice(i,0,{distance:t,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let n,i;for(n=1,i=t.length;n<i&&!(e<t[n].distance);n++);return t[n-1].object}return null}raycast(e,t){if(this.levels.length>0){F0.setFromMatrixPosition(this.matrixWorld);const i=e.ray.origin.distanceTo(F0);this.getObjectForDistance(i).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){F0.setFromMatrixPosition(e.matrixWorld),jI.setFromMatrixPosition(this.matrixWorld);const n=F0.distanceTo(jI)/e.zoom;t[0].object.visible=!0;let i,r;for(i=1,r=t.length;i<r&&n>=t[i].distance;i++)t[i-1].object.visible=!1,t[i].object.visible=!0;for(this._currentLevel=i-1;i<r;i++)t[i].object.visible=!1}}toJSON(e){const t=super.toJSON(e);this.autoUpdate===!1&&(t.object.autoUpdate=!1),t.object.levels=[];const n=this.levels;for(let i=0,r=n.length;i<r;i++){const o=n[i];t.object.levels.push({object:o.object.uuid,distance:o.distance})}return t}}const qI=new q,XI=new On,YI=new On,x6=new q,JI=new xn;class vC extends _t{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new xn,this.bindMatrixInverse=new xn}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new On,t=this.geometry.attributes.skinWeight;for(let n=0,i=t.count;n<i;n++){e.fromBufferAttribute(t,n);const r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){const n=this.skeleton,i=this.geometry;XI.fromBufferAttribute(i.attributes.skinIndex,e),YI.fromBufferAttribute(i.attributes.skinWeight,e),qI.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let r=0;r<4;r++){const o=YI.getComponent(r);if(o!==0){const l=XI.getComponent(r);JI.multiplyMatrices(n.bones[l].matrixWorld,n.boneInverses[l]),t.addScaledVector(x6.copy(qI).applyMatrix4(JI),o)}}return t.applyMatrix4(this.bindMatrixInverse)}}class Ly extends qt{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Na extends Vi{constructor(e=null,t=1,n=1,i,r,o,l,h,u=Ki,f=Ki,g,m){super(null,o,l,h,u,f,i,r,g,m),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const ZI=new xn,w6=new xn;class yg{constructor(e=[],t=[]){this.uuid=so(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let n=0,i=this.bones.length;n<i;n++)this.boneInverses.push(new xn)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const n=new xn;this.bones[e]&&n.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(n)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&n.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&(n.parent&&n.parent.isBone?(n.matrix.copy(n.parent.matrixWorld).invert(),n.matrix.multiply(n.matrixWorld)):n.matrix.copy(n.matrixWorld),n.matrix.decompose(n.position,n.quaternion,n.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,i=this.boneTexture;for(let r=0,o=e.length;r<o;r++){const l=e[r]?e[r].matrixWorld:w6;ZI.multiplyMatrices(l,t[r]),ZI.toArray(n,r*16)}i!==null&&(i.needsUpdate=!0)}clone(){return new yg(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=SL(e),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new Na(t,e,e,us,Ms);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const i=this.bones[t];if(i.name===e)return i}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,i=e.bones.length;n<i;n++){const r=e.bones[n];let o=t[r];o===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),o=new Ly),this.bones.push(o),this.boneInverses.push(new xn().fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let i=0,r=t.length;i<r;i++){const o=t[i];e.bones.push(o.uuid);const l=n[i];e.boneInverses.push(l.toArray())}return e}}class vf extends Jn{constructor(e,t,n,i=1){super(e,t,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const KI=new xn,$I=new xn,k0=[],Jp=new _t;class xC extends _t{constructor(e,t,n){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new vf(new Float32Array(n*16),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}raycast(e,t){const n=this.matrixWorld,i=this.count;if(Jp.geometry=this.geometry,Jp.material=this.material,Jp.material!==void 0)for(let r=0;r<i;r++){this.getMatrixAt(r,KI),$I.multiplyMatrices(n,KI),Jp.matrixWorld=$I,Jp.raycast(e,k0);for(let o=0,l=k0.length;o<l;o++){const h=k0[o];h.instanceId=r,h.object=this,t.push(h)}k0.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new vf(new Float32Array(this.instanceMatrix.count*3),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class Is extends Ts{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new _e(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const eR=new q,tR=new q,nR=new xn,Ow=new Pu,N0=new Qa;class Ss extends qt{constructor(e=new Sn,t=new Is){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[0];for(let i=1,r=t.count;i<r;i++)eR.fromBufferAttribute(t,i-1),tR.fromBufferAttribute(t,i),n[i]=n[i-1],n[i]+=eR.distanceTo(tR);e.setAttribute("lineDistance",new tn(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,r=e.params.Line.threshold,o=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),N0.copy(n.boundingSphere),N0.applyMatrix4(i),N0.radius+=r,e.ray.intersectsSphere(N0)===!1)return;nR.copy(i).invert(),Ow.copy(e.ray).applyMatrix4(nR);const l=r/((this.scale.x+this.scale.y+this.scale.z)/3),h=l*l,u=new q,f=new q,g=new q,m=new q,A=this.isLineSegments?2:1,v=n.index,b=n.attributes.position;if(v!==null){const S=Math.max(0,o.start),R=Math.min(v.count,o.start+o.count);for(let M=S,I=R-1;M<I;M+=A){const T=v.getX(M),B=v.getX(M+1);if(u.fromBufferAttribute(b,T),f.fromBufferAttribute(b,B),Ow.distanceSqToSegment(u,f,m,g)>h)continue;m.applyMatrix4(this.matrixWorld);const D=e.ray.origin.distanceTo(m);D<e.near||D>e.far||t.push({distance:D,point:g.clone().applyMatrix4(this.matrixWorld),index:M,face:null,faceIndex:null,object:this})}}else{const S=Math.max(0,o.start),R=Math.min(b.count,o.start+o.count);for(let M=S,I=R-1;M<I;M+=A){if(u.fromBufferAttribute(b,M),f.fromBufferAttribute(b,M+1),Ow.distanceSqToSegment(u,f,m,g)>h)continue;m.applyMatrix4(this.matrixWorld);const B=e.ray.origin.distanceTo(m);B<e.near||B>e.far||t.push({distance:B,point:g.clone().applyMatrix4(this.matrixWorld),index:M,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const i=t[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=i.length;r<o;r++){const l=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[l]=r}}}}}const iR=new q,sR=new q;class zo extends Ss{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[];for(let i=0,r=t.count;i<r;i+=2)iR.fromBufferAttribute(t,i),sR.fromBufferAttribute(t,i+1),n[i]=i===0?0:n[i-1],n[i+1]=n[i]+iR.distanceTo(sR);e.setAttribute("lineDistance",new tn(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class wC extends Ss{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class vg extends Ts{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new _e(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const rR=new xn,rE=new Pu,U0=new Qa,z0=new q;class Dy extends qt{constructor(e=new Sn,t=new vg){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,r=e.params.Points.threshold,o=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),U0.copy(n.boundingSphere),U0.applyMatrix4(i),U0.radius+=r,e.ray.intersectsSphere(U0)===!1)return;rR.copy(i).invert(),rE.copy(e.ray).applyMatrix4(rR);const l=r/((this.scale.x+this.scale.y+this.scale.z)/3),h=l*l,u=n.index,g=n.attributes.position;if(u!==null){const m=Math.max(0,o.start),A=Math.min(u.count,o.start+o.count);for(let v=m,w=A;v<w;v++){const b=u.getX(v);z0.fromBufferAttribute(g,b),oR(z0,b,h,i,e,t,this)}}else{const m=Math.max(0,o.start),A=Math.min(g.count,o.start+o.count);for(let v=m,w=A;v<w;v++)z0.fromBufferAttribute(g,v),oR(z0,v,h,i,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const i=t[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=i.length;r<o;r++){const l=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[l]=r}}}}}function oR(a,e,t,n,i,r,o){const l=rE.distanceSqToPoint(a);if(l<t){const h=new q;rE.closestPointToPoint(a,h),h.applyMatrix4(n);const u=i.ray.origin.distanceTo(h);if(u<i.near||u>i.far)return;r.push({distance:u,distanceToRay:Math.sqrt(l),point:h,index:e,face:null,object:o})}}class zL extends Vi{constructor(e,t,n,i,r,o,l,h,u){super(e,t,n,i,r,o,l,h,u),this.isVideoTexture=!0,this.minFilter=o!==void 0?o:yi,this.magFilter=r!==void 0?r:yi,this.generateMipmaps=!1;const f=this;function g(){f.needsUpdate=!0,e.requestVideoFrameCallback(g)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(g)}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class b6 extends Vi{constructor(e,t,n){super({width:e,height:t}),this.isFramebufferTexture=!0,this.format=n,this.magFilter=Ki,this.minFilter=Ki,this.generateMipmaps=!1,this.needsUpdate=!0}}class Bl extends Vi{constructor(e,t,n,i,r,o,l,h,u,f,g,m){super(null,o,l,h,u,f,i,r,g,m),this.isCompressedTexture=!0,this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class bC extends Vi{constructor(e,t,n,i,r,o,l,h,u){super(e,t,n,i,r,o,l,h,u),this.isCanvasTexture=!0,this.needsUpdate=!0}}class pa{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,i=this.getPoint(0),r=0;t.push(0);for(let o=1;o<=e;o++)n=this.getPoint(o/e),r+=n.distanceTo(i),t.push(r),i=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const n=this.getLengths();let i=0;const r=n.length;let o;t?o=t:o=e*n[r-1];let l=0,h=r-1,u;for(;l<=h;)if(i=Math.floor(l+(h-l)/2),u=n[i]-o,u<0)l=i+1;else if(u>0)h=i-1;else{h=i;break}if(i=h,n[i]===o)return i/(r-1);const f=n[i],m=n[i+1]-f,A=(o-f)/m;return(i+A)/(r-1)}getTangent(e,t){let i=e-1e-4,r=e+1e-4;i<0&&(i=0),r>1&&(r=1);const o=this.getPoint(i),l=this.getPoint(r),h=t||(o.isVector2?new Xe:new q);return h.copy(l).sub(o).normalize(),h}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t){const n=new q,i=[],r=[],o=[],l=new q,h=new xn;for(let A=0;A<=e;A++){const v=A/e;i[A]=this.getTangentAt(v,new q)}r[0]=new q,o[0]=new q;let u=Number.MAX_VALUE;const f=Math.abs(i[0].x),g=Math.abs(i[0].y),m=Math.abs(i[0].z);f<=u&&(u=f,n.set(1,0,0)),g<=u&&(u=g,n.set(0,1,0)),m<=u&&n.set(0,0,1),l.crossVectors(i[0],n).normalize(),r[0].crossVectors(i[0],l),o[0].crossVectors(i[0],r[0]);for(let A=1;A<=e;A++){if(r[A]=r[A-1].clone(),o[A]=o[A-1].clone(),l.crossVectors(i[A-1],i[A]),l.length()>Number.EPSILON){l.normalize();const v=Math.acos(As(i[A-1].dot(i[A]),-1,1));r[A].applyMatrix4(h.makeRotationAxis(l,v))}o[A].crossVectors(i[A],r[A])}if(t===!0){let A=Math.acos(As(r[0].dot(r[e]),-1,1));A/=e,i[0].dot(l.crossVectors(r[0],r[e]))>0&&(A=-A);for(let v=1;v<=e;v++)r[v].applyMatrix4(h.makeRotationAxis(i[v],A*v)),o[v].crossVectors(i[v],r[v])}return{tangents:i,normals:r,binormals:o}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class Oy extends pa{constructor(e=0,t=0,n=1,i=1,r=0,o=Math.PI*2,l=!1,h=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=i,this.aStartAngle=r,this.aEndAngle=o,this.aClockwise=l,this.aRotation=h}getPoint(e,t){const n=t||new Xe,i=Math.PI*2;let r=this.aEndAngle-this.aStartAngle;const o=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=i;for(;r>i;)r-=i;r<Number.EPSILON&&(o?r=0:r=i),this.aClockwise===!0&&!o&&(r===i?r=-i:r=r-i);const l=this.aStartAngle+e*r;let h=this.aX+this.xRadius*Math.cos(l),u=this.aY+this.yRadius*Math.sin(l);if(this.aRotation!==0){const f=Math.cos(this.aRotation),g=Math.sin(this.aRotation),m=h-this.aX,A=u-this.aY;h=m*f-A*g+this.aX,u=m*g+A*f+this.aY}return n.set(h,u)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class GL extends Oy{constructor(e,t,n,i,r,o){super(e,t,n,n,i,r,o),this.isArcCurve=!0,this.type="ArcCurve"}}function EC(){let a=0,e=0,t=0,n=0;function i(r,o,l,h){a=r,e=l,t=-3*r+3*o-2*l-h,n=2*r-2*o+l+h}return{initCatmullRom:function(r,o,l,h,u){i(o,l,u*(l-r),u*(h-o))},initNonuniformCatmullRom:function(r,o,l,h,u,f,g){let m=(o-r)/u-(l-r)/(u+f)+(l-o)/f,A=(l-o)/f-(h-o)/(f+g)+(h-l)/g;m*=f,A*=f,i(o,l,m,A)},calc:function(r){const o=r*r,l=o*r;return a+e*r+t*o+n*l}}}const G0=new q,Fw=new EC,kw=new EC,Nw=new EC;class HL extends pa{constructor(e=[],t=!1,n="centripetal",i=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=i}getPoint(e,t=new q){const n=t,i=this.points,r=i.length,o=(r-(this.closed?0:1))*e;let l=Math.floor(o),h=o-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/r)+1)*r:h===0&&l===r-1&&(l=r-2,h=1);let u,f;this.closed||l>0?u=i[(l-1)%r]:(G0.subVectors(i[0],i[1]).add(i[0]),u=G0);const g=i[l%r],m=i[(l+1)%r];if(this.closed||l+2<r?f=i[(l+2)%r]:(G0.subVectors(i[r-1],i[r-2]).add(i[r-1]),f=G0),this.curveType==="centripetal"||this.curveType==="chordal"){const A=this.curveType==="chordal"?.5:.25;let v=Math.pow(u.distanceToSquared(g),A),w=Math.pow(g.distanceToSquared(m),A),b=Math.pow(m.distanceToSquared(f),A);w<1e-4&&(w=1),v<1e-4&&(v=w),b<1e-4&&(b=w),Fw.initNonuniformCatmullRom(u.x,g.x,m.x,f.x,v,w,b),kw.initNonuniformCatmullRom(u.y,g.y,m.y,f.y,v,w,b),Nw.initNonuniformCatmullRom(u.z,g.z,m.z,f.z,v,w,b)}else this.curveType==="catmullrom"&&(Fw.initCatmullRom(u.x,g.x,m.x,f.x,this.tension),kw.initCatmullRom(u.y,g.y,m.y,f.y,this.tension),Nw.initCatmullRom(u.z,g.z,m.z,f.z,this.tension));return n.set(Fw.calc(h),kw.calc(h),Nw.calc(h)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const i=e.points[t];this.points.push(i.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const i=this.points[t];e.points.push(i.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const i=e.points[t];this.points.push(new q().fromArray(i))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function aR(a,e,t,n,i){const r=(n-e)*.5,o=(i-t)*.5,l=a*a,h=a*l;return(2*t-2*n+r+o)*h+(-3*t+3*n-2*r-o)*l+r*a+t}function E6(a,e){const t=1-a;return t*t*e}function C6(a,e){return 2*(1-a)*a*e}function S6(a,e){return a*a*e}function Sm(a,e,t,n){return E6(a,e)+C6(a,t)+S6(a,n)}function M6(a,e){const t=1-a;return t*t*t*e}function T6(a,e){const t=1-a;return 3*t*t*a*e}function I6(a,e){return 3*(1-a)*a*a*e}function R6(a,e){return a*a*a*e}function Mm(a,e,t,n,i){return M6(a,e)+T6(a,t)+I6(a,n)+R6(a,i)}class CC extends pa{constructor(e=new Xe,t=new Xe,n=new Xe,i=new Xe){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e,t=new Xe){const n=t,i=this.v0,r=this.v1,o=this.v2,l=this.v3;return n.set(Mm(e,i.x,r.x,o.x,l.x),Mm(e,i.y,r.y,o.y,l.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class VL extends pa{constructor(e=new q,t=new q,n=new q,i=new q){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e,t=new q){const n=t,i=this.v0,r=this.v1,o=this.v2,l=this.v3;return n.set(Mm(e,i.x,r.x,o.x,l.x),Mm(e,i.y,r.y,o.y,l.y),Mm(e,i.z,r.z,o.z,l.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class Fy extends pa{constructor(e=new Xe,t=new Xe){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new Xe){const n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){const n=t||new Xe;return n.copy(this.v2).sub(this.v1).normalize(),n}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class WL extends pa{constructor(e=new q,t=new q){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new q){const n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class SC extends pa{constructor(e=new Xe,t=new Xe,n=new Xe){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new Xe){const n=t,i=this.v0,r=this.v1,o=this.v2;return n.set(Sm(e,i.x,r.x,o.x),Sm(e,i.y,r.y,o.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class MC extends pa{constructor(e=new q,t=new q,n=new q){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new q){const n=t,i=this.v0,r=this.v1,o=this.v2;return n.set(Sm(e,i.x,r.x,o.x),Sm(e,i.y,r.y,o.y),Sm(e,i.z,r.z,o.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class TC extends pa{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new Xe){const n=t,i=this.points,r=(i.length-1)*e,o=Math.floor(r),l=r-o,h=i[o===0?o:o-1],u=i[o],f=i[o>i.length-2?i.length-1:o+1],g=i[o>i.length-3?i.length-1:o+2];return n.set(aR(l,h.x,u.x,f.x,g.x),aR(l,h.y,u.y,f.y,g.y)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const i=e.points[t];this.points.push(i.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const i=this.points[t];e.points.push(i.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const i=e.points[t];this.points.push(new Xe().fromArray(i))}return this}}var IC=Object.freeze({__proto__:null,ArcCurve:GL,CatmullRomCurve3:HL,CubicBezierCurve:CC,CubicBezierCurve3:VL,EllipseCurve:Oy,LineCurve:Fy,LineCurve3:WL,QuadraticBezierCurve:SC,QuadraticBezierCurve3:MC,SplineCurve:TC});class QL extends pa{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Fy(t,e))}getPoint(e,t){const n=e*this.getLength(),i=this.getCurveLengths();let r=0;for(;r<i.length;){if(i[r]>=n){const o=i[r]-n,l=this.curves[r],h=l.getLength(),u=h===0?0:1-o/h;return l.getPointAt(u,t)}r++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,i=this.curves.length;n<i;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let n;for(let i=0,r=this.curves;i<r.length;i++){const o=r[i],l=o.isEllipseCurve?e*2:o.isLineCurve||o.isLineCurve3?1:o.isSplineCurve?e*o.points.length:e,h=o.getPoints(l);for(let u=0;u<h.length;u++){const f=h[u];n&&n.equals(f)||(t.push(f),n=f)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const i=e.curves[t];this.curves.push(i.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const i=this.curves[t];e.curves.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const i=e.curves[t];this.curves.push(new IC[i.type]().fromJSON(i))}return this}}class qm extends QL{constructor(e){super(),this.type="Path",this.currentPoint=new Xe,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const n=new Fy(this.currentPoint.clone(),new Xe(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,i){const r=new SC(this.currentPoint.clone(),new Xe(e,t),new Xe(n,i));return this.curves.push(r),this.currentPoint.set(n,i),this}bezierCurveTo(e,t,n,i,r,o){const l=new CC(this.currentPoint.clone(),new Xe(e,t),new Xe(n,i),new Xe(r,o));return this.curves.push(l),this.currentPoint.set(r,o),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),n=new TC(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,i,r,o){const l=this.currentPoint.x,h=this.currentPoint.y;return this.absarc(e+l,t+h,n,i,r,o),this}absarc(e,t,n,i,r,o){return this.absellipse(e,t,n,n,i,r,o),this}ellipse(e,t,n,i,r,o,l,h){const u=this.currentPoint.x,f=this.currentPoint.y;return this.absellipse(e+u,t+f,n,i,r,o,l,h),this}absellipse(e,t,n,i,r,o,l,h){const u=new Oy(e,t,n,i,r,o,l,h);if(this.curves.length>0){const g=u.getPoint(0);g.equals(this.currentPoint)||this.lineTo(g.x,g.y)}this.curves.push(u);const f=u.getPoint(1);return this.currentPoint.copy(f),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class If extends Sn{constructor(e=[new Xe(0,-.5),new Xe(.5,0),new Xe(0,.5)],t=12,n=0,i=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:i},t=Math.floor(t),i=As(i,0,Math.PI*2);const r=[],o=[],l=[],h=[],u=[],f=1/t,g=new q,m=new Xe,A=new q,v=new q,w=new q;let b=0,S=0;for(let R=0;R<=e.length-1;R++)switch(R){case 0:b=e[R+1].x-e[R].x,S=e[R+1].y-e[R].y,A.x=S*1,A.y=-b,A.z=S*0,w.copy(A),A.normalize(),h.push(A.x,A.y,A.z);break;case e.length-1:h.push(w.x,w.y,w.z);break;default:b=e[R+1].x-e[R].x,S=e[R+1].y-e[R].y,A.x=S*1,A.y=-b,A.z=S*0,v.copy(A),A.x+=w.x,A.y+=w.y,A.z+=w.z,A.normalize(),h.push(A.x,A.y,A.z),w.copy(v)}for(let R=0;R<=t;R++){const M=n+R*f*i,I=Math.sin(M),T=Math.cos(M);for(let B=0;B<=e.length-1;B++){g.x=e[B].x*I,g.y=e[B].y,g.z=e[B].x*T,o.push(g.x,g.y,g.z),m.x=R/t,m.y=B/(e.length-1),l.push(m.x,m.y);const F=h[3*B+0]*I,D=h[3*B+1],U=h[3*B+0]*T;u.push(F,D,U)}}for(let R=0;R<t;R++)for(let M=0;M<e.length-1;M++){const I=M+R*e.length,T=I,B=I+e.length,F=I+e.length+1,D=I+1;r.push(T,B,D),r.push(F,D,B)}this.setIndex(r),this.setAttribute("position",new tn(o,3)),this.setAttribute("uv",new tn(l,2)),this.setAttribute("normal",new tn(u,3))}static fromJSON(e){return new If(e.points,e.segments,e.phiStart,e.phiLength)}}class xg extends If{constructor(e=1,t=1,n=4,i=8){const r=new qm;r.absarc(0,-t/2,e,Math.PI*1.5,0),r.absarc(0,t/2,e,0,Math.PI*.5),super(r.getPoints(n),i),this.type="CapsuleGeometry",this.parameters={radius:e,height:t,capSegments:n,radialSegments:i}}static fromJSON(e){return new xg(e.radius,e.length,e.capSegments,e.radialSegments)}}class wg extends Sn{constructor(e=1,t=8,n=0,i=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:i},t=Math.max(3,t);const r=[],o=[],l=[],h=[],u=new q,f=new Xe;o.push(0,0,0),l.push(0,0,1),h.push(.5,.5);for(let g=0,m=3;g<=t;g++,m+=3){const A=n+g/t*i;u.x=e*Math.cos(A),u.y=e*Math.sin(A),o.push(u.x,u.y,u.z),l.push(0,0,1),f.x=(o[m]/e+1)/2,f.y=(o[m+1]/e+1)/2,h.push(f.x,f.y)}for(let g=1;g<=t;g++)r.push(g,g+1,0);this.setIndex(r),this.setAttribute("position",new tn(o,3)),this.setAttribute("normal",new tn(l,3)),this.setAttribute("uv",new tn(h,2))}static fromJSON(e){return new wg(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class cs extends Sn{constructor(e=1,t=1,n=1,i=8,r=1,o=!1,l=0,h=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:i,heightSegments:r,openEnded:o,thetaStart:l,thetaLength:h};const u=this;i=Math.floor(i),r=Math.floor(r);const f=[],g=[],m=[],A=[];let v=0;const w=[],b=n/2;let S=0;R(),o===!1&&(e>0&&M(!0),t>0&&M(!1)),this.setIndex(f),this.setAttribute("position",new tn(g,3)),this.setAttribute("normal",new tn(m,3)),this.setAttribute("uv",new tn(A,2));function R(){const I=new q,T=new q;let B=0;const F=(t-e)/n;for(let D=0;D<=r;D++){const U=[],W=D/r,J=W*(t-e)+e;for(let ee=0;ee<=i;ee++){const Q=ee/i,Y=Q*h+l,se=Math.sin(Y),ae=Math.cos(Y);T.x=J*se,T.y=-W*n+b,T.z=J*ae,g.push(T.x,T.y,T.z),I.set(se,F,ae).normalize(),m.push(I.x,I.y,I.z),A.push(Q,1-W),U.push(v++)}w.push(U)}for(let D=0;D<i;D++)for(let U=0;U<r;U++){const W=w[U][D],J=w[U+1][D],ee=w[U+1][D+1],Q=w[U][D+1];f.push(W,J,Q),f.push(J,ee,Q),B+=6}u.addGroup(S,B,0),S+=B}function M(I){const T=v,B=new Xe,F=new q;let D=0;const U=I===!0?e:t,W=I===!0?1:-1;for(let ee=1;ee<=i;ee++)g.push(0,b*W,0),m.push(0,W,0),A.push(.5,.5),v++;const J=v;for(let ee=0;ee<=i;ee++){const Y=ee/i*h+l,se=Math.cos(Y),ae=Math.sin(Y);F.x=U*ae,F.y=b*W,F.z=U*se,g.push(F.x,F.y,F.z),m.push(0,W,0),B.x=se*.5+.5,B.y=ae*.5*W+.5,A.push(B.x,B.y),v++}for(let ee=0;ee<i;ee++){const Q=T+ee,Y=J+ee;I===!0?f.push(Y,Y+1,Q):f.push(Y+1,Y,Q),D+=3}u.addGroup(S,D,I===!0?1:2),S+=D}}static fromJSON(e){return new cs(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class bg extends cs{constructor(e=1,t=1,n=8,i=1,r=!1,o=0,l=Math.PI*2){super(0,e,t,n,i,r,o,l),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:i,openEnded:r,thetaStart:o,thetaLength:l}}static fromJSON(e){return new bg(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Hc extends Sn{constructor(e=[],t=[],n=1,i=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:i};const r=[],o=[];l(i),u(n),f(),this.setAttribute("position",new tn(r,3)),this.setAttribute("normal",new tn(r.slice(),3)),this.setAttribute("uv",new tn(o,2)),i===0?this.computeVertexNormals():this.normalizeNormals();function l(R){const M=new q,I=new q,T=new q;for(let B=0;B<t.length;B+=3)A(t[B+0],M),A(t[B+1],I),A(t[B+2],T),h(M,I,T,R)}function h(R,M,I,T){const B=T+1,F=[];for(let D=0;D<=B;D++){F[D]=[];const U=R.clone().lerp(I,D/B),W=M.clone().lerp(I,D/B),J=B-D;for(let ee=0;ee<=J;ee++)ee===0&&D===B?F[D][ee]=U:F[D][ee]=U.clone().lerp(W,ee/J)}for(let D=0;D<B;D++)for(let U=0;U<2*(B-D)-1;U++){const W=Math.floor(U/2);U%2===0?(m(F[D][W+1]),m(F[D+1][W]),m(F[D][W])):(m(F[D][W+1]),m(F[D+1][W+1]),m(F[D+1][W]))}}function u(R){const M=new q;for(let I=0;I<r.length;I+=3)M.x=r[I+0],M.y=r[I+1],M.z=r[I+2],M.normalize().multiplyScalar(R),r[I+0]=M.x,r[I+1]=M.y,r[I+2]=M.z}function f(){const R=new q;for(let M=0;M<r.length;M+=3){R.x=r[M+0],R.y=r[M+1],R.z=r[M+2];const I=b(R)/2/Math.PI+.5,T=S(R)/Math.PI+.5;o.push(I,1-T)}v(),g()}function g(){for(let R=0;R<o.length;R+=6){const M=o[R+0],I=o[R+2],T=o[R+4],B=Math.max(M,I,T),F=Math.min(M,I,T);B>.9&&F<.1&&(M<.2&&(o[R+0]+=1),I<.2&&(o[R+2]+=1),T<.2&&(o[R+4]+=1))}}function m(R){r.push(R.x,R.y,R.z)}function A(R,M){const I=R*3;M.x=e[I+0],M.y=e[I+1],M.z=e[I+2]}function v(){const R=new q,M=new q,I=new q,T=new q,B=new Xe,F=new Xe,D=new Xe;for(let U=0,W=0;U<r.length;U+=9,W+=6){R.set(r[U+0],r[U+1],r[U+2]),M.set(r[U+3],r[U+4],r[U+5]),I.set(r[U+6],r[U+7],r[U+8]),B.set(o[W+0],o[W+1]),F.set(o[W+2],o[W+3]),D.set(o[W+4],o[W+5]),T.copy(R).add(M).add(I).divideScalar(3);const J=b(T);w(B,W+0,R,J),w(F,W+2,M,J),w(D,W+4,I,J)}}function w(R,M,I,T){T<0&&R.x===1&&(o[M]=R.x-1),I.x===0&&I.z===0&&(o[M]=T/2/Math.PI+.5)}function b(R){return Math.atan2(R.z,-R.x)}function S(R){return Math.atan2(-R.y,Math.sqrt(R.x*R.x+R.z*R.z))}}static fromJSON(e){return new Hc(e.vertices,e.indices,e.radius,e.details)}}class Eg extends Hc{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,i=1/n,r=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-n,0,-i,n,0,i,-n,0,i,n,-i,-n,0,-i,n,0,i,-n,0,i,n,0,-n,0,-i,n,0,-i,-n,0,i,n,0,i],o=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(r,o,e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Eg(e.radius,e.detail)}}const H0=new q,V0=new q,Uw=new q,W0=new Bo;class RC extends Sn{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},e!==null){const i=Math.pow(10,4),r=Math.cos(_u*t),o=e.getIndex(),l=e.getAttribute("position"),h=o?o.count:l.count,u=[0,0,0],f=["a","b","c"],g=new Array(3),m={},A=[];for(let v=0;v<h;v+=3){o?(u[0]=o.getX(v),u[1]=o.getX(v+1),u[2]=o.getX(v+2)):(u[0]=v,u[1]=v+1,u[2]=v+2);const{a:w,b,c:S}=W0;if(w.fromBufferAttribute(l,u[0]),b.fromBufferAttribute(l,u[1]),S.fromBufferAttribute(l,u[2]),W0.getNormal(Uw),g[0]=`${Math.round(w.x*i)},${Math.round(w.y*i)},${Math.round(w.z*i)}`,g[1]=`${Math.round(b.x*i)},${Math.round(b.y*i)},${Math.round(b.z*i)}`,g[2]=`${Math.round(S.x*i)},${Math.round(S.y*i)},${Math.round(S.z*i)}`,!(g[0]===g[1]||g[1]===g[2]||g[2]===g[0]))for(let R=0;R<3;R++){const M=(R+1)%3,I=g[R],T=g[M],B=W0[f[R]],F=W0[f[M]],D=`${I}_${T}`,U=`${T}_${I}`;U in m&&m[U]?(Uw.dot(m[U].normal)<=r&&(A.push(B.x,B.y,B.z),A.push(F.x,F.y,F.z)),m[U]=null):D in m||(m[D]={index0:u[R],index1:u[M],normal:Uw.clone()})}}for(const v in m)if(m[v]){const{index0:w,index1:b}=m[v];H0.fromBufferAttribute(l,w),V0.fromBufferAttribute(l,b),A.push(H0.x,H0.y,H0.z),A.push(V0.x,V0.y,V0.z)}this.setAttribute("position",new tn(A,3))}}}class xu extends qm{constructor(e){super(e),this.uuid=so(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let n=0,i=this.holes.length;n<i;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const i=e.holes[t];this.holes.push(i.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const i=this.holes[t];e.holes.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const i=e.holes[t];this.holes.push(new qm().fromJSON(i))}return this}}const P6={triangulate:function(a,e,t=2){const n=e&&e.length,i=n?e[0]*t:a.length;let r=jL(a,0,i,t,!0);const o=[];if(!r||r.next===r.prev)return o;let l,h,u,f,g,m,A;if(n&&(r=F6(a,e,r,t)),a.length>80*t){l=u=a[0],h=f=a[1];for(let v=t;v<i;v+=t)g=a[v],m=a[v+1],g<l&&(l=g),m<h&&(h=m),g>u&&(u=g),m>f&&(f=m);A=Math.max(u-l,f-h),A=A!==0?1/A:0}return Xm(r,o,t,l,h,A),o}};function jL(a,e,t,n,i){let r,o;if(i===q6(a,e,t,n)>0)for(r=e;r<t;r+=n)o=cR(r,a[r],a[r+1],o);else for(r=t-n;r>=e;r-=n)o=cR(r,a[r],a[r+1],o);return o&&ky(o,o.next)&&(Jm(o),o=o.next),o}function Yl(a,e){if(!a)return a;e||(e=a);let t=a,n;do if(n=!1,!t.steiner&&(ky(t,t.next)||ns(t.prev,t,t.next)===0)){if(Jm(t),t=e=t.prev,t===t.next)break;n=!0}else t=t.next;while(n||t!==e);return e}function Xm(a,e,t,n,i,r,o){if(!a)return;!o&&r&&G6(a,n,i,r);let l=a,h,u;for(;a.prev!==a.next;){if(h=a.prev,u=a.next,r?L6(a,n,i,r):B6(a)){e.push(h.i/t),e.push(a.i/t),e.push(u.i/t),Jm(a),a=u.next,l=u.next;continue}if(a=u,a===l){o?o===1?(a=D6(Yl(a),e,t),Xm(a,e,t,n,i,r,2)):o===2&&O6(a,e,t,n,i,r):Xm(Yl(a),e,t,n,i,r,1);break}}}function B6(a){const e=a.prev,t=a,n=a.next;if(ns(e,t,n)>=0)return!1;let i=a.next.next;for(;i!==a.prev;){if(sf(e.x,e.y,t.x,t.y,n.x,n.y,i.x,i.y)&&ns(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function L6(a,e,t,n){const i=a.prev,r=a,o=a.next;if(ns(i,r,o)>=0)return!1;const l=i.x<r.x?i.x<o.x?i.x:o.x:r.x<o.x?r.x:o.x,h=i.y<r.y?i.y<o.y?i.y:o.y:r.y<o.y?r.y:o.y,u=i.x>r.x?i.x>o.x?i.x:o.x:r.x>o.x?r.x:o.x,f=i.y>r.y?i.y>o.y?i.y:o.y:r.y>o.y?r.y:o.y,g=oE(l,h,e,t,n),m=oE(u,f,e,t,n);let A=a.prevZ,v=a.nextZ;for(;A&&A.z>=g&&v&&v.z<=m;){if(A!==a.prev&&A!==a.next&&sf(i.x,i.y,r.x,r.y,o.x,o.y,A.x,A.y)&&ns(A.prev,A,A.next)>=0||(A=A.prevZ,v!==a.prev&&v!==a.next&&sf(i.x,i.y,r.x,r.y,o.x,o.y,v.x,v.y)&&ns(v.prev,v,v.next)>=0))return!1;v=v.nextZ}for(;A&&A.z>=g;){if(A!==a.prev&&A!==a.next&&sf(i.x,i.y,r.x,r.y,o.x,o.y,A.x,A.y)&&ns(A.prev,A,A.next)>=0)return!1;A=A.prevZ}for(;v&&v.z<=m;){if(v!==a.prev&&v!==a.next&&sf(i.x,i.y,r.x,r.y,o.x,o.y,v.x,v.y)&&ns(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function D6(a,e,t){let n=a;do{const i=n.prev,r=n.next.next;!ky(i,r)&&qL(i,n,n.next,r)&&Ym(i,r)&&Ym(r,i)&&(e.push(i.i/t),e.push(n.i/t),e.push(r.i/t),Jm(n),Jm(n.next),n=a=r),n=n.next}while(n!==a);return Yl(n)}function O6(a,e,t,n,i,r){let o=a;do{let l=o.next.next;for(;l!==o.prev;){if(o.i!==l.i&&W6(o,l)){let h=XL(o,l);o=Yl(o,o.next),h=Yl(h,h.next),Xm(o,e,t,n,i,r),Xm(h,e,t,n,i,r);return}l=l.next}o=o.next}while(o!==a)}function F6(a,e,t,n){const i=[];let r,o,l,h,u;for(r=0,o=e.length;r<o;r++)l=e[r]*n,h=r<o-1?e[r+1]*n:a.length,u=jL(a,l,h,n,!1),u===u.next&&(u.steiner=!0),i.push(V6(u));for(i.sort(k6),r=0;r<i.length;r++)N6(i[r],t),t=Yl(t,t.next);return t}function k6(a,e){return a.x-e.x}function N6(a,e){if(e=U6(a,e),e){const t=XL(e,a);Yl(e,e.next),Yl(t,t.next)}}function U6(a,e){let t=e;const n=a.x,i=a.y;let r=-1/0,o;do{if(i<=t.y&&i>=t.next.y&&t.next.y!==t.y){const m=t.x+(i-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(m<=n&&m>r){if(r=m,m===n){if(i===t.y)return t;if(i===t.next.y)return t.next}o=t.x<t.next.x?t:t.next}}t=t.next}while(t!==e);if(!o)return null;if(n===r)return o;const l=o,h=o.x,u=o.y;let f=1/0,g;t=o;do n>=t.x&&t.x>=h&&n!==t.x&&sf(i<u?n:r,i,h,u,i<u?r:n,i,t.x,t.y)&&(g=Math.abs(i-t.y)/(n-t.x),Ym(t,a)&&(g<f||g===f&&(t.x>o.x||t.x===o.x&&z6(o,t)))&&(o=t,f=g)),t=t.next;while(t!==l);return o}function z6(a,e){return ns(a.prev,a,e.prev)<0&&ns(e.next,a,a.next)<0}function G6(a,e,t,n){let i=a;do i.z===null&&(i.z=oE(i.x,i.y,e,t,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==a);i.prevZ.nextZ=null,i.prevZ=null,H6(i)}function H6(a){let e,t,n,i,r,o,l,h,u=1;do{for(t=a,a=null,r=null,o=0;t;){for(o++,n=t,l=0,e=0;e<u&&(l++,n=n.nextZ,!!n);e++);for(h=u;l>0||h>0&&n;)l!==0&&(h===0||!n||t.z<=n.z)?(i=t,t=t.nextZ,l--):(i=n,n=n.nextZ,h--),r?r.nextZ=i:a=i,i.prevZ=r,r=i;t=n}r.nextZ=null,u*=2}while(o>1);return a}function oE(a,e,t,n,i){return a=32767*(a-t)*i,e=32767*(e-n)*i,a=(a|a<<8)&16711935,a=(a|a<<4)&252645135,a=(a|a<<2)&858993459,a=(a|a<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,a|e<<1}function V6(a){let e=a,t=a;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==a);return t}function sf(a,e,t,n,i,r,o,l){return(i-o)*(e-l)-(a-o)*(r-l)>=0&&(a-o)*(n-l)-(t-o)*(e-l)>=0&&(t-o)*(r-l)-(i-o)*(n-l)>=0}function W6(a,e){return a.next.i!==e.i&&a.prev.i!==e.i&&!Q6(a,e)&&(Ym(a,e)&&Ym(e,a)&&j6(a,e)&&(ns(a.prev,a,e.prev)||ns(a,e.prev,e))||ky(a,e)&&ns(a.prev,a,a.next)>0&&ns(e.prev,e,e.next)>0)}function ns(a,e,t){return(e.y-a.y)*(t.x-e.x)-(e.x-a.x)*(t.y-e.y)}function ky(a,e){return a.x===e.x&&a.y===e.y}function qL(a,e,t,n){const i=j0(ns(a,e,t)),r=j0(ns(a,e,n)),o=j0(ns(t,n,a)),l=j0(ns(t,n,e));return!!(i!==r&&o!==l||i===0&&Q0(a,t,e)||r===0&&Q0(a,n,e)||o===0&&Q0(t,a,n)||l===0&&Q0(t,e,n))}function Q0(a,e,t){return e.x<=Math.max(a.x,t.x)&&e.x>=Math.min(a.x,t.x)&&e.y<=Math.max(a.y,t.y)&&e.y>=Math.min(a.y,t.y)}function j0(a){return a>0?1:a<0?-1:0}function Q6(a,e){let t=a;do{if(t.i!==a.i&&t.next.i!==a.i&&t.i!==e.i&&t.next.i!==e.i&&qL(t,t.next,a,e))return!0;t=t.next}while(t!==a);return!1}function Ym(a,e){return ns(a.prev,a,a.next)<0?ns(a,e,a.next)>=0&&ns(a,a.prev,e)>=0:ns(a,e,a.prev)<0||ns(a,a.next,e)<0}function j6(a,e){let t=a,n=!1;const i=(a.x+e.x)/2,r=(a.y+e.y)/2;do t.y>r!=t.next.y>r&&t.next.y!==t.y&&i<(t.next.x-t.x)*(r-t.y)/(t.next.y-t.y)+t.x&&(n=!n),t=t.next;while(t!==a);return n}function XL(a,e){const t=new aE(a.i,a.x,a.y),n=new aE(e.i,e.x,e.y),i=a.next,r=e.prev;return a.next=e,e.prev=a,t.next=i,i.prev=t,n.next=t,t.prev=n,r.next=n,n.prev=r,n}function cR(a,e,t,n){const i=new aE(a,e,t);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function Jm(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function aE(a,e,t){this.i=a,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function q6(a,e,t,n){let i=0;for(let r=e,o=t-n;r<t;r+=n)i+=(a[o]-a[r])*(a[r+1]+a[o+1]),o=r;return i}class Ua{static area(e){const t=e.length;let n=0;for(let i=t-1,r=0;r<t;i=r++)n+=e[i].x*e[r].y-e[r].x*e[i].y;return n*.5}static isClockWise(e){return Ua.area(e)<0}static triangulateShape(e,t){const n=[],i=[],r=[];lR(e),hR(n,e);let o=e.length;t.forEach(lR);for(let h=0;h<t.length;h++)i.push(o),o+=t[h].length,hR(n,t[h]);const l=P6.triangulate(n,i);for(let h=0;h<l.length;h+=3)r.push(l.slice(h,h+3));return r}}function lR(a){const e=a.length;e>2&&a[e-1].equals(a[0])&&a.pop()}function hR(a,e){for(let t=0;t<e.length;t++)a.push(e[t].x),a.push(e[t].y)}class Cg extends Sn{constructor(e=new xu([new Xe(.5,.5),new Xe(-.5,.5),new Xe(-.5,-.5),new Xe(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,i=[],r=[];for(let l=0,h=e.length;l<h;l++){const u=e[l];o(u)}this.setAttribute("position",new tn(i,3)),this.setAttribute("uv",new tn(r,2)),this.computeVertexNormals();function o(l){const h=[],u=t.curveSegments!==void 0?t.curveSegments:12,f=t.steps!==void 0?t.steps:1,g=t.depth!==void 0?t.depth:1;let m=t.bevelEnabled!==void 0?t.bevelEnabled:!0,A=t.bevelThickness!==void 0?t.bevelThickness:.2,v=t.bevelSize!==void 0?t.bevelSize:A-.1,w=t.bevelOffset!==void 0?t.bevelOffset:0,b=t.bevelSegments!==void 0?t.bevelSegments:3;const S=t.extrudePath,R=t.UVGenerator!==void 0?t.UVGenerator:X6;let M,I=!1,T,B,F,D;S&&(M=S.getSpacedPoints(f),I=!0,m=!1,T=S.computeFrenetFrames(f,!1),B=new q,F=new q,D=new q),m||(b=0,A=0,v=0,w=0);const U=l.extractPoints(u);let W=U.shape;const J=U.holes;if(!Ua.isClockWise(W)){W=W.reverse();for(let it=0,tt=J.length;it<tt;it++){const vt=J[it];Ua.isClockWise(vt)&&(J[it]=vt.reverse())}}const Q=Ua.triangulateShape(W,J),Y=W;for(let it=0,tt=J.length;it<tt;it++){const vt=J[it];W=W.concat(vt)}function se(it,tt,vt){return tt||console.error("THREE.ExtrudeGeometry: vec does not exist"),tt.clone().multiplyScalar(vt).add(it)}const ae=W.length,ve=Q.length;function xe(it,tt,vt){let Jt,Lt,En;const Zt=it.x-tt.x,ln=it.y-tt.y,ii=vt.x-it.x,Zn=vt.y-it.y,me=Zt*Zt+ln*ln,ce=Zt*Zn-ln*ii;if(Math.abs(ce)>Number.EPSILON){const Qe=Math.sqrt(me),At=Math.sqrt(ii*ii+Zn*Zn),pt=tt.x-ln/Qe,zt=tt.y+Zt/Qe,Mn=vt.x-Zn/At,we=vt.y+ii/At,Fe=((Mn-pt)*Zn-(we-zt)*ii)/(Zt*Zn-ln*ii);Jt=pt+Zt*Fe-it.x,Lt=zt+ln*Fe-it.y;const bt=Jt*Jt+Lt*Lt;if(bt<=2)return new Xe(Jt,Lt);En=Math.sqrt(bt/2)}else{let Qe=!1;Zt>Number.EPSILON?ii>Number.EPSILON&&(Qe=!0):Zt<-Number.EPSILON?ii<-Number.EPSILON&&(Qe=!0):Math.sign(ln)===Math.sign(Zn)&&(Qe=!0),Qe?(Jt=-ln,Lt=Zt,En=Math.sqrt(me)):(Jt=Zt,Lt=ln,En=Math.sqrt(me/2))}return new Xe(Jt/En,Lt/En)}const Ae=[];for(let it=0,tt=Y.length,vt=tt-1,Jt=it+1;it<tt;it++,vt++,Jt++)vt===tt&&(vt=0),Jt===tt&&(Jt=0),Ae[it]=xe(Y[it],Y[vt],Y[Jt]);const Me=[];let Be,Le=Ae.concat();for(let it=0,tt=J.length;it<tt;it++){const vt=J[it];Be=[];for(let Jt=0,Lt=vt.length,En=Lt-1,Zt=Jt+1;Jt<Lt;Jt++,En++,Zt++)En===Lt&&(En=0),Zt===Lt&&(Zt=0),Be[Jt]=xe(vt[Jt],vt[En],vt[Zt]);Me.push(Be),Le=Le.concat(Be)}for(let it=0;it<b;it++){const tt=it/b,vt=A*Math.cos(tt*Math.PI/2),Jt=v*Math.sin(tt*Math.PI/2)+w;for(let Lt=0,En=Y.length;Lt<En;Lt++){const Zt=se(Y[Lt],Ae[Lt],Jt);mn(Zt.x,Zt.y,-vt)}for(let Lt=0,En=J.length;Lt<En;Lt++){const Zt=J[Lt];Be=Me[Lt];for(let ln=0,ii=Zt.length;ln<ii;ln++){const Zn=se(Zt[ln],Be[ln],Jt);mn(Zn.x,Zn.y,-vt)}}}const $e=v+w;for(let it=0;it<ae;it++){const tt=m?se(W[it],Le[it],$e):W[it];I?(F.copy(T.normals[0]).multiplyScalar(tt.x),B.copy(T.binormals[0]).multiplyScalar(tt.y),D.copy(M[0]).add(F).add(B),mn(D.x,D.y,D.z)):mn(tt.x,tt.y,0)}for(let it=1;it<=f;it++)for(let tt=0;tt<ae;tt++){const vt=m?se(W[tt],Le[tt],$e):W[tt];I?(F.copy(T.normals[it]).multiplyScalar(vt.x),B.copy(T.binormals[it]).multiplyScalar(vt.y),D.copy(M[it]).add(F).add(B),mn(D.x,D.y,D.z)):mn(vt.x,vt.y,g/f*it)}for(let it=b-1;it>=0;it--){const tt=it/b,vt=A*Math.cos(tt*Math.PI/2),Jt=v*Math.sin(tt*Math.PI/2)+w;for(let Lt=0,En=Y.length;Lt<En;Lt++){const Zt=se(Y[Lt],Ae[Lt],Jt);mn(Zt.x,Zt.y,g+vt)}for(let Lt=0,En=J.length;Lt<En;Lt++){const Zt=J[Lt];Be=Me[Lt];for(let ln=0,ii=Zt.length;ln<ii;ln++){const Zn=se(Zt[ln],Be[ln],Jt);I?mn(Zn.x,Zn.y+M[f-1].y,M[f-1].x+vt):mn(Zn.x,Zn.y,g+vt)}}}yt(),Nt();function yt(){const it=i.length/3;if(m){let tt=0,vt=ae*tt;for(let Jt=0;Jt<ve;Jt++){const Lt=Q[Jt];Xt(Lt[2]+vt,Lt[1]+vt,Lt[0]+vt)}tt=f+b*2,vt=ae*tt;for(let Jt=0;Jt<ve;Jt++){const Lt=Q[Jt];Xt(Lt[0]+vt,Lt[1]+vt,Lt[2]+vt)}}else{for(let tt=0;tt<ve;tt++){const vt=Q[tt];Xt(vt[2],vt[1],vt[0])}for(let tt=0;tt<ve;tt++){const vt=Q[tt];Xt(vt[0]+ae*f,vt[1]+ae*f,vt[2]+ae*f)}}n.addGroup(it,i.length/3-it,0)}function Nt(){const it=i.length/3;let tt=0;He(Y,tt),tt+=Y.length;for(let vt=0,Jt=J.length;vt<Jt;vt++){const Lt=J[vt];He(Lt,tt),tt+=Lt.length}n.addGroup(it,i.length/3-it,1)}function He(it,tt){let vt=it.length;for(;--vt>=0;){const Jt=vt;let Lt=vt-1;Lt<0&&(Lt=it.length-1);for(let En=0,Zt=f+b*2;En<Zt;En++){const ln=ae*En,ii=ae*(En+1),Zn=tt+Jt+ln,me=tt+Lt+ln,ce=tt+Lt+ii,Qe=tt+Jt+ii;pn(Zn,me,ce,Qe)}}}function mn(it,tt,vt){h.push(it),h.push(tt),h.push(vt)}function Xt(it,tt,vt){Ft(it),Ft(tt),Ft(vt);const Jt=i.length/3,Lt=R.generateTopUV(n,i,Jt-3,Jt-2,Jt-1);yn(Lt[0]),yn(Lt[1]),yn(Lt[2])}function pn(it,tt,vt,Jt){Ft(it),Ft(tt),Ft(Jt),Ft(tt),Ft(vt),Ft(Jt);const Lt=i.length/3,En=R.generateSideWallUV(n,i,Lt-6,Lt-3,Lt-2,Lt-1);yn(En[0]),yn(En[1]),yn(En[3]),yn(En[1]),yn(En[2]),yn(En[3])}function Ft(it){i.push(h[it*3+0]),i.push(h[it*3+1]),i.push(h[it*3+2])}function yn(it){r.push(it.x),r.push(it.y)}}}toJSON(){const e=super.toJSON(),t=this.parameters.shapes,n=this.parameters.options;return Y6(t,n,e)}static fromJSON(e,t){const n=[];for(let r=0,o=e.shapes.length;r<o;r++){const l=t[e.shapes[r]];n.push(l)}const i=e.options.extrudePath;return i!==void 0&&(e.options.extrudePath=new IC[i.type]().fromJSON(i)),new Cg(n,e.options)}}const X6={generateTopUV:function(a,e,t,n,i){const r=e[t*3],o=e[t*3+1],l=e[n*3],h=e[n*3+1],u=e[i*3],f=e[i*3+1];return[new Xe(r,o),new Xe(l,h),new Xe(u,f)]},generateSideWallUV:function(a,e,t,n,i,r){const o=e[t*3],l=e[t*3+1],h=e[t*3+2],u=e[n*3],f=e[n*3+1],g=e[n*3+2],m=e[i*3],A=e[i*3+1],v=e[i*3+2],w=e[r*3],b=e[r*3+1],S=e[r*3+2];return Math.abs(l-f)<Math.abs(o-u)?[new Xe(o,1-h),new Xe(u,1-g),new Xe(m,1-v),new Xe(w,1-S)]:[new Xe(l,1-h),new Xe(f,1-g),new Xe(A,1-v),new Xe(b,1-S)]}};function Y6(a,e,t){if(t.shapes=[],Array.isArray(a))for(let n=0,i=a.length;n<i;n++){const r=a[n];t.shapes.push(r.uuid)}else t.shapes.push(a.uuid);return t.options=Object.assign({},e),e.extrudePath!==void 0&&(t.options.extrudePath=e.extrudePath.toJSON()),t}class Rf extends Hc{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,i=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],r=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(i,r,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Rf(e.radius,e.detail)}}class Oa extends Hc{constructor(e=1,t=0){const n=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],i=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(n,i,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Oa(e.radius,e.detail)}}class Pf extends Sn{constructor(e=.5,t=1,n=8,i=1,r=0,o=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:i,thetaStart:r,thetaLength:o},n=Math.max(3,n),i=Math.max(1,i);const l=[],h=[],u=[],f=[];let g=e;const m=(t-e)/i,A=new q,v=new Xe;for(let w=0;w<=i;w++){for(let b=0;b<=n;b++){const S=r+b/n*o;A.x=g*Math.cos(S),A.y=g*Math.sin(S),h.push(A.x,A.y,A.z),u.push(0,0,1),v.x=(A.x/t+1)/2,v.y=(A.y/t+1)/2,f.push(v.x,v.y)}g+=m}for(let w=0;w<i;w++){const b=w*(n+1);for(let S=0;S<n;S++){const R=S+b,M=R,I=R+n+1,T=R+n+2,B=R+1;l.push(M,I,B),l.push(I,T,B)}}this.setIndex(l),this.setAttribute("position",new tn(h,3)),this.setAttribute("normal",new tn(u,3)),this.setAttribute("uv",new tn(f,2))}static fromJSON(e){return new Pf(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class Sg extends Sn{constructor(e=new xu([new Xe(0,.5),new Xe(-.5,-.5),new Xe(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const n=[],i=[],r=[],o=[];let l=0,h=0;if(Array.isArray(e)===!1)u(e);else for(let f=0;f<e.length;f++)u(e[f]),this.addGroup(l,h,f),l+=h,h=0;this.setIndex(n),this.setAttribute("position",new tn(i,3)),this.setAttribute("normal",new tn(r,3)),this.setAttribute("uv",new tn(o,2));function u(f){const g=i.length/3,m=f.extractPoints(t);let A=m.shape;const v=m.holes;Ua.isClockWise(A)===!1&&(A=A.reverse());for(let b=0,S=v.length;b<S;b++){const R=v[b];Ua.isClockWise(R)===!0&&(v[b]=R.reverse())}const w=Ua.triangulateShape(A,v);for(let b=0,S=v.length;b<S;b++){const R=v[b];A=A.concat(R)}for(let b=0,S=A.length;b<S;b++){const R=A[b];i.push(R.x,R.y,0),r.push(0,0,1),o.push(R.x,R.y)}for(let b=0,S=w.length;b<S;b++){const R=w[b],M=R[0]+g,I=R[1]+g,T=R[2]+g;n.push(M,I,T),h+=3}}}toJSON(){const e=super.toJSON(),t=this.parameters.shapes;return J6(t,e)}static fromJSON(e,t){const n=[];for(let i=0,r=e.shapes.length;i<r;i++){const o=t[e.shapes[i]];n.push(o)}return new Sg(n,e.curveSegments)}}function J6(a,e){if(e.shapes=[],Array.isArray(a))for(let t=0,n=a.length;t<n;t++){const i=a[t];e.shapes.push(i.uuid)}else e.shapes.push(a.uuid);return e}class ho extends Sn{constructor(e=1,t=32,n=16,i=0,r=Math.PI*2,o=0,l=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:i,phiLength:r,thetaStart:o,thetaLength:l},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const h=Math.min(o+l,Math.PI);let u=0;const f=[],g=new q,m=new q,A=[],v=[],w=[],b=[];for(let S=0;S<=n;S++){const R=[],M=S/n;let I=0;S==0&&o==0?I=.5/t:S==n&&h==Math.PI&&(I=-.5/t);for(let T=0;T<=t;T++){const B=T/t;g.x=-e*Math.cos(i+B*r)*Math.sin(o+M*l),g.y=e*Math.cos(o+M*l),g.z=e*Math.sin(i+B*r)*Math.sin(o+M*l),v.push(g.x,g.y,g.z),m.copy(g).normalize(),w.push(m.x,m.y,m.z),b.push(B+I,1-M),R.push(u++)}f.push(R)}for(let S=0;S<n;S++)for(let R=0;R<t;R++){const M=f[S][R+1],I=f[S][R],T=f[S+1][R],B=f[S+1][R+1];(S!==0||o>0)&&A.push(M,I,B),(S!==n-1||h<Math.PI)&&A.push(I,T,B)}this.setIndex(A),this.setAttribute("position",new tn(v,3)),this.setAttribute("normal",new tn(w,3)),this.setAttribute("uv",new tn(b,2))}static fromJSON(e){return new ho(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class Mg extends Hc{constructor(e=1,t=0){const n=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],i=[2,1,0,0,3,2,1,3,0,2,3,1];super(n,i,e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Mg(e.radius,e.detail)}}class Ba extends Sn{constructor(e=1,t=.4,n=8,i=6,r=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:i,arc:r},n=Math.floor(n),i=Math.floor(i);const o=[],l=[],h=[],u=[],f=new q,g=new q,m=new q;for(let A=0;A<=n;A++)for(let v=0;v<=i;v++){const w=v/i*r,b=A/n*Math.PI*2;g.x=(e+t*Math.cos(b))*Math.cos(w),g.y=(e+t*Math.cos(b))*Math.sin(w),g.z=t*Math.sin(b),l.push(g.x,g.y,g.z),f.x=e*Math.cos(w),f.y=e*Math.sin(w),m.subVectors(g,f).normalize(),h.push(m.x,m.y,m.z),u.push(v/i),u.push(A/n)}for(let A=1;A<=n;A++)for(let v=1;v<=i;v++){const w=(i+1)*A+v-1,b=(i+1)*(A-1)+v-1,S=(i+1)*(A-1)+v,R=(i+1)*A+v;o.push(w,b,R),o.push(b,S,R)}this.setIndex(o),this.setAttribute("position",new tn(l,3)),this.setAttribute("normal",new tn(h,3)),this.setAttribute("uv",new tn(u,2))}static fromJSON(e){return new Ba(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class Tg extends Sn{constructor(e=1,t=.4,n=64,i=8,r=2,o=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:i,p:r,q:o},n=Math.floor(n),i=Math.floor(i);const l=[],h=[],u=[],f=[],g=new q,m=new q,A=new q,v=new q,w=new q,b=new q,S=new q;for(let M=0;M<=n;++M){const I=M/n*r*Math.PI*2;R(I,r,o,e,A),R(I+.01,r,o,e,v),b.subVectors(v,A),S.addVectors(v,A),w.crossVectors(b,S),S.crossVectors(w,b),w.normalize(),S.normalize();for(let T=0;T<=i;++T){const B=T/i*Math.PI*2,F=-t*Math.cos(B),D=t*Math.sin(B);g.x=A.x+(F*S.x+D*w.x),g.y=A.y+(F*S.y+D*w.y),g.z=A.z+(F*S.z+D*w.z),h.push(g.x,g.y,g.z),m.subVectors(g,A).normalize(),u.push(m.x,m.y,m.z),f.push(M/n),f.push(T/i)}}for(let M=1;M<=n;M++)for(let I=1;I<=i;I++){const T=(i+1)*(M-1)+(I-1),B=(i+1)*M+(I-1),F=(i+1)*M+I,D=(i+1)*(M-1)+I;l.push(T,B,D),l.push(B,F,D)}this.setIndex(l),this.setAttribute("position",new tn(h,3)),this.setAttribute("normal",new tn(u,3)),this.setAttribute("uv",new tn(f,2));function R(M,I,T,B,F){const D=Math.cos(M),U=Math.sin(M),W=T/I*M,J=Math.cos(W);F.x=B*(2+J)*.5*D,F.y=B*(2+J)*U*.5,F.z=B*Math.sin(W)*.5}}static fromJSON(e){return new Tg(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class Ig extends Sn{constructor(e=new MC(new q(-1,-1,0),new q(-1,1,0),new q(1,1,0)),t=64,n=1,i=8,r=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:i,closed:r};const o=e.computeFrenetFrames(t,r);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;const l=new q,h=new q,u=new Xe;let f=new q;const g=[],m=[],A=[],v=[];w(),this.setIndex(v),this.setAttribute("position",new tn(g,3)),this.setAttribute("normal",new tn(m,3)),this.setAttribute("uv",new tn(A,2));function w(){for(let M=0;M<t;M++)b(M);b(r===!1?t:0),R(),S()}function b(M){f=e.getPointAt(M/t,f);const I=o.normals[M],T=o.binormals[M];for(let B=0;B<=i;B++){const F=B/i*Math.PI*2,D=Math.sin(F),U=-Math.cos(F);h.x=U*I.x+D*T.x,h.y=U*I.y+D*T.y,h.z=U*I.z+D*T.z,h.normalize(),m.push(h.x,h.y,h.z),l.x=f.x+n*h.x,l.y=f.y+n*h.y,l.z=f.z+n*h.z,g.push(l.x,l.y,l.z)}}function S(){for(let M=1;M<=t;M++)for(let I=1;I<=i;I++){const T=(i+1)*(M-1)+(I-1),B=(i+1)*M+(I-1),F=(i+1)*M+I,D=(i+1)*(M-1)+I;v.push(T,B,D),v.push(B,F,D)}}function R(){for(let M=0;M<=t;M++)for(let I=0;I<=i;I++)u.x=M/t,u.y=I/i,A.push(u.x,u.y)}}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new Ig(new IC[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class YL extends Sn{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){const t=[],n=new Set,i=new q,r=new q;if(e.index!==null){const o=e.attributes.position,l=e.index;let h=e.groups;h.length===0&&(h=[{start:0,count:l.count,materialIndex:0}]);for(let u=0,f=h.length;u<f;++u){const g=h[u],m=g.start,A=g.count;for(let v=m,w=m+A;v<w;v+=3)for(let b=0;b<3;b++){const S=l.getX(v+b),R=l.getX(v+(b+1)%3);i.fromBufferAttribute(o,S),r.fromBufferAttribute(o,R),uR(i,r,n)===!0&&(t.push(i.x,i.y,i.z),t.push(r.x,r.y,r.z))}}}else{const o=e.attributes.position;for(let l=0,h=o.count/3;l<h;l++)for(let u=0;u<3;u++){const f=3*l+u,g=3*l+(u+1)%3;i.fromBufferAttribute(o,f),r.fromBufferAttribute(o,g),uR(i,r,n)===!0&&(t.push(i.x,i.y,i.z),t.push(r.x,r.y,r.z))}}this.setAttribute("position",new tn(t,3))}}}function uR(a,e,t){const n=`${a.x},${a.y},${a.z}-${e.x},${e.y},${e.z}`,i=`${e.x},${e.y},${e.z}-${a.x},${a.y},${a.z}`;return t.has(n)===!0||t.has(i)===!0?!1:(t.add(n),t.add(i),!0)}var dR=Object.freeze({__proto__:null,BoxGeometry:Ui,CapsuleGeometry:xg,CircleGeometry:wg,ConeGeometry:bg,CylinderGeometry:cs,DodecahedronGeometry:Eg,EdgesGeometry:RC,ExtrudeGeometry:Cg,IcosahedronGeometry:Rf,LatheGeometry:If,OctahedronGeometry:Oa,PlaneGeometry:lo,PolyhedronGeometry:Hc,RingGeometry:Pf,ShapeGeometry:Sg,SphereGeometry:ho,TetrahedronGeometry:Mg,TorusGeometry:Ba,TorusKnotGeometry:Tg,TubeGeometry:Ig,WireframeGeometry:YL});class PC extends Ts{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new _e(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class BC extends nr{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class Bf extends Ts{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new _e(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new _e(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Gc,this.normalScale=new Xe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Vc extends Bf{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Xe(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return As(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new _e(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new _e(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new _e(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._iridescence=0,this._transmission=0,this.setValues(e)}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class JL extends Ts{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new _e(16777215),this.specular=new _e(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new _e(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Gc,this.normalScale=new Xe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=dg,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class ZL extends Ts{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new _e(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new _e(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Gc,this.normalScale=new Xe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class KL extends Ts{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Gc,this.normalScale=new Xe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class $L extends Ts{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new _e(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new _e(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Gc,this.normalScale=new Xe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=dg,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class e2 extends Ts{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new _e(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Gc,this.normalScale=new Xe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class t2 extends Is{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function Io(a,e,t){return LC(a)?new a.constructor(a.subarray(e,t!==void 0?t:a.length)):a.slice(e,t)}function du(a,e,t){return!a||!t&&a.constructor===e?a:typeof e.BYTES_PER_ELEMENT=="number"?new e(a):Array.prototype.slice.call(a)}function LC(a){return ArrayBuffer.isView(a)&&!(a instanceof DataView)}function n2(a){function e(i,r){return a[i]-a[r]}const t=a.length,n=new Array(t);for(let i=0;i!==t;++i)n[i]=i;return n.sort(e),n}function cE(a,e,t){const n=a.length,i=new a.constructor(n);for(let r=0,o=0;o!==n;++r){const l=t[r]*e;for(let h=0;h!==e;++h)i[o++]=a[l+h]}return i}function DC(a,e,t,n){let i=1,r=a[0];for(;r!==void 0&&r[n]===void 0;)r=a[i++];if(r===void 0)return;let o=r[n];if(o!==void 0)if(Array.isArray(o))do o=r[n],o!==void 0&&(e.push(r.time),t.push.apply(t,o)),r=a[i++];while(r!==void 0);else if(o.toArray!==void 0)do o=r[n],o!==void 0&&(e.push(r.time),o.toArray(t,t.length)),r=a[i++];while(r!==void 0);else do o=r[n],o!==void 0&&(e.push(r.time),t.push(o)),r=a[i++];while(r!==void 0)}function Z6(a,e,t,n,i=30){const r=a.clone();r.name=e;const o=[];for(let h=0;h<r.tracks.length;++h){const u=r.tracks[h],f=u.getValueSize(),g=[],m=[];for(let A=0;A<u.times.length;++A){const v=u.times[A]*i;if(!(v<t||v>=n)){g.push(u.times[A]);for(let w=0;w<f;++w)m.push(u.values[A*f+w])}}g.length!==0&&(u.times=du(g,u.times.constructor),u.values=du(m,u.values.constructor),o.push(u))}r.tracks=o;let l=1/0;for(let h=0;h<r.tracks.length;++h)l>r.tracks[h].times[0]&&(l=r.tracks[h].times[0]);for(let h=0;h<r.tracks.length;++h)r.tracks[h].shift(-1*l);return r.resetDuration(),r}function K6(a,e=0,t=a,n=30){n<=0&&(n=30);const i=t.tracks.length,r=e/n;for(let o=0;o<i;++o){const l=t.tracks[o],h=l.ValueTypeName;if(h==="bool"||h==="string")continue;const u=a.tracks.find(function(S){return S.name===l.name&&S.ValueTypeName===h});if(u===void 0)continue;let f=0;const g=l.getValueSize();l.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(f=g/3);let m=0;const A=u.getValueSize();u.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(m=A/3);const v=l.times.length-1;let w;if(r<=l.times[0]){const S=f,R=g-f;w=Io(l.values,S,R)}else if(r>=l.times[v]){const S=v*g+f,R=S+g-f;w=Io(l.values,S,R)}else{const S=l.createInterpolant(),R=f,M=g-f;S.evaluate(r),w=Io(S.resultBuffer,R,M)}h==="quaternion"&&new Ot().fromArray(w).normalize().conjugate().toArray(w);const b=u.times.length;for(let S=0;S<b;++S){const R=S*A+m;if(h==="quaternion")Ot.multiplyQuaternionsFlat(u.values,R,w,0,u.values,R);else{const M=A-m*2;for(let I=0;I<M;++I)u.values[R+I]-=w[I]}}}return a.blendMode=rC,a}var $6=Object.freeze({__proto__:null,arraySlice:Io,convertArray:du,isTypedArray:LC,getKeyframeOrder:n2,sortedArray:cE,flattenJSON:DC,subclip:Z6,makeClipAdditive:K6});class Lf{constructor(e,t,n,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=i!==void 0?i:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,i=t[n],r=t[n-1];e:{t:{let o;n:{i:if(!(e<i)){for(let l=n+2;;){if(i===void 0){if(e<r)break i;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===l)break;if(r=i,i=t[++n],e<i)break t}o=t.length;break n}if(!(e>=r)){const l=t[1];e<l&&(n=2,r=l);for(let h=n-2;;){if(r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(n===h)break;if(i=r,r=t[--n-1],e>=r)break t}o=n,n=0;break n}break e}for(;n<o;){const l=n+o>>>1;e<t[l]?o=l:n=l+1}if(i=t[n],r=t[n-1],r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===void 0)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,e,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i;for(let o=0;o!==i;++o)t[o]=n[r+o];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class i2 extends Lf{constructor(e,t,n,i){super(e,t,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:hu,endingEnd:hu}}intervalChanged_(e,t,n){const i=this.parameterPositions;let r=e-2,o=e+1,l=i[r],h=i[o];if(l===void 0)switch(this.getSettings_().endingStart){case uu:r=e,l=2*t-n;break;case Vm:r=i.length-2,l=t+i[r]-i[r+1];break;default:r=e,l=n}if(h===void 0)switch(this.getSettings_().endingEnd){case uu:o=e,h=2*n-t;break;case Vm:o=1,h=n+i[1]-i[0];break;default:o=e-1,h=t}const u=(n-t)*.5,f=this.valueSize;this._weightPrev=u/(t-l),this._weightNext=u/(h-n),this._offsetPrev=r*f,this._offsetNext=o*f}interpolate_(e,t,n,i){const r=this.resultBuffer,o=this.sampleValues,l=this.valueSize,h=e*l,u=h-l,f=this._offsetPrev,g=this._offsetNext,m=this._weightPrev,A=this._weightNext,v=(n-t)/(i-t),w=v*v,b=w*v,S=-m*b+2*m*w-m*v,R=(1+m)*b+(-1.5-2*m)*w+(-.5+m)*v+1,M=(-1-A)*b+(1.5+A)*w+.5*v,I=A*b-A*w;for(let T=0;T!==l;++T)r[T]=S*o[f+T]+R*o[u+T]+M*o[h+T]+I*o[g+T];return r}}class OC extends Lf{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const r=this.resultBuffer,o=this.sampleValues,l=this.valueSize,h=e*l,u=h-l,f=(n-t)/(i-t),g=1-f;for(let m=0;m!==l;++m)r[m]=o[u+m]*g+o[h+m]*f;return r}}class s2 extends Lf{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e){return this.copySampleValue_(e-1)}}class ma{constructor(e,t,n,i){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=du(t,this.TimeBufferType),this.values=du(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:du(e.times,Array),values:du(e.values,Array)};const i=e.getInterpolation();i!==e.DefaultInterpolation&&(n.interpolation=i)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new s2(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new OC(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new i2(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Mu:t=this.InterpolantFactoryMethodDiscrete;break;case kc:t=this.InterpolantFactoryMethodLinear;break;case w_:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(n);return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Mu;case this.InterpolantFactoryMethodLinear:return kc;case this.InterpolantFactoryMethodSmooth:return w_}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]*=e}return this}trim(e,t){const n=this.times,i=n.length;let r=0,o=i-1;for(;r!==i&&n[r]<e;)++r;for(;o!==-1&&n[o]>t;)--o;if(++o,r!==0||o!==i){r>=o&&(o=Math.max(o,1),r=o-1);const l=this.getValueSize();this.times=Io(n,r,o),this.values=Io(this.values,r*l,o*l)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,i=this.values,r=n.length;r===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let l=0;l!==r;l++){const h=n[l];if(typeof h=="number"&&isNaN(h)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,l,h),e=!1;break}if(o!==null&&o>h){console.error("THREE.KeyframeTrack: Out of order keys.",this,l,h,o),e=!1;break}o=h}if(i!==void 0&&LC(i))for(let l=0,h=i.length;l!==h;++l){const u=i[l];if(isNaN(u)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,l,u),e=!1;break}}return e}optimize(){const e=Io(this.times),t=Io(this.values),n=this.getValueSize(),i=this.getInterpolation()===w_,r=e.length-1;let o=1;for(let l=1;l<r;++l){let h=!1;const u=e[l],f=e[l+1];if(u!==f&&(l!==1||u!==e[0]))if(i)h=!0;else{const g=l*n,m=g-n,A=g+n;for(let v=0;v!==n;++v){const w=t[g+v];if(w!==t[m+v]||w!==t[A+v]){h=!0;break}}}if(h){if(l!==o){e[o]=e[l];const g=l*n,m=o*n;for(let A=0;A!==n;++A)t[m+A]=t[g+A]}++o}}if(r>0){e[o]=e[r];for(let l=r*n,h=o*n,u=0;u!==n;++u)t[h+u]=t[l+u];++o}return o!==e.length?(this.times=Io(e,0,o),this.values=Io(t,0,o*n)):(this.times=e,this.values=t),this}clone(){const e=Io(this.times,0),t=Io(this.values,0),n=this.constructor,i=new n(this.name,e,t);return i.createInterpolant=this.createInterpolant,i}}ma.prototype.TimeBufferType=Float32Array;ma.prototype.ValueBufferType=Float32Array;ma.prototype.DefaultInterpolation=kc;class Bu extends ma{}Bu.prototype.ValueTypeName="bool";Bu.prototype.ValueBufferType=Array;Bu.prototype.DefaultInterpolation=Mu;Bu.prototype.InterpolantFactoryMethodLinear=void 0;Bu.prototype.InterpolantFactoryMethodSmooth=void 0;class Rg extends ma{}Rg.prototype.ValueTypeName="color";class Jl extends ma{}Jl.prototype.ValueTypeName="number";class r2 extends Lf{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const r=this.resultBuffer,o=this.sampleValues,l=this.valueSize,h=(n-t)/(i-t);let u=e*l;for(let f=u+l;u!==f;u+=4)Ot.slerpFlat(r,0,o,u-l,o,u,h);return r}}class ja extends ma{InterpolantFactoryMethodLinear(e){return new r2(this.times,this.values,this.getValueSize(),e)}}ja.prototype.ValueTypeName="quaternion";ja.prototype.DefaultInterpolation=kc;ja.prototype.InterpolantFactoryMethodSmooth=void 0;class Lu extends ma{}Lu.prototype.ValueTypeName="string";Lu.prototype.ValueBufferType=Array;Lu.prototype.DefaultInterpolation=Mu;Lu.prototype.InterpolantFactoryMethodLinear=void 0;Lu.prototype.InterpolantFactoryMethodSmooth=void 0;class Zl extends ma{}Zl.prototype.ValueTypeName="vector";class Kl{constructor(e,t=-1,n,i=My){this.name=e,this.tracks=n,this.duration=t,this.blendMode=i,this.uuid=so(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,i=1/(e.fps||1);for(let o=0,l=n.length;o!==l;++o)t.push(tj(n[o]).scale(i));const r=new this(e.name,e.duration,t,e.blendMode);return r.uuid=e.uuid,r}static toJSON(e){const t=[],n=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let r=0,o=n.length;r!==o;++r)t.push(ma.toJSON(n[r]));return i}static CreateFromMorphTargetSequence(e,t,n,i){const r=t.length,o=[];for(let l=0;l<r;l++){let h=[],u=[];h.push((l+r-1)%r,l,(l+1)%r),u.push(0,1,0);const f=n2(h);h=cE(h,1,f),u=cE(u,1,f),!i&&h[0]===0&&(h.push(r),u.push(u[0])),o.push(new Jl(".morphTargetInfluences["+t[l].name+"]",h,u).scale(1/n))}return new this(e,-1,o)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const i=e;n=i.geometry&&i.geometry.animations||i.animations}for(let i=0;i<n.length;i++)if(n[i].name===t)return n[i];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const i={},r=/^([\w-]*?)([\d]+)$/;for(let l=0,h=e.length;l<h;l++){const u=e[l],f=u.name.match(r);if(f&&f.length>1){const g=f[1];let m=i[g];m||(i[g]=m=[]),m.push(u)}}const o=[];for(const l in i)o.push(this.CreateFromMorphTargetSequence(l,i[l],t,n));return o}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(g,m,A,v,w){if(A.length!==0){const b=[],S=[];DC(A,b,S,v),b.length!==0&&w.push(new g(m,b,S))}},i=[],r=e.name||"default",o=e.fps||30,l=e.blendMode;let h=e.length||-1;const u=e.hierarchy||[];for(let g=0;g<u.length;g++){const m=u[g].keys;if(!(!m||m.length===0))if(m[0].morphTargets){const A={};let v;for(v=0;v<m.length;v++)if(m[v].morphTargets)for(let w=0;w<m[v].morphTargets.length;w++)A[m[v].morphTargets[w]]=-1;for(const w in A){const b=[],S=[];for(let R=0;R!==m[v].morphTargets.length;++R){const M=m[v];b.push(M.time),S.push(M.morphTarget===w?1:0)}i.push(new Jl(".morphTargetInfluence["+w+"]",b,S))}h=A.length*o}else{const A=".bones["+t[g].name+"]";n(Zl,A+".position",m,"pos",i),n(ja,A+".quaternion",m,"rot",i),n(Zl,A+".scale",m,"scl",i)}}return i.length===0?null:new this(r,h,i,l)}resetDuration(){const e=this.tracks;let t=0;for(let n=0,i=e.length;n!==i;++n){const r=this.tracks[n];t=Math.max(t,r.times[r.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function ej(a){switch(a.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Jl;case"vector":case"vector2":case"vector3":case"vector4":return Zl;case"color":return Rg;case"quaternion":return ja;case"bool":case"boolean":return Bu;case"string":return Lu}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+a)}function tj(a){if(a.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=ej(a.type);if(a.times===void 0){const t=[],n=[];DC(a.keys,t,n,"value"),a.times=t,a.values=n}return e.parse!==void 0?e.parse(a):new e(a.name,a.times,a.values,a.interpolation)}const Iu={enabled:!1,files:{},add:function(a,e){this.enabled!==!1&&(this.files[a]=e)},get:function(a){if(this.enabled!==!1)return this.files[a]},remove:function(a){delete this.files[a]},clear:function(){this.files={}}};class FC{constructor(e,t,n){const i=this;let r=!1,o=0,l=0,h;const u=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(f){l++,r===!1&&i.onStart!==void 0&&i.onStart(f,o,l),r=!0},this.itemEnd=function(f){o++,i.onProgress!==void 0&&i.onProgress(f,o,l),o===l&&(r=!1,i.onLoad!==void 0&&i.onLoad())},this.itemError=function(f){i.onError!==void 0&&i.onError(f)},this.resolveURL=function(f){return h?h(f):f},this.setURLModifier=function(f){return h=f,this},this.addHandler=function(f,g){return u.push(f,g),this},this.removeHandler=function(f){const g=u.indexOf(f);return g!==-1&&u.splice(g,2),this},this.getHandler=function(f){for(let g=0,m=u.length;g<m;g+=2){const A=u[g],v=u[g+1];if(A.global&&(A.lastIndex=0),A.test(f))return v}return null}}}const o2=new FC;class mr{constructor(e){this.manager=e!==void 0?e:o2,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise(function(i,r){n.load(e,i,t,r)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const pc={};class nj extends Error{constructor(e,t){super(e),this.response=t}}class Fs extends mr{constructor(e){super(e)}load(e,t,n,i){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=Iu.get(e);if(r!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(r),this.manager.itemEnd(e)},0),r;if(pc[e]!==void 0){pc[e].push({onLoad:t,onProgress:n,onError:i});return}pc[e]=[],pc[e].push({onLoad:t,onProgress:n,onError:i});const o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),l=this.mimeType,h=this.responseType;fetch(o).then(u=>{if(u.status===200||u.status===0){if(u.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||u.body===void 0||u.body.getReader===void 0)return u;const f=pc[e],g=u.body.getReader(),m=u.headers.get("Content-Length"),A=m?parseInt(m):0,v=A!==0;let w=0;const b=new ReadableStream({start(S){R();function R(){g.read().then(({done:M,value:I})=>{if(M)S.close();else{w+=I.byteLength;const T=new ProgressEvent("progress",{lengthComputable:v,loaded:w,total:A});for(let B=0,F=f.length;B<F;B++){const D=f[B];D.onProgress&&D.onProgress(T)}S.enqueue(I),R()}})}}});return new Response(b)}else throw new nj(`fetch for "${u.url}" responded with ${u.status}: ${u.statusText}`,u)}).then(u=>{switch(h){case"arraybuffer":return u.arrayBuffer();case"blob":return u.blob();case"document":return u.text().then(f=>new DOMParser().parseFromString(f,l));case"json":return u.json();default:if(l===void 0)return u.text();{const g=/charset="?([^;"\s]*)"?/i.exec(l),m=g&&g[1]?g[1].toLowerCase():void 0,A=new TextDecoder(m);return u.arrayBuffer().then(v=>A.decode(v))}}}).then(u=>{Iu.add(e,u);const f=pc[e];delete pc[e];for(let g=0,m=f.length;g<m;g++){const A=f[g];A.onLoad&&A.onLoad(u)}}).catch(u=>{const f=pc[e];if(f===void 0)throw this.manager.itemError(e),u;delete pc[e];for(let g=0,m=f.length;g<m;g++){const A=f[g];A.onError&&A.onError(u)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class ij extends mr{constructor(e){super(e)}load(e,t,n,i){const r=this,o=new Fs(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(l){try{t(r.parse(JSON.parse(l)))}catch(h){i?i(h):console.error(h),r.manager.itemError(e)}},n,i)}parse(e){const t=[];for(let n=0;n<e.length;n++){const i=Kl.parse(e[n]);t.push(i)}return t}}class sj extends mr{constructor(e){super(e)}load(e,t,n,i){const r=this,o=[],l=new Bl,h=new Fs(this.manager);h.setPath(this.path),h.setResponseType("arraybuffer"),h.setRequestHeader(this.requestHeader),h.setWithCredentials(r.withCredentials);let u=0;function f(g){h.load(e[g],function(m){const A=r.parse(m,!0);o[g]={width:A.width,height:A.height,format:A.format,mipmaps:A.mipmaps},u+=1,u===6&&(A.mipmapCount===1&&(l.minFilter=yi),l.image=o,l.format=A.format,l.needsUpdate=!0,t&&t(l))},n,i)}if(Array.isArray(e))for(let g=0,m=e.length;g<m;++g)f(g);else h.load(e,function(g){const m=r.parse(g,!0);if(m.isCubemap){const A=m.mipmaps.length/m.mipmapCount;for(let v=0;v<A;v++){o[v]={mipmaps:[]};for(let w=0;w<m.mipmapCount;w++)o[v].mipmaps.push(m.mipmaps[v*m.mipmapCount+w]),o[v].format=m.format,o[v].width=m.width,o[v].height=m.height}l.image=o}else l.image.width=m.width,l.image.height=m.height,l.mipmaps=m.mipmaps;m.mipmapCount===1&&(l.minFilter=yi),l.format=m.format,l.needsUpdate=!0,t&&t(l)},n,i);return l}}class Zm extends mr{constructor(e){super(e)}load(e,t,n,i){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=Iu.get(e);if(o!==void 0)return r.manager.itemStart(e),setTimeout(function(){t&&t(o),r.manager.itemEnd(e)},0),o;const l=jm("img");function h(){f(),Iu.add(e,this),t&&t(this),r.manager.itemEnd(e)}function u(g){f(),i&&i(g),r.manager.itemError(e),r.manager.itemEnd(e)}function f(){l.removeEventListener("load",h,!1),l.removeEventListener("error",u,!1)}return l.addEventListener("load",h,!1),l.addEventListener("error",u,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(l.crossOrigin=this.crossOrigin),r.manager.itemStart(e),l.src=e,l}}class rj extends mr{constructor(e){super(e)}load(e,t,n,i){const r=new gg,o=new Zm(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let l=0;function h(u){o.load(e[u],function(f){r.images[u]=f,l++,l===6&&(r.needsUpdate=!0,t&&t(r))},void 0,i)}for(let u=0;u<e.length;++u)h(u);return r}}class kC extends mr{constructor(e){super(e)}load(e,t,n,i){const r=this,o=new Na,l=new Fs(this.manager);return l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setPath(this.path),l.setWithCredentials(r.withCredentials),l.load(e,function(h){const u=r.parse(h);!u||(u.image!==void 0?o.image=u.image:u.data!==void 0&&(o.image.width=u.width,o.image.height=u.height,o.image.data=u.data),o.wrapS=u.wrapS!==void 0?u.wrapS:$s,o.wrapT=u.wrapT!==void 0?u.wrapT:$s,o.magFilter=u.magFilter!==void 0?u.magFilter:yi,o.minFilter=u.minFilter!==void 0?u.minFilter:yi,o.anisotropy=u.anisotropy!==void 0?u.anisotropy:1,u.encoding!==void 0&&(o.encoding=u.encoding),u.flipY!==void 0&&(o.flipY=u.flipY),u.format!==void 0&&(o.format=u.format),u.type!==void 0&&(o.type=u.type),u.mipmaps!==void 0&&(o.mipmaps=u.mipmaps,o.minFilter=fa),u.mipmapCount===1&&(o.minFilter=yi),u.generateMipmaps!==void 0&&(o.generateMipmaps=u.generateMipmaps),o.needsUpdate=!0,t&&t(o,u))},n,i),o}}class Pg extends mr{constructor(e){super(e)}load(e,t,n,i){const r=new Vi,o=new Zm(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(l){r.image=l,r.needsUpdate=!0,t!==void 0&&t(r)},n,i),r}}class ih extends qt{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new _e(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}}class NC extends ih{constructor(e,t,n){super(e,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(qt.DefaultUp),this.updateMatrix(),this.groundColor=new _e(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const zw=new xn,fR=new q,pR=new q;class UC{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Xe(512,512),this.map=null,this.mapPass=null,this.matrix=new xn,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Iy,this._frameExtents=new Xe(1,1),this._viewportCount=1,this._viewports=[new On(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;fR.setFromMatrixPosition(e.matrixWorld),t.position.copy(fR),pR.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(pR),t.updateMatrixWorld(),zw.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(zw),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(zw)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class oj extends UC{constructor(){super(new ts(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,n=Qm*2*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;(n!==t.fov||i!==t.aspect||r!==t.far)&&(t.fov=n,t.aspect=i,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class Ny extends ih{constructor(e,t,n=0,i=Math.PI/3,r=0,o=1){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(qt.DefaultUp),this.updateMatrix(),this.target=new qt,this.distance=n,this.angle=i,this.penumbra=r,this.decay=o,this.map=null,this.shadow=new oj}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const mR=new xn,Zp=new q,Gw=new q;class aj extends UC{constructor(){super(new ts(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Xe(4,2),this._viewportCount=6,this._viewports=[new On(2,1,1,1),new On(0,1,1,1),new On(3,1,1,1),new On(1,1,1,1),new On(3,0,1,1),new On(1,0,1,1)],this._cubeDirections=[new q(1,0,0),new q(-1,0,0),new q(0,0,1),new q(0,0,-1),new q(0,1,0),new q(0,-1,0)],this._cubeUps=[new q(0,1,0),new q(0,1,0),new q(0,1,0),new q(0,1,0),new q(0,0,1),new q(0,0,-1)]}updateMatrices(e,t=0){const n=this.camera,i=this.matrix,r=e.distance||n.far;r!==n.far&&(n.far=r,n.updateProjectionMatrix()),Zp.setFromMatrixPosition(e.matrixWorld),n.position.copy(Zp),Gw.copy(n.position),Gw.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(Gw),n.updateMatrixWorld(),i.makeTranslation(-Zp.x,-Zp.y,-Zp.z),mR.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(mR)}}class Uy extends ih{constructor(e,t,n=0,i=1){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=i,this.shadow=new aj}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class cj extends UC{constructor(){super(new nh(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class zy extends ih{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(qt.DefaultUp),this.updateMatrix(),this.target=new qt,this.shadow=new cj}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class zC extends ih{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class a2 extends ih{constructor(e,t,n=10,i=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=i}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class rf{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new q)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,i=e.y,r=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScaledVector(o[1],.488603*i),t.addScaledVector(o[2],.488603*r),t.addScaledVector(o[3],.488603*n),t.addScaledVector(o[4],1.092548*(n*i)),t.addScaledVector(o[5],1.092548*(i*r)),t.addScaledVector(o[6],.315392*(3*r*r-1)),t.addScaledVector(o[7],1.092548*(n*r)),t.addScaledVector(o[8],.546274*(n*n-i*i)),t}getIrradianceAt(e,t){const n=e.x,i=e.y,r=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScaledVector(o[1],2*.511664*i),t.addScaledVector(o[2],2*.511664*r),t.addScaledVector(o[3],2*.511664*n),t.addScaledVector(o[4],2*.429043*n*i),t.addScaledVector(o[5],2*.429043*i*r),t.addScaledVector(o[6],.743125*r*r-.247708),t.addScaledVector(o[7],2*.429043*n*r),t.addScaledVector(o[8],.429043*(n*n-i*i)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].fromArray(e,t+i*3);return this}toArray(e=[],t=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].toArray(e,t+i*3);return e}static getBasisAt(e,t){const n=e.x,i=e.y,r=e.z;t[0]=.282095,t[1]=.488603*i,t[2]=.488603*r,t[3]=.488603*n,t[4]=1.092548*n*i,t[5]=1.092548*i*r,t[6]=.315392*(3*r*r-1),t[7]=1.092548*n*r,t[8]=.546274*(n*n-i*i)}}class xf extends ih{constructor(e=new rf,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class Gy extends mr{constructor(e){super(e),this.textures={}}load(e,t,n,i){const r=this,o=new Fs(r.manager);o.setPath(r.path),o.setRequestHeader(r.requestHeader),o.setWithCredentials(r.withCredentials),o.load(e,function(l){try{t(r.parse(JSON.parse(l)))}catch(h){i?i(h):console.error(h),r.manager.itemError(e)}},n,i)}parse(e){const t=this.textures;function n(r){return t[r]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",r),t[r]}const i=Gy.createMaterialFromType(e.type);if(e.uuid!==void 0&&(i.uuid=e.uuid),e.name!==void 0&&(i.name=e.name),e.color!==void 0&&i.color!==void 0&&i.color.setHex(e.color),e.roughness!==void 0&&(i.roughness=e.roughness),e.metalness!==void 0&&(i.metalness=e.metalness),e.sheen!==void 0&&(i.sheen=e.sheen),e.sheenColor!==void 0&&(i.sheenColor=new _e().setHex(e.sheenColor)),e.sheenRoughness!==void 0&&(i.sheenRoughness=e.sheenRoughness),e.emissive!==void 0&&i.emissive!==void 0&&i.emissive.setHex(e.emissive),e.specular!==void 0&&i.specular!==void 0&&i.specular.setHex(e.specular),e.specularIntensity!==void 0&&(i.specularIntensity=e.specularIntensity),e.specularColor!==void 0&&i.specularColor!==void 0&&i.specularColor.setHex(e.specularColor),e.shininess!==void 0&&(i.shininess=e.shininess),e.clearcoat!==void 0&&(i.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=e.clearcoatRoughness),e.iridescence!==void 0&&(i.iridescence=e.iridescence),e.iridescenceIOR!==void 0&&(i.iridescenceIOR=e.iridescenceIOR),e.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=e.iridescenceThicknessRange),e.transmission!==void 0&&(i.transmission=e.transmission),e.thickness!==void 0&&(i.thickness=e.thickness),e.attenuationDistance!==void 0&&(i.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&i.attenuationColor!==void 0&&i.attenuationColor.setHex(e.attenuationColor),e.fog!==void 0&&(i.fog=e.fog),e.flatShading!==void 0&&(i.flatShading=e.flatShading),e.blending!==void 0&&(i.blending=e.blending),e.combine!==void 0&&(i.combine=e.combine),e.side!==void 0&&(i.side=e.side),e.shadowSide!==void 0&&(i.shadowSide=e.shadowSide),e.opacity!==void 0&&(i.opacity=e.opacity),e.transparent!==void 0&&(i.transparent=e.transparent),e.alphaTest!==void 0&&(i.alphaTest=e.alphaTest),e.depthTest!==void 0&&(i.depthTest=e.depthTest),e.depthWrite!==void 0&&(i.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(i.colorWrite=e.colorWrite),e.stencilWrite!==void 0&&(i.stencilWrite=e.stencilWrite),e.stencilWriteMask!==void 0&&(i.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(i.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(i.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(i.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(i.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(i.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(i.stencilZPass=e.stencilZPass),e.wireframe!==void 0&&(i.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(i.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(i.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(i.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(i.rotation=e.rotation),e.linewidth!==1&&(i.linewidth=e.linewidth),e.dashSize!==void 0&&(i.dashSize=e.dashSize),e.gapSize!==void 0&&(i.gapSize=e.gapSize),e.scale!==void 0&&(i.scale=e.scale),e.polygonOffset!==void 0&&(i.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(i.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(i.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(i.dithering=e.dithering),e.alphaToCoverage!==void 0&&(i.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(i.premultipliedAlpha=e.premultipliedAlpha),e.visible!==void 0&&(i.visible=e.visible),e.toneMapped!==void 0&&(i.toneMapped=e.toneMapped),e.userData!==void 0&&(i.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?i.vertexColors=e.vertexColors>0:i.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const r in e.uniforms){const o=e.uniforms[r];switch(i.uniforms[r]={},o.type){case"t":i.uniforms[r].value=n(o.value);break;case"c":i.uniforms[r].value=new _e().setHex(o.value);break;case"v2":i.uniforms[r].value=new Xe().fromArray(o.value);break;case"v3":i.uniforms[r].value=new q().fromArray(o.value);break;case"v4":i.uniforms[r].value=new On().fromArray(o.value);break;case"m3":i.uniforms[r].value=new kr().fromArray(o.value);break;case"m4":i.uniforms[r].value=new xn().fromArray(o.value);break;default:i.uniforms[r].value=o.value}}if(e.defines!==void 0&&(i.defines=e.defines),e.vertexShader!==void 0&&(i.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(i.fragmentShader=e.fragmentShader),e.glslVersion!==void 0&&(i.glslVersion=e.glslVersion),e.extensions!==void 0)for(const r in e.extensions)i.extensions[r]=e.extensions[r];if(e.size!==void 0&&(i.size=e.size),e.sizeAttenuation!==void 0&&(i.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(i.map=n(e.map)),e.matcap!==void 0&&(i.matcap=n(e.matcap)),e.alphaMap!==void 0&&(i.alphaMap=n(e.alphaMap)),e.bumpMap!==void 0&&(i.bumpMap=n(e.bumpMap)),e.bumpScale!==void 0&&(i.bumpScale=e.bumpScale),e.normalMap!==void 0&&(i.normalMap=n(e.normalMap)),e.normalMapType!==void 0&&(i.normalMapType=e.normalMapType),e.normalScale!==void 0){let r=e.normalScale;Array.isArray(r)===!1&&(r=[r,r]),i.normalScale=new Xe().fromArray(r)}return e.displacementMap!==void 0&&(i.displacementMap=n(e.displacementMap)),e.displacementScale!==void 0&&(i.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(i.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(i.roughnessMap=n(e.roughnessMap)),e.metalnessMap!==void 0&&(i.metalnessMap=n(e.metalnessMap)),e.emissiveMap!==void 0&&(i.emissiveMap=n(e.emissiveMap)),e.emissiveIntensity!==void 0&&(i.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(i.specularMap=n(e.specularMap)),e.specularIntensityMap!==void 0&&(i.specularIntensityMap=n(e.specularIntensityMap)),e.specularColorMap!==void 0&&(i.specularColorMap=n(e.specularColorMap)),e.envMap!==void 0&&(i.envMap=n(e.envMap)),e.envMapIntensity!==void 0&&(i.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(i.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(i.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(i.lightMap=n(e.lightMap)),e.lightMapIntensity!==void 0&&(i.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(i.aoMap=n(e.aoMap)),e.aoMapIntensity!==void 0&&(i.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(i.gradientMap=n(e.gradientMap)),e.clearcoatMap!==void 0&&(i.clearcoatMap=n(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(i.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(i.clearcoatNormalMap=n(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(i.clearcoatNormalScale=new Xe().fromArray(e.clearcoatNormalScale)),e.iridescenceMap!==void 0&&(i.iridescenceMap=n(e.iridescenceMap)),e.iridescenceThicknessMap!==void 0&&(i.iridescenceThicknessMap=n(e.iridescenceThicknessMap)),e.transmissionMap!==void 0&&(i.transmissionMap=n(e.transmissionMap)),e.thicknessMap!==void 0&&(i.thicknessMap=n(e.thicknessMap)),e.sheenColorMap!==void 0&&(i.sheenColorMap=n(e.sheenColorMap)),e.sheenRoughnessMap!==void 0&&(i.sheenRoughnessMap=n(e.sheenRoughnessMap)),i}setTextures(e){return this.textures=e,this}static createMaterialFromType(e){const t={ShadowMaterial:PC,SpriteMaterial:_C,RawShaderMaterial:BC,ShaderMaterial:nr,PointsMaterial:vg,MeshPhysicalMaterial:Vc,MeshStandardMaterial:Bf,MeshPhongMaterial:JL,MeshToonMaterial:ZL,MeshNormalMaterial:KL,MeshLambertMaterial:$L,MeshDepthMaterial:mC,MeshDistanceMaterial:gC,MeshBasicMaterial:Hi,MeshMatcapMaterial:e2,LineDashedMaterial:t2,LineBasicMaterial:Is,Material:Ts};return new t[e]}}class za{static decodeText(e){if(typeof TextDecoder<"u")return new TextDecoder().decode(e);let t="";for(let n=0,i=e.length;n<i;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class c2 extends Sn{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}clone(){return new this.constructor().copy(this)}toJSON(){const e=super.toJSON(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class l2 extends mr{constructor(e){super(e)}load(e,t,n,i){const r=this,o=new Fs(r.manager);o.setPath(r.path),o.setRequestHeader(r.requestHeader),o.setWithCredentials(r.withCredentials),o.load(e,function(l){try{t(r.parse(JSON.parse(l)))}catch(h){i?i(h):console.error(h),r.manager.itemError(e)}},n,i)}parse(e){const t={},n={};function i(A,v){if(t[v]!==void 0)return t[v];const b=A.interleavedBuffers[v],S=r(A,b.buffer),R=tf(b.type,S),M=new _g(R,b.stride);return M.uuid=b.uuid,t[v]=M,M}function r(A,v){if(n[v]!==void 0)return n[v];const b=A.arrayBuffers[v],S=new Uint32Array(b).buffer;return n[v]=S,S}const o=e.isInstancedBufferGeometry?new c2:new Sn,l=e.data.index;if(l!==void 0){const A=tf(l.type,l.array);o.setIndex(new Jn(A,1))}const h=e.data.attributes;for(const A in h){const v=h[A];let w;if(v.isInterleavedBufferAttribute){const b=i(e.data,v.data);w=new Xl(b,v.itemSize,v.offset,v.normalized)}else{const b=tf(v.type,v.array),S=v.isInstancedBufferAttribute?vf:Jn;w=new S(b,v.itemSize,v.normalized)}v.name!==void 0&&(w.name=v.name),v.usage!==void 0&&w.setUsage(v.usage),v.updateRange!==void 0&&(w.updateRange.offset=v.updateRange.offset,w.updateRange.count=v.updateRange.count),o.setAttribute(A,w)}const u=e.data.morphAttributes;if(u)for(const A in u){const v=u[A],w=[];for(let b=0,S=v.length;b<S;b++){const R=v[b];let M;if(R.isInterleavedBufferAttribute){const I=i(e.data,R.data);M=new Xl(I,R.itemSize,R.offset,R.normalized)}else{const I=tf(R.type,R.array);M=new Jn(I,R.itemSize,R.normalized)}R.name!==void 0&&(M.name=R.name),w.push(M)}o.morphAttributes[A]=w}e.data.morphTargetsRelative&&(o.morphTargetsRelative=!0);const g=e.data.groups||e.data.drawcalls||e.data.offsets;if(g!==void 0)for(let A=0,v=g.length;A!==v;++A){const w=g[A];o.addGroup(w.start,w.count,w.materialIndex)}const m=e.data.boundingSphere;if(m!==void 0){const A=new q;m.center!==void 0&&A.fromArray(m.center),o.boundingSphere=new Qa(A,m.radius)}return e.name&&(o.name=e.name),e.userData&&(o.userData=e.userData),o}}class lj extends mr{constructor(e){super(e)}load(e,t,n,i){const r=this,o=this.path===""?za.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||o;const l=new Fs(this.manager);l.setPath(this.path),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(h){let u=null;try{u=JSON.parse(h)}catch(g){i!==void 0&&i(g),console.error("THREE:ObjectLoader: Can't parse "+e+".",g.message);return}const f=u.metadata;if(f===void 0||f.type===void 0||f.type.toLowerCase()==="geometry"){console.error("THREE.ObjectLoader: Can't load "+e);return}r.parse(u,t)},n,i)}async loadAsync(e,t){const n=this,i=this.path===""?za.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||i;const r=new Fs(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials);const o=await r.loadAsync(e,t),l=JSON.parse(o),h=l.metadata;if(h===void 0||h.type===void 0||h.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+e);return await n.parseAsync(l)}parse(e,t){const n=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,i),o=this.parseImages(e.images,function(){t!==void 0&&t(u)}),l=this.parseTextures(e.textures,o),h=this.parseMaterials(e.materials,l),u=this.parseObject(e.object,r,h,l,n),f=this.parseSkeletons(e.skeletons,u);if(this.bindSkeletons(u,f),t!==void 0){let g=!1;for(const m in o)if(o[m].data instanceof HTMLImageElement){g=!0;break}g===!1&&t(u)}return u}async parseAsync(e){const t=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),i=this.parseGeometries(e.geometries,n),r=await this.parseImagesAsync(e.images),o=this.parseTextures(e.textures,r),l=this.parseMaterials(e.materials,o),h=this.parseObject(e.object,i,l,o,t),u=this.parseSkeletons(e.skeletons,h);return this.bindSkeletons(h,u),h}parseShapes(e){const t={};if(e!==void 0)for(let n=0,i=e.length;n<i;n++){const r=new xu().fromJSON(e[n]);t[r.uuid]=r}return t}parseSkeletons(e,t){const n={},i={};if(t.traverse(function(r){r.isBone&&(i[r.uuid]=r)}),e!==void 0)for(let r=0,o=e.length;r<o;r++){const l=new yg().fromJSON(e[r],i);n[l.uuid]=l}return n}parseGeometries(e,t){const n={};if(e!==void 0){const i=new l2;for(let r=0,o=e.length;r<o;r++){let l;const h=e[r];switch(h.type){case"BufferGeometry":case"InstancedBufferGeometry":l=i.parse(h);break;default:h.type in dR?l=dR[h.type].fromJSON(h,t):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${h.type}"`)}l.uuid=h.uuid,h.name!==void 0&&(l.name=h.name),l.isBufferGeometry===!0&&h.userData!==void 0&&(l.userData=h.userData),n[h.uuid]=l}}return n}parseMaterials(e,t){const n={},i={};if(e!==void 0){const r=new Gy;r.setTextures(t);for(let o=0,l=e.length;o<l;o++){const h=e[o];n[h.uuid]===void 0&&(n[h.uuid]=r.parse(h)),i[h.uuid]=n[h.uuid]}}return i}parseAnimations(e){const t={};if(e!==void 0)for(let n=0;n<e.length;n++){const i=e[n],r=Kl.parse(i);t[r.uuid]=r}return t}parseImages(e,t){const n=this,i={};let r;function o(h){return n.manager.itemStart(h),r.load(h,function(){n.manager.itemEnd(h)},void 0,function(){n.manager.itemError(h),n.manager.itemEnd(h)})}function l(h){if(typeof h=="string"){const u=h,f=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(u)?u:n.resourcePath+u;return o(f)}else return h.data?{data:tf(h.type,h.data),width:h.width,height:h.height}:null}if(e!==void 0&&e.length>0){const h=new FC(t);r=new Zm(h),r.setCrossOrigin(this.crossOrigin);for(let u=0,f=e.length;u<f;u++){const g=e[u],m=g.url;if(Array.isArray(m)){const A=[];for(let v=0,w=m.length;v<w;v++){const b=m[v],S=l(b);S!==null&&(S instanceof HTMLImageElement?A.push(S):A.push(new Na(S.data,S.width,S.height)))}i[g.uuid]=new Nl(A)}else{const A=l(g.url);i[g.uuid]=new Nl(A)}}}return i}async parseImagesAsync(e){const t=this,n={};let i;async function r(o){if(typeof o=="string"){const l=o,h=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(l)?l:t.resourcePath+l;return await i.loadAsync(h)}else return o.data?{data:tf(o.type,o.data),width:o.width,height:o.height}:null}if(e!==void 0&&e.length>0){i=new Zm(this.manager),i.setCrossOrigin(this.crossOrigin);for(let o=0,l=e.length;o<l;o++){const h=e[o],u=h.url;if(Array.isArray(u)){const f=[];for(let g=0,m=u.length;g<m;g++){const A=u[g],v=await r(A);v!==null&&(v instanceof HTMLImageElement?f.push(v):f.push(new Na(v.data,v.width,v.height)))}n[h.uuid]=new Nl(f)}else{const f=await r(h.url);n[h.uuid]=new Nl(f)}}}return n}parseTextures(e,t){function n(r,o){return typeof r=="number"?r:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",r),o[r])}const i={};if(e!==void 0)for(let r=0,o=e.length;r<o;r++){const l=e[r];l.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',l.uuid),t[l.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",l.image);const h=t[l.image],u=h.data;let f;Array.isArray(u)?(f=new gg,u.length===6&&(f.needsUpdate=!0)):(u&&u.data?f=new Na:f=new Vi,u&&(f.needsUpdate=!0)),f.source=h,f.uuid=l.uuid,l.name!==void 0&&(f.name=l.name),l.mapping!==void 0&&(f.mapping=n(l.mapping,hj)),l.offset!==void 0&&f.offset.fromArray(l.offset),l.repeat!==void 0&&f.repeat.fromArray(l.repeat),l.center!==void 0&&f.center.fromArray(l.center),l.rotation!==void 0&&(f.rotation=l.rotation),l.wrap!==void 0&&(f.wrapS=n(l.wrap[0],gR),f.wrapT=n(l.wrap[1],gR)),l.format!==void 0&&(f.format=l.format),l.type!==void 0&&(f.type=l.type),l.encoding!==void 0&&(f.encoding=l.encoding),l.minFilter!==void 0&&(f.minFilter=n(l.minFilter,AR)),l.magFilter!==void 0&&(f.magFilter=n(l.magFilter,AR)),l.anisotropy!==void 0&&(f.anisotropy=l.anisotropy),l.flipY!==void 0&&(f.flipY=l.flipY),l.premultiplyAlpha!==void 0&&(f.premultiplyAlpha=l.premultiplyAlpha),l.unpackAlignment!==void 0&&(f.unpackAlignment=l.unpackAlignment),l.userData!==void 0&&(f.userData=l.userData),i[l.uuid]=f}return i}parseObject(e,t,n,i,r){let o;function l(m){return t[m]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",m),t[m]}function h(m){if(m!==void 0){if(Array.isArray(m)){const A=[];for(let v=0,w=m.length;v<w;v++){const b=m[v];n[b]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",b),A.push(n[b])}return A}return n[m]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",m),n[m]}}function u(m){return i[m]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",m),i[m]}let f,g;switch(e.type){case"Scene":o=new vu,e.background!==void 0&&(Number.isInteger(e.background)?o.background=new _e(e.background):o.background=u(e.background)),e.environment!==void 0&&(o.environment=u(e.environment)),e.fog!==void 0&&(e.fog.type==="Fog"?o.fog=new By(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(o.fog=new Py(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":o=new ts(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(o.focus=e.focus),e.zoom!==void 0&&(o.zoom=e.zoom),e.filmGauge!==void 0&&(o.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(o.filmOffset=e.filmOffset),e.view!==void 0&&(o.view=Object.assign({},e.view));break;case"OrthographicCamera":o=new nh(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(o.zoom=e.zoom),e.view!==void 0&&(o.view=Object.assign({},e.view));break;case"AmbientLight":o=new zC(e.color,e.intensity);break;case"DirectionalLight":o=new zy(e.color,e.intensity);break;case"PointLight":o=new Uy(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":o=new a2(e.color,e.intensity,e.width,e.height);break;case"SpotLight":o=new Ny(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":o=new NC(e.color,e.groundColor,e.intensity);break;case"LightProbe":o=new xf().fromJSON(e);break;case"SkinnedMesh":f=l(e.geometry),g=h(e.material),o=new vC(f,g),e.bindMode!==void 0&&(o.bindMode=e.bindMode),e.bindMatrix!==void 0&&o.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(o.skeleton=e.skeleton);break;case"Mesh":f=l(e.geometry),g=h(e.material),o=new _t(f,g);break;case"InstancedMesh":f=l(e.geometry),g=h(e.material);const m=e.count,A=e.instanceMatrix,v=e.instanceColor;o=new xC(f,g,m),o.instanceMatrix=new vf(new Float32Array(A.array),16),v!==void 0&&(o.instanceColor=new vf(new Float32Array(v.array),v.itemSize));break;case"LOD":o=new yC;break;case"Line":o=new Ss(l(e.geometry),h(e.material));break;case"LineLoop":o=new wC(l(e.geometry),h(e.material));break;case"LineSegments":o=new zo(l(e.geometry),h(e.material));break;case"PointCloud":case"Points":o=new Dy(l(e.geometry),h(e.material));break;case"Sprite":o=new UL(h(e.material));break;case"Group":o=new sa;break;case"Bone":o=new Ly;break;default:o=new qt}if(o.uuid=e.uuid,e.name!==void 0&&(o.name=e.name),e.matrix!==void 0?(o.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(o.matrixAutoUpdate=e.matrixAutoUpdate),o.matrixAutoUpdate&&o.matrix.decompose(o.position,o.quaternion,o.scale)):(e.position!==void 0&&o.position.fromArray(e.position),e.rotation!==void 0&&o.rotation.fromArray(e.rotation),e.quaternion!==void 0&&o.quaternion.fromArray(e.quaternion),e.scale!==void 0&&o.scale.fromArray(e.scale)),e.castShadow!==void 0&&(o.castShadow=e.castShadow),e.receiveShadow!==void 0&&(o.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.bias!==void 0&&(o.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(o.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(o.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&o.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(o.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(o.visible=e.visible),e.frustumCulled!==void 0&&(o.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(o.renderOrder=e.renderOrder),e.userData!==void 0&&(o.userData=e.userData),e.layers!==void 0&&(o.layers.mask=e.layers),e.children!==void 0){const m=e.children;for(let A=0;A<m.length;A++)o.add(this.parseObject(m[A],t,n,i,r))}if(e.animations!==void 0){const m=e.animations;for(let A=0;A<m.length;A++){const v=m[A];o.animations.push(r[v])}}if(e.type==="LOD"){e.autoUpdate!==void 0&&(o.autoUpdate=e.autoUpdate);const m=e.levels;for(let A=0;A<m.length;A++){const v=m[A],w=o.getObjectByProperty("uuid",v.object);w!==void 0&&o.addLevel(w,v.distance)}}return o}bindSkeletons(e,t){Object.keys(t).length!==0&&e.traverse(function(n){if(n.isSkinnedMesh===!0&&n.skeleton!==void 0){const i=t[n.skeleton];i===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",n.skeleton):n.bind(i,n.bindMatrix)}})}}const hj={UVMapping:Cy,CubeReflectionMapping:jl,CubeRefractionMapping:ql,EquirectangularReflectionMapping:ka,EquirectangularRefractionMapping:gf,CubeUVReflectionMapping:Mf},gR={RepeatWrapping:Fc,ClampToEdgeWrapping:$s,MirroredRepeatWrapping:Cu},AR={NearestFilter:Ki,NearestMipmapNearestFilter:Af,NearestMipmapLinearFilter:_f,LinearFilter:yi,LinearMipmapNearestFilter:fg,LinearMipmapLinearFilter:fa};class h2 extends mr{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,n,i){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=Iu.get(e);if(o!==void 0)return r.manager.itemStart(e),setTimeout(function(){t&&t(o),r.manager.itemEnd(e)},0),o;const l={};l.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",l.headers=this.requestHeader,fetch(e,l).then(function(h){return h.blob()}).then(function(h){return createImageBitmap(h,Object.assign(r.options,{colorSpaceConversion:"none"}))}).then(function(h){Iu.add(e,h),t&&t(h),r.manager.itemEnd(e)}).catch(function(h){i&&i(h),r.manager.itemError(e),r.manager.itemEnd(e)}),r.manager.itemStart(e)}}let q0;const GC={getContext:function(){return q0===void 0&&(q0=new(window.AudioContext||window.webkitAudioContext)),q0},setContext:function(a){q0=a}};class K_ extends mr{constructor(e){super(e)}load(e,t,n,i){const r=this,o=new Fs(this.manager);o.setResponseType("arraybuffer"),o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(l){try{const h=l.slice(0);GC.getContext().decodeAudioData(h,function(f){t(f)})}catch(h){i?i(h):console.error(h),r.manager.itemError(e)}},n,i)}}class uj extends xf{constructor(e,t,n=1){super(void 0,n),this.isHemisphereLightProbe=!0;const i=new _e().set(e),r=new _e().set(t),o=new q(i.r,i.g,i.b),l=new q(r.r,r.g,r.b),h=Math.sqrt(Math.PI),u=h*Math.sqrt(.75);this.sh.coefficients[0].copy(o).add(l).multiplyScalar(h),this.sh.coefficients[1].copy(o).sub(l).multiplyScalar(u)}}class dj extends xf{constructor(e,t=1){super(void 0,t),this.isAmbientLightProbe=!0;const n=new _e().set(e);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}}const _R=new xn,yR=new xn,Hh=new xn;class fj{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new ts,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new ts,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,Hh.copy(e.projectionMatrix);const i=t.eyeSep/2,r=i*t.near/t.focus,o=t.near*Math.tan(_u*t.fov*.5)/t.zoom;let l,h;yR.elements[12]=-i,_R.elements[12]=i,l=-o*t.aspect+r,h=o*t.aspect+r,Hh.elements[0]=2*t.near/(h-l),Hh.elements[8]=(h+l)/(h-l),this.cameraL.projectionMatrix.copy(Hh),l=-o*t.aspect-r,h=o*t.aspect-r,Hh.elements[0]=2*t.near/(h-l),Hh.elements[8]=(h+l)/(h-l),this.cameraR.projectionMatrix.copy(Hh)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(yR),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(_R)}}class Hy{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=vR(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=vR();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function vR(){return(typeof performance>"u"?Date:performance).now()}const Vh=new q,xR=new Ot,pj=new q,Wh=new q;class HC extends qt{constructor(){super(),this.type="AudioListener",this.context=GC.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Hy}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Vh,xR,pj),Wh.set(0,0,-1).applyQuaternion(xR),t.positionX){const i=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(Vh.x,i),t.positionY.linearRampToValueAtTime(Vh.y,i),t.positionZ.linearRampToValueAtTime(Vh.z,i),t.forwardX.linearRampToValueAtTime(Wh.x,i),t.forwardY.linearRampToValueAtTime(Wh.y,i),t.forwardZ.linearRampToValueAtTime(Wh.z,i),t.upX.linearRampToValueAtTime(n.x,i),t.upY.linearRampToValueAtTime(n.y,i),t.upZ.linearRampToValueAtTime(n.z,i)}else t.setPosition(Vh.x,Vh.y,Vh.z),t.setOrientation(Wh.x,Wh.y,Wh.z,n.x,n.y,n.z)}}class Vy extends qt{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const Qh=new q,wR=new Ot,mj=new q,jh=new q;class u2 extends Vy{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(Qh,wR,mj),jh.set(0,0,1).applyQuaternion(wR);const t=this.panner;if(t.positionX){const n=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(Qh.x,n),t.positionY.linearRampToValueAtTime(Qh.y,n),t.positionZ.linearRampToValueAtTime(Qh.z,n),t.orientationX.linearRampToValueAtTime(jh.x,n),t.orientationY.linearRampToValueAtTime(jh.y,n),t.orientationZ.linearRampToValueAtTime(jh.z,n)}else t.setPosition(Qh.x,Qh.y,Qh.z),t.setOrientation(jh.x,jh.y,jh.z)}}class d2{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}}class f2{constructor(e,t,n){this.binding=e,this.valueSize=n;let i,r,o;switch(t){case"quaternion":i=this._slerp,r=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(n*6),this._workIndex=5;break;case"string":case"bool":i=this._select,r=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(n*5);break;default:i=this._lerp,r=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(n*5)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=r,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const n=this.buffer,i=this.valueSize,r=e*i+i;let o=this.cumulativeWeight;if(o===0){for(let l=0;l!==i;++l)n[r+l]=n[l];o=t}else{o+=t;const l=t/o;this._mixBufferRegion(n,r,0,l,i)}this.cumulativeWeight=o}accumulateAdditive(e){const t=this.buffer,n=this.valueSize,i=n*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,i,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,n=this.buffer,i=e*t+t,r=this.cumulativeWeight,o=this.cumulativeWeightAdditive,l=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const h=t*this._origIndex;this._mixBufferRegion(n,i,h,1-r,t)}o>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*t,1,t);for(let h=t,u=t+t;h!==u;++h)if(n[h]!==n[h+t]){l.setValue(n,i);break}}saveOriginalState(){const e=this.binding,t=this.buffer,n=this.valueSize,i=n*this._origIndex;e.getValue(t,i);for(let r=n,o=i;r!==o;++r)t[r]=t[i+r%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,i,r){if(i>=.5)for(let o=0;o!==r;++o)e[t+o]=e[n+o]}_slerp(e,t,n,i){Ot.slerpFlat(e,t,e,t,e,n,i)}_slerpAdditive(e,t,n,i,r){const o=this._workIndex*r;Ot.multiplyQuaternionsFlat(e,o,e,t,e,n),Ot.slerpFlat(e,t,e,t,e,o,i)}_lerp(e,t,n,i,r){const o=1-i;for(let l=0;l!==r;++l){const h=t+l;e[h]=e[h]*o+e[n+l]*i}}_lerpAdditive(e,t,n,i,r){for(let o=0;o!==r;++o){const l=t+o;e[l]=e[l]+e[n+o]*i}}}const VC="\\[\\]\\.:\\/",gj=new RegExp("["+VC+"]","g"),WC="[^"+VC+"]",Aj="[^"+VC.replace("\\.","")+"]",_j=/((?:WC+[\/:])*)/.source.replace("WC",WC),yj=/(WCOD+)?/.source.replace("WCOD",Aj),vj=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",WC),xj=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",WC),wj=new RegExp("^"+_j+yj+vj+xj+"$"),bj=["material","materials","bones","map"];class Ej{constructor(e,t,n){const i=n||ni.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,i=this._bindings[n];i!==void 0&&i.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}class ni{constructor(e,t,n){this.path=t,this.parsedPath=n||ni.parseTrackName(t),this.node=ni.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new ni.Composite(e,t,n):new ni(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(gj,"")}static parseTrackName(e){const t=wj.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(i!==void 0&&i!==-1){const r=n.nodeName.substring(i+1);bj.indexOf(r)!==-1&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=r)}if(n.propertyName===null||n.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(n!==void 0)return n}if(e.children){const n=function(r){for(let o=0;o<r.length;o++){const l=r[o];if(l.name===t||l.uuid===t)return l;const h=n(l.children);if(h)return h}return null},i=n(e.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)e[t++]=n[i]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,i=t.propertyName;let r=t.propertyIndex;if(e||(e=ni.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(n){let u=t.objectIndex;switch(n){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let f=0;f<e.length;f++)if(e[f].name===u){u=f;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[n]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[n]}if(u!==void 0){if(e[u]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[u]}}const o=e[i];if(o===void 0){const u=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+u+"."+i+" but it wasn't found.",e);return}let l=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?l=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(l=this.Versioning.MatrixWorldNeedsUpdate);let h=this.BindingType.Direct;if(r!==void 0){if(i==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[r]!==void 0&&(r=e.morphTargetDictionary[r])}h=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=r}else o.fromArray!==void 0&&o.toArray!==void 0?(h=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(h=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=i;this.getValue=this.GetterByBindingType[h],this.setValue=this.SetterByBindingTypeAndVersioning[h][l]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}ni.Composite=Ej;ni.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};ni.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};ni.prototype.GetterByBindingType=[ni.prototype._getValue_direct,ni.prototype._getValue_array,ni.prototype._getValue_arrayElement,ni.prototype._getValue_toArray];ni.prototype.SetterByBindingTypeAndVersioning=[[ni.prototype._setValue_direct,ni.prototype._setValue_direct_setNeedsUpdate,ni.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[ni.prototype._setValue_array,ni.prototype._setValue_array_setNeedsUpdate,ni.prototype._setValue_array_setMatrixWorldNeedsUpdate],[ni.prototype._setValue_arrayElement,ni.prototype._setValue_arrayElement_setNeedsUpdate,ni.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[ni.prototype._setValue_fromArray,ni.prototype._setValue_fromArray_setNeedsUpdate,ni.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Cj{constructor(){this.isAnimationObjectGroup=!0,this.uuid=so(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let n=0,i=arguments.length;n!==i;++n)e[arguments[n].uuid]=n;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,n=this._paths,i=this._parsedPaths,r=this._bindings,o=r.length;let l,h=e.length,u=this.nCachedObjects_;for(let f=0,g=arguments.length;f!==g;++f){const m=arguments[f],A=m.uuid;let v=t[A];if(v===void 0){v=h++,t[A]=v,e.push(m);for(let w=0,b=o;w!==b;++w)r[w].push(new ni(m,n[w],i[w]))}else if(v<u){l=e[v];const w=--u,b=e[w];t[b.uuid]=v,e[v]=b,t[A]=w,e[w]=m;for(let S=0,R=o;S!==R;++S){const M=r[S],I=M[w];let T=M[v];M[v]=I,T===void 0&&(T=new ni(m,n[S],i[S])),M[w]=T}}else e[v]!==l&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=u}remove(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length;let r=this.nCachedObjects_;for(let o=0,l=arguments.length;o!==l;++o){const h=arguments[o],u=h.uuid,f=t[u];if(f!==void 0&&f>=r){const g=r++,m=e[g];t[m.uuid]=f,e[f]=m,t[u]=g,e[g]=h;for(let A=0,v=i;A!==v;++A){const w=n[A],b=w[g],S=w[f];w[f]=b,w[g]=S}}}this.nCachedObjects_=r}uncache(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length;let r=this.nCachedObjects_,o=e.length;for(let l=0,h=arguments.length;l!==h;++l){const u=arguments[l],f=u.uuid,g=t[f];if(g!==void 0)if(delete t[f],g<r){const m=--r,A=e[m],v=--o,w=e[v];t[A.uuid]=g,e[g]=A,t[w.uuid]=m,e[m]=w,e.pop();for(let b=0,S=i;b!==S;++b){const R=n[b],M=R[m],I=R[v];R[g]=M,R[m]=I,R.pop()}}else{const m=--o,A=e[m];m>0&&(t[A.uuid]=g),e[g]=A,e.pop();for(let v=0,w=i;v!==w;++v){const b=n[v];b[g]=b[m],b.pop()}}}this.nCachedObjects_=r}subscribe_(e,t){const n=this._bindingsIndicesByPath;let i=n[e];const r=this._bindings;if(i!==void 0)return r[i];const o=this._paths,l=this._parsedPaths,h=this._objects,u=h.length,f=this.nCachedObjects_,g=new Array(u);i=r.length,n[e]=i,o.push(e),l.push(t),r.push(g);for(let m=f,A=h.length;m!==A;++m){const v=h[m];g[m]=new ni(v,e,t)}return g}unsubscribe_(e){const t=this._bindingsIndicesByPath,n=t[e];if(n!==void 0){const i=this._paths,r=this._parsedPaths,o=this._bindings,l=o.length-1,h=o[l],u=e[l];t[u]=n,o[n]=h,o.pop(),r[n]=r[l],r.pop(),i[n]=i[l],i.pop()}}}class Sj{constructor(e,t,n=null,i=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=i;const r=t.tracks,o=r.length,l=new Array(o),h={endingStart:hu,endingEnd:hu};for(let u=0;u!==o;++u){const f=r[u].createInterpolant(null);l[u]=f,f.settings=h}this._interpolantSettings=h,this._interpolants=l,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=sC,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){const i=this._clip.duration,r=e._clip.duration,o=r/i,l=i/r;e.warp(1,o,t),this.warp(l,1,t)}return this}crossFadeTo(e,t,n){return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const i=this._mixer,r=i.time,o=this.timeScale;let l=this._timeScaleInterpolant;l===null&&(l=i._lendControlInterpolant(),this._timeScaleInterpolant=l);const h=l.parameterPositions,u=l.sampleValues;return h[0]=r,h[1]=r+n,u[0]=e/o,u[1]=t/o,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,i){if(!this.enabled){this._updateWeight(e);return}const r=this._startTime;if(r!==null){const h=(e-r)*n;h<0||n===0?t=0:(this._startTime=null,t=n*h)}t*=this._updateTimeScale(e);const o=this._updateTime(t),l=this._updateWeight(e);if(l>0){const h=this._interpolants,u=this._propertyBindings;switch(this.blendMode){case rC:for(let f=0,g=h.length;f!==g;++f)h[f].evaluate(o),u[f].accumulateAdditive(l);break;case My:default:for(let f=0,g=h.length;f!==g;++f)h[f].evaluate(o),u[f].accumulate(i,l)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(n!==null){const i=n.evaluate(e)[0];t*=i,e>n.parameterPositions[1]&&(this.stopFading(),i===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;n!==null&&(t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,n=this.loop;let i=this.time+e,r=this._loopCount;const o=n===aL;if(e===0)return r===-1?i:o&&(r&1)===1?t-i:i;if(n===Sy){r===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(i>=t)i=t;else if(i<0)i=0;else{this.time=i;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(r===-1&&(e>=0?(r=0,this._setEndings(!0,this.repetitions===0,o)):this._setEndings(this.repetitions===0,!0,o)),i>=t||i<0){const l=Math.floor(i/t);i-=t*l,r+=Math.abs(l);const h=this.repetitions-r;if(h<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=e>0?t:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(h===1){const u=e<0;this._setEndings(u,!u,o)}else this._setEndings(!1,!1,o);this._loopCount=r,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:l})}}else this.time=i;if(o&&(r&1)===1)return t-i}return i}_setEndings(e,t,n){const i=this._interpolantSettings;n?(i.endingStart=uu,i.endingEnd=uu):(e?i.endingStart=this.zeroSlopeAtStart?uu:hu:i.endingStart=Vm,t?i.endingEnd=this.zeroSlopeAtEnd?uu:hu:i.endingEnd=Vm)}_scheduleFading(e,t,n){const i=this._mixer,r=i.time;let o=this._weightInterpolant;o===null&&(o=i._lendControlInterpolant(),this._weightInterpolant=o);const l=o.parameterPositions,h=o.sampleValues;return l[0]=r,h[0]=t,l[1]=r+e,h[1]=n,this}}const Mj=new Float32Array(1);class Wy extends Uo{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const n=e._localRoot||this._root,i=e._clip.tracks,r=i.length,o=e._propertyBindings,l=e._interpolants,h=n.uuid,u=this._bindingsByRootAndName;let f=u[h];f===void 0&&(f={},u[h]=f);for(let g=0;g!==r;++g){const m=i[g],A=m.name;let v=f[A];if(v!==void 0)++v.referenceCount,o[g]=v;else{if(v=o[g],v!==void 0){v._cacheIndex===null&&(++v.referenceCount,this._addInactiveBinding(v,h,A));continue}const w=t&&t._propertyBindings[g].binding.parsedPath;v=new f2(ni.create(n,A,w),m.ValueTypeName,m.getValueSize()),++v.referenceCount,this._addInactiveBinding(v,h,A),o[g]=v}l[g].resultBuffer=v.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const n=(e._localRoot||this._root).uuid,i=e._clip.uuid,r=this._actionsByClip[i];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,i,n)}const t=e._propertyBindings;for(let n=0,i=t.length;n!==i;++n){const r=t[n];r.useCount++===0&&(this._lendBinding(r),r.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let n=0,i=t.length;n!==i;++n){const r=t[n];--r.useCount===0&&(r.restoreOriginalState(),this._takeBackBinding(r))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,n){const i=this._actions,r=this._actionsByClip;let o=r[t];if(o===void 0)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=o;else{const l=o.knownActions;e._byClipCacheIndex=l.length,l.push(e)}e._cacheIndex=i.length,i.push(e),o.actionByRoot[n]=e}_removeInactiveAction(e){const t=this._actions,n=t[t.length-1],i=e._cacheIndex;n._cacheIndex=i,t[i]=n,t.pop(),e._cacheIndex=null;const r=e._clip.uuid,o=this._actionsByClip,l=o[r],h=l.knownActions,u=h[h.length-1],f=e._byClipCacheIndex;u._byClipCacheIndex=f,h[f]=u,h.pop(),e._byClipCacheIndex=null;const g=l.actionByRoot,m=(e._localRoot||this._root).uuid;delete g[m],h.length===0&&delete o[r],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let n=0,i=t.length;n!==i;++n){const r=t[n];--r.referenceCount===0&&this._removeInactiveBinding(r)}}_lendAction(e){const t=this._actions,n=e._cacheIndex,i=this._nActiveActions++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_takeBackAction(e){const t=this._actions,n=e._cacheIndex,i=--this._nActiveActions,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_addInactiveBinding(e,t,n){const i=this._bindingsByRootAndName,r=this._bindings;let o=i[t];o===void 0&&(o={},i[t]=o),o[n]=e,e._cacheIndex=r.length,r.push(e)}_removeInactiveBinding(e){const t=this._bindings,n=e.binding,i=n.rootNode.uuid,r=n.path,o=this._bindingsByRootAndName,l=o[i],h=t[t.length-1],u=e._cacheIndex;h._cacheIndex=u,t[u]=h,t.pop(),delete l[r],Object.keys(l).length===0&&delete o[i]}_lendBinding(e){const t=this._bindings,n=e._cacheIndex,i=this._nActiveBindings++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_takeBackBinding(e){const t=this._bindings,n=e._cacheIndex,i=--this._nActiveBindings,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return n===void 0&&(n=new OC(new Float32Array(2),new Float32Array(2),1,Mj),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){const t=this._controlInterpolants,n=e.__cacheIndex,i=--this._nActiveControlInterpolants,r=t[i];e.__cacheIndex=i,t[i]=e,r.__cacheIndex=n,t[n]=r}clipAction(e,t,n){const i=t||this._root,r=i.uuid;let o=typeof e=="string"?Kl.findByName(i,e):e;const l=o!==null?o.uuid:e,h=this._actionsByClip[l];let u=null;if(n===void 0&&(o!==null?n=o.blendMode:n=My),h!==void 0){const g=h.actionByRoot[r];if(g!==void 0&&g.blendMode===n)return g;u=h.knownActions[0],o===null&&(o=u._clip)}if(o===null)return null;const f=new Sj(this,o,t,n);return this._bindAction(f,u),this._addInactiveAction(f,l,r),f}existingAction(e,t){const n=t||this._root,i=n.uuid,r=typeof e=="string"?Kl.findByName(n,e):e,o=r?r.uuid:e,l=this._actionsByClip[o];return l!==void 0&&l.actionByRoot[i]||null}stopAllAction(){const e=this._actions,t=this._nActiveActions;for(let n=t-1;n>=0;--n)e[n].stop();return this}update(e){e*=this.timeScale;const t=this._actions,n=this._nActiveActions,i=this.time+=e,r=Math.sign(e),o=this._accuIndex^=1;for(let u=0;u!==n;++u)t[u]._update(i,e,r,o);const l=this._bindings,h=this._nActiveBindings;for(let u=0;u!==h;++u)l[u].apply(o);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,n=e.uuid,i=this._actionsByClip,r=i[n];if(r!==void 0){const o=r.knownActions;for(let l=0,h=o.length;l!==h;++l){const u=o[l];this._deactivateAction(u);const f=u._cacheIndex,g=t[t.length-1];u._cacheIndex=null,u._byClipCacheIndex=null,g._cacheIndex=f,t[f]=g,t.pop(),this._removeInactiveBindingsForAction(u)}delete i[n]}}uncacheRoot(e){const t=e.uuid,n=this._actionsByClip;for(const o in n){const l=n[o].actionByRoot,h=l[t];h!==void 0&&(this._deactivateAction(h),this._removeInactiveAction(h))}const i=this._bindingsByRootAndName,r=i[t];if(r!==void 0)for(const o in r){const l=r[o];l.restoreOriginalState(),this._removeInactiveBinding(l)}}uncacheAction(e,t){const n=this.existingAction(e,t);n!==null&&(this._deactivateAction(n),this._removeInactiveAction(n))}}class Bg{constructor(e){this.value=e}clone(){return new Bg(this.value.clone===void 0?this.value:this.value.clone())}}let Tj=0;class Ij extends Uo{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:Tj++}),this.name="",this.usage=Wm,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(e){this.name=e.name,this.usage=e.usage;const t=e.uniforms;this.uniforms.length=0;for(let n=0,i=t.length;n<i;n++)this.uniforms.push(t[n].clone());return this}clone(){return new this.constructor().copy(this)}}class Rj extends _g{constructor(e,t,n=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}class Pj{constructor(e,t,n,i,r){this.isGLBufferAttribute=!0,this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=i,this.count=r,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}class Du{constructor(e,t,n=0,i=1/0){this.ray=new Pu(e,t),this.near=n,this.far=i,this.camera=null,this.layers=new Va,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,n=[]){return lE(e,this,n,t),n.sort(bR),n}intersectObjects(e,t=!0,n=[]){for(let i=0,r=e.length;i<r;i++)lE(e[i],this,n,t);return n.sort(bR),n}}function bR(a,e){return a.distance-e.distance}function lE(a,e,t,n){if(a.layers.test(e.layers)&&a.raycast(e,t),n===!0){const i=a.children;for(let r=0,o=i.length;r<o;r++)lE(i[r],e,t,!0)}}class hE{constructor(e=1,t=0,n=0){return this.radius=e,this.phi=t,this.theta=n,this}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(As(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class Bj{constructor(e=1,t=0,n=0){return this.radius=e,this.theta=t,this.y=n,this}set(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}clone(){return new this.constructor().copy(this)}}const ER=new Xe;class Lj{constructor(e=new Xe(1/0,1/0),t=new Xe(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=ER.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return ER.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const CR=new q,X0=new q;class Dj{constructor(e=new q,t=new q){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){CR.subVectors(e,this.start),X0.subVectors(this.end,this.start);const n=X0.dot(X0);let r=X0.dot(CR)/n;return t&&(r=As(r,0,1)),r}closestPointToPoint(e,t,n){const i=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(i).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const SR=new q;class Oj extends qt{constructor(e,t){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;const n=new Sn,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let o=0,l=1,h=32;o<h;o++,l++){const u=o/h*Math.PI*2,f=l/h*Math.PI*2;i.push(Math.cos(u),Math.sin(u),1,Math.cos(f),Math.sin(f),1)}n.setAttribute("position",new tn(i,3));const r=new Is({fog:!1,toneMapped:!1});this.cone=new zo(n,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),SR.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(SR),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const _l=new q,Y0=new xn,Hw=new xn;class Fj extends zo{constructor(e){const t=p2(e),n=new Sn,i=[],r=[],o=new _e(0,0,1),l=new _e(0,1,0);for(let u=0;u<t.length;u++){const f=t[u];f.parent&&f.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),r.push(o.r,o.g,o.b),r.push(l.r,l.g,l.b))}n.setAttribute("position",new tn(i,3)),n.setAttribute("color",new tn(r,3));const h=new Is({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(n,h),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,n=this.geometry,i=n.getAttribute("position");Hw.copy(this.root.matrixWorld).invert();for(let r=0,o=0;r<t.length;r++){const l=t[r];l.parent&&l.parent.isBone&&(Y0.multiplyMatrices(Hw,l.matrixWorld),_l.setFromMatrixPosition(Y0),i.setXYZ(o,_l.x,_l.y,_l.z),Y0.multiplyMatrices(Hw,l.parent.matrixWorld),_l.setFromMatrixPosition(Y0),i.setXYZ(o+1,_l.x,_l.y,_l.z),o+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}}function p2(a){const e=[];a.isBone===!0&&e.push(a);for(let t=0;t<a.children.length;t++)e.push.apply(e,p2(a.children[t]));return e}class kj extends _t{constructor(e,t,n){const i=new ho(t,4,2),r=new Hi({wireframe:!0,fog:!1,toneMapped:!1});super(i,r),this.light=e,this.light.updateMatrixWorld(),this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const Nj=new q,MR=new _e,TR=new _e;class Uj extends qt{constructor(e,t,n){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n;const i=new Oa(t);i.rotateY(Math.PI*.5),this.material=new Hi({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const r=i.getAttribute("position"),o=new Float32Array(r.count*3);i.setAttribute("color",new Jn(o,3)),this.add(new _t(i,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");MR.copy(this.light.color),TR.copy(this.light.groundColor);for(let n=0,i=t.count;n<i;n++){const r=n<i/2?MR:TR;t.setXYZ(n,r.r,r.g,r.b)}t.needsUpdate=!0}e.lookAt(Nj.setFromMatrixPosition(this.light.matrixWorld).negate())}}class m2 extends zo{constructor(e=10,t=10,n=4473924,i=8947848){n=new _e(n),i=new _e(i);const r=t/2,o=e/t,l=e/2,h=[],u=[];for(let m=0,A=0,v=-l;m<=t;m++,v+=o){h.push(-l,0,v,l,0,v),h.push(v,0,-l,v,0,l);const w=m===r?n:i;w.toArray(u,A),A+=3,w.toArray(u,A),A+=3,w.toArray(u,A),A+=3,w.toArray(u,A),A+=3}const f=new Sn;f.setAttribute("position",new tn(h,3)),f.setAttribute("color",new tn(u,3));const g=new Is({vertexColors:!0,toneMapped:!1});super(f,g),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class zj extends zo{constructor(e=10,t=16,n=8,i=64,r=4473924,o=8947848){r=new _e(r),o=new _e(o);const l=[],h=[];if(t>1)for(let g=0;g<t;g++){const m=g/t*(Math.PI*2),A=Math.sin(m)*e,v=Math.cos(m)*e;l.push(0,0,0),l.push(A,0,v);const w=g&1?r:o;h.push(w.r,w.g,w.b),h.push(w.r,w.g,w.b)}for(let g=0;g<n;g++){const m=g&1?r:o,A=e-e/n*g;for(let v=0;v<i;v++){let w=v/i*(Math.PI*2),b=Math.sin(w)*A,S=Math.cos(w)*A;l.push(b,0,S),h.push(m.r,m.g,m.b),w=(v+1)/i*(Math.PI*2),b=Math.sin(w)*A,S=Math.cos(w)*A,l.push(b,0,S),h.push(m.r,m.g,m.b)}}const u=new Sn;u.setAttribute("position",new tn(l,3)),u.setAttribute("color",new tn(h,3));const f=new Is({vertexColors:!0,toneMapped:!1});super(u,f),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const IR=new q,J0=new q,RR=new q;class g2 extends qt{constructor(e,t,n){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,t===void 0&&(t=1);let i=new Sn;i.setAttribute("position",new tn([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const r=new Is({fog:!1,toneMapped:!1});this.lightPlane=new Ss(i,r),this.add(this.lightPlane),i=new Sn,i.setAttribute("position",new tn([0,0,0,0,0,1],3)),this.targetLine=new Ss(i,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){IR.setFromMatrixPosition(this.light.matrixWorld),J0.setFromMatrixPosition(this.light.target.matrixWorld),RR.subVectors(J0,IR),this.lightPlane.lookAt(J0),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(J0),this.targetLine.scale.z=RR.length()}}const Z0=new q,os=new Ty;class A2 extends zo{constructor(e){const t=new Sn,n=new Is({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],r=[],o={};l("n1","n2"),l("n2","n4"),l("n4","n3"),l("n3","n1"),l("f1","f2"),l("f2","f4"),l("f4","f3"),l("f3","f1"),l("n1","f1"),l("n2","f2"),l("n3","f3"),l("n4","f4"),l("p","n1"),l("p","n2"),l("p","n3"),l("p","n4"),l("u1","u2"),l("u2","u3"),l("u3","u1"),l("c","t"),l("p","c"),l("cn1","cn2"),l("cn3","cn4"),l("cf1","cf2"),l("cf3","cf4");function l(v,w){h(v),h(w)}function h(v){i.push(0,0,0),r.push(0,0,0),o[v]===void 0&&(o[v]=[]),o[v].push(i.length/3-1)}t.setAttribute("position",new tn(i,3)),t.setAttribute("color",new tn(r,3)),super(t,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update();const u=new _e(16755200),f=new _e(16711680),g=new _e(43775),m=new _e(16777215),A=new _e(3355443);this.setColors(u,f,g,m,A)}setColors(e,t,n,i,r){const l=this.geometry.getAttribute("color");l.setXYZ(0,e.r,e.g,e.b),l.setXYZ(1,e.r,e.g,e.b),l.setXYZ(2,e.r,e.g,e.b),l.setXYZ(3,e.r,e.g,e.b),l.setXYZ(4,e.r,e.g,e.b),l.setXYZ(5,e.r,e.g,e.b),l.setXYZ(6,e.r,e.g,e.b),l.setXYZ(7,e.r,e.g,e.b),l.setXYZ(8,e.r,e.g,e.b),l.setXYZ(9,e.r,e.g,e.b),l.setXYZ(10,e.r,e.g,e.b),l.setXYZ(11,e.r,e.g,e.b),l.setXYZ(12,e.r,e.g,e.b),l.setXYZ(13,e.r,e.g,e.b),l.setXYZ(14,e.r,e.g,e.b),l.setXYZ(15,e.r,e.g,e.b),l.setXYZ(16,e.r,e.g,e.b),l.setXYZ(17,e.r,e.g,e.b),l.setXYZ(18,e.r,e.g,e.b),l.setXYZ(19,e.r,e.g,e.b),l.setXYZ(20,e.r,e.g,e.b),l.setXYZ(21,e.r,e.g,e.b),l.setXYZ(22,e.r,e.g,e.b),l.setXYZ(23,e.r,e.g,e.b),l.setXYZ(24,t.r,t.g,t.b),l.setXYZ(25,t.r,t.g,t.b),l.setXYZ(26,t.r,t.g,t.b),l.setXYZ(27,t.r,t.g,t.b),l.setXYZ(28,t.r,t.g,t.b),l.setXYZ(29,t.r,t.g,t.b),l.setXYZ(30,t.r,t.g,t.b),l.setXYZ(31,t.r,t.g,t.b),l.setXYZ(32,n.r,n.g,n.b),l.setXYZ(33,n.r,n.g,n.b),l.setXYZ(34,n.r,n.g,n.b),l.setXYZ(35,n.r,n.g,n.b),l.setXYZ(36,n.r,n.g,n.b),l.setXYZ(37,n.r,n.g,n.b),l.setXYZ(38,i.r,i.g,i.b),l.setXYZ(39,i.r,i.g,i.b),l.setXYZ(40,r.r,r.g,r.b),l.setXYZ(41,r.r,r.g,r.b),l.setXYZ(42,r.r,r.g,r.b),l.setXYZ(43,r.r,r.g,r.b),l.setXYZ(44,r.r,r.g,r.b),l.setXYZ(45,r.r,r.g,r.b),l.setXYZ(46,r.r,r.g,r.b),l.setXYZ(47,r.r,r.g,r.b),l.setXYZ(48,r.r,r.g,r.b),l.setXYZ(49,r.r,r.g,r.b),l.needsUpdate=!0}update(){const e=this.geometry,t=this.pointMap,n=1,i=1;os.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),ms("c",t,e,os,0,0,-1),ms("t",t,e,os,0,0,1),ms("n1",t,e,os,-n,-i,-1),ms("n2",t,e,os,n,-i,-1),ms("n3",t,e,os,-n,i,-1),ms("n4",t,e,os,n,i,-1),ms("f1",t,e,os,-n,-i,1),ms("f2",t,e,os,n,-i,1),ms("f3",t,e,os,-n,i,1),ms("f4",t,e,os,n,i,1),ms("u1",t,e,os,n*.7,i*1.1,-1),ms("u2",t,e,os,-n*.7,i*1.1,-1),ms("u3",t,e,os,0,i*2,-1),ms("cf1",t,e,os,-n,0,1),ms("cf2",t,e,os,n,0,1),ms("cf3",t,e,os,0,-i,1),ms("cf4",t,e,os,0,i,1),ms("cn1",t,e,os,-n,0,-1),ms("cn2",t,e,os,n,0,-1),ms("cn3",t,e,os,0,-i,-1),ms("cn4",t,e,os,0,i,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function ms(a,e,t,n,i,r,o){Z0.set(i,r,o).unproject(n);const l=e[a];if(l!==void 0){const h=t.getAttribute("position");for(let u=0,f=l.length;u<f;u++)h.setXYZ(l[u],Z0.x,Z0.y,Z0.z)}}const K0=new Mr;class QC extends zo{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(8*3),r=new Sn;r.setIndex(new Jn(n,1)),r.setAttribute("position",new Jn(i,3)),super(r,new Is({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(e!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&K0.setFromObject(this.object),K0.isEmpty())return;const t=K0.min,n=K0.max,i=this.geometry.attributes.position,r=i.array;r[0]=n.x,r[1]=n.y,r[2]=n.z,r[3]=t.x,r[4]=n.y,r[5]=n.z,r[6]=t.x,r[7]=t.y,r[8]=n.z,r[9]=n.x,r[10]=t.y,r[11]=n.z,r[12]=n.x,r[13]=n.y,r[14]=t.z,r[15]=t.x,r[16]=n.y,r[17]=t.z,r[18]=t.x,r[19]=t.y,r[20]=t.z,r[21]=n.x,r[22]=t.y,r[23]=t.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Gj extends zo{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],r=new Sn;r.setIndex(new Jn(n,1)),r.setAttribute("position",new tn(i,3)),super(r,new Is({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class Hj extends Ss{constructor(e,t=1,n=16776960){const i=n,r=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],o=new Sn;o.setAttribute("position",new tn(r,3)),o.computeBoundingSphere(),super(o,new Is({color:i,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const l=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],h=new Sn;h.setAttribute("position",new tn(l,3)),h.computeBoundingSphere(),this.add(new _t(h,new Hi({color:i,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const PR=new q;let $0,Vw;class Vj extends qt{constructor(e=new q(0,0,1),t=new q(0,0,0),n=1,i=16776960,r=n*.2,o=r*.2){super(),this.type="ArrowHelper",$0===void 0&&($0=new Sn,$0.setAttribute("position",new tn([0,0,0,0,1,0],3)),Vw=new cs(0,.5,1,5,1),Vw.translate(0,-.5,0)),this.position.copy(t),this.line=new Ss($0,new Is({color:i,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new _t(Vw,new Hi({color:i,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,r,o)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{PR.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(PR,t)}}setLength(e,t=e*.2,n=t*.2){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class Lg extends zo{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],i=new Sn;i.setAttribute("position",new tn(t,3)),i.setAttribute("color",new tn(n,3));const r=new Is({vertexColors:!0,toneMapped:!1});super(i,r),this.type="AxesHelper"}setColors(e,t,n){const i=new _e,r=this.geometry.attributes.color.array;return i.set(e),i.toArray(r,0),i.toArray(r,3),i.set(t),i.toArray(r,6),i.toArray(r,9),i.set(n),i.toArray(r,12),i.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Wj{constructor(){this.type="ShapePath",this.color=new _e,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new qm,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,n,i){return this.currentPath.quadraticCurveTo(e,t,n,i),this}bezierCurveTo(e,t,n,i,r,o){return this.currentPath.bezierCurveTo(e,t,n,i,r,o),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(S){const R=[];for(let M=0,I=S.length;M<I;M++){const T=S[M],B=new xu;B.curves=T.curves,R.push(B)}return R}function n(S,R){const M=R.length;let I=!1;for(let T=M-1,B=0;B<M;T=B++){let F=R[T],D=R[B],U=D.x-F.x,W=D.y-F.y;if(Math.abs(W)>Number.EPSILON){if(W<0&&(F=R[B],U=-U,D=R[T],W=-W),S.y<F.y||S.y>D.y)continue;if(S.y===F.y){if(S.x===F.x)return!0}else{const J=W*(S.x-F.x)-U*(S.y-F.y);if(J===0)return!0;if(J<0)continue;I=!I}}else{if(S.y!==F.y)continue;if(D.x<=S.x&&S.x<=F.x||F.x<=S.x&&S.x<=D.x)return!0}}return I}const i=Ua.isClockWise,r=this.subPaths;if(r.length===0)return[];let o,l,h;const u=[];if(r.length===1)return l=r[0],h=new xu,h.curves=l.curves,u.push(h),u;let f=!i(r[0].getPoints());f=e?!f:f;const g=[],m=[];let A=[],v=0,w;m[v]=void 0,A[v]=[];for(let S=0,R=r.length;S<R;S++)l=r[S],w=l.getPoints(),o=i(w),o=e?!o:o,o?(!f&&m[v]&&v++,m[v]={s:new xu,p:w},m[v].s.curves=l.curves,f&&v++,A[v]=[]):A[v].push({h:l,p:w[0]});if(!m[0])return t(r);if(m.length>1){let S=!1,R=0;for(let M=0,I=m.length;M<I;M++)g[M]=[];for(let M=0,I=m.length;M<I;M++){const T=A[M];for(let B=0;B<T.length;B++){const F=T[B];let D=!0;for(let U=0;U<m.length;U++)n(F.p,m[U].p)&&(M!==U&&R++,D?(D=!1,g[U].push(F)):S=!0);D&&g[M].push(F)}}R>0&&S===!1&&(A=g)}let b;for(let S=0,R=m.length;S<R;S++){h=m[S].s,u.push(h),b=A[S];for(let M=0,I=b.length;M<I;M++)h.holes.push(b[M].h)}return u}}const Cc=Qj();function Qj(){const a=new ArrayBuffer(4),e=new Float32Array(a),t=new Uint32Array(a),n=new Uint32Array(512),i=new Uint32Array(512);for(let h=0;h<256;++h){const u=h-127;u<-27?(n[h]=0,n[h|256]=32768,i[h]=24,i[h|256]=24):u<-14?(n[h]=1024>>-u-14,n[h|256]=1024>>-u-14|32768,i[h]=-u-1,i[h|256]=-u-1):u<=15?(n[h]=u+15<<10,n[h|256]=u+15<<10|32768,i[h]=13,i[h|256]=13):u<128?(n[h]=31744,n[h|256]=64512,i[h]=24,i[h|256]=24):(n[h]=31744,n[h|256]=64512,i[h]=13,i[h|256]=13)}const r=new Uint32Array(2048),o=new Uint32Array(64),l=new Uint32Array(64);for(let h=1;h<1024;++h){let u=h<<13,f=0;for(;(u&8388608)===0;)u<<=1,f-=8388608;u&=-8388609,f+=947912704,r[h]=u|f}for(let h=1024;h<2048;++h)r[h]=939524096+(h-1024<<13);for(let h=1;h<31;++h)o[h]=h<<23;o[31]=1199570944,o[32]=2147483648;for(let h=33;h<63;++h)o[h]=2147483648+(h-32<<23);o[63]=3347054592;for(let h=1;h<64;++h)h!==32&&(l[h]=1024);return{floatView:e,uint32View:t,baseTable:n,shiftTable:i,mantissaTable:r,exponentTable:o,offsetTable:l}}function jj(a){Math.abs(a)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),a=As(a,-65504,65504),Cc.floatView[0]=a;const e=Cc.uint32View[0],t=e>>23&511;return Cc.baseTable[t]+((e&8388607)>>Cc.shiftTable[t])}function qj(a){const e=a>>10;return Cc.uint32View[0]=Cc.mantissaTable[Cc.offsetTable[e]+(a&1023)]+Cc.exponentTable[e],Cc.floatView[0]}var fu=Object.freeze({__proto__:null,toHalfFloat:jj,fromHalfFloat:qj});function Xj(){console.error("THREE.ImmediateRenderObject has been removed.")}class Yj extends Hr{constructor(e,t,n){console.error('THREE.WebGLMultisampleRenderTarget has been removed. Use a normal render target and set the "samples" property to greater 0 to enable multisampling.'),super(e,t,n),this.samples=4}}class Jj extends pg{constructor(e,t,n,i){console.warn("THREE.DataTexture2DArray has been renamed to DataArrayTexture."),super(e,t,n,i)}}class Zj extends mg{constructor(e,t,n,i){console.warn("THREE.DataTexture3D has been renamed to Data3DTexture."),super(e,t,n,i)}}class Kj extends Ui{constructor(e,t,n,i,r,o){console.warn("THREE.BoxBufferGeometry has been renamed to THREE.BoxGeometry."),super(e,t,n,i,r,o)}}class $j extends xg{constructor(e,t,n,i){console.warn("THREE.CapsuleBufferGeometry has been renamed to THREE.CapsuleGeometry."),super(e,t,n,i)}}class eq extends wg{constructor(e,t,n,i){console.warn("THREE.CircleBufferGeometry has been renamed to THREE.CircleGeometry."),super(e,t,n,i)}}class tq extends bg{constructor(e,t,n,i,r,o,l){console.warn("THREE.ConeBufferGeometry has been renamed to THREE.ConeGeometry."),super(e,t,n,i,r,o,l)}}class nq extends cs{constructor(e,t,n,i,r,o,l,h){console.warn("THREE.CylinderBufferGeometry has been renamed to THREE.CylinderGeometry."),super(e,t,n,i,r,o,l,h)}}class iq extends Eg{constructor(e,t){console.warn("THREE.DodecahedronBufferGeometry has been renamed to THREE.DodecahedronGeometry."),super(e,t)}}class sq extends Cg{constructor(e,t){console.warn("THREE.ExtrudeBufferGeometry has been renamed to THREE.ExtrudeGeometry."),super(e,t)}}class rq extends Rf{constructor(e,t){console.warn("THREE.IcosahedronBufferGeometry has been renamed to THREE.IcosahedronGeometry."),super(e,t)}}class oq extends If{constructor(e,t,n,i){console.warn("THREE.LatheBufferGeometry has been renamed to THREE.LatheGeometry."),super(e,t,n,i)}}class aq extends Oa{constructor(e,t){console.warn("THREE.OctahedronBufferGeometry has been renamed to THREE.OctahedronGeometry."),super(e,t)}}class _2 extends lo{constructor(e,t,n,i){console.warn("THREE.PlaneBufferGeometry has been renamed to THREE.PlaneGeometry."),super(e,t,n,i)}}class cq extends Hc{constructor(e,t,n,i){console.warn("THREE.PolyhedronBufferGeometry has been renamed to THREE.PolyhedronGeometry."),super(e,t,n,i)}}class lq extends Pf{constructor(e,t,n,i,r,o){console.warn("THREE.RingBufferGeometry has been renamed to THREE.RingGeometry."),super(e,t,n,i,r,o)}}class hq extends Sg{constructor(e,t){console.warn("THREE.ShapeBufferGeometry has been renamed to THREE.ShapeGeometry."),super(e,t)}}class uq extends ho{constructor(e,t,n,i,r,o,l){console.warn("THREE.SphereBufferGeometry has been renamed to THREE.SphereGeometry."),super(e,t,n,i,r,o,l)}}class dq extends Mg{constructor(e,t){console.warn("THREE.TetrahedronBufferGeometry has been renamed to THREE.TetrahedronGeometry."),super(e,t)}}class fq extends Ba{constructor(e,t,n,i,r){console.warn("THREE.TorusBufferGeometry has been renamed to THREE.TorusGeometry."),super(e,t,n,i,r)}}class pq extends Tg{constructor(e,t,n,i,r,o){console.warn("THREE.TorusKnotBufferGeometry has been renamed to THREE.TorusKnotGeometry."),super(e,t,n,i,r,o)}}class mq extends Ig{constructor(e,t,n,i,r){console.warn("THREE.TubeBufferGeometry has been renamed to THREE.TubeGeometry."),super(e,t,n,i,r)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Ey}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Ey);const gq=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:tC,AddEquation:ru,AddOperation:jB,AdditiveAnimationBlendMode:rC,AdditiveBlending:G_,AlphaFormat:eL,AlwaysDepth:UB,AlwaysStencilFunc:aC,AmbientLight:zC,AmbientLightProbe:dj,AnimationClip:Kl,AnimationLoader:ij,AnimationMixer:Wy,AnimationObjectGroup:Cj,AnimationUtils:$6,ArcCurve:GL,ArrayCamera:FL,ArrowHelper:Vj,Audio:Vy,AudioAnalyser:d2,AudioContext:GC,AudioListener:HC,AudioLoader:K_,AxesHelper:Lg,BackSide:Ur,BasicDepthPacking:lL,BasicShadowMap:XH,Bone:Ly,BooleanKeyframeTrack:Bu,Box2:Lj,Box3:Mr,Box3Helper:Gj,BoxBufferGeometry:Kj,BoxGeometry:Ui,BoxHelper:QC,BufferAttribute:Jn,BufferGeometry:Sn,BufferGeometryLoader:l2,ByteType:YB,Cache:Iu,Camera:Ty,CameraHelper:A2,CanvasTexture:bC,CapsuleBufferGeometry:$j,CapsuleGeometry:xg,CatmullRomCurve3:HL,CineonToneMapping:qB,CircleBufferGeometry:eq,CircleGeometry:wg,ClampToEdgeWrapping:$s,Clock:Hy,Color:_e,ColorKeyframeTrack:Rg,ColorManagement:So,CompressedTexture:Bl,CompressedTextureLoader:sj,ConeBufferGeometry:tq,ConeGeometry:bg,CubeCamera:IL,CubeReflectionMapping:jl,CubeRefractionMapping:ql,CubeTexture:gg,CubeTextureLoader:rj,CubeUVReflectionMapping:Mf,CubicBezierCurve:CC,CubicBezierCurve3:VL,CubicInterpolant:i2,CullFaceBack:Ob,CullFaceFront:CB,CullFaceFrontBack:qH,CullFaceNone:EB,Curve:pa,CurvePath:QL,CustomBlending:SB,CustomToneMapping:XB,CylinderBufferGeometry:nq,CylinderGeometry:cs,Cylindrical:Bj,Data3DTexture:mg,DataArrayTexture:pg,DataTexture:Na,DataTexture2DArray:Jj,DataTexture3D:Zj,DataTextureLoader:kC,DataUtils:fu,DecrementStencilOp:mL,DecrementWrapStencilOp:AL,DefaultLoadingManager:o2,DepthFormat:Gl,DepthStencilFormat:Su,DepthTexture:AC,DirectionalLight:zy,DirectionalLightHelper:g2,DiscreteInterpolant:s2,DodecahedronBufferGeometry:iq,DodecahedronGeometry:Eg,DoubleSide:er,DstAlphaFactor:LB,DstColorFactor:OB,DynamicCopyUsage:a5,DynamicDrawUsage:t5,DynamicReadUsage:s5,EdgesGeometry:RC,EllipseCurve:Oy,EqualDepth:GB,EqualStencilFunc:xL,EquirectangularReflectionMapping:ka,EquirectangularRefractionMapping:gf,Euler:vs,EventDispatcher:Uo,ExtrudeBufferGeometry:sq,ExtrudeGeometry:Cg,FileLoader:Fs,Float16BufferAttribute:G5,Float32BufferAttribute:tn,Float64BufferAttribute:H5,FloatType:Ms,Fog:By,FogExp2:Py,FramebufferTexture:b6,FrontSide:Oo,Frustum:Iy,GLBufferAttribute:Pj,GLSL1:l5,GLSL3:tE,GreaterDepth:VB,GreaterEqualDepth:HB,GreaterEqualStencilFunc:CL,GreaterStencilFunc:bL,GridHelper:m2,Group:sa,HalfFloatType:Os,HemisphereLight:NC,HemisphereLightHelper:Uj,HemisphereLightProbe:uj,IcosahedronBufferGeometry:rq,IcosahedronGeometry:Rf,ImageBitmapLoader:h2,ImageLoader:Zm,ImageUtils:lC,ImmediateRenderObject:Xj,IncrementStencilOp:pL,IncrementWrapStencilOp:gL,InstancedBufferAttribute:vf,InstancedBufferGeometry:c2,InstancedInterleavedBuffer:Rj,InstancedMesh:xC,Int16BufferAttribute:U5,Int32BufferAttribute:z5,Int8BufferAttribute:F5,IntType:ZB,InterleavedBuffer:_g,InterleavedBufferAttribute:Xl,Interpolant:Lf,InterpolateDiscrete:Mu,InterpolateLinear:kc,InterpolateSmooth:w_,InvertStencilOp:_L,KeepStencilOp:Em,KeyframeTrack:ma,LOD:yC,LatheBufferGeometry:oq,LatheGeometry:If,Layers:Va,LessDepth:zB,LessEqualDepth:H_,LessEqualStencilFunc:wL,LessStencilFunc:vL,Light:ih,LightProbe:xf,Line:Ss,Line3:Dj,LineBasicMaterial:Is,LineCurve:Fy,LineCurve3:WL,LineDashedMaterial:t2,LineLoop:wC,LineSegments:zo,LinearEncoding:pr,LinearFilter:yi,LinearInterpolant:OC,LinearMipMapLinearFilter:KH,LinearMipMapNearestFilter:ZH,LinearMipmapLinearFilter:fa,LinearMipmapNearestFilter:fg,LinearSRGBColorSpace:kl,LinearToneMapping:V_,Loader:mr,LoaderUtils:za,LoadingManager:FC,LoopOnce:Sy,LoopPingPong:aL,LoopRepeat:sC,LuminanceAlphaFormat:iL,LuminanceFormat:nL,MOUSE:Kh,Material:Ts,MaterialLoader:Gy,MathUtils:Tu,Matrix3:kr,Matrix4:xn,MaxEquation:Ub,Mesh:_t,MeshBasicMaterial:Hi,MeshDepthMaterial:mC,MeshDistanceMaterial:gC,MeshLambertMaterial:$L,MeshMatcapMaterial:e2,MeshNormalMaterial:KL,MeshPhongMaterial:JL,MeshPhysicalMaterial:Vc,MeshStandardMaterial:Bf,MeshToonMaterial:ZL,MinEquation:Nb,MirroredRepeatWrapping:Cu,MixOperation:QB,MultiplyBlending:kb,MultiplyOperation:dg,NearestFilter:Ki,NearestMipMapLinearFilter:JH,NearestMipMapNearestFilter:YH,NearestMipmapLinearFilter:_f,NearestMipmapNearestFilter:Af,NeverDepth:NB,NeverStencilFunc:yL,NoBlending:Lc,NoColorSpace:e5,NoToneMapping:ca,NormalAnimationBlendMode:My,NormalBlending:gu,NotEqualDepth:WB,NotEqualStencilFunc:EL,NumberKeyframeTrack:Jl,Object3D:qt,ObjectLoader:lj,ObjectSpaceNormalMap:uL,OctahedronBufferGeometry:aq,OctahedronGeometry:Oa,OneFactor:RB,OneMinusDstAlphaFactor:DB,OneMinusDstColorFactor:FB,OneMinusSrcAlphaFactor:$E,OneMinusSrcColorFactor:BB,OrthographicCamera:nh,PCFShadowMap:JE,PCFSoftShadowMap:ZE,PMREMGenerator:iE,Path:qm,PerspectiveCamera:ts,Plane:Po,PlaneBufferGeometry:_2,PlaneGeometry:lo,PlaneHelper:Hj,PointLight:Uy,PointLightHelper:kj,Points:Dy,PointsMaterial:vg,PolarGridHelper:zj,PolyhedronBufferGeometry:cq,PolyhedronGeometry:Hc,PositionalAudio:u2,PropertyBinding:ni,PropertyMixer:f2,QuadraticBezierCurve:SC,QuadraticBezierCurve3:MC,Quaternion:Ot,QuaternionKeyframeTrack:ja,QuaternionLinearInterpolant:r2,REVISION:Ey,RGBADepthPacking:hL,RGBAFormat:us,RGBAIntegerFormat:oL,RGBA_ASTC_10x10_Format:Kb,RGBA_ASTC_10x5_Format:Yb,RGBA_ASTC_10x6_Format:Jb,RGBA_ASTC_10x8_Format:Zb,RGBA_ASTC_12x10_Format:$b,RGBA_ASTC_12x12_Format:eE,RGBA_ASTC_4x4_Format:X_,RGBA_ASTC_5x4_Format:Hb,RGBA_ASTC_5x5_Format:Vb,RGBA_ASTC_6x5_Format:Wb,RGBA_ASTC_6x6_Format:Qb,RGBA_ASTC_8x5_Format:jb,RGBA_ASTC_8x6_Format:qb,RGBA_ASTC_8x8_Format:Xb,RGBA_BPTC_Format:Y_,RGBA_ETC2_EAC_Format:q_,RGBA_PVRTC_2BPPV1_Format:Gb,RGBA_PVRTC_4BPPV1_Format:Q_,RGBA_S3TC_DXT1_Format:v_,RGBA_S3TC_DXT3_Format:x_,RGBA_S3TC_DXT5_Format:bm,RGBFormat:tL,RGB_ETC1_Format:iC,RGB_ETC2_Format:j_,RGB_PVRTC_2BPPV1_Format:zb,RGB_PVRTC_4BPPV1_Format:W_,RGB_S3TC_DXT1_Format:wm,RGFormat:ef,RGIntegerFormat:rL,RawShaderMaterial:BC,Ray:Pu,Raycaster:Du,RectAreaLight:a2,RedFormat:lu,RedIntegerFormat:sL,ReinhardToneMapping:eC,RepeatWrapping:Fc,ReplaceStencilOp:fL,ReverseSubtractEquation:TB,RingBufferGeometry:lq,RingGeometry:Pf,SRGBColorSpace:Ra,Scene:vu,ShaderChunk:qn,ShaderLib:na,ShaderMaterial:nr,ShadowMaterial:PC,Shape:xu,ShapeBufferGeometry:hq,ShapeGeometry:Sg,ShapePath:Wj,ShapeUtils:Ua,ShortType:JB,Skeleton:yg,SkeletonHelper:Fj,SkinnedMesh:vC,Source:Nl,Sphere:Qa,SphereBufferGeometry:uq,SphereGeometry:ho,Spherical:hE,SphericalHarmonics3:rf,SplineCurve:TC,SpotLight:Ny,SpotLightHelper:Oj,Sprite:UL,SpriteMaterial:_C,SrcAlphaFactor:KE,SrcAlphaSaturateFactor:kB,SrcColorFactor:PB,StaticCopyUsage:o5,StaticDrawUsage:Wm,StaticReadUsage:i5,StereoCamera:fj,StreamCopyUsage:c5,StreamDrawUsage:n5,StreamReadUsage:r5,StringKeyframeTrack:Lu,SubtractEquation:MB,SubtractiveBlending:Fb,TOUCH:$h,TangentSpaceNormalMap:Gc,TetrahedronBufferGeometry:dq,TetrahedronGeometry:Mg,Texture:Vi,TextureLoader:Pg,TorusBufferGeometry:fq,TorusGeometry:Ba,TorusKnotBufferGeometry:pq,TorusKnotGeometry:Tg,Triangle:Bo,TriangleFanDrawMode:oC,TriangleStripDrawMode:cL,TrianglesDrawMode:$H,TubeBufferGeometry:mq,TubeGeometry:Ig,UVMapping:Cy,Uint16BufferAttribute:hC,Uint32BufferAttribute:uC,Uint8BufferAttribute:k5,Uint8ClampedBufferAttribute:N5,Uniform:Bg,UniformsGroup:Ij,UniformsLib:Gt,UniformsUtils:dC,UnsignedByteType:Er,UnsignedInt248Type:Au,UnsignedIntType:Fl,UnsignedShort4444Type:KB,UnsignedShort5551Type:$B,UnsignedShortType:nC,VSMShadowMap:$d,Vector2:Xe,Vector3:q,Vector4:On,VectorKeyframeTrack:Zl,VideoTexture:zL,WebGL1Renderer:kL,WebGL3DRenderTarget:S5,WebGLArrayRenderTarget:C5,WebGLCubeRenderTarget:fC,WebGLMultipleRenderTargets:M5,WebGLMultisampleRenderTarget:Yj,WebGLRenderTarget:Hr,WebGLRenderer:Ag,WebGLUtils:OL,WireframeGeometry:YL,WrapAroundEnding:Vm,ZeroCurvatureEnding:hu,ZeroFactor:IB,ZeroSlopeEnding:uu,ZeroStencilOp:dL,_SRGBAFormat:J_,sRGBEncoding:Gn},Symbol.toStringTag,{value:"Module"})),Dg="__isActiveInHierarchy",Xd="builtin_components";function lf(a,e){try{e?a(e):a()}catch(t){return console.error(t),!1}return!0}const BR=()=>a=>a;let jC=!1;const uE=[];setTimeout(()=>{jC&&console.log(uE)},100);function y2(){return new URLSearchParams(window.location.search)}function jt(a){jC&&!uE.includes(a)&&uE.push(a);const e=y2();if(e.has(a)){const t=e.get(a);return t||!0}return!1}jC=jt("help")===!0;function $_(a,e,t){a.has(e)?a.set(e,t.toString()):a.append(e,t.toString())}function Aq(a,e){window.history.replaceState(null,a,"?"+e.toString())}function _q(a,e){return Math.floor(Math.random()*(e-a+1))+a}const LR=["smol","tiny","giant","interesting","smart","bright","dull","extreme","beautiful","pretty","dark","epic","salty","silly","funny","lame","lazy","loud","lucky","mad","mean","mighty","mysterious","nasty","odd","old","powerful","quiet","rapid","scary","shiny","shy","silly","smooth","sour","spicy","stupid","sweet","tasty","terrible","ugly","unusual","vast","wet","wild","witty","wrong","zany","zealous","zippy","zombie","zorro"],DR=["cat","dog","mouse","pig","cow","horse","sheep","chicken","duck","goat","panda","tiger","lion","elephant","monkey","bird","fish","snake","frog","turtle","hamster","penguin","kangaroo","whale","dolphin","crocodile","snail","ant","bee","beetle","butterfly","dragon","eagle","fish","giraffe","lizard","panda","penguin","rabbit","snake","spider","tiger","zebra"];function yq(){const a=LR[Math.floor(Math.random()*LR.length)],e=DR[Math.floor(Math.random()*DR.length)];return a+"_"+e}function vq(a){return a=a.replace(/[^a-z0-9áéíóúñü \.,_-]/gim,""),a.trim()}function wf(a,e,t=!0,n=!1){var i;if(e==null)return null;if(e.userData&&e.userData.guid===a)return e;if(e.guid==a)return e;if(n&&(i=e.userData)!=null&&i.components){for(const r of e.userData.components)if(r.guid===a)return r}if(t){if(e.scenes)for(const r in e.scenes){const o=e.scenes[r],l=wf(a,o,t,n);if(l)return l}if(e.children)for(const r in e.children){const o=e.children[r],l=wf(a,o,t,n);if(l)return l}}}function qC(a,e){if(a!=null&&typeof a=="object"){let t;Array.isArray(a)?t=[]:(t=Object.create(a),Object.assign(t,a));for(const n of Object.keys(a)){const i=a[n];e&&!e(a,n,i)?t[n]=i:(i==null?void 0:i.clone)!==void 0&&typeof i.clone=="function"?t[n]=i.clone():t[n]=qC(i,e)}return t}return a}function xq(a){return new Promise((e,t)=>{setTimeout(e,a)})}function v2(a,e){if(e&&a&&!e.includes("/")){const t=a.lastIndexOf("/");if(t>=0)return a.substring(0,t+1)+e}return e}class wq{constructor(e,t){E(this,"writeCallbacks",[]);E(this,"_applied",!1);E(this,"_object");E(this,"_prop");E(this,"_wrapperProp");this._object=e,this._prop=t,this._wrapperProp="__$_NEEDLE_"+t,this.apply()}subscribeWrite(e){this.writeCallbacks.push(e)}apply(){if(this._applied||!this._object)return;const e=this._object,t=this._prop;if(e[t]===void 0)return;this._applied=!0,e[this._wrapperProp]!==void 0&&console.warn("Watcher is being applied to an object that already has a wrapper property. This is not (yet) supported");const n=e[t];e[this._wrapperProp]=n,Object.defineProperty(e,t,{get:()=>e[this._wrapperProp],set:o=>{e[this._wrapperProp]=o;for(const l of this.writeCallbacks)l(o)}})}revoke(){if(!this._applied||!this._object)return;this._applied=!1;const e=this._object,t=this._prop;Reflect.deleteProperty(e,t);const n=e[this._wrapperProp];e[t]=n,Reflect.deleteProperty(e,this._wrapperProp)}dispose(){this.revoke(),this.writeCallbacks.length=0,this._object=null}}const bq=jt("debugnewscripts"),as=[];function Km(a){if(!(a.new_scripts.length<=0)){if(bq&&console.log("Register new components",a.new_scripts.length,a.alias?"element: "+a.alias:""),a.new_scripts_pre_setup_callbacks.length>0){for(const e of a.new_scripts_pre_setup_callbacks)!e||e();a.new_scripts_pre_setup_callbacks.length=0}as.length=0,a.new_scripts.length>0&&as.push(...a.new_scripts),a.new_scripts.length=0;for(let e=0;e<as.length;e++)try{const t=as[e];if(t.destroyed)continue;if(!t.gameObject){console.error("MISSING GAMEOBJECT - will ignore",t),as.splice(e,1),e--;continue}t.context=a,Tm(t.gameObject),x2(t,a)}catch(t){console.error(t),Ll(as[e],a),as.splice(e,1),e--}for(let e=0;e<as.length;e++)try{const t=as[e];if(t.destroyed){Ll(as[e],a),as.splice(e,1),e--;continue}t.__internalAwake!==void 0&&(t.gameObject||console.error("MISSING GAMEOBJECT",t,t.gameObject),Tm(t.gameObject),t.activeAndEnabled&&lf(t.__internalAwake.bind(t)))}catch(t){console.error(t),Ll(as[e],a),as.splice(e,1),e--}for(let e=0;e<as.length;e++)try{const t=as[e];if(t.destroyed||t.enabled===!1||(Tm(t.gameObject),t.activeAndEnabled===!1))continue;t.__internalEnable!==void 0&&(t.enabled=!0,lf(t.__internalEnable.bind(t)))}catch(t){console.error(t),Ll(as[e],a),as.splice(e,1),e--}for(let e=0;e<as.length;e++)try{const t=as[e];if(t.destroyed||!t.gameObject)continue;a.new_script_start.push(t)}catch(t){console.error(t),Ll(as[e],a),as.splice(e,1),e--}as.length=0;for(const e of a.new_scripts_post_setup_callbacks)e&&e();a.new_scripts_post_setup_callbacks.length=0}}function Eq(a){!a||(a.__internalDisable(),Ll(a,a.context))}function Cq(a){for(let e=0;e<a.new_script_start.length;e++)try{const t=a.new_script_start[e];if(t.destroyed||t.activeAndEnabled===!1)continue;lf(t.__internalAwake.bind(t)),lf(t.__internalEnable.bind(t)),lf(t.__internalStart.bind(t)),a.new_script_start.splice(e,1),e--}catch(t){console.error(t),Ll(a.new_script_start[e],a),a.new_script_start.splice(e,1),e--}}function x2(a,e){e.scripts.indexOf(a)===-1&&(e.scripts.push(a),a.earlyUpdate&&e.scripts_earlyUpdate.push(a),a.update&&e.scripts_update.push(a),a.lateUpdate&&e.scripts_lateUpdate.push(a),a.onBeforeRender&&e.scripts_onBeforeRender.push(a),a.onAfterRender&&e.scripts_onAfterRender.push(a))}function Ll(a,e){yl(a,e.new_scripts),yl(a,e.new_script_start),yl(a,e.scripts),yl(a,e.scripts_earlyUpdate),yl(a,e.scripts_update),yl(a,e.scripts_lateUpdate),yl(a,e.scripts_onBeforeRender),yl(a,e.scripts_onAfterRender),e.stopAllCoroutinesFrom(a)}function yl(a,e){const t=e.indexOf(a);t>=0&&e.splice(t,1)}const Sq={},OR={};function Mq(){if(!_i.Current){console.trace("Invalid call - no current context.");return}w2(_i.Current.scene,_i.Current.scene.visible,!0)}function w2(a,e,t){const n=Te.isActiveSelf(a);Sq[a.uuid]=n,e&&(e=Te.isActiveSelf(a)),a[Dg]=e;{const i=OR[a.uuid];i!==void 0&&i!==e&&t&&Tq(a,r=>{e?(lf(r.__internalAwake.bind(r)),r.onEnable()):r.onDisable()})}if(OR[a.uuid]=e,a.children)for(const i of a.children)w2(i,e,t)}function Tm(a){let e=!0,t=a,n=!1;for(;t&&t;){if(t.type==="Scene"&&(n=!0),!Te.isActiveSelf(t)){e=!1;break}t=t.parent}if(!a){console.error("GO is null");return}a[Dg]=e&&n}function Tq(a,e){var t;if((t=a.userData)!=null&&t.components)for(const n of a.userData.components)e(n)}const Ww=jt("debuggetcomponent");function b2(a,e){var n;if(!a)return;const t=(n=e==null?void 0:e.new_scripts)!=null?n:_i.Current.new_scripts;t.includes(a)||t.push(a)}const Iq=function(a,e){if(!a||!a.userData.components)return;const t=a.userData.components.indexOf(e);t<0||(e.gameObject=null,a.userData.components.splice(t,1))},E2=function(a,e,t=!0){e.userData||(e.userData={}),e.userData.components||(e.userData.components=[]),e.userData.components.push(a),a.gameObject=e,b2(a);try{a.__internalAwake&&t&&(Tm(e),a.__internalAwake())}catch(n){console.error(n)}},Rq=function(a,e){if(a.gameObject!==e){if(a.gameObject&&a.gameObject.userData.components){const t=a.gameObject.userData.components.indexOf(a);a.gameObject.userData.components.splice(t,1)}if(!e.userData.components)e.userData.components=[];else if(e.userData.components.includes(a))return;e.userData.components.push(a),a.gameObject=e}},Pq=function(a){var e;if(a.gameObject&&a.gameObject.userData.components){const t=a.gameObject.userData.components.indexOf(a);a.gameObject.userData.components.splice(t,1)}a.__internalDisable&&a.__internalDisable(),a.onDestroy&&a.onDestroy(),Ll(a,(e=a.context)!=null?e:_i.Current),a.__destroyed=!0,a.gameObject=null},C2=function(a,e,t){var n;if(!((n=e==null?void 0:e.userData)!=null&&n.components))return null;Ww&&console.log("FIND",a);for(let i=0;i<e.userData.components.length;i++){const r=e.userData.components[i];if(a===null||r.constructor.name===a.name||r.constructor.name===a)if(Ww&&console.log("MATCH BY NAME",r),t)t.push(r);else return r}for(let i=0;i<e.userData.components.length;i++){const r=e.userData.components[i];let o=Object.getPrototypeOf(r.constructor);do{if(o===a)if(Ww&&console.log("MATCH BY PROTOYPE",o),t)t.push(r);else return r;o=Object.getPrototypeOf(o)}while(o)}return t},XC=function(a,e){return C2(a,e,null)},YC=function(a,e,t){return t||(t=[]),C2(a,e,t)},JC=function(a,e,t){var i;const n=XC(a,e);if(t===!1&&n.enabled===!1)return null;if(n)return n;for(let r=0;r<((i=e==null?void 0:e.children)==null?void 0:i.length);r++){const o=JC(a,e.children[r]);if(o)return o}return null},ZC=function(a,e,t){var n;t||(t=[]),YC(a,e,t);for(let i=0;i<((n=e==null?void 0:e.children)==null?void 0:n.length);i++)ZC(a,e.children[i],t);return t},S2=function(a,e){if(!e)return null;const t=XC(a,e);return t||S2(a,e.parent)},M2=function(a,e,t){return t||(t=[]),e?(YC(a,e,t),M2(a,e.parent,t)):t},Bq=function(a,e,t){if(!a)return null;if(!e&&(e=_i.Current,!e))return console.error("Can not search object without any needle context or scene!!!"),null;const n=e.isScene===!0||e.isObject3D===!0?e:e==null?void 0:e.scene;for(const i in n.children){const r=n.children[i];if(t===!1&&r[Dg]===!1)continue;if(r.constructor==a)return r;const o=JC(a,r);if(o)return o}return null},Lq=function(a,e,t){if(!a)return e;if(!t&&(t=_i.Current,!t))return console.error("Can not search object without any needle context or scene!!!"),e;const n=t.isScene===!0||t.isObject3D===!0?t:t==null?void 0:t.scene;if(!n)return e;for(const i in n.children){const r=n.children[i];if(r.constructor==a)return r;ZC(a,r,e)}return e};class Dq{random(){return Math.random()}clamp(e,t,n){return e<t?t:e>n?n:e}clamp01(e){return this.clamp(e,0,1)}lerp(e,t,n){return n=n<0?0:n,n=n>1?1:n,e+(t-e)*n}moveTowards(e,t,n){return e+=n,(n<0&&e<t||n>0&&e>t)&&(e=t),e}toDegrees(e){return e*180/Math.PI}toRadians(e){return e*Math.PI/180}}const Ei=new Dq;class Oq{constructor(e,t){E(this,"_factory");E(this,"_cache",[]);E(this,"_maxSize");E(this,"_index",0);this._factory=e,this._maxSize=t}get(){let e=this._index++;return e>=this._cache.length&&(e>=this._maxSize?e=this._index=0:this._cache.push(this._factory())),this._cache[e]}}new Ot().setFromAxisAngle(new q(0,1,0),Math.PI);const KC=new Oq(()=>new q,100);q.prototype.slerp=function(a,e){const t=this.length(),n=a.length(),i=Ei.lerp(t,n,e);return this.lerp(a,e).normalize().multiplyScalar(i)};function ti(a,e=null,t=!0){const n=e!=null?e:KC.get();return a?a.parent?(t&&a.updateWorldMatrix(!0,!1),a.matrixWorldNeedsUpdate&&a.updateMatrixWorld(),n.setFromMatrixPosition(a.matrixWorld),n):n.copy(a.position):n.set(0,0,0)}function ys(a,e){var i;if(!a)return;const t=KC.get();e!==t&&t.copy(e),((i=a==null?void 0:a.parent)!=null?i:a).worldToLocal(t),a.position.set(t.x,t.y,t.z)}function $C(a,e,t,n){const i=KC.get();i.set(e,t,n),ys(a,i)}const wu=new Ot,$m=new Ot,Qw=new Ot;function uo(a,e=null){if(!a)return $m.set(0,0,0,1);const t=e!=null?e:$m;return a.parent?(a.getWorldQuaternion(t),t):t.copy(a.quaternion)}function Nr(a,e){if(!a)return;e!==wu&&wu.copy(e);const t=wu,n=a==null?void 0:a.parent;n==null||n.getWorldQuaternion(Qw),Qw.invert();const i=Qw.multiply(t);a.quaternion.set(i.x,i.y,i.z,i.w)}function Fq(a,e,t,n,i){wu.set(e,t,n,i),Nr(a,wu)}const e_=new q;new q;function kq(a,e=null){return a?a.parent?(a.getWorldScale(e!=null?e:e_),e!=null?e:e_):e_.copy(a.position):e_.set(0,0,0)}new q;new Ot;const FR=new vs,kR=new vs,Nq=new q;function Uq(a){return a.getWorldQuaternion($m),kR.setFromQuaternion($m),kR}function zq(a,e){Nr(a,$m.setFromEuler(e))}function T2(a){const e=Uq(a),t=Nq;return t.set(e.x,e.y,e.z),t.x=Ei.toDegrees(t.x),t.y=Ei.toDegrees(t.y),t.z=Ei.toDegrees(t.z),t}function I2(a,e,t,n,i=!0){i&&(e=Ei.toRadians(e),t=Ei.toRadians(t),n=Ei.toRadians(n)),FR.set(e,t,n),wu.setFromEuler(FR),Nr(a,wu)}function dE(a,e=!0){!a||(e?function t(n){console.groupCollapsed((n.name?n.name:"(no name : "+n.type+")")+" %o",n),n.children.forEach(t),console.groupEnd()}(a):a.traverse(function(t){for(var n="|___",i=t;i.parent!==null;)n="	"+n,i=i.parent;console.log(n+t.name+" <"+t.type+">")}))}new lo(2,2,1,1);new Ag({antialias:!1});new ts;new vu;new nr({uniforms:{blitTexture:new Bg(null)},vertexShader:`
        varying vec2 vUv;
        void main(){
            vUv = uv;
            gl_Position = vec4(position.xy * 1.0,0.,.999999);
        }`,fragmentShader:`
        uniform sampler2D blitTexture; 
        varying vec2 vUv;
        void main(){ 
            vec2 uv = vUv;
            uv.y = 1.0 - uv.y;
            gl_FragColor = vec4(uv.xy, 0, 1);
            gl_FragColor = texture2D( blitTexture, uv);
        }`});const Gq=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Hq(a){return typeof a=="string"&&Gq.test(a)}const Ys=[];for(let a=0;a<256;++a)Ys.push((a+256).toString(16).slice(1));function Vq(a,e=0){return(Ys[a[e+0]]+Ys[a[e+1]]+Ys[a[e+2]]+Ys[a[e+3]]+"-"+Ys[a[e+4]]+Ys[a[e+5]]+"-"+Ys[a[e+6]]+Ys[a[e+7]]+"-"+Ys[a[e+8]]+Ys[a[e+9]]+"-"+Ys[a[e+10]]+Ys[a[e+11]]+Ys[a[e+12]]+Ys[a[e+13]]+Ys[a[e+14]]+Ys[a[e+15]]).toLowerCase()}function Wq(a){if(!Hq(a))throw TypeError("Invalid UUID");let e;const t=new Uint8Array(16);return t[0]=(e=parseInt(a.slice(0,8),16))>>>24,t[1]=e>>>16&255,t[2]=e>>>8&255,t[3]=e&255,t[4]=(e=parseInt(a.slice(9,13),16))>>>8,t[5]=e&255,t[6]=(e=parseInt(a.slice(14,18),16))>>>8,t[7]=e&255,t[8]=(e=parseInt(a.slice(19,23),16))>>>8,t[9]=e&255,t[10]=(e=parseInt(a.slice(24,36),16))/1099511627776&255,t[11]=e/4294967296&255,t[12]=e>>>24&255,t[13]=e>>>16&255,t[14]=e>>>8&255,t[15]=e&255,t}function Qq(a){a=unescape(encodeURIComponent(a));const e=[];for(let t=0;t<a.length;++t)e.push(a.charCodeAt(t));return e}const jq="6ba7b810-9dad-11d1-80b4-00c04fd430c8",qq="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function Xq(a,e,t){function n(i,r,o,l){var h;if(typeof i=="string"&&(i=Qq(i)),typeof r=="string"&&(r=Wq(r)),((h=r)===null||h===void 0?void 0:h.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let u=new Uint8Array(16+i.length);if(u.set(r),u.set(i,r.length),u=t(u),u[6]=u[6]&15|e,u[8]=u[8]&63|128,o){l=l||0;for(let f=0;f<16;++f)o[l+f]=u[f];return o}return Vq(u)}try{n.name=a}catch{}return n.DNS=jq,n.URL=qq,n}function Yq(a,e,t,n){switch(a){case 0:return e&t^~e&n;case 1:return e^t^n;case 2:return e&t^e&n^t&n;case 3:return e^t^n}}function jw(a,e){return a<<e|a>>>32-e}function Jq(a){const e=[1518500249,1859775393,2400959708,3395469782],t=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof a=="string"){const o=unescape(encodeURIComponent(a));a=[];for(let l=0;l<o.length;++l)a.push(o.charCodeAt(l))}else Array.isArray(a)||(a=Array.prototype.slice.call(a));a.push(128);const n=a.length/4+2,i=Math.ceil(n/16),r=new Array(i);for(let o=0;o<i;++o){const l=new Uint32Array(16);for(let h=0;h<16;++h)l[h]=a[o*64+h*4]<<24|a[o*64+h*4+1]<<16|a[o*64+h*4+2]<<8|a[o*64+h*4+3];r[o]=l}r[i-1][14]=(a.length-1)*8/Math.pow(2,32),r[i-1][14]=Math.floor(r[i-1][14]),r[i-1][15]=(a.length-1)*8&4294967295;for(let o=0;o<i;++o){const l=new Uint32Array(80);for(let A=0;A<16;++A)l[A]=r[o][A];for(let A=16;A<80;++A)l[A]=jw(l[A-3]^l[A-8]^l[A-14]^l[A-16],1);let h=t[0],u=t[1],f=t[2],g=t[3],m=t[4];for(let A=0;A<80;++A){const v=Math.floor(A/20),w=jw(h,5)+Yq(v,u,f,g)+m+e[v]+l[A]>>>0;m=g,g=f,f=jw(u,30)>>>0,u=h,h=w}t[0]=t[0]+h>>>0,t[1]=t[1]+u>>>0,t[2]=t[2]+f>>>0,t[3]=t[3]+g>>>0,t[4]=t[4]+m>>>0}return[t[0]>>24&255,t[0]>>16&255,t[0]>>8&255,t[0]&255,t[1]>>24&255,t[1]>>16&255,t[1]>>8&255,t[1]&255,t[2]>>24&255,t[2]>>16&255,t[2]>>8&255,t[2]&255,t[3]>>24&255,t[3]>>16&255,t[3]>>8&255,t[3]&255,t[4]>>24&255,t[4]>>16&255,t[4]>>8&255,t[4]&255]}const Zq=Xq("v5",80,Jq),Kq=Zq,ey=jt("debugcomponents"),$q="eff8ba80-635d-11ec-90d6-0242ac120003";class la{constructor(e){E(this,"_originalSeed");E(this,"_seed");this._originalSeed=e,this._seed=e}get seed(){return this._seed}generateUUID(){const e=this._seed;return this._seed-=1,Kq(e.toString(),$q)}static createFromString(e){return new la(this.hash(e))}static hash(e){let t=0;for(let n=0;n<e.length;n++)t=e.charCodeAt(n)+((t<<5)-t);return t}}class R2{constructor(e){E(this,"guid");this.guid=e}}function eS(a,e,t=!0){if(!a)return;const n=a;if(Te.destroy(a,t),!e){console.warn("Can not send destroy: No networking connection provided",a.guid);return}if(!e.isConnected){console.warn("Can not send destroy: not connected",a.guid);return}let i=a.guid;if(!i&&n.uuid&&(i=n.uuid),!i){console.warn("Can not send destroy: failed to find guid",a);return}const r=new R2(i);e.send("instance-destroyed",r)}function e9(a,e){const t=new R2(a);e.send("instance-destroyed",t)}function t9(a){a.connection.beginListen("instance-destroyed",e=>{ey&&console.log("[Remote] Destroyed",a.scene,e);const t=Te.findByGuid(e.guid,a.scene);t&&Te.destroy(t)})}class n9{constructor(e,t){E(this,"guid");E(this,"originalGuid");E(this,"seed");E(this,"visible");E(this,"hostData");E(this,"dontSave");E(this,"parent");E(this,"position");E(this,"rotation");E(this,"scale");this.originalGuid=e,this.guid=t}}function P2(a,e,t,n){var h;const i=a;if(!i.guid)return console.warn("Can not instantiate: No guid",i),null;if(e.context||(e.context=_i.Current),!e.context)return console.error("Missing network instantiate options / reference to network connection in sync instantiate"),null;const r=e?{...e}:null,{instance:o,seed:l}=s9(i,e);if(o){const u=o;if(u.guid){ey&&console.log("[Local] new instance","gameobject:",o==null?void 0:o.guid);const f=new n9(i.guid,u.guid);f.seed=l,r&&(r.position&&(f.position={x:r.position.x,y:r.position.y,z:r.position.z}),r.rotation&&(f.rotation={x:r.rotation.x,y:r.rotation.y,z:r.rotation.z,w:r.rotation.w}),r.scale&&(f.scale={x:r.scale.x,y:r.scale.y,z:r.scale.z})),f.position||(f.position={x:u.position.x,y:u.position.y,z:u.position.z}),f.rotation||(f.rotation={x:u.quaternion.x,y:u.quaternion.y,z:u.quaternion.z,w:u.quaternion.w}),f.scale||(f.scale={x:u.scale.x,y:u.scale.y,z:u.scale.z}),f.visible=i.visible,r!=null&&r.parent&&(typeof r.parent=="string"?f.parent=r.parent:f.parent=r.parent.guid),f.hostData=t,n===!1&&(f.dontSave=!0),(h=e==null?void 0:e.context)==null||h.connection.send("new-instance-created",f)}else console.warn("Missing guid, can not send new instance event",u)}return o}function tS(){return Math.random()*9999999}function i9(a){a.connection.beginListen("new-instance-created",async e=>{const t=await o9(e.originalGuid,a.scene);if(!t){console.warn("could not find object that was instantiated: "+e.guid);return}const n=new Fo;e.position&&(n.position=new q(e.position.x,e.position.y,e.position.z)),e.rotation&&(n.rotation=new Ot(e.rotation.x,e.rotation.y,e.rotation.z,e.rotation.w)),e.scale&&(n.scale=new q(e.scale.x,e.scale.y,e.scale.z)),n.parent=e.parent,e.seed&&(n.idProvider=new la(e.seed)),n.visible=e.visible,n.context=a,ey&&a.alias&&console.log("[Remote] instantiate in: "+a.alias);const i=Te.instantiate(t,n);i&&(e.parent==="scene"&&a.scene.add(i),ey&&console.log("[Remote] new instance","gameobject:",i==null?void 0:i.guid,t))})}function s9(a,e){const t=tS(),n=e!=null?e:new Fo;n.idProvider=new la(t);const i=Te.instantiate(a,n);return{seed:t,instance:i}}const B2={};function r9(a,e){B2[a]=e}async function o9(a,e){const t=B2[a];if(t!=null){const n=await t(a);if(n)return n}return L2(a,e)}function L2(a,e){if(e===null||!a)return null;if(e.guid===a)return e;if(e.children)for(const t of e.children){const n=L2(a,t);if(n)return n}return null}const vl=jt("debugcomponents");var D2=(a=>(a[a.None=0]="None",a[a.HideInHierarchy=1]="HideInHierarchy",a[a.HideInInspector=2]="HideInInspector",a[a.DontSaveInEditor=4]="DontSaveInEditor",a[a.NotEditable=8]="NotEditable",a[a.DontSaveInBuild=16]="DontSaveInBuild",a[a.DontUnloadUnusedAsset=32]="DontUnloadUnusedAsset",a[a.DontSave=52]="DontSave",a[a.HideAndDontSave=61]="HideAndDontSave",a))(D2||{});class Fo{constructor(){E(this,"idProvider");E(this,"parent");E(this,"keepWorldPosition");E(this,"position");E(this,"rotation");E(this,"scale");E(this,"visible");E(this,"context")}}qt.prototype.SetActive=function(a){this.visible=a};class Te extends qt{constructor(){super(...arguments);E(this,"guid")}static setActive(t,n){!t||(t.visible=n)}static isActiveSelf(t){return t.visible||Te.isUsingInstancing(t)}static isActiveInHierarchy(t){return t[Dg]||Te.isUsingInstancing(t)}static markAsInstancedRendered(t,n){t.__isUsingInstancing=n}static isUsingInstancing(t){return t.__isUsingInstancing===!0}static foreachComponent(t,n,i=!0){if(!!t){if(t.userData.components)for(let r=0;r<t.userData.components.length;r++){const o=t.userData.components[r];if(o instanceof Bt){const l=n(o);if(l!==void 0)return l}}if(i&&t.children)for(let r=0;r<t.children.length;r++){const o=t.children[r];if(!o)continue;const l=Te.foreachComponent(o,n,i);if(l!==void 0)return l}}}static instantiateSynced(t,n){return t?P2(t,n):null}static instantiate(t,n=null){if(t===null)return null;let i=null;n!==null&&(n.x!==void 0?(i=new Fo,i.position=n):i=n);let r=_i.Current;i!=null&&i.context&&(r=i.context),vl&&r.alias&&console.log("context",r.alias),i&&!i.idProvider&&(i.idProvider=new la(Date.now()));const o=[],l={},h={},u=this.internalInstantiate(r,t,i,o,l,h);u&&(this.resolveReferences(l),this.resolveAndBindSkinnedMeshBones(h,l)),vl&&(dE(t,!0),dE(u,!0));const f={};for(const g in o){const m=o[g],A=m.guid;i&&i.idProvider&&(m.guid=i.idProvider.generateUUID(),f[A]=m.guid,vl&&console.log(m.name,m.guid)),b2(m,r),m.__internalNewInstanceCreated&&m.__internalNewInstanceCreated()}for(const g in o){const m=o[g];m.resolveGuids&&m.resolveGuids(f),m.enabled!==!1&&(m.enabled=!0)}return Km(r),u}static internalInstantiate(t,n,i,r,o,l){var m;if(!n)return null;const h=n.userData;n.userData={};const u=n.children;n.children=[];let f;if(f=n.clone(!1),n.userData=h,n.children=u,o[n.uuid]={original:n,clone:f},n.type==="SkinnedMesh"&&(l[n.uuid]={original:n,clone:f}),(i==null?void 0:i.visible)!==void 0&&(f.visible=i.visible),i!=null&&i.idProvider){f.uuid=i.idProvider.generateUUID();const A=f;A&&(A.guid=f.uuid)}n.animations&&n.animations.length>0&&(f.animations=[...n.animations]);const g=n.parent;if(g&&g.add(f),i!=null&&i.position?ys(f,i.position):f.position.copy(n.position),i!=null&&i.rotation?Nr(f,i.rotation):f.quaternion.copy(n.quaternion),i!=null&&i.scale?f.scale.copy(i.scale):f.scale.copy(n.scale),(i==null?void 0:i.parent)&&i.parent!=="scene"){let A=null;if(typeof i.parent=="string"?A=wf(i.parent,t.scene,!0):A=i.parent,A){const v=i.keepWorldPosition===!0?A.attach:A.add;v?v.call(A,f):console.error("Invalid parent object",A,"received when instantiating:",n)}else console.warn("could not find parent:",i.parent)}for(const[A,v]of Object.entries(n.userData))A!=="components"&&(f.userData[A]=v);if((m=n.userData)!=null&&m.components){const A=n.userData.components,v=[];f.userData.components=v;for(let w=0;w<A.length;w++){const b=A[w],S=Object.create(b);Object.assign(S,b),v.push(S),S.gameObject=f,r.push(S)}}i&&(i.position=void 0,i.rotation=void 0,i.scale=void 0,i.parent=void 0);for(const A in n.children){const v=n.children[A],w=Te.internalInstantiate(t,v,i,r,o,l);w&&f.add(w)}return f}static resolveAndBindSkinnedMeshBones(t,n){for(const i in t){const r=t[i],o=r.original,l=o.skeleton,h=r.clone;if(!l){console.warn("Skinned mesh has no skeleton?",r);continue}const u=l.bones,f=h.skeleton.clone();h.skeleton=f,h.bindMatrix.clone().copy(o.bindMatrix),h.bindMatrixInverse.copy(o.bindMatrixInverse);const g=[];f.bones=g;for(let m=0;m<u.length;m++){const A=u[m],w=n[A.uuid].clone;g.push(w)}}for(const i in t){const r=t[i].clone;r.skeleton.update(),r.bind(r.skeleton,r.bindMatrix),r.updateMatrixWorld(!0)}}static resolveReferences(t){var n;for(const i in t){const o=t[i].clone;if((n=o.userData)!=null&&n.components)for(let l=0;l<o.userData.components.length;l++){const h=o.userData.components[l],u=Object.entries(h);for(const[f,g]of u)if(Array.isArray(g)){const m=[];h[f]=m;for(let A=0;A<g.length;A++){const v=g[A];if(typeof v!="object"){m.push(v);continue}const w=this.postProcessNewInstance(h,f,v,t);w!==void 0?m.push(w):m.push(v)}}else if(typeof g=="object"){const m=this.postProcessNewInstance(h,f,g,t);m!==void 0&&(h[f]=m)}}}}static postProcessNewInstance(t,n,i,r){var o,l;if(i instanceof Ro||i instanceof Bt){const h=i.gameObject;if(h){const u=h.uuid,f=(o=r[u])==null?void 0:o.clone;if(!f){vl&&console.log("reference did not change",n,t,i);return}const g=h.userData.components.indexOf(i);if(g>=0)return vl&&console.log(n,u),f.userData.components[g];console.warn("could not find component",n,i)}}else if(i instanceof qt){if(n==="gameObject")return;const h=i;if(h){const u=h.uuid,f=(l=r[u])==null?void 0:l.clone;if(f)return vl&&console.log(n,"old",i,"new",f),f}}}static destroySynced(t,n,i=!0){if(!t)return;const r=t;n=n!=null?n:_i.Current,eS(r,n.connection,i)}static destroy(t,n=!0,i=!0){const r=t;if(r.isComponent){r.destroy();return}const o=t;if(vl&&console.log(o),n&&o.children)for(const h of o.children)Te.destroy(h,n,!1);const l=o.userData.components;if(l){let h=l.length;for(let u=0;u<l.length;u++){const f=l[u];f.destroy&&(vl&&console.log("destroying",f),f.destroy()),l.length<h&&(h=l.length,u--)}}i&&o.removeFromParent()}static add(t,n,i){if(!(!t||!n)){if(t===n){console.warn("Can not add object to self",t);return}i||(i=_i.Current),n.add(t),Tm(t),i?Te.foreachComponent(t,r=>{x2(r,i),i.new_script_start.includes(r)===!1&&i.new_script_start.push(r)},!0):console.warn("Missing context")}}static remove(t){var n;!t||((n=t.parent)==null||n.remove(t),Te.foreachComponent(t,i=>{Eq(i)},!0))}static invokeOnChildren(t,n,...i){this.invoke(t,n,!0,i)}static invoke(t,n,i=!1,...r){!t||this.foreachComponent(t,o=>{const l=o[n];l&&typeof l=="function"&&l.bind(o)(...r)},i)}static addNewComponent(t,n,i=!0){const r=new n;return E2(r,t,i),r}static addComponent(t,n){if(n.gameObject==null)throw new Error("Did you mean to create a new component? Use addNewComponent");Rq(n,t)}static removeComponent(t){return Iq(t.gameObject,t),t}static getOrAddComponent(t,n){const i=this.getComponent(t,n);return i||this.addNewComponent(t,n)}static getComponent(t,n){return t===null?null:XC(n,t)}static getComponents(t,n,i=null){return t===null?i!=null?i:[]:YC(n,t,i)}static findByGuid(t,n){return wf(t,n,!0,!0)}static findObjectOfType(t,n,i=!0){return Bq(t,n,i)}static findObjectsOfType(t,n){const i=[];return Lq(t,i,n),i}static getComponentInChildren(t,n){return JC(n,t)}static getComponentsInChildren(t,n,i=null){return ZC(n,t,i)}static getComponentInParent(t,n){return S2(n,t)}static getComponentsInParent(t,n,i=null){return M2(n,t,i)}static getAllComponents(t){var r;return[...(r=t.userData)==null?void 0:r.components]}static*iterateComponents(t){var i;const n=(i=t==null?void 0:t.userData)==null?void 0:i.components;if(n&&Array.isArray(n))for(let r=0;r<n.length;r++)yield n[r]}}Object.defineProperty(qt.prototype,"activeSelf",{get:function(){return this.visible},set:function(a){const e=typeof a=="number"?a>.5:a;this.visible=e}});qt.prototype.addNewComponent=function(a){return Te.addNewComponent(this,a)};qt.prototype.removeComponent=function(a){return Te.removeComponent(a)};qt.prototype.getOrAddComponent=function(a){return Te.getOrAddComponent(this,a)};qt.prototype.getComponent=function(a){return Te.getComponent(this,a)};qt.prototype.getComponents=function(a,e){return Te.getComponents(this,a,e)};qt.prototype.getComponentInChildren=function(a){return Te.getComponentInChildren(this,a)};qt.prototype.getComponentsInChildren=function(a,e){return Te.getComponentsInChildren(this,a,e)};qt.prototype.getComponentInParent=function(a){return Te.getComponentInParent(this,a)};qt.prototype.getComponentsInParent=function(a,e){return Te.getComponentsInParent(this,a,e)};const ta=class{constructor(){E(this,"__context");E(this,"__name");E(this,"gameObject");E(this,"guid","invalid");E(this,"sourceId");E(this,"__didAwake",!1);E(this,"__didStart",!1);E(this,"__didEnable",!1);E(this,"__isEnabled");E(this,"__destroyed",!1);E(this,"_worldPosition");E(this,"_worldQuaternion");E(this,"_worldEuler");E(this,"_worldRotation");E(this,"_eventListeners",new Map);this.__internalNewInstanceCreated()}get isComponent(){return!0}get context(){var e;return(e=this.__context)!=null?e:_i.Current}set context(e){this.__context=e}get scene(){return this.context.scene}get layer(){var e,t;return(t=(e=this.gameObject)==null?void 0:e.userData)==null?void 0:t.layer}get name(){var e;return(e=this.gameObject)==null?void 0:e.userData.name}set name(e){this.gameObject?(this.gameObject.userData||(this.gameObject.userData={}),this.gameObject.userData.name=e,this.__name=e):this.__name=e}get tag(){var e;return(e=this.gameObject)==null?void 0:e.userData.tag}set tag(e){this.gameObject&&(this.gameObject.userData.tag=e)}get static(){var e;return(e=this.gameObject)==null?void 0:e.userData.static}get hideFlags(){var e;return(e=this.gameObject)==null?void 0:e.userData.hideFlags}get activeAndEnabled(){return!(this.destroyed||this.__isEnabled===!1||!this.__isActiveInHierarchy)}get __isActive(){return this.gameObject.visible}get __isActiveInHierarchy(){if(!this.gameObject)return!1;const e=this.gameObject[Dg];return e===void 0?!0:e}awake(){}onEnable(){}onDisable(){}onDestroy(){this.__destroyed=!0}startCoroutine(e,t=No.Update){return this.context.registerCoroutineUpdate(this,e,t)}stopCoroutine(e,t=No.Update){this.context.unregisterCoroutineUpdate(e,t)}get destroyed(){return this.__destroyed}destroy(){this.destroyed||Pq(this)}__internalNewInstanceCreated(){this.__didAwake=!1,this.__didStart=!1,this.__didEnable=!1,this.__isEnabled=void 0,this.__destroyed=!1}__internalAwake(){this.__didAwake||(this.__didAwake=!0,this.awake())}__internalStart(){this.__didStart||(this.__didStart=!0,this.start&&this.start())}__internalEnable(){this.__didEnable||(this.__didEnable=!0,this.onEnable())}__internalDisable(){!this.__didEnable||(this.__didEnable=!1,this.onDisable())}get worldPosition(){return this._worldPosition||(this._worldPosition=new q),ti(this.gameObject,this._worldPosition),this._worldPosition}set worldPosition(e){ys(this.gameObject,e)}setWorldPosition(e,t,n){ta._worldPositionBuffer.set(e,t,n),this.worldPosition=ta._worldPositionBuffer}get worldQuaternion(){return this._worldQuaternion||(this._worldQuaternion=new Ot),uo(this.gameObject,this._worldQuaternion)}set worldQuaternion(e){Nr(this.gameObject,e)}setWorldQuaternion(e,t,n,i){ta._worldQuaternionBuffer.set(e,t,n,i),this.worldQuaternion=ta._worldQuaternionBuffer}get worldEuler(){return this._worldEuler||(this._worldEuler=new vs),this._worldEuler.setFromQuaternion(this.worldQuaternion),this._worldEuler}set worldEuler(e){var t;this._worldQuaternion||(this._worldQuaternion=new Ot),(t=this._worldQuaternion)==null||t.setFromEuler(e),this.worldQuaternion=this._worldQuaternion}get worldRotation(){const e=this.worldEuler;this._worldRotation||(this._worldRotation=new q);const t=this._worldRotation;return t.set(e.x,e.y,e.z),t.x=Ei.toDegrees(t.x),t.y=Ei.toDegrees(t.y),t.z=Ei.toDegrees(t.z),t}set worldRotation(e){this.setWorldRotation(e.x,e.y,e.z,!0)}setWorldRotation(e,t,n,i=!0){i&&(e=Ei.toRadians(e),t=Ei.toRadians(t),n=Ei.toRadians(n)),ta._worldEulerBuffer.set(e,t,n),ta._worldQuaternionBuffer.setFromEuler(ta._worldEulerBuffer),this.worldQuaternion=ta._worldQuaternionBuffer}get forward(){return ta._forward.set(0,0,1).applyQuaternion(this.worldQuaternion)}addEventListener(e,t){this._eventListeners[e]=this._eventListeners[e]||[],this._eventListeners[e].push(t)}removeEventListener(e,t){if(!this._eventListeners[e])return;const n=this._eventListeners[e].indexOf(t);n>=0&&this._eventListeners[e].splice(n,1)}dispatchEvent(e){if(!this._eventListeners[e.type])return!1;const t=this._eventListeners[e.type];for(let n=0;n<t.length;n++)t[n](e);return!1}};let Ro=ta;E(Ro,"_worldPositionBuffer",new q),E(Ro,"_worldQuaternionBuffer",new Ot),E(Ro,"_worldEulerBuffer",new vs),E(Ro,"_tempQuaternionBuffer2",new Ot),E(Ro,"_forward",new q(0,0,1));class Bt extends Ro{get enabled(){var e;return(e=this.__isEnabled)!=null?e:!0}set enabled(e){typeof e=="number"&&(e>=.5?e=!0:e=!1),e!==this.__isEnabled&&(this.__isEnabled=e,this.__didAwake&&(e?this.__internalEnable():this.__internalDisable()))}}const a9=Object.freeze(Object.defineProperty({__proto__:null,HideFlags:D2,InstantiateOptions:Fo,Behaviour:Bt,Component:Ro,GameObject:Te},Symbol.toStringTag,{value:"Module"}));var O2=(a=>(a.PointerDown="pointerDown",a))(O2||{});class c9 extends EventTarget{constructor(t){super();E(this,"_doubleClickTimeThreshold",.2);E(this,"_longPressTimeThreshold",1);E(this,"_specialCursorTrigger",0);E(this,"context");E(this,"_pointerDown",[!1]);E(this,"_pointerUp",[!1]);E(this,"_pointerClick",[!1]);E(this,"_pointerDoubleClick",[!1]);E(this,"_pointerPressed",[!1]);E(this,"_pointerPositions",[new Xe]);E(this,"_pointerPositionsLastFrame",[new Xe]);E(this,"_pointerPositionsDelta",[new Xe]);E(this,"_pointerPositionsRC",[new Xe]);E(this,"_pointerPositionDown",[new Xe]);E(this,"_pointerDownTime",[]);E(this,"_pointerUpTime",[]);E(this,"_pointerIds",[]);E(this,"_pointerTypes",[""]);E(this,"_mouseWheelChanged",[!1]);E(this,"_pointerEvent",[]);E(this,"keysPressed",{});this.context=t,this.context.post_render_callbacks.push(this.onEndOfFrame.bind(this));const n=this.context.renderer.domElement;n.addEventListener("touchmove",this.onTouchMove.bind(this),{passive:!0}),n.addEventListener("touchend",this.onTouchUp.bind(this),!1),n.addEventListener("pointerdown",this.onPointerDown.bind(this),!1),n.addEventListener("pointermove",this.onPointerMove.bind(this),!1),n.addEventListener("pointerup",this.onPointerUp.bind(this),!1),n.addEventListener("wheel",this.onMouseWheel.bind(this),{passive:!0}),window.addEventListener("keydown",this.onKeyDown.bind(this),!1),window.addEventListener("keypress",this.onKeyPressed.bind(this),!1),window.addEventListener("keyup",this.onKeyUp.bind(this),!1),window.addEventListener("blur",this.onLostFocus.bind(this))}get mousePosition(){return this._pointerPositions[0]}get mousePositionRC(){return this._pointerPositionsRC[0]}get mouseDown(){return this._pointerDown[0]}get mouseUp(){return this._pointerUp[0]}get mouseClick(){return this._pointerClick[0]}get mouseDoubleClick(){return this._pointerDoubleClick[0]}get mousePressed(){return this._pointerPressed[0]}get mouseWheelChanged(){return this.getMouseWheelChanged(0)}setCursorPointer(){this._specialCursorTrigger+=1,this.context.domElement.style.cursor="pointer"}setCursorNormal(){this._specialCursorTrigger-=1,this._specialCursorTrigger=Math.max(0,this._specialCursorTrigger),this._specialCursorTrigger===0&&(this.context.domElement.style.cursor="default")}getPointerPressedCount(){let t=0;for(let n=0;n<this._pointerPressed.length;n++)this._pointerPressed[n]&&t++;return t}getPointerPosition(t){return t>=this._pointerPositions.length?null:this._pointerPositions[t]}getPointerPositionLastFrame(t){return t>=this._pointerPositionsLastFrame.length?null:this._pointerPositionsLastFrame[t]}getPointerPositionDelta(t){return t>=this._pointerPositionsDelta.length?null:this._pointerPositionsDelta[t]}getPointerPositionRC(t){return t>=this._pointerPositionsRC.length?null:this._pointerPositionsRC[t]}getPointerDown(t){return t>=this._pointerDown.length?!1:this._pointerDown[t]}getPointerUp(t){return t>=this._pointerUp.length?!1:this._pointerUp[t]}getPointerPressed(t){return t>=this._pointerPressed.length?!1:this._pointerPressed[t]}getPointerClicked(t){return t>=this._pointerClick.length?!1:this._pointerClick[t]}getPointerDoubleClicked(t){return t>=this._pointerDoubleClick.length?!1:this._pointerDoubleClick[t]}getPointerDownTime(t){return t>=this._pointerDownTime.length?-1:this._pointerDownTime[t]}getPointerUpTime(t){return t>=this._pointerUpTime.length?-1:this._pointerUpTime[t]}getPointerLongPress(t){return t>=this._pointerDownTime.length?!1:this.getPointerPressed(t)&&this.context.time.time-this._pointerDownTime[t]>this._longPressTimeThreshold}getIsMouse(t){return t>=this._pointerTypes.length?!1:this._pointerTypes[t]==="mouse"}getIsTouch(t){return t>=this._pointerTypes.length?!1:this._pointerTypes[t]==="touch"}getTouchesPressedCount(){let t=0;for(let n=0;n<this._pointerPressed.length;n++)this._pointerPressed[n]&&this.getIsTouch(n)&&t++;return t}getMouseWheelChanged(t=0){return t>=this._mouseWheelChanged.length?!1:this._mouseWheelChanged[t]}getPointerEvent(t){var n;if(!(t>=this._pointerEvent.length))return(n=this._pointerEvent[t])!=null?n:void 0}getKeyDown(){for(const t in this.keysPressed){const n=this.keysPressed[t];if(n.startFrame===this.context.time.frameCount)return n.key}return null}getKeyPressed(){for(const t in this.keysPressed){const n=this.keysPressed[t];if(n.pressed)return n.key}return null}isKeyDown(t){var n;return this.context.application.isVisible&&this.context.application.hasFocus&&((n=this.keysPressed[t])==null?void 0:n.startFrame)===this.context.time.frameCount&&this.keysPressed[t].pressed}isKeyUp(t){var n;return this.context.application.isVisible&&this.context.application.hasFocus&&((n=this.keysPressed[t])==null?void 0:n.frame)===this.context.time.frameCount&&!this.keysPressed[t].pressed}isKeyPressed(t){var n;return this.context.application.isVisible&&this.context.application.hasFocus&&((n=this.keysPressed[t])==null?void 0:n.pressed)}createPointerDown(t){this.onDown(t)}createPointerMove(t){this.onMove(t)}createPointerUp(t){this.onUp(t)}onLostFocus(){for(const t in this.keysPressed)this.keysPressed[t].pressed=!1}onEndOfFrame(){for(let t=0;t<this._pointerUp.length;t++)this._pointerUp[t]=!1;for(let t=0;t<this._pointerDown.length;t++)this._pointerDown[t]=!1;for(let t=0;t<this._pointerClick.length;t++)this._pointerClick[t]=!1;for(let t=0;t<this._pointerDoubleClick.length;t++)this._pointerDoubleClick[t]=!1;for(const t of this._pointerPositionsDelta)t.set(0,0);for(let t=0;t<this._mouseWheelChanged.length;t++)this._mouseWheelChanged[t]=!1}onKeyDown(t){if(!this.context.application.hasFocus)return;const n=this.keysPressed[t.keyCode];n&&n.pressed||(this.keysPressed[t.keyCode]={pressed:!0,frame:this.context.time.frameCount+1,startFrame:this.context.time.frameCount+1,key:t.key})}onKeyPressed(t){if(!this.context.application.hasFocus)return;const n=this.keysPressed[t.keyCode];!n||(n.pressed=!0,n.frame=this.context.time.frameCount+1)}onKeyUp(t){if(!this.context.application.hasFocus)return;const n=this.keysPressed[t.keyCode];!n||(n.pressed=!1,n.frame=this.context.time.frameCount+1)}onMouseWheel(t){this._mouseWheelChanged.length<=0&&this._mouseWheelChanged.push(!1),this._mouseWheelChanged[0]=!0}onTouchMove(t){}onTouchUp(t){}onPointerDown(t){if(t.defaultPrevented||t.pointerType===void 0&&t.pointerId===void 0)return;t.preventDefault&&t.preventDefault();let n=t.pointerType==="mouse"?t.button:this.getPointerIndex(t.pointerId);t.pointerId===void 0&&t.button!==void 0&&(n=t.button),this.onDown({button:n,clientX:t.clientX,clientY:t.clientY,pointerType:t.pointerType,source:t})}onPointerMove(t,n=void 0){if(t.defaultPrevented||t.pointerType===void 0&&t.pointerId===void 0)return;n!==!0&&t.preventDefault();let i=t.pointerType==="mouse"?t.button:this.getPointerIndex(t.pointerId);t.pointerId===void 0&&t.button!==void 0&&(i=t.button),i<0&&(i=0);const r={button:i,clientX:t.clientX,clientY:t.clientY,pointerType:t.pointerType,source:t};this.onMove(r)}onPointerUp(t,n=void 0){if(t.defaultPrevented||t.pointerType===void 0&&t.pointerId===void 0)return;n!==!0&&t.preventDefault();let i=t.pointerType==="mouse"?t.button:this.getPointerIndex(t.pointerId);t.pointerId===void 0&&t.button!==void 0&&(i=t.button),this._pointerIds[i]=-1,this.onUp({button:i,clientX:t.clientX,clientY:t.clientY,pointerType:t.pointerType,source:t})}isInRect(t){return!0}onDown(t){if(!!this.isInRect(t)){for(this.setPointerState(t.button,this._pointerPressed,!0),this.setPointerState(t.button,this._pointerDown,!0),this.setPointerStateT(t.button,this._pointerEvent,t.source);t.button>=this._pointerTypes.length;)this._pointerTypes.push(t.pointerType);for(this._pointerTypes[t.button]=t.pointerType===void 0?"mouse":t.pointerType;t.button>=this._pointerPositionDown.length;)this._pointerPositionDown.push(new Xe);this._pointerPositionDown[t.button].set(t.clientX,t.clientY),t.button>=this._pointerDownTime.length&&this._pointerDownTime.push(0),this._pointerDownTime[t.button]=this.context.time.time,this.updatePointerPosition(t),_i.Current=this.context,this.dispatchEvent(new Event("pointerDown"))}}onMove(t){!this.isInRect(t)||(this.updatePointerPosition(t),this.setPointerStateT(t.button,this._pointerEvent,t.source))}onUp(t){if(this.setPointerState(t.button,this._pointerPressed,!1),this.setPointerStateT(t.button,this._pointerEvent,t.source),!this.isInRect(t))return;if(this.setPointerState(t.button,this._pointerUp,!0),this.updatePointerPosition(t),!this._pointerPositionDown[t.button]){console.warn("Received pointer up event without matching down event for button: "+t.button);return}const n=t.clientX-this._pointerPositionDown[t.button].x,i=t.clientY-this._pointerPositionDown[t.button].y;if(t.button>=this._pointerUpTime.length&&this._pointerUpTime.push(-99),Math.abs(n)<5&&Math.abs(i)<5){this.setPointerState(t.button,this._pointerClick,!0);const r=this._pointerUpTime[t.button],o=this.context.time.time-r;o<this._doubleClickTimeThreshold&&o>0&&this.setPointerState(t.button,this._pointerDoubleClick,!0)}this._pointerUpTime[t.button]=this.context.time.time}updatePointerPosition(t){for(;t.button>=this._pointerPositions.length;)this._pointerPositions.push(new Xe);for(;t.button>=this._pointerPositionsLastFrame.length;)this._pointerPositionsLastFrame.push(new Xe);for(;t.button>=this._pointerPositionsDelta.length;)this._pointerPositionsDelta.push(new Xe);const n=this._pointerPositionsLastFrame[t.button];n.copy(this._pointerPositions[t.button]),this._pointerPositionsDelta[t.button].set(t.clientX-n.x,t.clientY-n.y),this._pointerPositions[t.button].x=t.clientX,this._pointerPositions[t.button].y=t.clientY;const i=t.clientX+window.scrollX,r=t.clientY+window.scrollY;for(;t.button>=this._pointerPositionsRC.length;)this._pointerPositionsRC.push(new Xe);this._pointerPositionsRC[t.button].x=(i-this.context.domX)/this.context.domWidth*2-1,this._pointerPositionsRC[t.button].y=-((r-this.context.domY)/this.context.domHeight)*2+1}getPointerIndex(t){for(let n=0;n<this._pointerIds.length;n++)if(this._pointerIds[n]===t)return n;for(let n=0;n<this._pointerIds.length;n++)if(this._pointerIds[n]===-1&&(this._pointerIds[n]=t),this._pointerIds[n]===t)return n;return this._pointerIds.push(t),this._pointerIds.length-1}setPointerState(t,n,i){for(;n.length<=t;)n.push(!1);n[t]=i}setPointerStateT(t,n,i){for(;n.length<=t;)n.push(null);n[t]=i}}var Dc=(a=>(a[a.BACKSPACE=8]="BACKSPACE",a[a.TAB=9]="TAB",a[a.ENTER=13]="ENTER",a[a.SHIFT=16]="SHIFT",a[a.CTRL=17]="CTRL",a[a.ALT=18]="ALT",a[a.PAUSE=19]="PAUSE",a[a.CAPS_LOCK=20]="CAPS_LOCK",a[a.ESCAPE=27]="ESCAPE",a[a.SPACE=32]="SPACE",a[a.PAGE_UP=33]="PAGE_UP",a[a.PAGE_DOWN=34]="PAGE_DOWN",a[a.END=35]="END",a[a.HOME=36]="HOME",a[a.LEFT_ARROW=37]="LEFT_ARROW",a[a.UP_ARROW=38]="UP_ARROW",a[a.RIGHT_ARROW=39]="RIGHT_ARROW",a[a.DOWN_ARROW=40]="DOWN_ARROW",a[a.INSERT=45]="INSERT",a[a.DELETE=46]="DELETE",a[a.KEY_0=48]="KEY_0",a[a.KEY_1=49]="KEY_1",a[a.KEY_2=50]="KEY_2",a[a.KEY_3=51]="KEY_3",a[a.KEY_4=52]="KEY_4",a[a.KEY_5=53]="KEY_5",a[a.KEY_6=54]="KEY_6",a[a.KEY_7=55]="KEY_7",a[a.KEY_8=56]="KEY_8",a[a.KEY_9=57]="KEY_9",a[a.KEY_A=65]="KEY_A",a[a.KEY_B=66]="KEY_B",a[a.KEY_C=67]="KEY_C",a[a.KEY_D=68]="KEY_D",a[a.KEY_E=69]="KEY_E",a[a.KEY_F=70]="KEY_F",a[a.KEY_G=71]="KEY_G",a[a.KEY_H=72]="KEY_H",a[a.KEY_I=73]="KEY_I",a[a.KEY_J=74]="KEY_J",a[a.KEY_K=75]="KEY_K",a[a.KEY_L=76]="KEY_L",a[a.KEY_M=77]="KEY_M",a[a.KEY_N=78]="KEY_N",a[a.KEY_O=79]="KEY_O",a[a.KEY_P=80]="KEY_P",a[a.KEY_Q=81]="KEY_Q",a[a.KEY_R=82]="KEY_R",a[a.KEY_S=83]="KEY_S",a[a.KEY_T=84]="KEY_T",a[a.KEY_U=85]="KEY_U",a[a.KEY_V=86]="KEY_V",a[a.KEY_W=87]="KEY_W",a[a.KEY_X=88]="KEY_X",a[a.KEY_Y=89]="KEY_Y",a[a.KEY_Z=90]="KEY_Z",a[a.LEFT_META=91]="LEFT_META",a[a.RIGHT_META=92]="RIGHT_META",a[a.SELECT=93]="SELECT",a[a.NUMPAD_0=96]="NUMPAD_0",a[a.NUMPAD_1=97]="NUMPAD_1",a[a.NUMPAD_2=98]="NUMPAD_2",a[a.NUMPAD_3=99]="NUMPAD_3",a[a.NUMPAD_4=100]="NUMPAD_4",a[a.NUMPAD_5=101]="NUMPAD_5",a[a.NUMPAD_6=102]="NUMPAD_6",a[a.NUMPAD_7=103]="NUMPAD_7",a[a.NUMPAD_8=104]="NUMPAD_8",a[a.NUMPAD_9=105]="NUMPAD_9",a[a.MULTIPLY=106]="MULTIPLY",a[a.ADD=107]="ADD",a[a.SUBTRACT=109]="SUBTRACT",a[a.DECIMAL=110]="DECIMAL",a[a.DIVIDE=111]="DIVIDE",a[a.F1=112]="F1",a[a.F2=113]="F2",a[a.F3=114]="F3",a[a.F4=115]="F4",a[a.F5=116]="F5",a[a.F6=117]="F6",a[a.F7=118]="F7",a[a.F8=119]="F8",a[a.F9=120]="F9",a[a.F10=121]="F10",a[a.F11=122]="F11",a[a.F12=123]="F12",a[a.NUM_LOCK=144]="NUM_LOCK",a[a.SCROLL_LOCK=145]="SCROLL_LOCK",a[a.SEMICOLON=186]="SEMICOLON",a[a.EQUALS=187]="EQUALS",a[a.COMMA=188]="COMMA",a[a.DASH=189]="DASH",a[a.PERIOD=190]="PERIOD",a[a.FORWARD_SLASH=191]="FORWARD_SLASH",a[a.GRAVE_ACCENT=192]="GRAVE_ACCENT",a[a.OPEN_BRACKET=219]="OPEN_BRACKET",a[a.BACK_SLASH=220]="BACK_SLASH",a[a.CLOSE_BRACKET=221]="CLOSE_BRACKET",a[a.SINGLE_QUOTE=222]="SINGLE_QUOTE",a))(Dc||{});class Fa{constructor(e=[0,0,0,0,0,0,0,0,0]){this.elements=void 0,this.elements=e}identity(){const e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1}setZero(){const e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e[8]=0}setTrace(e){const t=this.elements;t[0]=e.x,t[4]=e.y,t[8]=e.z}getTrace(e=new re){const t=this.elements;return e.x=t[0],e.y=t[4],e.z=t[8],e}vmult(e,t=new re){const n=this.elements,i=e.x,r=e.y,o=e.z;return t.x=n[0]*i+n[1]*r+n[2]*o,t.y=n[3]*i+n[4]*r+n[5]*o,t.z=n[6]*i+n[7]*r+n[8]*o,t}smult(e){for(let t=0;t<this.elements.length;t++)this.elements[t]*=e}mmult(e,t=new Fa){const n=this.elements,i=e.elements,r=t.elements,o=n[0],l=n[1],h=n[2],u=n[3],f=n[4],g=n[5],m=n[6],A=n[7],v=n[8],w=i[0],b=i[1],S=i[2],R=i[3],M=i[4],I=i[5],T=i[6],B=i[7],F=i[8];return r[0]=o*w+l*R+h*T,r[1]=o*b+l*M+h*B,r[2]=o*S+l*I+h*F,r[3]=u*w+f*R+g*T,r[4]=u*b+f*M+g*B,r[5]=u*S+f*I+g*F,r[6]=m*w+A*R+v*T,r[7]=m*b+A*M+v*B,r[8]=m*S+A*I+v*F,t}scale(e,t=new Fa){const n=this.elements,i=t.elements;for(let r=0;r!==3;r++)i[3*r+0]=e.x*n[3*r+0],i[3*r+1]=e.y*n[3*r+1],i[3*r+2]=e.z*n[3*r+2];return t}solve(e,t=new re){const r=[];let o,l;for(o=0;o<3*4;o++)r.push(0);for(o=0;o<3;o++)for(l=0;l<3;l++)r[o+4*l]=this.elements[o+3*l];r[3+4*0]=e.x,r[3+4*1]=e.y,r[3+4*2]=e.z;let h=3;const u=h;let f;const g=4;let m;do{if(o=u-h,r[o+4*o]===0){for(l=o+1;l<u;l++)if(r[o+4*l]!==0){f=g;do m=g-f,r[m+4*o]+=r[m+4*l];while(--f);break}}if(r[o+4*o]!==0)for(l=o+1;l<u;l++){const A=r[o+4*l]/r[o+4*o];f=g;do m=g-f,r[m+4*l]=m<=o?0:r[m+4*l]-r[m+4*o]*A;while(--f)}}while(--h);if(t.z=r[2*4+3]/r[2*4+2],t.y=(r[1*4+3]-r[1*4+2]*t.z)/r[1*4+1],t.x=(r[0*4+3]-r[0*4+2]*t.z-r[0*4+1]*t.y)/r[0*4+0],isNaN(t.x)||isNaN(t.y)||isNaN(t.z)||t.x===1/0||t.y===1/0||t.z===1/0)throw"Could not solve equation! Got x=["+t.toString()+"], b=["+e.toString()+"], A=["+this.toString()+"]";return t}e(e,t,n){if(n===void 0)return this.elements[t+3*e];this.elements[t+3*e]=n}copy(e){for(let t=0;t<e.elements.length;t++)this.elements[t]=e.elements[t];return this}toString(){let e="";const t=",";for(let n=0;n<9;n++)e+=this.elements[n]+t;return e}reverse(e=new Fa){const i=l9;let r,o;for(r=0;r<3;r++)for(o=0;o<3;o++)i[r+6*o]=this.elements[r+3*o];i[3+6*0]=1,i[3+6*1]=0,i[3+6*2]=0,i[4+6*0]=0,i[4+6*1]=1,i[4+6*2]=0,i[5+6*0]=0,i[5+6*1]=0,i[5+6*2]=1;let l=3;const h=l;let u;const f=6;let g;do{if(r=h-l,i[r+6*r]===0){for(o=r+1;o<h;o++)if(i[r+6*o]!==0){u=f;do g=f-u,i[g+6*r]+=i[g+6*o];while(--u);break}}if(i[r+6*r]!==0)for(o=r+1;o<h;o++){const m=i[r+6*o]/i[r+6*r];u=f;do g=f-u,i[g+6*o]=g<=r?0:i[g+6*o]-i[g+6*r]*m;while(--u)}}while(--l);r=2;do{o=r-1;do{const m=i[r+6*o]/i[r+6*r];u=6;do g=6-u,i[g+6*o]=i[g+6*o]-i[g+6*r]*m;while(--u)}while(o--)}while(--r);r=2;do{const m=1/i[r+6*r];u=6;do g=6-u,i[g+6*r]=i[g+6*r]*m;while(--u)}while(r--);r=2;do{o=2;do{if(g=i[3+o+6*r],isNaN(g)||g===1/0)throw"Could not reverse! A=["+this.toString()+"]";e.e(r,o,g)}while(o--)}while(r--);return e}setRotationFromQuaternion(e){const t=e.x,n=e.y,i=e.z,r=e.w,o=t+t,l=n+n,h=i+i,u=t*o,f=t*l,g=t*h,m=n*l,A=n*h,v=i*h,w=r*o,b=r*l,S=r*h,R=this.elements;return R[3*0+0]=1-(m+v),R[3*0+1]=f-S,R[3*0+2]=g+b,R[3*1+0]=f+S,R[3*1+1]=1-(u+v),R[3*1+2]=A-w,R[3*2+0]=g-b,R[3*2+1]=A+w,R[3*2+2]=1-(u+m),this}transpose(e=new Fa){const t=this.elements,n=e.elements;let i;return n[0]=t[0],n[4]=t[4],n[8]=t[8],i=t[1],n[1]=t[3],n[3]=i,i=t[2],n[2]=t[6],n[6]=i,i=t[5],n[5]=t[7],n[7]=i,e}}const l9=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class re{constructor(e=0,t=0,n=0){this.x=void 0,this.y=void 0,this.z=void 0,this.x=e,this.y=t,this.z=n}cross(e,t=new re){const n=e.x,i=e.y,r=e.z,o=this.x,l=this.y,h=this.z;return t.x=l*r-h*i,t.y=h*n-o*r,t.z=o*i-l*n,t}set(e,t,n){return this.x=e,this.y=t,this.z=n,this}setZero(){this.x=this.y=this.z=0}vadd(e,t){if(t)t.x=e.x+this.x,t.y=e.y+this.y,t.z=e.z+this.z;else return new re(this.x+e.x,this.y+e.y,this.z+e.z)}vsub(e,t){if(t)t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z;else return new re(this.x-e.x,this.y-e.y,this.z-e.z)}crossmat(){return new Fa([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const e=this.x,t=this.y,n=this.z,i=Math.sqrt(e*e+t*t+n*n);if(i>0){const r=1/i;this.x*=r,this.y*=r,this.z*=r}else this.x=0,this.y=0,this.z=0;return i}unit(e=new re){const t=this.x,n=this.y,i=this.z;let r=Math.sqrt(t*t+n*n+i*i);return r>0?(r=1/r,e.x=t*r,e.y=n*r,e.z=i*r):(e.x=1,e.y=0,e.z=0),e}length(){const e=this.x,t=this.y,n=this.z;return Math.sqrt(e*e+t*t+n*n)}lengthSquared(){return this.dot(this)}distanceTo(e){const t=this.x,n=this.y,i=this.z,r=e.x,o=e.y,l=e.z;return Math.sqrt((r-t)*(r-t)+(o-n)*(o-n)+(l-i)*(l-i))}distanceSquared(e){const t=this.x,n=this.y,i=this.z,r=e.x,o=e.y,l=e.z;return(r-t)*(r-t)+(o-n)*(o-n)+(l-i)*(l-i)}scale(e,t=new re){const n=this.x,i=this.y,r=this.z;return t.x=e*n,t.y=e*i,t.z=e*r,t}vmul(e,t=new re){return t.x=e.x*this.x,t.y=e.y*this.y,t.z=e.z*this.z,t}addScaledVector(e,t,n=new re){return n.x=this.x+e*t.x,n.y=this.y+e*t.y,n.z=this.z+e*t.z,n}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}isZero(){return this.x===0&&this.y===0&&this.z===0}negate(e=new re){return e.x=-this.x,e.y=-this.y,e.z=-this.z,e}tangents(e,t){const n=this.length();if(n>0){const i=h9,r=1/n;i.set(this.x*r,this.y*r,this.z*r);const o=u9;Math.abs(i.x)<.9?(o.set(1,0,0),i.cross(o,e)):(o.set(0,1,0),i.cross(o,e)),i.cross(e,t)}else e.set(1,0,0),t.set(0,1,0)}toString(){return this.x+","+this.y+","+this.z}toArray(){return[this.x,this.y,this.z]}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}lerp(e,t,n){const i=this.x,r=this.y,o=this.z;n.x=i+(e.x-i)*t,n.y=r+(e.y-r)*t,n.z=o+(e.z-o)*t}almostEquals(e,t=1e-6){return!(Math.abs(this.x-e.x)>t||Math.abs(this.y-e.y)>t||Math.abs(this.z-e.z)>t)}almostZero(e=1e-6){return!(Math.abs(this.x)>e||Math.abs(this.y)>e||Math.abs(this.z)>e)}isAntiparallelTo(e,t){return this.negate(NR),NR.almostEquals(e,t)}clone(){return new re(this.x,this.y,this.z)}}re.ZERO=void 0;re.UNIT_X=void 0;re.UNIT_Y=void 0;re.UNIT_Z=void 0;re.ZERO=new re(0,0,0);re.UNIT_X=new re(1,0,0);re.UNIT_Y=new re(0,1,0);re.UNIT_Z=new re(0,0,1);const h9=new re,u9=new re,NR=new re;class fo{constructor(e={}){this.lowerBound=void 0,this.upperBound=void 0,this.lowerBound=new re,this.upperBound=new re,e.lowerBound&&this.lowerBound.copy(e.lowerBound),e.upperBound&&this.upperBound.copy(e.upperBound)}setFromPoints(e,t,n,i){const r=this.lowerBound,o=this.upperBound,l=n;r.copy(e[0]),l&&l.vmult(r,r),o.copy(r);for(let h=1;h<e.length;h++){let u=e[h];l&&(l.vmult(u,UR),u=UR),u.x>o.x&&(o.x=u.x),u.x<r.x&&(r.x=u.x),u.y>o.y&&(o.y=u.y),u.y<r.y&&(r.y=u.y),u.z>o.z&&(o.z=u.z),u.z<r.z&&(r.z=u.z)}return t&&(t.vadd(r,r),t.vadd(o,o)),i&&(r.x-=i,r.y-=i,r.z-=i,o.x+=i,o.y+=i,o.z+=i),this}copy(e){return this.lowerBound.copy(e.lowerBound),this.upperBound.copy(e.upperBound),this}clone(){return new fo().copy(this)}extend(e){this.lowerBound.x=Math.min(this.lowerBound.x,e.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,e.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,e.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,e.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,e.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,e.upperBound.z)}overlaps(e){const t=this.lowerBound,n=this.upperBound,i=e.lowerBound,r=e.upperBound,o=i.x<=n.x&&n.x<=r.x||t.x<=r.x&&r.x<=n.x,l=i.y<=n.y&&n.y<=r.y||t.y<=r.y&&r.y<=n.y,h=i.z<=n.z&&n.z<=r.z||t.z<=r.z&&r.z<=n.z;return o&&l&&h}volume(){const e=this.lowerBound,t=this.upperBound;return(t.x-e.x)*(t.y-e.y)*(t.z-e.z)}contains(e){const t=this.lowerBound,n=this.upperBound,i=e.lowerBound,r=e.upperBound;return t.x<=i.x&&n.x>=r.x&&t.y<=i.y&&n.y>=r.y&&t.z<=i.z&&n.z>=r.z}getCorners(e,t,n,i,r,o,l,h){const u=this.lowerBound,f=this.upperBound;e.copy(u),t.set(f.x,u.y,u.z),n.set(f.x,f.y,u.z),i.set(u.x,f.y,f.z),r.set(f.x,u.y,f.z),o.set(u.x,f.y,u.z),l.set(u.x,u.y,f.z),h.copy(f)}toLocalFrame(e,t){const n=zR,i=n[0],r=n[1],o=n[2],l=n[3],h=n[4],u=n[5],f=n[6],g=n[7];this.getCorners(i,r,o,l,h,u,f,g);for(let m=0;m!==8;m++){const A=n[m];e.pointToLocal(A,A)}return t.setFromPoints(n)}toWorldFrame(e,t){const n=zR,i=n[0],r=n[1],o=n[2],l=n[3],h=n[4],u=n[5],f=n[6],g=n[7];this.getCorners(i,r,o,l,h,u,f,g);for(let m=0;m!==8;m++){const A=n[m];e.pointToWorld(A,A)}return t.setFromPoints(n)}overlapsRay(e){const{direction:t,from:n}=e,i=1/t.x,r=1/t.y,o=1/t.z,l=(this.lowerBound.x-n.x)*i,h=(this.upperBound.x-n.x)*i,u=(this.lowerBound.y-n.y)*r,f=(this.upperBound.y-n.y)*r,g=(this.lowerBound.z-n.z)*o,m=(this.upperBound.z-n.z)*o,A=Math.max(Math.max(Math.min(l,h),Math.min(u,f)),Math.min(g,m)),v=Math.min(Math.min(Math.max(l,h),Math.max(u,f)),Math.max(g,m));return!(v<0||A>v)}}const UR=new re,zR=[new re,new re,new re,new re,new re,new re,new re,new re];class GR{constructor(){this.matrix=void 0,this.matrix=[]}get(e,t){let{index:n}=e,{index:i}=t;if(i>n){const r=i;i=n,n=r}return this.matrix[(n*(n+1)>>1)+i-1]}set(e,t,n){let{index:i}=e,{index:r}=t;if(r>i){const o=r;r=i,i=o}this.matrix[(i*(i+1)>>1)+r-1]=n?1:0}reset(){for(let e=0,t=this.matrix.length;e!==t;e++)this.matrix[e]=0}setNumObjects(e){this.matrix.length=e*(e-1)>>1}}class F2{constructor(){this._listeners=void 0}addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;return n[e]===void 0&&(n[e]=[]),n[e].includes(t)||n[e].push(t),this}hasEventListener(e,t){if(this._listeners===void 0)return!1;const n=this._listeners;return!!(n[e]!==void 0&&n[e].includes(t))}hasAnyEventListener(e){return this._listeners===void 0?!1:this._listeners[e]!==void 0}removeEventListener(e,t){if(this._listeners===void 0)return this;const n=this._listeners;if(n[e]===void 0)return this;const i=n[e].indexOf(t);return i!==-1&&n[e].splice(i,1),this}dispatchEvent(e){if(this._listeners===void 0)return this;const n=this._listeners[e.type];if(n!==void 0){e.target=this;for(let i=0,r=n.length;i<r;i++)n[i].call(this,e)}return this}}class hs{constructor(e=0,t=0,n=0,i=1){this.x=void 0,this.y=void 0,this.z=void 0,this.w=void 0,this.x=e,this.y=t,this.z=n,this.w=i}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}toString(){return this.x+","+this.y+","+this.z+","+this.w}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(e,t){const n=Math.sin(t*.5);return this.x=e.x*n,this.y=e.y*n,this.z=e.z*n,this.w=Math.cos(t*.5),this}toAxisAngle(e=new re){this.normalize();const t=2*Math.acos(this.w),n=Math.sqrt(1-this.w*this.w);return n<.001?(e.x=this.x,e.y=this.y,e.z=this.z):(e.x=this.x/n,e.y=this.y/n,e.z=this.z/n),[e,t]}setFromVectors(e,t){if(e.isAntiparallelTo(t)){const n=d9,i=f9;e.tangents(n,i),this.setFromAxisAngle(n,Math.PI)}else{const n=e.cross(t);this.x=n.x,this.y=n.y,this.z=n.z,this.w=Math.sqrt(e.length()**2*t.length()**2)+e.dot(t),this.normalize()}return this}mult(e,t=new hs){const n=this.x,i=this.y,r=this.z,o=this.w,l=e.x,h=e.y,u=e.z,f=e.w;return t.x=n*f+o*l+i*u-r*h,t.y=i*f+o*h+r*l-n*u,t.z=r*f+o*u+n*h-i*l,t.w=o*f-n*l-i*h-r*u,t}inverse(e=new hs){const t=this.x,n=this.y,i=this.z,r=this.w;this.conjugate(e);const o=1/(t*t+n*n+i*i+r*r);return e.x*=o,e.y*=o,e.z*=o,e.w*=o,e}conjugate(e=new hs){return e.x=-this.x,e.y=-this.y,e.z=-this.z,e.w=this.w,e}normalize(){let e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}normalizeFast(){const e=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}vmult(e,t=new re){const n=e.x,i=e.y,r=e.z,o=this.x,l=this.y,h=this.z,u=this.w,f=u*n+l*r-h*i,g=u*i+h*n-o*r,m=u*r+o*i-l*n,A=-o*n-l*i-h*r;return t.x=f*u+A*-o+g*-h-m*-l,t.y=g*u+A*-l+m*-o-f*-h,t.z=m*u+A*-h+f*-l-g*-o,t}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}toEuler(e,t="YZX"){let n,i,r;const o=this.x,l=this.y,h=this.z,u=this.w;switch(t){case"YZX":const f=o*l+h*u;if(f>.499&&(n=2*Math.atan2(o,u),i=Math.PI/2,r=0),f<-.499&&(n=-2*Math.atan2(o,u),i=-Math.PI/2,r=0),n===void 0){const g=o*o,m=l*l,A=h*h;n=Math.atan2(2*l*u-2*o*h,1-2*m-2*A),i=Math.asin(2*f),r=Math.atan2(2*o*u-2*l*h,1-2*g-2*A)}break;default:throw new Error("Euler order "+t+" not supported yet.")}e.y=n,e.z=i,e.x=r}setFromEuler(e,t,n,i="XYZ"){const r=Math.cos(e/2),o=Math.cos(t/2),l=Math.cos(n/2),h=Math.sin(e/2),u=Math.sin(t/2),f=Math.sin(n/2);return i==="XYZ"?(this.x=h*o*l+r*u*f,this.y=r*u*l-h*o*f,this.z=r*o*f+h*u*l,this.w=r*o*l-h*u*f):i==="YXZ"?(this.x=h*o*l+r*u*f,this.y=r*u*l-h*o*f,this.z=r*o*f-h*u*l,this.w=r*o*l+h*u*f):i==="ZXY"?(this.x=h*o*l-r*u*f,this.y=r*u*l+h*o*f,this.z=r*o*f+h*u*l,this.w=r*o*l-h*u*f):i==="ZYX"?(this.x=h*o*l-r*u*f,this.y=r*u*l+h*o*f,this.z=r*o*f-h*u*l,this.w=r*o*l+h*u*f):i==="YZX"?(this.x=h*o*l+r*u*f,this.y=r*u*l+h*o*f,this.z=r*o*f-h*u*l,this.w=r*o*l-h*u*f):i==="XZY"&&(this.x=h*o*l-r*u*f,this.y=r*u*l-h*o*f,this.z=r*o*f+h*u*l,this.w=r*o*l+h*u*f),this}clone(){return new hs(this.x,this.y,this.z,this.w)}slerp(e,t,n=new hs){const i=this.x,r=this.y,o=this.z,l=this.w;let h=e.x,u=e.y,f=e.z,g=e.w,m,A,v,w,b;return A=i*h+r*u+o*f+l*g,A<0&&(A=-A,h=-h,u=-u,f=-f,g=-g),1-A>1e-6?(m=Math.acos(A),v=Math.sin(m),w=Math.sin((1-t)*m)/v,b=Math.sin(t*m)/v):(w=1-t,b=t),n.x=w*i+b*h,n.y=w*r+b*u,n.z=w*o+b*f,n.w=w*l+b*g,n}integrate(e,t,n,i=new hs){const r=e.x*n.x,o=e.y*n.y,l=e.z*n.z,h=this.x,u=this.y,f=this.z,g=this.w,m=t*.5;return i.x+=m*(r*g+o*f-l*u),i.y+=m*(o*g+l*h-r*f),i.z+=m*(l*g+r*u-o*h),i.w+=m*(-r*h-o*u-l*f),i}}const d9=new re,f9=new re,p9={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class rn{constructor(e={}){this.id=void 0,this.type=void 0,this.boundingSphereRadius=void 0,this.collisionResponse=void 0,this.collisionFilterGroup=void 0,this.collisionFilterMask=void 0,this.material=void 0,this.body=void 0,this.id=rn.idCounter++,this.type=e.type||0,this.boundingSphereRadius=0,this.collisionResponse=e.collisionResponse?e.collisionResponse:!0,this.collisionFilterGroup=e.collisionFilterGroup!==void 0?e.collisionFilterGroup:1,this.collisionFilterMask=e.collisionFilterMask!==void 0?e.collisionFilterMask:-1,this.material=e.material?e.material:null,this.body=null}updateBoundingSphereRadius(){throw"computeBoundingSphereRadius() not implemented for shape type "+this.type}volume(){throw"volume() not implemented for shape type "+this.type}calculateLocalInertia(e,t){throw"calculateLocalInertia() not implemented for shape type "+this.type}calculateWorldAABB(e,t,n,i){throw"calculateWorldAABB() not implemented for shape type "+this.type}}rn.idCounter=0;rn.types=p9;class bi{constructor(e={}){this.position=void 0,this.quaternion=void 0,this.position=new re,this.quaternion=new hs,e.position&&this.position.copy(e.position),e.quaternion&&this.quaternion.copy(e.quaternion)}pointToLocal(e,t){return bi.pointToLocalFrame(this.position,this.quaternion,e,t)}pointToWorld(e,t){return bi.pointToWorldFrame(this.position,this.quaternion,e,t)}vectorToWorldFrame(e,t=new re){return this.quaternion.vmult(e,t),t}static pointToLocalFrame(e,t,n,i=new re){return n.vsub(e,i),t.conjugate(HR),HR.vmult(i,i),i}static pointToWorldFrame(e,t,n,i=new re){return t.vmult(n,i),i.vadd(e,i),i}static vectorToWorldFrame(e,t,n=new re){return e.vmult(t,n),n}static vectorToLocalFrame(e,t,n,i=new re){return t.w*=-1,t.vmult(n,i),t.w*=-1,i}}const HR=new hs;class Im extends rn{constructor(e={}){const{vertices:t=[],faces:n=[],normals:i=[],axes:r,boundingSphereRadius:o}=e;super({type:rn.types.CONVEXPOLYHEDRON}),this.vertices=void 0,this.faces=void 0,this.faceNormals=void 0,this.worldVertices=void 0,this.worldVerticesNeedsUpdate=void 0,this.worldFaceNormals=void 0,this.worldFaceNormalsNeedsUpdate=void 0,this.uniqueAxes=void 0,this.uniqueEdges=void 0,this.vertices=t,this.faces=n,this.faceNormals=i,this.faceNormals.length===0&&this.computeNormals(),o?this.boundingSphereRadius=o:this.updateBoundingSphereRadius(),this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.worldFaceNormals=[],this.worldFaceNormalsNeedsUpdate=!0,this.uniqueAxes=r?r.slice():null,this.uniqueEdges=[],this.computeEdges()}computeEdges(){const e=this.faces,t=this.vertices,n=this.uniqueEdges;n.length=0;const i=new re;for(let r=0;r!==e.length;r++){const o=e[r],l=o.length;for(let h=0;h!==l;h++){const u=(h+1)%l;t[o[h]].vsub(t[o[u]],i),i.normalize();let f=!1;for(let g=0;g!==n.length;g++)if(n[g].almostEquals(i)||n[g].almostEquals(i)){f=!0;break}f||n.push(i.clone())}}}computeNormals(){this.faceNormals.length=this.faces.length;for(let e=0;e<this.faces.length;e++){for(let i=0;i<this.faces[e].length;i++)if(!this.vertices[this.faces[e][i]])throw new Error("Vertex "+this.faces[e][i]+" not found!");const t=this.faceNormals[e]||new re;this.getFaceNormal(e,t),t.negate(t),this.faceNormals[e]=t;const n=this.vertices[this.faces[e][0]];if(t.dot(n)<0){console.error(".faceNormals["+e+"] = Vec3("+t.toString()+") looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule.");for(let i=0;i<this.faces[e].length;i++)console.warn(".vertices["+this.faces[e][i]+"] = Vec3("+this.vertices[this.faces[e][i]].toString()+")")}}}getFaceNormal(e,t){const n=this.faces[e],i=this.vertices[n[0]],r=this.vertices[n[1]],o=this.vertices[n[2]];Im.computeNormal(i,r,o,t)}static computeNormal(e,t,n,i){const r=new re,o=new re;t.vsub(e,o),n.vsub(t,r),r.cross(o,i),i.isZero()||i.normalize()}clipAgainstHull(e,t,n,i,r,o,l,h,u){const f=new re;let g=-1,m=-Number.MAX_VALUE;for(let v=0;v<n.faces.length;v++){f.copy(n.faceNormals[v]),r.vmult(f,f);const w=f.dot(o);w>m&&(m=w,g=v)}const A=[];for(let v=0;v<n.faces[g].length;v++){const w=n.vertices[n.faces[g][v]],b=new re;b.copy(w),r.vmult(b,b),i.vadd(b,b),A.push(b)}g>=0&&this.clipFaceAgainstHull(o,e,t,A,l,h,u)}findSeparatingAxis(e,t,n,i,r,o,l,h){const u=new re,f=new re,g=new re,m=new re,A=new re,v=new re;let w=Number.MAX_VALUE;const b=this;if(b.uniqueAxes)for(let S=0;S!==b.uniqueAxes.length;S++){n.vmult(b.uniqueAxes[S],u);const R=b.testSepAxis(u,e,t,n,i,r);if(R===!1)return!1;R<w&&(w=R,o.copy(u))}else{const S=l?l.length:b.faces.length;for(let R=0;R<S;R++){const M=l?l[R]:R;u.copy(b.faceNormals[M]),n.vmult(u,u);const I=b.testSepAxis(u,e,t,n,i,r);if(I===!1)return!1;I<w&&(w=I,o.copy(u))}}if(e.uniqueAxes)for(let S=0;S!==e.uniqueAxes.length;S++){r.vmult(e.uniqueAxes[S],f);const R=b.testSepAxis(f,e,t,n,i,r);if(R===!1)return!1;R<w&&(w=R,o.copy(f))}else{const S=h?h.length:e.faces.length;for(let R=0;R<S;R++){const M=h?h[R]:R;f.copy(e.faceNormals[M]),r.vmult(f,f);const I=b.testSepAxis(f,e,t,n,i,r);if(I===!1)return!1;I<w&&(w=I,o.copy(f))}}for(let S=0;S!==b.uniqueEdges.length;S++){n.vmult(b.uniqueEdges[S],m);for(let R=0;R!==e.uniqueEdges.length;R++)if(r.vmult(e.uniqueEdges[R],A),m.cross(A,v),!v.almostZero()){v.normalize();const M=b.testSepAxis(v,e,t,n,i,r);if(M===!1)return!1;M<w&&(w=M,o.copy(v))}}return i.vsub(t,g),g.dot(o)>0&&o.negate(o),!0}testSepAxis(e,t,n,i,r,o){const l=this;Im.project(l,e,n,i,qw),Im.project(t,e,r,o,Xw);const h=qw[0],u=qw[1],f=Xw[0],g=Xw[1];if(h<g||f<u)return!1;const m=h-g,A=f-u;return m<A?m:A}calculateLocalInertia(e,t){const n=new re,i=new re;this.computeLocalAABB(i,n);const r=n.x-i.x,o=n.y-i.y,l=n.z-i.z;t.x=1/12*e*(2*o*2*o+2*l*2*l),t.y=1/12*e*(2*r*2*r+2*l*2*l),t.z=1/12*e*(2*o*2*o+2*r*2*r)}getPlaneConstantOfFace(e){const t=this.faces[e],n=this.faceNormals[e],i=this.vertices[t[0]];return-n.dot(i)}clipFaceAgainstHull(e,t,n,i,r,o,l){const h=new re,u=new re,f=new re,g=new re,m=new re,A=new re,v=new re,w=new re,b=this,S=[],R=i,M=S;let I=-1,T=Number.MAX_VALUE;for(let W=0;W<b.faces.length;W++){h.copy(b.faceNormals[W]),n.vmult(h,h);const J=h.dot(e);J<T&&(T=J,I=W)}if(I<0)return;const B=b.faces[I];B.connectedFaces=[];for(let W=0;W<b.faces.length;W++)for(let J=0;J<b.faces[W].length;J++)B.indexOf(b.faces[W][J])!==-1&&W!==I&&B.connectedFaces.indexOf(W)===-1&&B.connectedFaces.push(W);const F=B.length;for(let W=0;W<F;W++){const J=b.vertices[B[W]],ee=b.vertices[B[(W+1)%F]];J.vsub(ee,u),f.copy(u),n.vmult(f,f),t.vadd(f,f),g.copy(this.faceNormals[I]),n.vmult(g,g),t.vadd(g,g),f.cross(g,m),m.negate(m),A.copy(J),n.vmult(A,A),t.vadd(A,A);const Q=B.connectedFaces[W];v.copy(this.faceNormals[Q]);const Y=this.getPlaneConstantOfFace(Q);w.copy(v),n.vmult(w,w);const se=Y-w.dot(t);for(this.clipFaceAgainstPlane(R,M,w,se);R.length;)R.shift();for(;M.length;)R.push(M.shift())}v.copy(this.faceNormals[I]);const D=this.getPlaneConstantOfFace(I);w.copy(v),n.vmult(w,w);const U=D-w.dot(t);for(let W=0;W<R.length;W++){let J=w.dot(R[W])+U;if(J<=r&&(console.log("clamped: depth="+J+" to minDist="+r),J=r),J<=o){const ee=R[W];if(J<=1e-6){const Q={point:ee,normal:w,depth:J};l.push(Q)}}}}clipFaceAgainstPlane(e,t,n,i){let r,o;const l=e.length;if(l<2)return t;let h=e[e.length-1],u=e[0];r=n.dot(h)+i;for(let f=0;f<l;f++){if(u=e[f],o=n.dot(u)+i,r<0)if(o<0){const g=new re;g.copy(u),t.push(g)}else{const g=new re;h.lerp(u,r/(r-o),g),t.push(g)}else if(o<0){const g=new re;h.lerp(u,r/(r-o),g),t.push(g),t.push(u)}h=u,r=o}return t}computeWorldVertices(e,t){for(;this.worldVertices.length<this.vertices.length;)this.worldVertices.push(new re);const n=this.vertices,i=this.worldVertices;for(let r=0;r!==this.vertices.length;r++)t.vmult(n[r],i[r]),e.vadd(i[r],i[r]);this.worldVerticesNeedsUpdate=!1}computeLocalAABB(e,t){const n=this.vertices;e.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),t.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let i=0;i<this.vertices.length;i++){const r=n[i];r.x<e.x?e.x=r.x:r.x>t.x&&(t.x=r.x),r.y<e.y?e.y=r.y:r.y>t.y&&(t.y=r.y),r.z<e.z?e.z=r.z:r.z>t.z&&(t.z=r.z)}}computeWorldFaceNormals(e){const t=this.faceNormals.length;for(;this.worldFaceNormals.length<t;)this.worldFaceNormals.push(new re);const n=this.faceNormals,i=this.worldFaceNormals;for(let r=0;r!==t;r++)e.vmult(n[r],i[r]);this.worldFaceNormalsNeedsUpdate=!1}updateBoundingSphereRadius(){let e=0;const t=this.vertices;for(let n=0;n!==t.length;n++){const i=t[n].lengthSquared();i>e&&(e=i)}this.boundingSphereRadius=Math.sqrt(e)}calculateWorldAABB(e,t,n,i){const r=this.vertices;let o,l,h,u,f,g,m=new re;for(let A=0;A<r.length;A++){m.copy(r[A]),t.vmult(m,m),e.vadd(m,m);const v=m;(o===void 0||v.x<o)&&(o=v.x),(u===void 0||v.x>u)&&(u=v.x),(l===void 0||v.y<l)&&(l=v.y),(f===void 0||v.y>f)&&(f=v.y),(h===void 0||v.z<h)&&(h=v.z),(g===void 0||v.z>g)&&(g=v.z)}n.set(o,l,h),i.set(u,f,g)}volume(){return 4*Math.PI*this.boundingSphereRadius/3}getAveragePointLocal(e=new re){const t=this.vertices;for(let n=0;n<t.length;n++)e.vadd(t[n],e);return e.scale(1/t.length,e),e}transformAllPoints(e,t){const n=this.vertices.length,i=this.vertices;if(t){for(let r=0;r<n;r++){const o=i[r];t.vmult(o,o)}for(let r=0;r<this.faceNormals.length;r++){const o=this.faceNormals[r];t.vmult(o,o)}}if(e)for(let r=0;r<n;r++){const o=i[r];o.vadd(e,o)}}pointIsInside(e){const t=this.vertices,n=this.faces,i=this.faceNormals,r=new re;this.getAveragePointLocal(r);for(let o=0;o<this.faces.length;o++){let l=i[o];const h=t[n[o][0]],u=new re;e.vsub(h,u);const f=l.dot(u),g=new re;r.vsub(h,g);const m=l.dot(g);if(f<0&&m>0||f>0&&m<0)return!1}return-1}static project(e,t,n,i,r){const o=e.vertices.length,l=m9;let h=0,u=0;const f=g9,g=e.vertices;f.setZero(),bi.vectorToLocalFrame(n,i,t,l),bi.pointToLocalFrame(n,i,f,f);const m=f.dot(l);u=h=g[0].dot(l);for(let A=1;A<o;A++){const v=g[A].dot(l);v>h&&(h=v),v<u&&(u=v)}if(u-=m,h-=m,u>h){const A=u;u=h,h=A}r[0]=h,r[1]=u}}const qw=[],Xw=[],m9=new re,g9=new re;class Qy extends rn{constructor(e){super({type:rn.types.BOX}),this.halfExtents=void 0,this.convexPolyhedronRepresentation=void 0,this.halfExtents=e,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}updateConvexPolyhedronRepresentation(){const e=this.halfExtents.x,t=this.halfExtents.y,n=this.halfExtents.z,i=re,r=[new i(-e,-t,-n),new i(e,-t,-n),new i(e,t,-n),new i(-e,t,-n),new i(-e,-t,n),new i(e,-t,n),new i(e,t,n),new i(-e,t,n)],o=[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]],l=[new i(0,0,1),new i(0,1,0),new i(1,0,0)],h=new Im({vertices:r,faces:o,axes:l});this.convexPolyhedronRepresentation=h,h.material=this.material}calculateLocalInertia(e,t=new re){return Qy.calculateInertia(this.halfExtents,e,t),t}static calculateInertia(e,t,n){const i=e;n.x=1/12*t*(2*i.y*2*i.y+2*i.z*2*i.z),n.y=1/12*t*(2*i.x*2*i.x+2*i.z*2*i.z),n.z=1/12*t*(2*i.y*2*i.y+2*i.x*2*i.x)}getSideNormals(e,t){const n=e,i=this.halfExtents;if(n[0].set(i.x,0,0),n[1].set(0,i.y,0),n[2].set(0,0,i.z),n[3].set(-i.x,0,0),n[4].set(0,-i.y,0),n[5].set(0,0,-i.z),t!==void 0)for(let r=0;r!==n.length;r++)t.vmult(n[r],n[r]);return n}volume(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z}updateBoundingSphereRadius(){this.boundingSphereRadius=this.halfExtents.length()}forEachWorldCorner(e,t,n){const i=this.halfExtents,r=[[i.x,i.y,i.z],[-i.x,i.y,i.z],[-i.x,-i.y,i.z],[-i.x,-i.y,-i.z],[i.x,-i.y,-i.z],[i.x,i.y,-i.z],[-i.x,i.y,-i.z],[i.x,-i.y,i.z]];for(let o=0;o<r.length;o++)xl.set(r[o][0],r[o][1],r[o][2]),t.vmult(xl,xl),e.vadd(xl,xl),n(xl.x,xl.y,xl.z)}calculateWorldAABB(e,t,n,i){const r=this.halfExtents;xa[0].set(r.x,r.y,r.z),xa[1].set(-r.x,r.y,r.z),xa[2].set(-r.x,-r.y,r.z),xa[3].set(-r.x,-r.y,-r.z),xa[4].set(r.x,-r.y,-r.z),xa[5].set(r.x,r.y,-r.z),xa[6].set(-r.x,r.y,-r.z),xa[7].set(r.x,-r.y,r.z);const o=xa[0];t.vmult(o,o),e.vadd(o,o),i.copy(o),n.copy(o);for(let l=1;l<8;l++){const h=xa[l];t.vmult(h,h),e.vadd(h,h);const u=h.x,f=h.y,g=h.z;u>i.x&&(i.x=u),f>i.y&&(i.y=f),g>i.z&&(i.z=g),u<n.x&&(n.x=u),f<n.y&&(n.y=f),g<n.z&&(n.z=g)}}}const xl=new re,xa=[new re,new re,new re,new re,new re,new re,new re,new re],nS={DYNAMIC:1,STATIC:2,KINEMATIC:4},iS={AWAKE:0,SLEEPY:1,SLEEPING:2};class en extends F2{constructor(e={}){super(),this.id=void 0,this.index=void 0,this.world=void 0,this.preStep=void 0,this.postStep=void 0,this.vlambda=void 0,this.collisionFilterGroup=void 0,this.collisionFilterMask=void 0,this.collisionResponse=void 0,this.position=void 0,this.previousPosition=void 0,this.interpolatedPosition=void 0,this.initPosition=void 0,this.velocity=void 0,this.initVelocity=void 0,this.force=void 0,this.mass=void 0,this.invMass=void 0,this.material=void 0,this.linearDamping=void 0,this.type=void 0,this.allowSleep=void 0,this.sleepState=void 0,this.sleepSpeedLimit=void 0,this.sleepTimeLimit=void 0,this.timeLastSleepy=void 0,this.wakeUpAfterNarrowphase=void 0,this.torque=void 0,this.quaternion=void 0,this.initQuaternion=void 0,this.previousQuaternion=void 0,this.interpolatedQuaternion=void 0,this.angularVelocity=void 0,this.initAngularVelocity=void 0,this.shapes=void 0,this.shapeOffsets=void 0,this.shapeOrientations=void 0,this.inertia=void 0,this.invInertia=void 0,this.invInertiaWorld=void 0,this.invMassSolve=void 0,this.invInertiaSolve=void 0,this.invInertiaWorldSolve=void 0,this.fixedRotation=void 0,this.angularDamping=void 0,this.linearFactor=void 0,this.angularFactor=void 0,this.aabb=void 0,this.aabbNeedsUpdate=void 0,this.boundingRadius=void 0,this.wlambda=void 0,this.isTrigger=void 0,this.id=en.idCounter++,this.index=-1,this.world=null,this.preStep=null,this.postStep=null,this.vlambda=new re,this.collisionFilterGroup=typeof e.collisionFilterGroup=="number"?e.collisionFilterGroup:1,this.collisionFilterMask=typeof e.collisionFilterMask=="number"?e.collisionFilterMask:-1,this.collisionResponse=typeof e.collisionResponse=="boolean"?e.collisionResponse:!0,this.position=new re,this.previousPosition=new re,this.interpolatedPosition=new re,this.initPosition=new re,e.position&&(this.position.copy(e.position),this.previousPosition.copy(e.position),this.interpolatedPosition.copy(e.position),this.initPosition.copy(e.position)),this.velocity=new re,e.velocity&&this.velocity.copy(e.velocity),this.initVelocity=new re,this.force=new re;const t=typeof e.mass=="number"?e.mass:0;this.mass=t,this.invMass=t>0?1/t:0,this.material=e.material||null,this.linearDamping=typeof e.linearDamping=="number"?e.linearDamping:.01,this.type=t<=0?en.STATIC:en.DYNAMIC,typeof e.type==typeof en.STATIC&&(this.type=e.type),this.allowSleep=typeof e.allowSleep<"u"?e.allowSleep:!0,this.sleepState=en.AWAKE,this.sleepSpeedLimit=typeof e.sleepSpeedLimit<"u"?e.sleepSpeedLimit:.1,this.sleepTimeLimit=typeof e.sleepTimeLimit<"u"?e.sleepTimeLimit:1,this.timeLastSleepy=0,this.wakeUpAfterNarrowphase=!1,this.torque=new re,this.quaternion=new hs,this.initQuaternion=new hs,this.previousQuaternion=new hs,this.interpolatedQuaternion=new hs,e.quaternion&&(this.quaternion.copy(e.quaternion),this.initQuaternion.copy(e.quaternion),this.previousQuaternion.copy(e.quaternion),this.interpolatedQuaternion.copy(e.quaternion)),this.angularVelocity=new re,e.angularVelocity&&this.angularVelocity.copy(e.angularVelocity),this.initAngularVelocity=new re,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new re,this.invInertia=new re,this.invInertiaWorld=new Fa,this.invMassSolve=0,this.invInertiaSolve=new re,this.invInertiaWorldSolve=new Fa,this.fixedRotation=typeof e.fixedRotation<"u"?e.fixedRotation:!1,this.angularDamping=typeof e.angularDamping<"u"?e.angularDamping:.01,this.linearFactor=new re(1,1,1),e.linearFactor&&this.linearFactor.copy(e.linearFactor),this.angularFactor=new re(1,1,1),e.angularFactor&&this.angularFactor.copy(e.angularFactor),this.aabb=new fo,this.aabbNeedsUpdate=!0,this.boundingRadius=0,this.wlambda=new re,this.isTrigger=Boolean(e.isTrigger),e.shape&&this.addShape(e.shape),this.updateMassProperties()}wakeUp(){const e=this.sleepState;this.sleepState=en.AWAKE,this.wakeUpAfterNarrowphase=!1,e===en.SLEEPING&&this.dispatchEvent(en.wakeupEvent)}sleep(){this.sleepState=en.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.wakeUpAfterNarrowphase=!1}sleepTick(e){if(this.allowSleep){const t=this.sleepState,n=this.velocity.lengthSquared()+this.angularVelocity.lengthSquared(),i=this.sleepSpeedLimit**2;t===en.AWAKE&&n<i?(this.sleepState=en.SLEEPY,this.timeLastSleepy=e,this.dispatchEvent(en.sleepyEvent)):t===en.SLEEPY&&n>i?this.wakeUp():t===en.SLEEPY&&e-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(en.sleepEvent))}}updateSolveMassProperties(){this.sleepState===en.SLEEPING||this.type===en.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))}pointToLocalFrame(e,t=new re){return e.vsub(this.position,t),this.quaternion.conjugate().vmult(t,t),t}vectorToLocalFrame(e,t=new re){return this.quaternion.conjugate().vmult(e,t),t}pointToWorldFrame(e,t=new re){return this.quaternion.vmult(e,t),t.vadd(this.position,t),t}vectorToWorldFrame(e,t=new re){return this.quaternion.vmult(e,t),t}addShape(e,t,n){const i=new re,r=new hs;return t&&i.copy(t),n&&r.copy(n),this.shapes.push(e),this.shapeOffsets.push(i),this.shapeOrientations.push(r),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,e.body=this,this}removeShape(e){const t=this.shapes.indexOf(e);return t===-1?(console.warn("Shape does not belong to the body"),this):(this.shapes.splice(t,1),this.shapeOffsets.splice(t,1),this.shapeOrientations.splice(t,1),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,e.body=null,this)}updateBoundingRadius(){const e=this.shapes,t=this.shapeOffsets,n=e.length;let i=0;for(let r=0;r!==n;r++){const o=e[r];o.updateBoundingSphereRadius();const l=t[r].length(),h=o.boundingSphereRadius;l+h>i&&(i=l+h)}this.boundingRadius=i}updateAABB(){const e=this.shapes,t=this.shapeOffsets,n=this.shapeOrientations,i=e.length,r=A9,o=_9,l=this.quaternion,h=this.aabb,u=y9;for(let f=0;f!==i;f++){const g=e[f];l.vmult(t[f],r),r.vadd(this.position,r),l.mult(n[f],o),g.calculateWorldAABB(r,o,u.lowerBound,u.upperBound),f===0?h.copy(u):h.extend(u)}this.aabbNeedsUpdate=!1}updateInertiaWorld(e){const t=this.invInertia;if(!(t.x===t.y&&t.y===t.z&&!e)){const n=v9,i=x9;n.setRotationFromQuaternion(this.quaternion),n.transpose(i),n.scale(t,n),n.mmult(i,this.invInertiaWorld)}}applyForce(e,t=new re){if(this.type!==en.DYNAMIC)return;this.sleepState===en.SLEEPING&&this.wakeUp();const n=w9;t.cross(e,n),this.force.vadd(e,this.force),this.torque.vadd(n,this.torque)}applyLocalForce(e,t=new re){if(this.type!==en.DYNAMIC)return;const n=b9,i=E9;this.vectorToWorldFrame(e,n),this.vectorToWorldFrame(t,i),this.applyForce(n,i)}applyTorque(e){this.type===en.DYNAMIC&&(this.sleepState===en.SLEEPING&&this.wakeUp(),this.torque.vadd(e,this.torque))}applyImpulse(e,t=new re){if(this.type!==en.DYNAMIC)return;this.sleepState===en.SLEEPING&&this.wakeUp();const n=t,i=C9;i.copy(e),i.scale(this.invMass,i),this.velocity.vadd(i,this.velocity);const r=S9;n.cross(e,r),this.invInertiaWorld.vmult(r,r),this.angularVelocity.vadd(r,this.angularVelocity)}applyLocalImpulse(e,t=new re){if(this.type!==en.DYNAMIC)return;const n=M9,i=T9;this.vectorToWorldFrame(e,n),this.vectorToWorldFrame(t,i),this.applyImpulse(n,i)}updateMassProperties(){const e=I9;this.invMass=this.mass>0?1/this.mass:0;const t=this.inertia,n=this.fixedRotation;this.updateAABB(),e.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),Qy.calculateInertia(e,this.mass,t),this.invInertia.set(t.x>0&&!n?1/t.x:0,t.y>0&&!n?1/t.y:0,t.z>0&&!n?1/t.z:0),this.updateInertiaWorld(!0)}getVelocityAtWorldPoint(e,t){const n=new re;return e.vsub(this.position,n),this.angularVelocity.cross(n,t),this.velocity.vadd(t,t),t}integrate(e,t,n){if(this.previousPosition.copy(this.position),this.previousQuaternion.copy(this.quaternion),!(this.type===en.DYNAMIC||this.type===en.KINEMATIC)||this.sleepState===en.SLEEPING)return;const i=this.velocity,r=this.angularVelocity,o=this.position,l=this.force,h=this.torque,u=this.quaternion,f=this.invMass,g=this.invInertiaWorld,m=this.linearFactor,A=f*e;i.x+=l.x*A*m.x,i.y+=l.y*A*m.y,i.z+=l.z*A*m.z;const v=g.elements,w=this.angularFactor,b=h.x*w.x,S=h.y*w.y,R=h.z*w.z;r.x+=e*(v[0]*b+v[1]*S+v[2]*R),r.y+=e*(v[3]*b+v[4]*S+v[5]*R),r.z+=e*(v[6]*b+v[7]*S+v[8]*R),o.x+=i.x*e,o.y+=i.y*e,o.z+=i.z*e,u.integrate(this.angularVelocity,e,this.angularFactor,u),t&&(n?u.normalizeFast():u.normalize()),this.aabbNeedsUpdate=!0,this.updateInertiaWorld()}}en.idCounter=0;en.COLLIDE_EVENT_NAME="collide";en.DYNAMIC=nS.DYNAMIC;en.STATIC=nS.STATIC;en.KINEMATIC=nS.KINEMATIC;en.AWAKE=iS.AWAKE;en.SLEEPY=iS.SLEEPY;en.SLEEPING=iS.SLEEPING;en.wakeupEvent={type:"wakeup"};en.sleepyEvent={type:"sleepy"};en.sleepEvent={type:"sleep"};const A9=new re,_9=new hs,y9=new fo,v9=new Fa,x9=new Fa,w9=new re,b9=new re,E9=new re,C9=new re,S9=new re,M9=new re,T9=new re,I9=new re;class R9{constructor(){this.world=void 0,this.useBoundingBoxes=void 0,this.dirty=void 0,this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}collisionPairs(e,t,n){throw new Error("collisionPairs not implemented for this BroadPhase class!")}needBroadphaseCollision(e,t){return!((e.collisionFilterGroup&t.collisionFilterMask)===0||(t.collisionFilterGroup&e.collisionFilterMask)===0||((e.type&en.STATIC)!==0||e.sleepState===en.SLEEPING)&&((t.type&en.STATIC)!==0||t.sleepState===en.SLEEPING))}intersectionTest(e,t,n,i){this.useBoundingBoxes?this.doBoundingBoxBroadphase(e,t,n,i):this.doBoundingSphereBroadphase(e,t,n,i)}doBoundingSphereBroadphase(e,t,n,i){const r=P9;t.position.vsub(e.position,r);const o=(e.boundingRadius+t.boundingRadius)**2;r.lengthSquared()<o&&(n.push(e),i.push(t))}doBoundingBoxBroadphase(e,t,n,i){e.aabbNeedsUpdate&&e.updateAABB(),t.aabbNeedsUpdate&&t.updateAABB(),e.aabb.overlaps(t.aabb)&&(n.push(e),i.push(t))}makePairsUnique(e,t){const n=B9,i=L9,r=D9,o=e.length;for(let l=0;l!==o;l++)i[l]=e[l],r[l]=t[l];e.length=0,t.length=0;for(let l=0;l!==o;l++){const h=i[l].id,u=r[l].id,f=h<u?h+","+u:u+","+h;n[f]=l,n.keys.push(f)}for(let l=0;l!==n.keys.length;l++){const h=n.keys.pop(),u=n[h];e.push(i[u]),t.push(r[u]),delete n[h]}}setWorld(e){}static boundingSphereCheck(e,t){const n=new re;e.position.vsub(t.position,n);const i=e.shapes[0],r=t.shapes[0];return Math.pow(i.boundingSphereRadius+r.boundingSphereRadius,2)>n.lengthSquared()}aabbQuery(e,t,n){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}}const P9=new re,B9={keys:[]},L9=[],D9=[];new re;class O9 extends R9{constructor(){super()}collisionPairs(e,t,n){const i=e.bodies,r=i.length;let o,l;for(let h=0;h!==r;h++)for(let u=0;u!==h;u++)o=i[h],l=i[u],this.needBroadphaseCollision(o,l)&&this.intersectionTest(o,l,t,n)}aabbQuery(e,t,n=[]){for(let i=0;i<e.bodies.length;i++){const r=e.bodies[i];r.aabbNeedsUpdate&&r.updateAABB(),r.aabb.overlaps(t)&&n.push(r)}return n}}class fE{constructor(){this.rayFromWorld=void 0,this.rayToWorld=void 0,this.hitNormalWorld=void 0,this.hitPointWorld=void 0,this.hasHit=void 0,this.shape=void 0,this.body=void 0,this.hitFaceIndex=void 0,this.distance=void 0,this.shouldStop=void 0,this.rayFromWorld=new re,this.rayToWorld=new re,this.hitNormalWorld=new re,this.hitPointWorld=new re,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(e,t,n,i,r,o,l){this.rayFromWorld.copy(e),this.rayToWorld.copy(t),this.hitNormalWorld.copy(n),this.hitPointWorld.copy(i),this.shape=r,this.body=o,this.distance=l}}let k2,N2,U2,z2,G2,H2,V2;const sS={CLOSEST:1,ANY:2,ALL:4};k2=rn.types.SPHERE;N2=rn.types.PLANE;U2=rn.types.BOX;z2=rn.types.CYLINDER;G2=rn.types.CONVEXPOLYHEDRON;H2=rn.types.HEIGHTFIELD;V2=rn.types.TRIMESH;class Cs{get[k2](){return this._intersectSphere}get[N2](){return this._intersectPlane}get[U2](){return this._intersectBox}get[z2](){return this._intersectConvex}get[G2](){return this._intersectConvex}get[H2](){return this._intersectHeightfield}get[V2](){return this._intersectTrimesh}constructor(e=new re,t=new re){this.from=void 0,this.to=void 0,this.direction=void 0,this.precision=void 0,this.checkCollisionResponse=void 0,this.skipBackfaces=void 0,this.collisionFilterMask=void 0,this.collisionFilterGroup=void 0,this.mode=void 0,this.result=void 0,this.hasHit=void 0,this.callback=void 0,this.from=e.clone(),this.to=t.clone(),this.direction=new re,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=Cs.ANY,this.result=new fE,this.hasHit=!1,this.callback=n=>{}}intersectWorld(e,t){return this.mode=t.mode||Cs.ANY,this.result=t.result||new fE,this.skipBackfaces=!!t.skipBackfaces,this.collisionFilterMask=typeof t.collisionFilterMask<"u"?t.collisionFilterMask:-1,this.collisionFilterGroup=typeof t.collisionFilterGroup<"u"?t.collisionFilterGroup:-1,this.checkCollisionResponse=typeof t.checkCollisionResponse<"u"?t.checkCollisionResponse:!0,t.from&&this.from.copy(t.from),t.to&&this.to.copy(t.to),this.callback=t.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(VR),Yw.length=0,e.broadphase.aabbQuery(e,VR,Yw),this.intersectBodies(Yw),this.hasHit}intersectBody(e,t){t&&(this.result=t,this.updateDirection());const n=this.checkCollisionResponse;if(n&&!e.collisionResponse||(this.collisionFilterGroup&e.collisionFilterMask)===0||(e.collisionFilterGroup&this.collisionFilterMask)===0)return;const i=F9,r=k9;for(let o=0,l=e.shapes.length;o<l;o++){const h=e.shapes[o];if(!(n&&!h.collisionResponse)&&(e.quaternion.mult(e.shapeOrientations[o],r),e.quaternion.vmult(e.shapeOffsets[o],i),i.vadd(e.position,i),this.intersectShape(h,r,i,e),this.result.shouldStop))break}}intersectBodies(e,t){t&&(this.result=t,this.updateDirection());for(let n=0,i=e.length;!this.result.shouldStop&&n<i;n++)this.intersectBody(e[n])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(e,t,n,i){const r=this.from;if(Z9(r,this.direction,n)>e.boundingSphereRadius)return;const l=this[e.type];l&&l.call(this,e,t,n,i,e)}_intersectBox(e,t,n,i,r){return this._intersectConvex(e.convexPolyhedronRepresentation,t,n,i,r)}_intersectPlane(e,t,n,i,r){const o=this.from,l=this.to,h=this.direction,u=new re(0,0,1);t.vmult(u,u);const f=new re;o.vsub(n,f);const g=f.dot(u);l.vsub(n,f);const m=f.dot(u);if(g*m>0||o.distanceTo(l)<g)return;const A=u.dot(h);if(Math.abs(A)<this.precision)return;const v=new re,w=new re,b=new re;o.vsub(n,v);const S=-u.dot(v)/A;h.scale(S,w),o.vadd(w,b),this.reportIntersection(u,b,r,i,-1)}getAABB(e){const{lowerBound:t,upperBound:n}=e,i=this.to,r=this.from;t.x=Math.min(i.x,r.x),t.y=Math.min(i.y,r.y),t.z=Math.min(i.z,r.z),n.x=Math.max(i.x,r.x),n.y=Math.max(i.y,r.y),n.z=Math.max(i.z,r.z)}_intersectHeightfield(e,t,n,i,r){e.data,e.elementSize;const o=N9;o.from.copy(this.from),o.to.copy(this.to),bi.pointToLocalFrame(n,t,o.from,o.from),bi.pointToLocalFrame(n,t,o.to,o.to),o.updateDirection();const l=U9;let h,u,f,g;h=u=0,f=g=e.data.length-1;const m=new fo;o.getAABB(m),e.getIndexOfPosition(m.lowerBound.x,m.lowerBound.y,l,!0),h=Math.max(h,l[0]),u=Math.max(u,l[1]),e.getIndexOfPosition(m.upperBound.x,m.upperBound.y,l,!0),f=Math.min(f,l[0]+1),g=Math.min(g,l[1]+1);for(let A=h;A<f;A++)for(let v=u;v<g;v++){if(this.result.shouldStop)return;if(e.getAabbAtIndex(A,v,m),!!m.overlapsRay(o)){if(e.getConvexTrianglePillar(A,v,!1),bi.pointToWorldFrame(n,t,e.pillarOffset,t_),this._intersectConvex(e.pillarConvex,t,t_,i,r,WR),this.result.shouldStop)return;e.getConvexTrianglePillar(A,v,!0),bi.pointToWorldFrame(n,t,e.pillarOffset,t_),this._intersectConvex(e.pillarConvex,t,t_,i,r,WR)}}}_intersectSphere(e,t,n,i,r){const o=this.from,l=this.to,h=e.radius,u=(l.x-o.x)**2+(l.y-o.y)**2+(l.z-o.z)**2,f=2*((l.x-o.x)*(o.x-n.x)+(l.y-o.y)*(o.y-n.y)+(l.z-o.z)*(o.z-n.z)),g=(o.x-n.x)**2+(o.y-n.y)**2+(o.z-n.z)**2-h**2,m=f**2-4*u*g,A=z9,v=G9;if(!(m<0))if(m===0)o.lerp(l,m,A),A.vsub(n,v),v.normalize(),this.reportIntersection(v,A,r,i,-1);else{const w=(-f-Math.sqrt(m))/(2*u),b=(-f+Math.sqrt(m))/(2*u);if(w>=0&&w<=1&&(o.lerp(l,w,A),A.vsub(n,v),v.normalize(),this.reportIntersection(v,A,r,i,-1)),this.result.shouldStop)return;b>=0&&b<=1&&(o.lerp(l,b,A),A.vsub(n,v),v.normalize(),this.reportIntersection(v,A,r,i,-1))}}_intersectConvex(e,t,n,i,r,o){const l=H9,h=QR,u=o&&o.faceList||null,f=e.faces,g=e.vertices,m=e.faceNormals,A=this.direction,v=this.from,w=this.to,b=v.distanceTo(w),S=u?u.length:f.length,R=this.result;for(let M=0;!R.shouldStop&&M<S;M++){const I=u?u[M]:M,T=f[I],B=m[I],F=t,D=n;h.copy(g[T[0]]),F.vmult(h,h),h.vadd(D,h),h.vsub(v,h),F.vmult(B,l);const U=A.dot(l);if(Math.abs(U)<this.precision)continue;const W=l.dot(h)/U;if(!(W<0)){A.scale(W,Lr),Lr.vadd(v,Lr),Ko.copy(g[T[0]]),F.vmult(Ko,Ko),D.vadd(Ko,Ko);for(let J=1;!R.shouldStop&&J<T.length-1;J++){wa.copy(g[T[J]]),ba.copy(g[T[J+1]]),F.vmult(wa,wa),F.vmult(ba,ba),D.vadd(wa,wa),D.vadd(ba,ba);const ee=Lr.distanceTo(v);!(Cs.pointInTriangle(Lr,Ko,wa,ba)||Cs.pointInTriangle(Lr,wa,Ko,ba))||ee>b||this.reportIntersection(l,Lr,r,i,I)}}}}_intersectTrimesh(e,t,n,i,r,o){const l=V9,h=Y9,u=J9,f=QR,g=W9,m=Q9,A=j9,v=X9,w=q9,b=e.indices;e.vertices;const S=this.from,R=this.to,M=this.direction;u.position.copy(n),u.quaternion.copy(t),bi.vectorToLocalFrame(n,t,M,g),bi.pointToLocalFrame(n,t,S,m),bi.pointToLocalFrame(n,t,R,A),A.x*=e.scale.x,A.y*=e.scale.y,A.z*=e.scale.z,m.x*=e.scale.x,m.y*=e.scale.y,m.z*=e.scale.z,A.vsub(m,g),g.normalize();const I=m.distanceSquared(A);e.tree.rayQuery(this,u,h);for(let T=0,B=h.length;!this.result.shouldStop&&T!==B;T++){const F=h[T];e.getNormal(F,l),e.getVertex(b[F*3],Ko),Ko.vsub(m,f);const D=g.dot(l),U=l.dot(f)/D;if(U<0)continue;g.scale(U,Lr),Lr.vadd(m,Lr),e.getVertex(b[F*3+1],wa),e.getVertex(b[F*3+2],ba);const W=Lr.distanceSquared(m);!(Cs.pointInTriangle(Lr,wa,Ko,ba)||Cs.pointInTriangle(Lr,Ko,wa,ba))||W>I||(bi.vectorToWorldFrame(t,l,w),bi.pointToWorldFrame(n,t,Lr,v),this.reportIntersection(w,v,r,i,F))}h.length=0}reportIntersection(e,t,n,i,r){const o=this.from,l=this.to,h=o.distanceTo(t),u=this.result;if(!(this.skipBackfaces&&e.dot(this.direction)>0))switch(u.hitFaceIndex=typeof r<"u"?r:-1,this.mode){case Cs.ALL:this.hasHit=!0,u.set(o,l,e,t,n,i,h),u.hasHit=!0,this.callback(u);break;case Cs.CLOSEST:(h<u.distance||!u.hasHit)&&(this.hasHit=!0,u.hasHit=!0,u.set(o,l,e,t,n,i,h));break;case Cs.ANY:this.hasHit=!0,u.hasHit=!0,u.set(o,l,e,t,n,i,h),u.shouldStop=!0;break}}static pointInTriangle(e,t,n,i){i.vsub(t,au),n.vsub(t,Kp),e.vsub(t,Jw);const r=au.dot(au),o=au.dot(Kp),l=au.dot(Jw),h=Kp.dot(Kp),u=Kp.dot(Jw);let f,g;return(f=h*l-o*u)>=0&&(g=r*u-o*l)>=0&&f+g<r*h-o*o}}Cs.CLOSEST=sS.CLOSEST;Cs.ANY=sS.ANY;Cs.ALL=sS.ALL;const VR=new fo,Yw=[],Kp=new re,Jw=new re,F9=new re,k9=new hs,Lr=new re,Ko=new re,wa=new re,ba=new re,WR={faceList:[0]},t_=new re,N9=new Cs,U9=[],z9=new re,G9=new re,H9=new re,QR=new re,V9=new re,W9=new re,Q9=new re,j9=new re,q9=new re,X9=new re;new fo;const Y9=[],J9=new bi,au=new re,n_=new re;function Z9(a,e,t){t.vsub(a,au);const n=au.dot(e);return e.scale(n,n_),n_.vadd(a,n_),t.distanceTo(n_)}class K9{static defaults(e={},t){for(let n in t)n in e||(e[n]=t[n]);return e}}class jR{constructor(){this.spatial=void 0,this.rotational=void 0,this.spatial=new re,this.rotational=new re}multiplyElement(e){return e.spatial.dot(this.spatial)+e.rotational.dot(this.rotational)}multiplyVectors(e,t){return e.dot(this.spatial)+t.dot(this.rotational)}}class Og{constructor(e,t,n=-1e6,i=1e6){this.id=void 0,this.minForce=void 0,this.maxForce=void 0,this.bi=void 0,this.bj=void 0,this.si=void 0,this.sj=void 0,this.a=void 0,this.b=void 0,this.eps=void 0,this.jacobianElementA=void 0,this.jacobianElementB=void 0,this.enabled=void 0,this.multiplier=void 0,this.id=Og.idCounter++,this.minForce=n,this.maxForce=i,this.bi=e,this.bj=t,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new jR,this.jacobianElementB=new jR,this.enabled=!0,this.multiplier=0,this.setSpookParams(1e7,4,1/60)}setSpookParams(e,t,n){const i=t,r=e,o=n;this.a=4/(o*(1+4*i)),this.b=4*i/(1+4*i),this.eps=4/(o*o*r*(1+4*i))}computeB(e,t,n){const i=this.computeGW(),r=this.computeGq(),o=this.computeGiMf();return-r*e-i*t-o*n}computeGq(){const e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,i=this.bj,r=n.position,o=i.position;return e.spatial.dot(r)+t.spatial.dot(o)}computeGW(){const e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,i=this.bj,r=n.velocity,o=i.velocity,l=n.angularVelocity,h=i.angularVelocity;return e.multiplyVectors(r,l)+t.multiplyVectors(o,h)}computeGWlambda(){const e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,i=this.bj,r=n.vlambda,o=i.vlambda,l=n.wlambda,h=i.wlambda;return e.multiplyVectors(r,l)+t.multiplyVectors(o,h)}computeGiMf(){const e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,i=this.bj,r=n.force,o=n.torque,l=i.force,h=i.torque,u=n.invMassSolve,f=i.invMassSolve;return r.scale(u,qR),l.scale(f,XR),n.invInertiaWorldSolve.vmult(o,YR),i.invInertiaWorldSolve.vmult(h,JR),e.multiplyVectors(qR,YR)+t.multiplyVectors(XR,JR)}computeGiMGt(){const e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,i=this.bj,r=n.invMassSolve,o=i.invMassSolve,l=n.invInertiaWorldSolve,h=i.invInertiaWorldSolve;let u=r+o;return l.vmult(e.rotational,i_),u+=i_.dot(e.rotational),h.vmult(t.rotational,i_),u+=i_.dot(t.rotational),u}addToWlambda(e){const t=this.jacobianElementA,n=this.jacobianElementB,i=this.bi,r=this.bj,o=$9;i.vlambda.addScaledVector(i.invMassSolve*e,t.spatial,i.vlambda),r.vlambda.addScaledVector(r.invMassSolve*e,n.spatial,r.vlambda),i.invInertiaWorldSolve.vmult(t.rotational,o),i.wlambda.addScaledVector(e,o,i.wlambda),r.invInertiaWorldSolve.vmult(n.rotational,o),r.wlambda.addScaledVector(e,o,r.wlambda)}computeC(){return this.computeGiMGt()+this.eps}}Og.idCounter=0;const qR=new re,XR=new re,YR=new re,JR=new re,i_=new re,$9=new re;class eX extends Og{constructor(e,t,n=1e6){super(e,t,0,n),this.restitution=void 0,this.ri=void 0,this.rj=void 0,this.ni=void 0,this.restitution=0,this.ri=new re,this.rj=new re,this.ni=new re}computeB(e){const t=this.a,n=this.b,i=this.bi,r=this.bj,o=this.ri,l=this.rj,h=tX,u=nX,f=i.velocity,g=i.angularVelocity;i.force,i.torque;const m=r.velocity,A=r.angularVelocity;r.force,r.torque;const v=iX,w=this.jacobianElementA,b=this.jacobianElementB,S=this.ni;o.cross(S,h),l.cross(S,u),S.negate(w.spatial),h.negate(w.rotational),b.spatial.copy(S),b.rotational.copy(u),v.copy(r.position),v.vadd(l,v),v.vsub(i.position,v),v.vsub(o,v);const R=S.dot(v),M=this.restitution+1,I=M*m.dot(S)-M*f.dot(S)+A.dot(u)-g.dot(h),T=this.computeGiMf();return-R*t-I*n-e*T}getImpactVelocityAlongNormal(){const e=sX,t=rX,n=oX,i=aX,r=cX;return this.bi.position.vadd(this.ri,n),this.bj.position.vadd(this.rj,i),this.bi.getVelocityAtWorldPoint(n,e),this.bj.getVelocityAtWorldPoint(i,t),e.vsub(t,r),this.ni.dot(r)}}const tX=new re,nX=new re,iX=new re,sX=new re,rX=new re,oX=new re,aX=new re,cX=new re;new re;new re;new re;new re;new re;new re;class ZR extends Og{constructor(e,t,n){super(e,t,-n,n),this.ri=void 0,this.rj=void 0,this.t=void 0,this.ri=new re,this.rj=new re,this.t=new re}computeB(e){this.a;const t=this.b;this.bi,this.bj;const n=this.ri,i=this.rj,r=lX,o=hX,l=this.t;n.cross(l,r),i.cross(l,o);const h=this.jacobianElementA,u=this.jacobianElementB;l.negate(h.spatial),r.negate(h.rotational),u.spatial.copy(l),u.rotational.copy(o);const f=this.computeGW(),g=this.computeGiMf();return-f*t-e*g}}const lX=new re,hX=new re;class jy{constructor(e,t,n){this.id=void 0,this.materials=void 0,this.friction=void 0,this.restitution=void 0,this.contactEquationStiffness=void 0,this.contactEquationRelaxation=void 0,this.frictionEquationStiffness=void 0,this.frictionEquationRelaxation=void 0,n=K9.defaults(n,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=jy.idCounter++,this.materials=[e,t],this.friction=n.friction,this.restitution=n.restitution,this.contactEquationStiffness=n.contactEquationStiffness,this.contactEquationRelaxation=n.contactEquationRelaxation,this.frictionEquationStiffness=n.frictionEquationStiffness,this.frictionEquationRelaxation=n.frictionEquationRelaxation}}jy.idCounter=0;class qy{constructor(e={}){this.name=void 0,this.id=void 0,this.friction=void 0,this.restitution=void 0;let t="";typeof e=="string"&&(t=e,e={}),this.name=t,this.id=qy.idCounter++,this.friction=typeof e.friction<"u"?e.friction:-1,this.restitution=typeof e.restitution<"u"?e.restitution:-1}}qy.idCounter=0;class uX{constructor(e,t,n={}){this.restLength=void 0,this.stiffness=void 0,this.damping=void 0,this.bodyA=void 0,this.bodyB=void 0,this.localAnchorA=void 0,this.localAnchorB=void 0,this.restLength=typeof n.restLength=="number"?n.restLength:1,this.stiffness=n.stiffness||100,this.damping=n.damping||1,this.bodyA=e,this.bodyB=t,this.localAnchorA=new re,this.localAnchorB=new re,n.localAnchorA&&this.localAnchorA.copy(n.localAnchorA),n.localAnchorB&&this.localAnchorB.copy(n.localAnchorB),n.worldAnchorA&&this.setWorldAnchorA(n.worldAnchorA),n.worldAnchorB&&this.setWorldAnchorB(n.worldAnchorB)}setWorldAnchorA(e){this.bodyA.pointToLocalFrame(e,this.localAnchorA)}setWorldAnchorB(e){this.bodyB.pointToLocalFrame(e,this.localAnchorB)}getWorldAnchorA(e){this.bodyA.pointToWorldFrame(this.localAnchorA,e)}getWorldAnchorB(e){this.bodyB.pointToWorldFrame(this.localAnchorB,e)}applyForce(){const e=this.stiffness,t=this.damping,n=this.restLength,i=this.bodyA,r=this.bodyB,o=dX,l=fX,h=pX,u=mX,f=wX,g=gX,m=AX,A=_X,v=yX,w=vX,b=xX;this.getWorldAnchorA(g),this.getWorldAnchorB(m),g.vsub(i.position,A),m.vsub(r.position,v),m.vsub(g,o);const S=o.length();l.copy(o),l.normalize(),r.velocity.vsub(i.velocity,h),r.angularVelocity.cross(v,f),h.vadd(f,h),i.angularVelocity.cross(A,f),h.vsub(f,h),l.scale(-e*(S-n)-t*h.dot(l),u),i.force.vsub(u,i.force),r.force.vadd(u,r.force),A.cross(u,w),v.cross(u,b),i.torque.vsub(w,i.torque),r.torque.vadd(b,r.torque)}}const dX=new re,fX=new re,pX=new re,mX=new re,gX=new re,AX=new re,_X=new re,yX=new re,vX=new re,xX=new re,wX=new re;new re;new re;new re;new re;new re;new Cs;new re;new re;new re(1,0,0),new re(0,1,0),new re(0,0,1);new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;class bX extends rn{constructor(e){if(super({type:rn.types.SPHERE}),this.radius=void 0,this.radius=e!==void 0?e:1,this.radius<0)throw new Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}calculateLocalInertia(e,t=new re){const n=2*e*this.radius*this.radius/5;return t.x=n,t.y=n,t.z=n,t}volume(){return 4*Math.PI*Math.pow(this.radius,3)/3}updateBoundingSphereRadius(){this.boundingSphereRadius=this.radius}calculateWorldAABB(e,t,n,i){const r=this.radius,o=["x","y","z"];for(let l=0;l<o.length;l++){const h=o[l];n[h]=e[h]-r,i[h]=e[h]+r}}}new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new fo;new re;new fo;new re;new re;new re;new re;new re;new re;new re;new fo;new re;new bi;new fo;class EX{constructor(){this.equations=void 0,this.equations=[]}solve(e,t){return 0}addEquation(e){e.enabled&&!e.bi.isTrigger&&!e.bj.isTrigger&&this.equations.push(e)}removeEquation(e){const t=this.equations,n=t.indexOf(e);n!==-1&&t.splice(n,1)}removeAllEquations(){this.equations.length=0}}class CX extends EX{constructor(){super(),this.iterations=void 0,this.tolerance=void 0,this.iterations=10,this.tolerance=1e-7}solve(e,t){let n=0;const i=this.iterations,r=this.tolerance*this.tolerance,o=this.equations,l=o.length,h=t.bodies,u=h.length,f=e;let g,m,A,v,w,b;if(l!==0)for(let I=0;I!==u;I++)h[I].updateSolveMassProperties();const S=MX,R=TX,M=SX;S.length=l,R.length=l,M.length=l;for(let I=0;I!==l;I++){const T=o[I];M[I]=0,R[I]=T.computeB(f),S[I]=1/T.computeC()}if(l!==0){for(let B=0;B!==u;B++){const F=h[B],D=F.vlambda,U=F.wlambda;D.set(0,0,0),U.set(0,0,0)}for(n=0;n!==i;n++){v=0;for(let B=0;B!==l;B++){const F=o[B];g=R[B],m=S[B],b=M[B],w=F.computeGWlambda(),A=m*(g-w-F.eps*b),b+A<F.minForce?A=F.minForce-b:b+A>F.maxForce&&(A=F.maxForce-b),M[B]+=A,v+=A>0?A:-A,F.addToWlambda(A)}if(v*v<r)break}for(let B=0;B!==u;B++){const F=h[B],D=F.velocity,U=F.angularVelocity;F.vlambda.vmul(F.linearFactor,F.vlambda),D.vadd(F.vlambda,D),F.wlambda.vmul(F.angularFactor,F.wlambda),U.vadd(F.wlambda,U)}let I=o.length;const T=1/f;for(;I--;)o[I].multiplier=M[I]*T}return n}}const SX=[],MX=[],TX=[];en.STATIC;class IX{constructor(){this.objects=[],this.type=Object}release(...e){const t=e.length;for(let n=0;n!==t;n++)this.objects.push(e[n]);return this}get(){return this.objects.length===0?this.constructObject():this.objects.pop()}constructObject(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}resize(e){const t=this.objects;for(;t.length>e;)t.pop();for(;t.length<e;)t.push(this.constructObject());return this}}class RX extends IX{constructor(...e){super(...e),this.type=re}constructObject(){return new re}}let W2,Q2,j2,q2,X2,Y2,J2,Z2,K2,$2,eD,tD,nD,iD,sD,rD,oD,aD,cD,lD,hD,uD,dD,fD,pD;const Xi={sphereSphere:rn.types.SPHERE,spherePlane:rn.types.SPHERE|rn.types.PLANE,boxBox:rn.types.BOX|rn.types.BOX,sphereBox:rn.types.SPHERE|rn.types.BOX,planeBox:rn.types.PLANE|rn.types.BOX,convexConvex:rn.types.CONVEXPOLYHEDRON,sphereConvex:rn.types.SPHERE|rn.types.CONVEXPOLYHEDRON,planeConvex:rn.types.PLANE|rn.types.CONVEXPOLYHEDRON,boxConvex:rn.types.BOX|rn.types.CONVEXPOLYHEDRON,sphereHeightfield:rn.types.SPHERE|rn.types.HEIGHTFIELD,boxHeightfield:rn.types.BOX|rn.types.HEIGHTFIELD,convexHeightfield:rn.types.CONVEXPOLYHEDRON|rn.types.HEIGHTFIELD,sphereParticle:rn.types.PARTICLE|rn.types.SPHERE,planeParticle:rn.types.PLANE|rn.types.PARTICLE,boxParticle:rn.types.BOX|rn.types.PARTICLE,convexParticle:rn.types.PARTICLE|rn.types.CONVEXPOLYHEDRON,cylinderCylinder:rn.types.CYLINDER,sphereCylinder:rn.types.SPHERE|rn.types.CYLINDER,planeCylinder:rn.types.PLANE|rn.types.CYLINDER,boxCylinder:rn.types.BOX|rn.types.CYLINDER,convexCylinder:rn.types.CONVEXPOLYHEDRON|rn.types.CYLINDER,heightfieldCylinder:rn.types.HEIGHTFIELD|rn.types.CYLINDER,particleCylinder:rn.types.PARTICLE|rn.types.CYLINDER,sphereTrimesh:rn.types.SPHERE|rn.types.TRIMESH,planeTrimesh:rn.types.PLANE|rn.types.TRIMESH};W2=Xi.sphereSphere;Q2=Xi.spherePlane;j2=Xi.boxBox;q2=Xi.sphereBox;X2=Xi.planeBox;Y2=Xi.convexConvex;J2=Xi.sphereConvex;Z2=Xi.planeConvex;K2=Xi.boxConvex;$2=Xi.sphereHeightfield;eD=Xi.boxHeightfield;tD=Xi.convexHeightfield;nD=Xi.sphereParticle;iD=Xi.planeParticle;sD=Xi.boxParticle;rD=Xi.convexParticle;oD=Xi.cylinderCylinder;aD=Xi.sphereCylinder;cD=Xi.planeCylinder;lD=Xi.boxCylinder;hD=Xi.convexCylinder;uD=Xi.heightfieldCylinder;dD=Xi.particleCylinder;fD=Xi.sphereTrimesh;pD=Xi.planeTrimesh;class PX{get[W2](){return this.sphereSphere}get[Q2](){return this.spherePlane}get[j2](){return this.boxBox}get[q2](){return this.sphereBox}get[X2](){return this.planeBox}get[Y2](){return this.convexConvex}get[J2](){return this.sphereConvex}get[Z2](){return this.planeConvex}get[K2](){return this.boxConvex}get[$2](){return this.sphereHeightfield}get[eD](){return this.boxHeightfield}get[tD](){return this.convexHeightfield}get[nD](){return this.sphereParticle}get[iD](){return this.planeParticle}get[sD](){return this.boxParticle}get[rD](){return this.convexParticle}get[oD](){return this.convexConvex}get[aD](){return this.sphereConvex}get[cD](){return this.planeConvex}get[lD](){return this.boxConvex}get[hD](){return this.convexConvex}get[uD](){return this.heightfieldCylinder}get[dD](){return this.particleCylinder}get[fD](){return this.sphereTrimesh}get[pD](){return this.planeTrimesh}constructor(e){this.contactPointPool=void 0,this.frictionEquationPool=void 0,this.result=void 0,this.frictionResult=void 0,this.v3pool=void 0,this.world=void 0,this.currentContactMaterial=void 0,this.enableFrictionReduction=void 0,this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new RX,this.world=e,this.currentContactMaterial=e.defaultContactMaterial,this.enableFrictionReduction=!1}createContactEquation(e,t,n,i,r,o){let l;this.contactPointPool.length?(l=this.contactPointPool.pop(),l.bi=e,l.bj=t):l=new eX(e,t),l.enabled=e.collisionResponse&&t.collisionResponse&&n.collisionResponse&&i.collisionResponse;const h=this.currentContactMaterial;l.restitution=h.restitution,l.setSpookParams(h.contactEquationStiffness,h.contactEquationRelaxation,this.world.dt);const u=n.material||e.material,f=i.material||t.material;return u&&f&&u.restitution>=0&&f.restitution>=0&&(l.restitution=u.restitution*f.restitution),l.si=r||n,l.sj=o||i,l}createFrictionEquationsFromContact(e,t){const n=e.bi,i=e.bj,r=e.si,o=e.sj,l=this.world,h=this.currentContactMaterial;let u=h.friction;const f=r.material||n.material,g=o.material||i.material;if(f&&g&&f.friction>=0&&g.friction>=0&&(u=f.friction*g.friction),u>0){const m=u*l.gravity.length();let A=n.invMass+i.invMass;A>0&&(A=1/A);const v=this.frictionEquationPool,w=v.length?v.pop():new ZR(n,i,m*A),b=v.length?v.pop():new ZR(n,i,m*A);return w.bi=b.bi=n,w.bj=b.bj=i,w.minForce=b.minForce=-m*A,w.maxForce=b.maxForce=m*A,w.ri.copy(e.ri),w.rj.copy(e.rj),b.ri.copy(e.ri),b.rj.copy(e.rj),e.ni.tangents(w.t,b.t),w.setSpookParams(h.frictionEquationStiffness,h.frictionEquationRelaxation,l.dt),b.setSpookParams(h.frictionEquationStiffness,h.frictionEquationRelaxation,l.dt),w.enabled=b.enabled=e.enabled,t.push(w,b),!0}return!1}createFrictionFromAverage(e){let t=this.result[this.result.length-1];if(!this.createFrictionEquationsFromContact(t,this.frictionResult)||e===1)return;const n=this.frictionResult[this.frictionResult.length-2],i=this.frictionResult[this.frictionResult.length-1];qh.setZero(),Gd.setZero(),Hd.setZero();const r=t.bi;t.bj;for(let l=0;l!==e;l++)t=this.result[this.result.length-1-l],t.bi!==r?(qh.vadd(t.ni,qh),Gd.vadd(t.ri,Gd),Hd.vadd(t.rj,Hd)):(qh.vsub(t.ni,qh),Gd.vadd(t.rj,Gd),Hd.vadd(t.ri,Hd));const o=1/e;Gd.scale(o,n.ri),Hd.scale(o,n.rj),i.ri.copy(n.ri),i.rj.copy(n.rj),qh.normalize(),qh.tangents(n.t,i.t)}getContacts(e,t,n,i,r,o,l){this.contactPointPool=r,this.frictionEquationPool=l,this.result=i,this.frictionResult=o;const h=DX,u=OX,f=BX,g=LX;for(let m=0,A=e.length;m!==A;m++){const v=e[m],w=t[m];let b=null;v.material&&w.material&&(b=n.getContactMaterial(v.material,w.material)||null);const S=v.type&en.KINEMATIC&&w.type&en.STATIC||v.type&en.STATIC&&w.type&en.KINEMATIC||v.type&en.KINEMATIC&&w.type&en.KINEMATIC;for(let R=0;R<v.shapes.length;R++){v.quaternion.mult(v.shapeOrientations[R],h),v.quaternion.vmult(v.shapeOffsets[R],f),f.vadd(v.position,f);const M=v.shapes[R];for(let I=0;I<w.shapes.length;I++){w.quaternion.mult(w.shapeOrientations[I],u),w.quaternion.vmult(w.shapeOffsets[I],g),g.vadd(w.position,g);const T=w.shapes[I];if(!(M.collisionFilterMask&T.collisionFilterGroup&&T.collisionFilterMask&M.collisionFilterGroup)||f.distanceTo(g)>M.boundingSphereRadius+T.boundingSphereRadius)continue;let B=null;M.material&&T.material&&(B=n.getContactMaterial(M.material,T.material)||null),this.currentContactMaterial=B||b||n.defaultContactMaterial;const F=M.type|T.type,D=this[F];if(D){let U=!1;M.type<T.type?U=D.call(this,M,T,f,g,h,u,v,w,M,T,S):U=D.call(this,T,M,g,f,u,h,w,v,M,T,S),U&&S&&(n.shapeOverlapKeeper.set(M.id,T.id),n.bodyOverlapKeeper.set(v.id,w.id))}}}}}sphereSphere(e,t,n,i,r,o,l,h,u,f,g){if(g)return n.distanceSquared(i)<(e.radius+t.radius)**2;const m=this.createContactEquation(l,h,e,t,u,f);i.vsub(n,m.ni),m.ni.normalize(),m.ri.copy(m.ni),m.rj.copy(m.ni),m.ri.scale(e.radius,m.ri),m.rj.scale(-t.radius,m.rj),m.ri.vadd(n,m.ri),m.ri.vsub(l.position,m.ri),m.rj.vadd(i,m.rj),m.rj.vsub(h.position,m.rj),this.result.push(m),this.createFrictionEquationsFromContact(m,this.frictionResult)}spherePlane(e,t,n,i,r,o,l,h,u,f,g){const m=this.createContactEquation(l,h,e,t,u,f);if(m.ni.set(0,0,1),o.vmult(m.ni,m.ni),m.ni.negate(m.ni),m.ni.normalize(),m.ni.scale(e.radius,m.ri),n.vsub(i,s_),m.ni.scale(m.ni.dot(s_),KR),s_.vsub(KR,m.rj),-s_.dot(m.ni)<=e.radius){if(g)return!0;const A=m.ri,v=m.rj;A.vadd(n,A),A.vsub(l.position,A),v.vadd(i,v),v.vsub(h.position,v),this.result.push(m),this.createFrictionEquationsFromContact(m,this.frictionResult)}}boxBox(e,t,n,i,r,o,l,h,u,f,g){return e.convexPolyhedronRepresentation.material=e.material,t.convexPolyhedronRepresentation.material=t.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexConvex(e.convexPolyhedronRepresentation,t.convexPolyhedronRepresentation,n,i,r,o,l,h,e,t,g)}sphereBox(e,t,n,i,r,o,l,h,u,f,g){const m=this.v3pool,A=aY;n.vsub(i,r_),t.getSideNormals(A,o);const v=e.radius;let w=!1;const b=lY,S=hY,R=uY;let M=null,I=0,T=0,B=0,F=null;for(let ae=0,ve=A.length;ae!==ve&&w===!1;ae++){const xe=sY;xe.copy(A[ae]);const Ae=xe.length();xe.normalize();const Me=r_.dot(xe);if(Me<Ae+v&&Me>0){const Be=rY,Le=oY;Be.copy(A[(ae+1)%3]),Le.copy(A[(ae+2)%3]);const $e=Be.length(),yt=Le.length();Be.normalize(),Le.normalize();const Nt=r_.dot(Be),He=r_.dot(Le);if(Nt<$e&&Nt>-$e&&He<yt&&He>-yt){const mn=Math.abs(Me-Ae-v);if((F===null||mn<F)&&(F=mn,T=Nt,B=He,M=Ae,b.copy(xe),S.copy(Be),R.copy(Le),I++,g))return!0}}}if(I){w=!0;const ae=this.createContactEquation(l,h,e,t,u,f);b.scale(-v,ae.ri),ae.ni.copy(b),ae.ni.negate(ae.ni),b.scale(M,b),S.scale(T,S),b.vadd(S,b),R.scale(B,R),b.vadd(R,ae.rj),ae.ri.vadd(n,ae.ri),ae.ri.vsub(l.position,ae.ri),ae.rj.vadd(i,ae.rj),ae.rj.vsub(h.position,ae.rj),this.result.push(ae),this.createFrictionEquationsFromContact(ae,this.frictionResult)}let D=m.get();const U=cY;for(let ae=0;ae!==2&&!w;ae++)for(let ve=0;ve!==2&&!w;ve++)for(let xe=0;xe!==2&&!w;xe++)if(D.set(0,0,0),ae?D.vadd(A[0],D):D.vsub(A[0],D),ve?D.vadd(A[1],D):D.vsub(A[1],D),xe?D.vadd(A[2],D):D.vsub(A[2],D),i.vadd(D,U),U.vsub(n,U),U.lengthSquared()<v*v){if(g)return!0;w=!0;const Ae=this.createContactEquation(l,h,e,t,u,f);Ae.ri.copy(U),Ae.ri.normalize(),Ae.ni.copy(Ae.ri),Ae.ri.scale(v,Ae.ri),Ae.rj.copy(D),Ae.ri.vadd(n,Ae.ri),Ae.ri.vsub(l.position,Ae.ri),Ae.rj.vadd(i,Ae.rj),Ae.rj.vsub(h.position,Ae.rj),this.result.push(Ae),this.createFrictionEquationsFromContact(Ae,this.frictionResult)}m.release(D),D=null;const W=m.get(),J=m.get(),ee=m.get(),Q=m.get(),Y=m.get(),se=A.length;for(let ae=0;ae!==se&&!w;ae++)for(let ve=0;ve!==se&&!w;ve++)if(ae%3!==ve%3){A[ve].cross(A[ae],W),W.normalize(),A[ae].vadd(A[ve],J),ee.copy(n),ee.vsub(J,ee),ee.vsub(i,ee);const xe=ee.dot(W);W.scale(xe,Q);let Ae=0;for(;Ae===ae%3||Ae===ve%3;)Ae++;Y.copy(n),Y.vsub(Q,Y),Y.vsub(J,Y),Y.vsub(i,Y);const Me=Math.abs(xe),Be=Y.length();if(Me<A[Ae].length()&&Be<v){if(g)return!0;w=!0;const Le=this.createContactEquation(l,h,e,t,u,f);J.vadd(Q,Le.rj),Le.rj.copy(Le.rj),Y.negate(Le.ni),Le.ni.normalize(),Le.ri.copy(Le.rj),Le.ri.vadd(i,Le.ri),Le.ri.vsub(n,Le.ri),Le.ri.normalize(),Le.ri.scale(v,Le.ri),Le.ri.vadd(n,Le.ri),Le.ri.vsub(l.position,Le.ri),Le.rj.vadd(i,Le.rj),Le.rj.vsub(h.position,Le.rj),this.result.push(Le),this.createFrictionEquationsFromContact(Le,this.frictionResult)}}m.release(W,J,ee,Q,Y)}planeBox(e,t,n,i,r,o,l,h,u,f,g){return t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,t.convexPolyhedronRepresentation.id=t.id,this.planeConvex(e,t.convexPolyhedronRepresentation,n,i,r,o,l,h,e,t,g)}convexConvex(e,t,n,i,r,o,l,h,u,f,g,m,A){const v=SY;if(!(n.distanceTo(i)>e.boundingSphereRadius+t.boundingSphereRadius)&&e.findSeparatingAxis(t,n,r,i,o,v,m,A)){const w=[],b=MY;e.clipAgainstHull(n,r,t,i,o,v,-100,100,w);let S=0;for(let R=0;R!==w.length;R++){if(g)return!0;const M=this.createContactEquation(l,h,e,t,u,f),I=M.ri,T=M.rj;v.negate(M.ni),w[R].normal.negate(b),b.scale(w[R].depth,b),w[R].point.vadd(b,I),T.copy(w[R].point),I.vsub(n,I),T.vsub(i,T),I.vadd(n,I),I.vsub(l.position,I),T.vadd(i,T),T.vsub(h.position,T),this.result.push(M),S++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(M,this.frictionResult)}this.enableFrictionReduction&&S&&this.createFrictionFromAverage(S)}}sphereConvex(e,t,n,i,r,o,l,h,u,f,g){const m=this.v3pool;n.vsub(i,dY);const A=t.faceNormals,v=t.faces,w=t.vertices,b=e.radius;let S=!1;for(let R=0;R!==w.length;R++){const M=w[R],I=gY;o.vmult(M,I),i.vadd(I,I);const T=mY;if(I.vsub(n,T),T.lengthSquared()<b*b){if(g)return!0;S=!0;const B=this.createContactEquation(l,h,e,t,u,f);B.ri.copy(T),B.ri.normalize(),B.ni.copy(B.ri),B.ri.scale(b,B.ri),I.vsub(i,B.rj),B.ri.vadd(n,B.ri),B.ri.vsub(l.position,B.ri),B.rj.vadd(i,B.rj),B.rj.vsub(h.position,B.rj),this.result.push(B),this.createFrictionEquationsFromContact(B,this.frictionResult);return}}for(let R=0,M=v.length;R!==M&&S===!1;R++){const I=A[R],T=v[R],B=AY;o.vmult(I,B);const F=_Y;o.vmult(w[T[0]],F),F.vadd(i,F);const D=yY;B.scale(-b,D),n.vadd(D,D);const U=vY;D.vsub(F,U);const W=U.dot(B),J=xY;if(n.vsub(F,J),W<0&&J.dot(B)>0){const ee=[];for(let Q=0,Y=T.length;Q!==Y;Q++){const se=m.get();o.vmult(w[T[Q]],se),i.vadd(se,se),ee.push(se)}if(iY(ee,B,n)){if(g)return!0;S=!0;const Q=this.createContactEquation(l,h,e,t,u,f);B.scale(-b,Q.ri),B.negate(Q.ni);const Y=m.get();B.scale(-W,Y);const se=m.get();B.scale(-b,se),n.vsub(i,Q.rj),Q.rj.vadd(se,Q.rj),Q.rj.vadd(Y,Q.rj),Q.rj.vadd(i,Q.rj),Q.rj.vsub(h.position,Q.rj),Q.ri.vadd(n,Q.ri),Q.ri.vsub(l.position,Q.ri),m.release(Y),m.release(se),this.result.push(Q),this.createFrictionEquationsFromContact(Q,this.frictionResult);for(let ae=0,ve=ee.length;ae!==ve;ae++)m.release(ee[ae]);return}else for(let Q=0;Q!==T.length;Q++){const Y=m.get(),se=m.get();o.vmult(w[T[(Q+1)%T.length]],Y),o.vmult(w[T[(Q+2)%T.length]],se),i.vadd(Y,Y),i.vadd(se,se);const ae=fY;se.vsub(Y,ae);const ve=pY;ae.unit(ve);const xe=m.get(),Ae=m.get();n.vsub(Y,Ae);const Me=Ae.dot(ve);ve.scale(Me,xe),xe.vadd(Y,xe);const Be=m.get();if(xe.vsub(n,Be),Me>0&&Me*Me<ae.lengthSquared()&&Be.lengthSquared()<b*b){if(g)return!0;const Le=this.createContactEquation(l,h,e,t,u,f);xe.vsub(i,Le.rj),xe.vsub(n,Le.ni),Le.ni.normalize(),Le.ni.scale(b,Le.ri),Le.rj.vadd(i,Le.rj),Le.rj.vsub(h.position,Le.rj),Le.ri.vadd(n,Le.ri),Le.ri.vsub(l.position,Le.ri),this.result.push(Le),this.createFrictionEquationsFromContact(Le,this.frictionResult);for(let $e=0,yt=ee.length;$e!==yt;$e++)m.release(ee[$e]);m.release(Y),m.release(se),m.release(xe),m.release(Be),m.release(Ae);return}m.release(Y),m.release(se),m.release(xe),m.release(Be),m.release(Ae)}for(let Q=0,Y=ee.length;Q!==Y;Q++)m.release(ee[Q])}}}planeConvex(e,t,n,i,r,o,l,h,u,f,g){const m=wY,A=bY;A.set(0,0,1),r.vmult(A,A);let v=0;const w=EY;for(let b=0;b!==t.vertices.length;b++)if(m.copy(t.vertices[b]),o.vmult(m,m),i.vadd(m,m),m.vsub(n,w),A.dot(w)<=0){if(g)return!0;const R=this.createContactEquation(l,h,e,t,u,f),M=CY;A.scale(A.dot(w),M),m.vsub(M,M),M.vsub(n,R.ri),R.ni.copy(A),m.vsub(i,R.rj),R.ri.vadd(n,R.ri),R.ri.vsub(l.position,R.ri),R.rj.vadd(i,R.rj),R.rj.vsub(h.position,R.rj),this.result.push(R),v++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(R,this.frictionResult)}this.enableFrictionReduction&&v&&this.createFrictionFromAverage(v)}boxConvex(e,t,n,i,r,o,l,h,u,f,g){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexConvex(e.convexPolyhedronRepresentation,t,n,i,r,o,l,h,e,t,g)}sphereHeightfield(e,t,n,i,r,o,l,h,u,f,g){const m=t.data,A=e.radius,v=t.elementSize,w=UY,b=NY;bi.pointToLocalFrame(i,o,n,b);let S=Math.floor((b.x-A)/v)-1,R=Math.ceil((b.x+A)/v)+1,M=Math.floor((b.y-A)/v)-1,I=Math.ceil((b.y+A)/v)+1;if(R<0||I<0||S>m.length||M>m[0].length)return;S<0&&(S=0),R<0&&(R=0),M<0&&(M=0),I<0&&(I=0),S>=m.length&&(S=m.length-1),R>=m.length&&(R=m.length-1),I>=m[0].length&&(I=m[0].length-1),M>=m[0].length&&(M=m[0].length-1);const T=[];t.getRectMinMax(S,M,R,I,T);const B=T[0],F=T[1];if(b.z-A>F||b.z+A<B)return;const D=this.result;for(let U=S;U<R;U++)for(let W=M;W<I;W++){const J=D.length;let ee=!1;if(t.getConvexTrianglePillar(U,W,!1),bi.pointToWorldFrame(i,o,t.pillarOffset,w),n.distanceTo(w)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(ee=this.sphereConvex(e,t.pillarConvex,n,w,r,o,l,h,e,t,g)),g&&ee||(t.getConvexTrianglePillar(U,W,!0),bi.pointToWorldFrame(i,o,t.pillarOffset,w),n.distanceTo(w)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(ee=this.sphereConvex(e,t.pillarConvex,n,w,r,o,l,h,e,t,g)),g&&ee))return!0;if(D.length-J>2)return}}boxHeightfield(e,t,n,i,r,o,l,h,u,f,g){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexHeightfield(e.convexPolyhedronRepresentation,t,n,i,r,o,l,h,e,t,g)}convexHeightfield(e,t,n,i,r,o,l,h,u,f,g){const m=t.data,A=t.elementSize,v=e.boundingSphereRadius,w=FY,b=kY,S=OY;bi.pointToLocalFrame(i,o,n,S);let R=Math.floor((S.x-v)/A)-1,M=Math.ceil((S.x+v)/A)+1,I=Math.floor((S.y-v)/A)-1,T=Math.ceil((S.y+v)/A)+1;if(M<0||T<0||R>m.length||I>m[0].length)return;R<0&&(R=0),M<0&&(M=0),I<0&&(I=0),T<0&&(T=0),R>=m.length&&(R=m.length-1),M>=m.length&&(M=m.length-1),T>=m[0].length&&(T=m[0].length-1),I>=m[0].length&&(I=m[0].length-1);const B=[];t.getRectMinMax(R,I,M,T,B);const F=B[0],D=B[1];if(!(S.z-v>D||S.z+v<F))for(let U=R;U<M;U++)for(let W=I;W<T;W++){let J=!1;if(t.getConvexTrianglePillar(U,W,!1),bi.pointToWorldFrame(i,o,t.pillarOffset,w),n.distanceTo(w)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(J=this.convexConvex(e,t.pillarConvex,n,w,r,o,l,h,null,null,g,b,null)),g&&J||(t.getConvexTrianglePillar(U,W,!0),bi.pointToWorldFrame(i,o,t.pillarOffset,w),n.distanceTo(w)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(J=this.convexConvex(e,t.pillarConvex,n,w,r,o,l,h,null,null,g,b,null)),g&&J))return!0}}sphereParticle(e,t,n,i,r,o,l,h,u,f,g){const m=PY;if(m.set(0,0,1),i.vsub(n,m),m.lengthSquared()<=e.radius*e.radius){if(g)return!0;const v=this.createContactEquation(h,l,t,e,u,f);m.normalize(),v.rj.copy(m),v.rj.scale(e.radius,v.rj),v.ni.copy(m),v.ni.negate(v.ni),v.ri.set(0,0,0),this.result.push(v),this.createFrictionEquationsFromContact(v,this.frictionResult)}}planeParticle(e,t,n,i,r,o,l,h,u,f,g){const m=TY;m.set(0,0,1),l.quaternion.vmult(m,m);const A=IY;if(i.vsub(l.position,A),m.dot(A)<=0){if(g)return!0;const w=this.createContactEquation(h,l,t,e,u,f);w.ni.copy(m),w.ni.negate(w.ni),w.ri.set(0,0,0);const b=RY;m.scale(m.dot(i),b),i.vsub(b,b),w.rj.copy(b),this.result.push(w),this.createFrictionEquationsFromContact(w,this.frictionResult)}}boxParticle(e,t,n,i,r,o,l,h,u,f,g){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexParticle(e.convexPolyhedronRepresentation,t,n,i,r,o,l,h,e,t,g)}convexParticle(e,t,n,i,r,o,l,h,u,f,g){let m=-1;const A=LY,v=DY;let w=null;const b=BY;if(b.copy(i),b.vsub(n,b),r.conjugate($R),$R.vmult(b,b),e.pointIsInside(b)){e.worldVerticesNeedsUpdate&&e.computeWorldVertices(n,r),e.worldFaceNormalsNeedsUpdate&&e.computeWorldFaceNormals(r);for(let S=0,R=e.faces.length;S!==R;S++){const M=[e.worldVertices[e.faces[S][0]]],I=e.worldFaceNormals[S];i.vsub(M[0],eP);const T=-I.dot(eP);if(w===null||Math.abs(T)<Math.abs(w)){if(g)return!0;w=T,m=S,A.copy(I)}}if(m!==-1){const S=this.createContactEquation(h,l,t,e,u,f);A.scale(w,v),v.vadd(i,v),v.vsub(n,v),S.rj.copy(v),A.negate(S.ni),S.ri.set(0,0,0);const R=S.ri,M=S.rj;R.vadd(i,R),R.vsub(h.position,R),M.vadd(n,M),M.vsub(l.position,M),this.result.push(S),this.createFrictionEquationsFromContact(S,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}}heightfieldCylinder(e,t,n,i,r,o,l,h,u,f,g){return this.convexHeightfield(t,e,i,n,o,r,h,l,u,f,g)}particleCylinder(e,t,n,i,r,o,l,h,u,f,g){return this.convexParticle(t,e,i,n,o,r,h,l,u,f,g)}sphereTrimesh(e,t,n,i,r,o,l,h,u,f,g){const m=VX,A=WX,v=QX,w=jX,b=qX,S=XX,R=KX,M=HX,I=zX,T=$X;bi.pointToLocalFrame(i,o,n,b);const B=e.radius;R.lowerBound.set(b.x-B,b.y-B,b.z-B),R.upperBound.set(b.x+B,b.y+B,b.z+B),t.getTrianglesInAABB(R,T);const F=GX,D=e.radius*e.radius;for(let Q=0;Q<T.length;Q++)for(let Y=0;Y<3;Y++)if(t.getVertex(t.indices[T[Q]*3+Y],F),F.vsub(b,I),I.lengthSquared()<=D){if(M.copy(F),bi.pointToWorldFrame(i,o,M,F),F.vsub(n,I),g)return!0;let se=this.createContactEquation(l,h,e,t,u,f);se.ni.copy(I),se.ni.normalize(),se.ri.copy(se.ni),se.ri.scale(e.radius,se.ri),se.ri.vadd(n,se.ri),se.ri.vsub(l.position,se.ri),se.rj.copy(F),se.rj.vsub(h.position,se.rj),this.result.push(se),this.createFrictionEquationsFromContact(se,this.frictionResult)}for(let Q=0;Q<T.length;Q++)for(let Y=0;Y<3;Y++){t.getVertex(t.indices[T[Q]*3+Y],m),t.getVertex(t.indices[T[Q]*3+(Y+1)%3],A),A.vsub(m,v),b.vsub(A,S);const se=S.dot(v);b.vsub(m,S);let ae=S.dot(v);if(ae>0&&se<0&&(b.vsub(m,S),w.copy(v),w.normalize(),ae=S.dot(w),w.scale(ae,S),S.vadd(m,S),S.distanceTo(b)<e.radius)){if(g)return!0;const xe=this.createContactEquation(l,h,e,t,u,f);S.vsub(b,xe.ni),xe.ni.normalize(),xe.ni.scale(e.radius,xe.ri),xe.ri.vadd(n,xe.ri),xe.ri.vsub(l.position,xe.ri),bi.pointToWorldFrame(i,o,S,S),S.vsub(h.position,xe.rj),bi.vectorToWorldFrame(o,xe.ni,xe.ni),bi.vectorToWorldFrame(o,xe.ri,xe.ri),this.result.push(xe),this.createFrictionEquationsFromContact(xe,this.frictionResult)}}const U=YX,W=JX,J=ZX,ee=UX;for(let Q=0,Y=T.length;Q!==Y;Q++){t.getTriangleVertices(T[Q],U,W,J),t.getNormal(T[Q],ee),b.vsub(U,S);let se=S.dot(ee);if(ee.scale(se,S),b.vsub(S,S),se=S.distanceTo(b),Cs.pointInTriangle(S,U,W,J)&&se<e.radius){if(g)return!0;let ae=this.createContactEquation(l,h,e,t,u,f);S.vsub(b,ae.ni),ae.ni.normalize(),ae.ni.scale(e.radius,ae.ri),ae.ri.vadd(n,ae.ri),ae.ri.vsub(l.position,ae.ri),bi.pointToWorldFrame(i,o,S,S),S.vsub(h.position,ae.rj),bi.vectorToWorldFrame(o,ae.ni,ae.ni),bi.vectorToWorldFrame(o,ae.ri,ae.ri),this.result.push(ae),this.createFrictionEquationsFromContact(ae,this.frictionResult)}}T.length=0}planeTrimesh(e,t,n,i,r,o,l,h,u,f,g){const m=new re,A=FX;A.set(0,0,1),r.vmult(A,A);for(let v=0;v<t.vertices.length/3;v++){t.getVertex(v,m);const w=new re;w.copy(m),bi.pointToWorldFrame(i,o,w,m);const b=kX;if(m.vsub(n,b),A.dot(b)<=0){if(g)return!0;const R=this.createContactEquation(l,h,e,t,u,f);R.ni.copy(A);const M=NX;A.scale(b.dot(A),M),m.vsub(M,M),R.ri.copy(M),R.ri.vsub(l.position,R.ri),R.rj.copy(m),R.rj.vsub(h.position,R.rj),this.result.push(R),this.createFrictionEquationsFromContact(R,this.frictionResult)}}}}const qh=new re,Gd=new re,Hd=new re,BX=new re,LX=new re,DX=new hs,OX=new hs,FX=new re,kX=new re,NX=new re,UX=new re,zX=new re,GX=new re,HX=new re,VX=new re,WX=new re,QX=new re,jX=new re,qX=new re,XX=new re,YX=new re,JX=new re,ZX=new re,KX=new fo,$X=[],s_=new re,KR=new re,eY=new re,tY=new re,nY=new re;function iY(a,e,t){let n=null;const i=a.length;for(let r=0;r!==i;r++){const o=a[r],l=eY;a[(r+1)%i].vsub(o,l);const h=tY;l.cross(e,h);const u=nY;t.vsub(o,u);const f=h.dot(u);if(n===null||f>0&&n===!0||f<=0&&n===!1){n===null&&(n=f>0);continue}else return!1}return!0}const r_=new re,sY=new re,rY=new re,oY=new re,aY=[new re,new re,new re,new re,new re,new re],cY=new re,lY=new re,hY=new re,uY=new re,dY=new re,fY=new re,pY=new re,mY=new re,gY=new re,AY=new re,_Y=new re,yY=new re,vY=new re,xY=new re,wY=new re,bY=new re,EY=new re,CY=new re,SY=new re,MY=new re,TY=new re,IY=new re,RY=new re,PY=new re,$R=new hs,BY=new re,LY=new re,eP=new re,DY=new re,OY=new re,FY=new re,kY=[0],NY=new re,UY=new re;class tP{constructor(){this.current=void 0,this.previous=void 0,this.current=[],this.previous=[]}getKey(e,t){if(t<e){const n=t;t=e,e=n}return e<<16|t}set(e,t){const n=this.getKey(e,t),i=this.current;let r=0;for(;n>i[r];)r++;if(n!==i[r]){for(let o=i.length-1;o>=r;o--)i[o+1]=i[o];i[r]=n}}tick(){const e=this.current;this.current=this.previous,this.previous=e,this.current.length=0}getDiff(e,t){const n=this.current,i=this.previous,r=n.length,o=i.length;let l=0;for(let h=0;h<r;h++){let u=!1;const f=n[h];for(;f>i[l];)l++;u=f===i[l],u||nP(e,f)}l=0;for(let h=0;h<o;h++){let u=!1;const f=i[h];for(;f>n[l];)l++;u=n[l]===f,u||nP(t,f)}}}function nP(a,e){a.push((e&4294901760)>>16,e&65535)}class zY{constructor(){this.data={keys:[]}}get(e,t){if(e>t){const n=t;t=e,e=n}return this.data[e+"-"+t]}set(e,t,n){if(e>t){const r=t;t=e,e=r}const i=e+"-"+t;this.get(e,t)||this.data.keys.push(i),this.data[i]=n}reset(){const e=this.data,t=e.keys;for(;t.length>0;){const n=t.pop();delete e[n]}}}class GY extends F2{constructor(e={}){super(),this.dt=void 0,this.allowSleep=void 0,this.contacts=void 0,this.frictionEquations=void 0,this.quatNormalizeSkip=void 0,this.quatNormalizeFast=void 0,this.time=void 0,this.stepnumber=void 0,this.default_dt=void 0,this.nextId=void 0,this.gravity=void 0,this.broadphase=void 0,this.bodies=void 0,this.hasActiveBodies=void 0,this.solver=void 0,this.constraints=void 0,this.narrowphase=void 0,this.collisionMatrix=void 0,this.collisionMatrixPrevious=void 0,this.bodyOverlapKeeper=void 0,this.shapeOverlapKeeper=void 0,this.materials=void 0,this.contactmaterials=void 0,this.contactMaterialTable=void 0,this.defaultMaterial=void 0,this.defaultContactMaterial=void 0,this.doProfiling=void 0,this.profile=void 0,this.accumulator=void 0,this.subsystems=void 0,this.addBodyEvent=void 0,this.removeBodyEvent=void 0,this.idToBodyMap=void 0,this.dt=-1,this.allowSleep=!!e.allowSleep,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=e.quatNormalizeSkip!==void 0?e.quatNormalizeSkip:0,this.quatNormalizeFast=e.quatNormalizeFast!==void 0?e.quatNormalizeFast:!1,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new re,e.gravity&&this.gravity.copy(e.gravity),this.broadphase=e.broadphase!==void 0?e.broadphase:new O9,this.bodies=[],this.hasActiveBodies=!1,this.solver=e.solver!==void 0?e.solver:new CX,this.constraints=[],this.narrowphase=new PX(this),this.collisionMatrix=new GR,this.collisionMatrixPrevious=new GR,this.bodyOverlapKeeper=new tP,this.shapeOverlapKeeper=new tP,this.materials=[],this.contactmaterials=[],this.contactMaterialTable=new zY,this.defaultMaterial=new qy("default"),this.defaultContactMaterial=new jy(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.accumulator=0,this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.idToBodyMap={},this.broadphase.setWorld(this)}getContactMaterial(e,t){return this.contactMaterialTable.get(e.id,t.id)}numObjects(){return this.bodies.length}collisionMatrixTick(){const e=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=e,this.collisionMatrix.reset(),this.bodyOverlapKeeper.tick(),this.shapeOverlapKeeper.tick()}addConstraint(e){this.constraints.push(e)}removeConstraint(e){const t=this.constraints.indexOf(e);t!==-1&&this.constraints.splice(t,1)}rayTest(e,t,n){n instanceof fE?this.raycastClosest(e,t,{skipBackfaces:!0},n):this.raycastAll(e,t,{skipBackfaces:!0},n)}raycastAll(e,t,n={},i){return n.mode=Cs.ALL,n.from=e,n.to=t,n.callback=i,Zw.intersectWorld(this,n)}raycastAny(e,t,n={},i){return n.mode=Cs.ANY,n.from=e,n.to=t,n.result=i,Zw.intersectWorld(this,n)}raycastClosest(e,t,n={},i){return n.mode=Cs.CLOSEST,n.from=e,n.to=t,n.result=i,Zw.intersectWorld(this,n)}addBody(e){this.bodies.includes(e)||(e.index=this.bodies.length,this.bodies.push(e),e.world=this,e.initPosition.copy(e.position),e.initVelocity.copy(e.velocity),e.timeLastSleepy=this.time,e instanceof en&&(e.initAngularVelocity.copy(e.angularVelocity),e.initQuaternion.copy(e.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=e,this.idToBodyMap[e.id]=e,this.dispatchEvent(this.addBodyEvent))}removeBody(e){e.world=null;const t=this.bodies.length-1,n=this.bodies,i=n.indexOf(e);if(i!==-1){n.splice(i,1);for(let r=0;r!==n.length;r++)n[r].index=r;this.collisionMatrix.setNumObjects(t),this.removeBodyEvent.body=e,delete this.idToBodyMap[e.id],this.dispatchEvent(this.removeBodyEvent)}}getBodyById(e){return this.idToBodyMap[e]}getShapeById(e){const t=this.bodies;for(let n=0;n<t.length;n++){const i=t[n].shapes;for(let r=0;r<i.length;r++){const o=i[r];if(o.id===e)return o}}return null}addMaterial(e){this.materials.push(e)}addContactMaterial(e){this.contactmaterials.push(e),this.contactMaterialTable.set(e.materials[0].id,e.materials[1].id,e)}step(e,t,n=10){if(t===void 0)this.internalStep(e),this.time+=e;else{this.accumulator+=t;const i=Ws.now();let r=0;for(;this.accumulator>=e&&r<n&&(this.internalStep(e),this.accumulator-=e,r++,!(Ws.now()-i>e*1e3)););this.accumulator=this.accumulator%e;const o=this.accumulator/e;for(let l=0;l!==this.bodies.length;l++){const h=this.bodies[l];h.previousPosition.lerp(h.position,o,h.interpolatedPosition),h.previousQuaternion.slerp(h.quaternion,o,h.interpolatedQuaternion),h.previousQuaternion.normalize()}this.time+=t}}internalStep(e){this.dt=e;const t=this.contacts,n=jY,i=qY,r=this.numObjects(),o=this.bodies,l=this.solver,h=this.gravity,u=this.doProfiling,f=this.profile,g=en.DYNAMIC;let m=-1/0;const A=this.constraints,v=QY;h.length();const w=h.x,b=h.y,S=h.z;let R=0;for(u&&(m=Ws.now()),R=0;R!==r;R++){const Q=o[R];if(Q.type===g){const Y=Q.force,se=Q.mass;Y.x+=se*w,Y.y+=se*b,Y.z+=se*S}}for(let Q=0,Y=this.subsystems.length;Q!==Y;Q++)this.subsystems[Q].update();u&&(m=Ws.now()),n.length=0,i.length=0,this.broadphase.collisionPairs(this,n,i),u&&(f.broadphase=Ws.now()-m);let M=A.length;for(R=0;R!==M;R++){const Q=A[R];if(!Q.collideConnected)for(let Y=n.length-1;Y>=0;Y-=1)(Q.bodyA===n[Y]&&Q.bodyB===i[Y]||Q.bodyB===n[Y]&&Q.bodyA===i[Y])&&(n.splice(Y,1),i.splice(Y,1))}this.collisionMatrixTick(),u&&(m=Ws.now());const I=WY,T=t.length;for(R=0;R!==T;R++)I.push(t[R]);t.length=0;const B=this.frictionEquations.length;for(R=0;R!==B;R++)v.push(this.frictionEquations[R]);for(this.frictionEquations.length=0,this.narrowphase.getContacts(n,i,this,t,I,this.frictionEquations,v),u&&(f.narrowphase=Ws.now()-m),u&&(m=Ws.now()),R=0;R<this.frictionEquations.length;R++)l.addEquation(this.frictionEquations[R]);const F=t.length;for(let Q=0;Q!==F;Q++){const Y=t[Q],se=Y.bi,ae=Y.bj,ve=Y.si,xe=Y.sj;let Ae;if(se.material&&ae.material?Ae=this.getContactMaterial(se.material,ae.material)||this.defaultContactMaterial:Ae=this.defaultContactMaterial,Ae.friction,se.material&&ae.material&&(se.material.friction>=0&&ae.material.friction>=0&&se.material.friction*ae.material.friction,se.material.restitution>=0&&ae.material.restitution>=0&&(Y.restitution=se.material.restitution*ae.material.restitution)),l.addEquation(Y),se.allowSleep&&se.type===en.DYNAMIC&&se.sleepState===en.SLEEPING&&ae.sleepState===en.AWAKE&&ae.type!==en.STATIC){const Me=ae.velocity.lengthSquared()+ae.angularVelocity.lengthSquared(),Be=ae.sleepSpeedLimit**2;Me>=Be*2&&(se.wakeUpAfterNarrowphase=!0)}if(ae.allowSleep&&ae.type===en.DYNAMIC&&ae.sleepState===en.SLEEPING&&se.sleepState===en.AWAKE&&se.type!==en.STATIC){const Me=se.velocity.lengthSquared()+se.angularVelocity.lengthSquared(),Be=se.sleepSpeedLimit**2;Me>=Be*2&&(ae.wakeUpAfterNarrowphase=!0)}this.collisionMatrix.set(se,ae,!0),this.collisionMatrixPrevious.get(se,ae)||($p.body=ae,$p.contact=Y,se.dispatchEvent($p),$p.body=se,ae.dispatchEvent($p)),this.bodyOverlapKeeper.set(se.id,ae.id),this.shapeOverlapKeeper.set(ve.id,xe.id)}for(this.emitContactEvents(),u&&(f.makeContactConstraints=Ws.now()-m,m=Ws.now()),R=0;R!==r;R++){const Q=o[R];Q.wakeUpAfterNarrowphase&&(Q.wakeUp(),Q.wakeUpAfterNarrowphase=!1)}for(M=A.length,R=0;R!==M;R++){const Q=A[R];Q.update();for(let Y=0,se=Q.equations.length;Y!==se;Y++){const ae=Q.equations[Y];l.addEquation(ae)}}l.solve(e,this),u&&(f.solve=Ws.now()-m),l.removeAllEquations();const D=Math.pow;for(R=0;R!==r;R++){const Q=o[R];if(Q.type&g){const Y=D(1-Q.linearDamping,e),se=Q.velocity;se.scale(Y,se);const ae=Q.angularVelocity;if(ae){const ve=D(1-Q.angularDamping,e);ae.scale(ve,ae)}}}for(this.dispatchEvent(VY),R=0;R!==r;R++){const Q=o[R];Q.preStep&&Q.preStep.call(Q)}u&&(m=Ws.now());const W=this.stepnumber%(this.quatNormalizeSkip+1)===0,J=this.quatNormalizeFast;for(R=0;R!==r;R++)o[R].integrate(e,W,J);for(this.clearForces(),this.broadphase.dirty=!0,u&&(f.integrate=Ws.now()-m),this.stepnumber+=1,this.dispatchEvent(HY),R=0;R!==r;R++){const Q=o[R],Y=Q.postStep;Y&&Y.call(Q)}let ee=!0;if(this.allowSleep)for(ee=!1,R=0;R!==r;R++){const Q=o[R];Q.sleepTick(this.time),Q.sleepState!==en.SLEEPING&&(ee=!0)}this.hasActiveBodies=ee}emitContactEvents(){const e=this.hasAnyEventListener("beginContact"),t=this.hasAnyEventListener("endContact");if((e||t)&&this.bodyOverlapKeeper.getDiff(mc,gc),e){for(let r=0,o=mc.length;r<o;r+=2)em.bodyA=this.getBodyById(mc[r]),em.bodyB=this.getBodyById(mc[r+1]),this.dispatchEvent(em);em.bodyA=em.bodyB=null}if(t){for(let r=0,o=gc.length;r<o;r+=2)tm.bodyA=this.getBodyById(gc[r]),tm.bodyB=this.getBodyById(gc[r+1]),this.dispatchEvent(tm);tm.bodyA=tm.bodyB=null}mc.length=gc.length=0;const n=this.hasAnyEventListener("beginShapeContact"),i=this.hasAnyEventListener("endShapeContact");if((n||i)&&this.shapeOverlapKeeper.getDiff(mc,gc),n){for(let r=0,o=mc.length;r<o;r+=2){const l=this.getShapeById(mc[r]),h=this.getShapeById(mc[r+1]);Ac.shapeA=l,Ac.shapeB=h,l&&(Ac.bodyA=l.body),h&&(Ac.bodyB=h.body),this.dispatchEvent(Ac)}Ac.bodyA=Ac.bodyB=Ac.shapeA=Ac.shapeB=null}if(i){for(let r=0,o=gc.length;r<o;r+=2){const l=this.getShapeById(gc[r]),h=this.getShapeById(gc[r+1]);_c.shapeA=l,_c.shapeB=h,l&&(_c.bodyA=l.body),h&&(_c.bodyB=h.body),this.dispatchEvent(_c)}_c.bodyA=_c.bodyB=_c.shapeA=_c.shapeB=null}}clearForces(){const e=this.bodies,t=e.length;for(let n=0;n!==t;n++){const i=e[n];i.force,i.torque,i.force.set(0,0,0),i.torque.set(0,0,0)}}}new fo;const Zw=new Cs,Ws=globalThis.performance||{};if(!Ws.now){let a=Date.now();Ws.timing&&Ws.timing.navigationStart&&(a=Ws.timing.navigationStart),Ws.now=()=>Date.now()-a}const HY={type:"postStep"},VY={type:"preStep"},$p={type:en.COLLIDE_EVENT_NAME,body:null,contact:null},WY=[],QY=[],jY=[],qY=[],mc=[],gc=[],em={type:"beginContact",bodyA:null,bodyB:null},tm={type:"endContact",bodyA:null,bodyB:null},Ac={type:"beginShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null},_c={type:"endShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null};function XY(a,e,{color:t=65280,scale:n=1,onInit:i,onUpdate:r,autoUpdate:o}={}){const l=[],h=new Hi({color:t!=null?t:65280,wireframe:!0}),u=new re,f=new re,g=new re,m=new hs,A=new ho(1),v=new Ui(1,1,1),w=new lo(10,10,10,10);function b(D){const U=new Sn,W=[];for(let ee=0;ee<D.vertices.length;ee++){const Q=D.vertices[ee];W.push(Q.x,Q.y,Q.z)}U.setAttribute("position",new tn(W,3));const J=[];for(let ee=0;ee<D.faces.length;ee++){const Q=D.faces[ee],Y=Q[0];for(let se=1;se<Q.length-1;se++){const ae=Q[se],ve=Q[se+1];J.push(Y,ae,ve)}}return U.setIndex(J),U.computeBoundingSphere(),U.computeVertexNormals(),U}function S(D){const U=new Sn,W=[],J=u,ee=f,Q=g;for(let Y=0;Y<D.indices.length/3;Y++)D.getTriangleVertices(Y,J,ee,Q),W.push(J.x,J.y,J.z),W.push(ee.x,ee.y,ee.z),W.push(Q.x,Q.y,Q.z);return U.setAttribute("position",new tn(W,3)),U.computeBoundingSphere(),U.computeVertexNormals(),U}function R(D){const U=new Sn,W=D.elementSize||1,J=D.data.flatMap((Q,Y)=>Q.flatMap((se,ae)=>[Y*W,ae*W,se])),ee=[];for(let Q=0;Q<D.data.length-1;Q++)for(let Y=0;Y<D.data[Q].length-1;Y++){const se=D.data[Q].length,ae=Q*se+Y;ee.push(ae+1,ae+se,ae+se+1),ee.push(ae+se,ae+1,ae)}return U.setIndex(ee),U.setAttribute("position",new tn(J,3)),U.computeBoundingSphere(),U.computeVertexNormals(),U}function M(D){let U=new _t;const{SPHERE:W,BOX:J,PLANE:ee,CYLINDER:Q,CONVEXPOLYHEDRON:Y,TRIMESH:se,HEIGHTFIELD:ae}=rn.types;switch(D.type){case W:{U=new _t(A,h);break}case J:{U=new _t(v,h);break}case ee:{U=new _t(w,h);break}case Q:{const ve=new cs(D.radiusTop,D.radiusBottom,D.height,D.numSegments);U=new _t(ve,h),D.geometryId=ve.id;break}case Y:{const ve=b(D);U=new _t(ve,h),D.geometryId=ve.id;break}case se:{const ve=S(D);U=new _t(ve,h),D.geometryId=ve.id;break}case ae:{const ve=R(D);U=new _t(ve,h),D.geometryId=ve.id;break}}return a.add(U),U}function I(D,U){const{SPHERE:W,BOX:J,PLANE:ee,CYLINDER:Q,CONVEXPOLYHEDRON:Y,TRIMESH:se,HEIGHTFIELD:ae}=rn.types;switch(U.type){case W:{const{radius:ve}=U;D.scale.set(ve*n,ve*n,ve*n);break}case J:{D.scale.copy(U.halfExtents),D.scale.multiplyScalar(2*n);break}case ee:break;case Q:{D.scale.set(1*n,1*n,1*n);break}case Y:{D.scale.set(1*n,1*n,1*n);break}case se:{D.scale.copy(U.scale).multiplyScalar(n);break}case ae:{D.scale.set(1*n,1*n,1*n);break}}}function T(D,U){if(!D)return!1;const{geometry:W}=D;return W instanceof ho&&U.type===rn.types.SPHERE||W instanceof Ui&&U.type===rn.types.BOX||W instanceof lo&&U.type===rn.types.PLANE||W.id===U.geometryId&&U.type===rn.types.CYLINDER||W.id===U.geometryId&&U.type===rn.types.CONVEXPOLYHEDRON||W.id===U.geometryId&&U.type===rn.types.TRIMESH||W.id===U.geometryId&&U.type===rn.types.HEIGHTFIELD}function B(D,U){let W=l[D],J=!1;return T(W,U)||(W&&a.remove(W),l[D]=W=M(U),J=!0),I(W,U),J}function F(){const D=l,U=u,W=m;let J=0;for(const ee of e)for(let Q=0;Q!==ee.shapes.length;Q++){const Y=ee.shapes[Q],se=B(J,Y),ae=D[J];ae&&(ee.quaternion.vmult(ee.shapeOffsets[Q],U),ee.position.vadd(U,U),ee.quaternion.mult(ee.shapeOrientations[Q],W),ae.position.copy(U),ae.quaternion.copy(W),se&&i instanceof Function&&i(ee,ae,Y),!se&&r instanceof Function&&r(ee,ae,Y)),J++}for(let ee=J;ee<D.length;ee++){const Q=D[ee];Q&&a.remove(Q)}D.length=J,o!==!1&&requestAnimationFrame(F)}return o!==!1&&requestAnimationFrame(F),{update:F}}class ty{constructor(e,t){E(this,"lightmapIndex",-1);E(this,"lightmapScaleOffset",new On(1,1,0,0));E(this,"context");E(this,"gameObject");E(this,"lightmapTexture",null);E(this,"lightmapScaleOffsetUniform",{value:new On(1,1,0,0)});E(this,"lightmapUniform",{value:null});E(this,"beforeRenderCallback");this.gameObject=e,this.context=t}get lightmap(){return this.lightmapTexture}set lightmap(e){e!==this.lightmapTexture&&(this.lightmapTexture=e,this.setupLightmap())}init(e,t,n,i=!1){if(console.assert(this.gameObject!==void 0&&this.gameObject!==null,"Missing gameobject",this),this.lightmapIndex=e,this.lightmapIndex<0)return;this.lightmapScaleOffset=t,this.lightmapTexture=n,i&&this.setLightmapDebugMaterial(),this.setupLightmap()}bindOnBeforeRender(){this.beforeRenderCallback=this.onBeforeRenderThreeComplete.bind(this),this.context.addBeforeRenderListener(this.gameObject,this.beforeRenderCallback)}onBeforeRenderThreeComplete(e,t,n,i,r,o){this.onBeforeRenderThree(r)}setupLightmap(){if(this.gameObject.type==="Object3D")return;if(this.gameObject.type==="Group"){console.warn("Lightmap on multimaterial object is not supported yet... please ask kindly for implementation.");return}console.assert(this.gameObject.type==="Mesh","Lightmap only works on meshes",this);const e=this.gameObject;e.geometry.getAttribute("uv2")||e.geometry.setAttribute("uv2",e.geometry.getAttribute("uv"));const t=this.gameObject.material.clone();if(this.gameObject.material=t,this.gameObject.material.onBeforeCompile=(n,i)=>{n.uniforms.lightmap=this.lightmapUniform,n.uniforms.lightmapScaleOffset=this.lightmapScaleOffsetUniform},this.lightmapIndex>=0){const n=this.lightmapTexture,i=this.gameObject.material;i&&n&&(i.uniforms||(i.uniforms={}),i.lightMap=n,i.uniforms.lightmap={value:n})}}onBeforeRenderThree(e){const t=e.uniforms;t&&t.lightmap&&(this.lightmapScaleOffsetUniform.value=this.lightmapScaleOffset,this.lightmapUniform.value=this.lightmapTexture,t.lightmap=this.lightmapUniform,t.lightmapScaleOffset=this.lightmapScaleOffsetUniform)}setLightmapDebugMaterial(){this.gameObject.material=new nr({vertexShader:`
                attribute vec2 uv2;
                varying vec2 vUv2;
                void main()
                {
                    vUv2 = uv2;
                    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
                }
                `,fragmentShader:`
                uniform sampler2D lightmap;
                uniform float lightMapIntensity;
                uniform vec4 lightmapScaleOffset;
                varying vec2 vUv2;

                // took from threejs 05fc79cd52b79e8c3e8dec1e7dca72c5c39983a4
                vec4 conv_sRGBToLinear( in vec4 value ) {
                    return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
                }

                void main() {
                    vec2 lUv = vUv2.xy * lightmapScaleOffset.xy + vec2(lightmapScaleOffset.z, (1. - (lightmapScaleOffset.y + lightmapScaleOffset.w)));
                    
                    vec4 lightMapTexel = texture2D( lightmap, lUv);
                    // The range of RGBM lightmaps goes from 0 to 34.49 (5^2.2) in linear space, and from 0 to 5 in gamma space.
                    //lightMapTexel.rgb *= lightMapTexel.a * 8.; // no idea where that "8" comes from... heuristically derived
                    //lightMapTexel.a = 1.;
                    //lightMapTexel = conv_sRGBToLinear(lightMapTexel);
                    // lightMapTexel.rgb = vec3(1.);

                    // gl_FragColor = vec4(vUv2.xy, 0, 1);
                    gl_FragColor = lightMapTexel;
                }
                `,defines:{USE_LIGHTMAP:""}})}}const Re=function(a){if(a===void 0&&(a=null),!Array.isArray(a))a=iP(a);else for(let e=0;e<a.length;e++){const t=a[e];a[e]=iP(t)}return function(e,t){Object.getOwnPropertyDescriptor(e,"$serializedTypes")||(e.$serializedTypes={});const n=e.$serializedTypes=e.$serializedTypes||{};n[t]=a}};function iP(a){var e,t;switch((t=(e=a==null?void 0:a.prototype)==null?void 0:e.constructor)==null?void 0:t.name){case"Number":case"String":case"Boolean":return null}return a}const Kw=jt("debugstencil");function YY(a,e){return(a&1<<e.layer)!=0}const cu=class{constructor(e,t){E(this,"parser");E(this,"source");this.parser=e,this.source=t}static applyStencil(e){var i;if(!e)return;const t=e.sourceId;if(Kw&&console.log(t,cu.stencils),!t)return;const n=cu.stencils[t];if(!!n)for(let r=n.length-1;r>=0;r--){const o=n[r];if(YY(o.layer,e)){Kw&&console.log(o);const l=(i=e.material)==null?void 0:i.clone();l&&(e.material=l,e.gameObject.renderOrder=o.event*1e3+o.index*50,l.stencilWrite=!0,l.stencilWriteMask=255,l.stencilFuncMask=255,l.stencilRef=o.value,l.stencilFunc=o.compareFunc,l.stencilZPass=o.passOp,l.stencilFail=o.failOp,l.stencilZFail=o.zFailOp);break}}}afterRoot(e){const t=this.parser.json.extensions;if(t){const n=t[ZY];if(n){Kw&&console.log(n);const i=n.stencil;if(i&&Array.isArray(i))for(const r of i){const o={...r};o.compareFunc=JY(o.compareFunc),o.passOp=$w(o.passOp),o.failOp=$w(o.failOp),o.zFailOp=$w(o.zFailOp),cu.stencils[this.source]||(cu.stencils[this.source]=[]),cu.stencils[this.source].push(o)}}}return null}};let Rm=cu;E(Rm,"stencils",{});function $w(a){switch(a){case 0:return Em;case 1:return dL;case 2:return fL;case 3:return pL;case 4:return mL;case 6:return gL;case 7:return AL;case 5:return _L}return 0}function JY(a){switch(a){case 1:return yL;case 2:return vL;case 3:return xL;case 4:return wL;case 5:return bL;case 6:return EL;case 7:return CL;case 8:return aC}return 0}const ZY="NEEDLE_render_objects";class Df extends mr{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.animationPointerResolver=null,this.pluginCallbacks=[],this.register(function(t){return new n7(t)}),this.register(function(t){return new h7(t)}),this.register(function(t){return new u7(t)}),this.register(function(t){return new r7(t)}),this.register(function(t){return new o7(t)}),this.register(function(t){return new a7(t)}),this.register(function(t){return new c7(t)}),this.register(function(t){return new t7(t)}),this.register(function(t){return new l7(t)}),this.register(function(t){return new s7(t)}),this.register(function(t){return new $Y(t)}),this.register(function(t){return new d7(t)}),this.register(function(t){return new i7(t)})}load(e,t,n,i){const r=this;let o;this.resourcePath!==""?o=this.resourcePath:this.path!==""?o=this.path:o=za.extractUrlBase(e),this.manager.itemStart(e);const l=function(u){i?i(u):console.error(u),r.manager.itemError(e),r.manager.itemEnd(e)},h=new Fs(this.manager);h.setPath(this.path),h.setResponseType("arraybuffer"),h.setRequestHeader(this.requestHeader),h.setWithCredentials(this.withCredentials),h.load(e,function(u){try{r.parse(u,o,function(f){t(f),r.manager.itemEnd(e)},l)}catch(f){l(f)}},n,l)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}setAnimationPointerResolver(e){return this.animationPointerResolver=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,i){let r;const o={},l={};if(typeof e=="string")r=e;else if(za.decodeText(new Uint8Array(e,0,4))===mD){try{o[Xn.KHR_BINARY_GLTF]=new f7(e)}catch(g){i&&i(g);return}r=o[Xn.KHR_BINARY_GLTF].content}else r=za.decodeText(new Uint8Array(e));const h=JSON.parse(r);if(h.asset===void 0||h.asset.version[0]<2){i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const u=new C7(h,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder,animationPointerResolver:this.animationPointerResolver});u.fileLoader.setRequestHeader(this.requestHeader);for(let f=0;f<this.pluginCallbacks.length;f++){const g=this.pluginCallbacks[f](u);l[g.name]=g,o[g.name]=!0}if(h.extensionsUsed)for(let f=0;f<h.extensionsUsed.length;++f){const g=h.extensionsUsed[f],m=h.extensionsRequired||[];switch(g){case Xn.KHR_MATERIALS_UNLIT:o[g]=new e7;break;case Xn.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:o[g]=new g7;break;case Xn.KHR_DRACO_MESH_COMPRESSION:o[g]=new p7(h,this.dracoLoader);break;case Xn.KHR_TEXTURE_TRANSFORM:o[g]=new m7;break;case Xn.KHR_MESH_QUANTIZATION:o[g]=new A7;break;default:m.indexOf(g)>=0&&l[g]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+g+'".')}}u.setExtensions(o),u.setPlugins(l),u.parse(n,i)}parseAsync(e,t){const n=this;return new Promise(function(i,r){n.parse(e,t,i,r)})}}function KY(){let a={};return{get:function(e){return a[e]},add:function(e,t){a[e]=t},remove:function(e){delete a[e]},removeAll:function(){a={}}}}const Xn={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",KHR_ANIMATION_POINTER:"KHR_animation_pointer",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class $Y{constructor(e){this.parser=e,this.name=Xn.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,i=t.length;n<i;n++){const r=t[n];r.extensions&&r.extensions[this.name]&&r.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let i=t.cache.get(n);if(i)return i;const r=t.json,h=((r.extensions&&r.extensions[this.name]||{}).lights||[])[e];let u;const f=new _e(16777215);h.color!==void 0&&f.fromArray(h.color);const g=h.range!==void 0?h.range:0;switch(h.type){case"directional":u=new zy(f),u.target.position.set(0,0,-1),u.add(u.target);break;case"point":u=new Uy(f),u.distance=g;break;case"spot":u=new Ny(f),u.distance=g,h.spot=h.spot||{},h.spot.innerConeAngle=h.spot.innerConeAngle!==void 0?h.spot.innerConeAngle:0,h.spot.outerConeAngle=h.spot.outerConeAngle!==void 0?h.spot.outerConeAngle:Math.PI/4,u.angle=h.spot.outerConeAngle,u.penumbra=1-h.spot.innerConeAngle/h.spot.outerConeAngle,u.target.position.set(0,0,-1),u.add(u.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+h.type)}return u.position.set(0,0,0),u.decay=2,h.intensity!==void 0&&(u.intensity=h.intensity),u.name=t.createUniqueName(h.name||"light_"+e),i=Promise.resolve(u),t.cache.add(n,i),i}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,n=this.parser,r=n.json.nodes[e],l=(r.extensions&&r.extensions[this.name]||{}).light;return l===void 0?null:this._loadLight(l).then(function(h){return n._getNodeRef(t.cache,l,h)})}}class e7{constructor(){this.name=Xn.KHR_MATERIALS_UNLIT}getMaterialType(){return Hi}extendParams(e,t,n){const i=[];e.color=new _e(1,1,1),e.opacity=1;const r=t.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){const o=r.baseColorFactor;e.color.fromArray(o),e.opacity=o[3]}r.baseColorTexture!==void 0&&i.push(n.assignTexture(e,"map",r.baseColorTexture,Gn))}return Promise.all(i)}}class t7{constructor(e){this.parser=e,this.name=Xn.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=i.extensions[this.name].emissiveStrength;return r!==void 0&&(t.emissiveIntensity=r),Promise.resolve()}}class n7{constructor(e){this.parser=e,this.name=Xn.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Vc}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],o=i.extensions[this.name];if(o.clearcoatFactor!==void 0&&(t.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&r.push(n.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&r.push(n.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(r.push(n.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const l=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new Xe(l,l)}return Promise.all(r)}}class i7{constructor(e){E(this,"ANIMATION_TARGET_TYPE",{node:"node",material:"material",camera:"camera",light:"light"});E(this,"_animationPointerDebug",!1);E(this,"_havePatchedPropertyBindings",!1);this.parser=e,this.name=Xn.KHR_ANIMATION_POINTER}_patchPropertyBindingFindNode(){if(this._havePatchedPropertyBindings)return;this._havePatchedPropertyBindings=!0;const e=ni.findNode;ni.findNode=(t,n)=>{if(n.startsWith(".materials.")){this._animationPointerDebug&&console.log("FIND",n);const i=n.substring(11).substring(n.indexOf(".")),r=i.indexOf("."),o=r<0?i:i.substring(0,r);let l=null;return t.traverse(h=>{var u,f;l!==null||h.type!=="Mesh"||(((u=h.material)==null?void 0:u.uuid)===o||((f=h.material)==null?void 0:f.name)===o)&&(l=h.material,this._animationPointerDebug&&console.log(l,i),l!==null&&(i.endsWith(".map")?l=l.map:i.endsWith(".emissiveMap")&&(l=l.emissiveMap)))}),l}else if(n.startsWith(".nodes.")||n.startsWith(".lights.")||n.startsWith(".cameras.")){const i=n.split(".");let r;for(let o=1;o<i.length;o++){const l=i[o];if(l.length==36)r=t.getObjectByProperty("uuid",l);else if(r&&r[l]){const u=Number.parseInt(l);let f=l;u>=0&&(f=u),r=r[f],this._animationPointerDebug&&console.log(r)}else{const u=t.getObjectByName(l);u&&(r=u)}}if(!r){const o=e(t,i[2]);return o||console.error("not found",n,t,t.name,i),o}return this._animationPointerDebug&&console.log("NODE",n,r),r}return e(t,n)}}loadAnimationTargetFromChannel(e){this._havePatchedPropertyBindings||this._patchPropertyBindingFindNode();const t=e.target,n=t.extensions&&t.extensions[Xn.KHR_ANIMATION_POINTER]&&t.path&&t.path==="pointer";if(!n)return null;let i,r=this.ANIMATION_TARGET_TYPE.node,o;if(n){const h=t.extensions[Xn.KHR_ANIMATION_POINTER];let u=h.pointer;if(this._animationPointerDebug&&console.log("Original path: "+u,t),!u){console.warn("Invalid path",h,t);return}if(u.startsWith("/materials/")?r=this.ANIMATION_TARGET_TYPE.material:u.startsWith("/extensions/KHR_lights_punctual/lights/")?r=this.ANIMATION_TARGET_TYPE.light:u.startsWith("/cameras/")&&(r=this.ANIMATION_TARGET_TYPE.camera),o=this._tryResolveTargetId(u,r),o===null||isNaN(o)){console.warn("Failed resolving animation node id: "+o,u);return}else this._animationPointerDebug&&console.log("Resolved node ID for "+r,o);switch(r){case this.ANIMATION_TARGET_TYPE.material:const g=("/materials/"+o.toString()+"/").length,m=u.substring(0,g);switch(i=u.substring(g),i){case"pbrMetallicRoughness/baseColorFactor":i="color";break;case"pbrMetallicRoughness/roughnessFactor":i="roughness";break;case"pbrMetallicRoughness/metallicFactor":i="metalness";break;case"emissiveFactor":i="emissive";break;case"alphaCutoff":i="alphaTest";break;case"occlusionTexture/strength":i="aoMapIntensity";break;case"normalTexture/scale":i="normalScale";break;case"pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale":i="map/repeat";break;case"pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset":i="map/offset";break;case"emissiveTexture/extensions/KHR_texture_transform/scale":i="emissiveMap/repeat";break;case"emissiveTexture/extensions/KHR_texture_transform/offset":i="emissiveMap/offset";break;case"extensions/KHR_materials_emissive_strength/emissiveStrength":i="emissiveIntensity";break;case"extensions/KHR_materials_transmission/transmissionFactor":i="transmission";break;case"extensions/KHR_materials_ior/ior":i="ior";break;case"extensions/KHR_materials_volume/thicknessFactor":i="thickness";break;case"extensions/KHR_materials_volume/attenuationColor":i="attenuationColor";break;case"extensions/KHR_materials_volume/attenuationDistance":i="attenuationDistance";break;case"extensions/KHR_materials_iridescence/iridescenceFactor":i="iridescence";break;case"extensions/KHR_materials_iridescence/iridescenceIor":i="iridescenceIOR";break;case"extensions/KHR_materials_iridescence/iridescenceThicknessMinimum":i="iridescenceThicknessRange[0]";break;case"extensions/KHR_materials_iridescence/iridescenceThicknessMaximum":i="iridescenceThicknessRange[1]";break;case"extensions/KHR_materials_clearcoat/clearcoatFactor":i="clearcoat";break;case"extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor":i="clearcoatRoughness";break;case"extensions/KHR_materials_sheen/sheenColorFactor":i="sheenColor";break;case"extensions/KHR_materials_sheen/sheenRoughnessFactor":i="sheenRoughness";break;case"extensions/KHR_materials_specular/specularFactor":i="specularIntensity";break;case"extensions/KHR_materials_specular/specularColorFactor":i="specularColor";break}u=m+i,this._animationPointerDebug&&console.log("PROPERTY PATH",m,i,u);break;case this.ANIMATION_TARGET_TYPE.node:const A=("/nodes/"+o.toString()+"/").length,v=u.substring(0,A);switch(i=u.substring(A),i){case"translation":i="position";break;case"rotation":i="quaternion";break;case"scale":i="scale";break;case"weights":i="morphTargetInfluences";break}u=v+i;break;case this.ANIMATION_TARGET_TYPE.light:const w=("/extensions/KHR_lights_punctual/lights/"+o.toString()+"/").length;switch(i=u.substring(w),i){case"color":break;case"intensity":break;case"spot/innerConeAngle":i="penumbra";break;case"spot/outerConeAngle":i="angle";break;case"range":i="distance";break}u="/lights/"+o.toString()+"/"+i;break;case this.ANIMATION_TARGET_TYPE.camera:const b=("/cameras/"+o.toString()+"/").length,S=u.substring(0,b);switch(i=u.substring(b),i){case"perspective/yfov":i="fov";break;case"perspective/znear":case"orthographic/znear":i="near";break;case"perspective/zfar":case"orthographic/zfar":i="far";break;case"perspective/aspect":i="aspect";break;case"orthographic/xmag":i="zoom";break;case"orthographic/ymag":i="zoom";break}u=S+i;break}const f=this.parser.options.animationPointerResolver;f&&f.resolvePath&&(u=f.resolvePath(u)),t.extensions[Xn.KHR_ANIMATION_POINTER].pointer=u}if(o===null||isNaN(o)){console.warn("Failed resolving animation node id: "+o,t);return}let l;return r===this.ANIMATION_TARGET_TYPE.node?l=this.parser.getDependency("node",o):r===this.ANIMATION_TARGET_TYPE.material?l=this.parser.getDependency("material",o):r===this.ANIMATION_TARGET_TYPE.light?l=this.parser.getDependency("light",o):r===this.ANIMATION_TARGET_TYPE.camera?l=this.parser.getDependency("camera",o):console.error("Unhandled type",r),l}getDependency(e,t){}createAnimationTracks(e,t,n,i,r){var v;if(!(r.extensions&&r.extensions[Xn.KHR_ANIMATION_POINTER]&&r.path&&r.path==="pointer"))return null;let l=r.extensions[Xn.KHR_ANIMATION_POINTER].pointer;if(!l)return null;const h=[];l=l.replaceAll("/",".");const u=l.split(".");u[2]=(v=e.name)!=null?v:e.uuid,l=u.join("."),this._animationPointerDebug&&console.log(e,t,n,r,l);let f;switch(n.itemSize){case 1:f=Jl;break;case 2:case 3:f=Zl;break;case 4:l.endsWith(".quaternion")?f=ja:f=Rg;break}const g=i.interpolation!==void 0?AD[i.interpolation]:kc;let m=_D(n);l.endsWith(".fov")&&(m=m.map(w=>w/Math.PI*180));const A=new f(l,t.array,m,g);if(g==="CUBICSPLINE"&&AE(A),h.push(A),l&&n.itemSize===4&&l.startsWith(".materials.")&&l.endsWith(".color")){const w=new Float32Array(m.length/4);for(let S=0,R=m.length/4;S<R;S+=1)w[S]=m[S*4+3];const b=new f(l.replace(".color",".opacity"),t.array,w,g);g==="CUBICSPLINE"&&AE(A),h.push(b)}return h}_tryResolveTargetId(e,t){let n="";return t==="node"?n=e.substring(7):t==="material"?n=e.substring(11):t==="light"?n=e.substring(39):t==="camera"&&(n=e.substring(9)),n=n.substring(0,n.indexOf("/")),Number.parseInt(n)}}class s7{constructor(e){this.parser=e,this.name=Xn.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Vc}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],o=i.extensions[this.name];return o.iridescenceFactor!==void 0&&(t.iridescence=o.iridescenceFactor),o.iridescenceTexture!==void 0&&r.push(n.assignTexture(t,"iridescenceMap",o.iridescenceTexture)),o.iridescenceIor!==void 0&&(t.iridescenceIOR=o.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),o.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),o.iridescenceThicknessTexture!==void 0&&r.push(n.assignTexture(t,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(r)}}class r7{constructor(e){this.parser=e,this.name=Xn.KHR_MATERIALS_SHEEN}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Vc}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[];t.sheenColor=new _e(0,0,0),t.sheenRoughness=0,t.sheen=1;const o=i.extensions[this.name];return o.sheenColorFactor!==void 0&&t.sheenColor.fromArray(o.sheenColorFactor),o.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&r.push(n.assignTexture(t,"sheenColorMap",o.sheenColorTexture,Gn)),o.sheenRoughnessTexture!==void 0&&r.push(n.assignTexture(t,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(r)}}class o7{constructor(e){this.parser=e,this.name=Xn.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Vc}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],o=i.extensions[this.name];return o.transmissionFactor!==void 0&&(t.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&r.push(n.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(r)}}class a7{constructor(e){this.parser=e,this.name=Xn.KHR_MATERIALS_VOLUME}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Vc}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],o=i.extensions[this.name];t.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&r.push(n.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||1/0;const l=o.attenuationColor||[1,1,1];return t.attenuationColor=new _e(l[0],l[1],l[2]),Promise.all(r)}}class c7{constructor(e){this.parser=e,this.name=Xn.KHR_MATERIALS_IOR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Vc}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=i.extensions[this.name];return t.ior=r.ior!==void 0?r.ior:1.5,Promise.resolve()}}class l7{constructor(e){this.parser=e,this.name=Xn.KHR_MATERIALS_SPECULAR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Vc}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],o=i.extensions[this.name];t.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&r.push(n.assignTexture(t,"specularIntensityMap",o.specularTexture));const l=o.specularColorFactor||[1,1,1];return t.specularColor=new _e(l[0],l[1],l[2]),o.specularColorTexture!==void 0&&r.push(n.assignTexture(t,"specularColorMap",o.specularColorTexture,Gn)),Promise.all(r)}}class h7{constructor(e){this.parser=e,this.name=Xn.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,i=n.textures[e];if(!i.extensions||!i.extensions[this.name])return null;const r=i.extensions[this.name],o=t.options.ktx2Loader;if(!o){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,r.source,o)}}class u7{constructor(e){this.parser=e,this.name=Xn.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,i=n.json,r=i.textures[e];if(!r.extensions||!r.extensions[t])return null;const o=r.extensions[t],l=i.images[o.source];let h=n.textureLoader;if(l.uri){const u=n.options.manager.getHandler(l.uri);u!==null&&(h=u)}return this.detectSupport().then(function(u){if(u)return n.loadTextureImage(e,o.source,h);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class d7{constructor(e){this.name=Xn.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const i=n.extensions[this.name],r=this.parser.getDependency("buffer",i.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return r.then(function(l){const h=i.byteOffset||0,u=i.byteLength||0,f=i.count,g=i.byteStride,m=new Uint8Array(l,h,u);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(f,g,m,i.mode,i.filter).then(function(A){return A.buffer}):o.ready.then(function(){const A=new ArrayBuffer(f*g);return o.decodeGltfBuffer(new Uint8Array(A),f,g,m,i.mode,i.filter),A})})}else return null}}const mD="glTF",nm=12,sP={JSON:1313821514,BIN:5130562};class f7{constructor(e){this.name=Xn.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,nm);if(this.header={magic:za.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==mD)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-nm,i=new DataView(e,nm);let r=0;for(;r<n;){const o=i.getUint32(r,!0);r+=4;const l=i.getUint32(r,!0);if(r+=4,l===sP.JSON){const h=new Uint8Array(e,nm+r,o);this.content=za.decodeText(h)}else if(l===sP.BIN){const h=nm+r;this.body=e.slice(h,h+o)}r+=o}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class p7{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Xn.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,i=this.dracoLoader,r=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,l={},h={},u={};for(const f in o){const g=mE[f]||f.toLowerCase();l[g]=o[f]}for(const f in e.attributes){const g=mE[f]||f.toLowerCase();if(o[f]!==void 0){const m=n.accessors[e.attributes[f]],A=eg[m.componentType];u[g]=A.name,h[g]=m.normalized===!0}}return t.getDependency("bufferView",r).then(function(f){return new Promise(function(g){i.decodeDracoFile(f,function(m){for(const A in m.attributes){const v=m.attributes[A],w=h[A];w!==void 0&&(v.normalized=w)}g(m)},l,u)})})}}class m7{constructor(){this.name=Xn.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return t.texCoord!==void 0&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class pE extends Bf{constructor(e){super(),this.isGLTFSpecularGlossinessMaterial=!0;const t=["#ifdef USE_SPECULARMAP","	uniform sampler2D specularMap;","#endif"].join(`
`),n=["#ifdef USE_GLOSSINESSMAP","	uniform sampler2D glossinessMap;","#endif"].join(`
`),i=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","	vec4 texelSpecular = texture2D( specularMap, vUv );","	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","	specularFactor *= texelSpecular.rgb;","#endif"].join(`
`),r=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","	vec4 texelGlossiness = texture2D( glossinessMap, vUv );","	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","	glossinessFactor *= texelGlossiness.a;","#endif"].join(`
`),o=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join(`
`),l={specular:{value:new _e().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=l,this.onBeforeCompile=function(h){for(const u in l)h.uniforms[u]=l[u];h.fragmentShader=h.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",n).replace("#include <roughnessmap_fragment>",i).replace("#include <metalnessmap_fragment>",r).replace("#include <lights_physical_fragment>",o)},Object.defineProperties(this,{specular:{get:function(){return l.specular.value},set:function(h){l.specular.value=h}},specularMap:{get:function(){return l.specularMap.value},set:function(h){l.specularMap.value=h,h?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return l.glossiness.value},set:function(h){l.glossiness.value=h}},glossinessMap:{get:function(){return l.glossinessMap.value},set:function(h){l.glossinessMap.value=h,h?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class g7{constructor(){this.name=Xn.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity"]}getMaterialType(){return pE}extendParams(e,t,n){const i=t.extensions[this.name];e.color=new _e(1,1,1),e.opacity=1;const r=[];if(Array.isArray(i.diffuseFactor)){const o=i.diffuseFactor;e.color.fromArray(o),e.opacity=o[3]}if(i.diffuseTexture!==void 0&&r.push(n.assignTexture(e,"map",i.diffuseTexture,Gn)),e.emissive=new _e(0,0,0),e.glossiness=i.glossinessFactor!==void 0?i.glossinessFactor:1,e.specular=new _e(1,1,1),Array.isArray(i.specularFactor)&&e.specular.fromArray(i.specularFactor),i.specularGlossinessTexture!==void 0){const o=i.specularGlossinessTexture;r.push(n.assignTexture(e,"glossinessMap",o)),r.push(n.assignTexture(e,"specularMap",o,Gn))}return Promise.all(r)}createMaterial(e){const t=new pE(e);return t.fog=!0,t.color=e.color,t.map=e.map===void 0?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=e.aoMap===void 0?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=e.emissiveIntensity===void 0?1:e.emissiveIntensity,t.emissiveMap=e.emissiveMap===void 0?null:e.emissiveMap,t.bumpMap=e.bumpMap===void 0?null:e.bumpMap,t.bumpScale=1,t.normalMap=e.normalMap===void 0?null:e.normalMap,t.normalMapType=Gc,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=e.specularMap===void 0?null:e.specularMap,t.specular=e.specular,t.glossinessMap=e.glossinessMap===void 0?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=e.envMap===void 0?null:e.envMap,t.envMapIntensity=1,t}}class A7{constructor(){this.name=Xn.KHR_MESH_QUANTIZATION}}class gD extends Lf{constructor(e,t,n,i){super(e,t,n,i)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i*3+i;for(let o=0;o!==i;o++)t[o]=n[r+o];return t}interpolate_(e,t,n,i){const r=this.resultBuffer,o=this.sampleValues,l=this.valueSize,h=l*2,u=l*3,f=i-t,g=(n-t)/f,m=g*g,A=m*g,v=e*u,w=v-u,b=-2*A+3*m,S=A-m,R=1-b,M=S-m+g;for(let I=0;I!==l;I++){const T=o[w+I+l],B=o[w+I+h]*f,F=o[v+I+l],D=o[v+I]*f;r[I]=R*T+M*B+b*F+S*D}return r}}const _7=new Ot;class y7 extends gD{interpolate_(e,t,n,i){const r=super.interpolate_(e,t,n,i);return _7.fromArray(r).normalize().toArray(r),r}}const yc={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},eg={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},rP={9728:Ki,9729:yi,9984:Af,9985:fg,9986:_f,9987:fa},oP={33071:$s,33648:Cu,10497:Fc},aP={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},mE={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},wl={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},AD={CUBICSPLINE:void 0,LINEAR:kc,STEP:Mu},eb={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function v7(a){return a.DefaultMaterial===void 0&&(a.DefaultMaterial=new Bf({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Oo})),a.DefaultMaterial}function im(a,e,t){for(const n in t.extensions)a[n]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[n]=t.extensions[n])}function tu(a,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(a.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function x7(a,e,t){let n=!1,i=!1,r=!1;for(let u=0,f=e.length;u<f;u++){const g=e[u];if(g.POSITION!==void 0&&(n=!0),g.NORMAL!==void 0&&(i=!0),g.COLOR_0!==void 0&&(r=!0),n&&i&&r)break}if(!n&&!i&&!r)return Promise.resolve(a);const o=[],l=[],h=[];for(let u=0,f=e.length;u<f;u++){const g=e[u];if(n){const m=g.POSITION!==void 0?t.getDependency("accessor",g.POSITION):a.attributes.position;o.push(m)}if(i){const m=g.NORMAL!==void 0?t.getDependency("accessor",g.NORMAL):a.attributes.normal;l.push(m)}if(r){const m=g.COLOR_0!==void 0?t.getDependency("accessor",g.COLOR_0):a.attributes.color;h.push(m)}}return Promise.all([Promise.all(o),Promise.all(l),Promise.all(h)]).then(function(u){const f=u[0],g=u[1],m=u[2];return n&&(a.morphAttributes.position=f),i&&(a.morphAttributes.normal=g),r&&(a.morphAttributes.color=m),a.morphTargetsRelative=!0,a})}function w7(a,e){if(a.updateMorphTargets(),e.weights!==void 0)for(let t=0,n=e.weights.length;t<n;t++)a.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(a.morphTargetInfluences.length===t.length){a.morphTargetDictionary={};for(let n=0,i=t.length;n<i;n++)a.morphTargetDictionary[t[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function b7(a){const e=a.extensions&&a.extensions[Xn.KHR_DRACO_MESH_COMPRESSION];let t;return e?t="draco:"+e.bufferView+":"+e.indices+":"+cP(e.attributes):t=a.indices+":"+cP(a.attributes)+":"+a.mode,t}function cP(a){let e="";const t=Object.keys(a).sort();for(let n=0,i=t.length;n<i;n++)e+=t[n]+":"+a[t[n]]+";";return e}function gE(a){switch(a){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function _D(a){let e=a.array;if(a.normalized){const t=gE(e.constructor),n=new Float32Array(e.length);for(let i=0,r=e.length;i<r;i++)n[i]=e[i]*t;e=n}return e}function AE(a){a.createInterpolant=function(t){const n=this instanceof ja?y7:gD;return new n(this.times,this.values,this.getValueSize()/3,t)},a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}function E7(a){return a.search(/\.jpe?g($|\?)/i)>0||a.search(/^data\:image\/jpeg/)===0?"image/jpeg":a.search(/\.webp($|\?)/i)>0||a.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}class C7{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new KY,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};const n=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,i=navigator.userAgent.indexOf("Firefox")>-1,r=i?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1;typeof createImageBitmap>"u"||n||i&&r<98?this.textureLoader=new Pg(this.options.manager):this.textureLoader=new h2(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Fs(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,i=this.json,r=this.extensions;this.cache.removeAll(),this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(o){const l={scene:o[0][i.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:i.asset,parser:n,userData:{}};im(r,l,i),tu(l,i),Promise.all(n._invokeAll(function(h){return h.afterRoot&&h.afterRoot(l)})).then(function(){e(l)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let i=0,r=t.length;i<r;i++){const o=t[i].joints;for(let l=0,h=o.length;l<h;l++)e[o[l]].isBone=!0}for(let i=0,r=e.length;i<r;i++){const o=e[i];o.mesh!==void 0&&(this._addNodeRef(this.meshCache,o.mesh),o.skin!==void 0&&(n[o.mesh].isSkinnedMesh=!0)),o.camera!==void 0&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const i=n.clone(),r=(o,l)=>{const h=this.associations.get(o);h!=null&&this.associations.set(l,h);for(const[u,f]of o.children.entries())r(f,l.children[u])};return r(n,i),i.name+="_instance_"+e.uses[t]++,i}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const i=e(t[n]);if(i)return i}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let i=0;i<t.length;i++){const r=e(t[i]);r&&n.push(r)}return n}getDependency(e,t){const n=e+":"+t;let i=this.cache.get(n);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this.loadNode(t);break;case"mesh":i=this._invokeOne(function(r){return r.loadMesh&&r.loadMesh(t)});break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this._invokeOne(function(r){return r.loadBufferView&&r.loadBufferView(t)});break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this._invokeOne(function(r){return r.loadMaterial&&r.loadMaterial(t)});break;case"texture":i=this._invokeOne(function(r){return r.loadTexture&&r.loadTexture(t)});break;case"skin":i=this.loadSkin(t);break;case"animation":i=this._invokeOne(function(r){return r.loadAnimation&&r.loadAnimation(t)});break;case"camera":i=this.loadCamera(t);break;default:if(i=this._invokeOne(function(r){return r!=this&&r.getDependency&&r.getDependency(e,t)}),!i)throw new Error("Unknown type: "+e);break}this.cache.add(n,i)}return i}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,i=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(i.map(function(r,o){return n.getDependency(e,o)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[Xn.KHR_BINARY_GLTF].body);const i=this.options;return new Promise(function(r,o){n.load(za.resolveURL(t.uri,i.path),r,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(n){const i=t.byteLength||0,r=t.byteOffset||0;return n.slice(r,r+i)})}loadAccessor(e){const t=this,n=this.json,i=this.json.accessors[e];if(i.bufferView===void 0&&i.sparse===void 0)return Promise.resolve(null);const r=[];return i.bufferView!==void 0?r.push(this.getDependency("bufferView",i.bufferView)):r.push(null),i.sparse!==void 0&&(r.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(r).then(function(o){const l=o[0],h=aP[i.type],u=eg[i.componentType],f=u.BYTES_PER_ELEMENT,g=f*h,m=i.byteOffset||0,A=i.bufferView!==void 0?n.bufferViews[i.bufferView].byteStride:void 0,v=i.normalized===!0;let w,b;if(A&&A!==g){const S=Math.floor(m/A),R="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+S+":"+i.count;let M=t.cache.get(R);M||(w=new u(l,S*A,i.count*A/f),M=new _g(w,A/f),t.cache.add(R,M)),b=new Xl(M,h,m%A/f,v)}else l===null?w=new u(i.count*h):w=new u(l,m,i.count*h),b=new Jn(w,h,v);if(i.sparse!==void 0){const S=aP.SCALAR,R=eg[i.sparse.indices.componentType],M=i.sparse.indices.byteOffset||0,I=i.sparse.values.byteOffset||0,T=new R(o[1],M,i.sparse.count*S),B=new u(o[2],I,i.sparse.count*h);l!==null&&(b=new Jn(b.array.slice(),b.itemSize,b.normalized));for(let F=0,D=T.length;F<D;F++){const U=T[F];if(b.setX(U,B[F*h]),h>=2&&b.setY(U,B[F*h+1]),h>=3&&b.setZ(U,B[F*h+2]),h>=4&&b.setW(U,B[F*h+3]),h>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return b})}loadTexture(e){const t=this.json,n=this.options,r=t.textures[e].source,o=t.images[r];let l=this.textureLoader;if(o.uri){const h=n.manager.getHandler(o.uri);h!==null&&(l=h)}return this.loadTextureImage(e,r,l)}loadTextureImage(e,t,n){const i=this,r=this.json,o=r.textures[e],l=r.images[t],h=(l.uri||l.bufferView)+":"+o.sampler;if(this.textureCache[h])return this.textureCache[h];const u=this.loadImageSource(t,n).then(function(f){f.flipY=!1,o.name&&(f.name=o.name);const m=(r.samplers||{})[o.sampler]||{};return f.magFilter=rP[m.magFilter]||yi,f.minFilter=rP[m.minFilter]||fa,f.wrapS=oP[m.wrapS]||Fc,f.wrapT=oP[m.wrapT]||Fc,i.associations.set(f,{textures:e}),f}).catch(function(){return null});return this.textureCache[h]=u,u}loadImageSource(e,t){const n=this,i=this.json,r=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(g=>g.clone());const o=i.images[e],l=self.URL||self.webkitURL;let h=o.uri||"",u=!1;if(o.bufferView!==void 0)h=n.getDependency("bufferView",o.bufferView).then(function(g){u=!0;const m=new Blob([g],{type:o.mimeType});return h=l.createObjectURL(m),h});else if(o.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const f=Promise.resolve(h).then(function(g){return new Promise(function(m,A){let v=m;t.isImageBitmapLoader===!0&&(v=function(w){const b=new Vi(w);b.needsUpdate=!0,m(b)}),t.load(za.resolveURL(g,r.path),v,void 0,A)})}).then(function(g){return u===!0&&l.revokeObjectURL(h),g.userData.mimeType=o.mimeType||E7(o.uri),g}).catch(function(g){throw console.error("THREE.GLTFLoader: Couldn't load texture",h),g});return this.sourceCache[e]=f,f}assignTexture(e,t,n,i){const r=this;return this.getDependency("texture",n.index).then(function(o){if(n.texCoord!==void 0&&n.texCoord!=0&&!(t==="aoMap"&&n.texCoord==1)&&console.warn("THREE.GLTFLoader: Custom UV set "+n.texCoord+" for texture "+t+" not yet supported."),r.extensions[Xn.KHR_TEXTURE_TRANSFORM]){const l=n.extensions!==void 0?n.extensions[Xn.KHR_TEXTURE_TRANSFORM]:void 0;if(l){const h=r.associations.get(o);o=r.extensions[Xn.KHR_TEXTURE_TRANSFORM].extendTexture(o,l),r.associations.set(o,h)}}return i!==void 0&&(o.encoding=i),e[t]=o,o})}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const i=t.attributes.tangent===void 0,r=t.attributes.color!==void 0,o=t.attributes.normal===void 0;if(e.isPoints){const l="PointsMaterial:"+n.uuid;let h=this.cache.get(l);h||(h=new vg,Ts.prototype.copy.call(h,n),h.color.copy(n.color),h.map=n.map,h.sizeAttenuation=!1,this.cache.add(l,h)),n=h}else if(e.isLine){const l="LineBasicMaterial:"+n.uuid;let h=this.cache.get(l);h||(h=new Is,Ts.prototype.copy.call(h,n),h.color.copy(n.color),this.cache.add(l,h)),n=h}if(i||r||o){let l="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(l+="specular-glossiness:"),i&&(l+="derivative-tangents:"),r&&(l+="vertex-colors:"),o&&(l+="flat-shading:");let h=this.cache.get(l);h||(h=n.clone(),r&&(h.vertexColors=!0),o&&(h.flatShading=!0),i&&(h.normalScale&&(h.normalScale.y*=-1),h.clearcoatNormalScale&&(h.clearcoatNormalScale.y*=-1)),this.cache.add(l,h),this.associations.set(h,this.associations.get(n))),n=h}n.aoMap&&t.attributes.uv2===void 0&&t.attributes.uv!==void 0&&t.setAttribute("uv2",t.attributes.uv),e.material=n}getMaterialType(){return Bf}loadMaterial(e){const t=this,n=this.json,i=this.extensions,r=n.materials[e];let o;const l={},h=r.extensions||{},u=[];if(h[Xn.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const g=i[Xn.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];o=g.getMaterialType(),u.push(g.extendParams(l,r,t))}else if(h[Xn.KHR_MATERIALS_UNLIT]){const g=i[Xn.KHR_MATERIALS_UNLIT];o=g.getMaterialType(),u.push(g.extendParams(l,r,t))}else{const g=r.pbrMetallicRoughness||{};if(l.color=new _e(1,1,1),l.opacity=1,Array.isArray(g.baseColorFactor)){const m=g.baseColorFactor;l.color.fromArray(m),l.opacity=m[3]}g.baseColorTexture!==void 0&&u.push(t.assignTexture(l,"map",g.baseColorTexture,Gn)),l.metalness=g.metallicFactor!==void 0?g.metallicFactor:1,l.roughness=g.roughnessFactor!==void 0?g.roughnessFactor:1,g.metallicRoughnessTexture!==void 0&&(u.push(t.assignTexture(l,"metalnessMap",g.metallicRoughnessTexture)),u.push(t.assignTexture(l,"roughnessMap",g.metallicRoughnessTexture))),o=this._invokeOne(function(m){return m.getMaterialType&&m.getMaterialType(e)}),u.push(Promise.all(this._invokeAll(function(m){return m.extendMaterialParams&&m.extendMaterialParams(e,l)})))}r.doubleSided===!0&&(l.side=er);const f=r.alphaMode||eb.OPAQUE;if(f===eb.BLEND?(l.transparent=!0,l.depthWrite=!1):(l.transparent=!1,f===eb.MASK&&(l.alphaTest=r.alphaCutoff!==void 0?r.alphaCutoff:.5)),r.normalTexture!==void 0&&o!==Hi&&(u.push(t.assignTexture(l,"normalMap",r.normalTexture)),l.normalScale=new Xe(1,1),r.normalTexture.scale!==void 0)){const g=r.normalTexture.scale;l.normalScale.set(g,g)}return r.occlusionTexture!==void 0&&o!==Hi&&(u.push(t.assignTexture(l,"aoMap",r.occlusionTexture)),r.occlusionTexture.strength!==void 0&&(l.aoMapIntensity=r.occlusionTexture.strength)),r.emissiveFactor!==void 0&&o!==Hi&&(l.emissive=new _e().fromArray(r.emissiveFactor)),r.emissiveTexture!==void 0&&o!==Hi&&u.push(t.assignTexture(l,"emissiveMap",r.emissiveTexture,Gn)),Promise.all(u).then(function(){let g;return o===pE?g=i[Xn.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(l):g=new o(l),r.name&&(g.name=r.name),tu(g,r),t.associations.set(g,{materials:e}),r.extensions&&im(i,g,r),g})}createUniqueName(e){const t=ni.sanitizeNodeName(e||"");let n=t;for(let i=1;this.nodeNamesUsed[n];++i)n=t+"_"+i;return this.nodeNamesUsed[n]=!0,n}loadGeometries(e){const t=this,n=this.extensions,i=this.primitiveCache;function r(l){return n[Xn.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(l,t).then(function(h){return lP(h,l,t)})}const o=[];for(let l=0,h=e.length;l<h;l++){const u=e[l],f=b7(u),g=i[f];if(g)o.push(g.promise);else{let m;u.extensions&&u.extensions[Xn.KHR_DRACO_MESH_COMPRESSION]?m=r(u):m=lP(new Sn,u,t),i[f]={primitive:u,promise:m},o.push(m)}}return Promise.all(o)}loadMesh(e){const t=this,n=this.json,i=this.extensions,r=n.meshes[e],o=r.primitives,l=[];for(let h=0,u=o.length;h<u;h++){const f=o[h].material===void 0?v7(this.cache):this.getDependency("material",o[h].material);l.push(f)}return l.push(t.loadGeometries(o)),Promise.all(l).then(function(h){const u=h.slice(0,h.length-1),f=h[h.length-1],g=[];for(let A=0,v=f.length;A<v;A++){const w=f[A],b=o[A];let S;const R=u[A];if(b.mode===yc.TRIANGLES||b.mode===yc.TRIANGLE_STRIP||b.mode===yc.TRIANGLE_FAN||b.mode===void 0)S=r.isSkinnedMesh===!0?new vC(w,R):new _t(w,R),S.isSkinnedMesh===!0&&!S.geometry.attributes.skinWeight.normalized&&S.normalizeSkinWeights(),b.mode===yc.TRIANGLE_STRIP?S.geometry=hP(S.geometry,cL):b.mode===yc.TRIANGLE_FAN&&(S.geometry=hP(S.geometry,oC));else if(b.mode===yc.LINES)S=new zo(w,R);else if(b.mode===yc.LINE_STRIP)S=new Ss(w,R);else if(b.mode===yc.LINE_LOOP)S=new wC(w,R);else if(b.mode===yc.POINTS)S=new Dy(w,R);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+b.mode);Object.keys(S.geometry.morphAttributes).length>0&&w7(S,r),S.name=t.createUniqueName(r.name||"mesh_"+e),tu(S,r),b.extensions&&im(i,S,b),t.assignFinalMaterial(S),g.push(S)}for(let A=0,v=g.length;A<v;A++)t.associations.set(g[A],{meshes:e,primitives:A});if(g.length===1)return g[0];const m=new sa;t.associations.set(m,{meshes:e});for(let A=0,v=g.length;A<v;A++)m.add(g[A]);return m})}loadCamera(e){let t;const n=this.json.cameras[e],i=n[n.type];if(!i){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return n.type==="perspective"?t=new ts(Tu.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):n.type==="orthographic"&&(t=new nh(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),tu(t,n),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],n={joints:t.joints};return t.inverseBindMatrices===void 0?Promise.resolve(n):this.getDependency("accessor",t.inverseBindMatrices).then(function(i){return n.inverseBindMatrices=i,n})}loadAnimation(e){const t=this.json,n=this,i=t.animations[e],r=[],o=[],l=[],h=[],u=[];for(let f=0,g=i.channels.length;f<g;f++){const m=i.channels[f],A=i.samplers[m.sampler],v=m.target,w=i.parameters!==void 0?i.parameters[A.input]:A.input,b=i.parameters!==void 0?i.parameters[A.output]:A.output,S=n._invokeOne(function(R){return R.loadAnimationTargetFromChannel&&R.loadAnimationTargetFromChannel(m)});r.push(S),o.push(this.getDependency("accessor",w)),l.push(this.getDependency("accessor",b)),h.push(A),u.push(v)}return Promise.all([Promise.all(r),Promise.all(o),Promise.all(l),Promise.all(h),Promise.all(u)]).then(function(f){const g=f[0],m=f[1],A=f[2],v=f[3],w=f[4],b=[];for(let R=0,M=g.length;R<M;R++){const I=g[R],T=m[R],B=A[R],F=v[R],D=w[R];if(I===void 0)continue;I.updateMatrix&&(I.updateMatrix(),I.matrixAutoUpdate=!0);const U=n._invokeOne(function(W){return W.createAnimationTracks&&W.createAnimationTracks(I,T,B,F,D)});if(U)for(let W=0;W<U.length;W++)b.push(U[W])}const S=i.name?i.name:"animation_"+e;return new Kl(S,void 0,b)})}createNodeMesh(e){const t=this.json,n=this,i=t.nodes[e];return i.mesh===void 0?null:n.getDependency("mesh",i.mesh).then(function(r){const o=n._getNodeRef(n.meshCache,i.mesh,r);return i.weights!==void 0&&o.traverse(function(l){if(!!l.isMesh)for(let h=0,u=i.weights.length;h<u;h++)l.morphTargetInfluences[h]=i.weights[h]}),o})}loadNode(e){const t=this.json,n=this.extensions,i=this,r=t.nodes[e],o=r.name?i.createUniqueName(r.name):"";return function(){const l=[],h=i._invokeOne(function(u){return u.createNodeMesh&&u.createNodeMesh(e)});return h&&l.push(h),r.camera!==void 0&&l.push(i.getDependency("camera",r.camera).then(function(u){return i._getNodeRef(i.cameraCache,r.camera,u)})),i._invokeAll(function(u){return u.createNodeAttachment&&u.createNodeAttachment(e)}).forEach(function(u){l.push(u)}),Promise.all(l)}().then(function(l){let h;if(r.isBone===!0?h=new Ly:l.length>1?h=new sa:l.length===1?h=l[0]:h=new qt,h!==l[0])for(let u=0,f=l.length;u<f;u++)h.add(l[u]);if(r.name&&(h.userData.name=r.name,h.name=o),tu(h,r),r.extensions&&im(n,h,r),r.matrix!==void 0){const u=new xn;u.fromArray(r.matrix),h.applyMatrix4(u)}else r.translation!==void 0&&h.position.fromArray(r.translation),r.rotation!==void 0&&h.quaternion.fromArray(r.rotation),r.scale!==void 0&&h.scale.fromArray(r.scale);return i.associations.has(h)||i.associations.set(h,{}),i.associations.get(h).nodes=e,h})}loadScene(e){const t=this.json,n=this.extensions,i=this.json.scenes[e],r=this,o=new sa;i.name&&(o.name=r.createUniqueName(i.name)),tu(o,i),i.extensions&&im(n,o,i);const l=i.nodes||[],h=[];for(let u=0,f=l.length;u<f;u++)h.push(yD(l[u],o,t,r));return Promise.all(h).then(function(){const u=f=>{const g=new Map;for(const[m,A]of r.associations)(m instanceof Ts||m instanceof Vi)&&g.set(m,A);return f.traverse(m=>{const A=r.associations.get(m);A!=null&&g.set(m,A)}),g};return r.associations=u(o),o})}loadAnimationTargetFromChannel(e){const t=e.target,n=t.node!==void 0?t.node:t.id;return this.getDependency("node",n)}createAnimationTracks(e,t,n,i,r){const o=[],l=e.name?e.name:e.uuid,h=[];wl[r.path]===wl.weights?e.traverse(function(m){m.morphTargetInfluences&&h.push(m.name?m.name:m.uuid)}):h.push(l);let u;switch(wl[r.path]){case wl.weights:u=Jl;break;case wl.rotation:u=ja;break;case wl.position:case wl.scale:default:switch(n.itemSize){case 1:u=Jl;break;case 2:case 3:u=Zl;break;case 4:u=Rg;break}break}const f=i.interpolation!==void 0?AD[i.interpolation]:kc,g=_D(n);for(let m=0,A=h.length;m<A;m++){const v=new u(h[m]+"."+wl[r.path],t.array,g,f);f==="CUBICSPLINE"&&AE(v),o.push(v)}return o}}function yD(a,e,t,n){const i=t.nodes[a];return n.getDependency("node",a).then(function(r){if(i.skin===void 0)return r;let o;return n.getDependency("skin",i.skin).then(function(l){o=l;const h=[];for(let u=0,f=o.joints.length;u<f;u++)h.push(n.getDependency("node",o.joints[u]));return Promise.all(h)}).then(function(l){return r.traverse(function(h){if(!h.isMesh)return;const u=[],f=[];for(let g=0,m=l.length;g<m;g++){const A=l[g];if(A){u.push(A);const v=new xn;o.inverseBindMatrices!==void 0&&v.fromArray(o.inverseBindMatrices.array,g*16),f.push(v)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',o.joints[g])}h.bind(new yg(u,f),h.matrixWorld)}),r})}).then(function(r){e.add(r);const o=[];if(i.children){const l=i.children;for(let h=0,u=l.length;h<u;h++){const f=l[h];o.push(yD(f,r,t,n))}}return Promise.all(o)})}function S7(a,e,t){const n=e.attributes,i=new Mr;if(n.POSITION!==void 0){const l=t.json.accessors[n.POSITION],h=l.min,u=l.max;if(h!==void 0&&u!==void 0){if(i.set(new q(h[0],h[1],h[2]),new q(u[0],u[1],u[2])),l.normalized){const f=gE(eg[l.componentType]);i.min.multiplyScalar(f),i.max.multiplyScalar(f)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const r=e.targets;if(r!==void 0){const l=new q,h=new q;for(let u=0,f=r.length;u<f;u++){const g=r[u];if(g.POSITION!==void 0){const m=t.json.accessors[g.POSITION],A=m.min,v=m.max;if(A!==void 0&&v!==void 0){if(h.setX(Math.max(Math.abs(A[0]),Math.abs(v[0]))),h.setY(Math.max(Math.abs(A[1]),Math.abs(v[1]))),h.setZ(Math.max(Math.abs(A[2]),Math.abs(v[2]))),m.normalized){const w=gE(eg[m.componentType]);h.multiplyScalar(w)}l.max(h)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}i.expandByVector(l)}a.boundingBox=i;const o=new Qa;i.getCenter(o.center),o.radius=i.min.distanceTo(i.max)/2,a.boundingSphere=o}function lP(a,e,t){const n=e.attributes,i=[];function r(o,l){return t.getDependency("accessor",o).then(function(h){a.setAttribute(l,h)})}for(const o in n){const l=mE[o]||o.toLowerCase();l in a.attributes||i.push(r(n[o],l))}if(e.indices!==void 0&&!a.index){const o=t.getDependency("accessor",e.indices).then(function(l){a.setIndex(l)});i.push(o)}return tu(a,e),S7(a,e,t),Promise.all(i).then(function(){return e.targets!==void 0?x7(a,e.targets,t):a})}function hP(a,e){let t=a.getIndex();if(t===null){const o=[],l=a.getAttribute("position");if(l!==void 0){for(let h=0;h<l.count;h++)o.push(h);a.setIndex(o),t=a.getIndex()}else return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),a}const n=t.count-2,i=[];if(e===oC)for(let o=1;o<=n;o++)i.push(t.getX(0)),i.push(t.getX(o)),i.push(t.getX(o+1));else for(let o=0;o<n;o++)o%2===0?(i.push(t.getX(o)),i.push(t.getX(o+1)),i.push(t.getX(o+2))):(i.push(t.getX(o+2)),i.push(t.getX(o+1)),i.push(t.getX(o)));i.length/3!==n&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const r=a.clone();return r.setIndex(i),r}const tb=new WeakMap;class rS extends mr{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,n,i){const r=new Fs(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,o=>{this.decodeDracoFile(o,t).catch(i)},n,i)}decodeDracoFile(e,t,n,i){const r={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:i||this.defaultAttributeTypes,useUniqueIDs:!!n};return this.decodeGeometry(e,r).then(t)}decodeGeometry(e,t){const n=JSON.stringify(t);if(tb.has(e)){const h=tb.get(e);if(h.key===n)return h.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let i;const r=this.workerNextTaskID++,o=e.byteLength,l=this._getWorker(r,o).then(h=>(i=h,new Promise((u,f)=>{i._callbacks[r]={resolve:u,reject:f},i.postMessage({type:"decode",id:r,taskConfig:t,buffer:e},[e])}))).then(h=>this._createGeometry(h.geometry));return l.catch(()=>!0).then(()=>{i&&r&&this._releaseTask(i,r)}),tb.set(e,{key:n,promise:l}),l}_createGeometry(e){const t=new Sn;e.index&&t.setIndex(new Jn(e.index.array,1));for(let n=0;n<e.attributes.length;n++){const i=e.attributes[n],r=i.name,o=i.array,l=i.itemSize;t.setAttribute(r,new Jn(o,l))}return t}_loadLibrary(e,t){const n=new Fs(this.manager);return n.setPath(this.decoderPath),n.setResponseType(t),n.setWithCredentials(this.withCredentials),new Promise((i,r)=>{n.load(e,i,void 0,r)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(n=>{const i=n[0];e||(this.decoderConfig.wasmBinary=n[1]);const r=M7.toString(),o=["/* draco decoder */",i,"","/* worker */",r.substring(r.indexOf("{")+1,r.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([o]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const i=new Worker(this.workerSourceURL);i._callbacks={},i._taskCosts={},i._taskLoad=0,i.postMessage({type:"init",decoderConfig:this.decoderConfig}),i.onmessage=function(r){const o=r.data;switch(o.type){case"decode":i._callbacks[o.id].resolve(o);break;case"error":i._callbacks[o.id].reject(o);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+o.type+'"')}},this.workerPool.push(i)}else this.workerPool.sort(function(i,r){return i._taskLoad>r._taskLoad?-1:1});const n=this.workerPool[this.workerPool.length-1];return n._taskCosts[e]=t,n._taskLoad+=t,n})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}function M7(){let a,e;onmessage=function(o){const l=o.data;switch(l.type){case"init":a=l.decoderConfig,e=new Promise(function(f){a.onModuleLoaded=function(g){f({draco:g})},DracoDecoderModule(a)});break;case"decode":const h=l.buffer,u=l.taskConfig;e.then(f=>{const g=f.draco,m=new g.Decoder,A=new g.DecoderBuffer;A.Init(new Int8Array(h),h.byteLength);try{const v=t(g,m,A,u),w=v.attributes.map(b=>b.array.buffer);v.index&&w.push(v.index.array.buffer),self.postMessage({type:"decode",id:l.id,geometry:v},w)}catch(v){console.error(v),self.postMessage({type:"error",id:l.id,error:v.message})}finally{g.destroy(A),g.destroy(m)}});break}};function t(o,l,h,u){const f=u.attributeIDs,g=u.attributeTypes;let m,A;const v=l.GetEncodedGeometryType(h);if(v===o.TRIANGULAR_MESH)m=new o.Mesh,A=l.DecodeBufferToMesh(h,m);else if(v===o.POINT_CLOUD)m=new o.PointCloud,A=l.DecodeBufferToPointCloud(h,m);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!A.ok()||m.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+A.error_msg());const w={index:null,attributes:[]};for(const b in f){const S=self[g[b]];let R,M;if(u.useUniqueIDs)M=f[b],R=l.GetAttributeByUniqueId(m,M);else{if(M=l.GetAttributeId(m,o[f[b]]),M===-1)continue;R=l.GetAttribute(m,M)}w.attributes.push(i(o,l,m,b,S,R))}return v===o.TRIANGULAR_MESH&&(w.index=n(o,l,m)),o.destroy(m),w}function n(o,l,h){const f=h.num_faces()*3,g=f*4,m=o._malloc(g);l.GetTrianglesUInt32Array(h,g,m);const A=new Uint32Array(o.HEAPF32.buffer,m,f).slice();return o._free(m),{array:A,itemSize:1}}function i(o,l,h,u,f,g){const m=g.num_components(),v=h.num_points()*m,w=v*f.BYTES_PER_ELEMENT,b=r(o,f),S=o._malloc(w);l.GetAttributeDataArrayForAllPoints(h,g,b,w,S);const R=new f(o.HEAPF32.buffer,S,v).slice();return o._free(S),{name:u,array:R,itemSize:m}}function r(o,l){switch(l){case Float32Array:return o.DT_FLOAT32;case Int8Array:return o.DT_INT8;case Int16Array:return o.DT_INT16;case Int32Array:return o.DT_INT32;case Uint8Array:return o.DT_UINT8;case Uint16Array:return o.DT_UINT16;case Uint32Array:return o.DT_UINT32}}}class T7{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,t){const n=this.workersResolve[e];if(n&&n(t),this.queue.length){const{resolve:i,msg:r,transfer:o}=this.queue.shift();this.workersResolve[e]=i,this.workers[e].postMessage(r,o)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise(n=>{const i=this._getIdleWorker();i!==-1?(this._initWorker(i),this.workerStatus|=1<<i,this.workersResolve[i]=n,this.workers[i].postMessage(e,t)):this.queue.push({resolve:n,msg:e,transfer:t})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const I7=0,R7=2,P7=1,B7=2,L7=0,vD=9,oS=15,xD=16,aS=22,wD=37,cS=43,bD=76,ED=83,CD=97,SD=100,MD=103,TD=109;class D7{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class sm{constructor(e,t,n,i){this._dataView=new DataView(e.buffer,e.byteOffset+t,n),this._littleEndian=i,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_skip(e){return this._offset+=e,this}_scan(e,t=0){const n=this._offset;let i=0;for(;this._dataView.getUint8(this._offset)!==t&&i<e;)i++,this._offset++;return i<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+n,i)}}const wr=[171,75,84,88,32,50,48,187,13,10,26,10];function uP(a){return typeof TextDecoder<"u"?new TextDecoder().decode(a):Buffer.from(a).toString("utf8")}function O7(a){const e=new Uint8Array(a.buffer,a.byteOffset,wr.length);if(e[0]!==wr[0]||e[1]!==wr[1]||e[2]!==wr[2]||e[3]!==wr[3]||e[4]!==wr[4]||e[5]!==wr[5]||e[6]!==wr[6]||e[7]!==wr[7]||e[8]!==wr[8]||e[9]!==wr[9]||e[10]!==wr[10]||e[11]!==wr[11])throw new Error("Missing KTX 2.0 identifier.");const t=new D7,n=17*Uint32Array.BYTES_PER_ELEMENT,i=new sm(a,wr.length,n,!0);t.vkFormat=i._nextUint32(),t.typeSize=i._nextUint32(),t.pixelWidth=i._nextUint32(),t.pixelHeight=i._nextUint32(),t.pixelDepth=i._nextUint32(),t.layerCount=i._nextUint32(),t.faceCount=i._nextUint32();const r=i._nextUint32();t.supercompressionScheme=i._nextUint32();const o=i._nextUint32(),l=i._nextUint32(),h=i._nextUint32(),u=i._nextUint32(),f=i._nextUint64(),g=i._nextUint64(),m=new sm(a,wr.length+n,3*r*8,!0);for(let ve=0;ve<r;ve++)t.levels.push({levelData:new Uint8Array(a.buffer,a.byteOffset+m._nextUint64(),m._nextUint64()),uncompressedByteLength:m._nextUint64()});const A=new sm(a,o,l,!0),v={vendorId:A._skip(4)._nextUint16(),descriptorType:A._nextUint16(),versionNumber:A._nextUint16(),descriptorBlockSize:A._nextUint16(),colorModel:A._nextUint8(),colorPrimaries:A._nextUint8(),transferFunction:A._nextUint8(),flags:A._nextUint8(),texelBlockDimension:[A._nextUint8(),A._nextUint8(),A._nextUint8(),A._nextUint8()],bytesPlane:[A._nextUint8(),A._nextUint8(),A._nextUint8(),A._nextUint8(),A._nextUint8(),A._nextUint8(),A._nextUint8(),A._nextUint8()],samples:[]},w=(v.descriptorBlockSize/4-6)/4;for(let ve=0;ve<w;ve++){const xe={bitOffset:A._nextUint16(),bitLength:A._nextUint8(),channelType:A._nextUint8(),samplePosition:[A._nextUint8(),A._nextUint8(),A._nextUint8(),A._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&xe.channelType?(xe.sampleLower=A._nextInt32(),xe.sampleUpper=A._nextInt32()):(xe.sampleLower=A._nextUint32(),xe.sampleUpper=A._nextUint32()),v.samples[ve]=xe}t.dataFormatDescriptor.length=0,t.dataFormatDescriptor.push(v);const b=new sm(a,h,u,!0);for(;b._offset<u;){const ve=b._nextUint32(),xe=b._scan(ve),Ae=uP(xe),Me=b._scan(ve-xe.byteLength);t.keyValue[Ae]=Ae.match(/^ktx/i)?uP(Me):Me,b._offset%4&&b._skip(4-b._offset%4)}if(g<=0)return t;const S=new sm(a,f,g,!0),R=S._nextUint16(),M=S._nextUint16(),I=S._nextUint32(),T=S._nextUint32(),B=S._nextUint32(),F=S._nextUint32(),D=[];for(let ve=0;ve<r;ve++)D.push({imageFlags:S._nextUint32(),rgbSliceByteOffset:S._nextUint32(),rgbSliceByteLength:S._nextUint32(),alphaSliceByteOffset:S._nextUint32(),alphaSliceByteLength:S._nextUint32()});const U=f+S._offset,W=U+I,J=W+T,ee=J+B,Q=new Uint8Array(a.buffer,a.byteOffset+U,I),Y=new Uint8Array(a.buffer,a.byteOffset+W,T),se=new Uint8Array(a.buffer,a.byteOffset+J,B),ae=new Uint8Array(a.buffer,a.byteOffset+ee,F);return t.globalData={endpointCount:R,selectorCount:M,imageDescs:D,endpointsData:Q,selectorsData:Y,tablesData:se,extendedData:ae},t}let nb,vc,_E;const ib={env:{emscripten_notify_memory_growth:function(a){_E=new Uint8Array(vc.exports.memory.buffer)}}};class F7{init(){return nb||(nb=typeof fetch<"u"?fetch("data:application/wasm;base64,"+dP).then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,ib)).then(this._init):WebAssembly.instantiate(Buffer.from(dP,"base64"),ib).then(this._init),nb)}_init(e){vc=e.instance,ib.env.emscripten_notify_memory_growth(0)}decode(e,t=0){if(!vc)throw new Error("ZSTDDecoder: Await .init() before decoding.");const n=e.byteLength,i=vc.exports.malloc(n);_E.set(e,i),t=t||Number(vc.exports.ZSTD_findDecompressedSize(i,n));const r=vc.exports.malloc(t),o=vc.exports.ZSTD_decompress(r,t,i,n),l=_E.slice(r,r+o);return vc.exports.free(i),vc.exports.free(r),l}}const dP="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ",sb=new WeakMap;let rb=0,ob;class ra extends mr{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new T7,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER<"u"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}detectSupport(e){return this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},e.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1),this}init(){if(!this.transcoderPending){const e=new Fs(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const t=e.loadAsync("basis_transcoder.js"),n=new Fs(this.manager);n.setPath(this.transcoderPath),n.setResponseType("arraybuffer"),n.setWithCredentials(this.withCredentials);const i=n.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([t,i]).then(([r,o])=>{const l=ra.BasisWorker.toString(),h=["/* constants */","let _EngineFormat = "+JSON.stringify(ra.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(ra.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(ra.BasisFormat),"/* basis_transcoder.js */",r,"/* worker */",l.substring(l.indexOf("{")+1,l.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([h])),this.transcoderBinary=o,this.workerPool.setWorkerCreator(()=>{const u=new Worker(this.workerSourceURL),f=this.transcoderBinary.slice(0);return u.postMessage({type:"init",config:this.workerConfig,transcoderBinary:f},[f]),u})}),rb>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),rb++}return this.transcoderPending}load(e,t,n,i){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const r=new Fs(this.manager);r.setResponseType("arraybuffer"),r.setWithCredentials(this.withCredentials),r.load(e,o=>{if(sb.has(o))return sb.get(o).promise.then(t).catch(i);this._createTexture(o).then(l=>t?t(l):null).catch(i)},n,i)}_createTextureFrom(e){const{mipmaps:t,width:n,height:i,format:r,type:o,error:l,dfdTransferFn:h,dfdFlags:u}=e;if(o==="error")return Promise.reject(l);const f=new Bl(t,n,i,r,Er);return f.minFilter=t.length===1?yi:fa,f.magFilter=yi,f.generateMipmaps=!1,f.needsUpdate=!0,f.encoding=h===B7?Gn:pr,f.premultiplyAlpha=!!(u&P7),f}_createTexture(e,t={}){const n=O7(new Uint8Array(e));if(n.vkFormat!==L7)return N7(n);const i=t,r=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:e,taskConfig:i},[e])).then(o=>this._createTextureFrom(o.data));return sb.set(e,{promise:r}),r}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),rb--,this}}ra.BasisFormat={ETC1S:0,UASTC_4x4:1};ra.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16};ra.EngineFormat={RGBAFormat:us,RGBA_ASTC_4x4_Format:X_,RGBA_BPTC_Format:Y_,RGBA_ETC2_EAC_Format:q_,RGBA_PVRTC_4BPPV1_Format:Q_,RGBA_S3TC_DXT5_Format:bm,RGB_ETC1_Format:iC,RGB_ETC2_Format:j_,RGB_PVRTC_4BPPV1_Format:W_,RGB_S3TC_DXT1_Format:wm};ra.BasisWorker=function(){let a,e,t;const n=_EngineFormat,i=_TranscoderFormat,r=_BasisFormat;self.addEventListener("message",function(A){const v=A.data;switch(v.type){case"init":a=v.config,o(v.transcoderBinary);break;case"transcode":e.then(()=>{try{const{width:w,height:b,hasAlpha:S,mipmaps:R,format:M,dfdTransferFn:I,dfdFlags:T}=l(v.buffer),B=[];for(let F=0;F<R.length;++F)B.push(R[F].data.buffer);self.postMessage({type:"transcode",id:v.id,width:w,height:b,hasAlpha:S,mipmaps:R,format:M,dfdTransferFn:I,dfdFlags:T},B)}catch(w){console.error(w),self.postMessage({type:"error",id:v.id,error:w.message})}});break}});function o(A){e=new Promise(v=>{t={wasmBinary:A,onRuntimeInitialized:v},BASIS(t)}).then(()=>{t.initializeBasis(),t.KTX2File===void 0&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")})}function l(A){const v=new t.KTX2File(new Uint8Array(A));function w(){v.close(),v.delete()}if(!v.isValid())throw w(),new Error("THREE.KTX2Loader:	Invalid or unsupported .ktx2 file");const b=v.isUASTC()?r.UASTC_4x4:r.ETC1S,S=v.getWidth(),R=v.getHeight(),M=v.getLevels(),I=v.getHasAlpha(),T=v.getDFDTransferFunc(),B=v.getDFDFlags(),{transcoderFormat:F,engineFormat:D}=g(b,S,R,I);if(!S||!R||!M)throw w(),new Error("THREE.KTX2Loader:	Invalid texture");if(!v.startTranscoding())throw w(),new Error("THREE.KTX2Loader: .startTranscoding failed");const U=[];for(let W=0;W<M;W++){const J=v.getImageLevelInfo(W,0,0),ee=J.origWidth,Q=J.origHeight,Y=new Uint8Array(v.getImageTranscodedSizeInBytes(W,0,0,F));if(!v.transcodeImage(Y,W,0,0,F,0,-1,-1))throw w(),new Error("THREE.KTX2Loader: .transcodeImage failed.");U.push({data:Y,width:ee,height:Q})}return w(),{width:S,height:R,hasAlpha:I,mipmaps:U,format:D,dfdTransferFn:T,dfdFlags:B}}const h=[{if:"astcSupported",basisFormat:[r.UASTC_4x4],transcoderFormat:[i.ASTC_4x4,i.ASTC_4x4],engineFormat:[n.RGBA_ASTC_4x4_Format,n.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[i.BC7_M5,i.BC7_M5],engineFormat:[n.RGBA_BPTC_Format,n.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[i.BC1,i.BC3],engineFormat:[n.RGB_S3TC_DXT1_Format,n.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[i.ETC1,i.ETC2],engineFormat:[n.RGB_ETC2_Format,n.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[i.ETC1],engineFormat:[n.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[i.PVRTC1_4_RGB,i.PVRTC1_4_RGBA],engineFormat:[n.RGB_PVRTC_4BPPV1_Format,n.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],u=h.sort(function(A,v){return A.priorityETC1S-v.priorityETC1S}),f=h.sort(function(A,v){return A.priorityUASTC-v.priorityUASTC});function g(A,v,w,b){let S,R;const M=A===r.ETC1S?u:f;for(let I=0;I<M.length;I++){const T=M[I];if(!!a[T.if]&&!!T.basisFormat.includes(A)&&!(b&&T.transcoderFormat.length<2)&&!(T.needsPowerOfTwo&&!(m(v)&&m(w))))return S=T.transcoderFormat[b?1:0],R=T.engineFormat[b?1:0],{transcoderFormat:S,engineFormat:R}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),S=i.RGBA32,R=n.RGBAFormat,{transcoderFormat:S,engineFormat:R}}function m(A){return A<=2?!0:(A&A-1)===0&&A!==0}};const fP={[TD]:us,[CD]:us,[wD]:us,[cS]:us,[MD]:ef,[ED]:ef,[xD]:ef,[aS]:ef,[SD]:lu,[bD]:lu,[oS]:lu,[vD]:lu},ab={[TD]:Ms,[CD]:Os,[wD]:Er,[cS]:Er,[MD]:Ms,[ED]:Os,[xD]:Er,[aS]:Er,[SD]:Ms,[bD]:Os,[oS]:Er,[vD]:Er},k7={[cS]:Gn,[aS]:Gn,[oS]:Gn};async function N7(a){const{vkFormat:e,pixelWidth:t,pixelHeight:n,pixelDepth:i}=a;if(fP[e]===void 0)throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");const r=a.levels[0];let o,l;if(a.supercompressionScheme===I7)o=r.levelData;else if(a.supercompressionScheme===R7)ob||(ob=new Promise(async u=>{const f=new F7;await f.init(),u(f)})),o=(await ob).decode(r.levelData,r.uncompressedByteLength);else throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");ab[e]===Ms?l=new Float32Array(o.buffer,o.byteOffset,o.byteLength/Float32Array.BYTES_PER_ELEMENT):ab[e]===Os?l=new Uint16Array(o.buffer,o.byteOffset,o.byteLength/Uint16Array.BYTES_PER_ELEMENT):l=o;const h=i===0?new Na(l,t,n):new mg(l,t,n,i);return h.type=ab[e],h.format=fP[e],h.encoding=k7[e]||pr,h.needsUpdate=!0,Promise.resolve(h)}const tg=jt("debugdecoders");let ia,Dl;function pP(a){a!==void 0&&typeof a=="string"&&(ia||(ia=new rS),tg&&console.log("Setting draco decoder path to",a),ia.setDecoderPath(a))}function mP(a){a!==void 0&&typeof a=="string"&&(ia||(ia=new rS),tg&&console.log("Setting draco decoder type to",a),ia.setDecoderConfig({type:a}))}function gP(a){a!==void 0&&typeof a=="string"&&(Dl||(Dl=new ra),tg&&console.log("Setting ktx2 transcoder path to",a),Dl.setTranscoderPath(a))}function Xy(a,e){ia||(ia=new rS,ia.setDecoderPath("./include/draco/"),ia.setDecoderConfig({type:"js"}),tg&&console.log("Setting draco decoder path to","./include/draco/")),Dl||(Dl=new ra,Dl.setTranscoderPath("./include/ktx2/"),tg&&console.log("Setting ktx2 transcoder path to","./include/ktx2/"),e.renderer&&Dl.detectSupport(e.renderer)),a.setDRACOLoader(ia),a.setKTX2Loader(Dl)}const cb="NEEDLE_deferred_texture",bl=jt("debugdeferredtextures"),Um=class{constructor(e,t,n){E(this,"parser");E(this,"sourceId");E(this,"context");E(this,"_loading",[]);this.parser=e,this.sourceId=t,this.context=n}static assignTextureLOD(e,t,n=0){if(!!t)for(const i of Object.keys(t)){const r=t[i];(r==null?void 0:r.isTexture)===!0&&(bl&&console.log("FIND",i,r==null?void 0:r.name,r==null?void 0:r.userData,r),Um.getOrLoadTexture(e,t,i,r,n).then(o=>{(o==null?void 0:o.isTexture)===!0&&(o.needsUpdate=!0,t[i]=o,t.needsUpdate=!0)}))}}get name(){return cb}afterRoot(e){var t;return bl&&console.log("AFTER",e),(t=this.parser.json.textures)==null||t.forEach((n,i)=>{if(n!=null&&n.extensions){const r=n==null?void 0:n.extensions[cb];if(r){const o=this.parser.getDependency("texture",i);this._loading.splice(this._loading.indexOf(i),1),o.then(l=>{bl&&console.log("register texture",l.name,l.uuid,r),l.userData.deferred=r,Um.cache.set(l.uuid,r)})}}}),null}static async getOrLoadTexture(e,t,n,i,r){const o=i.uuid,l=Um.cache.get(o)||i.userData.deferred;if(l){bl&&console.log(o,l.uri,l.guid);const h=l.uri;if(h.endsWith(".glb")||h.endsWith(".gltf")){if(!l.guid)return console.warn("missing pointer for glb/gltf texture",l),null;const u=l.uri+"_"+l.guid;if(this.resolved[u])return this.resolved[u];const f=new Df;Xy(f,e),bl&&console.log("Load "+h,t.name,n);const g=await f.loadAsync(h),m=g.parser;let A=-1,v=!1;for(const b of g.parser.json.textures)if(A++,b!=null&&b.extensions){const S=b==null?void 0:b.extensions[cb];if(S!=null&&S.guid&&S.guid===l.guid){v=!0;break}}if(!v)return null;const w=await m.getDependency("texture",A);return this.resolved[u]=w,bl&&console.log(t.name,n,'change "'+i.name+'" \u2192 "'+w.name+'"',h,A,w,t),w}else{const f=await new Pg().loadAsync(l.uri);return f&&bl?console.log(l,f):console.warn("failed loading",l.uri),f}}else bl&&console.warn("unknown uuid",i.name,i.uuid,i);return null}};let pu=Um;E(pu,"cache",new Map),E(pu,"resolved",{});var U7=Object.defineProperty,z7=Object.getOwnPropertyDescriptor,Ou=(a,e,t,n)=>{for(var i=n>1?void 0:n?z7(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&U7(e,t,i),i};const AP=jt("noInstancing"),_P=!!jt("debuglightmaps"),G7=jt("debuginstancing"),H7=jt("debugprogressiveload");class ID{constructor(){E(this,"path",null);E(this,"asset",null);E(this,"default")}}class V7{constructor(e){E(this,"_renderer");E(this,"_targets",[]);this._renderer=e;const t=this.setMaterial.bind(this),n=this.getMaterial.bind(this),i=e.gameObject;if(this._targets=[],i)switch(i.type){case"Group":this._targets=[...i.children];break;case"Mesh":this._targets.push(i);break}return new Proxy(this,{get(r,o){if(typeof o=="string"){const l=parseInt(o);if(!isNaN(l))return n(l)}return r[o]},set(r,o,l){return typeof o=="string"&&t(l,Number.parseInt(o)),Reflect.set(r,o,l)}})}is(e){return this._renderer===e}get length(){return this._targets.length}setMaterial(e,t){if(t<0||t>=this._targets.length)return;const n=this._targets[t];!n||(n.material=e)}getMaterial(e){if(e<0)return null;const t=this._targets;if(e>=t.length)return null;const n=t[e];return n?n.material:null}}const RD=class extends Bt{constructor(){super(...arguments);E(this,"receiveShadows",!1);E(this,"shadowCastingMode",yE.Off);E(this,"lightmapIndex",-1);E(this,"lightmapScaleOffset",new On(1,1,0,0));E(this,"enableInstancing");E(this,"renderOrder");E(this,"allowOcclusionWhenDynamic",!0);E(this,"_lightmaps");E(this,"_sharedMaterials");E(this,"_lightmapTextureOverride");E(this,"_isInstancingEnabled",!1);E(this,"handles");E(this,"prevLayers")}get material(){return this.gameObject.material}set material(e){this.gameObject.material=e}get sharedMaterials(){return(!this._sharedMaterials||!this._sharedMaterials.is(this))&&(this._sharedMaterials=new V7(this)),this._sharedMaterials}static get shouldSuppressInstancing(){return AP}get lightmap(){var e;return(e=this._lightmaps)!=null&&e.length?this._lightmaps[0].lightmap:null}set lightmap(e){var t;if(this._lightmapTextureOverride=e,e===void 0&&(e=this.context.lightmaps.tryGetLightmap(this.sourceId,this.lightmapIndex)),(t=this._lightmaps)!=null&&t.length)for(const n of this._lightmaps)n.lightmap=e}get hasLightmap(){const e=this.lightmap;return e!=null}awake(){var t,n;const e=this.gameObject.type;if(e==="Group"){for(const i of this.gameObject.children)this.context.addBeforeRenderListener(i,this.onBeforeRenderThree.bind(this)),i.layers.mask=this.gameObject.layers.mask;if(this.renderOrder!==void 0){let i=0;for(let r=0;r<this.gameObject.children.length;r++){const o=this.gameObject.children[r];if(!(o.type!=="Mesh"||Te.getComponent(o,RD))){if(this.renderOrder.length<=i){console.error("Incorrect element count",this);break}o.renderOrder=this.renderOrder[i],i+=1}}}}else(e==="Mesh"||e==="SkinnedMesh")&&(this.context.addBeforeRenderListener(this.gameObject,this.onBeforeRenderThree.bind(this)),this.renderOrder!==void 0&&this.renderOrder.length>0&&(this.gameObject.renderOrder=this.renderOrder[0]));if(this.lightmapIndex>=0){const i=this._lightmapTextureOverride!==void 0?this._lightmapTextureOverride:this.context.lightmaps.tryGetLightmap(this.sourceId,this.lightmapIndex);if(i){if(this._lightmaps=[],e==="Mesh"){if(!((t=this.gameObject.material)!=null&&t.isMeshBasicMaterial)){const r=new ty(this.gameObject,this.context);this._lightmaps.push(r),r.init(this.lightmapIndex,this.lightmapScaleOffset,i,_P)}}else if(e==="Group"){for(const r of this.gameObject.children)if(!((n=r.material)!=null&&n.isMeshBasicMaterial)){const o=new ty(r,this.context);this._lightmaps.push(o),o.init(this.lightmapIndex,this.lightmapScaleOffset,i,_P),o.bindOnBeforeRender()}}}}}setInstancingEnabled(e){if(this._isInstancingEnabled===e)return e&&(this.handles===void 0||this.handles!=null&&this.handles.length>0);if(this._isInstancingEnabled=e,e){if(this.handles===void 0){if(this.handles=Q7.setup(this.gameObject,this.context,null,{rend:this,foundMeshes:0}),this.handles)return Te.markAsInstancedRendered(this.gameObject,!0),!0}else if(this.handles!==null){for(const t of this.handles)t.updateInstanceMatrix(!0),t.add();return Te.markAsInstancedRendered(this.gameObject,!0),!0}}else{if(this.handles)for(const t of this.handles)t.remove();return!0}return!1}start(){if(this.enableInstancing&&!AP&&this.setInstancingEnabled(!0),this.gameObject.frustumCulled=this.allowOcclusionWhenDynamic,this.gameObject.type==="Group")for(let e=0;e<this.gameObject.children.length;e++){const t=this.gameObject.children[e];t.frustumCulled=this.allowOcclusionWhenDynamic}}onEnable(){this._isInstancingEnabled?this.setInstancingEnabled(!0):this.enabled&&(this.gameObject.visible=!0,this.applyStencil())}onDisable(){this.handles&&this.handles.length>0?this.setInstancingEnabled(!1):this.enabled||(this.gameObject.visible=!1)}onDestroy(){this.handles=null}applyStencil(){Rm.applyStencil(this)}onBeforeRenderThree(e,t,n,i,r,o){if(r._didRequestTextureLOD===void 0&&(r._didRequestTextureLOD=0,H7?(console.log("Load material LOD (with delay)",r.name),setTimeout(()=>{pu.assignTextureLOD(this.context,r)},2e3)):pu.assignTextureLOD(this.context,r)),r.envMapIntensity!==void 0){const l=this.hasLightmap?Math.PI:1;r.envMapIntensity=Math.max(0,this.context.rendererData.environmentIntensity/l)}if(this._lightmaps)for(const l of this._lightmaps)l.onBeforeRenderThree(r)}onBeforeRender(){var t;if(!this.gameObject)return;const e=this.gameObject[vE]===!0||this.gameObject.matrixWorldNeedsUpdate;if(this.gameObject.type==="Group"&&((t=this.gameObject.children)==null?void 0:t.length)>0)for(const n of this.gameObject.children)this.applySettings(n);else this.applySettings(this.gameObject);if(e&&(delete this.gameObject[vE],this.handles)){for(let n=this.handles.length-1;n>=0;n--)this.handles[n].updateInstanceMatrix();this.gameObject.matrixWorldNeedsUpdate=!1}if(this.handles&&this.handles.length<=0&&Te.markAsInstancedRendered(this.gameObject,!1),this._isInstancingEnabled&&this.handles)for(let n=0;n<this.handles.length;n++){const i=this.handles[n];this.prevLayers||(this.prevLayers=[]);const r=i.object.layers.mask;n>=this.prevLayers.length?this.prevLayers.push(r):this.prevLayers[n]=r,i.object.layers.disableAll()}}onAfterRender(){if(this._isInstancingEnabled&&this.handles&&this.prevLayers&&this.prevLayers.length>=this.handles.length)for(let e=0;e<this.handles.length;e++){const t=this.handles[e];t.object.layers.mask=this.prevLayers[e]}}applySettings(e){e.receiveShadow=this.receiveShadows,this.shadowCastingMode==yE.On?e.castShadow=!0:e.castShadow=!1}};let Vr=RD;Ou([Re()],Vr.prototype,"receiveShadows",2);Ou([Re()],Vr.prototype,"shadowCastingMode",2);Ou([Re()],Vr.prototype,"lightmapIndex",2);Ou([Re(On)],Vr.prototype,"lightmapScaleOffset",2);Ou([Re()],Vr.prototype,"enableInstancing",2);Ou([Re()],Vr.prototype,"renderOrder",2);Ou([Re()],Vr.prototype,"allowOcclusionWhenDynamic",2);class lS extends Vr{}class PD extends lS{awake(){super.awake(),this.allowOcclusionWhenDynamic=!1}}var yE=(a=>(a[a.Off=0]="Off",a[a.On=1]="On",a[a.TwoSided=2]="TwoSided",a[a.ShadowsOnly=3]="ShadowsOnly",a))(yE||{});const vE="NEEDLE_NEED_UPDATE_INSTANCE";class ro{static markDirty(e,t=!0){if(!!e&&(Te.isUsingInstancing(e)&&(e[vE]=!0,e.matrixWorldNeedsUpdate=!0),t))for(const n of e.children)ro.markDirty(n,!0)}}class W7{constructor(){E(this,"objs",[])}setup(e,t,n,i,r=0){const o=this.tryCreateOrAddInstance(e,t,i);if(o)return n===null&&(n=[]),n.push(o),n;if(r<=0&&e.type!=="Mesh"){const l=r+1;for(const h of e.children)n=this.setup(h,t,n,i,l)}return n}tryCreateOrAddInstance(e,t,n){if(e.type==="Mesh"){const i=n.foundMeshes;if(n.foundMeshes+=1,!n.rend.enableInstancing||i>=n.rend.enableInstancing.length||!n.rend.enableInstancing[i])return null;const r=e,o=r.geometry,l=r.material;for(const u of this.objs)if(!u.isFull()&&u.geo===o&&u.material===l)return u.addInstance(r);const h=new C_(e.name,o,l,200,t);return this.objs.push(h),h.addInstance(r)}return null}}const Q7=new W7;class j7{constructor(e,t,n){E(this,"instanceIndex",-1);E(this,"object");E(this,"instancer");this.instanceIndex=e,this.object=t,this.instancer=n,Te.markAsInstancedRendered(t,!0)}get name(){return this.object.name}updateInstanceMatrix(e=!1){this.instanceIndex<0||(this.object.updateWorldMatrix(!0,e),this.instancer.updateInstance(this.object.matrixWorld,this.instanceIndex))}add(){this.instanceIndex>=0||this.instancer.add(this)}remove(){this.instanceIndex<0||this.instancer.remove(this)}}const SM=class{constructor(e,t,n,i,r){E(this,"name","");E(this,"geo");E(this,"material");E(this,"context");E(this,"inst");E(this,"handles",[]);E(this,"maxCount");this.name=e,this.geo=t,this.material=n,this.context=r,this.maxCount=i,G7&&(n=new Hi({color:this.randomColor()})),this.inst=new xC(t,n,i),this.inst.count=0,this.inst.layers.set(2),this.inst.visible=!0,this.context.scene.add(this.inst)}get currentCount(){return this.inst.count}isFull(){return this.currentCount>=this.maxCount}randomColor(){return new _e(Math.random(),Math.random(),Math.random())}addInstance(e){if(this.currentCount>=this.maxCount)return console.error("TOO MANY INSTANCES - resize is not yet implemented!",this.inst.count),null;const t=new j7(-1,e,this);return this.add(t),t}add(e){e.instanceIndex<0&&(e.instanceIndex=this.currentCount,e.instanceIndex>=this.handles.length?this.handles.push(e):this.handles[e.instanceIndex]=e),e.object.updateWorldMatrix(!0,!0),this.inst.setMatrixAt(e.instanceIndex,e.object.matrixWorld),this.inst.instanceMatrix.needsUpdate=!0,this.inst.count+=1,this.inst.count>0&&(this.inst.visible=!0)}remove(e){if(!e||e.instanceIndex<0||e.instanceIndex>=this.handles.length||this.inst.count<=0)return;if(this.handles[e.instanceIndex]!==e){console.error("instance handle is not part of renderer, was it removed before?",e.instanceIndex,this.name);const n=this.handles.indexOf(e);if(n<0)return;e.instanceIndex=n}if(this.handles[e.instanceIndex]=null,this.inst.setMatrixAt(e.instanceIndex,SM.nullMatrix),!(e.instanceIndex>=this.currentCount-1)&&this.currentCount>0){const n=this.handles[this.currentCount-1];n&&(n.instanceIndex=e.instanceIndex,n.updateInstanceMatrix(),this.handles[e.instanceIndex]=n,this.handles[this.currentCount-1]=null)}this.inst.count>0&&(this.inst.count-=1),e.instanceIndex=-1,this.inst.count<=0&&(this.inst.visible=!1),this.inst.instanceMatrix.needsUpdate=!0}updateInstance(e,t){this.inst.setMatrixAt(t,e),this.inst.instanceMatrix.needsUpdate=!0}};let C_=SM;E(C_,"nullMatrix",new xn);const rm=jt("debugphysics"),q7=jt("debugcollisions");class X7{constructor(){E(this,"mass",1);E(this,"kinematic",!1);E(this,"physicsEvents",!1);E(this,"drag",0);E(this,"angularDrag",.05);E(this,"sleepThreshold",.01)}}class lb{constructor(e,t){E(this,"obj");E(this,"parent");E(this,"body");E(this,"shapes",[]);E(this,"collisonCallback",null);E(this,"_hasRigidbody",!1);E(this,"_didSleepLastStep",!1);this.obj=e,this.parent=e.parent,this.body=t}}class Y7{constructor(e,t){E(this,"obj");E(this,"contact");E(this,"target");E(this,"type");this.contact=e,this.type=t,this.obj=null,this.target=null}}class Wc{constructor(){E(this,"ray");E(this,"screenPoint");E(this,"raycaster");E(this,"results");E(this,"targets");E(this,"recursive",!0);E(this,"minDistance");E(this,"maxDistance");E(this,"lineThreshold");E(this,"layerMask");E(this,"ignore")}screenPointFromOffset(e,t){this.screenPoint===void 0&&(this.screenPoint=new Xe),this.screenPoint.x=e/window.innerWidth*2-1,this.screenPoint.y=-(t/window.innerHeight)*2+1}setMask(e){this.layerMask||(this.layerMask=new Va);const t=this.layerMask;t?t.mask=e:this.layerMask=e}}E(Wc,"AllLayers",4294967295);class J7{constructor(e,t,n){E(this,"distance");E(this,"point");E(this,"object");this.object=e,this.distance=t,this.point=n}}class Z7{constructor(e){E(this,"raycaster",new Du);E(this,"defaultRaycastOptions",new Wc);E(this,"targetBuffer",new Array(1));E(this,"defaultThresholds",{Mesh:{},Line:{threshold:0},LOD:{},Points:{threshold:0},Sprite:{}});E(this,"sphereResults",new Array);E(this,"sphereMask",new Va);E(this,"tempBoundingBox",new Mr);E(this,"_isUpdatingPhysicsWorld",!1);E(this,"context");E(this,"world",new GY);E(this,"objects",[]);E(this,"tempPosition",new q);E(this,"tempQuaternion",new Ot);E(this,"temp",new q);E(this,"tempQuat",new Ot);if(this.context=e,this.world.gravity.set(0,-9.82,0),rm){const t={};t.onInit=(n,i,r)=>{i.layers.set(-1)},XY(e.scene,this.world.bodies,t)}}sphereOverlap(e,t){if(this.sphereResults.length=0,!this.context.scene)return this.sphereResults;const n=new Qa(e,t),i=this.sphereMask;i.enableAll(),i.disable(2);for(const r of this.context.scene.children){const o=this.onSphereOverlap(r,n,i);o&&this.sphereResults.push(o)}return this.sphereResults.sort((r,o)=>r.distance-o.distance)}onSphereOverlap(e,t,n){if(e.type==="Mesh"){if(!e.layers.test(n))return null;const i=e,r=i.geometry;if(r.boundingBox||r.computeBoundingBox(),!r.boundingBox)return null;i.matrixWorldNeedsUpdate&&i.updateMatrixWorld();const o=this.tempBoundingBox.copy(r.boundingBox).applyMatrix4(i.matrixWorld);if(t.intersectsBox(o)){const h=ti(e).distanceTo(t.center);return new J7(e,h,t.center.clone())}}else if(e.children)for(const i of e.children){const r=this.onSphereOverlap(i,t,n);if(r)return r}return null}raycastFromRay(e,t=null){const n=t!=null?t:this.defaultRaycastOptions;return n.ray=e,this.raycast(n)}raycast(e=null){var l,h,u,f,g;e||(e=this.defaultRaycastOptions);const t=(l=e.screenPoint)!=null?l:this.context.input.mousePositionRC,n=(h=e.raycaster)!=null?h:this.raycaster;if(n.near=(u=e.minDistance)!=null?u:0,n.far=(f=e.maxDistance)!=null?f:1/0,n.params=this.defaultThresholds,e.lineThreshold?n.params.Line={threshold:e.lineThreshold}:n.params.Line={threshold:0},e.ray)n.ray.copy(e.ray);else{const m=this.context.mainCamera;if(!m)return console.error("Can not perform raycast - no main camera found"),this.defaultRaycastOptions.results&&(this.defaultRaycastOptions.results.length=0),(g=this.defaultRaycastOptions.results)!=null?g:[];n.setFromCamera(t,m)}let i=e.targets;i||(i=this.targetBuffer,i[0]=this.context.scene);let r=e.results;r||(this.defaultRaycastOptions.results||(this.defaultRaycastOptions.results=new Array),r=this.defaultRaycastOptions.results),e.layerMask!==void 0?e.layerMask instanceof Va?n.layers.mask=e.layerMask.mask:n.layers.mask=e.layerMask:(n.layers.enableAll(),n.layers.disable(2)),r.length=0,n.intersectObjects(i,e.recursive,r);const o=e.ignore;return o!==void 0&&o.length>0&&(r=r.filter(m=>!o.includes(m.object))),r}get isUpdating(){return this._isUpdatingPhysicsWorld}addPreStepListener(e){this.world.addEventListener("preStep",e)}addPostStepListener(e){this.world.addEventListener("postStep",e)}addConstraint(e){this.world.addConstraint(e)}setGravity(e){this.world.gravity.set(e.x,e.y,e.z)}multiplyGravity(e){this.world.gravity.x*=e.x,this.world.gravity.y*=e.y,this.world.gravity.z*=e.z}addBody(e,t){for(let n=0;n<this.objects.length;n++){const i=this.objects[n];if(i.obj===e){i._hasRigidbody=!0;break}}this.world.addBody(t)}removeBody(e,t,n=!0){this.world.removeBody(t);for(let i=0;i<this.objects.length;i++){const r=this.objects[i];if(r.obj===e){r._hasRigidbody=!1,n&&this.objects.splice(i,1);break}}}removeShape(e,t){for(const n of this.objects)if(n.obj===e){n.body&&(n.body.removeShape(t),n.body.updateMassProperties());return}}createBody(e,t){const n=this.internalCreateBody(e,null);t.mass&&(n.mass=t.mass),t.kinematic?n.type=en.KINEMATIC:n.type=en.DYNAMIC,t.drag&&(n.linearDamping=t.drag),t.angularDrag&&(n.angularDamping=t.angularDrag),t.sleepThreshold&&(n.sleepSpeedLimit=t.sleepThreshold),this.world.addBody(n);const i=new lb(e,n);return i._hasRigidbody=!0,this.objects.push(i),rm&&console.log("created new body",e.name,n,n.sleepState,this.world.gravity),t.physicsEvents&&this.registerCollisionEvents(i),n}addBoxCollider(e,t,n,i,r){const o=this.tempPosition;e.getWorldScale(o);const l=new re(.5*o.x*i.x,.5*o.y*i.y,.5*o.z*i.z),h=new Qy(l);h.collisionResponse=!t,n=n.clone(),n.multiply(o);const u=this.addShape(e,h,n,r);if(u!==null){if(this.isAlreadyRegistered(u))return h;const f=new lb(e,u);this.objects.push(f)}return h}addSphereCollider(e,t,n,i){const r=this.tempPosition;e.getWorldScale(r);const o=Math.max(r.x,r.y,r.z),l=new bX(n*o);t=t.clone(),t.multiply(r);const h=this.addShape(e,l,t,i);if(h!==null){if(this.isAlreadyRegistered(h))return l;const u=new lb(e,h);this.objects.push(u)}return l}addMeshCollider(e){rm&&console.warn("TODO mesh collider not yet supported")}isAlreadyRegistered(e){for(const t of this.objects)if(t.body===e)return!0;return!1}addShape(e,t,n,i){let r=null;if(i?(i.initialize(),console.assert(!!i.body,"rigidbody didn't initialize / produce a physics body",i),r=i.body):(r=this.internalCreateBody(e,null),r.type=en.KINEMATIC,this.world.addBody(r)),r){n.x*=-1;const o=uo(e),l=ti(e);l.add(n);const h=new Ot(r.quaternion.x,r.quaternion.y,r.quaternion.z,r.quaternion.w);o.multiply(h.invert());const u=r.position,f=new re(l.x-u.x,l.y-u.y,l.z-u.z),g=new hs(o.x,o.y,o.z,o.w);r.addShape(t,f,g),r.updateMassProperties()}return r}step(e){this._isUpdatingPhysicsWorld=!0,e=Math.min(e,1/30),this.world.step(e),this._isUpdatingPhysicsWorld=!1,rm&&this.context.time.frameCount%60===0&&console.log("physics world has "+this.world.bodies.length+" bodies",this.world)}postStep(){this._isUpdatingPhysicsWorld=!0;for(let e=0;e<this.objects.length;e++){const t=this.objects[e],n=t.body;if(!n||!n.world)continue;n.sleepTick(this.context.time.time),rm&&(!t._didSleepLastStep&&n.sleepState===en.SLEEPING?console.log("BODY SLEEPING",n):t._didSleepLastStep&&n.sleepState!==en.SLEEPING&&console.log("BODY WOKE UP",n)),t._didSleepLastStep=n.sleepState===en.SLEEPING;const i=t.obj;if(n.type===en.KINEMATIC){const r=ti(i,this.temp);n.position.set(r.x,r.y,r.z);const o=uo(i,this.tempQuat);n.quaternion.set(o.x,o.y,o.z,o.w);continue}if(t.parent&&i.parent===t.parent){Fq(i,n.quaternion.x,n.quaternion.y,n.quaternion.z,n.quaternion.w);const r=n.position;$C(i,r.x,r.y,r.z),n.velocity.length()>n.sleepSpeedLimit&&ro.markDirty(i)}}this._isUpdatingPhysicsWorld=!1}internalCreateBody(e,t){const n=new en;n._owner=e,n._name=e.name,e.getWorldPosition(this.tempPosition);const i=this.tempPosition;n.position=new re(i.x,i.y,i.z);const r=this.tempQuaternion;return e.getWorldQuaternion(r),n.quaternion=new hs(r.x,r.y,r.z,r.w),n.type=en.KINEMATIC,t&&(n.addShape(t),n.updateMassProperties()),n}registerCollisionEvents(e){if(e.collisonCallback&&this.unregisterCollisionEvents(e),!e.body)return;const t=n=>this.raiseCollisionEvents(e.obj,n);e.collisonCallback=t.bind(this),e.body.addEventListener("collide",e.collisonCallback)}unregisterCollisionEvents(e){!e.collisonCallback||!e.body||e.body.removeEventListener("collide",e.collisonCallback)}raiseCollisionEvents(e,t){var l,h;const n=new Y7(t.contact,t.type);let i=0;const r=this.objects;function o(){if(!(i>0))for(let u=0;u<r.length;u++){if(i==2)return;const f=r[u];f.body==t.body?(n.obj=f.obj,++i):f.body==t.target&&(n.target=f.obj,++i)}}q7&&console.log("collision between",t.contact.bi,t.contact.bj,e,t);for(let u=0;u<((h=(l=e.userData)==null?void 0:l.components)==null?void 0:h.length);u++){const f=e.userData.components[u];f.onCollision&&(o(),f.onCollision(n))}}}class K7{constructor(){E(this,"deltaTime",0);E(this,"time",0);E(this,"frame",0);E(this,"clock",new Hy);E(this,"_smoothedFps",0);E(this,"_fpsSamples",[]);E(this,"_fpsSampleIndex",0)}get realtimeSinceStartup(){return this.clock.elapsedTime}get frameCount(){return this.frame}get smoothedFps(){return this._smoothedFps}update(){this.deltaTime=this.clock.getDelta(),this.deltaTime=Math.min(.1,this.deltaTime),this.frame+=1,this.time+=this.deltaTime,this._fpsSamples.length<30?this._fpsSamples.push(this.deltaTime):this._fpsSamples[this._fpsSampleIndex++%30]=this.deltaTime;let e=0;for(let t=0;t<this._fpsSamples.length;t++)e+=this._fpsSamples[t];this._smoothedFps=1/(e/this._fpsSamples.length)}}var gm=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function $7(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var BD={},LD={};Object.defineProperty(LD,"__esModule",{value:!0});var Yy={};Object.defineProperty(Yy,"__esModule",{value:!0});Yy.ConstantBackoff=void 0;var eJ=function(){function a(e){this.reset=function(){},this.backoff=e}return a.prototype.next=function(){return this.backoff},a}();Yy.ConstantBackoff=eJ;var Jy={};Object.defineProperty(Jy,"__esModule",{value:!0});Jy.ExponentialBackoff=void 0;var tJ=function(){function a(e,t){this.initial=e,this.expMax=t,this.expCurrent=1,this.current=this.initial}return a.prototype.next=function(){var e=this.current;return this.expMax>this.expCurrent++&&(this.current=this.current*2),e},a.prototype.reset=function(){this.expCurrent=1,this.current=this.initial},a}();Jy.ExponentialBackoff=tJ;var Zy={};Object.defineProperty(Zy,"__esModule",{value:!0});Zy.LinearBackoff=void 0;var nJ=function(){function a(e,t,n){this.initial=e,this.increment=t,this.maximum=n,this.current=this.initial}return a.prototype.next=function(){var e=this.current,t=this.current+this.increment;return this.maximum===void 0?this.current=t:t<=this.maximum&&(this.current=t),e},a.prototype.reset=function(){this.current=this.initial},a}();Zy.LinearBackoff=nJ;var DD={};Object.defineProperty(DD,"__esModule",{value:!0});var Ky={};Object.defineProperty(Ky,"__esModule",{value:!0});Ky.LRUBuffer=void 0;var iJ=function(){function a(e){this.writePtr=0,this.wrapped=!1,this.buffer=Array(e)}return a.prototype.len=function(){return this.wrapped?this.buffer.length:this.writePtr},a.prototype.cap=function(){return this.buffer.length},a.prototype.read=function(e){if(e==null||e.length===0||this.buffer.length===0||this.writePtr===0&&!this.wrapped)return 0;for(var t=this.wrapped?this.writePtr:0,n=t-1<0?this.buffer.length-1:t-1,i=0;i<e.length;i++){var r=(t+i)%this.buffer.length;if(e[i]=this.buffer[r],r===n)return i+1}return e.length},a.prototype.write=function(e){if(e==null||e.length===0||this.buffer.length===0)return 0;for(var t=e.length>this.buffer.length?e.length-this.buffer.length:0,n=0;n<e.length-t;n++)this.buffer[this.writePtr]=e[t+n],this.writePtr=(this.writePtr+1)%this.buffer.length,this.writePtr===0&&(this.wrapped=!0);return e.length},a.prototype.forEach=function(e){if(this.writePtr===0&&!this.wrapped)return 0;for(var t=this.wrapped?this.writePtr:0,n=this.wrapped?t-1<0?this.buffer.length-1:t-1:this.writePtr-1,i=this.len();e(this.buffer[t]),t!==n;)t=(t+1)%this.buffer.length;return i},a.prototype.clear=function(){this.writePtr=0,this.wrapped=!1},a}();Ky.LRUBuffer=iJ;var $y={};Object.defineProperty($y,"__esModule",{value:!0});$y.TimeBuffer=void 0;var sJ=function(){function a(e){this.maxAge=e}return a.prototype.cap=function(){return Number.POSITIVE_INFINITY},a.prototype.len=function(){this.forwardTail();for(var e=this.tail,t=0;e!==void 0;)t++,e=e.n;return t},a.prototype.read=function(e){if(this.forwardTail(),e.length===0)return 0;for(var t=this.tail,n=0;t!==void 0&&(e[n++]=t.e,n!==e.length);)t=t.n;return n},a.prototype.write=function(e){for(var t=0;t<e.length;t++)this.putElement(e[t]);return e.length},a.prototype.forEach=function(e){this.forwardTail();for(var t=this.tail,n=0;t!==void 0;)e(t.e),n++,t=t.n;return n},a.prototype.putElement=function(e){var t={e,t:Date.now(),n:void 0};this.tail===void 0&&(this.tail=t),this.head===void 0?this.head=t:(this.head.n=t,this.head=t)},a.prototype.forwardTail=function(){if(this.tail!==void 0)for(var e=Date.now();e-this.tail.t>this.maxAge&&(this.tail===this.head?(this.tail=void 0,this.head=void 0):this.tail=this.tail.n,this.tail!==void 0););},a.prototype.clear=function(){},a}();$y.TimeBuffer=sJ;var hS={};(function(a){Object.defineProperty(a,"__esModule",{value:!0}),a.Websocket=a.WebsocketEvents=void 0;var e;(function(n){n.open="open",n.close="close",n.error="error",n.message="message",n.retry="retry"})(e=a.WebsocketEvents||(a.WebsocketEvents={}));var t=function(){function n(i,r,o,l){var h=this;this.eventListeners={open:[],close:[],error:[],message:[],retry:[]},this.closedByUser=!1,this.retries=0,this.handleOpenEvent=function(u){return h.handleEvent(e.open,u)},this.handleCloseEvent=function(u){return h.handleEvent(e.close,u)},this.handleErrorEvent=function(u){return h.handleEvent(e.error,u)},this.handleMessageEvent=function(u){return h.handleEvent(e.message,u)},this.url=i,this.protocols=r,this.buffer=o,this.backoff=l,this.tryConnect()}return Object.defineProperty(n.prototype,"underlyingWebsocket",{get:function(){return this.websocket},enumerable:!1,configurable:!0}),n.prototype.send=function(i){var r;this.closedByUser||(this.websocket===void 0||this.websocket.readyState!==this.websocket.OPEN?(r=this.buffer)===null||r===void 0||r.write([i]):this.websocket.send(i))},n.prototype.close=function(i,r){var o;this.closedByUser=!0,(o=this.websocket)===null||o===void 0||o.close(i,r)},n.prototype.addEventListener=function(i,r,o){var l={listener:r,options:o},h=this.eventListeners[i];h.push(l)},n.prototype.removeEventListener=function(i,r,o){this.eventListeners[i]=this.eventListeners[i].filter(function(l){return l.listener!==r&&(l.options===void 0||l.options!==o)})},n.prototype.dispatchEvent=function(i,r){var o=this,l=this.eventListeners[i],h=[];l.forEach(function(u){u.listener(o,r),u.options!==void 0&&u.options.once&&h.push(u)}),h.forEach(function(u){return o.removeEventListener(i,u.listener,u.options)})},n.prototype.tryConnect=function(){this.websocket!==void 0&&(this.websocket.removeEventListener(e.open,this.handleOpenEvent),this.websocket.removeEventListener(e.close,this.handleCloseEvent),this.websocket.removeEventListener(e.error,this.handleErrorEvent),this.websocket.removeEventListener(e.message,this.handleMessageEvent),this.websocket.close()),this.websocket=new WebSocket(this.url,this.protocols),this.websocket.addEventListener(e.open,this.handleOpenEvent),this.websocket.addEventListener(e.close,this.handleCloseEvent),this.websocket.addEventListener(e.error,this.handleErrorEvent),this.websocket.addEventListener(e.message,this.handleMessageEvent)},n.prototype.handleEvent=function(i,r){var o,l,h;switch(i){case e.close:this.closedByUser||this.reconnect();break;case e.open:this.retries=0,(o=this.backoff)===null||o===void 0||o.reset(),(l=this.buffer)===null||l===void 0||l.forEach(this.send.bind(this)),(h=this.buffer)===null||h===void 0||h.clear();break}this.dispatchEvent(i,r)},n.prototype.reconnect=function(){var i=this;if(this.backoff!==void 0){var r=this.backoff.next();setTimeout(function(){i.dispatchEvent(e.retry,new CustomEvent(e.retry,{detail:{retries:++i.retries,backoff:r}})),i.tryConnect()},r)}},n}();a.Websocket=t})(hS);var ev={};Object.defineProperty(ev,"__esModule",{value:!0});ev.WebsocketBuilder=void 0;var Vd=hS,rJ=function(){function a(e){this.ws=null,this.onOpenListeners=[],this.onCloseListeners=[],this.onErrorListeners=[],this.onMessageListeners=[],this.onRetryListeners=[],this.url=e}return a.prototype.withProtocols=function(e){return this.protocols=e,this},a.prototype.withBackoff=function(e){return this.backoff=e,this},a.prototype.withBuffer=function(e){return this.buffer=e,this},a.prototype.onOpen=function(e,t){return this.onOpenListeners.push({listener:e,options:t}),this},a.prototype.onClose=function(e,t){return this.onCloseListeners.push({listener:e,options:t}),this},a.prototype.onError=function(e,t){return this.onErrorListeners.push({listener:e,options:t}),this},a.prototype.onMessage=function(e,t){return this.onMessageListeners.push({listener:e,options:t}),this},a.prototype.onRetry=function(e,t){return this.onRetryListeners.push({listener:e,options:t}),this},a.prototype.build=function(){var e=this;return this.ws!==null?this.ws:(this.ws=new Vd.Websocket(this.url,this.protocols,this.buffer,this.backoff),this.onOpenListeners.forEach(function(t){var n;return(n=e.ws)===null||n===void 0?void 0:n.addEventListener(Vd.WebsocketEvents.open,t.listener,t.options)}),this.onCloseListeners.forEach(function(t){var n;return(n=e.ws)===null||n===void 0?void 0:n.addEventListener(Vd.WebsocketEvents.close,t.listener,t.options)}),this.onErrorListeners.forEach(function(t){var n;return(n=e.ws)===null||n===void 0?void 0:n.addEventListener(Vd.WebsocketEvents.error,t.listener,t.options)}),this.onMessageListeners.forEach(function(t){var n;return(n=e.ws)===null||n===void 0?void 0:n.addEventListener(Vd.WebsocketEvents.message,t.listener,t.options)}),this.onRetryListeners.forEach(function(t){var n;return(n=e.ws)===null||n===void 0?void 0:n.addEventListener(Vd.WebsocketEvents.retry,t.listener,t.options)}),this.ws)},a}();ev.WebsocketBuilder=rJ;(function(a){var e=gm&&gm.__createBinding||(Object.create?function(n,i,r,o){o===void 0&&(o=r),Object.defineProperty(n,o,{enumerable:!0,get:function(){return i[r]}})}:function(n,i,r,o){o===void 0&&(o=r),n[o]=i[r]}),t=gm&&gm.__exportStar||function(n,i){for(var r in n)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&e(i,n,r)};Object.defineProperty(a,"__esModule",{value:!0}),t(LD,a),t(Yy,a),t(Jy,a),t(Zy,a),t(DD,a),t(Ky,a),t($y,a),t(hS,a),t(ev,a)})(BD);function OD(a=window.location.hostname){return new RegExp("[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}|localhost","gm").test(a)===!0}class Ru extends Bt{constructor(){super(...arguments);E(this,"url",null);E(this,"urlParameterName",null);E(this,"localhost",null)}getWebsocketUrl(){let t=this.url?Ru.GetUrl(this.url,this.localhost):null;if(this.urlParameterName){const o=jt(this.urlParameterName);o&&typeof o=="string"&&(t=o)}if(!t)return null;const i=new RegExp("(((https?)|(?<socket_prefix>wss?))://)?(www.)?(?<url>.+)","gm").exec(t);return i!=null&&i.groups?(i==null?void 0:i.groups.socket_prefix)?t:"wss://"+(i==null?void 0:i.groups.url):null}static GetUrl(t,n){let i=t;const r=Ru.IsLocalNetwork()&&n;return r&&(i=n),t!=null&&t.startsWith("/")&&(i=(r?i:window.location.origin)+t),i}static IsLocalNetwork(t=window.location.hostname){return OD(t)}}const hb=2,La=4,Sc=4,tv=4,Pl=new Int32Array(2),yP=new Float32Array(Pl.buffer),vP=new Float64Array(Pl.buffer),o_=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;class Ga{constructor(e,t){this.low=e|0,this.high=t|0}static create(e,t){return e==0&&t==0?Ga.ZERO:new Ga(e,t)}toFloat64(){return(this.low>>>0)+this.high*4294967296}equals(e){return this.low==e.low&&this.high==e.high}}Ga.ZERO=new Ga(0,0);var xE;(function(a){a[a.UTF8_BYTES=1]="UTF8_BYTES",a[a.UTF16_STRING=2]="UTF16_STRING"})(xE||(xE={}));class ng{constructor(e){this.bytes_=e,this.position_=0}static allocate(e){return new ng(new Uint8Array(e))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(e){this.position_=e}capacity(){return this.bytes_.length}readInt8(e){return this.readUint8(e)<<24>>24}readUint8(e){return this.bytes_[e]}readInt16(e){return this.readUint16(e)<<16>>16}readUint16(e){return this.bytes_[e]|this.bytes_[e+1]<<8}readInt32(e){return this.bytes_[e]|this.bytes_[e+1]<<8|this.bytes_[e+2]<<16|this.bytes_[e+3]<<24}readUint32(e){return this.readInt32(e)>>>0}readInt64(e){return new Ga(this.readInt32(e),this.readInt32(e+4))}readUint64(e){return new Ga(this.readUint32(e),this.readUint32(e+4))}readFloat32(e){return Pl[0]=this.readInt32(e),yP[0]}readFloat64(e){return Pl[o_?0:1]=this.readInt32(e),Pl[o_?1:0]=this.readInt32(e+4),vP[0]}writeInt8(e,t){this.bytes_[e]=t}writeUint8(e,t){this.bytes_[e]=t}writeInt16(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8}writeUint16(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8}writeInt32(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8,this.bytes_[e+2]=t>>16,this.bytes_[e+3]=t>>24}writeUint32(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8,this.bytes_[e+2]=t>>16,this.bytes_[e+3]=t>>24}writeInt64(e,t){this.writeInt32(e,t.low),this.writeInt32(e+4,t.high)}writeUint64(e,t){this.writeUint32(e,t.low),this.writeUint32(e+4,t.high)}writeFloat32(e,t){yP[0]=t,this.writeInt32(e,Pl[0])}writeFloat64(e,t){vP[0]=t,this.writeInt32(e,Pl[o_?0:1]),this.writeInt32(e+4,Pl[o_?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+La+Sc)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let e="";for(let t=0;t<Sc;t++)e+=String.fromCharCode(this.readInt8(this.position_+La+t));return e}__offset(e,t){const n=e-this.readInt32(e);return t<this.readInt16(n)?this.readInt16(n+t):0}__union(e,t){return e.bb_pos=t+this.readInt32(t),e.bb=this,e}__string(e,t){e+=this.readInt32(e);const n=this.readInt32(e);let i="",r=0;if(e+=La,t===xE.UTF8_BYTES)return this.bytes_.subarray(e,e+n);for(;r<n;){let o;const l=this.readUint8(e+r++);if(l<192)o=l;else{const h=this.readUint8(e+r++);if(l<224)o=(l&31)<<6|h&63;else{const u=this.readUint8(e+r++);if(l<240)o=(l&15)<<12|(h&63)<<6|u&63;else{const f=this.readUint8(e+r++);o=(l&7)<<18|(h&63)<<12|(u&63)<<6|f&63}}}o<65536?i+=String.fromCharCode(o):(o-=65536,i+=String.fromCharCode((o>>10)+55296,(o&(1<<10)-1)+56320))}return i}__union_with_string(e,t){return typeof e=="string"?this.__string(t):this.__union(e,t)}__indirect(e){return e+this.readInt32(e)}__vector(e){return e+this.readInt32(e)+La}__vector_len(e){return this.readInt32(e+this.readInt32(e))}__has_identifier(e){if(e.length!=Sc)throw new Error("FlatBuffers: file identifier must be length "+Sc);for(let t=0;t<Sc;t++)if(e.charCodeAt(t)!=this.readInt8(this.position()+La+t))return!1;return!0}createLong(e,t){return Ga.create(e,t)}createScalarList(e,t){const n=[];for(let i=0;i<t;++i)e(i)!==null&&n.push(e(i));return n}createObjList(e,t){const n=[];for(let i=0;i<t;++i){const r=e(i);r!==null&&n.push(r.unpack())}return n}}class Of{constructor(e){this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null;let t;e?t=e:t=1024,this.bb=ng.allocate(t),this.space=t}clear(){this.bb.clear(),this.space=this.bb.capacity(),this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null}forceDefaults(e){this.force_defaults=e}dataBuffer(){return this.bb}asUint8Array(){return this.bb.bytes().subarray(this.bb.position(),this.bb.position()+this.offset())}prep(e,t){e>this.minalign&&(this.minalign=e);const n=~(this.bb.capacity()-this.space+t)+1&e-1;for(;this.space<n+e+t;){const i=this.bb.capacity();this.bb=Of.growByteBuffer(this.bb),this.space+=this.bb.capacity()-i}this.pad(n)}pad(e){for(let t=0;t<e;t++)this.bb.writeInt8(--this.space,0)}writeInt8(e){this.bb.writeInt8(this.space-=1,e)}writeInt16(e){this.bb.writeInt16(this.space-=2,e)}writeInt32(e){this.bb.writeInt32(this.space-=4,e)}writeInt64(e){this.bb.writeInt64(this.space-=8,e)}writeFloat32(e){this.bb.writeFloat32(this.space-=4,e)}writeFloat64(e){this.bb.writeFloat64(this.space-=8,e)}addInt8(e){this.prep(1,0),this.writeInt8(e)}addInt16(e){this.prep(2,0),this.writeInt16(e)}addInt32(e){this.prep(4,0),this.writeInt32(e)}addInt64(e){this.prep(8,0),this.writeInt64(e)}addFloat32(e){this.prep(4,0),this.writeFloat32(e)}addFloat64(e){this.prep(8,0),this.writeFloat64(e)}addFieldInt8(e,t,n){(this.force_defaults||t!=n)&&(this.addInt8(t),this.slot(e))}addFieldInt16(e,t,n){(this.force_defaults||t!=n)&&(this.addInt16(t),this.slot(e))}addFieldInt32(e,t,n){(this.force_defaults||t!=n)&&(this.addInt32(t),this.slot(e))}addFieldInt64(e,t,n){(this.force_defaults||!t.equals(n))&&(this.addInt64(t),this.slot(e))}addFieldFloat32(e,t,n){(this.force_defaults||t!=n)&&(this.addFloat32(t),this.slot(e))}addFieldFloat64(e,t,n){(this.force_defaults||t!=n)&&(this.addFloat64(t),this.slot(e))}addFieldOffset(e,t,n){(this.force_defaults||t!=n)&&(this.addOffset(t),this.slot(e))}addFieldStruct(e,t,n){t!=n&&(this.nested(t),this.slot(e))}nested(e){if(e!=this.offset())throw new Error("FlatBuffers: struct must be serialized inline.")}notNested(){if(this.isNested)throw new Error("FlatBuffers: object serialization must not be nested.")}slot(e){this.vtable!==null&&(this.vtable[e]=this.offset())}offset(){return this.bb.capacity()-this.space}static growByteBuffer(e){const t=e.capacity();if(t&3221225472)throw new Error("FlatBuffers: cannot grow buffer beyond 2 gigabytes.");const n=t<<1,i=ng.allocate(n);return i.setPosition(n-t),i.bytes().set(e.bytes(),n-t),i}addOffset(e){this.prep(La,0),this.writeInt32(this.offset()-e+La)}startObject(e){this.notNested(),this.vtable==null&&(this.vtable=[]),this.vtable_in_use=e;for(let t=0;t<e;t++)this.vtable[t]=0;this.isNested=!0,this.object_start=this.offset()}endObject(){if(this.vtable==null||!this.isNested)throw new Error("FlatBuffers: endObject called without startObject");this.addInt32(0);const e=this.offset();let t=this.vtable_in_use-1;for(;t>=0&&this.vtable[t]==0;t--);const n=t+1;for(;t>=0;t--)this.addInt16(this.vtable[t]!=0?e-this.vtable[t]:0);const i=2;this.addInt16(e-this.object_start);const r=(n+i)*hb;this.addInt16(r);let o=0;const l=this.space;e:for(t=0;t<this.vtables.length;t++){const h=this.bb.capacity()-this.vtables[t];if(r==this.bb.readInt16(h)){for(let u=hb;u<r;u+=hb)if(this.bb.readInt16(l+u)!=this.bb.readInt16(h+u))continue e;o=this.vtables[t];break}}return o?(this.space=this.bb.capacity()-e,this.bb.writeInt32(this.space,o-e)):(this.vtables.push(this.offset()),this.bb.writeInt32(this.bb.capacity()-e,this.offset()-e)),this.isNested=!1,e}finish(e,t,n){const i=n?tv:0;if(t){const r=t;if(this.prep(this.minalign,La+Sc+i),r.length!=Sc)throw new Error("FlatBuffers: file identifier must be length "+Sc);for(let o=Sc-1;o>=0;o--)this.writeInt8(r.charCodeAt(o))}this.prep(this.minalign,La+i),this.addOffset(e),i&&this.addInt32(this.bb.capacity()-this.space),this.bb.setPosition(this.space)}finishSizePrefixed(e,t){this.finish(e,t,!0)}requiredField(e,t){const n=this.bb.capacity()-e,i=n-this.bb.readInt32(n);if(!(this.bb.readInt16(i+t)!=0))throw new Error("FlatBuffers: field "+t+" must be set")}startVector(e,t,n){this.notNested(),this.vector_num_elems=t,this.prep(La,e*t),this.prep(n,e*t)}endVector(){return this.writeInt32(this.vector_num_elems),this.offset()}createSharedString(e){if(!e)return 0;if(this.string_maps||(this.string_maps=new Map),this.string_maps.has(e))return this.string_maps.get(e);const t=this.createString(e);return this.string_maps.set(e,t),t}createString(e){if(!e)return 0;let t;if(e instanceof Uint8Array)t=e;else{t=[];let n=0;for(;n<e.length;){let i;const r=e.charCodeAt(n++);if(r<55296||r>=56320)i=r;else{const o=e.charCodeAt(n++);i=(r<<10)+o+(65536-(55296<<10)-56320)}i<128?t.push(i):(i<2048?t.push(i>>6&31|192):(i<65536?t.push(i>>12&15|224):t.push(i>>18&7|240,i>>12&63|128),t.push(i>>6&63|128)),t.push(i&63|128))}}this.addInt8(0),this.startVector(1,t.length,1),this.bb.setPosition(this.space-=t.length);for(let n=0,i=this.space,r=this.bb.bytes();n<t.length;n++)r[i++]=t[n];return this.endVector()}createLong(e,t){return Ga.create(e,t)}createObjectOffset(e){return e===null?0:typeof e=="string"?this.createString(e):e.pack(this)}createObjectOffsetList(e){const t=[];for(let n=0;n<e.length;++n){const i=e[n];if(i!==null)t.push(this.createObjectOffset(i));else throw new Error("FlatBuffers: Argument for createObjectOffsetList cannot contain null.")}return t}createStructOffsetList(e,t){return t(this,e.length),this.createObjectOffsetList(e),this.endVector()}}const FD={};function uS(a,e){FD[a]=e}function oJ(a){const e=a.getBufferIdentifier(),t=FD[e];return t(a)}function aJ(a){return typeof a.guid=="function"?a.guid():null}function wE(a){throw new Error('Could not dynamically require "'+a+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var kD={exports:{}};(function(a,e){parcelRequire=function(t,n,i,r){var o,l=typeof parcelRequire=="function"&&parcelRequire,h=typeof wE=="function"&&wE;function u(m,A){if(!n[m]){if(!t[m]){var v=typeof parcelRequire=="function"&&parcelRequire;if(!A&&v)return v(m,!0);if(l)return l(m,!0);if(h&&typeof m=="string")return h(m);var w=new Error("Cannot find module '"+m+"'");throw w.code="MODULE_NOT_FOUND",w}S.resolve=function(R){return t[m][1][R]||R},S.cache={};var b=n[m]=new u.Module(m);t[m][0].call(b.exports,S,b,b.exports,this)}return n[m].exports;function S(R){return u(S.resolve(R))}}u.isParcelRequire=!0,u.Module=function(m){this.id=m,this.bundle=u,this.exports={}},u.modules=t,u.cache=n,u.parent=l,u.register=function(m,A){t[m]=[function(v,w){w.exports=A},{}]};for(var f=0;f<i.length;f++)try{u(i[f])}catch(m){o||(o=m)}if(i.length){var g=u(i[i.length-1]);a.exports=g}if(parcelRequire=u,o)throw o;return u}({EgBh:[function(t,n,i){var r={};r.useBlobBuilder=function(){try{return new Blob([]),!1}catch{return!0}}(),r.useArrayBufferView=!r.useBlobBuilder&&function(){try{return new Blob([new Uint8Array([])]).size===0}catch{return!0}}(),n.exports.binaryFeatures=r;var o=n.exports.BlobBuilder;function l(){this._pieces=[],this._parts=[]}typeof window<"u"&&(o=n.exports.BlobBuilder=window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder||window.BlobBuilder),l.prototype.append=function(h){typeof h=="number"?this._pieces.push(h):(this.flush(),this._parts.push(h))},l.prototype.flush=function(){if(this._pieces.length>0){var h=new Uint8Array(this._pieces);r.useArrayBufferView||(h=h.buffer),this._parts.push(h),this._pieces=[]}},l.prototype.getBuffer=function(){if(this.flush(),r.useBlobBuilder){for(var h=new o,u=0,f=this._parts.length;u<f;u++)h.append(this._parts[u]);return h.getBlob()}return new Blob(this._parts)},n.exports.BufferBuilder=l},{}],kdPp:[function(t,n,i){var r=t("./bufferbuilder").BufferBuilder,o=t("./bufferbuilder").binaryFeatures,l={unpack:function(m){return new h(m).unpack()},pack:function(m){var A=new u;return A.pack(m),A.getBuffer()}};function h(m){this.index=0,this.dataBuffer=m,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}function u(){this.bufferBuilder=new r}function f(m){var A=m.charCodeAt(0);return A<=2047?"00":A<=65535?"000":A<=2097151?"0000":A<=67108863?"00000":"000000"}function g(m){return m.length>600?new Blob([m]).size:m.replace(/[^\u0000-\u007F]/g,f).length}n.exports=l,h.prototype.unpack=function(){var m,A=this.unpack_uint8();if(A<128)return A;if((224^A)<32)return(224^A)-32;if((m=160^A)<=15)return this.unpack_raw(m);if((m=176^A)<=15)return this.unpack_string(m);if((m=144^A)<=15)return this.unpack_array(m);if((m=128^A)<=15)return this.unpack_map(m);switch(A){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:case 213:case 214:case 215:return;case 216:return m=this.unpack_uint16(),this.unpack_string(m);case 217:return m=this.unpack_uint32(),this.unpack_string(m);case 218:return m=this.unpack_uint16(),this.unpack_raw(m);case 219:return m=this.unpack_uint32(),this.unpack_raw(m);case 220:return m=this.unpack_uint16(),this.unpack_array(m);case 221:return m=this.unpack_uint32(),this.unpack_array(m);case 222:return m=this.unpack_uint16(),this.unpack_map(m);case 223:return m=this.unpack_uint32(),this.unpack_map(m)}},h.prototype.unpack_uint8=function(){var m=255&this.dataView[this.index];return this.index++,m},h.prototype.unpack_uint16=function(){var m=this.read(2),A=256*(255&m[0])+(255&m[1]);return this.index+=2,A},h.prototype.unpack_uint32=function(){var m=this.read(4),A=256*(256*(256*m[0]+m[1])+m[2])+m[3];return this.index+=4,A},h.prototype.unpack_uint64=function(){var m=this.read(8),A=256*(256*(256*(256*(256*(256*(256*m[0]+m[1])+m[2])+m[3])+m[4])+m[5])+m[6])+m[7];return this.index+=8,A},h.prototype.unpack_int8=function(){var m=this.unpack_uint8();return m<128?m:m-256},h.prototype.unpack_int16=function(){var m=this.unpack_uint16();return m<32768?m:m-65536},h.prototype.unpack_int32=function(){var m=this.unpack_uint32();return m<Math.pow(2,31)?m:m-Math.pow(2,32)},h.prototype.unpack_int64=function(){var m=this.unpack_uint64();return m<Math.pow(2,63)?m:m-Math.pow(2,64)},h.prototype.unpack_raw=function(m){if(this.length<this.index+m)throw new Error("BinaryPackFailure: index is out of range "+this.index+" "+m+" "+this.length);var A=this.dataBuffer.slice(this.index,this.index+m);return this.index+=m,A},h.prototype.unpack_string=function(m){for(var A,v,w=this.read(m),b=0,S="";b<m;)(A=w[b])<128?(S+=String.fromCharCode(A),b++):(192^A)<32?(v=(192^A)<<6|63&w[b+1],S+=String.fromCharCode(v),b+=2):(v=(15&A)<<12|(63&w[b+1])<<6|63&w[b+2],S+=String.fromCharCode(v),b+=3);return this.index+=m,S},h.prototype.unpack_array=function(m){for(var A=new Array(m),v=0;v<m;v++)A[v]=this.unpack();return A},h.prototype.unpack_map=function(m){for(var A={},v=0;v<m;v++){var w=this.unpack(),b=this.unpack();A[w]=b}return A},h.prototype.unpack_float=function(){var m=this.unpack_uint32(),A=(m>>23&255)-127;return(m>>31===0?1:-1)*(8388607&m|8388608)*Math.pow(2,A-23)},h.prototype.unpack_double=function(){var m=this.unpack_uint32(),A=this.unpack_uint32(),v=(m>>20&2047)-1023;return(m>>31===0?1:-1)*((1048575&m|1048576)*Math.pow(2,v-20)+A*Math.pow(2,v-52))},h.prototype.read=function(m){var A=this.index;if(A+m<=this.length)return this.dataView.subarray(A,A+m);throw new Error("BinaryPackFailure: read index out of range")},u.prototype.getBuffer=function(){return this.bufferBuilder.getBuffer()},u.prototype.pack=function(m){var A=typeof m;if(A==="string")this.pack_string(m);else if(A==="number")Math.floor(m)===m?this.pack_integer(m):this.pack_double(m);else if(A==="boolean")m===!0?this.bufferBuilder.append(195):m===!1&&this.bufferBuilder.append(194);else if(A==="undefined")this.bufferBuilder.append(192);else{if(A!=="object")throw new Error('Type "'+A+'" not yet supported');if(m===null)this.bufferBuilder.append(192);else{var v=m.constructor;if(v==Array)this.pack_array(m);else if(v==Blob||v==File||m instanceof Blob||m instanceof File)this.pack_bin(m);else if(v==ArrayBuffer)o.useArrayBufferView?this.pack_bin(new Uint8Array(m)):this.pack_bin(m);else if("BYTES_PER_ELEMENT"in m)o.useArrayBufferView?this.pack_bin(new Uint8Array(m.buffer)):this.pack_bin(m.buffer);else if(v==Object||v.toString().startsWith("class"))this.pack_object(m);else if(v==Date)this.pack_string(m.toString());else{if(typeof m.toBinaryPack!="function")throw new Error('Type "'+v.toString()+'" not yet supported');this.bufferBuilder.append(m.toBinaryPack())}}}this.bufferBuilder.flush()},u.prototype.pack_bin=function(m){var A=m.length||m.byteLength||m.size;if(A<=15)this.pack_uint8(160+A);else if(A<=65535)this.bufferBuilder.append(218),this.pack_uint16(A);else{if(!(A<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(219),this.pack_uint32(A)}this.bufferBuilder.append(m)},u.prototype.pack_string=function(m){var A=g(m);if(A<=15)this.pack_uint8(176+A);else if(A<=65535)this.bufferBuilder.append(216),this.pack_uint16(A);else{if(!(A<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(217),this.pack_uint32(A)}this.bufferBuilder.append(m)},u.prototype.pack_array=function(m){var A=m.length;if(A<=15)this.pack_uint8(144+A);else if(A<=65535)this.bufferBuilder.append(220),this.pack_uint16(A);else{if(!(A<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(221),this.pack_uint32(A)}for(var v=0;v<A;v++)this.pack(m[v])},u.prototype.pack_integer=function(m){if(m>=-32&&m<=127)this.bufferBuilder.append(255&m);else if(m>=0&&m<=255)this.bufferBuilder.append(204),this.pack_uint8(m);else if(m>=-128&&m<=127)this.bufferBuilder.append(208),this.pack_int8(m);else if(m>=0&&m<=65535)this.bufferBuilder.append(205),this.pack_uint16(m);else if(m>=-32768&&m<=32767)this.bufferBuilder.append(209),this.pack_int16(m);else if(m>=0&&m<=4294967295)this.bufferBuilder.append(206),this.pack_uint32(m);else if(m>=-2147483648&&m<=2147483647)this.bufferBuilder.append(210),this.pack_int32(m);else if(m>=-9223372036854776e3&&m<=9223372036854776e3)this.bufferBuilder.append(211),this.pack_int64(m);else{if(!(m>=0&&m<=18446744073709552e3))throw new Error("Invalid integer");this.bufferBuilder.append(207),this.pack_uint64(m)}},u.prototype.pack_double=function(m){var A=0;m<0&&(A=1,m=-m);var v=Math.floor(Math.log(m)/Math.LN2),w=m/Math.pow(2,v)-1,b=Math.floor(w*Math.pow(2,52)),S=Math.pow(2,32),R=A<<31|v+1023<<20|b/S&1048575,M=b%S;this.bufferBuilder.append(203),this.pack_int32(R),this.pack_int32(M)},u.prototype.pack_object=function(m){var A=Object.keys(m).length;if(A<=15)this.pack_uint8(128+A);else if(A<=65535)this.bufferBuilder.append(222),this.pack_uint16(A);else{if(!(A<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(223),this.pack_uint32(A)}for(var v in m)m.hasOwnProperty(v)&&(this.pack(v),this.pack(m[v]))},u.prototype.pack_uint8=function(m){this.bufferBuilder.append(m)},u.prototype.pack_uint16=function(m){this.bufferBuilder.append(m>>8),this.bufferBuilder.append(255&m)},u.prototype.pack_uint32=function(m){var A=4294967295&m;this.bufferBuilder.append((4278190080&A)>>>24),this.bufferBuilder.append((16711680&A)>>>16),this.bufferBuilder.append((65280&A)>>>8),this.bufferBuilder.append(255&A)},u.prototype.pack_uint64=function(m){var A=m/Math.pow(2,32),v=m%Math.pow(2,32);this.bufferBuilder.append((4278190080&A)>>>24),this.bufferBuilder.append((16711680&A)>>>16),this.bufferBuilder.append((65280&A)>>>8),this.bufferBuilder.append(255&A),this.bufferBuilder.append((4278190080&v)>>>24),this.bufferBuilder.append((16711680&v)>>>16),this.bufferBuilder.append((65280&v)>>>8),this.bufferBuilder.append(255&v)},u.prototype.pack_int8=function(m){this.bufferBuilder.append(255&m)},u.prototype.pack_int16=function(m){this.bufferBuilder.append((65280&m)>>8),this.bufferBuilder.append(255&m)},u.prototype.pack_int32=function(m){this.bufferBuilder.append(m>>>24&255),this.bufferBuilder.append((16711680&m)>>>16),this.bufferBuilder.append((65280&m)>>>8),this.bufferBuilder.append(255&m)},u.prototype.pack_int64=function(m){var A=Math.floor(m/Math.pow(2,32)),v=m%Math.pow(2,32);this.bufferBuilder.append((4278190080&A)>>>24),this.bufferBuilder.append((16711680&A)>>>16),this.bufferBuilder.append((65280&A)>>>8),this.bufferBuilder.append(255&A),this.bufferBuilder.append((4278190080&v)>>>24),this.bufferBuilder.append((16711680&v)>>>16),this.bufferBuilder.append((65280&v)>>>8),this.bufferBuilder.append(255&v)}},{"./bufferbuilder":"EgBh"}],iSxC:[function(t,n,i){function r(I,T,B){return T in I?Object.defineProperty(I,T,{value:B,enumerable:!0,configurable:!0,writable:!0}):I[T]=B,I}function o(I){return(o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(T){return typeof T}:function(T){return T&&typeof Symbol=="function"&&T.constructor===Symbol&&T!==Symbol.prototype?"symbol":typeof T})(I)}Object.defineProperty(i,"__esModule",{value:!0}),i.extractVersion=u,i.wrapPeerConnectionEvent=f,i.disableLog=g,i.disableWarnings=m,i.log=A,i.deprecated=v,i.detectBrowser=w,i.compactObject=S,i.walkStats=R,i.filterStats=M;var l=!0,h=!0;function u(I,T,B){var F=I.match(T);return F&&F.length>=B&&parseInt(F[B],10)}function f(I,T,B){if(I.RTCPeerConnection){var F=I.RTCPeerConnection.prototype,D=F.addEventListener;F.addEventListener=function(W,J){if(W!==T)return D.apply(this,arguments);var ee=function(Q){var Y=B(Q);Y&&(J.handleEvent?J.handleEvent(Y):J(Y))};return this._eventMap=this._eventMap||{},this._eventMap[T]||(this._eventMap[T]=new Map),this._eventMap[T].set(J,ee),D.apply(this,[W,ee])};var U=F.removeEventListener;F.removeEventListener=function(W,J){if(W!==T||!this._eventMap||!this._eventMap[T])return U.apply(this,arguments);if(!this._eventMap[T].has(J))return U.apply(this,arguments);var ee=this._eventMap[T].get(J);return this._eventMap[T].delete(J),this._eventMap[T].size===0&&delete this._eventMap[T],Object.keys(this._eventMap).length===0&&delete this._eventMap,U.apply(this,[W,ee])},Object.defineProperty(F,"on"+T,{get:function(){return this["_on"+T]},set:function(W){this["_on"+T]&&(this.removeEventListener(T,this["_on"+T]),delete this["_on"+T]),W&&this.addEventListener(T,this["_on"+T]=W)},enumerable:!0,configurable:!0})}}function g(I){return typeof I!="boolean"?new Error("Argument type: "+o(I)+". Please use a boolean."):(l=I,I?"adapter.js logging disabled":"adapter.js logging enabled")}function m(I){return typeof I!="boolean"?new Error("Argument type: "+o(I)+". Please use a boolean."):(h=!I,"adapter.js deprecation warnings "+(I?"disabled":"enabled"))}function A(){if((typeof window>"u"?"undefined":o(window))==="object"){if(l)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function v(I,T){h&&console.warn(I+" is deprecated, please use "+T+" instead.")}function w(I){var T={browser:null,version:null};if(I===void 0||!I.navigator)return T.browser="Not a browser.",T;var{navigator:B}=I;if(B.mozGetUserMedia)T.browser="firefox",T.version=u(B.userAgent,/Firefox\/(\d+)\./,1);else if(B.webkitGetUserMedia||I.isSecureContext===!1&&I.webkitRTCPeerConnection&&!I.RTCIceGatherer)T.browser="chrome",T.version=u(B.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(B.mediaDevices&&B.userAgent.match(/Edge\/(\d+).(\d+)$/))T.browser="edge",T.version=u(B.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!I.RTCPeerConnection||!B.userAgent.match(/AppleWebKit\/(\d+)\./))return T.browser="Not a supported browser.",T;T.browser="safari",T.version=u(B.userAgent,/AppleWebKit\/(\d+)\./,1),T.supportsUnifiedPlan=I.RTCRtpTransceiver&&"currentDirection"in I.RTCRtpTransceiver.prototype}return T}function b(I){return Object.prototype.toString.call(I)==="[object Object]"}function S(I){return b(I)?Object.keys(I).reduce(function(T,B){var F=b(I[B]),D=F?S(I[B]):I[B],U=F&&!Object.keys(D).length;return D===void 0||U?T:Object.assign(T,r({},B,D))},{}):I}function R(I,T,B){T&&!B.has(T.id)&&(B.set(T.id,T),Object.keys(T).forEach(function(F){F.endsWith("Id")?R(I,I.get(T[F]),B):F.endsWith("Ids")&&T[F].forEach(function(D){R(I,I.get(D),B)})}))}function M(I,T,B){var F=B?"outbound-rtp":"inbound-rtp",D=new Map;if(T===null)return D;var U=[];return I.forEach(function(W){W.type==="track"&&W.trackIdentifier===T.id&&U.push(W)}),U.forEach(function(W){I.forEach(function(J){J.type===F&&J.trackId===W.id&&R(I,J,D)})}),D}},{}],s6SN:[function(t,n,i){Object.defineProperty(i,"__esModule",{value:!0}),i.shimGetUserMedia=f;var r=l(t("../utils.js"));function o(){if(typeof WeakMap!="function")return null;var g=new WeakMap;return o=function(){return g},g}function l(g){if(g&&g.__esModule)return g;if(g===null||typeof g!="object"&&typeof g!="function")return{default:g};var m=o();if(m&&m.has(g))return m.get(g);var A={},v=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var w in g)if(Object.prototype.hasOwnProperty.call(g,w)){var b=v?Object.getOwnPropertyDescriptor(g,w):null;b&&(b.get||b.set)?Object.defineProperty(A,w,b):A[w]=g[w]}return A.default=g,m&&m.set(g,A),A}function h(g){return(h=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(m){return typeof m}:function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m})(g)}var u=r.log;function f(g,m){var A=g&&g.navigator;if(A.mediaDevices){var v=function(R){if(h(R)!=="object"||R.mandatory||R.optional)return R;var M={};return Object.keys(R).forEach(function(I){if(I!=="require"&&I!=="advanced"&&I!=="mediaSource"){var T=h(R[I])==="object"?R[I]:{ideal:R[I]};T.exact!==void 0&&typeof T.exact=="number"&&(T.min=T.max=T.exact);var B=function(D,U){return D?D+U.charAt(0).toUpperCase()+U.slice(1):U==="deviceId"?"sourceId":U};if(T.ideal!==void 0){M.optional=M.optional||[];var F={};typeof T.ideal=="number"?(F[B("min",I)]=T.ideal,M.optional.push(F),(F={})[B("max",I)]=T.ideal,M.optional.push(F)):(F[B("",I)]=T.ideal,M.optional.push(F))}T.exact!==void 0&&typeof T.exact!="number"?(M.mandatory=M.mandatory||{},M.mandatory[B("",I)]=T.exact):["min","max"].forEach(function(D){T[D]!==void 0&&(M.mandatory=M.mandatory||{},M.mandatory[B(D,I)]=T[D])})}}),R.advanced&&(M.optional=(M.optional||[]).concat(R.advanced)),M},w=function(R,M){if(m.version>=61)return M(R);if((R=JSON.parse(JSON.stringify(R)))&&h(R.audio)==="object"){var I=function(D,U,W){U in D&&!(W in D)&&(D[W]=D[U],delete D[U])};I((R=JSON.parse(JSON.stringify(R))).audio,"autoGainControl","googAutoGainControl"),I(R.audio,"noiseSuppression","googNoiseSuppression"),R.audio=v(R.audio)}if(R&&h(R.video)==="object"){var T=R.video.facingMode;T=T&&(h(T)==="object"?T:{ideal:T});var B,F=m.version<66;if(T&&(T.exact==="user"||T.exact==="environment"||T.ideal==="user"||T.ideal==="environment")&&(!A.mediaDevices.getSupportedConstraints||!A.mediaDevices.getSupportedConstraints().facingMode||F)&&(delete R.video.facingMode,T.exact==="environment"||T.ideal==="environment"?B=["back","rear"]:T.exact!=="user"&&T.ideal!=="user"||(B=["front"]),B))return A.mediaDevices.enumerateDevices().then(function(D){var U=(D=D.filter(function(W){return W.kind==="videoinput"})).find(function(W){return B.some(function(J){return W.label.toLowerCase().includes(J)})});return!U&&D.length&&B.includes("back")&&(U=D[D.length-1]),U&&(R.video.deviceId=T.exact?{exact:U.deviceId}:{ideal:U.deviceId}),R.video=v(R.video),u("chrome: "+JSON.stringify(R)),M(R)});R.video=v(R.video)}return u("chrome: "+JSON.stringify(R)),M(R)},b=function(R){return m.version>=64?R:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[R.name]||R.name,message:R.message,constraint:R.constraint||R.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};if(A.getUserMedia=function(R,M,I){w(R,function(T){A.webkitGetUserMedia(T,M,function(B){I&&I(b(B))})})}.bind(A),A.mediaDevices.getUserMedia){var S=A.mediaDevices.getUserMedia.bind(A.mediaDevices);A.mediaDevices.getUserMedia=function(R){return w(R,function(M){return S(M).then(function(I){if(M.audio&&!I.getAudioTracks().length||M.video&&!I.getVideoTracks().length)throw I.getTracks().forEach(function(T){T.stop()}),new DOMException("","NotFoundError");return I},function(I){return Promise.reject(b(I))})})}}}}},{"../utils.js":"iSxC"}],VHa8:[function(t,n,i){function r(o,l){o.navigator.mediaDevices&&"getDisplayMedia"in o.navigator.mediaDevices||o.navigator.mediaDevices&&(typeof l=="function"?o.navigator.mediaDevices.getDisplayMedia=function(h){return l(h).then(function(u){var f=h.video&&h.video.width,g=h.video&&h.video.height,m=h.video&&h.video.frameRate;return h.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:u,maxFrameRate:m||3}},f&&(h.video.mandatory.maxWidth=f),g&&(h.video.mandatory.maxHeight=g),o.navigator.mediaDevices.getUserMedia(h)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}Object.defineProperty(i,"__esModule",{value:!0}),i.shimGetDisplayMedia=r},{}],uI5X:[function(t,n,i){Object.defineProperty(i,"__esModule",{value:!0}),i.shimMediaStream=m,i.shimOnTrack=A,i.shimGetSendersWithDtmf=v,i.shimGetStats=w,i.shimSenderReceiverGetStats=b,i.shimAddTrackRemoveTrackWithNative=S,i.shimAddTrackRemoveTrack=R,i.shimPeerConnection=M,i.fixNegotiationNeeded=I,Object.defineProperty(i,"shimGetUserMedia",{enumerable:!0,get:function(){return o.shimGetUserMedia}}),Object.defineProperty(i,"shimGetDisplayMedia",{enumerable:!0,get:function(){return l.shimGetDisplayMedia}});var r=u(t("../utils.js")),o=t("./getusermedia"),l=t("./getdisplaymedia");function h(){if(typeof WeakMap!="function")return null;var T=new WeakMap;return h=function(){return T},T}function u(T){if(T&&T.__esModule)return T;if(T===null||typeof T!="object"&&typeof T!="function")return{default:T};var B=h();if(B&&B.has(T))return B.get(T);var F={},D=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var U in T)if(Object.prototype.hasOwnProperty.call(T,U)){var W=D?Object.getOwnPropertyDescriptor(T,U):null;W&&(W.get||W.set)?Object.defineProperty(F,U,W):F[U]=T[U]}return F.default=T,B&&B.set(T,F),F}function f(T,B,F){return B in T?Object.defineProperty(T,B,{value:F,enumerable:!0,configurable:!0,writable:!0}):T[B]=F,T}function g(T){return(g=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(B){return typeof B}:function(B){return B&&typeof Symbol=="function"&&B.constructor===Symbol&&B!==Symbol.prototype?"symbol":typeof B})(T)}function m(T){T.MediaStream=T.MediaStream||T.webkitMediaStream}function A(T){if(g(T)!=="object"||!T.RTCPeerConnection||"ontrack"in T.RTCPeerConnection.prototype)r.wrapPeerConnectionEvent(T,"track",function(F){return F.transceiver||Object.defineProperty(F,"transceiver",{value:{receiver:F.receiver}}),F});else{Object.defineProperty(T.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(F){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=F)},enumerable:!0,configurable:!0});var B=T.RTCPeerConnection.prototype.setRemoteDescription;T.RTCPeerConnection.prototype.setRemoteDescription=function(){var F=this;return this._ontrackpoly||(this._ontrackpoly=function(D){D.stream.addEventListener("addtrack",function(U){var W;W=T.RTCPeerConnection.prototype.getReceivers?F.getReceivers().find(function(ee){return ee.track&&ee.track.id===U.track.id}):{track:U.track};var J=new Event("track");J.track=U.track,J.receiver=W,J.transceiver={receiver:W},J.streams=[D.stream],F.dispatchEvent(J)}),D.stream.getTracks().forEach(function(U){var W;W=T.RTCPeerConnection.prototype.getReceivers?F.getReceivers().find(function(ee){return ee.track&&ee.track.id===U.id}):{track:U};var J=new Event("track");J.track=U,J.receiver=W,J.transceiver={receiver:W},J.streams=[D.stream],F.dispatchEvent(J)})},this.addEventListener("addstream",this._ontrackpoly)),B.apply(this,arguments)}}}function v(T){if(g(T)==="object"&&T.RTCPeerConnection&&!("getSenders"in T.RTCPeerConnection.prototype)&&"createDTMFSender"in T.RTCPeerConnection.prototype){var B=function(ee,Q){return{track:Q,get dtmf(){return this._dtmf===void 0&&(Q.kind==="audio"?this._dtmf=ee.createDTMFSender(Q):this._dtmf=null),this._dtmf},_pc:ee}};if(!T.RTCPeerConnection.prototype.getSenders){T.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var F=T.RTCPeerConnection.prototype.addTrack;T.RTCPeerConnection.prototype.addTrack=function(ee,Q){var Y=F.apply(this,arguments);return Y||(Y=B(this,ee),this._senders.push(Y)),Y};var D=T.RTCPeerConnection.prototype.removeTrack;T.RTCPeerConnection.prototype.removeTrack=function(ee){D.apply(this,arguments);var Q=this._senders.indexOf(ee);Q!==-1&&this._senders.splice(Q,1)}}var U=T.RTCPeerConnection.prototype.addStream;T.RTCPeerConnection.prototype.addStream=function(ee){var Q=this;this._senders=this._senders||[],U.apply(this,[ee]),ee.getTracks().forEach(function(Y){Q._senders.push(B(Q,Y))})};var W=T.RTCPeerConnection.prototype.removeStream;T.RTCPeerConnection.prototype.removeStream=function(ee){var Q=this;this._senders=this._senders||[],W.apply(this,[ee]),ee.getTracks().forEach(function(Y){var se=Q._senders.find(function(ae){return ae.track===Y});se&&Q._senders.splice(Q._senders.indexOf(se),1)})}}else if(g(T)==="object"&&T.RTCPeerConnection&&"getSenders"in T.RTCPeerConnection.prototype&&"createDTMFSender"in T.RTCPeerConnection.prototype&&T.RTCRtpSender&&!("dtmf"in T.RTCRtpSender.prototype)){var J=T.RTCPeerConnection.prototype.getSenders;T.RTCPeerConnection.prototype.getSenders=function(){var ee=this,Q=J.apply(this,[]);return Q.forEach(function(Y){return Y._pc=ee}),Q},Object.defineProperty(T.RTCRtpSender.prototype,"dtmf",{get:function(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function w(T){if(T.RTCPeerConnection){var B=T.RTCPeerConnection.prototype.getStats;T.RTCPeerConnection.prototype.getStats=function(){var F=this,[D,U,W]=arguments;if(arguments.length>0&&typeof D=="function")return B.apply(this,arguments);if(B.length===0&&(arguments.length===0||typeof D!="function"))return B.apply(this,[]);var J=function(Q){var Y={};return Q.result().forEach(function(se){var ae={id:se.id,timestamp:se.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[se.type]||se.type};se.names().forEach(function(ve){ae[ve]=se.stat(ve)}),Y[ae.id]=ae}),Y},ee=function(Q){return new Map(Object.keys(Q).map(function(Y){return[Y,Q[Y]]}))};return arguments.length>=2?B.apply(this,[function(Q){U(ee(J(Q)))},D]):new Promise(function(Q,Y){B.apply(F,[function(se){Q(ee(J(se)))},Y])}).then(U,W)}}}function b(T){if(g(T)==="object"&&T.RTCPeerConnection&&T.RTCRtpSender&&T.RTCRtpReceiver){if(!("getStats"in T.RTCRtpSender.prototype)){var B=T.RTCPeerConnection.prototype.getSenders;B&&(T.RTCPeerConnection.prototype.getSenders=function(){var W=this,J=B.apply(this,[]);return J.forEach(function(ee){return ee._pc=W}),J});var F=T.RTCPeerConnection.prototype.addTrack;F&&(T.RTCPeerConnection.prototype.addTrack=function(){var W=F.apply(this,arguments);return W._pc=this,W}),T.RTCRtpSender.prototype.getStats=function(){var W=this;return this._pc.getStats().then(function(J){return r.filterStats(J,W.track,!0)})}}if(!("getStats"in T.RTCRtpReceiver.prototype)){var D=T.RTCPeerConnection.prototype.getReceivers;D&&(T.RTCPeerConnection.prototype.getReceivers=function(){var W=this,J=D.apply(this,[]);return J.forEach(function(ee){return ee._pc=W}),J}),r.wrapPeerConnectionEvent(T,"track",function(W){return W.receiver._pc=W.srcElement,W}),T.RTCRtpReceiver.prototype.getStats=function(){var W=this;return this._pc.getStats().then(function(J){return r.filterStats(J,W.track,!1)})}}if("getStats"in T.RTCRtpSender.prototype&&"getStats"in T.RTCRtpReceiver.prototype){var U=T.RTCPeerConnection.prototype.getStats;T.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof T.MediaStreamTrack){var W,J,ee,Q=arguments[0];return this.getSenders().forEach(function(Y){Y.track===Q&&(W?ee=!0:W=Y)}),this.getReceivers().forEach(function(Y){return Y.track===Q&&(J?ee=!0:J=Y),Y.track===Q}),ee||W&&J?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):W?W.getStats():J?J.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return U.apply(this,arguments)}}}}function S(T){T.RTCPeerConnection.prototype.getLocalStreams=function(){var W=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(J){return W._shimmedLocalStreams[J][0]})};var B=T.RTCPeerConnection.prototype.addTrack;T.RTCPeerConnection.prototype.addTrack=function(W,J){if(!J)return B.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var ee=B.apply(this,arguments);return this._shimmedLocalStreams[J.id]?this._shimmedLocalStreams[J.id].indexOf(ee)===-1&&this._shimmedLocalStreams[J.id].push(ee):this._shimmedLocalStreams[J.id]=[J,ee],ee};var F=T.RTCPeerConnection.prototype.addStream;T.RTCPeerConnection.prototype.addStream=function(W){var J=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},W.getTracks().forEach(function(Y){if(J.getSenders().find(function(se){return se.track===Y}))throw new DOMException("Track already exists.","InvalidAccessError")});var ee=this.getSenders();F.apply(this,arguments);var Q=this.getSenders().filter(function(Y){return ee.indexOf(Y)===-1});this._shimmedLocalStreams[W.id]=[W].concat(Q)};var D=T.RTCPeerConnection.prototype.removeStream;T.RTCPeerConnection.prototype.removeStream=function(W){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[W.id],D.apply(this,arguments)};var U=T.RTCPeerConnection.prototype.removeTrack;T.RTCPeerConnection.prototype.removeTrack=function(W){var J=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},W&&Object.keys(this._shimmedLocalStreams).forEach(function(ee){var Q=J._shimmedLocalStreams[ee].indexOf(W);Q!==-1&&J._shimmedLocalStreams[ee].splice(Q,1),J._shimmedLocalStreams[ee].length===1&&delete J._shimmedLocalStreams[ee]}),U.apply(this,arguments)}}function R(T,B){if(T.RTCPeerConnection){if(T.RTCPeerConnection.prototype.addTrack&&B.version>=65)return S(T);var F=T.RTCPeerConnection.prototype.getLocalStreams;T.RTCPeerConnection.prototype.getLocalStreams=function(){var Q=this,Y=F.apply(this);return this._reverseStreams=this._reverseStreams||{},Y.map(function(se){return Q._reverseStreams[se.id]})};var D=T.RTCPeerConnection.prototype.addStream;T.RTCPeerConnection.prototype.addStream=function(Q){var Y=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},Q.getTracks().forEach(function(ae){if(Y.getSenders().find(function(ve){return ve.track===ae}))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[Q.id]){var se=new T.MediaStream(Q.getTracks());this._streams[Q.id]=se,this._reverseStreams[se.id]=Q,Q=se}D.apply(this,[Q])};var U=T.RTCPeerConnection.prototype.removeStream;T.RTCPeerConnection.prototype.removeStream=function(Q){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},U.apply(this,[this._streams[Q.id]||Q]),delete this._reverseStreams[this._streams[Q.id]?this._streams[Q.id].id:Q.id],delete this._streams[Q.id]},T.RTCPeerConnection.prototype.addTrack=function(Q,Y){var se=this;if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var ae=[].slice.call(arguments,1);if(ae.length!==1||!ae[0].getTracks().find(function(Ae){return Ae===Q}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(function(Ae){return Ae.track===Q}))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var ve=this._streams[Y.id];if(ve)ve.addTrack(Q),Promise.resolve().then(function(){se.dispatchEvent(new Event("negotiationneeded"))});else{var xe=new T.MediaStream([Q]);this._streams[Y.id]=xe,this._reverseStreams[xe.id]=Y,this.addStream(xe)}return this.getSenders().find(function(Ae){return Ae.track===Q})},["createOffer","createAnswer"].forEach(function(Q){var Y=T.RTCPeerConnection.prototype[Q],se=f({},Q,function(){var ae=this,ve=arguments;return arguments.length&&typeof arguments[0]=="function"?Y.apply(this,[function(xe){var Ae=ee(ae,xe);ve[0].apply(null,[Ae])},function(xe){ve[1]&&ve[1].apply(null,xe)},arguments[2]]):Y.apply(this,arguments).then(function(xe){return ee(ae,xe)})});T.RTCPeerConnection.prototype[Q]=se[Q]});var W=T.RTCPeerConnection.prototype.setLocalDescription;T.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=(Q=this,Y=arguments[0],se=Y.sdp,Object.keys(Q._reverseStreams||[]).forEach(function(ae){var ve=Q._reverseStreams[ae],xe=Q._streams[ve.id];se=se.replace(new RegExp(ve.id,"g"),xe.id)}),new RTCSessionDescription({type:Y.type,sdp:se})),W.apply(this,arguments)):W.apply(this,arguments);var Q,Y,se};var J=Object.getOwnPropertyDescriptor(T.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(T.RTCPeerConnection.prototype,"localDescription",{get:function(){var Q=J.get.apply(this);return Q.type===""?Q:ee(this,Q)}}),T.RTCPeerConnection.prototype.removeTrack=function(Q){var Y,se=this;if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!Q._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(Q._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{},Object.keys(this._streams).forEach(function(ae){se._streams[ae].getTracks().find(function(ve){return Q.track===ve})&&(Y=se._streams[ae])}),Y&&(Y.getTracks().length===1?this.removeStream(this._reverseStreams[Y.id]):Y.removeTrack(Q.track),this.dispatchEvent(new Event("negotiationneeded")))}}function ee(Q,Y){var se=Y.sdp;return Object.keys(Q._reverseStreams||[]).forEach(function(ae){var ve=Q._reverseStreams[ae],xe=Q._streams[ve.id];se=se.replace(new RegExp(xe.id,"g"),ve.id)}),new RTCSessionDescription({type:Y.type,sdp:se})}}function M(T,B){!T.RTCPeerConnection&&T.webkitRTCPeerConnection&&(T.RTCPeerConnection=T.webkitRTCPeerConnection),T.RTCPeerConnection&&B.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(F){var D=T.RTCPeerConnection.prototype[F],U=f({},F,function(){return arguments[0]=new(F==="addIceCandidate"?T.RTCIceCandidate:T.RTCSessionDescription)(arguments[0]),D.apply(this,arguments)});T.RTCPeerConnection.prototype[F]=U[F]})}function I(T,B){r.wrapPeerConnectionEvent(T,"negotiationneeded",function(F){var D=F.target;if(!(B.version<72||D.getConfiguration&&D.getConfiguration().sdpSemantics==="plan-b")||D.signalingState==="stable")return F})}},{"../utils.js":"iSxC","./getusermedia":"s6SN","./getdisplaymedia":"VHa8"}],NZ1C:[function(t,n,i){Object.defineProperty(i,"__esModule",{value:!0}),i.filterIceServers=h;var r=l(t("../utils"));function o(){if(typeof WeakMap!="function")return null;var u=new WeakMap;return o=function(){return u},u}function l(u){if(u&&u.__esModule)return u;if(u===null||typeof u!="object"&&typeof u!="function")return{default:u};var f=o();if(f&&f.has(u))return f.get(u);var g={},m=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var A in u)if(Object.prototype.hasOwnProperty.call(u,A)){var v=m?Object.getOwnPropertyDescriptor(u,A):null;v&&(v.get||v.set)?Object.defineProperty(g,A,v):g[A]=u[A]}return g.default=u,f&&f.set(u,g),g}function h(u,f){var g=!1;return(u=JSON.parse(JSON.stringify(u))).filter(function(m){if(m&&(m.urls||m.url)){var A=m.urls||m.url;m.url&&!m.urls&&r.deprecated("RTCIceServer.url","RTCIceServer.urls");var v=typeof A=="string";return v&&(A=[A]),A=A.filter(function(w){if(w.indexOf("stun:")===0)return!1;var b=w.startsWith("turn")&&!w.startsWith("turn:[")&&w.includes("transport=udp");return b&&!g?(g=!0,!0):b&&!g}),delete m.url,m.urls=v?A[0]:A,!!A.length}})}},{"../utils":"iSxC"}],YHvh:[function(t,n,i){var r={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};r.localCName=r.generateIdentifier(),r.splitLines=function(o){return o.trim().split(`
`).map(function(l){return l.trim()})},r.splitSections=function(o){return o.split(`
m=`).map(function(l,h){return(h>0?"m="+l:l).trim()+`\r
`})},r.getDescription=function(o){var l=r.splitSections(o);return l&&l[0]},r.getMediaSections=function(o){var l=r.splitSections(o);return l.shift(),l},r.matchPrefix=function(o,l){return r.splitLines(o).filter(function(h){return h.indexOf(l)===0})},r.parseCandidate=function(o){for(var l,h={foundation:(l=o.indexOf("a=candidate:")===0?o.substring(12).split(" "):o.substring(10).split(" "))[0],component:parseInt(l[1],10),protocol:l[2].toLowerCase(),priority:parseInt(l[3],10),ip:l[4],address:l[4],port:parseInt(l[5],10),type:l[7]},u=8;u<l.length;u+=2)switch(l[u]){case"raddr":h.relatedAddress=l[u+1];break;case"rport":h.relatedPort=parseInt(l[u+1],10);break;case"tcptype":h.tcpType=l[u+1];break;case"ufrag":h.ufrag=l[u+1],h.usernameFragment=l[u+1];break;default:h[l[u]]=l[u+1]}return h},r.writeCandidate=function(o){var l=[];l.push(o.foundation),l.push(o.component),l.push(o.protocol.toUpperCase()),l.push(o.priority),l.push(o.address||o.ip),l.push(o.port);var h=o.type;return l.push("typ"),l.push(h),h!=="host"&&o.relatedAddress&&o.relatedPort&&(l.push("raddr"),l.push(o.relatedAddress),l.push("rport"),l.push(o.relatedPort)),o.tcpType&&o.protocol.toLowerCase()==="tcp"&&(l.push("tcptype"),l.push(o.tcpType)),(o.usernameFragment||o.ufrag)&&(l.push("ufrag"),l.push(o.usernameFragment||o.ufrag)),"candidate:"+l.join(" ")},r.parseIceOptions=function(o){return o.substr(14).split(" ")},r.parseRtpMap=function(o){var l=o.substr(9).split(" "),h={payloadType:parseInt(l.shift(),10)};return l=l[0].split("/"),h.name=l[0],h.clockRate=parseInt(l[1],10),h.channels=l.length===3?parseInt(l[2],10):1,h.numChannels=h.channels,h},r.writeRtpMap=function(o){var l=o.payloadType;o.preferredPayloadType!==void 0&&(l=o.preferredPayloadType);var h=o.channels||o.numChannels||1;return"a=rtpmap:"+l+" "+o.name+"/"+o.clockRate+(h!==1?"/"+h:"")+`\r
`},r.parseExtmap=function(o){var l=o.substr(9).split(" ");return{id:parseInt(l[0],10),direction:l[0].indexOf("/")>0?l[0].split("/")[1]:"sendrecv",uri:l[1]}},r.writeExtmap=function(o){return"a=extmap:"+(o.id||o.preferredId)+(o.direction&&o.direction!=="sendrecv"?"/"+o.direction:"")+" "+o.uri+`\r
`},r.parseFmtp=function(o){for(var l,h={},u=o.substr(o.indexOf(" ")+1).split(";"),f=0;f<u.length;f++)h[(l=u[f].trim().split("="))[0].trim()]=l[1];return h},r.writeFmtp=function(o){var l="",h=o.payloadType;if(o.preferredPayloadType!==void 0&&(h=o.preferredPayloadType),o.parameters&&Object.keys(o.parameters).length){var u=[];Object.keys(o.parameters).forEach(function(f){o.parameters[f]?u.push(f+"="+o.parameters[f]):u.push(f)}),l+="a=fmtp:"+h+" "+u.join(";")+`\r
`}return l},r.parseRtcpFb=function(o){var l=o.substr(o.indexOf(" ")+1).split(" ");return{type:l.shift(),parameter:l.join(" ")}},r.writeRtcpFb=function(o){var l="",h=o.payloadType;return o.preferredPayloadType!==void 0&&(h=o.preferredPayloadType),o.rtcpFeedback&&o.rtcpFeedback.length&&o.rtcpFeedback.forEach(function(u){l+="a=rtcp-fb:"+h+" "+u.type+(u.parameter&&u.parameter.length?" "+u.parameter:"")+`\r
`}),l},r.parseSsrcMedia=function(o){var l=o.indexOf(" "),h={ssrc:parseInt(o.substr(7,l-7),10)},u=o.indexOf(":",l);return u>-1?(h.attribute=o.substr(l+1,u-l-1),h.value=o.substr(u+1)):h.attribute=o.substr(l+1),h},r.parseSsrcGroup=function(o){var l=o.substr(13).split(" ");return{semantics:l.shift(),ssrcs:l.map(function(h){return parseInt(h,10)})}},r.getMid=function(o){var l=r.matchPrefix(o,"a=mid:")[0];if(l)return l.substr(6)},r.parseFingerprint=function(o){var l=o.substr(14).split(" ");return{algorithm:l[0].toLowerCase(),value:l[1]}},r.getDtlsParameters=function(o,l){return{role:"auto",fingerprints:r.matchPrefix(o+l,"a=fingerprint:").map(r.parseFingerprint)}},r.writeDtlsParameters=function(o,l){var h="a=setup:"+l+`\r
`;return o.fingerprints.forEach(function(u){h+="a=fingerprint:"+u.algorithm+" "+u.value+`\r
`}),h},r.parseCryptoLine=function(o){var l=o.substr(9).split(" ");return{tag:parseInt(l[0],10),cryptoSuite:l[1],keyParams:l[2],sessionParams:l.slice(3)}},r.writeCryptoLine=function(o){return"a=crypto:"+o.tag+" "+o.cryptoSuite+" "+(typeof o.keyParams=="object"?r.writeCryptoKeyParams(o.keyParams):o.keyParams)+(o.sessionParams?" "+o.sessionParams.join(" "):"")+`\r
`},r.parseCryptoKeyParams=function(o){if(o.indexOf("inline:")!==0)return null;var l=o.substr(7).split("|");return{keyMethod:"inline",keySalt:l[0],lifeTime:l[1],mkiValue:l[2]?l[2].split(":")[0]:void 0,mkiLength:l[2]?l[2].split(":")[1]:void 0}},r.writeCryptoKeyParams=function(o){return o.keyMethod+":"+o.keySalt+(o.lifeTime?"|"+o.lifeTime:"")+(o.mkiValue&&o.mkiLength?"|"+o.mkiValue+":"+o.mkiLength:"")},r.getCryptoParameters=function(o,l){return r.matchPrefix(o+l,"a=crypto:").map(r.parseCryptoLine)},r.getIceParameters=function(o,l){var h=r.matchPrefix(o+l,"a=ice-ufrag:")[0],u=r.matchPrefix(o+l,"a=ice-pwd:")[0];return h&&u?{usernameFragment:h.substr(12),password:u.substr(10)}:null},r.writeIceParameters=function(o){return"a=ice-ufrag:"+o.usernameFragment+`\r
a=ice-pwd:`+o.password+`\r
`},r.parseRtpParameters=function(o){for(var l={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},h=r.splitLines(o)[0].split(" "),u=3;u<h.length;u++){var f=h[u],g=r.matchPrefix(o,"a=rtpmap:"+f+" ")[0];if(g){var m=r.parseRtpMap(g),A=r.matchPrefix(o,"a=fmtp:"+f+" ");switch(m.parameters=A.length?r.parseFmtp(A[0]):{},m.rtcpFeedback=r.matchPrefix(o,"a=rtcp-fb:"+f+" ").map(r.parseRtcpFb),l.codecs.push(m),m.name.toUpperCase()){case"RED":case"ULPFEC":l.fecMechanisms.push(m.name.toUpperCase())}}}return r.matchPrefix(o,"a=extmap:").forEach(function(v){l.headerExtensions.push(r.parseExtmap(v))}),l},r.writeRtpDescription=function(o,l){var h="";h+="m="+o+" ",h+=l.codecs.length>0?"9":"0",h+=" UDP/TLS/RTP/SAVPF ",h+=l.codecs.map(function(f){return f.preferredPayloadType!==void 0?f.preferredPayloadType:f.payloadType}).join(" ")+`\r
`,h+=`c=IN IP4 0.0.0.0\r
`,h+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,l.codecs.forEach(function(f){h+=r.writeRtpMap(f),h+=r.writeFmtp(f),h+=r.writeRtcpFb(f)});var u=0;return l.codecs.forEach(function(f){f.maxptime>u&&(u=f.maxptime)}),u>0&&(h+="a=maxptime:"+u+`\r
`),h+=`a=rtcp-mux\r
`,l.headerExtensions&&l.headerExtensions.forEach(function(f){h+=r.writeExtmap(f)}),h},r.parseRtpEncodingParameters=function(o){var l,h=[],u=r.parseRtpParameters(o),f=u.fecMechanisms.indexOf("RED")!==-1,g=u.fecMechanisms.indexOf("ULPFEC")!==-1,m=r.matchPrefix(o,"a=ssrc:").map(function(b){return r.parseSsrcMedia(b)}).filter(function(b){return b.attribute==="cname"}),A=m.length>0&&m[0].ssrc,v=r.matchPrefix(o,"a=ssrc-group:FID").map(function(b){return b.substr(17).split(" ").map(function(S){return parseInt(S,10)})});v.length>0&&v[0].length>1&&v[0][0]===A&&(l=v[0][1]),u.codecs.forEach(function(b){if(b.name.toUpperCase()==="RTX"&&b.parameters.apt){var S={ssrc:A,codecPayloadType:parseInt(b.parameters.apt,10)};A&&l&&(S.rtx={ssrc:l}),h.push(S),f&&((S=JSON.parse(JSON.stringify(S))).fec={ssrc:A,mechanism:g?"red+ulpfec":"red"},h.push(S))}}),h.length===0&&A&&h.push({ssrc:A});var w=r.matchPrefix(o,"b=");return w.length&&(w=w[0].indexOf("b=TIAS:")===0?parseInt(w[0].substr(7),10):w[0].indexOf("b=AS:")===0?1e3*parseInt(w[0].substr(5),10)*.95-16e3:void 0,h.forEach(function(b){b.maxBitrate=w})),h},r.parseRtcpParameters=function(o){var l={},h=r.matchPrefix(o,"a=ssrc:").map(function(g){return r.parseSsrcMedia(g)}).filter(function(g){return g.attribute==="cname"})[0];h&&(l.cname=h.value,l.ssrc=h.ssrc);var u=r.matchPrefix(o,"a=rtcp-rsize");l.reducedSize=u.length>0,l.compound=u.length===0;var f=r.matchPrefix(o,"a=rtcp-mux");return l.mux=f.length>0,l},r.parseMsid=function(o){var l,h=r.matchPrefix(o,"a=msid:");if(h.length===1)return{stream:(l=h[0].substr(7).split(" "))[0],track:l[1]};var u=r.matchPrefix(o,"a=ssrc:").map(function(f){return r.parseSsrcMedia(f)}).filter(function(f){return f.attribute==="msid"});return u.length>0?{stream:(l=u[0].value.split(" "))[0],track:l[1]}:void 0},r.parseSctpDescription=function(o){var l,h=r.parseMLine(o),u=r.matchPrefix(o,"a=max-message-size:");u.length>0&&(l=parseInt(u[0].substr(19),10)),isNaN(l)&&(l=65536);var f=r.matchPrefix(o,"a=sctp-port:");if(f.length>0)return{port:parseInt(f[0].substr(12),10),protocol:h.fmt,maxMessageSize:l};if(r.matchPrefix(o,"a=sctpmap:").length>0){var g=r.matchPrefix(o,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(g[0],10),protocol:g[1],maxMessageSize:l}}},r.writeSctpDescription=function(o,l){var h=[];return h=o.protocol!=="DTLS/SCTP"?["m="+o.kind+" 9 "+o.protocol+" "+l.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+l.port+`\r
`]:["m="+o.kind+" 9 "+o.protocol+" "+l.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+l.port+" "+l.protocol+` 65535\r
`],l.maxMessageSize!==void 0&&h.push("a=max-message-size:"+l.maxMessageSize+`\r
`),h.join("")},r.generateSessionId=function(){return Math.random().toString().substr(2,21)},r.writeSessionBoilerplate=function(o,l,h){var u=l!==void 0?l:2;return`v=0\r
o=`+(h||"thisisadapterortc")+" "+(o||r.generateSessionId())+" "+u+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},r.writeMediaSection=function(o,l,h,u){var f=r.writeRtpDescription(o.kind,l);if(f+=r.writeIceParameters(o.iceGatherer.getLocalParameters()),f+=r.writeDtlsParameters(o.dtlsTransport.getLocalParameters(),h==="offer"?"actpass":"active"),f+="a=mid:"+o.mid+`\r
`,o.direction?f+="a="+o.direction+`\r
`:o.rtpSender&&o.rtpReceiver?f+=`a=sendrecv\r
`:o.rtpSender?f+=`a=sendonly\r
`:o.rtpReceiver?f+=`a=recvonly\r
`:f+=`a=inactive\r
`,o.rtpSender){var g="msid:"+u.id+" "+o.rtpSender.track.id+`\r
`;f+="a="+g,f+="a=ssrc:"+o.sendEncodingParameters[0].ssrc+" "+g,o.sendEncodingParameters[0].rtx&&(f+="a=ssrc:"+o.sendEncodingParameters[0].rtx.ssrc+" "+g,f+="a=ssrc-group:FID "+o.sendEncodingParameters[0].ssrc+" "+o.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return f+="a=ssrc:"+o.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+`\r
`,o.rtpSender&&o.sendEncodingParameters[0].rtx&&(f+="a=ssrc:"+o.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+`\r
`),f},r.getDirection=function(o,l){for(var h=r.splitLines(o),u=0;u<h.length;u++)switch(h[u]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return h[u].substr(2)}return l?r.getDirection(l):"sendrecv"},r.getKind=function(o){return r.splitLines(o)[0].split(" ")[0].substr(2)},r.isRejected=function(o){return o.split(" ",2)[1]==="0"},r.parseMLine=function(o){var l=r.splitLines(o)[0].substr(2).split(" ");return{kind:l[0],port:parseInt(l[1],10),protocol:l[2],fmt:l.slice(3).join(" ")}},r.parseOLine=function(o){var l=r.matchPrefix(o,"o=")[0].substr(2).split(" ");return{username:l[0],sessionId:l[1],sessionVersion:parseInt(l[2],10),netType:l[3],addressType:l[4],address:l[5]}},r.isValidSDP=function(o){if(typeof o!="string"||o.length===0)return!1;for(var l=r.splitLines(o),h=0;h<l.length;h++)if(l[h].length<2||l[h].charAt(1)!=="=")return!1;return!0},typeof n=="object"&&(n.exports=r)},{}],NJ2u:[function(t,n,i){var r=t("sdp");function o(A){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[A.type]||A.type}function l(A,v,w,b,S){var R=r.writeRtpDescription(A.kind,v);if(R+=r.writeIceParameters(A.iceGatherer.getLocalParameters()),R+=r.writeDtlsParameters(A.dtlsTransport.getLocalParameters(),w==="offer"?"actpass":S||"active"),R+="a=mid:"+A.mid+`\r
`,A.rtpSender&&A.rtpReceiver?R+=`a=sendrecv\r
`:A.rtpSender?R+=`a=sendonly\r
`:A.rtpReceiver?R+=`a=recvonly\r
`:R+=`a=inactive\r
`,A.rtpSender){var M=A.rtpSender._initialTrackId||A.rtpSender.track.id;A.rtpSender._initialTrackId=M;var I="msid:"+(b?b.id:"-")+" "+M+`\r
`;R+="a="+I,R+="a=ssrc:"+A.sendEncodingParameters[0].ssrc+" "+I,A.sendEncodingParameters[0].rtx&&(R+="a=ssrc:"+A.sendEncodingParameters[0].rtx.ssrc+" "+I,R+="a=ssrc-group:FID "+A.sendEncodingParameters[0].ssrc+" "+A.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return R+="a=ssrc:"+A.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+`\r
`,A.rtpSender&&A.sendEncodingParameters[0].rtx&&(R+="a=ssrc:"+A.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+`\r
`),R}function h(A,v){var w=!1;return(A=JSON.parse(JSON.stringify(A))).filter(function(b){if(b&&(b.urls||b.url)){var S=b.urls||b.url;b.url&&!b.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var R=typeof S=="string";return R&&(S=[S]),S=S.filter(function(M){return M.indexOf("turn:")===0&&M.indexOf("transport=udp")!==-1&&M.indexOf("turn:[")===-1&&!w?(w=!0,!0):M.indexOf("stun:")===0&&v>=14393&&M.indexOf("?transport=udp")===-1}),delete b.url,b.urls=R?S[0]:S,!!S.length}})}function u(A,v){var w={codecs:[],headerExtensions:[],fecMechanisms:[]},b=function(R,M){R=parseInt(R,10);for(var I=0;I<M.length;I++)if(M[I].payloadType===R||M[I].preferredPayloadType===R)return M[I]},S=function(R,M,I,T){var B=b(R.parameters.apt,I),F=b(M.parameters.apt,T);return B&&F&&B.name.toLowerCase()===F.name.toLowerCase()};return A.codecs.forEach(function(R){for(var M=0;M<v.codecs.length;M++){var I=v.codecs[M];if(R.name.toLowerCase()===I.name.toLowerCase()&&R.clockRate===I.clockRate){if(R.name.toLowerCase()==="rtx"&&R.parameters&&I.parameters.apt&&!S(R,I,A.codecs,v.codecs))continue;(I=JSON.parse(JSON.stringify(I))).numChannels=Math.min(R.numChannels,I.numChannels),w.codecs.push(I),I.rtcpFeedback=I.rtcpFeedback.filter(function(T){for(var B=0;B<R.rtcpFeedback.length;B++)if(R.rtcpFeedback[B].type===T.type&&R.rtcpFeedback[B].parameter===T.parameter)return!0;return!1});break}}}),A.headerExtensions.forEach(function(R){for(var M=0;M<v.headerExtensions.length;M++){var I=v.headerExtensions[M];if(R.uri===I.uri){w.headerExtensions.push(I);break}}}),w}function f(A,v,w){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[v][A].indexOf(w)!==-1}function g(A,v){var w=A.getRemoteCandidates().find(function(b){return v.foundation===b.foundation&&v.ip===b.ip&&v.port===b.port&&v.priority===b.priority&&v.protocol===b.protocol&&v.type===b.type});return w||A.addRemoteCandidate(v),!w}function m(A,v){var w=new Error(v);return w.name=A,w.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[A],w}n.exports=function(A,v){function w(M,I){I.addTrack(M),I.dispatchEvent(new A.MediaStreamTrackEvent("addtrack",{track:M}))}function b(M,I,T,B){var F=new Event("track");F.track=I,F.receiver=T,F.transceiver={receiver:T},F.streams=B,A.setTimeout(function(){M._dispatchEvent("track",F)})}var S=function(M){var I=this,T=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(F){I[F]=T[F].bind(T)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",M=JSON.parse(JSON.stringify(M||{})),this.usingBundle=M.bundlePolicy==="max-bundle",M.rtcpMuxPolicy==="negotiate")throw m("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(M.rtcpMuxPolicy||(M.rtcpMuxPolicy="require"),M.iceTransportPolicy){case"all":case"relay":break;default:M.iceTransportPolicy="all"}switch(M.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:M.bundlePolicy="balanced"}if(M.iceServers=h(M.iceServers||[],v),this._iceGatherers=[],M.iceCandidatePoolSize)for(var B=M.iceCandidatePoolSize;B>0;B--)this._iceGatherers.push(new A.RTCIceGatherer({iceServers:M.iceServers,gatherPolicy:M.iceTransportPolicy}));else M.iceCandidatePoolSize=0;this._config=M,this.transceivers=[],this._sdpSessionId=r.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(S.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(S.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),S.prototype.onicecandidate=null,S.prototype.onaddstream=null,S.prototype.ontrack=null,S.prototype.onremovestream=null,S.prototype.onsignalingstatechange=null,S.prototype.oniceconnectionstatechange=null,S.prototype.onconnectionstatechange=null,S.prototype.onicegatheringstatechange=null,S.prototype.onnegotiationneeded=null,S.prototype.ondatachannel=null,S.prototype._dispatchEvent=function(M,I){this._isClosed||(this.dispatchEvent(I),typeof this["on"+M]=="function"&&this["on"+M](I))},S.prototype._emitGatheringStateChange=function(){var M=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",M)},S.prototype.getConfiguration=function(){return this._config},S.prototype.getLocalStreams=function(){return this.localStreams},S.prototype.getRemoteStreams=function(){return this.remoteStreams},S.prototype._createTransceiver=function(M,I){var T=this.transceivers.length>0,B={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:M,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&T)B.iceTransport=this.transceivers[0].iceTransport,B.dtlsTransport=this.transceivers[0].dtlsTransport;else{var F=this._createIceAndDtlsTransports();B.iceTransport=F.iceTransport,B.dtlsTransport=F.dtlsTransport}return I||this.transceivers.push(B),B},S.prototype.addTrack=function(M,I){if(this._isClosed)throw m("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var T;if(this.transceivers.find(function(F){return F.track===M}))throw m("InvalidAccessError","Track already exists.");for(var B=0;B<this.transceivers.length;B++)this.transceivers[B].track||this.transceivers[B].kind!==M.kind||(T=this.transceivers[B]);return T||(T=this._createTransceiver(M.kind)),this._maybeFireNegotiationNeeded(),this.localStreams.indexOf(I)===-1&&this.localStreams.push(I),T.track=M,T.stream=I,T.rtpSender=new A.RTCRtpSender(M,T.dtlsTransport),T.rtpSender},S.prototype.addStream=function(M){var I=this;if(v>=15025)M.getTracks().forEach(function(B){I.addTrack(B,M)});else{var T=M.clone();M.getTracks().forEach(function(B,F){var D=T.getTracks()[F];B.addEventListener("enabled",function(U){D.enabled=U.enabled})}),T.getTracks().forEach(function(B){I.addTrack(B,T)})}},S.prototype.removeTrack=function(M){if(this._isClosed)throw m("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(M instanceof A.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var I=this.transceivers.find(function(B){return B.rtpSender===M});if(!I)throw m("InvalidAccessError","Sender was not created by this connection.");var T=I.stream;I.rtpSender.stop(),I.rtpSender=null,I.track=null,I.stream=null,this.transceivers.map(function(B){return B.stream}).indexOf(T)===-1&&this.localStreams.indexOf(T)>-1&&this.localStreams.splice(this.localStreams.indexOf(T),1),this._maybeFireNegotiationNeeded()},S.prototype.removeStream=function(M){var I=this;M.getTracks().forEach(function(T){var B=I.getSenders().find(function(F){return F.track===T});B&&I.removeTrack(B)})},S.prototype.getSenders=function(){return this.transceivers.filter(function(M){return!!M.rtpSender}).map(function(M){return M.rtpSender})},S.prototype.getReceivers=function(){return this.transceivers.filter(function(M){return!!M.rtpReceiver}).map(function(M){return M.rtpReceiver})},S.prototype._createIceGatherer=function(M,I){var T=this;if(I&&M>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var B=new A.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(B,"state",{value:"new",writable:!0}),this.transceivers[M].bufferedCandidateEvents=[],this.transceivers[M].bufferCandidates=function(F){var D=!F.candidate||Object.keys(F.candidate).length===0;B.state=D?"completed":"gathering",T.transceivers[M].bufferedCandidateEvents!==null&&T.transceivers[M].bufferedCandidateEvents.push(F)},B.addEventListener("localcandidate",this.transceivers[M].bufferCandidates),B},S.prototype._gather=function(M,I){var T=this,B=this.transceivers[I].iceGatherer;if(!B.onlocalcandidate){var F=this.transceivers[I].bufferedCandidateEvents;this.transceivers[I].bufferedCandidateEvents=null,B.removeEventListener("localcandidate",this.transceivers[I].bufferCandidates),B.onlocalcandidate=function(D){if(!(T.usingBundle&&I>0)){var U=new Event("icecandidate");U.candidate={sdpMid:M,sdpMLineIndex:I};var W=D.candidate,J=!W||Object.keys(W).length===0;if(J)B.state!=="new"&&B.state!=="gathering"||(B.state="completed");else{B.state==="new"&&(B.state="gathering"),W.component=1,W.ufrag=B.getLocalParameters().usernameFragment;var ee=r.writeCandidate(W);U.candidate=Object.assign(U.candidate,r.parseCandidate(ee)),U.candidate.candidate=ee,U.candidate.toJSON=function(){return{candidate:U.candidate.candidate,sdpMid:U.candidate.sdpMid,sdpMLineIndex:U.candidate.sdpMLineIndex,usernameFragment:U.candidate.usernameFragment}}}var Q=r.getMediaSections(T._localDescription.sdp);Q[U.candidate.sdpMLineIndex]+=J?`a=end-of-candidates\r
`:"a="+U.candidate.candidate+`\r
`,T._localDescription.sdp=r.getDescription(T._localDescription.sdp)+Q.join("");var Y=T.transceivers.every(function(se){return se.iceGatherer&&se.iceGatherer.state==="completed"});T.iceGatheringState!=="gathering"&&(T.iceGatheringState="gathering",T._emitGatheringStateChange()),J||T._dispatchEvent("icecandidate",U),Y&&(T._dispatchEvent("icecandidate",new Event("icecandidate")),T.iceGatheringState="complete",T._emitGatheringStateChange())}},A.setTimeout(function(){F.forEach(function(D){B.onlocalcandidate(D)})},0)}},S.prototype._createIceAndDtlsTransports=function(){var M=this,I=new A.RTCIceTransport(null);I.onicestatechange=function(){M._updateIceConnectionState(),M._updateConnectionState()};var T=new A.RTCDtlsTransport(I);return T.ondtlsstatechange=function(){M._updateConnectionState()},T.onerror=function(){Object.defineProperty(T,"state",{value:"failed",writable:!0}),M._updateConnectionState()},{iceTransport:I,dtlsTransport:T}},S.prototype._disposeIceAndDtlsTransports=function(M){var I=this.transceivers[M].iceGatherer;I&&(delete I.onlocalcandidate,delete this.transceivers[M].iceGatherer);var T=this.transceivers[M].iceTransport;T&&(delete T.onicestatechange,delete this.transceivers[M].iceTransport);var B=this.transceivers[M].dtlsTransport;B&&(delete B.ondtlsstatechange,delete B.onerror,delete this.transceivers[M].dtlsTransport)},S.prototype._transceive=function(M,I,T){var B=u(M.localCapabilities,M.remoteCapabilities);I&&M.rtpSender&&(B.encodings=M.sendEncodingParameters,B.rtcp={cname:r.localCName,compound:M.rtcpParameters.compound},M.recvEncodingParameters.length&&(B.rtcp.ssrc=M.recvEncodingParameters[0].ssrc),M.rtpSender.send(B)),T&&M.rtpReceiver&&B.codecs.length>0&&(M.kind==="video"&&M.recvEncodingParameters&&v<15019&&M.recvEncodingParameters.forEach(function(F){delete F.rtx}),M.recvEncodingParameters.length?B.encodings=M.recvEncodingParameters:B.encodings=[{}],B.rtcp={compound:M.rtcpParameters.compound},M.rtcpParameters.cname&&(B.rtcp.cname=M.rtcpParameters.cname),M.sendEncodingParameters.length&&(B.rtcp.ssrc=M.sendEncodingParameters[0].ssrc),M.rtpReceiver.receive(B))},S.prototype.setLocalDescription=function(M){var I,T,B=this;if(["offer","answer"].indexOf(M.type)===-1)return Promise.reject(m("TypeError",'Unsupported type "'+M.type+'"'));if(!f("setLocalDescription",M.type,B.signalingState)||B._isClosed)return Promise.reject(m("InvalidStateError","Can not set local "+M.type+" in state "+B.signalingState));if(M.type==="offer")I=r.splitSections(M.sdp),T=I.shift(),I.forEach(function(D,U){var W=r.parseRtpParameters(D);B.transceivers[U].localCapabilities=W}),B.transceivers.forEach(function(D,U){B._gather(D.mid,U)});else if(M.type==="answer"){I=r.splitSections(B._remoteDescription.sdp),T=I.shift();var F=r.matchPrefix(T,"a=ice-lite").length>0;I.forEach(function(D,U){var W=B.transceivers[U],J=W.iceGatherer,ee=W.iceTransport,Q=W.dtlsTransport,Y=W.localCapabilities,se=W.remoteCapabilities;if(!(r.isRejected(D)&&r.matchPrefix(D,"a=bundle-only").length===0)&&!W.rejected){var ae=r.getIceParameters(D,T),ve=r.getDtlsParameters(D,T);F&&(ve.role="server"),B.usingBundle&&U!==0||(B._gather(W.mid,U),ee.state==="new"&&ee.start(J,ae,F?"controlling":"controlled"),Q.state==="new"&&Q.start(ve));var xe=u(Y,se);B._transceive(W,xe.codecs.length>0,!1)}})}return B._localDescription={type:M.type,sdp:M.sdp},M.type==="offer"?B._updateSignalingState("have-local-offer"):B._updateSignalingState("stable"),Promise.resolve()},S.prototype.setRemoteDescription=function(M){var I=this;if(["offer","answer"].indexOf(M.type)===-1)return Promise.reject(m("TypeError",'Unsupported type "'+M.type+'"'));if(!f("setRemoteDescription",M.type,I.signalingState)||I._isClosed)return Promise.reject(m("InvalidStateError","Can not set remote "+M.type+" in state "+I.signalingState));var T={};I.remoteStreams.forEach(function(ee){T[ee.id]=ee});var B=[],F=r.splitSections(M.sdp),D=F.shift(),U=r.matchPrefix(D,"a=ice-lite").length>0,W=r.matchPrefix(D,"a=group:BUNDLE ").length>0;I.usingBundle=W;var J=r.matchPrefix(D,"a=ice-options:")[0];return I.canTrickleIceCandidates=!!J&&J.substr(14).split(" ").indexOf("trickle")>=0,F.forEach(function(ee,Q){var Y=r.splitLines(ee),se=r.getKind(ee),ae=r.isRejected(ee)&&r.matchPrefix(ee,"a=bundle-only").length===0,ve=Y[0].substr(2).split(" ")[2],xe=r.getDirection(ee,D),Ae=r.parseMsid(ee),Me=r.getMid(ee)||r.generateIdentifier();if(ae||se==="application"&&(ve==="DTLS/SCTP"||ve==="UDP/DTLS/SCTP"))I.transceivers[Q]={mid:Me,kind:se,protocol:ve,rejected:!0};else{var Be,Le,$e,yt,Nt,He,mn,Xt,pn;!ae&&I.transceivers[Q]&&I.transceivers[Q].rejected&&(I.transceivers[Q]=I._createTransceiver(se,!0));var Ft,yn,it=r.parseRtpParameters(ee);ae||(Ft=r.getIceParameters(ee,D),(yn=r.getDtlsParameters(ee,D)).role="client"),mn=r.parseRtpEncodingParameters(ee);var tt=r.parseRtcpParameters(ee),vt=r.matchPrefix(ee,"a=end-of-candidates",D).length>0,Jt=r.matchPrefix(ee,"a=candidate:").map(function(Zt){return r.parseCandidate(Zt)}).filter(function(Zt){return Zt.component===1});if((M.type==="offer"||M.type==="answer")&&!ae&&W&&Q>0&&I.transceivers[Q]&&(I._disposeIceAndDtlsTransports(Q),I.transceivers[Q].iceGatherer=I.transceivers[0].iceGatherer,I.transceivers[Q].iceTransport=I.transceivers[0].iceTransport,I.transceivers[Q].dtlsTransport=I.transceivers[0].dtlsTransport,I.transceivers[Q].rtpSender&&I.transceivers[Q].rtpSender.setTransport(I.transceivers[0].dtlsTransport),I.transceivers[Q].rtpReceiver&&I.transceivers[Q].rtpReceiver.setTransport(I.transceivers[0].dtlsTransport)),M.type!=="offer"||ae)M.type==="answer"&&!ae&&(Le=(Be=I.transceivers[Q]).iceGatherer,$e=Be.iceTransport,yt=Be.dtlsTransport,Nt=Be.rtpReceiver,He=Be.sendEncodingParameters,Xt=Be.localCapabilities,I.transceivers[Q].recvEncodingParameters=mn,I.transceivers[Q].remoteCapabilities=it,I.transceivers[Q].rtcpParameters=tt,Jt.length&&$e.state==="new"&&(!U&&!vt||W&&Q!==0?Jt.forEach(function(Zt){g(Be.iceTransport,Zt)}):$e.setRemoteCandidates(Jt)),W&&Q!==0||($e.state==="new"&&$e.start(Le,Ft,"controlling"),yt.state==="new"&&yt.start(yn)),!u(Be.localCapabilities,Be.remoteCapabilities).codecs.filter(function(Zt){return Zt.name.toLowerCase()==="rtx"}).length&&Be.sendEncodingParameters[0].rtx&&delete Be.sendEncodingParameters[0].rtx,I._transceive(Be,xe==="sendrecv"||xe==="recvonly",xe==="sendrecv"||xe==="sendonly"),!Nt||xe!=="sendrecv"&&xe!=="sendonly"?delete Be.rtpReceiver:(pn=Nt.track,Ae?(T[Ae.stream]||(T[Ae.stream]=new A.MediaStream),w(pn,T[Ae.stream]),B.push([pn,Nt,T[Ae.stream]])):(T.default||(T.default=new A.MediaStream),w(pn,T.default),B.push([pn,Nt,T.default]))));else{(Be=I.transceivers[Q]||I._createTransceiver(se)).mid=Me,Be.iceGatherer||(Be.iceGatherer=I._createIceGatherer(Q,W)),Jt.length&&Be.iceTransport.state==="new"&&(!vt||W&&Q!==0?Jt.forEach(function(Zt){g(Be.iceTransport,Zt)}):Be.iceTransport.setRemoteCandidates(Jt)),Xt=A.RTCRtpReceiver.getCapabilities(se),v<15019&&(Xt.codecs=Xt.codecs.filter(function(Zt){return Zt.name!=="rtx"})),He=Be.sendEncodingParameters||[{ssrc:1001*(2*Q+2)}];var Lt,En=!1;xe==="sendrecv"||xe==="sendonly"?(En=!Be.rtpReceiver,Nt=Be.rtpReceiver||new A.RTCRtpReceiver(Be.dtlsTransport,se),En&&(pn=Nt.track,Ae&&Ae.stream==="-"||(Ae?(T[Ae.stream]||(T[Ae.stream]=new A.MediaStream,Object.defineProperty(T[Ae.stream],"id",{get:function(){return Ae.stream}})),Object.defineProperty(pn,"id",{get:function(){return Ae.track}}),Lt=T[Ae.stream]):(T.default||(T.default=new A.MediaStream),Lt=T.default)),Lt&&(w(pn,Lt),Be.associatedRemoteMediaStreams.push(Lt)),B.push([pn,Nt,Lt]))):Be.rtpReceiver&&Be.rtpReceiver.track&&(Be.associatedRemoteMediaStreams.forEach(function(Zt){var ln,ii,Zn=Zt.getTracks().find(function(me){return me.id===Be.rtpReceiver.track.id});Zn&&(ln=Zn,(ii=Zt).removeTrack(ln),ii.dispatchEvent(new A.MediaStreamTrackEvent("removetrack",{track:ln})))}),Be.associatedRemoteMediaStreams=[]),Be.localCapabilities=Xt,Be.remoteCapabilities=it,Be.rtpReceiver=Nt,Be.rtcpParameters=tt,Be.sendEncodingParameters=He,Be.recvEncodingParameters=mn,I._transceive(I.transceivers[Q],!1,En)}}}),I._dtlsRole===void 0&&(I._dtlsRole=M.type==="offer"?"active":"passive"),I._remoteDescription={type:M.type,sdp:M.sdp},M.type==="offer"?I._updateSignalingState("have-remote-offer"):I._updateSignalingState("stable"),Object.keys(T).forEach(function(ee){var Q=T[ee];if(Q.getTracks().length){if(I.remoteStreams.indexOf(Q)===-1){I.remoteStreams.push(Q);var Y=new Event("addstream");Y.stream=Q,A.setTimeout(function(){I._dispatchEvent("addstream",Y)})}B.forEach(function(se){var ae=se[0],ve=se[1];Q.id===se[2].id&&b(I,ae,ve,[Q])})}}),B.forEach(function(ee){ee[2]||b(I,ee[0],ee[1],[])}),A.setTimeout(function(){I&&I.transceivers&&I.transceivers.forEach(function(ee){ee.iceTransport&&ee.iceTransport.state==="new"&&ee.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),ee.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},S.prototype.close=function(){this.transceivers.forEach(function(M){M.iceTransport&&M.iceTransport.stop(),M.dtlsTransport&&M.dtlsTransport.stop(),M.rtpSender&&M.rtpSender.stop(),M.rtpReceiver&&M.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},S.prototype._updateSignalingState=function(M){this.signalingState=M;var I=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",I)},S.prototype._maybeFireNegotiationNeeded=function(){var M=this;this.signalingState==="stable"&&this.needNegotiation!==!0&&(this.needNegotiation=!0,A.setTimeout(function(){if(M.needNegotiation){M.needNegotiation=!1;var I=new Event("negotiationneeded");M._dispatchEvent("negotiationneeded",I)}},0))},S.prototype._updateIceConnectionState=function(){var M,I={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(B){B.iceTransport&&!B.rejected&&I[B.iceTransport.state]++}),M="new",I.failed>0?M="failed":I.checking>0?M="checking":I.disconnected>0?M="disconnected":I.new>0?M="new":I.connected>0?M="connected":I.completed>0&&(M="completed"),M!==this.iceConnectionState){this.iceConnectionState=M;var T=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",T)}},S.prototype._updateConnectionState=function(){var M,I={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(B){B.iceTransport&&B.dtlsTransport&&!B.rejected&&(I[B.iceTransport.state]++,I[B.dtlsTransport.state]++)}),I.connected+=I.completed,M="new",I.failed>0?M="failed":I.connecting>0?M="connecting":I.disconnected>0?M="disconnected":I.new>0?M="new":I.connected>0&&(M="connected"),M!==this.connectionState){this.connectionState=M;var T=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",T)}},S.prototype.createOffer=function(){var M=this;if(M._isClosed)return Promise.reject(m("InvalidStateError","Can not call createOffer after close"));var I=M.transceivers.filter(function(U){return U.kind==="audio"}).length,T=M.transceivers.filter(function(U){return U.kind==="video"}).length,B=arguments[0];if(B){if(B.mandatory||B.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");B.offerToReceiveAudio!==void 0&&(I=B.offerToReceiveAudio===!0?1:B.offerToReceiveAudio===!1?0:B.offerToReceiveAudio),B.offerToReceiveVideo!==void 0&&(T=B.offerToReceiveVideo===!0?1:B.offerToReceiveVideo===!1?0:B.offerToReceiveVideo)}for(M.transceivers.forEach(function(U){U.kind==="audio"?--I<0&&(U.wantReceive=!1):U.kind==="video"&&--T<0&&(U.wantReceive=!1)});I>0||T>0;)I>0&&(M._createTransceiver("audio"),I--),T>0&&(M._createTransceiver("video"),T--);var F=r.writeSessionBoilerplate(M._sdpSessionId,M._sdpSessionVersion++);M.transceivers.forEach(function(U,W){var J=U.track,ee=U.kind,Q=U.mid||r.generateIdentifier();U.mid=Q,U.iceGatherer||(U.iceGatherer=M._createIceGatherer(W,M.usingBundle));var Y=A.RTCRtpSender.getCapabilities(ee);v<15019&&(Y.codecs=Y.codecs.filter(function(ae){return ae.name!=="rtx"})),Y.codecs.forEach(function(ae){ae.name==="H264"&&ae.parameters["level-asymmetry-allowed"]===void 0&&(ae.parameters["level-asymmetry-allowed"]="1"),U.remoteCapabilities&&U.remoteCapabilities.codecs&&U.remoteCapabilities.codecs.forEach(function(ve){ae.name.toLowerCase()===ve.name.toLowerCase()&&ae.clockRate===ve.clockRate&&(ae.preferredPayloadType=ve.payloadType)})}),Y.headerExtensions.forEach(function(ae){(U.remoteCapabilities&&U.remoteCapabilities.headerExtensions||[]).forEach(function(ve){ae.uri===ve.uri&&(ae.id=ve.id)})});var se=U.sendEncodingParameters||[{ssrc:1001*(2*W+1)}];J&&v>=15019&&ee==="video"&&!se[0].rtx&&(se[0].rtx={ssrc:se[0].ssrc+1}),U.wantReceive&&(U.rtpReceiver=new A.RTCRtpReceiver(U.dtlsTransport,ee)),U.localCapabilities=Y,U.sendEncodingParameters=se}),M._config.bundlePolicy!=="max-compat"&&(F+="a=group:BUNDLE "+M.transceivers.map(function(U){return U.mid}).join(" ")+`\r
`),F+=`a=ice-options:trickle\r
`,M.transceivers.forEach(function(U,W){F+=l(U,U.localCapabilities,"offer",U.stream,M._dtlsRole),F+=`a=rtcp-rsize\r
`,!U.iceGatherer||M.iceGatheringState==="new"||W!==0&&M.usingBundle||(U.iceGatherer.getLocalCandidates().forEach(function(J){J.component=1,F+="a="+r.writeCandidate(J)+`\r
`}),U.iceGatherer.state==="completed"&&(F+=`a=end-of-candidates\r
`))});var D=new A.RTCSessionDescription({type:"offer",sdp:F});return Promise.resolve(D)},S.prototype.createAnswer=function(){var M=this;if(M._isClosed)return Promise.reject(m("InvalidStateError","Can not call createAnswer after close"));if(M.signalingState!=="have-remote-offer"&&M.signalingState!=="have-local-pranswer")return Promise.reject(m("InvalidStateError","Can not call createAnswer in signalingState "+M.signalingState));var I=r.writeSessionBoilerplate(M._sdpSessionId,M._sdpSessionVersion++);M.usingBundle&&(I+="a=group:BUNDLE "+M.transceivers.map(function(F){return F.mid}).join(" ")+`\r
`),I+=`a=ice-options:trickle\r
`;var T=r.getMediaSections(M._remoteDescription.sdp).length;M.transceivers.forEach(function(F,D){if(!(D+1>T)){if(F.rejected)return F.kind==="application"?F.protocol==="DTLS/SCTP"?I+=`m=application 0 DTLS/SCTP 5000\r
`:I+="m=application 0 "+F.protocol+` webrtc-datachannel\r
`:F.kind==="audio"?I+=`m=audio 0 UDP/TLS/RTP/SAVPF 0\r
a=rtpmap:0 PCMU/8000\r
`:F.kind==="video"&&(I+=`m=video 0 UDP/TLS/RTP/SAVPF 120\r
a=rtpmap:120 VP8/90000\r
`),void(I+=`c=IN IP4 0.0.0.0\r
a=inactive\r
a=mid:`+F.mid+`\r
`);var U;F.stream&&(F.kind==="audio"?U=F.stream.getAudioTracks()[0]:F.kind==="video"&&(U=F.stream.getVideoTracks()[0]),U&&v>=15019&&F.kind==="video"&&!F.sendEncodingParameters[0].rtx&&(F.sendEncodingParameters[0].rtx={ssrc:F.sendEncodingParameters[0].ssrc+1}));var W=u(F.localCapabilities,F.remoteCapabilities);!W.codecs.filter(function(J){return J.name.toLowerCase()==="rtx"}).length&&F.sendEncodingParameters[0].rtx&&delete F.sendEncodingParameters[0].rtx,I+=l(F,W,"answer",F.stream,M._dtlsRole),F.rtcpParameters&&F.rtcpParameters.reducedSize&&(I+=`a=rtcp-rsize\r
`)}});var B=new A.RTCSessionDescription({type:"answer",sdp:I});return Promise.resolve(B)},S.prototype.addIceCandidate=function(M){var I,T=this;return M&&M.sdpMLineIndex===void 0&&!M.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(B,F){if(!T._remoteDescription)return F(m("InvalidStateError","Can not add ICE candidate without a remote description"));if(M&&M.candidate!==""){var D=M.sdpMLineIndex;if(M.sdpMid){for(var U=0;U<T.transceivers.length;U++)if(T.transceivers[U].mid===M.sdpMid){D=U;break}}var W=T.transceivers[D];if(!W)return F(m("OperationError","Can not add ICE candidate"));if(W.rejected)return B();var J=Object.keys(M.candidate).length>0?r.parseCandidate(M.candidate):{};if(J.protocol==="tcp"&&(J.port===0||J.port===9)||J.component&&J.component!==1)return B();if((D===0||D>0&&W.iceTransport!==T.transceivers[0].iceTransport)&&!g(W.iceTransport,J))return F(m("OperationError","Can not add ICE candidate"));var ee=M.candidate.trim();ee.indexOf("a=")===0&&(ee=ee.substr(2)),(I=r.getMediaSections(T._remoteDescription.sdp))[D]+="a="+(J.type?ee:"end-of-candidates")+`\r
`,T._remoteDescription.sdp=r.getDescription(T._remoteDescription.sdp)+I.join("")}else for(var Q=0;Q<T.transceivers.length&&(T.transceivers[Q].rejected||(T.transceivers[Q].iceTransport.addRemoteCandidate({}),(I=r.getMediaSections(T._remoteDescription.sdp))[Q]+=`a=end-of-candidates\r
`,T._remoteDescription.sdp=r.getDescription(T._remoteDescription.sdp)+I.join(""),!T.usingBundle));Q++);B()})},S.prototype.getStats=function(M){if(M&&M instanceof A.MediaStreamTrack){var I=null;if(this.transceivers.forEach(function(B){B.rtpSender&&B.rtpSender.track===M?I=B.rtpSender:B.rtpReceiver&&B.rtpReceiver.track===M&&(I=B.rtpReceiver)}),!I)throw m("InvalidAccessError","Invalid selector.");return I.getStats()}var T=[];return this.transceivers.forEach(function(B){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(F){B[F]&&T.push(B[F].getStats())})}),Promise.all(T).then(function(B){var F=new Map;return B.forEach(function(D){D.forEach(function(U){F.set(U.id,U)})}),F})},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(M){var I=A[M];if(I&&I.prototype&&I.prototype.getStats){var T=I.prototype.getStats;I.prototype.getStats=function(){return T.apply(this).then(function(B){var F=new Map;return Object.keys(B).forEach(function(D){B[D].type=o(B[D]),F.set(D,B[D])}),F})}}});var R=["createOffer","createAnswer"];return R.forEach(function(M){var I=S.prototype[M];S.prototype[M]=function(){var T=arguments;return typeof T[0]=="function"||typeof T[1]=="function"?I.apply(this,[arguments[2]]).then(function(B){typeof T[0]=="function"&&T[0].apply(null,[B])},function(B){typeof T[1]=="function"&&T[1].apply(null,[B])}):I.apply(this,arguments)}}),(R=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(M){var I=S.prototype[M];S.prototype[M]=function(){var T=arguments;return typeof T[1]=="function"||typeof T[2]=="function"?I.apply(this,arguments).then(function(){typeof T[1]=="function"&&T[1].apply(null)},function(B){typeof T[2]=="function"&&T[2].apply(null,[B])}):I.apply(this,arguments)}}),["getStats"].forEach(function(M){var I=S.prototype[M];S.prototype[M]=function(){var T=arguments;return typeof T[1]=="function"?I.apply(this,arguments).then(function(){typeof T[1]=="function"&&T[1].apply(null)}):I.apply(this,arguments)}}),S}},{sdp:"YHvh"}],YdKx:[function(t,n,i){function r(o){var l=o&&o.navigator,h=l.mediaDevices.getUserMedia.bind(l.mediaDevices);l.mediaDevices.getUserMedia=function(u){return h(u).catch(function(f){return Promise.reject(function(g){return{name:{PermissionDeniedError:"NotAllowedError"}[g.name]||g.name,message:g.message,constraint:g.constraint,toString:function(){return this.name}}}(f))})}}Object.defineProperty(i,"__esModule",{value:!0}),i.shimGetUserMedia=r},{}],P3bV:[function(t,n,i){function r(o){"getDisplayMedia"in o.navigator&&o.navigator.mediaDevices&&(o.navigator.mediaDevices&&"getDisplayMedia"in o.navigator.mediaDevices||(o.navigator.mediaDevices.getDisplayMedia=o.navigator.getDisplayMedia.bind(o.navigator)))}Object.defineProperty(i,"__esModule",{value:!0}),i.shimGetDisplayMedia=r},{}],XRic:[function(t,n,i){Object.defineProperty(i,"__esModule",{value:!0}),i.shimPeerConnection=A,i.shimReplaceTrack=v,Object.defineProperty(i,"shimGetUserMedia",{enumerable:!0,get:function(){return h.shimGetUserMedia}}),Object.defineProperty(i,"shimGetDisplayMedia",{enumerable:!0,get:function(){return u.shimGetDisplayMedia}});var r=m(t("../utils")),o=t("./filtericeservers"),l=f(t("rtcpeerconnection-shim")),h=t("./getusermedia"),u=t("./getdisplaymedia");function f(w){return w&&w.__esModule?w:{default:w}}function g(){if(typeof WeakMap!="function")return null;var w=new WeakMap;return g=function(){return w},w}function m(w){if(w&&w.__esModule)return w;if(w===null||typeof w!="object"&&typeof w!="function")return{default:w};var b=g();if(b&&b.has(w))return b.get(w);var S={},R=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var M in w)if(Object.prototype.hasOwnProperty.call(w,M)){var I=R?Object.getOwnPropertyDescriptor(w,M):null;I&&(I.get||I.set)?Object.defineProperty(S,M,I):S[M]=w[M]}return S.default=w,b&&b.set(w,S),S}function A(w,b){if(w.RTCIceGatherer&&(w.RTCIceCandidate||(w.RTCIceCandidate=function(M){return M}),w.RTCSessionDescription||(w.RTCSessionDescription=function(M){return M}),b.version<15025)){var S=Object.getOwnPropertyDescriptor(w.MediaStreamTrack.prototype,"enabled");Object.defineProperty(w.MediaStreamTrack.prototype,"enabled",{set:function(M){S.set.call(this,M);var I=new Event("enabled");I.enabled=M,this.dispatchEvent(I)}})}!w.RTCRtpSender||"dtmf"in w.RTCRtpSender.prototype||Object.defineProperty(w.RTCRtpSender.prototype,"dtmf",{get:function(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=new w.RTCDtmfSender(this):this.track.kind==="video"&&(this._dtmf=null)),this._dtmf}}),w.RTCDtmfSender&&!w.RTCDTMFSender&&(w.RTCDTMFSender=w.RTCDtmfSender);var R=(0,l.default)(w,b.version);w.RTCPeerConnection=function(M){return M&&M.iceServers&&(M.iceServers=(0,o.filterIceServers)(M.iceServers,b.version),r.log("ICE servers after filtering:",M.iceServers)),new R(M)},w.RTCPeerConnection.prototype=R.prototype}function v(w){!w.RTCRtpSender||"replaceTrack"in w.RTCRtpSender.prototype||(w.RTCRtpSender.prototype.replaceTrack=w.RTCRtpSender.prototype.setTrack)}},{"../utils":"iSxC","./filtericeservers":"NZ1C","rtcpeerconnection-shim":"NJ2u","./getusermedia":"YdKx","./getdisplaymedia":"P3bV"}],GzSv:[function(t,n,i){Object.defineProperty(i,"__esModule",{value:!0}),i.shimGetUserMedia=u;var r=l(t("../utils"));function o(){if(typeof WeakMap!="function")return null;var f=new WeakMap;return o=function(){return f},f}function l(f){if(f&&f.__esModule)return f;if(f===null||typeof f!="object"&&typeof f!="function")return{default:f};var g=o();if(g&&g.has(f))return g.get(f);var m={},A=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var v in f)if(Object.prototype.hasOwnProperty.call(f,v)){var w=A?Object.getOwnPropertyDescriptor(f,v):null;w&&(w.get||w.set)?Object.defineProperty(m,v,w):m[v]=f[v]}return m.default=f,g&&g.set(f,m),m}function h(f){return(h=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(g){return typeof g}:function(g){return g&&typeof Symbol=="function"&&g.constructor===Symbol&&g!==Symbol.prototype?"symbol":typeof g})(f)}function u(f,g){var m=f&&f.navigator,A=f&&f.MediaStreamTrack;if(m.getUserMedia=function(R,M,I){r.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),m.mediaDevices.getUserMedia(R).then(M,I)},!(g.version>55&&"autoGainControl"in m.mediaDevices.getSupportedConstraints())){var v=function(R,M,I){M in R&&!(I in R)&&(R[I]=R[M],delete R[M])},w=m.mediaDevices.getUserMedia.bind(m.mediaDevices);if(m.mediaDevices.getUserMedia=function(R){return h(R)==="object"&&h(R.audio)==="object"&&(R=JSON.parse(JSON.stringify(R)),v(R.audio,"autoGainControl","mozAutoGainControl"),v(R.audio,"noiseSuppression","mozNoiseSuppression")),w(R)},A&&A.prototype.getSettings){var b=A.prototype.getSettings;A.prototype.getSettings=function(){var R=b.apply(this,arguments);return v(R,"mozAutoGainControl","autoGainControl"),v(R,"mozNoiseSuppression","noiseSuppression"),R}}if(A&&A.prototype.applyConstraints){var S=A.prototype.applyConstraints;A.prototype.applyConstraints=function(R){return this.kind==="audio"&&h(R)==="object"&&(R=JSON.parse(JSON.stringify(R)),v(R,"autoGainControl","mozAutoGainControl"),v(R,"noiseSuppression","mozNoiseSuppression")),S.apply(this,[R])}}}}},{"../utils":"iSxC"}],UuGU:[function(t,n,i){function r(o,l){o.navigator.mediaDevices&&"getDisplayMedia"in o.navigator.mediaDevices||o.navigator.mediaDevices&&(o.navigator.mediaDevices.getDisplayMedia=function(h){if(!h||!h.video){var u=new DOMException("getDisplayMedia without video constraints is undefined");return u.name="NotFoundError",u.code=8,Promise.reject(u)}return h.video===!0?h.video={mediaSource:l}:h.video.mediaSource=l,o.navigator.mediaDevices.getUserMedia(h)})}Object.defineProperty(i,"__esModule",{value:!0}),i.shimGetDisplayMedia=r},{}],Fzdr:[function(t,n,i){Object.defineProperty(i,"__esModule",{value:!0}),i.shimOnTrack=m,i.shimPeerConnection=A,i.shimSenderGetStats=v,i.shimReceiverGetStats=w,i.shimRemoveStream=b,i.shimRTCDataChannel=S,i.shimAddTransceiver=R,i.shimGetParameters=M,i.shimCreateOffer=I,i.shimCreateAnswer=T,Object.defineProperty(i,"shimGetUserMedia",{enumerable:!0,get:function(){return o.shimGetUserMedia}}),Object.defineProperty(i,"shimGetDisplayMedia",{enumerable:!0,get:function(){return l.shimGetDisplayMedia}});var r=u(t("../utils")),o=t("./getusermedia"),l=t("./getdisplaymedia");function h(){if(typeof WeakMap!="function")return null;var B=new WeakMap;return h=function(){return B},B}function u(B){if(B&&B.__esModule)return B;if(B===null||typeof B!="object"&&typeof B!="function")return{default:B};var F=h();if(F&&F.has(B))return F.get(B);var D={},U=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var W in B)if(Object.prototype.hasOwnProperty.call(B,W)){var J=U?Object.getOwnPropertyDescriptor(B,W):null;J&&(J.get||J.set)?Object.defineProperty(D,W,J):D[W]=B[W]}return D.default=B,F&&F.set(B,D),D}function f(B,F,D){return F in B?Object.defineProperty(B,F,{value:D,enumerable:!0,configurable:!0,writable:!0}):B[F]=D,B}function g(B){return(g=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(F){return typeof F}:function(F){return F&&typeof Symbol=="function"&&F.constructor===Symbol&&F!==Symbol.prototype?"symbol":typeof F})(B)}function m(B){g(B)==="object"&&B.RTCTrackEvent&&"receiver"in B.RTCTrackEvent.prototype&&!("transceiver"in B.RTCTrackEvent.prototype)&&Object.defineProperty(B.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function A(B,F){if(g(B)==="object"&&(B.RTCPeerConnection||B.mozRTCPeerConnection)){!B.RTCPeerConnection&&B.mozRTCPeerConnection&&(B.RTCPeerConnection=B.mozRTCPeerConnection),F.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(W){var J=B.RTCPeerConnection.prototype[W],ee=f({},W,function(){return arguments[0]=new(W==="addIceCandidate"?B.RTCIceCandidate:B.RTCSessionDescription)(arguments[0]),J.apply(this,arguments)});B.RTCPeerConnection.prototype[W]=ee[W]});var D={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},U=B.RTCPeerConnection.prototype.getStats;B.RTCPeerConnection.prototype.getStats=function(){var[W,J,ee]=arguments;return U.apply(this,[W||null]).then(function(Q){if(F.version<53&&!J)try{Q.forEach(function(Y){Y.type=D[Y.type]||Y.type})}catch(Y){if(Y.name!=="TypeError")throw Y;Q.forEach(function(se,ae){Q.set(ae,Object.assign({},se,{type:D[se.type]||se.type}))})}return Q}).then(J,ee)}}}function v(B){if(g(B)==="object"&&B.RTCPeerConnection&&B.RTCRtpSender&&!(B.RTCRtpSender&&"getStats"in B.RTCRtpSender.prototype)){var F=B.RTCPeerConnection.prototype.getSenders;F&&(B.RTCPeerConnection.prototype.getSenders=function(){var U=this,W=F.apply(this,[]);return W.forEach(function(J){return J._pc=U}),W});var D=B.RTCPeerConnection.prototype.addTrack;D&&(B.RTCPeerConnection.prototype.addTrack=function(){var U=D.apply(this,arguments);return U._pc=this,U}),B.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}}function w(B){if(g(B)==="object"&&B.RTCPeerConnection&&B.RTCRtpSender&&!(B.RTCRtpSender&&"getStats"in B.RTCRtpReceiver.prototype)){var F=B.RTCPeerConnection.prototype.getReceivers;F&&(B.RTCPeerConnection.prototype.getReceivers=function(){var D=this,U=F.apply(this,[]);return U.forEach(function(W){return W._pc=D}),U}),r.wrapPeerConnectionEvent(B,"track",function(D){return D.receiver._pc=D.srcElement,D}),B.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}}function b(B){!B.RTCPeerConnection||"removeStream"in B.RTCPeerConnection.prototype||(B.RTCPeerConnection.prototype.removeStream=function(F){var D=this;r.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(U){U.track&&F.getTracks().includes(U.track)&&D.removeTrack(U)})})}function S(B){B.DataChannel&&!B.RTCDataChannel&&(B.RTCDataChannel=B.DataChannel)}function R(B){if(g(B)==="object"&&B.RTCPeerConnection){var F=B.RTCPeerConnection.prototype.addTransceiver;F&&(B.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];var D=arguments[1],U=D&&"sendEncodings"in D;U&&D.sendEncodings.forEach(function(Q){if("rid"in Q&&!/^[a-z0-9]{0,16}$/i.test(Q.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in Q&&!(parseFloat(Q.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in Q&&!(parseFloat(Q.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});var W=F.apply(this,arguments);if(U){var{sender:J}=W,ee=J.getParameters();"encodings"in ee&&(ee.encodings.length!==1||Object.keys(ee.encodings[0]).length!==0)||(ee.encodings=D.sendEncodings,J.sendEncodings=D.sendEncodings,this.setParametersPromises.push(J.setParameters(ee).then(function(){delete J.sendEncodings}).catch(function(){delete J.sendEncodings})))}return W})}}function M(B){if(g(B)==="object"&&B.RTCRtpSender){var F=B.RTCRtpSender.prototype.getParameters;F&&(B.RTCRtpSender.prototype.getParameters=function(){var D=F.apply(this,arguments);return"encodings"in D||(D.encodings=[].concat(this.sendEncodings||[{}])),D})}}function I(B){if(g(B)==="object"&&B.RTCPeerConnection){var F=B.RTCPeerConnection.prototype.createOffer;B.RTCPeerConnection.prototype.createOffer=function(){var D=arguments,U=this;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return F.apply(U,D)}).finally(function(){U.setParametersPromises=[]}):F.apply(this,arguments)}}}function T(B){if(g(B)==="object"&&B.RTCPeerConnection){var F=B.RTCPeerConnection.prototype.createAnswer;B.RTCPeerConnection.prototype.createAnswer=function(){var D=arguments,U=this;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return F.apply(U,D)}).finally(function(){U.setParametersPromises=[]}):F.apply(this,arguments)}}}},{"../utils":"iSxC","./getusermedia":"GzSv","./getdisplaymedia":"UuGU"}],t1lL:[function(t,n,i){Object.defineProperty(i,"__esModule",{value:!0}),i.shimLocalStreamsAPI=u,i.shimRemoteStreamsAPI=f,i.shimCallbacksAPI=g,i.shimGetUserMedia=m,i.shimConstraints=A,i.shimRTCIceServerUrls=v,i.shimTrackEventTransceiver=w,i.shimCreateOfferLegacy=b,i.shimAudioContext=S;var r=l(t("../utils"));function o(){if(typeof WeakMap!="function")return null;var R=new WeakMap;return o=function(){return R},R}function l(R){if(R&&R.__esModule)return R;if(R===null||typeof R!="object"&&typeof R!="function")return{default:R};var M=o();if(M&&M.has(R))return M.get(R);var I={},T=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var B in R)if(Object.prototype.hasOwnProperty.call(R,B)){var F=T?Object.getOwnPropertyDescriptor(R,B):null;F&&(F.get||F.set)?Object.defineProperty(I,B,F):I[B]=R[B]}return I.default=R,M&&M.set(R,I),I}function h(R){return(h=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(M){return typeof M}:function(M){return M&&typeof Symbol=="function"&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M})(R)}function u(R){if(h(R)==="object"&&R.RTCPeerConnection){if("getLocalStreams"in R.RTCPeerConnection.prototype||(R.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in R.RTCPeerConnection.prototype)){var M=R.RTCPeerConnection.prototype.addTrack;R.RTCPeerConnection.prototype.addStream=function(I){var T=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(I)||this._localStreams.push(I),I.getAudioTracks().forEach(function(B){return M.call(T,B,I)}),I.getVideoTracks().forEach(function(B){return M.call(T,B,I)})},R.RTCPeerConnection.prototype.addTrack=function(I){for(var T=this,B=arguments.length,F=new Array(B>1?B-1:0),D=1;D<B;D++)F[D-1]=arguments[D];return F&&F.forEach(function(U){T._localStreams?T._localStreams.includes(U)||T._localStreams.push(U):T._localStreams=[U]}),M.apply(this,arguments)}}"removeStream"in R.RTCPeerConnection.prototype||(R.RTCPeerConnection.prototype.removeStream=function(I){var T=this;this._localStreams||(this._localStreams=[]);var B=this._localStreams.indexOf(I);if(B!==-1){this._localStreams.splice(B,1);var F=I.getTracks();this.getSenders().forEach(function(D){F.includes(D.track)&&T.removeTrack(D)})}})}}function f(R){if(h(R)==="object"&&R.RTCPeerConnection&&("getRemoteStreams"in R.RTCPeerConnection.prototype||(R.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in R.RTCPeerConnection.prototype))){Object.defineProperty(R.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(I){var T=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=I),this.addEventListener("track",this._onaddstreampoly=function(B){B.streams.forEach(function(F){if(T._remoteStreams||(T._remoteStreams=[]),!T._remoteStreams.includes(F)){T._remoteStreams.push(F);var D=new Event("addstream");D.stream=F,T.dispatchEvent(D)}})})}});var M=R.RTCPeerConnection.prototype.setRemoteDescription;R.RTCPeerConnection.prototype.setRemoteDescription=function(){var I=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(T){T.streams.forEach(function(B){if(I._remoteStreams||(I._remoteStreams=[]),!(I._remoteStreams.indexOf(B)>=0)){I._remoteStreams.push(B);var F=new Event("addstream");F.stream=B,I.dispatchEvent(F)}})}),M.apply(I,arguments)}}}function g(R){if(h(R)==="object"&&R.RTCPeerConnection){var M=R.RTCPeerConnection.prototype,I=M.createOffer,T=M.createAnswer,B=M.setLocalDescription,F=M.setRemoteDescription,D=M.addIceCandidate;M.createOffer=function(W,J){var ee=arguments.length>=2?arguments[2]:arguments[0],Q=I.apply(this,[ee]);return J?(Q.then(W,J),Promise.resolve()):Q},M.createAnswer=function(W,J){var ee=arguments.length>=2?arguments[2]:arguments[0],Q=T.apply(this,[ee]);return J?(Q.then(W,J),Promise.resolve()):Q};var U=function(W,J,ee){var Q=B.apply(this,[W]);return ee?(Q.then(J,ee),Promise.resolve()):Q};M.setLocalDescription=U,U=function(W,J,ee){var Q=F.apply(this,[W]);return ee?(Q.then(J,ee),Promise.resolve()):Q},M.setRemoteDescription=U,U=function(W,J,ee){var Q=D.apply(this,[W]);return ee?(Q.then(J,ee),Promise.resolve()):Q},M.addIceCandidate=U}}function m(R){var M=R&&R.navigator;if(M.mediaDevices&&M.mediaDevices.getUserMedia){var I=M.mediaDevices,T=I.getUserMedia.bind(I);M.mediaDevices.getUserMedia=function(B){return T(A(B))}}!M.getUserMedia&&M.mediaDevices&&M.mediaDevices.getUserMedia&&(M.getUserMedia=function(B,F,D){M.mediaDevices.getUserMedia(B).then(F,D)}.bind(M))}function A(R){return R&&R.video!==void 0?Object.assign({},R,{video:r.compactObject(R.video)}):R}function v(R){if(R.RTCPeerConnection){var M=R.RTCPeerConnection;R.RTCPeerConnection=function(I,T){if(I&&I.iceServers){for(var B=[],F=0;F<I.iceServers.length;F++){var D=I.iceServers[F];!D.hasOwnProperty("urls")&&D.hasOwnProperty("url")?(r.deprecated("RTCIceServer.url","RTCIceServer.urls"),(D=JSON.parse(JSON.stringify(D))).urls=D.url,delete D.url,B.push(D)):B.push(I.iceServers[F])}I.iceServers=B}return new M(I,T)},R.RTCPeerConnection.prototype=M.prototype,"generateCertificate"in M&&Object.defineProperty(R.RTCPeerConnection,"generateCertificate",{get:function(){return M.generateCertificate}})}}function w(R){h(R)==="object"&&R.RTCTrackEvent&&"receiver"in R.RTCTrackEvent.prototype&&!("transceiver"in R.RTCTrackEvent.prototype)&&Object.defineProperty(R.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function b(R){var M=R.RTCPeerConnection.prototype.createOffer;R.RTCPeerConnection.prototype.createOffer=function(I){if(I){I.offerToReceiveAudio!==void 0&&(I.offerToReceiveAudio=!!I.offerToReceiveAudio);var T=this.getTransceivers().find(function(F){return F.receiver.track.kind==="audio"});I.offerToReceiveAudio===!1&&T?T.direction==="sendrecv"?T.setDirection?T.setDirection("sendonly"):T.direction="sendonly":T.direction==="recvonly"&&(T.setDirection?T.setDirection("inactive"):T.direction="inactive"):I.offerToReceiveAudio!==!0||T||this.addTransceiver("audio"),I.offerToReceiveVideo!==void 0&&(I.offerToReceiveVideo=!!I.offerToReceiveVideo);var B=this.getTransceivers().find(function(F){return F.receiver.track.kind==="video"});I.offerToReceiveVideo===!1&&B?B.direction==="sendrecv"?B.setDirection?B.setDirection("sendonly"):B.direction="sendonly":B.direction==="recvonly"&&(B.setDirection?B.setDirection("inactive"):B.direction="inactive"):I.offerToReceiveVideo!==!0||B||this.addTransceiver("video")}return M.apply(this,arguments)}}function S(R){h(R)!=="object"||R.AudioContext||(R.AudioContext=R.webkitAudioContext)}},{"../utils":"iSxC"}],GOQK:[function(t,n,i){Object.defineProperty(i,"__esModule",{value:!0}),i.shimRTCIceCandidate=g,i.shimMaxMessageSize=m,i.shimSendThrowTypeError=A,i.shimConnectionState=v,i.removeExtmapAllowMixed=w,i.shimAddIceCandidateNullOrEmpty=b;var r=u(t("sdp")),o=h(t("./utils"));function l(){if(typeof WeakMap!="function")return null;var S=new WeakMap;return l=function(){return S},S}function h(S){if(S&&S.__esModule)return S;if(S===null||typeof S!="object"&&typeof S!="function")return{default:S};var R=l();if(R&&R.has(S))return R.get(S);var M={},I=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var T in S)if(Object.prototype.hasOwnProperty.call(S,T)){var B=I?Object.getOwnPropertyDescriptor(S,T):null;B&&(B.get||B.set)?Object.defineProperty(M,T,B):M[T]=S[T]}return M.default=S,R&&R.set(S,M),M}function u(S){return S&&S.__esModule?S:{default:S}}function f(S){return(f=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(R){return typeof R}:function(R){return R&&typeof Symbol=="function"&&R.constructor===Symbol&&R!==Symbol.prototype?"symbol":typeof R})(S)}function g(S){if(S.RTCIceCandidate&&!(S.RTCIceCandidate&&"foundation"in S.RTCIceCandidate.prototype)){var R=S.RTCIceCandidate;S.RTCIceCandidate=function(M){if(f(M)==="object"&&M.candidate&&M.candidate.indexOf("a=")===0&&((M=JSON.parse(JSON.stringify(M))).candidate=M.candidate.substr(2)),M.candidate&&M.candidate.length){var I=new R(M),T=r.default.parseCandidate(M.candidate),B=Object.assign(I,T);return B.toJSON=function(){return{candidate:B.candidate,sdpMid:B.sdpMid,sdpMLineIndex:B.sdpMLineIndex,usernameFragment:B.usernameFragment}},B}return new R(M)},S.RTCIceCandidate.prototype=R.prototype,o.wrapPeerConnectionEvent(S,"icecandidate",function(M){return M.candidate&&Object.defineProperty(M,"candidate",{value:new S.RTCIceCandidate(M.candidate),writable:"false"}),M})}}function m(S,R){if(S.RTCPeerConnection){"sctp"in S.RTCPeerConnection.prototype||Object.defineProperty(S.RTCPeerConnection.prototype,"sctp",{get:function(){return this._sctp===void 0?null:this._sctp}});var M=S.RTCPeerConnection.prototype.setRemoteDescription;S.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,R.browser==="chrome"&&R.version>=76){var{sdpSemantics:I}=this.getConfiguration();I==="plan-b"&&Object.defineProperty(this,"sctp",{get:function(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(function(ee){if(!ee||!ee.sdp)return!1;var Q=r.default.splitSections(ee.sdp);return Q.shift(),Q.some(function(Y){var se=r.default.parseMLine(Y);return se&&se.kind==="application"&&se.protocol.indexOf("SCTP")!==-1})}(arguments[0])){var T,B=function(ee){var Q=ee.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(Q===null||Q.length<2)return-1;var Y=parseInt(Q[1],10);return Y!=Y?-1:Y}(arguments[0]),F=(W=B,J=65536,R.browser==="firefox"&&(J=R.version<57?W===-1?16384:2147483637:R.version<60?R.version===57?65535:65536:2147483637),J),D=function(ee,Q){var Y=65536;R.browser==="firefox"&&R.version===57&&(Y=65535);var se=r.default.matchPrefix(ee.sdp,"a=max-message-size:");return se.length>0?Y=parseInt(se[0].substr(19),10):R.browser==="firefox"&&Q!==-1&&(Y=2147483637),Y}(arguments[0],B);T=F===0&&D===0?Number.POSITIVE_INFINITY:F===0||D===0?Math.max(F,D):Math.min(F,D);var U={};Object.defineProperty(U,"maxMessageSize",{get:function(){return T}}),this._sctp=U}var W,J;return M.apply(this,arguments)}}}function A(S){if(S.RTCPeerConnection&&"createDataChannel"in S.RTCPeerConnection.prototype){var R=S.RTCPeerConnection.prototype.createDataChannel;S.RTCPeerConnection.prototype.createDataChannel=function(){var I=R.apply(this,arguments);return M(I,this),I},o.wrapPeerConnectionEvent(S,"datachannel",function(I){return M(I.channel,I.target),I})}function M(I,T){var B=I.send;I.send=function(){var F=arguments[0],D=F.length||F.size||F.byteLength;if(I.readyState==="open"&&T.sctp&&D>T.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+T.sctp.maxMessageSize+" bytes)");return B.apply(I,arguments)}}}function v(S){if(S.RTCPeerConnection&&!("connectionState"in S.RTCPeerConnection.prototype)){var R=S.RTCPeerConnection.prototype;Object.defineProperty(R,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(R,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(M){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),M&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=M)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(function(M){var I=R[M];R[M]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(T){var B=T.target;if(B._lastConnectionState!==B.connectionState){B._lastConnectionState=B.connectionState;var F=new Event("connectionstatechange",T);B.dispatchEvent(F)}return T},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),I.apply(this,arguments)}})}}function w(S,R){if(S.RTCPeerConnection&&!(R.browser==="chrome"&&R.version>=71||R.browser==="safari"&&R.version>=605)){var M=S.RTCPeerConnection.prototype.setRemoteDescription;S.RTCPeerConnection.prototype.setRemoteDescription=function(I){if(I&&I.sdp&&I.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){var T=I.sdp.split(`
`).filter(function(B){return B.trim()!=="a=extmap-allow-mixed"}).join(`
`);S.RTCSessionDescription&&I instanceof S.RTCSessionDescription?arguments[0]=new S.RTCSessionDescription({type:I.type,sdp:T}):I.sdp=T}return M.apply(this,arguments)}}}function b(S,R){if(S.RTCPeerConnection&&S.RTCPeerConnection.prototype){var M=S.RTCPeerConnection.prototype.addIceCandidate;M&&M.length!==0&&(S.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(R.browser==="chrome"&&R.version<78||R.browser==="firefox"&&R.version<68||R.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():M.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}}},{sdp:"YHvh","./utils":"iSxC"}],KtlG:[function(t,n,i){Object.defineProperty(i,"__esModule",{value:!0}),i.adapterFactory=A;var r=m(t("./utils")),o=m(t("./chrome/chrome_shim")),l=m(t("./edge/edge_shim")),h=m(t("./firefox/firefox_shim")),u=m(t("./safari/safari_shim")),f=m(t("./common_shim"));function g(){if(typeof WeakMap!="function")return null;var v=new WeakMap;return g=function(){return v},v}function m(v){if(v&&v.__esModule)return v;if(v===null||typeof v!="object"&&typeof v!="function")return{default:v};var w=g();if(w&&w.has(v))return w.get(v);var b={},S=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var R in v)if(Object.prototype.hasOwnProperty.call(v,R)){var M=S?Object.getOwnPropertyDescriptor(v,R):null;M&&(M.get||M.set)?Object.defineProperty(b,R,M):b[R]=v[R]}return b.default=v,w&&w.set(v,b),b}function A(){var{window:v}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},w=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0},b=r.log,S=r.detectBrowser(v),R={browserDetails:S,commonShim:f,extractVersion:r.extractVersion,disableLog:r.disableLog,disableWarnings:r.disableWarnings};switch(S.browser){case"chrome":if(!o||!o.shimPeerConnection||!w.shimChrome)return b("Chrome shim is not included in this adapter release."),R;if(S.version===null)return b("Chrome shim can not determine version, not shimming."),R;b("adapter.js shimming chrome."),R.browserShim=o,f.shimAddIceCandidateNullOrEmpty(v,S),o.shimGetUserMedia(v,S),o.shimMediaStream(v,S),o.shimPeerConnection(v,S),o.shimOnTrack(v,S),o.shimAddTrackRemoveTrack(v,S),o.shimGetSendersWithDtmf(v,S),o.shimGetStats(v,S),o.shimSenderReceiverGetStats(v,S),o.fixNegotiationNeeded(v,S),f.shimRTCIceCandidate(v,S),f.shimConnectionState(v,S),f.shimMaxMessageSize(v,S),f.shimSendThrowTypeError(v,S),f.removeExtmapAllowMixed(v,S);break;case"firefox":if(!h||!h.shimPeerConnection||!w.shimFirefox)return b("Firefox shim is not included in this adapter release."),R;b("adapter.js shimming firefox."),R.browserShim=h,f.shimAddIceCandidateNullOrEmpty(v,S),h.shimGetUserMedia(v,S),h.shimPeerConnection(v,S),h.shimOnTrack(v,S),h.shimRemoveStream(v,S),h.shimSenderGetStats(v,S),h.shimReceiverGetStats(v,S),h.shimRTCDataChannel(v,S),h.shimAddTransceiver(v,S),h.shimGetParameters(v,S),h.shimCreateOffer(v,S),h.shimCreateAnswer(v,S),f.shimRTCIceCandidate(v,S),f.shimConnectionState(v,S),f.shimMaxMessageSize(v,S),f.shimSendThrowTypeError(v,S);break;case"edge":if(!l||!l.shimPeerConnection||!w.shimEdge)return b("MS edge shim is not included in this adapter release."),R;b("adapter.js shimming edge."),R.browserShim=l,l.shimGetUserMedia(v,S),l.shimGetDisplayMedia(v,S),l.shimPeerConnection(v,S),l.shimReplaceTrack(v,S),f.shimMaxMessageSize(v,S),f.shimSendThrowTypeError(v,S);break;case"safari":if(!u||!w.shimSafari)return b("Safari shim is not included in this adapter release."),R;b("adapter.js shimming safari."),R.browserShim=u,f.shimAddIceCandidateNullOrEmpty(v,S),u.shimRTCIceServerUrls(v,S),u.shimCreateOfferLegacy(v,S),u.shimCallbacksAPI(v,S),u.shimLocalStreamsAPI(v,S),u.shimRemoteStreamsAPI(v,S),u.shimTrackEventTransceiver(v,S),u.shimGetUserMedia(v,S),u.shimAudioContext(v,S),f.shimRTCIceCandidate(v,S),f.shimMaxMessageSize(v,S),f.shimSendThrowTypeError(v,S),f.removeExtmapAllowMixed(v,S);break;default:b("Unsupported browser!")}return R}},{"./utils":"iSxC","./chrome/chrome_shim":"uI5X","./edge/edge_shim":"XRic","./firefox/firefox_shim":"Fzdr","./safari/safari_shim":"t1lL","./common_shim":"GOQK"}],tI1X:[function(t,n,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var r=t("./adapter_factory.js"),o=(0,r.adapterFactory)({window:typeof window>"u"?void 0:window}),l=o;i.default=l},{"./adapter_factory.js":"KtlG"}],sXtV:[function(t,n,i){var r=this&&this.__importDefault||function(l){return l&&l.__esModule?l:{default:l}};Object.defineProperty(i,"__esModule",{value:!0}),i.webRTCAdapter=void 0;var o=r(t("webrtc-adapter"));i.webRTCAdapter=o.default},{"webrtc-adapter":"tI1X"}],I31f:[function(t,n,i){Object.defineProperty(i,"__esModule",{value:!0}),i.Supports=void 0;var r=t("./adapter");i.Supports=new(function(){function o(){this.isIOS=["iPad","iPhone","iPod"].includes(navigator.platform),this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}return o.prototype.isWebRTCSupported=function(){return typeof RTCPeerConnection<"u"},o.prototype.isBrowserSupported=function(){var l=this.getBrowser(),h=this.getVersion();return!!this.supportedBrowsers.includes(l)&&(l==="chrome"?h>=this.minChromeVersion:l==="firefox"?h>=this.minFirefoxVersion:l==="safari"&&!this.isIOS&&h>=this.minSafariVersion)},o.prototype.getBrowser=function(){return r.webRTCAdapter.browserDetails.browser},o.prototype.getVersion=function(){return r.webRTCAdapter.browserDetails.version||0},o.prototype.isUnifiedPlanSupported=function(){var l,h=this.getBrowser(),u=r.webRTCAdapter.browserDetails.version||0;if(h==="chrome"&&u<72)return!1;if(h==="firefox"&&u>=59)return!0;if(!(window.RTCRtpTransceiver&&"currentDirection"in RTCRtpTransceiver.prototype))return!1;var f=!1;try{(l=new RTCPeerConnection).addTransceiver("audio"),f=!0}catch{}finally{l&&l.close()}return f},o.prototype.toString=function(){return`Supports: 
    browser:`+this.getBrowser()+` 
    version:`+this.getVersion()+` 
    isIOS:`+this.isIOS+` 
    isWebRTCSupported:`+this.isWebRTCSupported()+` 
    isBrowserSupported:`+this.isBrowserSupported()+` 
    isUnifiedPlanSupported:`+this.isUnifiedPlanSupported()},o}())},{"./adapter":"sXtV"}],BHXf:[function(t,n,i){var r=this&&this.__createBinding||(Object.create?function(g,m,A,v){v===void 0&&(v=A),Object.defineProperty(g,v,{enumerable:!0,get:function(){return m[A]}})}:function(g,m,A,v){v===void 0&&(v=A),g[v]=m[A]}),o=this&&this.__setModuleDefault||(Object.create?function(g,m){Object.defineProperty(g,"default",{enumerable:!0,value:m})}:function(g,m){g.default=m}),l=this&&this.__importStar||function(g){if(g&&g.__esModule)return g;var m={};if(g!=null)for(var A in g)A!=="default"&&Object.prototype.hasOwnProperty.call(g,A)&&r(m,g,A);return o(m,g),m};Object.defineProperty(i,"__esModule",{value:!0}),i.util=void 0;var h=l(t("peerjs-js-binarypack")),u=t("./supports"),f={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"turn:0.peerjs.com:3478",username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"};i.util=new(function(){function g(){this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.chunkedMTU=16300,this.defaultConfig=f,this.browser=u.Supports.getBrowser(),this.browserVersion=u.Supports.getVersion(),this.supports=function(){var m,A={browser:u.Supports.isBrowserSupported(),webRTC:u.Supports.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!A.webRTC)return A;try{m=new RTCPeerConnection(f),A.audioVideo=!0;var v=void 0;try{v=m.createDataChannel("_PEERJSTEST",{ordered:!0}),A.data=!0,A.reliable=!!v.ordered;try{v.binaryType="blob",A.binaryBlob=!u.Supports.isIOS}catch{}}catch{}finally{v&&v.close()}}catch{}finally{m&&m.close()}return A}(),this.pack=h.pack,this.unpack=h.unpack,this._dataCount=1}return g.prototype.noop=function(){},g.prototype.validateId=function(m){return!m||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(m)},g.prototype.chunk=function(m){for(var A=[],v=m.size,w=Math.ceil(v/i.util.chunkedMTU),b=0,S=0;S<v;){var R=Math.min(v,S+i.util.chunkedMTU),M=m.slice(S,R),I={__peerData:this._dataCount,n:b,data:M,total:w};A.push(I),S=R,b++}return this._dataCount++,A},g.prototype.blobToArrayBuffer=function(m,A){var v=new FileReader;return v.onload=function(w){w.target&&A(w.target.result)},v.readAsArrayBuffer(m),v},g.prototype.binaryStringToArrayBuffer=function(m){for(var A=new Uint8Array(m.length),v=0;v<m.length;v++)A[v]=255&m.charCodeAt(v);return A.buffer},g.prototype.randomToken=function(){return Math.random().toString(36).substr(2)},g.prototype.isSecure=function(){return location.protocol==="https:"},g}())},{"peerjs-js-binarypack":"kdPp","./supports":"I31f"}],JJlS:[function(t,n,i){var r=Object.prototype.hasOwnProperty,o="~";function l(){}function h(m,A,v){this.fn=m,this.context=A,this.once=v||!1}function u(m,A,v,w,b){if(typeof v!="function")throw new TypeError("The listener must be a function");var S=new h(v,w||m,b),R=o?o+A:A;return m._events[R]?m._events[R].fn?m._events[R]=[m._events[R],S]:m._events[R].push(S):(m._events[R]=S,m._eventsCount++),m}function f(m,A){--m._eventsCount==0?m._events=new l:delete m._events[A]}function g(){this._events=new l,this._eventsCount=0}Object.create&&(l.prototype=Object.create(null),new l().__proto__||(o=!1)),g.prototype.eventNames=function(){var m,A,v=[];if(this._eventsCount===0)return v;for(A in m=this._events)r.call(m,A)&&v.push(o?A.slice(1):A);return Object.getOwnPropertySymbols?v.concat(Object.getOwnPropertySymbols(m)):v},g.prototype.listeners=function(m){var A=o?o+m:m,v=this._events[A];if(!v)return[];if(v.fn)return[v.fn];for(var w=0,b=v.length,S=new Array(b);w<b;w++)S[w]=v[w].fn;return S},g.prototype.listenerCount=function(m){var A=o?o+m:m,v=this._events[A];return v?v.fn?1:v.length:0},g.prototype.emit=function(m,A,v,w,b,S){var R=o?o+m:m;if(!this._events[R])return!1;var M,I,T=this._events[R],B=arguments.length;if(T.fn){switch(T.once&&this.removeListener(m,T.fn,void 0,!0),B){case 1:return T.fn.call(T.context),!0;case 2:return T.fn.call(T.context,A),!0;case 3:return T.fn.call(T.context,A,v),!0;case 4:return T.fn.call(T.context,A,v,w),!0;case 5:return T.fn.call(T.context,A,v,w,b),!0;case 6:return T.fn.call(T.context,A,v,w,b,S),!0}for(I=1,M=new Array(B-1);I<B;I++)M[I-1]=arguments[I];T.fn.apply(T.context,M)}else{var F,D=T.length;for(I=0;I<D;I++)switch(T[I].once&&this.removeListener(m,T[I].fn,void 0,!0),B){case 1:T[I].fn.call(T[I].context);break;case 2:T[I].fn.call(T[I].context,A);break;case 3:T[I].fn.call(T[I].context,A,v);break;case 4:T[I].fn.call(T[I].context,A,v,w);break;default:if(!M)for(F=1,M=new Array(B-1);F<B;F++)M[F-1]=arguments[F];T[I].fn.apply(T[I].context,M)}}return!0},g.prototype.on=function(m,A,v){return u(this,m,A,v,!1)},g.prototype.once=function(m,A,v){return u(this,m,A,v,!0)},g.prototype.removeListener=function(m,A,v,w){var b=o?o+m:m;if(!this._events[b])return this;if(!A)return f(this,b),this;var S=this._events[b];if(S.fn)S.fn!==A||w&&!S.once||v&&S.context!==v||f(this,b);else{for(var R=0,M=[],I=S.length;R<I;R++)(S[R].fn!==A||w&&!S[R].once||v&&S[R].context!==v)&&M.push(S[R]);M.length?this._events[b]=M.length===1?M[0]:M:f(this,b)}return this},g.prototype.removeAllListeners=function(m){var A;return m?(A=o?o+m:m,this._events[A]&&f(this,A)):(this._events=new l,this._eventsCount=0),this},g.prototype.off=g.prototype.removeListener,g.prototype.addListener=g.prototype.on,g.prefixed=o,g.EventEmitter=g,typeof n<"u"&&(n.exports=g)},{}],WOs9:[function(t,n,i){var r=this&&this.__read||function(f,g){var m=typeof Symbol=="function"&&f[Symbol.iterator];if(!m)return f;var A,v,w=m.call(f),b=[];try{for(;(g===void 0||g-- >0)&&!(A=w.next()).done;)b.push(A.value)}catch(S){v={error:S}}finally{try{A&&!A.done&&(m=w.return)&&m.call(w)}finally{if(v)throw v.error}}return b},o=this&&this.__spreadArray||function(f,g){for(var m=0,A=g.length,v=f.length;m<A;m++,v++)f[v]=g[m];return f};Object.defineProperty(i,"__esModule",{value:!0}),i.LogLevel=void 0;var l,h="PeerJS: ";(function(f){f[f.Disabled=0]="Disabled",f[f.Errors=1]="Errors",f[f.Warnings=2]="Warnings",f[f.All=3]="All"})(l=i.LogLevel||(i.LogLevel={}));var u=function(){function f(){this._logLevel=l.Disabled}return Object.defineProperty(f.prototype,"logLevel",{get:function(){return this._logLevel},set:function(g){this._logLevel=g},enumerable:!1,configurable:!0}),f.prototype.log=function(){for(var g=[],m=0;m<arguments.length;m++)g[m]=arguments[m];this._logLevel>=l.All&&this._print.apply(this,o([l.All],r(g)))},f.prototype.warn=function(){for(var g=[],m=0;m<arguments.length;m++)g[m]=arguments[m];this._logLevel>=l.Warnings&&this._print.apply(this,o([l.Warnings],r(g)))},f.prototype.error=function(){for(var g=[],m=0;m<arguments.length;m++)g[m]=arguments[m];this._logLevel>=l.Errors&&this._print.apply(this,o([l.Errors],r(g)))},f.prototype.setLogFunction=function(g){this._print=g},f.prototype._print=function(g){for(var m=[],A=1;A<arguments.length;A++)m[A-1]=arguments[A];var v=o([h],r(m));for(var w in v)v[w]instanceof Error&&(v[w]="("+v[w].name+") "+v[w].message);g>=l.All?console.log.apply(console,o([],r(v))):g>=l.Warnings?console.warn.apply(console,o(["WARNING"],r(v))):g>=l.Errors&&console.error.apply(console,o(["ERROR"],r(v)))},f}();i.default=new u},{}],ZRYf:[function(t,n,i){Object.defineProperty(i,"__esModule",{value:!0}),i.ServerMessageType=i.SocketEventType=i.SerializationType=i.PeerErrorType=i.PeerEventType=i.ConnectionType=i.ConnectionEventType=void 0,function(r){r.Open="open",r.Stream="stream",r.Data="data",r.Close="close",r.Error="error",r.IceStateChanged="iceStateChanged"}(i.ConnectionEventType||(i.ConnectionEventType={})),function(r){r.Data="data",r.Media="media"}(i.ConnectionType||(i.ConnectionType={})),function(r){r.Open="open",r.Close="close",r.Connection="connection",r.Call="call",r.Disconnected="disconnected",r.Error="error"}(i.PeerEventType||(i.PeerEventType={})),function(r){r.BrowserIncompatible="browser-incompatible",r.Disconnected="disconnected",r.InvalidID="invalid-id",r.InvalidKey="invalid-key",r.Network="network",r.PeerUnavailable="peer-unavailable",r.SslUnavailable="ssl-unavailable",r.ServerError="server-error",r.SocketError="socket-error",r.SocketClosed="socket-closed",r.UnavailableID="unavailable-id",r.WebRTC="webrtc"}(i.PeerErrorType||(i.PeerErrorType={})),function(r){r.Binary="binary",r.BinaryUTF8="binary-utf8",r.JSON="json"}(i.SerializationType||(i.SerializationType={})),function(r){r.Message="message",r.Disconnected="disconnected",r.Error="error",r.Close="close"}(i.SocketEventType||(i.SocketEventType={})),function(r){r.Heartbeat="HEARTBEAT",r.Candidate="CANDIDATE",r.Offer="OFFER",r.Answer="ANSWER",r.Open="OPEN",r.Error="ERROR",r.IdTaken="ID-TAKEN",r.InvalidKey="INVALID-KEY",r.Leave="LEAVE",r.Expire="EXPIRE"}(i.ServerMessageType||(i.ServerMessageType={}))},{}],wJlv:[function(t,n,i){var r=this&&this.__extends||function(){var v=function(w,b){return(v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(S,R){S.__proto__=R}||function(S,R){for(var M in R)Object.prototype.hasOwnProperty.call(R,M)&&(S[M]=R[M])})(w,b)};return function(w,b){if(typeof b!="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function S(){this.constructor=w}v(w,b),w.prototype=b===null?Object.create(b):(S.prototype=b.prototype,new S)}}(),o=this&&this.__read||function(v,w){var b=typeof Symbol=="function"&&v[Symbol.iterator];if(!b)return v;var S,R,M=b.call(v),I=[];try{for(;(w===void 0||w-- >0)&&!(S=M.next()).done;)I.push(S.value)}catch(T){R={error:T}}finally{try{S&&!S.done&&(b=M.return)&&b.call(M)}finally{if(R)throw R.error}}return I},l=this&&this.__spreadArray||function(v,w){for(var b=0,S=w.length,R=v.length;b<S;b++,R++)v[R]=w[b];return v},h=this&&this.__values||function(v){var w=typeof Symbol=="function"&&Symbol.iterator,b=w&&v[w],S=0;if(b)return b.call(v);if(v&&typeof v.length=="number")return{next:function(){return v&&S>=v.length&&(v=void 0),{value:v&&v[S++],done:!v}}};throw new TypeError(w?"Object is not iterable.":"Symbol.iterator is not defined.")},u=this&&this.__importDefault||function(v){return v&&v.__esModule?v:{default:v}};Object.defineProperty(i,"__esModule",{value:!0}),i.Socket=void 0;var f=t("eventemitter3"),g=u(t("./logger")),m=t("./enums"),A=function(v){function w(b,S,R,M,I,T){T===void 0&&(T=5e3);var B=v.call(this)||this;B.pingInterval=T,B._disconnected=!0,B._messagesQueue=[];var F=b?"wss://":"ws://";return B._baseUrl=F+S+":"+R+M+"peerjs?key="+I,B}return r(w,v),w.prototype.start=function(b,S){var R=this;this._id=b;var M=this._baseUrl+"&id="+b+"&token="+S;!this._socket&&this._disconnected&&(this._socket=new WebSocket(M),this._disconnected=!1,this._socket.onmessage=function(I){var T;try{T=JSON.parse(I.data),g.default.log("Server message received:",T)}catch{return void g.default.log("Invalid server message",I.data)}R.emit(m.SocketEventType.Message,T)},this._socket.onclose=function(I){R._disconnected||(g.default.log("Socket closed.",I),R._cleanup(),R._disconnected=!0,R.emit(m.SocketEventType.Disconnected))},this._socket.onopen=function(){R._disconnected||(R._sendQueuedMessages(),g.default.log("Socket open"),R._scheduleHeartbeat())})},w.prototype._scheduleHeartbeat=function(){var b=this;this._wsPingTimer=setTimeout(function(){b._sendHeartbeat()},this.pingInterval)},w.prototype._sendHeartbeat=function(){if(this._wsOpen()){var b=JSON.stringify({type:m.ServerMessageType.Heartbeat});this._socket.send(b),this._scheduleHeartbeat()}else g.default.log("Cannot send heartbeat, because socket closed")},w.prototype._wsOpen=function(){return!!this._socket&&this._socket.readyState===1},w.prototype._sendQueuedMessages=function(){var b,S,R=l([],o(this._messagesQueue));this._messagesQueue=[];try{for(var M=h(R),I=M.next();!I.done;I=M.next()){var T=I.value;this.send(T)}}catch(B){b={error:B}}finally{try{I&&!I.done&&(S=M.return)&&S.call(M)}finally{if(b)throw b.error}}},w.prototype.send=function(b){if(!this._disconnected)if(this._id)if(b.type){if(this._wsOpen()){var S=JSON.stringify(b);this._socket.send(S)}}else this.emit(m.SocketEventType.Error,"Invalid message");else this._messagesQueue.push(b)},w.prototype.close=function(){this._disconnected||(this._cleanup(),this._disconnected=!0)},w.prototype._cleanup=function(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)},w}(f.EventEmitter);i.Socket=A},{eventemitter3:"JJlS","./logger":"WOs9","./enums":"ZRYf"}],HCdX:[function(t,n,i){var r=this&&this.__assign||function(){return(r=Object.assign||function(A){for(var v,w=1,b=arguments.length;w<b;w++)for(var S in v=arguments[w])Object.prototype.hasOwnProperty.call(v,S)&&(A[S]=v[S]);return A}).apply(this,arguments)},o=this&&this.__awaiter||function(A,v,w,b){return new(w||(w=Promise))(function(S,R){function M(B){try{T(b.next(B))}catch(F){R(F)}}function I(B){try{T(b.throw(B))}catch(F){R(F)}}function T(B){var F;B.done?S(B.value):(F=B.value,F instanceof w?F:new w(function(D){D(F)})).then(M,I)}T((b=b.apply(A,v||[])).next())})},l=this&&this.__generator||function(A,v){var w,b,S,R,M={label:0,sent:function(){if(1&S[0])throw S[1];return S[1]},trys:[],ops:[]};return R={next:I(0),throw:I(1),return:I(2)},typeof Symbol=="function"&&(R[Symbol.iterator]=function(){return this}),R;function I(T){return function(B){return function(F){if(w)throw new TypeError("Generator is already executing.");for(;M;)try{if(w=1,b&&(S=2&F[0]?b.return:F[0]?b.throw||((S=b.return)&&S.call(b),0):b.next)&&!(S=S.call(b,F[1])).done)return S;switch(b=0,S&&(F=[2&F[0],S.value]),F[0]){case 0:case 1:S=F;break;case 4:return M.label++,{value:F[1],done:!1};case 5:M.label++,b=F[1],F=[0];continue;case 7:F=M.ops.pop(),M.trys.pop();continue;default:if(!(S=(S=M.trys).length>0&&S[S.length-1])&&(F[0]===6||F[0]===2)){M=0;continue}if(F[0]===3&&(!S||F[1]>S[0]&&F[1]<S[3])){M.label=F[1];break}if(F[0]===6&&M.label<S[1]){M.label=S[1],S=F;break}if(S&&M.label<S[2]){M.label=S[2],M.ops.push(F);break}S[2]&&M.ops.pop(),M.trys.pop();continue}F=v.call(A,M)}catch(D){F=[6,D],b=0}finally{w=S=0}if(5&F[0])throw F[1];return{value:F[0]?F[1]:void 0,done:!0}}([T,B])}}},h=this&&this.__importDefault||function(A){return A&&A.__esModule?A:{default:A}};Object.defineProperty(i,"__esModule",{value:!0}),i.Negotiator=void 0;var u=t("./util"),f=h(t("./logger")),g=t("./enums"),m=function(){function A(v){this.connection=v}return A.prototype.startConnection=function(v){var w=this._startPeerConnection();if(this.connection.peerConnection=w,this.connection.type===g.ConnectionType.Media&&v._stream&&this._addTracksToConnection(v._stream,w),v.originator){if(this.connection.type===g.ConnectionType.Data){var b=this.connection,S={ordered:!!v.reliable},R=w.createDataChannel(b.label,S);b.initialize(R)}this._makeOffer()}else this.handleSDP("OFFER",v.sdp)},A.prototype._startPeerConnection=function(){f.default.log("Creating RTCPeerConnection.");var v=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(v),v},A.prototype._setupListeners=function(v){var w=this,b=this.connection.peer,S=this.connection.connectionId,R=this.connection.type,M=this.connection.provider;f.default.log("Listening for ICE candidates."),v.onicecandidate=function(I){I.candidate&&I.candidate.candidate&&(f.default.log("Received ICE candidates for "+b+":",I.candidate),M.socket.send({type:g.ServerMessageType.Candidate,payload:{candidate:I.candidate,type:R,connectionId:S},dst:b}))},v.oniceconnectionstatechange=function(){switch(v.iceConnectionState){case"failed":f.default.log("iceConnectionState is failed, closing connections to "+b),w.connection.emit(g.ConnectionEventType.Error,new Error("Negotiation of connection to "+b+" failed.")),w.connection.close();break;case"closed":f.default.log("iceConnectionState is closed, closing connections to "+b),w.connection.emit(g.ConnectionEventType.Error,new Error("Connection to "+b+" closed.")),w.connection.close();break;case"disconnected":f.default.log("iceConnectionState changed to disconnected on the connection with "+b);break;case"completed":v.onicecandidate=u.util.noop}w.connection.emit(g.ConnectionEventType.IceStateChanged,v.iceConnectionState)},f.default.log("Listening for data channel"),v.ondatachannel=function(I){f.default.log("Received data channel");var T=I.channel;M.getConnection(b,S).initialize(T)},f.default.log("Listening for remote stream"),v.ontrack=function(I){f.default.log("Received remote stream");var T=I.streams[0],B=M.getConnection(b,S);if(B.type===g.ConnectionType.Media){var F=B;w._addStreamToMediaConnection(T,F)}}},A.prototype.cleanup=function(){f.default.log("Cleaning up PeerConnection to "+this.connection.peer);var v=this.connection.peerConnection;if(v){this.connection.peerConnection=null,v.onicecandidate=v.oniceconnectionstatechange=v.ondatachannel=v.ontrack=function(){};var w=v.signalingState!=="closed",b=!1;if(this.connection.type===g.ConnectionType.Data){var S=this.connection.dataChannel;S&&(b=!!S.readyState&&S.readyState!=="closed")}(w||b)&&v.close()}},A.prototype._makeOffer=function(){return o(this,void 0,Promise,function(){var v,w,b,S,R,M,I;return l(this,function(T){switch(T.label){case 0:v=this.connection.peerConnection,w=this.connection.provider,T.label=1;case 1:return T.trys.push([1,7,,8]),[4,v.createOffer(this.connection.options.constraints)];case 2:b=T.sent(),f.default.log("Created offer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(b.sdp=this.connection.options.sdpTransform(b.sdp)||b.sdp),T.label=3;case 3:return T.trys.push([3,5,,6]),[4,v.setLocalDescription(b)];case 4:return T.sent(),f.default.log("Set localDescription:",b,"for:"+this.connection.peer),S={sdp:b,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata,browser:u.util.browser},this.connection.type===g.ConnectionType.Data&&(R=this.connection,S=r(r({},S),{label:R.label,reliable:R.reliable,serialization:R.serialization})),w.socket.send({type:g.ServerMessageType.Offer,payload:S,dst:this.connection.peer}),[3,6];case 5:return(M=T.sent())!="OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"&&(w.emitError(g.PeerErrorType.WebRTC,M),f.default.log("Failed to setLocalDescription, ",M)),[3,6];case 6:return[3,8];case 7:return I=T.sent(),w.emitError(g.PeerErrorType.WebRTC,I),f.default.log("Failed to createOffer, ",I),[3,8];case 8:return[2]}})})},A.prototype._makeAnswer=function(){return o(this,void 0,Promise,function(){var v,w,b,S,R;return l(this,function(M){switch(M.label){case 0:v=this.connection.peerConnection,w=this.connection.provider,M.label=1;case 1:return M.trys.push([1,7,,8]),[4,v.createAnswer()];case 2:b=M.sent(),f.default.log("Created answer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(b.sdp=this.connection.options.sdpTransform(b.sdp)||b.sdp),M.label=3;case 3:return M.trys.push([3,5,,6]),[4,v.setLocalDescription(b)];case 4:return M.sent(),f.default.log("Set localDescription:",b,"for:"+this.connection.peer),w.socket.send({type:g.ServerMessageType.Answer,payload:{sdp:b,type:this.connection.type,connectionId:this.connection.connectionId,browser:u.util.browser},dst:this.connection.peer}),[3,6];case 5:return S=M.sent(),w.emitError(g.PeerErrorType.WebRTC,S),f.default.log("Failed to setLocalDescription, ",S),[3,6];case 6:return[3,8];case 7:return R=M.sent(),w.emitError(g.PeerErrorType.WebRTC,R),f.default.log("Failed to create answer, ",R),[3,8];case 8:return[2]}})})},A.prototype.handleSDP=function(v,w){return o(this,void 0,Promise,function(){var b,S,R,M;return l(this,function(I){switch(I.label){case 0:w=new RTCSessionDescription(w),b=this.connection.peerConnection,S=this.connection.provider,f.default.log("Setting remote description",w),R=this,I.label=1;case 1:return I.trys.push([1,5,,6]),[4,b.setRemoteDescription(w)];case 2:return I.sent(),f.default.log("Set remoteDescription:"+v+" for:"+this.connection.peer),v!=="OFFER"?[3,4]:[4,R._makeAnswer()];case 3:I.sent(),I.label=4;case 4:return[3,6];case 5:return M=I.sent(),S.emitError(g.PeerErrorType.WebRTC,M),f.default.log("Failed to setRemoteDescription, ",M),[3,6];case 6:return[2]}})})},A.prototype.handleCandidate=function(v){return o(this,void 0,Promise,function(){var w,b,S,R,M,I;return l(this,function(T){switch(T.label){case 0:f.default.log("handleCandidate:",v),w=v.candidate,b=v.sdpMLineIndex,S=v.sdpMid,R=this.connection.peerConnection,M=this.connection.provider,T.label=1;case 1:return T.trys.push([1,3,,4]),[4,R.addIceCandidate(new RTCIceCandidate({sdpMid:S,sdpMLineIndex:b,candidate:w}))];case 2:return T.sent(),f.default.log("Added ICE candidate for:"+this.connection.peer),[3,4];case 3:return I=T.sent(),M.emitError(g.PeerErrorType.WebRTC,I),f.default.log("Failed to handleCandidate, ",I),[3,4];case 4:return[2]}})})},A.prototype._addTracksToConnection=function(v,w){if(f.default.log("add tracks from stream "+v.id+" to peer connection"),!w.addTrack)return f.default.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");v.getTracks().forEach(function(b){w.addTrack(b,v)})},A.prototype._addStreamToMediaConnection=function(v,w){f.default.log("add stream "+v.id+" to media connection "+w.connectionId),w.addStream(v)},A}();i.Negotiator=m},{"./util":"BHXf","./logger":"WOs9","./enums":"ZRYf"}],tQFK:[function(t,n,i){var r=this&&this.__extends||function(){var h=function(u,f){return(h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(g,m){g.__proto__=m}||function(g,m){for(var A in m)Object.prototype.hasOwnProperty.call(m,A)&&(g[A]=m[A])})(u,f)};return function(u,f){if(typeof f!="function"&&f!==null)throw new TypeError("Class extends value "+String(f)+" is not a constructor or null");function g(){this.constructor=u}h(u,f),u.prototype=f===null?Object.create(f):(g.prototype=f.prototype,new g)}}();Object.defineProperty(i,"__esModule",{value:!0}),i.BaseConnection=void 0;var o=t("eventemitter3"),l=function(h){function u(f,g,m){var A=h.call(this)||this;return A.peer=f,A.provider=g,A.options=m,A._open=!1,A.metadata=m.metadata,A}return r(u,h),Object.defineProperty(u.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),u}(o.EventEmitter);i.BaseConnection=l},{eventemitter3:"JJlS"}],dbHP:[function(t,n,i){var r=this&&this.__extends||function(){var w=function(b,S){return(w=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,M){R.__proto__=M}||function(R,M){for(var I in M)Object.prototype.hasOwnProperty.call(M,I)&&(R[I]=M[I])})(b,S)};return function(b,S){if(typeof S!="function"&&S!==null)throw new TypeError("Class extends value "+String(S)+" is not a constructor or null");function R(){this.constructor=b}w(b,S),b.prototype=S===null?Object.create(S):(R.prototype=S.prototype,new R)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(w){for(var b,S=1,R=arguments.length;S<R;S++)for(var M in b=arguments[S])Object.prototype.hasOwnProperty.call(b,M)&&(w[M]=b[M]);return w}).apply(this,arguments)},l=this&&this.__values||function(w){var b=typeof Symbol=="function"&&Symbol.iterator,S=b&&w[b],R=0;if(S)return S.call(w);if(w&&typeof w.length=="number")return{next:function(){return w&&R>=w.length&&(w=void 0),{value:w&&w[R++],done:!w}}};throw new TypeError(b?"Object is not iterable.":"Symbol.iterator is not defined.")},h=this&&this.__importDefault||function(w){return w&&w.__esModule?w:{default:w}};Object.defineProperty(i,"__esModule",{value:!0}),i.MediaConnection=void 0;var u=t("./util"),f=h(t("./logger")),g=t("./negotiator"),m=t("./enums"),A=t("./baseconnection"),v=function(w){function b(S,R,M){var I=w.call(this,S,R,M)||this;return I._localStream=I.options._stream,I.connectionId=I.options.connectionId||b.ID_PREFIX+u.util.randomToken(),I._negotiator=new g.Negotiator(I),I._localStream&&I._negotiator.startConnection({_stream:I._localStream,originator:!0}),I}return r(b,w),Object.defineProperty(b.prototype,"type",{get:function(){return m.ConnectionType.Media},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"localStream",{get:function(){return this._localStream},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"remoteStream",{get:function(){return this._remoteStream},enumerable:!1,configurable:!0}),b.prototype.addStream=function(S){f.default.log("Receiving stream",S),this._remoteStream=S,w.prototype.emit.call(this,m.ConnectionEventType.Stream,S)},b.prototype.handleMessage=function(S){var R=S.type,M=S.payload;switch(S.type){case m.ServerMessageType.Answer:this._negotiator.handleSDP(R,M.sdp),this._open=!0;break;case m.ServerMessageType.Candidate:this._negotiator.handleCandidate(M.candidate);break;default:f.default.warn("Unrecognized message type:"+R+" from peer:"+this.peer)}},b.prototype.answer=function(S,R){var M,I;if(R===void 0&&(R={}),this._localStream)f.default.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");else{this._localStream=S,R&&R.sdpTransform&&(this.options.sdpTransform=R.sdpTransform),this._negotiator.startConnection(o(o({},this.options._payload),{_stream:S}));var T=this.provider._getMessages(this.connectionId);try{for(var B=l(T),F=B.next();!F.done;F=B.next()){var D=F.value;this.handleMessage(D)}}catch(U){M={error:U}}finally{try{F&&!F.done&&(I=B.return)&&I.call(B)}finally{if(M)throw M.error}}this._open=!0}},b.prototype.close=function(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,w.prototype.emit.call(this,m.ConnectionEventType.Close))},b.ID_PREFIX="mc_",b}(A.BaseConnection);i.MediaConnection=v},{"./util":"BHXf","./logger":"WOs9","./negotiator":"HCdX","./enums":"ZRYf","./baseconnection":"tQFK"}],GGp6:[function(t,n,i){var r=this&&this.__extends||function(){var f=function(g,m){return(f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(A,v){A.__proto__=v}||function(A,v){for(var w in v)Object.prototype.hasOwnProperty.call(v,w)&&(A[w]=v[w])})(g,m)};return function(g,m){if(typeof m!="function"&&m!==null)throw new TypeError("Class extends value "+String(m)+" is not a constructor or null");function A(){this.constructor=g}f(g,m),g.prototype=m===null?Object.create(m):(A.prototype=m.prototype,new A)}}(),o=this&&this.__importDefault||function(f){return f&&f.__esModule?f:{default:f}};Object.defineProperty(i,"__esModule",{value:!0}),i.EncodingQueue=void 0;var l=t("eventemitter3"),h=o(t("./logger")),u=function(f){function g(){var m=f.call(this)||this;return m.fileReader=new FileReader,m._queue=[],m._processing=!1,m.fileReader.onload=function(A){m._processing=!1,A.target&&m.emit("done",A.target.result),m.doNextTask()},m.fileReader.onerror=function(A){h.default.error("EncodingQueue error:",A),m._processing=!1,m.destroy(),m.emit("error",A)},m}return r(g,f),Object.defineProperty(g.prototype,"queue",{get:function(){return this._queue},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"size",{get:function(){return this.queue.length},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"processing",{get:function(){return this._processing},enumerable:!1,configurable:!0}),g.prototype.enque=function(m){this.queue.push(m),this.processing||this.doNextTask()},g.prototype.destroy=function(){this.fileReader.abort(),this._queue=[]},g.prototype.doNextTask=function(){this.size!==0&&(this.processing||(this._processing=!0,this.fileReader.readAsArrayBuffer(this.queue.shift())))},g}(l.EventEmitter);i.EncodingQueue=u},{eventemitter3:"JJlS","./logger":"WOs9"}],GBTQ:[function(t,n,i){var r=this&&this.__extends||function(){var w=function(b,S){return(w=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,M){R.__proto__=M}||function(R,M){for(var I in M)Object.prototype.hasOwnProperty.call(M,I)&&(R[I]=M[I])})(b,S)};return function(b,S){if(typeof S!="function"&&S!==null)throw new TypeError("Class extends value "+String(S)+" is not a constructor or null");function R(){this.constructor=b}w(b,S),b.prototype=S===null?Object.create(S):(R.prototype=S.prototype,new R)}}(),o=this&&this.__values||function(w){var b=typeof Symbol=="function"&&Symbol.iterator,S=b&&w[b],R=0;if(S)return S.call(w);if(w&&typeof w.length=="number")return{next:function(){return w&&R>=w.length&&(w=void 0),{value:w&&w[R++],done:!w}}};throw new TypeError(b?"Object is not iterable.":"Symbol.iterator is not defined.")},l=this&&this.__importDefault||function(w){return w&&w.__esModule?w:{default:w}};Object.defineProperty(i,"__esModule",{value:!0}),i.DataConnection=void 0;var h=t("./util"),u=l(t("./logger")),f=t("./negotiator"),g=t("./enums"),m=t("./baseconnection"),A=t("./encodingQueue"),v=function(w){function b(S,R,M){var I=w.call(this,S,R,M)||this;return I.stringify=JSON.stringify,I.parse=JSON.parse,I._buffer=[],I._bufferSize=0,I._buffering=!1,I._chunkedData={},I._encodingQueue=new A.EncodingQueue,I.connectionId=I.options.connectionId||b.ID_PREFIX+h.util.randomToken(),I.label=I.options.label||I.connectionId,I.serialization=I.options.serialization||g.SerializationType.Binary,I.reliable=!!I.options.reliable,I._encodingQueue.on("done",function(T){I._bufferedSend(T)}),I._encodingQueue.on("error",function(){u.default.error("DC#"+I.connectionId+": Error occured in encoding from blob to arraybuffer, close DC"),I.close()}),I._negotiator=new f.Negotiator(I),I._negotiator.startConnection(I.options._payload||{originator:!0}),I}return r(b,w),Object.defineProperty(b.prototype,"type",{get:function(){return g.ConnectionType.Data},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"dataChannel",{get:function(){return this._dc},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"bufferSize",{get:function(){return this._bufferSize},enumerable:!1,configurable:!0}),b.prototype.initialize=function(S){this._dc=S,this._configureDataChannel()},b.prototype._configureDataChannel=function(){var S=this;h.util.supports.binaryBlob&&!h.util.supports.reliable||(this.dataChannel.binaryType="arraybuffer"),this.dataChannel.onopen=function(){u.default.log("DC#"+S.connectionId+" dc connection success"),S._open=!0,S.emit(g.ConnectionEventType.Open)},this.dataChannel.onmessage=function(R){u.default.log("DC#"+S.connectionId+" dc onmessage:",R.data),S._handleDataMessage(R)},this.dataChannel.onclose=function(){u.default.log("DC#"+S.connectionId+" dc closed for:",S.peer),S.close()}},b.prototype._handleDataMessage=function(S){var R=this,M=S.data,I=M.constructor,T=M;if(this.serialization===g.SerializationType.Binary||this.serialization===g.SerializationType.BinaryUTF8){if(I===Blob)return void h.util.blobToArrayBuffer(M,function(F){var D=h.util.unpack(F);R.emit(g.ConnectionEventType.Data,D)});if(I===ArrayBuffer)T=h.util.unpack(M);else if(I===String){var B=h.util.binaryStringToArrayBuffer(M);T=h.util.unpack(B)}}else this.serialization===g.SerializationType.JSON&&(T=this.parse(M));T.__peerData?this._handleChunk(T):w.prototype.emit.call(this,g.ConnectionEventType.Data,T)},b.prototype._handleChunk=function(S){var R=S.__peerData,M=this._chunkedData[R]||{data:[],count:0,total:S.total};if(M.data[S.n]=S.data,M.count++,this._chunkedData[R]=M,M.total===M.count){delete this._chunkedData[R];var I=new Blob(M.data);this._handleDataMessage({data:I})}},b.prototype.close=function(){this._buffer=[],this._bufferSize=0,this._chunkedData={},this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this._dc=null),this._encodingQueue&&(this._encodingQueue.destroy(),this._encodingQueue.removeAllListeners(),this._encodingQueue=null),this.open&&(this._open=!1,w.prototype.emit.call(this,g.ConnectionEventType.Close))},b.prototype.send=function(S,R){if(this.open)if(this.serialization===g.SerializationType.JSON)this._bufferedSend(this.stringify(S));else if(this.serialization===g.SerializationType.Binary||this.serialization===g.SerializationType.BinaryUTF8){var M=h.util.pack(S);if(!R&&M.size>h.util.chunkedMTU)return void this._sendChunks(M);h.util.supports.binaryBlob?this._bufferedSend(M):this._encodingQueue.enque(M)}else this._bufferedSend(S);else w.prototype.emit.call(this,g.ConnectionEventType.Error,new Error("Connection is not open. You should listen for the `open` event before sending messages."))},b.prototype._bufferedSend=function(S){!this._buffering&&this._trySend(S)||(this._buffer.push(S),this._bufferSize=this._buffer.length)},b.prototype._trySend=function(S){var R=this;if(!this.open)return!1;if(this.dataChannel.bufferedAmount>b.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(function(){R._buffering=!1,R._tryBuffer()},50),!1;try{this.dataChannel.send(S)}catch(M){return u.default.error("DC#:"+this.connectionId+" Error when sending:",M),this._buffering=!0,this.close(),!1}return!0},b.prototype._tryBuffer=function(){if(this.open&&this._buffer.length!==0){var S=this._buffer[0];this._trySend(S)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}},b.prototype._sendChunks=function(S){var R,M,I=h.util.chunk(S);u.default.log("DC#"+this.connectionId+" Try to send "+I.length+" chunks...");try{for(var T=o(I),B=T.next();!B.done;B=T.next()){var F=B.value;this.send(F,!0)}}catch(D){R={error:D}}finally{try{B&&!B.done&&(M=T.return)&&M.call(T)}finally{if(R)throw R.error}}},b.prototype.handleMessage=function(S){var R=S.payload;switch(S.type){case g.ServerMessageType.Answer:this._negotiator.handleSDP(S.type,R.sdp);break;case g.ServerMessageType.Candidate:this._negotiator.handleCandidate(R.candidate);break;default:u.default.warn("Unrecognized message type:",S.type,"from peer:",this.peer)}},b.ID_PREFIX="dc_",b.MAX_BUFFERED_AMOUNT=8388608,b}(m.BaseConnection);i.DataConnection=v},{"./util":"BHXf","./logger":"WOs9","./negotiator":"HCdX","./enums":"ZRYf","./baseconnection":"tQFK","./encodingQueue":"GGp6"}],in7L:[function(t,n,i){var r=this&&this.__awaiter||function(g,m,A,v){return new(A||(A=Promise))(function(w,b){function S(I){try{M(v.next(I))}catch(T){b(T)}}function R(I){try{M(v.throw(I))}catch(T){b(T)}}function M(I){var T;I.done?w(I.value):(T=I.value,T instanceof A?T:new A(function(B){B(T)})).then(S,R)}M((v=v.apply(g,m||[])).next())})},o=this&&this.__generator||function(g,m){var A,v,w,b,S={label:0,sent:function(){if(1&w[0])throw w[1];return w[1]},trys:[],ops:[]};return b={next:R(0),throw:R(1),return:R(2)},typeof Symbol=="function"&&(b[Symbol.iterator]=function(){return this}),b;function R(M){return function(I){return function(T){if(A)throw new TypeError("Generator is already executing.");for(;S;)try{if(A=1,v&&(w=2&T[0]?v.return:T[0]?v.throw||((w=v.return)&&w.call(v),0):v.next)&&!(w=w.call(v,T[1])).done)return w;switch(v=0,w&&(T=[2&T[0],w.value]),T[0]){case 0:case 1:w=T;break;case 4:return S.label++,{value:T[1],done:!1};case 5:S.label++,v=T[1],T=[0];continue;case 7:T=S.ops.pop(),S.trys.pop();continue;default:if(!(w=(w=S.trys).length>0&&w[w.length-1])&&(T[0]===6||T[0]===2)){S=0;continue}if(T[0]===3&&(!w||T[1]>w[0]&&T[1]<w[3])){S.label=T[1];break}if(T[0]===6&&S.label<w[1]){S.label=w[1],w=T;break}if(w&&S.label<w[2]){S.label=w[2],S.ops.push(T);break}w[2]&&S.ops.pop(),S.trys.pop();continue}T=m.call(g,S)}catch(B){T=[6,B],v=0}finally{A=w=0}if(5&T[0])throw T[1];return{value:T[0]?T[1]:void 0,done:!0}}([M,I])}}},l=this&&this.__importDefault||function(g){return g&&g.__esModule?g:{default:g}};Object.defineProperty(i,"__esModule",{value:!0}),i.API=void 0;var h=t("./util"),u=l(t("./logger")),f=function(){function g(m){this._options=m}return g.prototype._buildUrl=function(m){var A=(this._options.secure?"https://":"http://")+this._options.host+":"+this._options.port+this._options.path+this._options.key+"/"+m;return A+="?ts="+new Date().getTime()+Math.random()},g.prototype.retrieveId=function(){return r(this,void 0,Promise,function(){var m,A,v,w;return o(this,function(b){switch(b.label){case 0:m=this._buildUrl("id"),b.label=1;case 1:return b.trys.push([1,3,,4]),[4,fetch(m)];case 2:if((A=b.sent()).status!==200)throw new Error("Error. Status:"+A.status);return[2,A.text()];case 3:throw v=b.sent(),u.default.error("Error retrieving ID",v),w="",this._options.path==="/"&&this._options.host!==h.util.CLOUD_HOST&&(w=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+w);case 4:return[2]}})})},g.prototype.listAllPeers=function(){return r(this,void 0,Promise,function(){var m,A,v,w;return o(this,function(b){switch(b.label){case 0:m=this._buildUrl("peers"),b.label=1;case 1:return b.trys.push([1,3,,4]),[4,fetch(m)];case 2:if((A=b.sent()).status!==200)throw A.status===401?(v="",v=this._options.host===h.util.CLOUD_HOST?"It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":"You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+v)):new Error("Error. Status:"+A.status);return[2,A.json()];case 3:throw w=b.sent(),u.default.error("Error retrieving list peers",w),new Error("Could not get list peers from the server."+w);case 4:return[2]}})})},g}();i.API=f},{"./util":"BHXf","./logger":"WOs9"}],Hxpd:[function(t,n,i){var r=this&&this.__extends||function(){var M=function(I,T){return(M=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(B,F){B.__proto__=F}||function(B,F){for(var D in F)Object.prototype.hasOwnProperty.call(F,D)&&(B[D]=F[D])})(I,T)};return function(I,T){if(typeof T!="function"&&T!==null)throw new TypeError("Class extends value "+String(T)+" is not a constructor or null");function B(){this.constructor=I}M(I,T),I.prototype=T===null?Object.create(T):(B.prototype=T.prototype,new B)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(M){for(var I,T=1,B=arguments.length;T<B;T++)for(var F in I=arguments[T])Object.prototype.hasOwnProperty.call(I,F)&&(M[F]=I[F]);return M}).apply(this,arguments)},l=this&&this.__values||function(M){var I=typeof Symbol=="function"&&Symbol.iterator,T=I&&M[I],B=0;if(T)return T.call(M);if(M&&typeof M.length=="number")return{next:function(){return M&&B>=M.length&&(M=void 0),{value:M&&M[B++],done:!M}}};throw new TypeError(I?"Object is not iterable.":"Symbol.iterator is not defined.")},h=this&&this.__read||function(M,I){var T=typeof Symbol=="function"&&M[Symbol.iterator];if(!T)return M;var B,F,D=T.call(M),U=[];try{for(;(I===void 0||I-- >0)&&!(B=D.next()).done;)U.push(B.value)}catch(W){F={error:W}}finally{try{B&&!B.done&&(T=D.return)&&T.call(D)}finally{if(F)throw F.error}}return U},u=this&&this.__importDefault||function(M){return M&&M.__esModule?M:{default:M}};Object.defineProperty(i,"__esModule",{value:!0}),i.Peer=void 0;var f=t("eventemitter3"),g=t("./util"),m=u(t("./logger")),A=t("./socket"),v=t("./mediaconnection"),w=t("./dataconnection"),b=t("./enums"),S=t("./api"),R=function(M){function I(T,B){var F,D=M.call(this)||this;return D._id=null,D._lastServerId=null,D._destroyed=!1,D._disconnected=!1,D._open=!1,D._connections=new Map,D._lostMessages=new Map,T&&T.constructor==Object?B=T:T&&(F=T.toString()),B=o({debug:0,host:g.util.CLOUD_HOST,port:g.util.CLOUD_PORT,path:"/",key:I.DEFAULT_KEY,token:g.util.randomToken(),config:g.util.defaultConfig},B),D._options=B,D._options.host==="/"&&(D._options.host=window.location.hostname),D._options.path&&(D._options.path[0]!=="/"&&(D._options.path="/"+D._options.path),D._options.path[D._options.path.length-1]!=="/"&&(D._options.path+="/")),D._options.secure===void 0&&D._options.host!==g.util.CLOUD_HOST?D._options.secure=g.util.isSecure():D._options.host==g.util.CLOUD_HOST&&(D._options.secure=!0),D._options.logFunction&&m.default.setLogFunction(D._options.logFunction),m.default.logLevel=D._options.debug||0,D._api=new S.API(B),D._socket=D._createServerConnection(),g.util.supports.audioVideo||g.util.supports.data?F&&!g.util.validateId(F)?(D._delayedAbort(b.PeerErrorType.InvalidID,'ID "'+F+'" is invalid'),D):(F?D._initialize(F):D._api.retrieveId().then(function(U){return D._initialize(U)}).catch(function(U){return D._abort(b.PeerErrorType.ServerError,U)}),D):(D._delayedAbort(b.PeerErrorType.BrowserIncompatible,"The current browser does not support WebRTC"),D)}return r(I,M),Object.defineProperty(I.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"socket",{get:function(){return this._socket},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"connections",{get:function(){var T,B,F=Object.create(null);try{for(var D=l(this._connections),U=D.next();!U.done;U=D.next()){var W=h(U.value,2),J=W[0],ee=W[1];F[J]=ee}}catch(Q){T={error:Q}}finally{try{U&&!U.done&&(B=D.return)&&B.call(D)}finally{if(T)throw T.error}}return F},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"disconnected",{get:function(){return this._disconnected},enumerable:!1,configurable:!0}),I.prototype._createServerConnection=function(){var T=this,B=new A.Socket(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return B.on(b.SocketEventType.Message,function(F){T._handleMessage(F)}),B.on(b.SocketEventType.Error,function(F){T._abort(b.PeerErrorType.SocketError,F)}),B.on(b.SocketEventType.Disconnected,function(){T.disconnected||(T.emitError(b.PeerErrorType.Network,"Lost connection to server."),T.disconnect())}),B.on(b.SocketEventType.Close,function(){T.disconnected||T._abort(b.PeerErrorType.SocketClosed,"Underlying socket is already closed.")}),B},I.prototype._initialize=function(T){this._id=T,this.socket.start(T,this._options.token)},I.prototype._handleMessage=function(T){var B,F,D=T.type,U=T.payload,W=T.src;switch(D){case b.ServerMessageType.Open:this._lastServerId=this.id,this._open=!0,this.emit(b.PeerEventType.Open,this.id);break;case b.ServerMessageType.Error:this._abort(b.PeerErrorType.ServerError,U.msg);break;case b.ServerMessageType.IdTaken:this._abort(b.PeerErrorType.UnavailableID,'ID "'+this.id+'" is taken');break;case b.ServerMessageType.InvalidKey:this._abort(b.PeerErrorType.InvalidKey,'API KEY "'+this._options.key+'" is invalid');break;case b.ServerMessageType.Leave:m.default.log("Received leave message from "+W),this._cleanupPeer(W),this._connections.delete(W);break;case b.ServerMessageType.Expire:this.emitError(b.PeerErrorType.PeerUnavailable,"Could not connect to peer "+W);break;case b.ServerMessageType.Offer:var J=U.connectionId;if((ae=this.getConnection(W,J))&&(ae.close(),m.default.warn("Offer received for existing Connection ID:"+J)),U.type===b.ConnectionType.Media)ae=new v.MediaConnection(W,this,{connectionId:J,_payload:U,metadata:U.metadata}),this._addConnection(W,ae),this.emit(b.PeerEventType.Call,ae);else{if(U.type!==b.ConnectionType.Data)return void m.default.warn("Received malformed connection type:"+U.type);ae=new w.DataConnection(W,this,{connectionId:J,_payload:U,metadata:U.metadata,label:U.label,serialization:U.serialization,reliable:U.reliable}),this._addConnection(W,ae),this.emit(b.PeerEventType.Connection,ae)}var ee=this._getMessages(J);try{for(var Q=l(ee),Y=Q.next();!Y.done;Y=Q.next()){var se=Y.value;ae.handleMessage(se)}}catch(ve){B={error:ve}}finally{try{Y&&!Y.done&&(F=Q.return)&&F.call(Q)}finally{if(B)throw B.error}}break;default:if(!U)return void m.default.warn("You received a malformed message from "+W+" of type "+D);var ae;J=U.connectionId,(ae=this.getConnection(W,J))&&ae.peerConnection?ae.handleMessage(T):J?this._storeMessage(J,T):m.default.warn("You received an unrecognized message:",T)}},I.prototype._storeMessage=function(T,B){this._lostMessages.has(T)||this._lostMessages.set(T,[]),this._lostMessages.get(T).push(B)},I.prototype._getMessages=function(T){var B=this._lostMessages.get(T);return B?(this._lostMessages.delete(T),B):[]},I.prototype.connect=function(T,B){if(B===void 0&&(B={}),this.disconnected)return m.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),void this.emitError(b.PeerErrorType.Disconnected,"Cannot connect to new Peer after disconnecting from server.");var F=new w.DataConnection(T,this,B);return this._addConnection(T,F),F},I.prototype.call=function(T,B,F){if(F===void 0&&(F={}),this.disconnected)return m.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),void this.emitError(b.PeerErrorType.Disconnected,"Cannot connect to new Peer after disconnecting from server.");if(B){F._stream=B;var D=new v.MediaConnection(T,this,F);return this._addConnection(T,D),D}m.default.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.")},I.prototype._addConnection=function(T,B){m.default.log("add connection "+B.type+":"+B.connectionId+" to peerId:"+T),this._connections.has(T)||this._connections.set(T,[]),this._connections.get(T).push(B)},I.prototype._removeConnection=function(T){var B=this._connections.get(T.peer);if(B){var F=B.indexOf(T);F!==-1&&B.splice(F,1)}this._lostMessages.delete(T.connectionId)},I.prototype.getConnection=function(T,B){var F,D,U=this._connections.get(T);if(!U)return null;try{for(var W=l(U),J=W.next();!J.done;J=W.next()){var ee=J.value;if(ee.connectionId===B)return ee}}catch(Q){F={error:Q}}finally{try{J&&!J.done&&(D=W.return)&&D.call(W)}finally{if(F)throw F.error}}return null},I.prototype._delayedAbort=function(T,B){var F=this;setTimeout(function(){F._abort(T,B)},0)},I.prototype._abort=function(T,B){m.default.error("Aborting!"),this.emitError(T,B),this._lastServerId?this.disconnect():this.destroy()},I.prototype.emitError=function(T,B){var F;m.default.error("Error:",B),(F=typeof B=="string"?new Error(B):B).type=T,this.emit(b.PeerEventType.Error,F)},I.prototype.destroy=function(){this.destroyed||(m.default.log("Destroy peer with ID:"+this.id),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit(b.PeerEventType.Close))},I.prototype._cleanup=function(){var T,B;try{for(var F=l(this._connections.keys()),D=F.next();!D.done;D=F.next()){var U=D.value;this._cleanupPeer(U),this._connections.delete(U)}}catch(W){T={error:W}}finally{try{D&&!D.done&&(B=F.return)&&B.call(F)}finally{if(T)throw T.error}}this.socket.removeAllListeners()},I.prototype._cleanupPeer=function(T){var B,F,D=this._connections.get(T);if(D)try{for(var U=l(D),W=U.next();!W.done;W=U.next())W.value.close()}catch(J){B={error:J}}finally{try{W&&!W.done&&(F=U.return)&&F.call(U)}finally{if(B)throw B.error}}},I.prototype.disconnect=function(){if(!this.disconnected){var T=this.id;m.default.log("Disconnect peer with ID:"+T),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=T,this._id=null,this.emit(b.PeerEventType.Disconnected,T)}},I.prototype.reconnect=function(){if(this.disconnected&&!this.destroyed)m.default.log("Attempting reconnection to server with ID "+this._lastServerId),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(this.disconnected||this.open)throw new Error("Peer "+this.id+" cannot reconnect because it is not disconnected from the server!");m.default.error("In a hurry? We're still trying to make the initial connection!")}},I.prototype.listAllPeers=function(T){var B=this;T===void 0&&(T=function(F){}),this._api.listAllPeers().then(function(F){return T(F)}).catch(function(F){return B._abort(b.PeerErrorType.ServerError,F)})},I.DEFAULT_KEY="peerjs",I}(f.EventEmitter);i.Peer=R},{eventemitter3:"JJlS","./util":"BHXf","./logger":"WOs9","./socket":"wJlv","./mediaconnection":"dbHP","./dataconnection":"GBTQ","./enums":"ZRYf","./api":"in7L"}],iTK6:[function(t,n,i){Object.defineProperty(i,"__esModule",{value:!0}),i.peerjs=void 0;var r=t("./util"),o=t("./peer");i.peerjs={Peer:o.Peer,util:r.util},i.default=o.Peer,window.peerjs=i.peerjs,window.Peer=o.Peer},{"./util":"BHXf","./peer":"Hxpd"}]},{},["iTK6"])})(kD);const bE=$7(kD.exports);class cJ{constructor(){E(this,"_host");E(this,"_client");E(this,"_clientData");this.onEnable()}get isHost(){return this._host!==void 0}onEnable(){const e="HOST-5980e65c-8438-453e-8b35-f13c736dcd81";this.trySetupHost(e)}trySetupHost(e){let t=new bE(e);t.on("error",n=>{console.error(n),this._host=void 0,this.trySetupClient(e)}),t.on("open",n=>{this._host=new hJ(t)})}trySetupClient(e){this._client=new bE,this._client.on("error",t=>{console.error("Client error",t)}),this._client.on("open",t=>{console.log("client connected",t),this._clientData=this._client.connect(e,{metadata:{id:t}}),this._clientData.on("open",()=>{console.log("Connected to host")}),this._clientData.on("data",n=>{console.log("<<",n)})})}}class lJ{constructor(e){E(this,"_peer");this._peer=e}}class hJ extends lJ{constructor(t){var n;super(t);E(this,"_connections",[]);console.log("I AM THE HOST"),(n=this._peer)==null||n.on("connection",this.onConnection.bind(this)),this._peer.on("close",()=>{this.broadcast("BYE")}),setInterval(()=>{this.broadcast("HELLO")},2e3)}get isHost(){return!0}onConnection(t){console.log("host connection",t),t.on("open",()=>{this._connections.push(t),this.broadcastConnection(t)})}broadcastConnection(t){const n=this._connections.map(i=>{var r;return(r=i.metadata)==null?void 0:r.id}).filter(i=>i!==void 0);this.broadcast({type:"connection-list",connections:n})}broadcast(t){if(t!=null){console.log(">>",t);for(const n in this._peer.connections){const i=this._peer.connections[n];if(!!i)if(Array.isArray(i))for(const r of i)!r||r.send(t);else console.warn(i)}}}}let ub="wss://needle-tiny-starter.glitch.me/socket";const to=!!jt("debugnet"),a_=!!(to||jt("debugowner"));var ha=(a=>(a.Join="join-room",a.Leave="leave-room",a.JoinedRoom="joined-room",a.LeftRoom="left-room",a.UserJoinedRoom="user-joined-room",a.UserLeftRoom="user-left-room",a))(ha||{});class dS{constructor(e,t){E(this,"guid");E(this,"connection");E(this,"_hasOwnership",!1);E(this,"_isOwned");E(this,"_gainSubscription");E(this,"_lostSubscription");E(this,"_hasOwnerResponse");E(this,"_isWaitingForOwnershipResponseCallback",null);this.connection=e,this.guid=t,this._gainSubscription=this.onGainedOwnership.bind(this),this._lostSubscription=this.onLostOwnership.bind(this),e.beginListen("lost-ownership",this._lostSubscription),e.beginListen("gained-ownership-broadcast",this._gainSubscription),this._hasOwnerResponse=this.onHasOwnerResponse.bind(this),e.beginListen("response-has-owner",this._hasOwnerResponse)}get hasOwnership(){return this._hasOwnership}get isOwned(){return this._isOwned}get isConnected(){return this.connection.isConnected}updateIsOwned(){this.connection.send("request-has-owner",{guid:this.guid})}onHasOwnerResponse(e){e.guid===this.guid&&(this._isOwned=e.value)}requestOwnershipIfNotOwned(){return this._isWaitingForOwnershipResponseCallback!==null?this:(this._isWaitingForOwnershipResponseCallback=this.waitForHasOwnershipRequestResponse.bind(this),this.connection.beginListen("response-has-owner",this._isWaitingForOwnershipResponseCallback),this.connection.send("request-has-owner",{guid:this.guid}),this)}waitForHasOwnershipRequestResponse(e){e.guid===this.guid&&(this._isWaitingForOwnershipResponseCallback&&(this.connection.stopListening("response-has-owner",this._isWaitingForOwnershipResponseCallback),this._isWaitingForOwnershipResponseCallback=null),this._isOwned=e.value,e.value||(a_&&console.log("request ownership",this.guid),this.requestOwnership()))}requestOwnershipAsync(){return new Promise((e,t)=>{this.requestOwnership();let n=0;const i=()=>{if(n++>10)return t("Timeout");setTimeout(()=>{this.hasOwnership?e(this):i()},100)};i()})}requestOwnership(){return a_&&console.log("Request ownership",this.guid),this.connection.send("request-ownership",{guid:this.guid}),this}freeOwnership(){return this.connection.send("remove-ownership",{guid:this.guid}),this._isWaitingForOwnershipResponseCallback&&(this.connection.stopListening("response-has-owner",this._isWaitingForOwnershipResponseCallback),this._isWaitingForOwnershipResponseCallback=null),this}destroy(){this.connection.stopListening("gained-ownership",this._gainSubscription),this.connection.stopListening("lost-ownership",this._lostSubscription),this.connection.stopListening("response-has-owner",this._hasOwnerResponse),this._isWaitingForOwnershipResponseCallback&&(this.connection.stopListening("response-has-owner",this._isWaitingForOwnershipResponseCallback),this._isWaitingForOwnershipResponseCallback=null)}onGainedOwnership(e){e.guid===this.guid&&(this._isOwned=!0,this.connection.connectionId===e.owner?(a_&&console.log("GAINED OWNERSHIP",this.guid),this._hasOwnership=!0):this._hasOwnership=!1)}onLostOwnership(e){e===this.guid&&(a_&&console.log("LOST OWNERSHIP",this.guid),this._hasOwnership=!1,this._isOwned=!1)}}var ny=(a=>(a[a.OnConnection=0]="OnConnection",a[a.OnRoomJoin=1]="OnRoomJoin",a[a.Queued=2]="Queued",a[a.Immediate=3]="Immediate",a))(ny||{});class uJ{constructor(e){E(this,"context");E(this,"_peer",null);E(this,"_usersInRoomCopy",[]);E(this,"_defaultMessagesBuffer",[]);E(this,"_defaultMessagesBufferArray",[]);E(this,"_listeners",{});E(this,"_listenersBinary",{});E(this,"connected",!1);E(this,"channelId");E(this,"_connectionId",null);E(this,"_isConnectingToWebsocket",!1);E(this,"_ws");E(this,"_waitingForSocket",{});E(this,"_isInRoom",!1);E(this,"_currentRoomName",null);E(this,"_currentRoomViewId",null);E(this,"_currentRoomAllowEditing",!0);E(this,"_currentInRoom",[]);E(this,"_state",{});E(this,"_currentDelay",-1);this.context=e}get peer(){return this._peer||(this._peer=new cJ),this._peer}tryGetState(e){return e==="invalid"?null:this._state[e]}get connectionId(){return this._connectionId}get isDebugEnabled(){return to}get isConnected(){return this.connected}get currentRoomName(){return this._currentRoomName}get allowEditing(){return this._currentRoomAllowEditing}get currentRoomViewId(){return this._currentRoomViewId}get isInRoom(){return this._isInRoom}get currentLatency(){return this._currentDelay}userIsInRoom(e){return this._currentInRoom.indexOf(e)!==-1}usersInRoom(e=null){e||(e=this._usersInRoomCopy),e.length=0;for(const t of this._currentInRoom)e.push(t);return e}joinRoom(e,t=!1){this.connect(),to&&console.log("join: "+e),this.send("join-room",{room:e,viewOnly:t},0)}leaveRoom(e=null){if(e||(e=this.currentRoomName),!e){console.error("Can not leave unknown room");return}this.send("leave-room",{room:e})}send(e,t=null,n=2){if(t===null&&(t={}),n===2){this._defaultMessagesBuffer.push({key:e,value:t});return}return this.sendWithWebsocket(e,t,n)}sendDeleteRemoteState(e){this.send("delete-state",{guid:e,dontSave:!0}),delete this._state[e]}sendBinary(e){var t;to&&console.log("<< bin",e.length),(t=this._ws)==null||t.send(e)}sendBufferedMessagesNow(){var n;if(!this._ws)return;this._defaultMessagesBufferArray.length=0;const e=Object.keys(this._defaultMessagesBuffer).length;for(const i in this._defaultMessagesBuffer){const r=this._defaultMessagesBuffer[i];if(e<=1){this.sendWithWebsocket(r.key,r.value,3);break}const o=this.toMessage(r.key,r.value);this._defaultMessagesBufferArray.push(o)}if(this._defaultMessagesBuffer.length=0,this._defaultMessagesBufferArray.length>0&&to&&console.log("SEND BUFFERED",this._defaultMessagesBufferArray.length),this._defaultMessagesBufferArray.length<=0)return;const t=JSON.stringify(this._defaultMessagesBufferArray);(n=this._ws)==null||n.send(t)}beginListen(e,t){return this._listeners[e]||(this._listeners[e]=[]),this._listeners[e].push(t),t}stopListening(e,t){if(!t||!this._listeners[e])return;const n=this._listeners[e].indexOf(t);n>=0&&this._listeners[e].splice(n,1)}beginListenBinrary(e,t){return this._listenersBinary[e]||(this._listenersBinary[e]=[]),this._listenersBinary[e].push(t),t}stopListenBinary(e,t){if(!this._listenersBinary[e])return;const n=this._listenersBinary[e].indexOf(t);n>=0&&this._listenersBinary[e].splice(n,1)}connect(){if(this.connected)return;to&&console.log("connecting");const e=Te.findObjectOfType(Ru,this.context,!1),t=e==null?void 0:e.getWebsocketUrl();t&&(ub=t),this.connectWebsocket()}connectWebsocket(){if(this._isConnectingToWebsocket)return;this._isConnectingToWebsocket=!0,console.log("Connecting to "+ub);const e=new BD.WebsocketBuilder(ub).onOpen(()=>{this._ws=e,this._isConnectingToWebsocket=!1,this.connected=!0,console.log("Connected to websocket"),this.onSendQueued(0)}).onClose(t=>{this.connected=!1,this._isInRoom=!1}).onError((t,n)=>{console.error(t,n)}).onMessage(this.onMessage.bind(this)).onRetry(()=>{console.log("websocket connection retry")}).build()}onMessage(e,t){const n=t.data;try{if(typeof n!="string"){n.size&&this.handleIncomingBinaryMessage(n);return}const i=JSON.parse(n);if(Array.isArray(i))for(const r of i)this.handleIncomingStringMessage(r);else this.handleIncomingStringMessage(i);return}catch{to&&n==="pong"&&console.log("<<",n)}}async handleIncomingBinaryMessage(e){const t=await e.arrayBuffer();var n=new Uint8Array(t);const i=new ng(n),r=i.getBufferIdentifier(),o=this._listenersBinary[r],l=oJ(i),h=aJ(l);if(h&&typeof h=="string"&&(this._state[h]=l),!o)return;const u=l!=null?l:i;for(const f of o)f(u)}handleIncomingStringMessage(e){var i,r,o,l,h,u,f;if(to&&console.log("<<",(i=e.key)!=null?i:e),e.key)switch(e.key){case"connection-start-info":if(e.data){const A=e.data;A&&(console.assert(A.id!==void 0&&A.id!==null&&A.id.length>0,"server did not send connection id",A.id),console.log("Your id is: "+A.id,(r=this.context.alias)!=null?r:""),this._connectionId=A.id)}else console.warn("Expected connection id in "+e.key);break;case"joined-room":if(to&&console.log(e),e){this._isInRoom=!0;const A=e;this._currentRoomName=A.room,this._currentRoomViewId=A.viewId,this._currentRoomAllowEditing=(o=A.allowEditing)!=null?o:!0,console.log("Room view id",this._currentRoomViewId),this._currentInRoom.length=0,this._currentInRoom.push(...A.inRoom),to&&console.log("joined room with",this._currentInRoom,(l=this.context.alias)!=null?l:"")}this.onSendQueued(1);break;case"left-room":e.room===this.currentRoomName&&(this._isInRoom=!1,this._currentRoomName=null,this._currentInRoom.length=0);break;case"user-joined-room":if(e.data){const A=e.data;this._currentInRoom.push(A.userId),to&&console.log(A.userId+" joined","now in room:",this._currentInRoom)}break;case"user-left-room":if(e.data){const A=e.data,v=this._currentInRoom.indexOf(A.userId);v>=0&&(console.log(A.userId+" left",(h=this.context.alias)!=null?h:""),this._currentInRoom.splice(v,1)),A.userId===this.connectionId&&console.log("you left the room")}break;case"ping":case"pong":const m=(u=e.data)==null?void 0:u.time;m&&(this._currentDelay=this.context.time.time-m),to&&console.log("Current latency: "+this._currentDelay.toFixed(1)+" sec","Clients in room: "+((f=this._currentInRoom)==null?void 0:f.length));break}const t=this._listeners[e.key];if(t)for(const g of t)g(e.data);const n=e.data;n&&(this._state[n.guid]=n)}toMessage(e,t){return{key:e,data:t}}sendWithWebsocket(e,t,n=1){if(!this._ws){const r=this._waitingForSocket[n]||[];r.push(()=>this.sendWithWebsocket(e,t,n)),this._waitingForSocket[n]=r;return}const i=JSON.stringify(this.toMessage(e,t));to&&console.log(">>",e),this._ws.send(i)}onSendQueued(e){const t=this._waitingForSocket[e];if(t){for(const n of t)n();t.length=0}}}const xP={type:"change"},db={type:"start"},wP={type:"end"};class ND extends Uo{constructor(e,t){super(),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new q,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:Kh.ROTATE,MIDDLE:Kh.DOLLY,RIGHT:Kh.PAN},this.touches={ONE:$h.ROTATE,TWO:$h.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return l.phi},this.getAzimuthalAngle=function(){return l.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(we){we.addEventListener("keydown",Zn),this._domElementKeyEvents=we},this.saveState=function(){n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=function(){n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(xP),n.update(),r=i.NONE},this.update=function(){const we=new q,Fe=new Ot().setFromUnitVectors(e.up,new q(0,1,0)),bt=Fe.clone().invert(),hn=new q,nn=new Ot,Ht=2*Math.PI;return function(){const Ln=n.object.getWorldPosition(e.position);we.copy(Ln).sub(n.target),we.applyQuaternion(Fe),l.setFromVector3(we),n.autoRotate&&r===i.NONE&&U(F()),n.enableDamping?(l.theta+=h.theta*n.dampingFactor,l.phi+=h.phi*n.dampingFactor):(l.theta+=h.theta,l.phi+=h.phi);let Ce=n.minAzimuthAngle,Rt=n.maxAzimuthAngle;return isFinite(Ce)&&isFinite(Rt)&&(Ce<-Math.PI?Ce+=Ht:Ce>Math.PI&&(Ce-=Ht),Rt<-Math.PI?Rt+=Ht:Rt>Math.PI&&(Rt-=Ht),Ce<=Rt?l.theta=Math.max(Ce,Math.min(Rt,l.theta)):l.theta=l.theta>(Ce+Rt)/2?Math.max(Ce,l.theta):Math.min(Rt,l.theta)),l.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,l.phi)),l.makeSafe(),l.radius*=u,l.radius=Math.max(n.minDistance,Math.min(n.maxDistance,l.radius)),n.enableDamping===!0?n.target.addScaledVector(f,n.dampingFactor):n.target.add(f),we.setFromSpherical(l),we.applyQuaternion(bt),Ln.copy(n.target).add(we),n.object.parent?n.object.parent.worldToLocal(Ln):n.object.position.copy(Ln),n.object.lookAt(n.target),n.enableDamping===!0?(h.theta*=1-n.dampingFactor,h.phi*=1-n.dampingFactor,f.multiplyScalar(1-n.dampingFactor)):(h.set(0,0,0),f.set(0,0,0)),u=1,g||hn.distanceToSquared(n.object.position)>o||8*(1-nn.dot(n.object.quaternion))>o?(n.dispatchEvent(xP),hn.copy(n.object.position),nn.copy(n.object.quaternion),g=!1,!0):!1}}(),this.dispose=function(){n.domElement.removeEventListener("contextmenu",Qe),n.domElement.removeEventListener("pointerdown",vt),n.domElement.removeEventListener("pointercancel",En),n.domElement.removeEventListener("wheel",ii),n.domElement.removeEventListener("pointermove",Jt),n.domElement.removeEventListener("pointerup",Lt),n._domElementKeyEvents!==null&&n._domElementKeyEvents.removeEventListener("keydown",Zn)};const n=this,i={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let r=i.NONE;const o=1e-6,l=new hE,h=new hE;let u=1;const f=new q;let g=!1;const m=new Xe,A=new Xe,v=new Xe,w=new Xe,b=new Xe,S=new Xe,R=new Xe,M=new Xe,I=new Xe,T=[],B={};function F(){return 2*Math.PI/60/60*n.autoRotateSpeed}function D(){return Math.pow(.95,n.zoomSpeed)}function U(we){h.theta-=we}function W(we){h.phi-=we}const J=function(){const we=new q;return function(bt,hn){we.setFromMatrixColumn(hn,0),we.multiplyScalar(-bt),f.add(we)}}(),ee=function(){const we=new q;return function(bt,hn){n.screenSpacePanning===!0?we.setFromMatrixColumn(hn,1):(we.setFromMatrixColumn(hn,0),we.crossVectors(n.object.up,we)),we.multiplyScalar(bt),f.add(we)}}(),Q=function(){const we=new q,Fe=new q;return function(hn,nn){const Ht=n.domElement;if(n.object.isPerspectiveCamera){n.object.getWorldPosition(Fe),we.copy(Fe).sub(n.target);let Bn=we.length();Bn*=Math.tan(n.object.fov/2*Math.PI/180),J(2*hn*Bn/Ht.clientHeight,n.object.matrixWorld),ee(2*nn*Bn/Ht.clientHeight,n.object.matrixWorld)}else n.object.isOrthographicCamera?(J(hn*(n.object.right-n.object.left)/n.object.zoom/Ht.clientWidth,n.object.matrixWorld),ee(nn*(n.object.top-n.object.bottom)/n.object.zoom/Ht.clientHeight,n.object.matrixWorld)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}}();function Y(we){n.object.isPerspectiveCamera?u/=we:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom*we)),n.object.updateProjectionMatrix(),g=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function se(we){n.object.isPerspectiveCamera?u*=we:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/we)),n.object.updateProjectionMatrix(),g=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function ae(we){m.set(we.clientX,we.clientY)}function ve(we){R.set(we.clientX,we.clientY)}function xe(we){w.set(we.clientX,we.clientY)}function Ae(we){A.set(we.clientX,we.clientY),v.subVectors(A,m).multiplyScalar(n.rotateSpeed);const Fe=n.domElement;U(2*Math.PI*v.x/Fe.clientHeight),W(2*Math.PI*v.y/Fe.clientHeight),m.copy(A),n.update()}function Me(we){M.set(we.clientX,we.clientY),I.subVectors(M,R),I.y>0?Y(D()):I.y<0&&se(D()),R.copy(M),n.update()}function Be(we){b.set(we.clientX,we.clientY),S.subVectors(b,w).multiplyScalar(n.panSpeed),Q(S.x,S.y),w.copy(b),n.update()}function Le(we){we.deltaY<0?se(D()):we.deltaY>0&&Y(D()),n.update()}function $e(we){let Fe=!1;switch(we.code){case n.keys.UP:Q(0,n.keyPanSpeed),Fe=!0;break;case n.keys.BOTTOM:Q(0,-n.keyPanSpeed),Fe=!0;break;case n.keys.LEFT:Q(n.keyPanSpeed,0),Fe=!0;break;case n.keys.RIGHT:Q(-n.keyPanSpeed,0),Fe=!0;break}Fe&&(we.preventDefault(),n.update())}function yt(){if(T.length===1)m.set(T[0].pageX,T[0].pageY);else{const we=.5*(T[0].pageX+T[1].pageX),Fe=.5*(T[0].pageY+T[1].pageY);m.set(we,Fe)}}function Nt(){if(T.length===1)w.set(T[0].pageX,T[0].pageY);else{const we=.5*(T[0].pageX+T[1].pageX),Fe=.5*(T[0].pageY+T[1].pageY);w.set(we,Fe)}}function He(){const we=T[0].pageX-T[1].pageX,Fe=T[0].pageY-T[1].pageY,bt=Math.sqrt(we*we+Fe*Fe);R.set(0,bt)}function mn(){n.enableZoom&&He(),n.enablePan&&Nt()}function Xt(){n.enableZoom&&He(),n.enableRotate&&yt()}function pn(we){if(T.length==1)A.set(we.pageX,we.pageY);else{const bt=Mn(we),hn=.5*(we.pageX+bt.x),nn=.5*(we.pageY+bt.y);A.set(hn,nn)}v.subVectors(A,m).multiplyScalar(n.rotateSpeed);const Fe=n.domElement;U(2*Math.PI*v.x/Fe.clientHeight),W(2*Math.PI*v.y/Fe.clientHeight),m.copy(A)}function Ft(we){if(T.length===1)b.set(we.pageX,we.pageY);else{const Fe=Mn(we),bt=.5*(we.pageX+Fe.x),hn=.5*(we.pageY+Fe.y);b.set(bt,hn)}S.subVectors(b,w).multiplyScalar(n.panSpeed),Q(S.x,S.y),w.copy(b)}function yn(we){const Fe=Mn(we),bt=we.pageX-Fe.x,hn=we.pageY-Fe.y,nn=Math.sqrt(bt*bt+hn*hn);M.set(0,nn),I.set(0,Math.pow(M.y/R.y,n.zoomSpeed)),Y(I.y),R.copy(M)}function it(we){n.enableZoom&&yn(we),n.enablePan&&Ft(we)}function tt(we){n.enableZoom&&yn(we),n.enableRotate&&pn(we)}function vt(we){n.enabled!==!1&&(T.length===0&&(n.domElement.setPointerCapture(we.pointerId),n.domElement.addEventListener("pointermove",Jt),n.domElement.addEventListener("pointerup",Lt)),At(we),we.pointerType==="touch"?me(we):Zt(we))}function Jt(we){n.enabled!==!1&&(we.pointerType==="touch"?ce(we):ln(we))}function Lt(we){pt(we),T.length===0&&(n.domElement.releasePointerCapture(we.pointerId),n.domElement.removeEventListener("pointermove",Jt),n.domElement.removeEventListener("pointerup",Lt)),n.dispatchEvent(wP),r=i.NONE}function En(we){pt(we)}function Zt(we){let Fe;switch(we.button){case 0:Fe=n.mouseButtons.LEFT;break;case 1:Fe=n.mouseButtons.MIDDLE;break;case 2:Fe=n.mouseButtons.RIGHT;break;default:Fe=-1}switch(Fe){case Kh.DOLLY:if(n.enableZoom===!1)return;ve(we),r=i.DOLLY;break;case Kh.ROTATE:if(we.ctrlKey||we.metaKey||we.shiftKey){if(n.enablePan===!1)return;xe(we),r=i.PAN}else{if(n.enableRotate===!1)return;ae(we),r=i.ROTATE}break;case Kh.PAN:if(we.ctrlKey||we.metaKey||we.shiftKey){if(n.enableRotate===!1)return;ae(we),r=i.ROTATE}else{if(n.enablePan===!1)return;xe(we),r=i.PAN}break;default:r=i.NONE}r!==i.NONE&&n.dispatchEvent(db)}function ln(we){switch(r){case i.ROTATE:if(n.enableRotate===!1)return;Ae(we);break;case i.DOLLY:if(n.enableZoom===!1)return;Me(we);break;case i.PAN:if(n.enablePan===!1)return;Be(we);break}}function ii(we){n.enabled===!1||n.enableZoom===!1||r!==i.NONE||(we.preventDefault(),n.dispatchEvent(db),Le(we),n.dispatchEvent(wP))}function Zn(we){n.enabled===!1||n.enablePan===!1||$e(we)}function me(we){switch(zt(we),T.length){case 1:switch(n.touches.ONE){case $h.ROTATE:if(n.enableRotate===!1)return;yt(),r=i.TOUCH_ROTATE;break;case $h.PAN:if(n.enablePan===!1)return;Nt(),r=i.TOUCH_PAN;break;default:r=i.NONE}break;case 2:switch(n.touches.TWO){case $h.DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;mn(),r=i.TOUCH_DOLLY_PAN;break;case $h.DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;Xt(),r=i.TOUCH_DOLLY_ROTATE;break;default:r=i.NONE}break;default:r=i.NONE}r!==i.NONE&&n.dispatchEvent(db)}function ce(we){switch(zt(we),r){case i.TOUCH_ROTATE:if(n.enableRotate===!1)return;pn(we),n.update();break;case i.TOUCH_PAN:if(n.enablePan===!1)return;Ft(we),n.update();break;case i.TOUCH_DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;it(we),n.update();break;case i.TOUCH_DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;tt(we),n.update();break;default:r=i.NONE}}function Qe(we){n.enabled!==!1&&we.preventDefault()}function At(we){T.push(we)}function pt(we){delete B[we.pointerId];for(let Fe=0;Fe<T.length;Fe++)if(T[Fe].pointerId==we.pointerId){T.splice(Fe,1);return}}function zt(we){let Fe=B[we.pointerId];Fe===void 0&&(Fe=new Xe,B[we.pointerId]=Fe),Fe.set(we.pageX,we.pageY)}function Mn(we){const Fe=we.pointerId===T[0].pointerId?T[1]:T[0];return B[Fe.pointerId]}n.domElement.addEventListener("contextmenu",Qe),n.domElement.addEventListener("pointerdown",vt),n.domElement.addEventListener("pointercancel",En),n.domElement.addEventListener("wheel",ii,{passive:!1}),this.update()}}var dJ=Object.defineProperty,fJ=Object.getOwnPropertyDescriptor,pJ=(a,e,t,n)=>{for(var i=n>1?void 0:n?fJ(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&dJ(e,t,i),i};class nv extends Bt{constructor(){super(...arguments);E(this,"constraintActive",!0);E(this,"locked",!1);E(this,"sources",[])}}pJ([Re(qt)],nv.prototype,"sources",2);var mJ=Object.defineProperty,gJ=Object.getOwnPropertyDescriptor,AJ=(a,e,t,n)=>{for(var i=n>1?void 0:n?gJ(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&mJ(e,t,i),i};class Ff extends Bt{constructor(){super(...arguments);E(this,"autoRotate",!1);E(this,"autoRotateSpeed",1);E(this,"enableKeys",!0);E(this,"enableDamping",!0);E(this,"dampingFactor",.1);E(this,"enableZoom",!0);E(this,"minZoom",0);E(this,"maxZoom",1/0);E(this,"enablePan",!0);E(this,"lookAtConstraint",null);E(this,"lookAtConstraint01",1);E(this,"middleClickToFocus",!0);E(this,"doubleClickToFocus",!0);E(this,"useSlerp",!1);E(this,"debugLog",!1);E(this,"targetLerpSpeed",5);E(this,"_lookTargetPosition");E(this,"_controls",null);E(this,"_cameraObject",null);E(this,"_lerpToTargetPosition",!1);E(this,"_lerpCameraToTarget",!1);E(this,"_cameraTargetPosition",null);E(this,"_inputs",0);E(this,"_enableTime",0)}get controls(){return this._controls}get controllerObject(){return this._cameraObject}onStartInteraction(t){var n;(n=this.controls)==null||n.addEventListener("start",t)}awake(){this._lookTargetPosition=new q}onEnable(){this._enableTime=this.context.time.time;const t=Te.getComponent(this.gameObject,Us),n=t==null?void 0:t.cam;this._controls||(console.assert(n!=null,"Missing camera",this),n&&(this._cameraObject=n),this._controls=new ND(n,this.context.renderer.domElement)),this._controls&&(this._controls.enableDamping=this.enableDamping,this._controls.enableKeys=this.enableKeys,this._controls.autoRotate=this.autoRotate,this._controls.autoRotateSpeed=this.autoRotateSpeed,this._controls.enableZoom=this.enableZoom,(n==null?void 0:n.type)==="PerspectiveCamera"?(this._controls.minDistance=this.minZoom,this._controls.maxDistance=this.maxZoom):(this._controls.minZoom=this.minZoom,this._controls.maxZoom=this.maxZoom),this._controls.dampingFactor=this.dampingFactor,this._controls.enablePan=this.enablePan)}onDisable(){this._controls&&(this._controls.enabled=!1,this._controls.autoRotate=!1)}start(){if(this._controls){const t=Te.getComponent(this.gameObject,Us);if(t&&!this.setFromTargetPosition()){console.log("NO TARGET");const n=new q(0,0,-1).applyMatrix4(t.cam.matrixWorld);this.setTarget(n,!0)}}this.startCoroutine(this.startRaycastDelayed())}*startRaycastDelayed(){if(yield,!this.setFromTargetPosition()){const t=new Wc;t.screenPoint=new Xe(0,0),t.lineThreshold=.1;const n=this.context.physics.raycast(t);n.length>0&&this.setTarget(n[0].point,!0)}}onBeforeRender(){var n,i,r,o;if(!this._controls)return;(this.context.input.getPointerDown(0)||this.context.input.getPointerDown(1)||this.context.input.getPointerDown(2))&&(this._inputs+=1),this._inputs>0&&(this._controls.autoRotate=!1,this._lerpCameraToTarget=!1,this._lerpToTargetPosition=!1),this._inputs=0;let t=this.middleClickToFocus&&this.context.input.getPointerClicked(1);if(t||(t=this.doubleClickToFocus&&this.context.input.getPointerDoubleClicked(0)&&this.context.time.time-this._enableTime>.3),t?this.setTargetFromRaycast():(this.context.input.getPointerDown(0)||this.context.input.mouseWheelChanged)&&(this._lerpToTargetPosition=!1,this._lerpCameraToTarget=!1),this._lerpToTargetPosition||this._lerpCameraToTarget){const l=this.context.time.deltaTime*this.targetLerpSpeed;this._lerpCameraToTarget&&this._cameraTargetPosition&&this._cameraObject&&(this.useSlerp&&typeof((n=this._cameraObject)==null?void 0:n.position.slerp)=="function"?((i=this._cameraObject)==null?void 0:i.position).slerp(this._cameraTargetPosition,l):(r=this._cameraObject)==null||r.position.lerp(this._cameraTargetPosition,l),this._cameraObject.position.distanceTo(this._cameraTargetPosition)<.01&&(this._lerpCameraToTarget=!1)),this._lerpToTargetPosition&&(this.lerpTarget(this._lookTargetPosition,l),this._lookTargetPosition.distanceTo(this._controls.target)<.005&&(this._lerpToTargetPosition=!1))}(o=this.lookAtConstraint)!=null&&o.locked&&this.setFromTargetPosition(0,this.lookAtConstraint01),this._controls&&(this.debugLog&&(this._controls.domElement=this.context.renderer.domElement),this._controls.enabled=!0,this._controls.update())}setCameraTarget(t,n=!1){var i;t?(this._lerpCameraToTarget=!0,this._cameraTargetPosition=t.clone(),n&&this._cameraTargetPosition&&((i=this.controllerObject)==null||i.position.copy(this._cameraTargetPosition))):this._lerpCameraToTarget=!1}setFromTargetPosition(t=0,n=1){var r;if(!this._controls)return!1;const i=(r=this.lookAtConstraint)==null?void 0:r.sources;if(i&&i.length>0){const o=i[t];if(o)return o.getWorldPosition(this._lookTargetPosition),this.lerpTarget(this._lookTargetPosition,n),!0}return!1}setTarget(t=null,n=!1){!this._controls||(t!==null&&this._lookTargetPosition.copy(t),n?this._controls.target.copy(this._lookTargetPosition):this._lerpToTargetPosition=!0)}lerpTarget(t,n){!this._controls||this._controls.target.lerp(t,n)}distanceToTarget(t){return this._controls?this._controls.target.distanceTo(t):-1}setTargetFromRaycast(){if(!this.controls)return;const t=this.context.physics.raycast();for(const n of t)if(n.distance>0&&Te.isActiveInHierarchy(n.object)){if(this._lookTargetPosition.copy(n.point),this._lerpToTargetPosition=!0,this._cameraTargetPosition=null,this.context.mainCamera){this._lerpCameraToTarget=!0;const i=ti(this.context.mainCamera);this._cameraTargetPosition=i.clone().sub(this.controls.target).add(this._lookTargetPosition)}break}}}AJ([Re(nv)],Ff.prototype,"lookAtConstraint",2);class oo extends _e{constructor(t,n,i,r){super(t,n,i);E(this,"alpha",1);this.alpha=r}get isRGBAColor(){return!0}clone(){const t=super.clone();return t.alpha=this.alpha,t}copy(t){return super.copy(t),"alpha"in t&&typeof t.alpha=="number"?this.alpha=t.alpha:typeof t.a=="number"&&(this.alpha=t.a),this}lerp(t,n){const i=t;return i.alpha&&(this.alpha=Ei.lerp(this.alpha,i.alpha,n)),super.lerp(t,n)}multiply(t){const n=t;return n.alpha&&(this.alpha=this.alpha*n.alpha),super.multiply(t)}}var _J=Object.defineProperty,yJ=Object.getOwnPropertyDescriptor,sh=(a,e,t,n)=>{for(var i=n>1?void 0:n?yJ(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&_J(e,t,i),i};const UD=jt("debugcam");class Us extends Bt{constructor(){super(...arguments);E(this,"orthographic",!1);E(this,"orthographicSize",5);E(this,"ARBackgroundAlpha",0);E(this,"_nearClipPlane",.1);E(this,"_farClipPlane",1e3);E(this,"_backgroundColor");E(this,"_fov",60);E(this,"_cam",null);E(this,"_clearFlags",2);E(this,"_skybox")}get aspect(){return this._cam instanceof ts?this._cam.aspect:this.context.domWidth/this.context.domHeight}get fieldOfView(){return this._fov}set fieldOfView(t){const n=this._fov!=t;this._fov=t,n&&this._cam&&this._cam instanceof ts&&(this._cam.fov=this._fov,this._cam.updateProjectionMatrix())}get nearClipPlane(){return this._nearClipPlane}set nearClipPlane(t){const n=this._nearClipPlane!=t;this._nearClipPlane=t,this._cam&&n&&(this._cam.near=t,this._cam.updateProjectionMatrix())}get farClipPlane(){return this._farClipPlane}set farClipPlane(t){const n=this._farClipPlane!=t;this._farClipPlane=t,this._cam&&n&&(this._cam.far=t,this._cam.updateProjectionMatrix())}get clearFlags(){return this._clearFlags}set clearFlags(t){t!==this._clearFlags&&(this._clearFlags=t,this.applyClearFlagsIfIsActiveCamera())}get backgroundColor(){var t;return(t=this._backgroundColor)!=null?t:null}set backgroundColor(t){if(!!t){if(this._backgroundColor)this._backgroundColor.copy(t);else{if(!t.clone)return;this._backgroundColor=t.clone()}this.applyClearFlagsIfIsActiveCamera()}}get cam(){return this.activeAndEnabled&&this.buildCamera(),this._cam}awake(){this.sourceId||console.warn("Camera has no source - the camera should be exported inside a gltf",this.name)}onEnable(){UD&&console.log(this),this.buildCamera(),this.tag=="MainCamera"&&this.context.setCurrentCamera(this),this.applyClearFlagsIfIsActiveCamera()}buildCamera(){if(this._cam)return;const t=this.gameObject.isCamera;let n=null;if(t?n=this.gameObject:n=this.gameObject.children[0],n&&n.isCamera)n.type==="PerspectiveCamera"&&(n.fov=this._fov,n.near=this._nearClipPlane,n.far=this._farClipPlane,n.updateProjectionMatrix());else if(!this.orthographic)n=new ts(this.fieldOfView,window.innerWidth/window.innerHeight,this._nearClipPlane,this._farClipPlane),n.fov=this.fieldOfView;else{const i=this.orthographicSize*100;n=new nh(window.innerWidth/-i,window.innerWidth/i,window.innerHeight/i,window.innerHeight/-i,this._nearClipPlane,this._farClipPlane)}this._cam=n,this.layer===0&&this._cam.layers.enableAll(),this.tag=="MainCamera"&&this.context.setCurrentCamera(this)}applyClearFlagsIfIsActiveCamera(){var t;if(this._cam&&this.context.mainCameraComponent===this)switch(this._clearFlags){case 1:if(this.environmentIsTransparent()&&(!this.ARBackgroundAlpha||this.ARBackgroundAlpha<.001)){this.context.scene.background=null,this.context.renderer.setClearColor(0,0);return}this.enableSkybox();break;case 2:if(this._backgroundColor){let n=this._backgroundColor.alpha;this.environmentIsTransparent()&&(n=(t=this.ARBackgroundAlpha)!=null?t:0),this.context.scene.background=null,this.context.renderer.setClearColor(this._backgroundColor,n)}break;case 4:this.context.scene.background=null,this.context.renderer.setClearColor(0,0);break}}environmentIsTransparent(){var r;const t=(r=this.context.renderer.xr)==null?void 0:r.getSession();if(!t)return!1;const n=t.environmentBlendMode;return n==="additive"||n==="alpha-blend"}enableSkybox(){this._skybox||(this._skybox=new vJ(this)),this._skybox.enable()}}sh([Re()],Us.prototype,"fieldOfView",1);sh([Re()],Us.prototype,"nearClipPlane",1);sh([Re()],Us.prototype,"farClipPlane",1);sh([Re()],Us.prototype,"clearFlags",1);sh([Re()],Us.prototype,"orthographic",2);sh([Re()],Us.prototype,"orthographicSize",2);sh([Re()],Us.prototype,"ARBackgroundAlpha",2);sh([Re(oo)],Us.prototype,"backgroundColor",1);class vJ{constructor(e){E(this,"_camera");E(this,"_skybox");this._camera=e}get context(){var e;return(e=this._camera)==null?void 0:e.context}enable(){this._skybox=this.context.lightmaps.tryGetSkybox(this._camera.sourceId),this._skybox?(UD&&console.log("Set skybox",this._camera,this._skybox),this._skybox.encoding=Gn,this._skybox.mapping=ka,this.context.scene.background=this._skybox):console.warn("Failed to load/find skybox texture",this)}}function xJ(a){const e="created/implictly",t=new qt;a.add(t);const n=Te.addNewComponent(t,Us,!1);n.sourceId=e;const i=Te.addNewComponent(t,Ff,!1);return i.sourceId=e,n}const bP={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			gl_FragColor = texture2D( tDiffuse, vUv );
			gl_FragColor.a *= opacity;


		}`};class iv{constructor(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}const wJ=new nh(-1,1,1,-1,0,1),fS=new Sn;fS.setAttribute("position",new tn([-1,3,0,-1,-1,0,3,-1,0],3));fS.setAttribute("uv",new tn([0,2,0,0,2,0],2));class bJ{constructor(e){this._mesh=new _t(fS,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,wJ)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class EP extends iv{constructor(e,t){super(),this.textureID=t!==void 0?t:"tDiffuse",e instanceof nr?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=dC.clone(e.uniforms),this.material=new nr({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new bJ(this.material)}render(e,t,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}}class CP extends iv{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,n){const i=e.getContext(),r=e.state;r.buffers.color.setMask(!1),r.buffers.depth.setMask(!1),r.buffers.color.setLocked(!0),r.buffers.depth.setLocked(!0);let o,l;this.inverse?(o=0,l=1):(o=1,l=0),r.buffers.stencil.setTest(!0),r.buffers.stencil.setOp(i.REPLACE,i.REPLACE,i.REPLACE),r.buffers.stencil.setFunc(i.ALWAYS,o,4294967295),r.buffers.stencil.setClear(l),r.buffers.stencil.setLocked(!0),e.setRenderTarget(n),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),r.buffers.color.setLocked(!1),r.buffers.depth.setLocked(!1),r.buffers.stencil.setLocked(!1),r.buffers.stencil.setFunc(i.EQUAL,1,4294967295),r.buffers.stencil.setOp(i.KEEP,i.KEEP,i.KEEP),r.buffers.stencil.setLocked(!0)}}class EJ extends iv{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class CJ{constructor(e,t){if(this.renderer=e,t===void 0){const n=e.getSize(new Xe);this._pixelRatio=e.getPixelRatio(),this._width=n.width,this._height=n.height,t=new Hr(this._width*this._pixelRatio,this._height*this._pixelRatio),t.texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],bP===void 0&&console.error("THREE.EffectComposer relies on CopyShader"),EP===void 0&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new EP(bP),this.clock=new Hy}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let n=!1;for(let i=0,r=this.passes.length;i<r;i++){const o=this.passes[i];if(o.enabled!==!1){if(o.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(i),o.render(this.renderer,this.writeBuffer,this.readBuffer,e,n),o.needsSwap){if(n){const l=this.renderer.getContext(),h=this.renderer.state.buffers.stencil;h.setFunc(l.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),h.setFunc(l.EQUAL,1,4294967295)}this.swapBuffers()}CP!==void 0&&(o instanceof CP?n=!0:o instanceof EJ&&(n=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){const t=this.renderer.getSize(new Xe);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const n=this._width*this._pixelRatio,i=this._height*this._pixelRatio;this.renderTarget1.setSize(n,i),this.renderTarget2.setSize(n,i);for(let r=0;r<this.passes.length;r++)this.passes[r].setSize(n,i)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}}new nh(-1,1,1,-1,0,1);const zD=new Sn;zD.setAttribute("position",new tn([-1,3,0,-1,-1,0,3,-1,0],3));zD.setAttribute("uv",new tn([0,2,0,0,2,0],2));class SJ extends iv{constructor(e,t,n,i,r){super(),this.scene=e,this.camera=t,this.overrideMaterial=n,this.clearColor=i,this.clearAlpha=r!==void 0?r:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new _e}render(e,t,n){const i=e.autoClear;e.autoClear=!1;let r,o;this.overrideMaterial!==void 0&&(o=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),r=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:n),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(this._oldClearColor,r),this.overrideMaterial!==void 0&&(this.scene.overrideMaterial=o),e.autoClear=i}}class fb{constructor(e,t,n,i){E(this,"_name");E(this,"_nameHash");E(this,"_normalizedTime");E(this,"_length");E(this,"_speed");this._name=e.name,this._nameHash=e.hash,this._normalizedTime=t,this._length=n,this._speed=i}get name(){return this._name}get nameHash(){return this._nameHash}get normalizedTime(){return this._normalizedTime}get length(){return this._length}get speed(){return this._speed}}function MJ(a,e){var t;return{name:"",isLooping:!1,guid:(t=e==null?void 0:e.generateUUID())!=null?t:Tu.generateUUID(),index:-1,clip:new Kl(a,1,[])}}var nu=(a=>(a[a.If=1]="If",a[a.IfNot=2]="IfNot",a[a.Greater=3]="Greater",a[a.Less=4]="Less",a[a.Equals=6]="Equals",a[a.NotEqual=7]="NotEqual",a))(nu||{}),GD=(a=>(a[a.Float=1]="Float",a[a.Int=3]="Int",a[a.Bool=4]="Bool",a[a.Trigger=9]="Trigger",a))(GD||{});class TJ{constructor(){E(this,"_types",{})}add(e,t){const n=this._types[e];n===void 0?this._types[e]=t:n!==t&&console.warn("Type name exists multiple times in your project and may lead to runtime errors:",e)}get(e){return this._types[e]}}const je=new TJ,Fg=jt("gizmos"),ao=jt("debugextension"),iy=jt("debugresolvedependencies"),pb="/extensions/",IJ=[{prefix:"/nodes/",dependencyName:"node"},{prefix:"/meshes/",dependencyName:"mesh"},{prefix:"/materials/",dependencyName:"material"},{prefix:"/textures/",dependencyName:"texture"},{prefix:"/animations/",dependencyName:"animation"}];async function pS(a,e){iy&&console.log(a,e);const t=[];EE(IJ,a,e,t);const n=await Promise.all(t);return typeof e=="string"&&n.length===1?n[0]:n}function EE(a,e,t,n){if(typeof t=="object"&&t!==void 0&&t!==null)for(const i of Object.keys(t)){const r=t[i];if(typeof r=="string"){const o=SP(e,r);if(o!==null)typeof o.then=="function"?n.push(o.then(l=>t[i]=l)):t[i]=o;else for(const l of a){const h=CE(l.prefix,r);if(h>=0){iy&&console.log(l,h,l.dependencyName),n.push(e==null?void 0:e.getDependency(l.dependencyName,h).then(u=>(t[i]=u,u)));break}}}else if(Array.isArray(r))for(let o=0;o<r.length;o++){const l=r[o],h=SP(e,l);if(h!==null){typeof h.then=="function"?n.push(h.then(u=>r[o]=u)):r[o]=h;continue}for(const u of a){const f=CE(u.prefix,l);if(f>=0){iy&&console.log(u,f,u.dependencyName),n.push(e==null?void 0:e.getDependency(u.dependencyName,f).then(g=>r[o]=g));break}}typeof l=="object"&&EE(a,e,l,n)}else typeof r=="object"&&EE(a,e,r,n)}else typeof t=="string"&&RJ(a,e,t,n)}function SP(a,e){if(a&&a.plugins&&typeof e=="string"&&e.startsWith(pb)){let t=e.substring(pb.length);const n=t.indexOf("/");n>=0&&(t=t.substring(0,n));const i=a.plugins[t];if(ao&&console.log(t,i),typeof(i==null?void 0:i.resolve)=="function"){const r=e.substring(pb.length+t.length+1);return i.resolve(a,r)}}return null}function RJ(a,e,t,n){for(const i of a){const r=CE(i.prefix,t);if(r>=0)return iy&&console.log(i,r,i.dependencyName),n.push(e==null?void 0:e.getDependency(i.dependencyName,r).then(o=>o)),!0}return!1}function CE(a,e){if(typeof e=="string"&&e.startsWith(a)){const t=e.substring(a.length),n=Number.parseInt(t);if(n>=0)return n}return-1}const mb="NEEDLE_persistent_assets";function PJ(a){return(a==null?void 0:a.___persistentAsset)===!0}class BJ{constructor(e){E(this,"parser");this.parser=e}get name(){return mb}async afterRoot(e){var i,r;if(!((r=(i=this.parser)==null?void 0:i.json)!=null&&r.extensions))return;const t=this.parser.json.extensions[mb];if(!t)return;ao&&console.log(t);const n=new Array;for(const o of t==null?void 0:t.assets){const l=pS(this.parser,o);l&&n.push(l)}await Promise.all(n)}resolve(e,t){const n=Number.parseInt(t);if(n>=0){ao&&console.log(t);const i=e.json.extensions[mb];if(i){const r=i==null?void 0:i.assets[n];if(r&&typeof r=="object"){r.___persistentAsset=!0;const o=r.__type;o&&je.get(o)}return r}}return null}}const iu=jt("debugserializer");class LJ{constructor(){E(this,"typeMap",{})}register(e,t){if(this.typeMap[e]!==void 0){if(this.typeMap[e]===t)return;console.warn("Type "+e+" is already registered",t,this.typeMap[e])}iu&&console.log("Register type serializer for "+e,t),this.typeMap[e]=t}getSerializer(e){if(!!e)return this.typeMap[e]}getSerializerForConstructor(e,t=0){var h,u,f,g;if(t>20)return;if(!e||!e.constructor){iu&&console.log("invalid type");return}const n=(u=e.name)!=null?u:(h=e.constructor)==null?void 0:h.name;if(!n){iu&&console.log("invalid name",n);return}const i=this.getSerializer(n);if(i!==void 0)return iu&&console.log("FOUND "+n,e.name,e.constructor.name,i,this.typeMap),i;let r=Object.getPrototypeOf(e);if(!(r.prototype||r.constructor)){iu&&console.warn("No prototype for "+n,e,e.name,e.prototype,e.constructor.name);return}const l=(f=r.prototype)!=null?f:r.constructor;if(l!==e){const m=this.getSerializerForConstructor(l,++t);if(m){iu&&console.log("FOUND "+l.constructor.name,l.name,l,m);const A=(g=l.name)!=null?g:l.constructor.name;A==="Function"?console.error("Registering Function is not allowed, something went wrong",e,l,m):this.register(A,m)}return m}}}const sy=new LJ;class kg{constructor(e){if(Array.isArray(e))for(const t of e)sy.register(t.name,this);else sy.register(e.name,this)}}class HD{constructor(e){E(this,"root");E(this,"gltf");E(this,"gltfId");E(this,"object");E(this,"target");E(this,"nodeId");E(this,"nodeToObject");E(this,"objectToNode");E(this,"context");E(this,"path");this.root=e}}function DJ(a,e){const t=a.$serializedTypes;if(t===void 0)return null;const n={};for(const i in t){let r=a[i];if(r!=null&&typeof r=="object"){const o=sy.getSerializerForConstructor(r);if(o){n[i]=o.onSerialize(r,e);continue}}n[i]=r}return n.name=a.constructor.name,typeof a.guid=="string"&&(n.guid=a.guid),n}const S_=[];function VD(a,e){if(!a)return e;typeof a.$serializedTypes=="object"&&(e||(e={}),Object.assign(e,a.$serializedTypes));const t=Object.getPrototypeOf(a);return VD(t,e)}function SE(a,e,t){if(!a)return!1;if(t.target=a,a.onBeforeDeserialize!==void 0){const i=a.onBeforeDeserialize(e,t);if(typeof i=="boolean")return i}const n=VD(a);if(e){if(typeof e.guid=="string"&&(a.guid=e.guid),n)for(const i in n){const r=n[i],o=e[i];if(t.path=i,r===null)a[i]=o;else{let l=function(h){const f=h.type;return f?ME(o,f,t,void 0,a[i]):ME(o,h,t,void 0,a[i])};if(a.onBeforeDeserializeMember!==void 0&&a.onBeforeDeserializeMember(i,o,t)===!0)continue;if(Array.isArray(r))for(let h=0;h<r.length;h++){const u=r[h],f=l(u);if(f!==void 0||h===r.length-1){a[i]=f;break}}else a[i]=l(r);S_.length=0,a.onAfterDeserializeMember!==void 0&&a.onAfterDeserializeMember(i,o,t)}}OJ(a,e)}return a.onAfterDeserialize!==void 0&&a.onAfterDeserialize(e,t),t.path=void 0,!0}function OJ(a,e){for(const n of Object.keys(e)){const i=e[n];if(typeof i=="object"&&i!==null&&i!==void 0){const r=a[n];if(!r){iu&&console.log(n,"is undefined on",a);continue}for(const o of Object.keys(i))r[o]===void 0&&t(i[o])&&!t(r)&&(r[o]=i[o])}}function t(n){switch(typeof n){case"number":case"string":case"boolean":return!0}return!1}}function ME(a,e,t,n,i){let r=typeof e=="function"&&e.prototype===void 0,o=e;if(r)try{if(o=e==null?void 0:e.call(e,i),r=!1,o==null)return}catch(f){console.error("Error in callback",f,a)}if(!r&&i instanceof o)return i;if(i&&typeof i=="object"&&PJ(i)){if(i.__concreteInstance)return i.__concreteInstance;const f=i;if(!f.$serializedTypes&&o.prototype.$serializedTypes&&(f.$serializedTypes=o.prototype.$serializedTypes),f.$serializedTypes&&SE(f,a,t),i&&o!==void 0)try{const g=new o;ao&&console.log("Create concrete instance for persistent asset",i,"instance:",g),mS(g,i),i.__concreteInstance=g,i=g}catch(g){console.error("Error creating instance or creating values on instance",g,i,o)}return i}if(n||(n={serializer:sy.getSerializerForConstructor(o)}),Array.isArray(a)){const f=[];for(let g=0;g<a.length;g++){const m=a[g],A=ME(m,e,t,n,m);f.push(A)}return f}const l=n.serializer;if(l)return l.onDeserialize(a,t);let h;a&&(a.isMaterial||a.isTexture||a.isObject3D)?h=a:h=new o(...FJ(a));const u=h;return u.$serializedTypes&&SE(u,a,t),h}function FJ(a){if(S_.length=0,typeof a=="object"&&a!==null&&a!==void 0)for(const e of Object.keys(a))S_.push(a[e]);return S_}function mS(a,e){if(e!=null&&a!=null)for(const t of Object.keys(e)){const n=kJ(a,t);(!n||n.writable===!0||(n==null?void 0:n.set)!==void 0)&&(a[t]=e[t])}}function kJ(a,e){let t;do t=Object.getOwnPropertyDescriptor(a,e);while(!t&&(a=Object.getPrototypeOf(a)));return t}const El=jt("debuganimatorcontroller"),gb=jt("debugrootmotion");class bf{constructor(e){E(this,"normalizedStartOffset",0);E(this,"_speed",1);E(this,"animator");E(this,"model");E(this,"_mixer");E(this,"_activeState");E(this,"_activeStates",[]);E(this,"rootMotionHandler");this.model=e,El&&console.log(this)}Play(e,t=-1,n=Number.NEGATIVE_INFINITY,i=0){if(t<0)t=0;else if(t>=this.model.layers.length){console.warn("invalid layer");return}const o=this.model.layers[t].stateMachine;for(const l of o.states)if(l.name===e||l.hash===e){El&&console.log("transition to ",l),this.transitionTo(l,i,n);return}console.warn("Could not find "+e+" to play")}Reset(){this.setStartTransition()}SetBool(e,t){var i;const n=typeof e=="string"?"name":"hash";return(i=this.model)==null?void 0:i.parameters.filter(r=>r[n]===e).forEach(r=>r.value=t)}GetBool(e){var n,i,r;const t=typeof e=="string"?"name":"hash";return(r=(i=(n=this.model)==null?void 0:n.parameters.find(o=>o[t]===e))==null?void 0:i.value)!=null?r:!1}SetFloat(e,t){var i;const n=typeof e=="string"?"name":"hash";return(i=this.model)==null?void 0:i.parameters.filter(r=>r[n]===e).forEach(r=>r.value=t)}GetFloat(e){var n,i,r;const t=typeof e=="string"?"name":"hash";return(r=(i=(n=this.model)==null?void 0:n.parameters.find(o=>o[t]===e))==null?void 0:i.value)!=null?r:0}SetInteger(e,t){var i;const n=typeof e=="string"?"name":"hash";return(i=this.model)==null?void 0:i.parameters.filter(r=>r[n]===e).forEach(r=>r.value=t)}GetInteger(e){var n,i,r;const t=typeof e=="string"?"name":"hash";return(r=(i=(n=this.model)==null?void 0:n.parameters.find(o=>o[t]===e))==null?void 0:i.value)!=null?r:0}SetTrigger(e){var n;El&&console.log("SET TRIGGER",e);const t=typeof e=="string"?"name":"hash";return(n=this.model)==null?void 0:n.parameters.filter(i=>i[t]===e).forEach(i=>i.value=!0)}ResetTrigger(e){var n;const t=typeof e=="string"?"name":"hash";return(n=this.model)==null?void 0:n.parameters.filter(i=>i[t]===e).forEach(i=>i.value=!1)}IsInTransition(){return this._activeStates.length>1}SetSpeed(e){this._speed=e}FindState(e){if(!e)return null;for(const t of this.model.layers)for(const n of t.stateMachine.states)if(n.name===e)return n;return null}get context(){var e;return(e=this.animator)==null?void 0:e.context}bind(e){this.animator=e,this._mixer=new Wy(this.animator.gameObject),this.createActions(this.animator)}clone(){const e=qC(this.model,(n,i,r)=>{var o;return r==null?!0:!(r.type==="Object3D"||r.isObject3D===!0||((o=r==null?void 0:r.constructor)==null?void 0:o.name)==="AnimationAction"||r.tracks!==void 0)});return console.assert(e!==this.model),new bf(e)}update(){var t,n;if(!this.animator)return;this.evaluateTransitions(),this.updateActiveStates();const e=this.animator.context.time.deltaTime;this.animator.applyRootMotion&&((t=this.rootMotionHandler)==null||t.onBeforeUpdate()),this._mixer.update(e),this.animator.applyRootMotion&&((n=this.rootMotionHandler)==null||n.onAfterUpdate())}updateActiveStates(){for(let e=0;e<this._activeStates.length;e++){const t=this._activeStates[e],n=t.motion;if(!n.action)this._activeStates.splice(e,1),e--;else{const i=n.action;i.getEffectiveWeight()<=0&&!i.isRunning()&&(El&&console.debug("REMOVE",t.name,i.getEffectiveWeight(),i.isRunning(),i.isScheduled()),this._activeStates.splice(e,1),e--)}}}setStartTransition(){for(const e of this.model.layers){const t=e.stateMachine,n=t.states[t.defaultState];this.transitionTo(n,0,this.normalizedStartOffset)}}evaluateTransitions(){var r;let e=!1;if(!this._activeState){if(this.setStartTransition(),!this._activeState)return;e=!0}const t=this._activeState,n=t.motion.action;for(const o of t.transitions){if(!o.hasExitTime&&o.conditions.length<=0)continue;let l=!0;for(const h of o.conditions)if(!this.evaluateCondition(h)){l=!1;break}if(!!l){El&&l&&console.log("All conditions are met",o.conditions,n);for(const h of o.conditions){const u=this.model.parameters.find(f=>f.name===h.parameter);(u==null?void 0:u.type)===GD.Trigger&&(u.value=!1)}if(n){const h=t.motion.clip.duration,u=h<=0?1:n.time/h;if(!o.hasExitTime||u>=o.exitTime&&n.time>=n.getClip().duration){n.clampWhenFinished=!0,El&&(console.log("transition to "+o.destinationState,o),console.log(n.time,o.exitTime)),this.transitionTo(o.destinationState,o.duration,o.offset);return}}else{this.transitionTo(o.destinationState,o.duration,o.offset);return}break}}let i=!1;if(t.motion.isLooping&&n&&n.time>=n.getClip().duration&&(i=!0,n.reset(),n.time=0,n.play()),!i&&t&&!e&&n&&this.animator&&t.behaviours){const o=n==null?void 0:n.getClip().duration,l=n.time/o,h=new fb(this._activeState,l,o,this._speed);for(const u of t.behaviours)u.instance&&((r=u.instance.onStateUpdate)==null||r.call(u.instance,this.animator,h,0))}}transitionTo(e,t,n){var u,f,g,m,A,v,w,b;if(!this.animator)return;const i=0;if(typeof e=="number"&&(e==-1&&(e=this.model.layers[i].stateMachine.defaultState),e=this.model.layers[i].stateMachine.states[e]),!(e!=null&&e.motion)||!e.motion.clip)return;const r=this._activeState===e;if(r){const S=e.motion;!S.action_loopback&&S.clip&&(this._mixer.uncacheAction(S.clip,this.animator.gameObject),S.action_loopback=this.createAction(S.clip))}if(((u=this._activeState)==null?void 0:u.behaviours)&&this._activeState.motion.action){const S=(f=this._activeState)==null?void 0:f.motion.clip.duration,R=this._activeState.motion.action.time/S,M=new fb(this._activeState,R,S,this._speed);for(const I of this._activeState.behaviours)(m=(g=I.instance)==null?void 0:g.onStateExit)==null||m.call(I.instance,this.animator,M,i)}const o=(A=this._activeState)==null?void 0:A.motion.action;o&&o.fadeOut(t),r&&(e.motion.action=e.motion.action_loopback,e.motion.action_loopback=o);const l=this._activeState;this._activeState=e;const h=(v=e.motion)==null?void 0:v.action;if(h){n=Math.max(0,Math.min(1,n)),h.isRunning()&&h.stop(),h.reset(),h.timeScale=this._speed,h.enabled=!0;const S=e.motion.clip.duration;if(h.time=n*S,h.clampWhenFinished=!0,h.setLoop(Sy,0),t>0?h.fadeIn(t):h.setEffectiveWeight(1),h.play(),this.rootMotionHandler&&this.rootMotionHandler.onStart(h),this._activeStates.includes(e)||this._activeStates.push(e),this._activeState.behaviours){const R=new fb(e,n,S,this._speed);for(const M of this._activeState.behaviours)(b=(w=M.instance)==null?void 0:w.onStateEnter)==null||b.call(M.instance,this.animator,R,i)}}else console.warn("No action",e.motion,this);El&&console.log("TRANSITION FROM "+(l==null?void 0:l.name)+" TO "+e.name,t,o,h,h==null?void 0:h.getEffectiveTimeScale(),h==null?void 0:h.getEffectiveWeight(),h==null?void 0:h.isRunning(),h==null?void 0:h.isScheduled(),h==null?void 0:h.paused)}createAction(e){var t;if(this._mixer.uncacheClip(e),(t=this.animator)!=null&&t.applyRootMotion){this.rootMotionHandler||(this.rootMotionHandler=new NJ(this));const n=this.animator.gameObject;return this.rootMotionHandler.createClip(this._mixer,n,e)}else return this._mixer.clipAction(e)}evaluateCondition(e){const t=this.model.parameters.find(n=>n.name===e.parameter);if(!t)return!1;switch(e.mode){case nu.If:return t.value===!0;case nu.IfNot:return t.value===!1;case nu.Greater:return t.value>e.threshold;case nu.Less:return t.value<e.threshold;case nu.Equals:return t.value===e.threshold;case nu.NotEqual:return t.value!==e.threshold}return!1}createActions(e){var t,n,i;for(const r of this.model.layers){const o=r.stateMachine;for(let l=0;l<o.states.length;l++){const h=o.states[l];if(h.motion||(h.motion=MJ(h.name)),this.animator&&h.motion.clips){const u=(t=h.motion.clips)==null?void 0:t.find(f=>{var g,m;return f.node.name===((m=(g=this.animator)==null?void 0:g.gameObject)==null?void 0:m.name)});h.motion.clip=u==null?void 0:u.clip}if(!h.motion.clip){const u=new Kl;h.motion.clip=u}if((n=h.motion)!=null&&n.clip){const u=h.motion.clip,f=this.createAction(u);h.motion.action=f}if(h.behaviours&&Array.isArray(h.behaviours))for(const u of h.behaviours){if(!(u!=null&&u.typeName))continue;const f=je.get(u.typeName),g=new f;g.isStateMachineBehaviour&&(g._context=(i=this.context)!=null?i:void 0,mS(g,u.properties),u.instance=g),El&&console.log("Created animator controller behaviour",h.name,u.typeName,u.properties,g)}}}}*enumerateActions(){for(const e of this.model.layers){const t=e.stateMachine;for(let n=0;n<t.states.length;n++){const i=t.states[n];i!=null&&i.motion&&(i.motion.action&&(yield i.motion.action),i.motion.action_loopback&&(yield i.motion.action_loopback))}}}}class MP{constructor(e,t){E(this,"track");E(this,"createdInterpolant");E(this,"originalEvaluate");E(this,"customEvaluate");this.track=e;const n=e,i=n.createInterpolant.bind(e);n.createInterpolant=()=>(n.createInterpolant=i,this.createdInterpolant=i(),this.originalEvaluate=this.createdInterpolant.evaluate.bind(this.createdInterpolant),this.customEvaluate=r=>{if(!this.originalEvaluate)return;const o=this.originalEvaluate(r);return t(r,o)},this.createdInterpolant.evaluate=this.customEvaluate,this.createdInterpolant)}evaluate(e){this.customEvaluate&&this.customEvaluate(e)}dispose(){this.createdInterpolant&&this.originalEvaluate&&(this.createdInterpolant.evaluate=this.originalEvaluate),this.track=void 0,this.createdInterpolant=null,this.originalEvaluate=void 0,this.customEvaluate=void 0}}const Es=class{constructor(e,t,n,i,r){E(this,"_action");E(this,"root");E(this,"clip");E(this,"positionWrapper",null);E(this,"rotationWrapper",null);E(this,"context");E(this,"positionChange",new q);E(this,"rotationChange",new Ot);if(this.context=e,this.root=t,this.clip=n,Es.firstKeyframeRotation[n.uuid]||(Es.firstKeyframeRotation[n.uuid]=new Ot),r){const o=r.values;Es.firstKeyframeRotation[n.uuid].set(o[0],o[1],o[2],o[3])}Es.spaceRotation[n.uuid]||(Es.spaceRotation[n.uuid]=new Ot),Es.effectiveSpaceRotation[n.uuid]||(Es.effectiveSpaceRotation[n.uuid]=new Ot),Es.clipOffsetRotation[n.uuid]=new Ot,r&&Es.clipOffsetRotation[n.uuid].set(r.values[0],r.values[1],r.values[2],r.values[3]).invert(),this.handlePosition(n,i),this.handleRotation(n,r)}set action(e){this._action=e}get action(){return this._action}onStart(e){if(e.getClip()!==this.clip)return;const t=Es.lastObjRotation[this.root.uuid];Es.spaceRotation[this.clip.uuid].copy(t);{const n=new vs().setFromQuaternion(t);console.log("START",this.clip.name,Ei.toDegrees(n.y))}}getClipRotationOffset(){return Es.clipOffsetRotation[this.clip.uuid]}handlePosition(e,t){if(t){const n=this.root;gb&&n.add(new Lg),Es.lastObjPosition[n.uuid]||(Es.lastObjPosition[n.uuid]=new q);const i=new q,r=new q;let o=0;this.positionWrapper=new MP(t,(l,h)=>{const u=this.action.getEffectiveWeight();if(gb&&n.position.length()>8&&n.position.set(0,n.position.y,0),l>o){i.set(h[0],h[1],h[2]),i.sub(r),i.multiplyScalar(u),i.applyQuaternion(this.getClipRotationOffset());const f=this.clip.uuid;i.applyQuaternion(Es.spaceRotation[f]),this.positionChange.copy(i)}return r.fromArray(h),o=l,h[0]=0,h[1]=0,h[2]=0,h})}}handleRotation(e,t){if(t){if(gb){const l=t.values,h=new vs().setFromQuaternion(new Ot(l[0],l[1],l[2],l[3]));console.log(e.name,t.name,"FIRST ROTATION IN TRACK",Ei.toDegrees(h.y));const u=t.values.length-4,f=new Ot().set(l[u],l[u+1],l[u+2],l[u+3]),g=new vs().setFromQuaternion(f);console.log(e.name,t.name,"LAST ROTATION IN TRACK",Ei.toDegrees(g.y))}const n=this.root;Es.lastObjRotation[n.uuid]||(Es.lastObjRotation[n.uuid]=new Ot);let i=0;const r=new Ot,o=new Ot;this.rotationWrapper=new MP(t,(l,h)=>(l>i&&(o.set(h[0],h[1],h[2],h[3]),r.invert(),o.multiply(r),this.rotationChange.copy(o)),r.fromArray(h),i=l,h[0]=0,h[1]=0,h[2]=0,h[3]=1,h))}}onBeforeUpdate(){this.positionChange.set(0,0,0),this.rotationChange.set(0,0,0,1)}onAfterUpdate(){const e=this.action.getEffectiveWeight();this.positionChange.multiplyScalar(e),this.rotationChange.slerp(Es.identityQuaternion,1-e)}};let ea=Es;E(ea,"lastObjPosition",{}),E(ea,"lastObjRotation",{}),E(ea,"firstKeyframeRotation",{}),E(ea,"spaceRotation",{}),E(ea,"effectiveSpaceRotation",{}),E(ea,"clipOffsetRotation",{}),E(ea,"identityQuaternion",new Ot);class NJ{constructor(e){E(this,"controller");E(this,"handler",[]);E(this,"root");E(this,"summedPosition",new q);E(this,"summedRotation",new Ot);this.controller=e}createClip(e,t,n){this.root=t,t&&"name"in t&&t.name;const i=this.findRootTrack(n,".position"),r=this.findRootTrack(n,".quaternion"),o=new ea(this.controller.context,t,n,i,r);this.handler.push(o);const l=e.clipAction(n);return o.action=l,l}onStart(e){for(const t of this.handler)t.onStart(e)}onBeforeUpdate(){for(const e of this.handler)e.onBeforeUpdate()}onAfterUpdate(){this.summedPosition.set(0,0,0),this.summedRotation.set(0,0,0,1);for(const e of this.handler)e.onAfterUpdate(),this.summedPosition.add(e.positionChange),this.summedRotation.multiply(e.rotationChange);this.root.position.add(this.summedPosition),this.root.quaternion.multiply(this.summedRotation),ea.lastObjRotation[this.root.uuid].copy(this.root.quaternion)}findRootTrack(e,t){const n=e.tracks;for(const i of n)if(i.name.endsWith(t))return i;return null}}var UJ=Object.defineProperty,zJ=Object.getOwnPropertyDescriptor,sv=(a,e,t,n)=>{for(var i=n>1?void 0:n?zJ(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&UJ(e,t,i),i};const GJ=jt("debuganimator");class rh extends Bt{constructor(){super(...arguments);E(this,"applyRootMotion",!1);E(this,"hasRootMotion",!1);E(this,"keepAnimatorControllerStateOnDisable",!1);E(this,"speed",1);E(this,"normalizedStartOffset",0);E(this,"_animatorController",null)}set runtimeAnimatorController(t){this._animatorController&&this._animatorController.model===t||(t?t instanceof bf?this._animatorController=t:this._animatorController=new bf(t):this._animatorController=null)}get runtimeAnimatorController(){return this._animatorController}Play(t,n=-1,i=Number.NEGATIVE_INFINITY,r=0){var o;(o=this.runtimeAnimatorController)==null||o.Play(t,n,i,r)}Reset(){var t;(t=this._animatorController)==null||t.Reset()}SetBool(t,n){var i;(i=this.runtimeAnimatorController)==null||i.SetBool(t,n)}GetBool(t){var n,i;return(i=(n=this.runtimeAnimatorController)==null?void 0:n.GetBool(t))!=null?i:!1}SetFloat(t,n){var i;(i=this.runtimeAnimatorController)==null||i.SetFloat(t,n)}GetFloat(t){var n,i;return(i=(n=this.runtimeAnimatorController)==null?void 0:n.GetFloat(t))!=null?i:-1}SetInteger(t,n){var i;(i=this.runtimeAnimatorController)==null||i.SetInteger(t,n)}GetInteger(t){var n,i;return(i=(n=this.runtimeAnimatorController)==null?void 0:n.GetInteger(t))!=null?i:-1}SetTrigger(t){var n;(n=this.runtimeAnimatorController)==null||n.SetTrigger(t)}ResetTrigger(t){var n;(n=this.runtimeAnimatorController)==null||n.ResetTrigger(t)}IsInTransition(){var t,n;return(n=(t=this.runtimeAnimatorController)==null?void 0:t.IsInTransition())!=null?n:!1}SetSpeed(t){var n;t!==this.speed&&(this.speed=t,(n=this._animatorController)==null||n.SetSpeed(t))}set minMaxSpeed(t){this.speed=Ei.lerp(t.x,t.y,Math.random())}set minMaxOffsetNormalized(t){this.normalizedStartOffset=Ei.lerp(t.x,t.y,Math.random()),this.runtimeAnimatorController&&(this.runtimeAnimatorController.normalizedStartOffset=this.normalizedStartOffset)}awake(){if(!!this.gameObject){if(this.runtimeAnimatorController){const t=this.runtimeAnimatorController.clone();console.assert(this.runtimeAnimatorController!==t),this.runtimeAnimatorController=t,console.assert(this.runtimeAnimatorController===t),this.runtimeAnimatorController.bind(this),this.runtimeAnimatorController.SetSpeed(this.speed),this.runtimeAnimatorController.normalizedStartOffset=this.normalizedStartOffset}GJ&&console.log("ANIMATOR",this.name,this)}}onDisable(){var t;this.keepAnimatorControllerStateOnDisable||(t=this._animatorController)==null||t.Reset()}onBeforeRender(){this._animatorController&&this._animatorController.update()}}sv([Re()],rh.prototype,"applyRootMotion",2);sv([Re()],rh.prototype,"hasRootMotion",2);sv([Re()],rh.prototype,"keepAnimatorControllerStateOnDisable",2);sv([Re()],rh.prototype,"runtimeAnimatorController",1);var HJ=Object.defineProperty,VJ=Object.getOwnPropertyDescriptor,WD=(a,e,t,n)=>{for(var i=n>1?void 0:n?VJ(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&HJ(e,t,i),i};class Hl extends Bt{constructor(){super(...arguments);E(this,"playAutomatically",!0);E(this,"randomStartTime",!0);E(this,"_tempAnimationClipBeforeGameObjectExisted",null);E(this,"mixer");E(this,"_actions",[]);E(this,"_currentActions",[]);E(this,"_handles",[]);E(this,"_didInit",!1)}get clip(){var t;return(t=this.animations)!=null&&t.length?this.animations[0]:null}set clip(t){if(!this.gameObject){this._tempAnimationClipBeforeGameObjectExisted=t;return}!t||(this.gameObject.animations||(this.gameObject.animations=[]),this.gameObject.animations.push(t))}set animations(t){this.gameObject.animations=t}get animations(){return this.gameObject.animations}get currentAction(){return this._currentActions[0]}get currentActions(){return this._currentActions}get actions(){return this._actions}set actions(t){this._actions=t}awake(){this._tempAnimationClipBeforeGameObjectExisted&&(this.clip=this._tempAnimationClipBeforeGameObjectExisted,this._tempAnimationClipBeforeGameObjectExisted=null),this.playAutomatically&&this.init()}onEnable(){if(this.playAutomatically&&this.actions.length>0&&this.currentActions.length<=0){const t=Math.floor(Math.random()*this.actions.length);this.play(t)}}start(){this.randomStartTime&&this.currentAction&&(this.currentAction.time=Math.random()*this.currentAction.getClip().duration)}update(){var t;if(!!this.mixer){this.mixer.update(this.context.time.deltaTime);for(const n of this._handles)n._update();((t=this._handles)==null?void 0:t.length)>0&&ro.markDirty(this.gameObject)}}getAction(t){var n;return(n=this.actions)==null?void 0:n.find(i=>i.getClip().name===t)}play(t,n){if(this.init(),!this.mixer)return;let i=t;if(typeof t=="number"){if(t>=this.animations.length)return;i=this.animations[t]}else typeof t=="string"&&(i=this.animations.find(o=>o.name===t));if(!i){console.error("Could not find clip",t);return}for(const o of this.actions)if(o.getClip()===i)return this.internalOnPlay(o,n);const r=this.mixer.clipAction(i);return this.actions.push(r),this.internalOnPlay(r,n)}internalOnPlay(t,n){var l;var i=this.currentAction;if(i===t&&i.isRunning()&&i.time<i.getClip().duration){const h=this.tryFindHandle(t);if(h)return h.getPromise()}const r=(l=n==null?void 0:n.exclusive)!=null?l:!0;n!=null&&n.fadeDuration?(r&&(i==null||i.fadeOut(n.fadeDuration)),t.fadeIn(n.fadeDuration)):r&&(i==null||i.stop()),t.reset(),t.enabled=!0,t.time=0,t.timeScale=1,n!=null&&n.clampWhenFinished&&(t.clampWhenFinished=!0),(n==null?void 0:n.startTime)!==void 0&&(t.time=n.startTime),(n==null?void 0:n.loop)!==void 0&&(t.loop=n.loop?sC:Sy),t.play();const o=new WJ(t,this.mixer,n,h=>{this._handles.splice(this._handles.indexOf(o),1)});return this._handles.push(o),o.getPromise()}tryFindHandle(t){for(const n of this._handles)if(n.action===t)return n}init(){if(!this._didInit&&(this._didInit=!0,!!this.gameObject)){this.actions=[],this.mixer=new Wy(this.gameObject);for(let t=0;t<this.animations.length;t++){const n=this.mixer.clipAction(this.animations[t]);this.actions.push(n)}}}}WD([Re()],Hl.prototype,"playAutomatically",2);WD([Re()],Hl.prototype,"randomStartTime",2);class WJ{constructor(e,t,n,i){E(this,"mixer");E(this,"action");E(this,"promise",null);E(this,"resolve",null);E(this,"reject",null);E(this,"_options");E(this,"_resolveCallback",null);E(this,"_rejectCallback",null);E(this,"_loopCallback");E(this,"_finishedCallback");E(this,"_resolvedOrRejectedCallback");this.action=e,this.mixer=t,this._resolvedOrRejectedCallback=i,this._options=n}getPromise(){return this.promise?this.promise:(this.promise=new Promise((e,t)=>{this._resolveCallback=e,this._rejectCallback=t,this.resolve=this.onResolve.bind(this),this.reject=this.onReject.bind(this)}),this._loopCallback=this.onLoop.bind(this),this._finishedCallback=this.onFinished.bind(this),this.mixer.addEventListener("loop",this._loopCallback),this.mixer.addEventListener("finished",this._finishedCallback),this.promise)}_update(){var e;!this._options||this._options.endTime!==void 0&&this.action.time>this._options.endTime&&(this._options.loop===!0?this.action.time=(e=this._options.startTime)!=null?e:0:(this.action.time=this._options.endTime,this.action.timeScale=0,this.onResolve()))}onResolve(){var e,t;this.dispose(),(e=this._resolvedOrRejectedCallback)==null||e.call(this,this),(t=this._resolveCallback)==null||t.call(this,this.action)}onReject(e){var t,n;this.dispose(),(t=this._resolvedOrRejectedCallback)==null||t.call(this,this),(n=this._rejectCallback)==null||n.call(this,e)}onLoop(e){}onFinished(e){e.action===this.action&&this.onResolve()}dispose(){this._loopCallback&&this.mixer.removeEventListener("loop",this._loopCallback),this._finishedCallback&&this.mixer.removeEventListener("finished",this._finishedCallback),this._loopCallback=void 0,this._finishedCallback=void 0}}var QJ=Object.defineProperty,jJ=Object.getOwnPropertyDescriptor,QD=(a,e,t,n)=>{for(var i=n>1?void 0:n?jJ(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&QJ(e,t,i),i};class rv extends Bt{constructor(){super(...arguments);E(this,"from");E(this,"to");E(this,"width",0);E(this,"centered",!0);E(this,"_centerPos")}awake(){this._centerPos=new q}update(){if(!this.from||!this.to)return;const t=ti(this.from).clone(),n=ti(this.to).clone(),i=t.distanceTo(n);this._centerPos.copy(t),this._centerPos.add(n),this._centerPos.multiplyScalar(.5),ys(this.gameObject,this.centered?this._centerPos:t),this.gameObject.lookAt(ti(this.to).clone()),this.gameObject.scale.set(this.width,this.width,i)}}QD([Re(Te)],rv.prototype,"from",2);QD([Re(Te)],rv.prototype,"to",2);var qJ=Object.defineProperty,XJ=Object.getOwnPropertyDescriptor,oh=(a,e,t,n)=>{for(var i=n>1?void 0:n?XJ(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&qJ(e,t,i),i};class ah{constructor(){E(this,"time");E(this,"value");E(this,"inTangent");E(this,"inWeight");E(this,"outTangent");E(this,"outWeight");E(this,"weightedMode")}}oh([Re()],ah.prototype,"time",2);oh([Re()],ah.prototype,"value",2);oh([Re()],ah.prototype,"inTangent",2);oh([Re()],ah.prototype,"inWeight",2);oh([Re()],ah.prototype,"outTangent",2);oh([Re()],ah.prototype,"outWeight",2);oh([Re()],ah.prototype,"weightedMode",2);class gS{constructor(){E(this,"keys")}get duration(){return!this.keys||this.keys.length==0?0:this.keys[this.keys.length-1].time}evaluate(e){if(!this.keys||this.keys.length==0)return 0;let t=null;for(const n of this.keys){if(t&&n.time>e&&e>t.time)return Ei.lerp(t.value,n.value,(e-t.time)/(n.time-t.time));t=n}return this.keys[this.keys.length-1].value}}oh([Re(ah)],gS.prototype,"keys",2);class YJ extends Ss{constructor(e,t=1,n=16,i=2){const r=new Sn,o=n+i*2,l=new Float32Array((o*3+3)*3);r.setAttribute("position",new Jn(l,3));const h=new Is({color:65280}),u=new Is({color:16776960});super(r,[u,h]),this.audio=e,this.range=t,this.divisionsInnerAngle=n,this.divisionsOuterAngle=i,this.type="PositionalAudioHelper",this.update()}update(){const e=this.audio,t=this.range,n=this.divisionsInnerAngle,i=this.divisionsOuterAngle,r=Tu.degToRad(e.panner.coneInnerAngle),o=Tu.degToRad(e.panner.coneOuterAngle),l=r/2,h=o/2;let u=0,f=0,g,m;const A=this.geometry,v=A.attributes.position;A.clearGroups();function w(b,S,R,M){const I=(S-b)/R;for(v.setXYZ(u,0,0,0),f++,g=b;g<S;g+=I)m=u+f,v.setXYZ(m,Math.sin(g)*t,0,Math.cos(g)*t),v.setXYZ(m+1,Math.sin(Math.min(g+I,S))*t,0,Math.cos(Math.min(g+I,S))*t),v.setXYZ(m+2,0,0,0),f+=3;A.addGroup(u,f,M),u+=f,f=0}w(-h,-l,i,0),w(-l,l,n,1),w(l,h,i,0),v.needsUpdate=!0,r===o&&(this.material[0].visible=!1)}dispose(){this.geometry.dispose(),this.material[0].dispose(),this.material[1].dispose()}}var TE=(a=>(a.Visible="application-visible",a.Hidden="application-hidden",a))(TE||{});class JJ extends EventTarget{constructor(t){super();E(this,"context");E(this,"_isVisible",!0);this.context=t,window.addEventListener("visibilitychange",this.onVisiblityChanged.bind(this),!1)}get hasFocus(){return document.hasFocus()}get isVisible(){return this._isVisible}onVisiblityChanged(t){switch(t.target.visibilityState){case"hidden":this._isVisible=!1,this.dispatchEvent(new Event("application-hidden"));break;case"visible":this._isVisible=!0,this.dispatchEvent(new Event("application-visible"));break}}}var ZJ=Object.defineProperty,KJ=Object.getOwnPropertyDescriptor,ch=(a,e,t,n)=>{for(var i=n>1?void 0:n?KJ(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&ZJ(e,t,i),i};const Dr=jt("debugaudio");var fm;const Js=(fm=class extends Bt{constructor(){super(...arguments);E(this,"clip","");E(this,"playOnAwake",!1);E(this,"_spatialBlend",0);E(this,"_minDistance",1);E(this,"_maxDistance",100);E(this,"_volume",1);E(this,"rollOffMode",0);E(this,"_loop",!1);E(this,"sound",null);E(this,"helper",null);E(this,"wasPlaying",!1);E(this,"audioLoader",null);E(this,"shouldPlay",!1);E(this,"_lastClipStartedLoading",null);E(this,"_focusCallback");E(this,"lerp",(e,t,n)=>e*(1-n)+t*n);E(this,"_lastContextTime",0);E(this,"_hasEnded",!0);E(this,"_needUpdateSpatialDistanceSettings",!1)}static get userInteractionRegistered(){return Js._didCallBeginWaitForUserInteraction||(Js._didCallBeginWaitForUserInteraction=!0,Js._beginWaitForUserInteraction()),Js._userInteractionRegistered}static registerWaitForAllowAudio(e){if(e!==null){if(this._userInteractionRegistered){e();return}this.callbacks.indexOf(e)===-1&&this.callbacks.push(e),Js._didCallBeginWaitForUserInteraction||(Js._didCallBeginWaitForUserInteraction=!0,Js._beginWaitForUserInteraction())}}static _beginWaitForUserInteraction(e=null){if(this._userInteractionRegistered){e&&e();return}e!==null&&this.registerWaitForAllowAudio(e);let n=(()=>{if(n!=null&&!Js._userInteractionRegistered){Js._userInteractionRegistered=!0,console.log("registered interaction, can play audio now"),document.removeEventListener("pointerdown",n),document.removeEventListener("click",n),document.removeEventListener("dragstart",n),document.removeEventListener("touchstart",n);for(const i of this.callbacks)i();this.callbacks.length=0}}).bind(this);document.addEventListener("pointerdown",n),document.addEventListener("click",n),document.addEventListener("dragstart",n),document.addEventListener("touchstart",n)}get loop(){return this.sound&&(this._loop=this.sound.getLoop()),this._loop}set loop(e){this._loop=e,this.sound&&this.sound.setLoop(e)}get spatialBlend(){return this._spatialBlend}set spatialBlend(e){e!==this._spatialBlend&&(this._spatialBlend=e,this._needUpdateSpatialDistanceSettings=!0)}get minDistance(){return this._minDistance}set minDistance(e){this._minDistance!==e&&(this._minDistance=e,this._needUpdateSpatialDistanceSettings=!0)}get maxDistance(){return this._maxDistance}set maxDistance(e){this._maxDistance!==e&&(this._maxDistance=e,this._needUpdateSpatialDistanceSettings=!0)}get volume(){return this._volume}set volume(e){this._volume=e,this.sound&&(Dr&&console.log(this.name,"audio set volume",e),this.sound.setVolume(e))}get Sound(){var e;if(!this.sound&&Js._userInteractionRegistered){const t=(e=Te.getComponent(this.context.mainCamera,ig))!=null?e:Te.findObjectOfType(ig,this.context);t!=null&&t.listener&&(this.sound=new u2(t.listener),this.gameObject.add(this.sound))}return this.sound}get ShouldPlay(){return this.shouldPlay}awake(){this.audioLoader=new K_,this.playOnAwake&&(this.shouldPlay=!0),window.addEventListener("visibilitychange",e=>{switch(document.visibilityState){case"hidden":this.wasPlaying=this.isPlaying,this.pause();break;case"visible":this.wasPlaying&&this.play();break}}),this._focusCallback=()=>{this.enabled&&this.playOnAwake&&!this.isPlaying&&Js._userInteractionRegistered&&this.play()},this.context.application.addEventListener(TE.Visible,this._focusCallback)}onDestroy(){this.context.application.removeEventListener(TE.Visible,this._focusCallback)}onEnable(){Js._userInteractionRegistered?this.playOnAwake&&this.context.application.isVisible&&this.play():Js._beginWaitForUserInteraction(()=>{this.enabled&&!this.destroyed&&this.shouldPlay&&this.loadAndPlay(this.clip)})}onDisable(){this.stop()}onLoaded(e){Dr&&console.log("audio buffer loaded"),Js.registerWaitForAllowAudio(()=>{Dr&&console.log("finished loading",e);const t=this.Sound;if(!t){console.warn("Failed getting sound",this.name);return}t.isPlaying&&t.stop(),t.setBuffer(e),t.loop=this.loop,t.setVolume(this.volume),t.autoplay=this.shouldPlay,this.applySpatialDistanceSettings(),t.isPlaying&&t.stop(),Dr&&console.log(this.name,this.shouldPlay,Js.userInteractionRegistered,this),this.shouldPlay&&Js._userInteractionRegistered&&this.play()})}applySpatialDistanceSettings(){const e=this.sound;if(!e)return;this._needUpdateSpatialDistanceSettings=!1;const t=this.lerp(10*this._maxDistance/Math.max(1e-4,this.spatialBlend),this._minDistance,this.spatialBlend);switch(Dr&&console.log(this.name,this._minDistance,this._maxDistance,this.spatialBlend,"Ref distance="+t),e.setRefDistance(t),e.setMaxDistance(Math.max(.01,this._maxDistance)),this.rollOffMode){case 0:e.setDistanceModel("exponential");break;case 1:e.setDistanceModel("linear");break}this.spatialBlend>0?Dr&&!this.helper&&(this.helper=new YJ(e,e.getRefDistance()),e.add(this.helper)):this.helper&&this.helper.parent&&this.helper.removeFromParent()}loadAndPlay(e){if(e&&(this.clip=e),this.clip&&(Dr&&console.log(this.clip),this.clip.endsWith(".mp3")||this.clip.endsWith(".wav"))){if(this.audioLoader||(this.audioLoader=new K_),this.shouldPlay=!0,this._lastClipStartedLoading===this.clip){Dr&&console.log("Is currently loading:",this._lastClipStartedLoading,this);return}this._lastClipStartedLoading=this.clip,Dr&&console.log("load audio",this.clip),this.audioLoader.load(this.clip,this.onLoaded.bind(this),()=>{},console.error)}}play(e=void 0){var t;if(!this.audioLoader||!this.sound||e&&e!==this.clip){this.loadAndPlay(e);return}this.shouldPlay=!0,this._hasEnded=!1,Dr&&console.log("play",(t=this.sound)==null?void 0:t.getVolume(),this.sound),this.sound&&!this.sound.isPlaying&&this.sound.play()}pause(){var e;Dr&&console.log("Pause",this),this._hasEnded=!0,this.shouldPlay=!1,this.sound&&this.sound.isPlaying&&(this._lastContextTime=(e=this.sound)==null?void 0:e.context.currentTime,this.sound.pause())}stop(){var e;Dr&&console.log("Pause",this),this._hasEnded=!0,this.shouldPlay=!1,this.sound&&(this._lastContextTime=(e=this.sound)==null?void 0:e.context.currentTime,Dr&&console.log(this._lastContextTime),this.sound.stop())}get isPlaying(){var e,t;return(t=(e=this.sound)==null?void 0:e.isPlaying)!=null?t:!1}set isPlaying(e){}get time(){var e,t;return(e=this.sound)!=null&&e.source?((t=this.sound.source)==null?void 0:t.context.currentTime)-this._lastContextTime+this.sound.offset:0}set time(e){if(this.sound){if(e===this.sound.offset)return;const t=this.isPlaying;this.stop(),this.sound.offset=e,t&&this.play()}}update(){this.helper&&(this.isPlaying&&this.helper.update(),this.helper.visible=this.isPlaying),this._needUpdateSpatialDistanceSettings&&this.applySpatialDistanceSettings(),this.sound&&!this.sound.isPlaying&&this.shouldPlay&&!this._hasEnded&&(this._hasEnded=!0,Dr&&console.log("Audio clip ended",this.clip),this.sound.dispatchEvent({type:"ended",target:this}))}},E(fm,"_didCallBeginWaitForUserInteraction",!1),E(fm,"callbacks",[]),E(fm,"_userInteractionRegistered",!1),fm);let Wr=Js;ch([Re()],Wr.prototype,"clip",2);ch([Re()],Wr.prototype,"playOnAwake",2);ch([Re()],Wr.prototype,"loop",1);ch([Re()],Wr.prototype,"spatialBlend",1);ch([Re()],Wr.prototype,"minDistance",1);ch([Re()],Wr.prototype,"maxDistance",1);ch([Re()],Wr.prototype,"volume",1);ch([Re()],Wr.prototype,"rollOffMode",2);class ig extends Bt{constructor(){super(...arguments);E(this,"_listener",null)}get listener(){return this._listener==null&&(this._listener=new HC),this._listener}awake(){Wr.registerWaitForAllowAudio(()=>{const t=this.listener;if(t==null||t.parent)return;const n=Te.getComponentInParent(this.gameObject,Us);n?n.cam.add(t):this.gameObject.add(t)})}}var jD={exports:{}},qD={exports:{}};(function(){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e={rotl:function(t,n){return t<<n|t>>>32-n},rotr:function(t,n){return t<<32-n|t>>>n},endian:function(t){if(t.constructor==Number)return e.rotl(t,8)&16711935|e.rotl(t,24)&4278255360;for(var n=0;n<t.length;n++)t[n]=e.endian(t[n]);return t},randomBytes:function(t){for(var n=[];t>0;t--)n.push(Math.floor(Math.random()*256));return n},bytesToWords:function(t){for(var n=[],i=0,r=0;i<t.length;i++,r+=8)n[r>>>5]|=t[i]<<24-r%32;return n},wordsToBytes:function(t){for(var n=[],i=0;i<t.length*32;i+=8)n.push(t[i>>>5]>>>24-i%32&255);return n},bytesToHex:function(t){for(var n=[],i=0;i<t.length;i++)n.push((t[i]>>>4).toString(16)),n.push((t[i]&15).toString(16));return n.join("")},hexToBytes:function(t){for(var n=[],i=0;i<t.length;i+=2)n.push(parseInt(t.substr(i,2),16));return n},bytesToBase64:function(t){for(var n=[],i=0;i<t.length;i+=3)for(var r=t[i]<<16|t[i+1]<<8|t[i+2],o=0;o<4;o++)i*8+o*6<=t.length*8?n.push(a.charAt(r>>>6*(3-o)&63)):n.push("=");return n.join("")},base64ToBytes:function(t){t=t.replace(/[^A-Z0-9+\/]/ig,"");for(var n=[],i=0,r=0;i<t.length;r=++i%4)r!=0&&n.push((a.indexOf(t.charAt(i-1))&Math.pow(2,-2*r+8)-1)<<r*2|a.indexOf(t.charAt(i))>>>6-r*2);return n}};qD.exports=e})();var IE={utf8:{stringToBytes:function(a){return IE.bin.stringToBytes(unescape(encodeURIComponent(a)))},bytesToString:function(a){return decodeURIComponent(escape(IE.bin.bytesToString(a)))}},bin:{stringToBytes:function(a){for(var e=[],t=0;t<a.length;t++)e.push(a.charCodeAt(t)&255);return e},bytesToString:function(a){for(var e=[],t=0;t<a.length;t++)e.push(String.fromCharCode(a[t]));return e.join("")}}},TP=IE;/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var $J=function(a){return a!=null&&(XD(a)||eZ(a)||!!a._isBuffer)};function XD(a){return!!a.constructor&&typeof a.constructor.isBuffer=="function"&&a.constructor.isBuffer(a)}function eZ(a){return typeof a.readFloatLE=="function"&&typeof a.slice=="function"&&XD(a.slice(0,0))}(function(){var a=qD.exports,e=TP.utf8,t=$J,n=TP.bin,i=function(r,o){r.constructor==String?o&&o.encoding==="binary"?r=n.stringToBytes(r):r=e.stringToBytes(r):t(r)?r=Array.prototype.slice.call(r,0):!Array.isArray(r)&&r.constructor!==Uint8Array&&(r=r.toString());for(var l=a.bytesToWords(r),h=r.length*8,u=1732584193,f=-271733879,g=-1732584194,m=271733878,A=0;A<l.length;A++)l[A]=(l[A]<<8|l[A]>>>24)&16711935|(l[A]<<24|l[A]>>>8)&4278255360;l[h>>>5]|=128<<h%32,l[(h+64>>>9<<4)+14]=h;for(var v=i._ff,w=i._gg,b=i._hh,S=i._ii,A=0;A<l.length;A+=16){var R=u,M=f,I=g,T=m;u=v(u,f,g,m,l[A+0],7,-680876936),m=v(m,u,f,g,l[A+1],12,-389564586),g=v(g,m,u,f,l[A+2],17,606105819),f=v(f,g,m,u,l[A+3],22,-1044525330),u=v(u,f,g,m,l[A+4],7,-176418897),m=v(m,u,f,g,l[A+5],12,1200080426),g=v(g,m,u,f,l[A+6],17,-1473231341),f=v(f,g,m,u,l[A+7],22,-45705983),u=v(u,f,g,m,l[A+8],7,1770035416),m=v(m,u,f,g,l[A+9],12,-1958414417),g=v(g,m,u,f,l[A+10],17,-42063),f=v(f,g,m,u,l[A+11],22,-1990404162),u=v(u,f,g,m,l[A+12],7,1804603682),m=v(m,u,f,g,l[A+13],12,-40341101),g=v(g,m,u,f,l[A+14],17,-1502002290),f=v(f,g,m,u,l[A+15],22,1236535329),u=w(u,f,g,m,l[A+1],5,-165796510),m=w(m,u,f,g,l[A+6],9,-1069501632),g=w(g,m,u,f,l[A+11],14,643717713),f=w(f,g,m,u,l[A+0],20,-373897302),u=w(u,f,g,m,l[A+5],5,-701558691),m=w(m,u,f,g,l[A+10],9,38016083),g=w(g,m,u,f,l[A+15],14,-660478335),f=w(f,g,m,u,l[A+4],20,-405537848),u=w(u,f,g,m,l[A+9],5,568446438),m=w(m,u,f,g,l[A+14],9,-1019803690),g=w(g,m,u,f,l[A+3],14,-187363961),f=w(f,g,m,u,l[A+8],20,1163531501),u=w(u,f,g,m,l[A+13],5,-1444681467),m=w(m,u,f,g,l[A+2],9,-51403784),g=w(g,m,u,f,l[A+7],14,1735328473),f=w(f,g,m,u,l[A+12],20,-1926607734),u=b(u,f,g,m,l[A+5],4,-378558),m=b(m,u,f,g,l[A+8],11,-2022574463),g=b(g,m,u,f,l[A+11],16,1839030562),f=b(f,g,m,u,l[A+14],23,-35309556),u=b(u,f,g,m,l[A+1],4,-1530992060),m=b(m,u,f,g,l[A+4],11,1272893353),g=b(g,m,u,f,l[A+7],16,-155497632),f=b(f,g,m,u,l[A+10],23,-1094730640),u=b(u,f,g,m,l[A+13],4,681279174),m=b(m,u,f,g,l[A+0],11,-358537222),g=b(g,m,u,f,l[A+3],16,-722521979),f=b(f,g,m,u,l[A+6],23,76029189),u=b(u,f,g,m,l[A+9],4,-640364487),m=b(m,u,f,g,l[A+12],11,-421815835),g=b(g,m,u,f,l[A+15],16,530742520),f=b(f,g,m,u,l[A+2],23,-995338651),u=S(u,f,g,m,l[A+0],6,-198630844),m=S(m,u,f,g,l[A+7],10,1126891415),g=S(g,m,u,f,l[A+14],15,-1416354905),f=S(f,g,m,u,l[A+5],21,-57434055),u=S(u,f,g,m,l[A+12],6,1700485571),m=S(m,u,f,g,l[A+3],10,-1894986606),g=S(g,m,u,f,l[A+10],15,-1051523),f=S(f,g,m,u,l[A+1],21,-2054922799),u=S(u,f,g,m,l[A+8],6,1873313359),m=S(m,u,f,g,l[A+15],10,-30611744),g=S(g,m,u,f,l[A+6],15,-1560198380),f=S(f,g,m,u,l[A+13],21,1309151649),u=S(u,f,g,m,l[A+4],6,-145523070),m=S(m,u,f,g,l[A+11],10,-1120210379),g=S(g,m,u,f,l[A+2],15,718787259),f=S(f,g,m,u,l[A+9],21,-343485551),u=u+R>>>0,f=f+M>>>0,g=g+I>>>0,m=m+T>>>0}return a.endian([u,f,g,m])};i._ff=function(r,o,l,h,u,f,g){var m=r+(o&l|~o&h)+(u>>>0)+g;return(m<<f|m>>>32-f)+o},i._gg=function(r,o,l,h,u,f,g){var m=r+(o&h|l&~h)+(u>>>0)+g;return(m<<f|m>>>32-f)+o},i._hh=function(r,o,l,h,u,f,g){var m=r+(o^l^h)+(u>>>0)+g;return(m<<f|m>>>32-f)+o},i._ii=function(r,o,l,h,u,f,g){var m=r+(l^(o|~h))+(u>>>0)+g;return(m<<f|m>>>32-f)+o},i._blocksize=16,i._digestsize=16,jD.exports=function(r,o){if(r==null)throw new Error("Illegal argument "+r);var l=a.wordsToBytes(i(r,o));return o&&o.asBytes?l:o&&o.asString?n.bytesToString(l):a.bytesToHex(l)}})();class IP{constructor(e,t,n,i){E(this,"success");E(this,"filename");E(this,"hash");E(this,"size");E(this,"url");this.success=e,this.filename=t,this.hash=n,this.size=i}}async function tZ(a,e){const t=await a.arrayBuffer(),n=YD(t),i=a.name.split(".").pop(),r=n+"."+i,o=a.name.split(".").shift();console.assert(o!==void 0);const l={alias:o,filename:r},u=await(await fetch(e+"/exists",{method:"POST",body:JSON.stringify(l)})).json();if(u.success||console.warn("exists check did fail"),u.exists)return console.log("file already exists",n),new IP(!0,r,n,a.size);console.log("begin uploading file",o,a.size);const f=new FormData;f.append("file",a);const g={};g.filesize=a.size,o&&(g.alias=o);const A=await(await fetch(e+"/upload/file",{method:"POST",body:f,headers:g})).json();if((A==null?void 0:A.success)===!1)return A.message!==void 0?console.error("Upload failed:",A.message):console.error("Upload failed"),null;console.assert(A.hash_sum===n,"hash sum did not match","received:",A.hash_sum,"expected:",n),A.success&&console.log("successfully uploaded",n,A.id);const v=new IP(A.success,r,n,a.size);return v.url=e,v}function YD(a){return jD.exports(new Uint8Array(a))}async function JD(a,e,t,n,i=!1){try{const r=await fetch(n+"/download/file",{method:"POST",body:a});if(r.status!==200)return console.error("download failed",r),null;const o=await r.blob(),l=await o.arrayBuffer();i||console.assert(o.size===t,"size mismatch","expected:",t,"got:",o.size);const h=YD(l);return i||console.assert(h===e,"hash mismatch, downloaded file is invalid"),o.arrayBuffer()}catch(r){console.error(r)}return null}async function nZ(a,e){var f;const t=await fetch(a),n=(f=t.body)==null?void 0:f.getReader(),i=t.headers.get("Content-Length"),r=i?parseInt(i):0;if(!n)return null;let o=0,l=[];for(;;){const{done:g,value:m}=await n.read();if(m&&(l.push(m),o+=m.length,e.call(null,new ProgressEvent("progress",{loaded:o,total:r}))),g)break}const h=new Uint8Array(o);let u=0;for(let g of l)h.set(g,u),u+=g.length;return h}const om=jt("debugavatar");class AS{constructor(e,t,n,i){E(this,"root");E(this,"head");E(this,"leftHand");E(this,"rigthHand");var r;this.root=e,this.head=t,this.leftHand=n,this.rigthHand=i,(r=this.root)==null||r.traverse(o=>o.layers.set(2))}get isValid(){return this.head!==null&&this.head!==void 0}}class _S{constructor(){E(this,"avatarRegistryUrl",null)}async getOrCreateNewAvatarInstance(e,t){if(!t)return console.error("Can not create avatar: failed to provide id or root object"),null;let n=null;if(typeof t=="string"){if(n=await this.loadAvatar(e,t),!n){const r=new Fo;n=Te.instantiate(wf(t,e.scene),r)}}else n=t;if(!n)return null;const i=this.findAvatar(n);return i.isValid?(om&&console.log("[Custom Avatar] valid config",t,om?i:""),i):(console.warn("[Custom Avatar] config isn't valid",t,om?i:""),null)}async loadAvatar(e,t){var i;if(console.assert(t!=null&&typeof t=="string","Avatar id must not be null"),t.length<=0||!t)return null;if(om&&console.log("[Custom Avatar] "+t+", loading..."),t.endsWith(".glb")||(t+=".glb"),this.avatarRegistryUrl===null){const r=await fetch("./"+t);let o=null;if(r.ok){const h=await r.blob();h&&(o=await h.arrayBuffer())}if(!o&&(o=await JD(t,t,0,"no url here go away",!0),!o))return null;const l=await zv(e,o,null,0);return(i=l==null?void 0:l.scene)!=null?i:null}const n=new Df;return Xy(n,e),new Promise((r,o)=>{const l=this.avatarRegistryUrl+"/"+t;n.load(l,async h=>{await aF(e,l,h),r(h.scene)},h=>{om&&console.log("[Custom Avatar] "+h.loaded/h.total*100+"% loaded of "+h.total/1024+"kB")},h=>{console.error("[Custom Avatar] Error when loading: "+h),r(null)})})}cacheModel(e,t){}findAvatar(e){const t=e;let n=t;n.children.length==1&&(n=e.children[0]);let i=this.findAvatarPart(n,["head"]);const r=this.findAvatarPart(n,["left","hand"]),o=this.findAvatarPart(n,["right","hand"]);if(!i){i=t;const h=new q;new Mr().setFromObject(i).getSize(h);const u=Math.max(h.x,h.y,h.z);console.warn("[Custom Avatar] Normalizing head scale, it's too big: "+u+" meters! Should be < 0.3m"),u>.3&&i.scale.multiplyScalar(1/u*.3)}return new AS(t,i,r,o)}findAvatarPart(e,t){const n=e.name.toLowerCase();let i=!0;for(const r of t){if(!i)break;n.indexOf(r)===-1&&(i=!1)}if(i)return e;if(e.children)for(const r of e.children){const o=this.findAvatarPart(r,t);if(o)return o}return null}handleCustomAvatarErrors(e){if(!e.ok)throw Error(e.statusText);return e}}var iZ=Object.defineProperty,sZ=Object.getOwnPropertyDescriptor,yS=(a,e,t,n)=>{for(var i=n>1?void 0:n?sZ(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&iZ(e,t,i),i};class Ng extends Bt{constructor(){super(...arguments);E(this,"length",1);E(this,"depthTest",!0);E(this,"isGizmo",!0);E(this,"_axes",null)}onEnable(){if(this.isGizmo&&!Fg)return;this._axes||(this._axes=new Lg(this.length)),this.gameObject.add(this._axes);const t=this._axes.material;t&&t.depthTest!==void 0&&(t.depthTest=this.depthTest)}onDisable(){!this._axes||this.gameObject.remove(this._axes)}}yS([Re()],Ng.prototype,"length",2);yS([Re()],Ng.prototype,"depthTest",2);yS([Re()],Ng.prototype,"isGizmo",2);class ZD extends Bt{constructor(){super(...arguments);E(this,"from");E(this,"to");E(this,"hint");E(this,"desiredDistance",1)}onEnable(){}update(){if(!this.from||!this.to||!this.hint)return;let t=ti(this.to).clone(),n=ti(this.from).clone(),i=t.distanceTo(n),r=t.clone();r.sub(n);let o=n.clone();o.add(t),o.multiplyScalar(.5);let l=ti(this.hint).clone();l.sub(o);let h=new q;h.crossVectors(l,r),h.crossVectors(r,h),h.normalize();let u=i*.5,f=Math.max(this.desiredDistance,u),g=Math.sqrt(f*f-u*u),m=h.clone();m.multiplyScalar(g),m.add(o),ys(this.gameObject,m);let A=o.clone();A.sub(h),this.gameObject.lookAt(A)}}const rZ=new Ui(1,1,1);function KD(a=null){const e=new _e(a!=null?a:14540253),t=new RC(rZ);return new zo(t,new Is({color:e}))}const oZ=jt("gizmos"),vy=class extends Bt{constructor(){super(...arguments);E(this,"box",null);E(this,"testBox",new Mr);E(this,"_lastMatrixUpdateFrame",-1);E(this,"_helper",null);E(this,"_color",null)}isInBox(t){var n;if(!!t){if(this.box||(this.box=new Mr),this.updateBox(!1),t.type==="Mesh")this.testBox.setFromObject(t);else{const i=ti(t,vy._position),r=kq(t,vy._size);this.testBox.setFromCenterAndSize(i,r)}return(n=this.box)==null?void 0:n.intersectsBox(this.testBox)}}intersects(t){return t?this.updateBox(!1).intersectsBox(t):!1}updateBox(t=!1){return this.box||(this.box=new Mr),(t||this.context.time.frameCount!=this._lastMatrixUpdateFrame)&&(this._lastMatrixUpdateFrame=this.context.time.frameCount,this.box.setFromCenterAndSize(new q(0,0,0),new q(1,1,1)),this.box.applyMatrix4(this.gameObject.matrixWorld)),this.box}awake(){this._helper=null,this._color=null,this.box=null}showHelper(t=null,n=!1){var i;if(!(!oZ&&!n)){if(this._helper){t&&((i=this._color)==null||i.set(t)),this.gameObject.add(this._helper);return}this._helper=KD(t),this.gameObject.add(this._helper)}}};let Ic=vy;E(Ic,"_position",new q),E(Ic,"_size",new q(.01,.01,.01));function ry(a,e){var n,i;if(!a)return;const t=a.material;(t==null?void 0:t.isMaterial)===!0&&(t.depthTest=!e.renderOnTop,t.side=(n=e.doubleSided)==null||n?er:Oo,t.depthWrite=(i=e.depthWrite)!=null?i:!1,t.shadowSide=e.doubleSided?er:Oo,a.castShadow=e.castShadows?e.castShadows:!1,a.receiveShadow=e.receiveShadows?e.receiveShadows:!1);for(const r of a.children)ry(r,e)}function vS(a,e,t){a[e]===void 0&&console.warn("Field",e,"is undefined on",a);const n=Proxy.revocable(a[e],{set(o,l,h,u){const f=o[l],g=Reflect.set(o,l,h,u);return t(h,f),g}}),i=n.revoke,r=a[e];return n.revoke=()=>{a[e]=r,i()},a[e]=n.proxy,n}function aZ(a,e,t=No.OnBeforeRender){let n=a.__scheduledActions;n||(n=a.__scheduledActions={});const i=e.name;n[t]||(n[t]={});const r=n[t];if(r[i])return;function*l(){e==null||e.call(a),r[i]=null}const h=a.startCoroutine(l(),t);r[i]=h}var cZ=Object.defineProperty,lZ=Object.getOwnPropertyDescriptor,kf=(a,e,t,n)=>{for(var i=n>1?void 0:n?lZ(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&cZ(e,t,i),i},A_;const Am=(A_=class extends Bt{constructor(){super(...arguments);E(this,"mass",1);E(this,"_isKinematic",!1);E(this,"drag",0);E(this,"angularDrag",1);E(this,"detectCollision",!0);E(this,"sleepThreshold",.01);E(this,"_body",null);E(this,"currentVelocity");E(this,"_smoothedVelocity");E(this,"lastWorldPosition");E(this,"dirty",!0);E(this,"transformProxy")}set isKinematic(e){this._isKinematic=e,this._body&&(this._body.type=e?en.KINEMATIC:en.DYNAMIC)}get isKinematic(){return this._isKinematic}get body(){return this._body===null&&this.initialize(),this._body}awake(){this._body=null,this.currentVelocity=new q,this._smoothedVelocity=new q,this.lastWorldPosition=ti(this.gameObject).clone()}start(){this.setBodyFromGameObject()}onEnable(){this._body?this.context.physics.addBody(this.gameObject,this._body):this.initialize(),this.body&&(this.body.wakeUp(),this.gameObject.updateWorldMatrix(!0,!1),this.setBodyFromGameObject()),this.transformProxy=vS(this.gameObject.matrix,"elements",()=>{this.context.physics.isUpdating||(this.dirty=!0)})}onDisable(){var e;(e=this.transformProxy)==null||e.revoke(),this._body&&this.context.physics.removeBody(this.gameObject,this._body,!1)}onDestroy(){this._body&&this.context.physics.removeBody(this.gameObject,this._body)}earlyUpdate(){this.dirty&&this.setBodyFromGameObject()}onBeforeRender(){this.updateVelocity()}initialize(){if(this._body)return;const e=new X7;e.drag=this.drag,e.angularDrag=this.angularDrag,e.mass=this.mass,e.kinematic=this.isKinematic,e.physicsEvents=this.detectCollision,e.sleepThreshold=this.sleepThreshold,this._body=this.context.physics.createBody(this.gameObject,e)}wakeUp(){var e;(e=this.body)==null||e.wakeUp()}applyForce(e,t){var n;(n=this.body)==null||n.applyForce(new re(e.x,e.y,e.z),t?new re(t.x,t.y,t.z):void 0)}getVelocity(){var e,t,n;return this.body?Am.tempPosition.set((e=this.body)==null?void 0:e.velocity.x,(t=this.body)==null?void 0:t.velocity.y,(n=this.body)==null?void 0:n.velocity.z):Am.tempPosition.set(0,0,0)}setVelocity(e,t,n){!this.body||(this.body.velocity.x=e/this.context.time.deltaTime,this.body.velocity.y=t/this.context.time.deltaTime,this.body.velocity.z=n/this.context.time.deltaTime)}get smoothedVelocity(){return this._smoothedVelocity}setAngularVelocity(e,t,n){!this.body||(this.body.angularVelocity.x=e/this.context.time.deltaTime,this.body.angularVelocity.y=t/this.context.time.deltaTime,this.body.angularVelocity.z=n/this.context.time.deltaTime)}setBodyFromGameObject(e=null){if(this.dirty=!1,this.body&&this.gameObject&&!this.destroyed){const t=this.worldPosition;this.body.position.set(t.x,t.y,t.z);const n=this.worldQuaternion;if(this.body.quaternion.set(n.x,n.y,n.z,n.w),e){Am.copyVector3.set(e.x,e.y,e.z),this._smoothedVelocity.lerp(Am.copyVector3,this.context.time.deltaTime/.1);const i=this._smoothedVelocity;this.body.velocity.x=i.x,this.body.velocity.y=i.y,this.body.velocity.z=i.z}}}updateVelocity(){if(!!this.currentVelocity&&this.body&&this.gameObject){const e=ti(this.gameObject);this.currentVelocity.subVectors(e,this.lastWorldPosition),this.lastWorldPosition.copy(e),this._smoothedVelocity.lerp(this.currentVelocity,this.context.time.deltaTime/.1)}}},E(A_,"tempPosition",new q),E(A_,"copyVector3",new q),A_);let Tr=Am;kf([Re()],Tr.prototype,"mass",2);kf([Re()],Tr.prototype,"isKinematic",1);kf([Re()],Tr.prototype,"drag",2);kf([Re()],Tr.prototype,"angularDrag",2);kf([Re()],Tr.prototype,"detectCollision",2);kf([Re()],Tr.prototype,"sleepThreshold",2);var hZ=Object.defineProperty,uZ=Object.getOwnPropertyDescriptor,Nf=(a,e,t,n)=>{for(var i=n>1?void 0:n?uZ(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&hZ(e,t,i),i};class Uf extends Bt{constructor(){super(...arguments);E(this,"attachedRigidbody",null);E(this,"isTrigger",!1);E(this,"_shape",null)}awake(){super.awake(),this._shape=null}onEnable(){this.attachedRigidbody||(this.attachedRigidbody=this.gameObject.getComponentInParent(Tr))}onDisable(){this._shape}}Nf([Re(Tr)],Uf.prototype,"attachedRigidbody",2);Nf([Re()],Uf.prototype,"isTrigger",2);class ov extends Uf{constructor(){super(...arguments);E(this,"radius",.5);E(this,"center",new q(0,0,0))}onEnable(){super.onEnable(),this._shape||(this._shape=this.context.physics.addSphereCollider(this.gameObject,this.center,this.radius,this.attachedRigidbody))}}Nf([Re()],ov.prototype,"radius",2);Nf([Re(q)],ov.prototype,"center",2);class av extends Uf{constructor(){super(...arguments);E(this,"size");E(this,"center")}onEnable(){super.onEnable(),this._shape||(this._shape=this.context.physics.addBoxCollider(this.gameObject,this.isTrigger,this.center,this.size,this.attachedRigidbody))}}Nf([Re(q)],av.prototype,"size",2);Nf([Re(q)],av.prototype,"center",2);class $D{}class Ug extends Bt{constructor(){super(...arguments);E(this,"canGrab",!0)}onPointerClick(t){}}class zg extends Bt{constructor(){super(...arguments);E(this,"isUsed",!0);E(this,"usedBy",null)}}class xS extends Ic{}class eO extends Bt{constructor(){super(...arguments);E(this,"deleteBoxes",[])}awake(){this.deleteBoxes=Te.findObjectsOfType(xS,this.context)}update(){for(const t of this.deleteBoxes){const n=this.gameObject;t.isInBox(n)===!0&&(Te.getComponentInParent(this.gameObject,zg)||eS(this.gameObject,this.context.connection))}}}var dZ=Object.defineProperty,fZ=Object.getOwnPropertyDescriptor,pZ=(a,e,t,n)=>{for(var i=n>1?void 0:n?fZ(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&dZ(e,t,i),i};class wS extends Bt{constructor(){super(...arguments);E(this,"visibleOn")}onEnable(){this.apply()}apply(){this.test()||Te.setActive(this.gameObject,!1)}test(){return this.visibleOn<0?!0:mZ()?(this.visibleOn&2)!==0:(this.visibleOn&1)!==0}}pZ([Re()],wS.prototype,"visibleOn",2);let c_;function mZ(){if(c_===!0||c_===!1)return c_;let a=!1;return function(e){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(a=!0)}(navigator.userAgent||navigator.vendor||window.opera),c_=a,a}class co{constructor(){E(this,"bb",null);E(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}x(){return this.bb.readFloat32(this.bb_pos)}y(){return this.bb.readFloat32(this.bb_pos+4)}z(){return this.bb.readFloat32(this.bb_pos+8)}static sizeOf(){return 12}static createVec3(e,t,n,i){return e.prep(4,12),e.writeFloat32(i),e.writeFloat32(n),e.writeFloat32(t),e.offset()}}class tO{constructor(){E(this,"bb",null);E(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}position(e){return(e||new co).__init(this.bb_pos,this.bb)}rotation(e){return(e||new co).__init(this.bb_pos+12,this.bb)}scale(e){return(e||new co).__init(this.bb_pos+24,this.bb)}static sizeOf(){return 36}static createTransform(e,t,n,i,r,o,l,h,u,f){return e.prep(4,36),e.prep(4,12),e.writeFloat32(f),e.writeFloat32(u),e.writeFloat32(h),e.prep(4,12),e.writeFloat32(l),e.writeFloat32(o),e.writeFloat32(r),e.prep(4,12),e.writeFloat32(i),e.writeFloat32(n),e.writeFloat32(t),e.offset()}}class Mc{constructor(){E(this,"bb",null);E(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsSyncedTransformModel(e,t){return(t||new Mc).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsSyncedTransformModel(e,t){return e.setPosition(e.position()+tv),(t||new Mc).__init(e.readInt32(e.position())+e.position(),e)}guid(e){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}fast(){const e=this.bb.__offset(this.bb_pos,6);return e?!!this.bb.readInt8(this.bb_pos+e):!1}transform(e){const t=this.bb.__offset(this.bb_pos,8);return t?(e||new tO).__init(this.bb_pos+t,this.bb):null}dontSave(){const e=this.bb.__offset(this.bb_pos,10);return e?!!this.bb.readInt8(this.bb_pos+e):!1}static startSyncedTransformModel(e){e.startObject(4)}static addGuid(e,t){e.addFieldOffset(0,t,0)}static addFast(e,t){e.addFieldInt8(1,+t,0)}static addTransform(e,t){e.addFieldStruct(2,t,0)}static addDontSave(e,t){e.addFieldInt8(3,+t,0)}static endSyncedTransformModel(e){return e.endObject()}static finishSyncedTransformModelBuffer(e,t){e.finish(t)}static finishSizePrefixedSyncedTransformModelBuffer(e,t){e.finish(t,void 0,!0)}}const Cl=jt("debugsync"),sg="STRS";uS(sg,Mc.getRootAsSyncedTransformModel);const Ea=new Of;function nO(a,e,t=!0){Ea.clear();const n=Ea.createString(a);Mc.startSyncedTransformModel(Ea),Mc.addGuid(Ea,n),Mc.addFast(Ea,t);const i=e.worldPosition,r=e.worldEuler,o=e.gameObject.scale;Mc.addTransform(Ea,tO.createTransform(Ea,i.x,i.y,i.z,r.x,r.y,r.z,o.x,o.y,o.z));const l=Mc.endSyncedTransformModel(Ea);return Ea.finish(l,sg),Ea.asUint8Array()}class $l extends Bt{constructor(){super(...arguments);E(this,"overridePhysics",!0);E(this,"interpolatePosition",!0);E(this,"interpolateRotation",!0);E(this,"fastMode",!1);E(this,"syncDestroy",!1);E(this,"_model",null);E(this,"_needsUpdate",!0);E(this,"rb",null);E(this,"_wasKinematic",!1);E(this,"_receivedDataBefore",!1);E(this,"_targetPosition");E(this,"_targetRotation");E(this,"_receivedFastUpdate",!1);E(this,"_shouldRequestOwnership",!1);E(this,"joinedRoomCallback",null);E(this,"receivedDataCallback",null);E(this,"tempEuler",new vs);E(this,"receivedUpdate",!1);E(this,"lastWorldPos");E(this,"lastWorldRotation")}requestOwnership(){Cl&&console.log("Request ownership"),this._model?this._model.requestOwnership():(this._shouldRequestOwnership=!0,this._needsUpdate=!0)}hasOwnership(){var t,n;return(n=(t=this._model)==null?void 0:t.hasOwnership)!=null?n:void 0}isOwned(){var t;return(t=this._model)==null?void 0:t.isOwned}awake(){Cl&&console.log("new instance",this.guid,this),this._receivedDataBefore=!1,this._targetPosition=new q,this._targetRotation=new Ot,this.lastWorldPos=new q,this.lastWorldRotation=new Ot,this.rb=Te.getComponentInChildren(this.gameObject,Tr),this.rb&&(this._wasKinematic=this.rb.isKinematic),this.receivedUpdate=!0,this._model=new dS(this.context.connection,this.guid),this.context.connection.isConnected&&this.tryGetLastState(),this.joinedRoomCallback=this.tryGetLastState.bind(this),this.context.connection.beginListen(ha.JoinedRoom,this.joinedRoomCallback),this.receivedDataCallback=this.onReceivedData.bind(this),this.context.connection.beginListenBinrary(sg,this.receivedDataCallback)}onDestroy(){this.syncDestroy&&e9(this.guid,this.context.connection),this._model=null,this.context.connection.stopListening(ha.JoinedRoom,this.joinedRoomCallback),this.context.connection.stopListenBinary(sg,this.receivedDataCallback)}tryGetLastState(){const t=this.context.connection.tryGetState(this.guid);t&&this.onReceivedData(t)}onReceivedData(t){var n;if(!this.destroyed&&typeof t.guid=="function"&&t.guid()===this.guid){Cl&&console.log("new data",this.context.connection.connectionId,this.context.time.frameCount,this.guid,t),this.receivedUpdate=!0,this._receivedFastUpdate=t.fast();const i=t.transform();if(i){ro.markDirty(this.gameObject,!0);const r=i.position();r&&(this.interpolatePosition&&((n=this._targetPosition)==null||n.set(r.x(),r.y(),r.z())),(!this.interpolatePosition||!this._receivedDataBefore)&&this.setWorldPosition(r.x(),r.y(),r.z()));const o=i.rotation();o&&(this.tempEuler.set(o.x(),o.y(),o.z()),this.interpolateRotation&&this._targetRotation.setFromEuler(this.tempEuler),(!this.interpolateRotation||!this._receivedDataBefore)&&zq(this.gameObject,this.tempEuler))}this._receivedDataBefore=!0}}onEnable(){this.lastWorldPos.copy(this.worldPosition),this.lastWorldRotation.copy(this.worldQuaternion),this._needsUpdate=!0,this._model&&this._model.updateIsOwned()}onDisable(){this._model&&this._model.freeOwnership()}onBeforeRender(){var o;if(!this.activeAndEnabled||!this.context.connection.isConnected)return;if(!this.context.connection.isInRoom||!this._model){Cl&&console.log("no model or room",this.name,this.guid,this.context.connection.isInRoom);return}this._shouldRequestOwnership&&(this._shouldRequestOwnership=!1,this._model.requestOwnership());let t=this.worldPosition,n=this.worldQuaternion;if(this._model.isOwned&&!this.receivedUpdate){const l=t.distanceTo(this.lastWorldPos),h=n.angleTo(this.lastWorldRotation),u=this._model.hasOwnership||this.fastMode?1e-4:.001;(l>u||h>u)&&(this._model.hasOwnership?this._needsUpdate=!0:(Cl&&console.log(this.guid,"reset because not owned but",this.gameObject.name,this.lastWorldPos),this.worldPosition=this.lastWorldPos,t.copy(this.lastWorldPos),this.worldQuaternion=this.lastWorldRotation,n.copy(this.lastWorldRotation),ro.markDirty(this.gameObject,!0),this._needsUpdate=!1))}if(this._model&&!this._model.hasOwnership&&this._model.isOwned&&this._receivedDataBefore){const h=this._receivedFastUpdate||this.fastMode?.5:.3;let u=!1;if(this.interpolatePosition&&this._targetPosition){const f=this.worldPosition;f.lerp(this._targetPosition,h),this.worldPosition=f,u=!0}if(this.interpolateRotation&&this._targetRotation){const f=this.worldQuaternion;f.slerp(this._targetRotation,h),this.worldQuaternion=f,u=!0}u&&ro.markDirty(this.gameObject,!0)}if(this.receivedUpdate=!1,this.lastWorldPos.copy(t),this.lastWorldRotation.copy(n),!this._model)return;if(!this._model||this._model.hasOwnership===void 0||!this._model.hasOwnership){this.rb&&(this.rb.isKinematic=(o=this._model.isOwned)!=null?o:!1,this.rb.setVelocity(0,0,0),this.rb.setBodyFromGameObject());return}this.rb&&(this._wasKinematic!==void 0&&(Cl&&console.log("reset kinematic",this.rb.name,this._wasKinematic),this.rb.isKinematic=this._wasKinematic),this.gameObject.position.distanceTo(new q(0,0,0))>1e3&&(Cl&&console.log("RESET",this.name),this.gameObject.position.set(0,1,0),this.rb.setVelocity(0,0,0),this.rb.setBodyFromGameObject()));const i=10,r=this.rb||this.fastMode;if(this._needsUpdate&&(this.context.time.frameCount%i===0||r)){Cl&&console.log("send update",this.context.connection.connectionId,this.guid,this.gameObject.name,this.gameObject.guid),this.overridePhysics&&this.rb&&this.rb.setBodyFromGameObject(),this._needsUpdate=!1;const l=nO(this.guid,this,!!r);this.context.connection.sendBinary(l)}}}class gZ{static createButton(e,t={}){const n=document.createElement("button");function i(){if(t.domOverlay===void 0){var h=document.createElement("div");h.style.display="none",document.body.appendChild(h);var u=document.createElementNS("http://www.w3.org/2000/svg","svg");u.setAttribute("width",38),u.setAttribute("height",38),u.style.position="absolute",u.style.right="20px",u.style.top="20px",u.addEventListener("click",function(){g.end()}),h.appendChild(u);var f=document.createElementNS("http://www.w3.org/2000/svg","path");f.setAttribute("d","M 12,12 L 28,28 M 28,12 12,28"),f.setAttribute("stroke","#fff"),f.setAttribute("stroke-width",2),u.appendChild(f),t.optionalFeatures===void 0&&(t.optionalFeatures=[]),t.optionalFeatures.push("dom-overlay"),t.domOverlay={root:h}}t.optionalFeatures===void 0&&(t.optionalFeatures=[]),t.optionalFeatures.push("local-floor"),t.optionalFeatures.push("hand-tracking"),t.optionalFeatures.push("layers");let g=null;async function m(v){v.addEventListener("end",A),await e.xr.setSession(v),n.textContent="STOP AR",t.domOverlay.root.style.display="",g=v}function A(){g.removeEventListener("end",A),n.textContent="START AR",t.domOverlay.root.style.display="none",g=null}n.style.display="",n.style.cursor="pointer",n.style.left="calc(50% - 50px)",n.style.width="100px",n.textContent="START AR",n.onmouseenter=function(){n.style.opacity="1.0"},n.onmouseleave=function(){n.style.opacity="0.5"},n.onclick=function(){g===null?navigator.xr.requestSession("immersive-ar",t).then(m):g.end()}}function r(){n.disabled=!0,n.style.display="",n.style.cursor="auto",n.style.left="calc(50% - 75px)",n.style.width="150px",n.onmouseenter=null,n.onmouseleave=null,n.onclick=null}function o(){r(),n.textContent="AR NOT SUPPORTED"}function l(h){h.style.position="absolute",h.style.bottom="20px",h.style.padding="12px 6px",h.style.border="1px solid #fff",h.style.borderRadius="4px",h.style.background="rgba(0,0,0,0.1)",h.style.color="#fff",h.style.font="normal 13px sans-serif",h.style.textAlign="center",h.style.opacity="0.5",h.style.outline="none",h.style.zIndex="999"}if("xr"in navigator)return n.id="ARButton",n.style.display="none",l(n),navigator.xr.isSessionSupported("immersive-ar").then(function(h){h?i():o()}).catch(o),n;{const h=document.createElement("a");return window.isSecureContext===!1?(h.href=document.location.href.replace(/^http:/,"https:"),h.innerHTML="WEBXR NEEDS HTTPS"):(h.href="https://immersiveweb.dev/",h.innerHTML="WEBXR NOT AVAILABLE"),h.style.left="calc(50% - 90px)",h.style.width="180px",h.style.textDecoration="none",l(h),h}}}const xy=class{static createButton(e,t){t&&console.error('THREE.VRButton: The "options" parameter has been removed. Please set the reference space type via renderer.xr.setReferenceSpaceType() instead.');const n=document.createElement("button");function i(){let h=null;async function u(g){g.addEventListener("end",f),await e.xr.setSession(g),n.textContent="EXIT VR",h=g}function f(){h.removeEventListener("end",f),n.textContent="ENTER VR",h=null}n.style.display="",n.style.cursor="pointer",n.style.left="calc(50% - 50px)",n.style.width="100px",n.textContent="ENTER VR",n.onmouseenter=function(){n.style.opacity="1.0"},n.onmouseleave=function(){n.style.opacity="0.5"},n.onclick=function(){if(h===null){const g={optionalFeatures:["local-floor","bounded-floor","hand-tracking","high-fixed-foveation-level","layers"]};navigator.xr.requestSession("immersive-vr",g).then(u)}else h.end()}}function r(){n.disabled=!0,n.style.display="",n.style.cursor="auto",n.style.left="calc(50% - 75px)",n.style.width="150px",n.onmouseenter=null,n.onmouseleave=null,n.onclick=null}function o(){r(),n.textContent="VR NOT SUPPORTED"}function l(h){h.style.position="absolute",h.style.bottom="20px",h.style.padding="12px 6px",h.style.border="1px solid #fff",h.style.borderRadius="4px",h.style.background="rgba(0,0,0,0.1)",h.style.color="#fff",h.style.font="normal 13px sans-serif",h.style.textAlign="center",h.style.opacity="0.5",h.style.outline="none",h.style.zIndex="999"}if("xr"in navigator)return n.id="VRButton",n.style.display="none",l(n),navigator.xr.isSessionSupported("immersive-vr").then(function(h){h?i():o(),xy.xrSessionIsGranted&&(console.log("XR session is granted - will enter immersive web now"),n.click())}),n;{const h=document.createElement("a");return window.isSecureContext===!1?(h.href=document.location.href.replace(/^http:/,"https:"),h.innerHTML="WEBXR NEEDS HTTPS"):(h.href="https://immersiveweb.dev/",h.innerHTML="WEBXR NOT AVAILABLE"),h.style.left="calc(50% - 90px)",h.style.width="180px",h.style.textDecoration="none",l(h),h}}static registerSessionGrantedListener(){if("xr"in navigator)try{navigator.xr.addEventListener("sessiongranted",()=>{console.log("Received session granted event"),xy.xrSessionIsGranted=!0})}catch(e){console.error(e)}}};let Pm=xy;E(Pm,"xrSessionIsGranted",!1);Pm.registerSessionGrantedListener();const oy="noVoip",Fr=jt("debugvoip"),AZ=jt("voip");class _Z{constructor(e){E(this,"id");this.id=e}}class yZ{constructor(e,t,n,i){E(this,"peer");E(this,"voip");E(this,"userId");E(this,"peerId");E(this,"call",null);E(this,"callErrorListener",null);E(this,"stream",null);this.voip=e,this.peer=t,this.userId=n,this.peerId=i}close(){var e;Fr&&console.log("close voip call"),this.callErrorListener&&this.peer.off("error",this.callErrorListener),this.call&&this.call.open&&this.call.close(),(e=this.stream)==null||e.getTracks().forEach(function(t){t.stop()})}updateMute(e){var n;if(!this.stream)return;const t=(n=this.stream)==null?void 0:n.getAudioTracks();for(const i of t)i.enabled=!e}async startVoipCall(){if(!await lh.HasMicrophonePermissions()){console.warn("no permission to use microphone, can not start call");return}Fr&&console.log("start voip call"),this.stream=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1}),this.updateMute(this.voip.muteOutput),Fr&&console.log(this.stream),this.call=this.peer.call(this.peerId,this.stream,{metadata:{userId:this.userId}}),this.call.on("error",t=>{console.error(t)}),this.call.on("stream",t=>{Fr&&console.log("received stream from remote again",t)}),this.peer.on("close",this.onCallClose.bind(this)),this.callErrorListener=t=>{var n;t.message.includes(this.peerId)?(console.log("Could not connect to "+this.peerId),this.callErrorListener&&this.peer.off("error",this.callErrorListener),this.call&&this.call.close(),(n=this.stream)==null||n.getTracks().forEach(function(i){i.stop()}),this.stream=null):console.error(t)},this.peer.on("error",this.callErrorListener)}onCallClose(e){Fr&&console.log("call closed",e)}}class vZ{constructor(e,t,n){E(this,"voip");E(this,"call");E(this,"audio",null);E(this,"stream",null);E(this,"obj");E(this,"analyzer",null);E(this,"waitingForStart",!1);E(this,"closed",!1);E(this,"audioElement",null);this.voip=e,this.obj=t,this.call=n}get currentStream(){return this.stream}get currentAudio(){return this.audio}get currentAnalyzer(){return this.analyzer}openAudioStream(e){const t=e.getAudioTracks();for(const n of t)if(n.kind==="audio"&&n.readyState==="live"){this.open(n);return}console.warn("failed finding valid audio stream to begin call")}open(e){console.assert(e.kind==="audio","invalid track kind, expected audio but received "+e.kind),!this.waitingForStart&&(this.waitingForStart=!0,Wr.userInteractionRegistered||Fr&&console.log("Incoming call, waiting for user interaction before opening audio"),Wr.registerWaitForAllowAudio(async()=>{if(this.call.open&&!this.closed){Fr&&console.log("Setup audio and begin listening"),this.stream=new MediaStream([e]);const t=new HC;this.audio=new Vy(t),this.audio.setVolume(this.voip.muteInput?0:1),this.audio.setMediaStreamSource(this.stream);const n=document.createElement("audio");this.audioElement=n,n.style.display="none",document.body.appendChild(n),n.srcObject=this.stream,n.sinkId!==void 0&&navigator.mediaDevices.enumerateDevices().then(i=>{if(!!n){console.log(i);for(const r of i)if(r.label==="Speakerphone"){n.sinkId=r.deviceId;break}}}),Fr&&console.log("call is setup, you should hear something now"),this.analyzer=new d2(this.audio,32)}}))}close(){var e,t,n;this.closed=!0,(e=this.call)!=null&&e.open&&this.call.close(),(t=this.audio)==null||t.disconnect(),(n=this.stream)==null||n.getTracks().forEach(i=>{i.stop()}),this.stream=null,this.audioElement&&this.audioElement.remove()}}class lh extends Bt{constructor(){super(...arguments);E(this,"requireParam",!1);E(this,"peer",null);E(this,"model",null);E(this,"connections",{});E(this,"currentIncomingCalls",{});E(this,"_inputMuted",!1);E(this,"_outputMuted",!1)}set muteInput(t){var i;if(t===this._inputMuted||(this._inputMuted=t,!this.currentIncomingCalls))return;const n=this._inputMuted?0:1;for(const r in this.currentIncomingCalls){const o=this.currentIncomingCalls[r];(i=o==null?void 0:o.currentAudio)==null||i.setVolume(n)}}get muteInput(){return this._inputMuted}set muteOutput(t){if(t!==this._outputMuted&&(this._outputMuted=t,!!this.connections))for(const n in this.connections){const i=this.connections[n];i==null||i.updateMute(t)}}get muteOutput(){return this._outputMuted}getFrequency(t){if(t===null){for(const i in this.currentIncomingCalls){const r=this.currentIncomingCalls[i];if(r&&r.currentAnalyzer)return r.currentAnalyzer.getAverageFrequency()}return null}const n=this.currentIncomingCalls[t];return n&&n.currentAnalyzer?n.currentAnalyzer.getAverageFrequency():null}awake(){if(jt(oy)){console.log("VOIP is disabled by url parameter: "+oy);return}if(this.requireParam&&!AZ){console.debug("VOIP must be enabled explicitly by url parameter");return}this.peer=new bE,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,this.context.connection.beginListen(ha.JoinedRoom,t=>{navigator.mediaDevices.getUserMedia({audio:!0,video:!1})}),this.context.connection.beginListen("peer-update-id",t=>{if(t.id!==this.context.connection.connectionId){const n=this.connections[t.id];if(n&&n.close(),this.peer&&this.context.connection.connectionId){const i=new yZ(this,this.peer,this.context.connection.connectionId,t.peerId);this.connections[t.id]=i,i.startVoipCall()}}}),this.context.connection.beginListen(ha.UserLeftRoom,t=>{const{userId:n}=t,i=this.connections[n];this.connections[n]=null,i&&i.close();const r=this.currentIncomingCalls[n];Fr&&console.log("UserLeftRoom",t,n,r),r&&(r.close(),this.currentIncomingCalls[n]=null)}),this.peer.on("open",this.onOpenPeerConnection.bind(this))}onEnable(){}onDisable(){console.log("TODO: close all");for(const t in this.currentIncomingCalls){const n=this.currentIncomingCalls[t];n==null||n.close();const i=this.connections[t];i==null||i.close()}}async onOpenPeerConnection(t){Fr&&console.log("Peer connection established and received id"),this.model=new _Z(t),this.context.connection.send("peer-update-id",this.model,ny.OnRoomJoin),this.peer&&(this.peer.on("call",this.onReceiveCall.bind(this)),this.peer.on("connection",function(n){Fr&&console.log("CONNECTION",n),n.on("data",function(i){Fr&&console.log("Received",i)})}))}async onReceiveCall(t){const{metadata:n}=t;console.assert(n.userId);const{userId:i}=n,r=this.currentIncomingCalls[i];if(r&&r.close(),Fr&&console.log("received call"),await lh.HasMicrophonePermissions()){const o=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1});t.answer(o)}else t.answer(null);this.currentIncomingCalls[i]=new vZ(this,this.gameObject,t),t.on("stream",o=>{var l;Fr&&console.log("receive caller stream, will setup audio now"),(l=this.currentIncomingCalls[i])==null||l.openAudioStream(o)}),t.on("error",console.error)}static async HasMicrophonePermissions(){return(await navigator.permissions.query({name:"microphone"})).state!=="denied"}}const Yd=jt("debugflags");var Cr=(a=>(a[a.Never=0]="Never",a[a.Browser=1]="Browser",a[a.AR=2]="AR",a[a.VR=4]="VR",a[a.FirstPerson=8]="FirstPerson",a[a.ThirdPerson=16]="ThirdPerson",a))(Cr||{});const MM=class{constructor(){E(this,"Mask",17)}Has(e){const t=this.Mask&e;return Yd&&console.log("HAS",e,this.Mask,"Result="+t),t!==0}Set(e){this.Mask=e,ur.Apply()}Enable(e){this.Mask|=e,ur.Apply()}Disable(e){this.Mask&=~e,ur.Apply()}Toggle(e){this.Mask^=e,ur.Apply()}EnableAll(){this.Mask=-1,ur.Apply()}DisableAll(){this.Mask=0,ur.Apply()}};let Ha=MM;E(Ha,"Global",new MM);const Ta=class extends Bt{constructor(){super(...arguments);E(this,"visibleIn")}static Apply(){for(const t of this.registry)t.UpdateVisible(Ha.Global)}awake(){Ta.registry.push(this)}onEnable(){Ta.firstApply||(Ta.firstApply=!0,Ta.Apply())}onDestroy(){const t=Ta.registry.indexOf(this);t>=0&&Ta.registry.splice(t,1)}get isOn(){return this.gameObject.visible}UpdateVisible(t=null){if(!this.enabled)return;let n;const i=t;i&&typeof i=="number"&&(console.assert(typeof i=="number","XRFlag.UpdateVisible: state must be a number",i),Yd&&console.log(i),Ta.buffer.Mask=i,t=Ta.buffer);const r=t;if(r?(Yd&&console.log("use passed in mask"),n=r.Has(this.visibleIn)):(Yd&&console.log("use global mask"),Ha.Global.Has(this.visibleIn)),n!==void 0)if(n)Yd&&console.trace("is visible",this.name,this.gameObject.uuid),Te.setActive(this.gameObject,!0);else{if(Yd&&console.trace("is not visible",this.name,this.gameObject.uuid),!this.gameObject.visible)return;this.gameObject.visible=!1}}};let ur=Ta;E(ur,"registry",[]),E(ur,"firstApply"),E(ur,"buffer",new Ha);const ls={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function iO(a){const e=await fetch(a);if(e.ok)return e.json();throw new Error(e.statusText)}async function xZ(a){if(!a)throw new Error("No basePath supplied");return await iO(`${a}/profilesList.json`)}async function wZ(a,e,t=null,n=!0){if(!a)throw new Error("No xrInputSource supplied");if(!e)throw new Error("No basePath supplied");const i=await xZ(e);let r;if(a.profiles.some(h=>{const u=i[h];return u&&(r={profileId:h,profilePath:`${e}/${u.path}`,deprecated:!!u.deprecated}),!!r}),!r){if(!t)throw new Error("No matching profile name found");const h=i[t];if(!h)throw new Error(`No matching profile name found and default profile "${t}" missing.`);r={profileId:t,profilePath:`${e}/${h.path}`,deprecated:!!h.deprecated}}const o=await iO(r.profilePath);let l;if(n){let h;if(a.handedness==="any"?h=o.layouts[Object.keys(o.layouts)[0]]:h=o.layouts[a.handedness],!h)throw new Error(`No matching handedness, ${a.handedness}, in profile ${r.profileId}`);h.assetPath&&(l=r.profilePath.replace("profile.json",h.assetPath))}return{profile:o,assetPath:l}}const bZ={xAxis:0,yAxis:0,button:0,state:ls.ComponentState.DEFAULT};function EZ(a=0,e=0){let t=a,n=e;if(Math.sqrt(a*a+e*e)>1){const o=Math.atan2(e,a);t=Math.cos(o),n=Math.sin(o)}return{normalizedXAxis:t*.5+.5,normalizedYAxis:n*.5+.5}}class CZ{constructor(e){this.componentProperty=e.componentProperty,this.states=e.states,this.valueNodeName=e.valueNodeName,this.valueNodeProperty=e.valueNodeProperty,this.valueNodeProperty===ls.VisualResponseProperty.TRANSFORM&&(this.minNodeName=e.minNodeName,this.maxNodeName=e.maxNodeName),this.value=0,this.updateFromComponent(bZ)}updateFromComponent({xAxis:e,yAxis:t,button:n,state:i}){const{normalizedXAxis:r,normalizedYAxis:o}=EZ(e,t);switch(this.componentProperty){case ls.ComponentProperty.X_AXIS:this.value=this.states.includes(i)?r:.5;break;case ls.ComponentProperty.Y_AXIS:this.value=this.states.includes(i)?o:.5;break;case ls.ComponentProperty.BUTTON:this.value=this.states.includes(i)?n:0;break;case ls.ComponentProperty.STATE:this.valueNodeProperty===ls.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(i):this.value=this.states.includes(i)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}}class SZ{constructor(e,t){if(!e||!t||!t.visualResponses||!t.gamepadIndices||Object.keys(t.gamepadIndices).length===0)throw new Error("Invalid arguments supplied");this.id=e,this.type=t.type,this.rootNodeName=t.rootNodeName,this.touchPointNodeName=t.touchPointNodeName,this.visualResponses={},Object.keys(t.visualResponses).forEach(n=>{const i=new CZ(t.visualResponses[n]);this.visualResponses[n]=i}),this.gamepadIndices=Object.assign({},t.gamepadIndices),this.values={state:ls.ComponentState.DEFAULT,button:this.gamepadIndices.button!==void 0?0:void 0,xAxis:this.gamepadIndices.xAxis!==void 0?0:void 0,yAxis:this.gamepadIndices.yAxis!==void 0?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(e){if(this.values.state=ls.ComponentState.DEFAULT,this.gamepadIndices.button!==void 0&&e.buttons.length>this.gamepadIndices.button){const t=e.buttons[this.gamepadIndices.button];this.values.button=t.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,t.pressed||this.values.button===1?this.values.state=ls.ComponentState.PRESSED:(t.touched||this.values.button>ls.ButtonTouchThreshold)&&(this.values.state=ls.ComponentState.TOUCHED)}this.gamepadIndices.xAxis!==void 0&&e.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=e.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===ls.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>ls.AxisTouchThreshold&&(this.values.state=ls.ComponentState.TOUCHED)),this.gamepadIndices.yAxis!==void 0&&e.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=e.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===ls.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>ls.AxisTouchThreshold&&(this.values.state=ls.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach(t=>{t.updateFromComponent(this.values)})}}class MZ{constructor(e,t,n){if(!e)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No profile supplied");this.xrInputSource=e,this.assetUrl=n,this.id=t.profileId,this.layoutDescription=t.layouts[e.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(i=>{const r=this.layoutDescription.components[i];this.components[i]=new SZ(i,r)}),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){const e=[];return Object.values(this.components).forEach(t=>{e.push(t.data)}),e}updateFromGamepad(){Object.values(this.components).forEach(e=>{e.updateFromGamepad(this.xrInputSource.gamepad)})}}const TZ="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",IZ="generic-trigger";class RZ extends qt{constructor(){super(),this.motionController=null,this.envMap=null}setEnvironmentMap(e){return this.envMap==e?this:(this.envMap=e,this.traverse(t=>{t.isMesh&&(t.material.envMap=this.envMap,t.material.needsUpdate=!0)}),this)}updateMatrixWorld(e){super.updateMatrixWorld(e),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach(t=>{Object.values(t.visualResponses).forEach(n=>{const{valueNode:i,minNode:r,maxNode:o,value:l,valueNodeProperty:h}=n;!i||(h===ls.VisualResponseProperty.VISIBILITY?i.visible=l:h===ls.VisualResponseProperty.TRANSFORM&&(i.quaternion.slerpQuaternions(r.quaternion,o.quaternion,l),i.position.lerpVectors(r.position,o.position,l)))})}))}}function PZ(a,e){Object.values(a.components).forEach(t=>{const{type:n,touchPointNodeName:i,visualResponses:r}=t;if(n===ls.ComponentType.TOUCHPAD)if(t.touchPointNode=e.getObjectByName(i),t.touchPointNode){const o=new ho(.001),l=new Hi({color:255}),h=new _t(o,l);t.touchPointNode.add(h)}else console.warn(`Could not find touch dot, ${t.touchPointNodeName}, in touchpad component ${t.id}`);Object.values(r).forEach(o=>{const{valueNodeName:l,minNodeName:h,maxNodeName:u,valueNodeProperty:f}=o;if(f===ls.VisualResponseProperty.TRANSFORM){if(o.minNode=e.getObjectByName(h),o.maxNode=e.getObjectByName(u),!o.minNode){console.warn(`Could not find ${h} in the model`);return}if(!o.maxNode){console.warn(`Could not find ${u} in the model`);return}}o.valueNode=e.getObjectByName(l),o.valueNode||console.warn(`Could not find ${l} in the model`)})})}function RP(a,e){PZ(a.motionController,e),a.envMap&&e.traverse(t=>{t.isMesh&&(t.material.envMap=a.envMap,t.material.needsUpdate=!0)}),a.layers.mask!=0&&e.traverse(t=>{t.layers.mask=a.layers.mask}),a.add(e)}class BZ{constructor(e=null){this.gltfLoader=e,this.path=TZ,this._assetCache={},this.gltfLoader||(this.gltfLoader=new Df)}createControllerModel(e){const t=new RZ;let n=null;return e.addEventListener("connected",i=>{const r=i.data;r.targetRayMode!=="tracked-pointer"||!r.gamepad||wZ(r,this.path,IZ).then(({profile:o,assetPath:l})=>{t.motionController=new MZ(r,o,l);const h=this._assetCache[t.motionController.assetUrl];if(h)n=h.scene.clone(),RP(t,n);else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(t.motionController.assetUrl,u=>{this._assetCache[t.motionController.assetUrl]=u,n=u.scene.clone(),RP(t,n)},null,()=>{throw new Error(`Asset ${t.motionController.assetUrl} missing or malformed.`)})}}).catch(o=>{console.warn(o)})}),e.addEventListener("disconnected",()=>{t.motionController=null,t.remove(n),n=null}),t}}const LZ="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles/generic-hand/";class DZ{constructor(e,t,n,i){this.controller=t,this.handModel=e,this.bones=[];const r=new Df;r.setPath(n||LZ),r.load(`${i}.glb`,o=>{const l=o.scene.children[0];this.handModel.add(l),l.layers.mask=this.handModel.layers.mask;const h=l.getObjectByProperty("type","SkinnedMesh");h.frustumCulled=!1,h.castShadow=!0,h.receiveShadow=!0,["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"].forEach(f=>{const g=l.getObjectByName(f);g!==void 0?g.jointName=f:console.warn(`Couldn't find ${f} in ${i} hand mesh`),this.bones.push(g)})})}updateMesh(){const e=this.controller.joints;for(let t=0;t<this.bones.length;t++){const n=this.bones[t];if(n){const i=e[n.jointName];if(i.visible){const r=i.position;n.position.copy(r),n.quaternion.copy(i.quaternion)}}}}}const OZ=.01,FZ="index-finger-tip";class kZ extends qt{constructor(e){super(),this.controller=e,this.motionController=null,this.envMap=null,this.mesh=null,e.addEventListener("connected",t=>{const n=t.data;n.hand&&!this.motionController&&(this.xrInputSource=n,this.motionController=new DZ(this,e,this.path,n.handedness))}),e.addEventListener("disconnected",()=>{this.clear(),this.motionController=null})}updateMatrixWorld(e){super.updateMatrixWorld(e),this.motionController&&this.motionController.updateMesh()}getPointerPosition(){const e=this.controller.joints[FZ];return e?e.position:null}intersectBoxObject(e){const t=this.getPointerPosition();if(t){const n=new Qa(t,OZ),i=new Mr().setFromObject(e);return n.intersectsBox(i)}else return!1}checkButton(e){this.intersectBoxObject(e)?e.onPress():e.onClear(),e.isPressed()&&e.whilePressed()}}const NZ=.05,PP=.02,l_=.01,BP=.02,LP=1,Wd=.4,UZ=.002,am=.01,h_=.003,DP=.035,ki=16,Co=12,Ab=110,zZ=new q(0,1,0),GZ=new q(0,0,1),HZ=.02,VZ=1.5;class WZ extends qt{constructor(e,t){super(),this.hand=e,this.controller=t,this.motionController=null,this.envMap=null,this.mesh=null,this.pointerGeometry=null,this.pointerMesh=null,this.pointerObject=null,this.pinched=!1,this.attached=!1,this.cursorObject=null,this.raycaster=null,e.addEventListener("connected",n=>{const i=n.data;i.hand&&(this.visible=!0,this.xrInputSource=i,this.pointerObject===null&&this.createPointer())})}_drawVerticesRing(e,t,n){const i=t.clone();for(let r=0;r<ki;r++){i.applyAxisAngle(GZ,Math.PI*2/ki);const o=n*ki+r;e[3*o]=i.x,e[3*o+1]=i.y,e[3*o+2]=i.z}}_updatePointerVertices(e){const t=this.pointerGeometry.attributes.position.array,n=new q(UZ,0,-1*(DP-e));this._drawVerticesRing(t,n,0);const i=new q(Math.sin(Math.PI*Ab/180)*e,Math.cos(Math.PI*Ab/180)*e,0);for(let u=0;u<Co;u++)this._drawVerticesRing(t,i,u+1),i.applyAxisAngle(zZ,Math.PI*Ab/180/(Co*-2));const r=ki*(1+Co),o=ki*(1+Co)+1,l=new q(0,0,-1*(DP-e));t[r*3]=l.x,t[r*3+1]=l.y,t[r*3+2]=l.z;const h=new q(0,0,e);t[o*3]=h.x,t[o*3+1]=h.y,t[o*3+2]=h.z,this.pointerGeometry.setAttribute("position",new tn(t,3))}createPointer(){let e,t;const n=new Array(((Co+1)*ki+2)*3).fill(0),i=[];for(this.pointerGeometry=new Sn,this.pointerGeometry.setAttribute("position",new tn(n,3)),this._updatePointerVertices(am),e=0;e<Co;e++){for(t=0;t<ki-1;t++)i.push(e*ki+t,e*ki+t+1,(e+1)*ki+t),i.push(e*ki+t+1,(e+1)*ki+t+1,(e+1)*ki+t);i.push((e+1)*ki-1,e*ki,(e+2)*ki-1),i.push(e*ki,(e+1)*ki,(e+2)*ki-1)}const r=ki*(1+Co),o=ki*(1+Co)+1;for(e=0;e<ki-1;e++)i.push(r,e+1,e),i.push(o,e+ki*Co,e+ki*Co+1);i.push(r,0,ki-1),i.push(o,ki*(Co+1)-1,ki*Co);const l=new Hi;l.transparent=!0,l.opacity=Wd,this.pointerGeometry.setIndex(i),this.pointerMesh=new _t(this.pointerGeometry,l),this.pointerMesh.position.set(0,0,-1*am),this.pointerObject=new qt,this.pointerObject.add(this.pointerMesh),this.raycaster=new Du;const h=new ho(HZ,10,10),u=new Hi;u.transparent=!0,u.opacity=Wd,this.cursorObject=new _t(h,u),this.pointerObject.add(this.cursorObject),this.add(this.pointerObject),this.pointerObject.layers.mask=this.layers.mask,this.pointerMesh.layers.mask=this.layers.mask}_updateRaycaster(){if(this.raycaster){const e=this.pointerObject.matrixWorld,t=new xn;t.identity().extractRotation(e),this.raycaster.ray.origin.setFromMatrixPosition(e),this.raycaster.ray.direction.set(0,0,-1).applyMatrix4(t)}}_updatePointer(){this.pointerObject.visible=this.controller.visible;const e=this.hand.joints["index-finger-tip"],t=this.hand.joints["thumb-tip"],n=e.position.distanceTo(t.position),i=e.position.clone().add(t.position).multiplyScalar(.5);this.pointerObject.position.copy(i),this.pointerObject.quaternion.copy(this.controller.quaternion),this.pinched=n<=PP;const r=(n-l_)/(NZ-l_),o=(n-l_)/(PP-l_);if(r>1)this._updatePointerVertices(am),this.pointerMesh.position.set(0,0,-1*am),this.pointerMesh.material.opacity=Wd;else if(r>0){const l=(am-h_)*r+h_;this._updatePointerVertices(l),o<1?(this.pointerMesh.position.set(0,0,-1*l-(1-o)*BP),this.pointerMesh.material.opacity=Wd+(1-o)*(LP-Wd)):(this.pointerMesh.position.set(0,0,-1*l),this.pointerMesh.material.opacity=Wd)}else this._updatePointerVertices(h_),this.pointerMesh.position.set(0,0,-1*h_-BP),this.pointerMesh.material.opacity=LP;this.cursorObject.material.opacity=this.pointerMesh.material.opacity}updateMatrixWorld(e){super.updateMatrixWorld(e),this.pointerGeometry&&(this._updatePointer(),this._updateRaycaster())}isPinched(){return this.pinched}setAttached(e){this.attached=e}isAttached(){return this.attached}intersectObject(e,t=!0){if(this.raycaster)return this.raycaster.intersectObject(e,t)}intersectObjects(e,t=!0){if(this.raycaster)return this.raycaster.intersectObjects(e,t)}checkIntersections(e,t=!1){if(this.raycaster&&!this.attached){const n=this.raycaster.intersectObjects(e,t),i=new q(0,0,-1);if(n.length>0){const o=n[0].distance;this.cursorObject.position.copy(i.multiplyScalar(o))}else this.cursorObject.position.copy(i.multiplyScalar(VZ))}}setCursor(e){const t=new q(0,0,-1);this.raycaster&&!this.attached&&this.cursorObject.position.copy(t.multiplyScalar(e))}}const Rl=jt("debugavatar"),wc=class extends Bt{constructor(){super(...arguments);E(this,"connectionId");E(this,"avatar")}static onAvatarMarkerCreated(t){return wc._onNewAvatarMarkerAdded.push(t),t}static onAvatarMarkerDestroyed(t){return wc._onAvatarMarkerDestroyed.push(t),t}awake(){wc.instances.push(this),Rl&&console.log(this);for(const t of wc._onNewAvatarMarkerAdded)t({avatarMarker:this,gameObject:this.gameObject})}onDestroy(){wc.instances.splice(wc.instances.indexOf(this),1);for(const t of wc._onAvatarMarkerDestroyed)t({avatarMarker:this,gameObject:this.gameObject})}isLocalAvatar(){return this.connectionId===this.context.connection.connectionId}setVisible(t){this.avatar&&("setVisible"in this.avatar?this.avatar.setVisible(t):Te.setActive(this.avatar,t))}};let fr=wc;E(fr,"instances",[]),E(fr,"_onNewAvatarMarkerAdded",[]),E(fr,"_onAvatarMarkerDestroyed",[]);const zm=class{constructor(e,t,n){E(this,"_isVisible",!0);E(this,"guid");E(this,"root",null);E(this,"head",null);E(this,"handLeft",null);E(this,"handRight",null);E(this,"lastUpdate",-1);E(this,"isLocalAvatar",!1);E(this,"flags",null);E(this,"headScale",new q(1,1,1));E(this,"handLeftScale",new q(1,1,1));E(this,"handRightScale",new q(1,1,1));E(this,"webxr");E(this,"lastAvatarId",null);E(this,"hasAvatarOverride",!1);E(this,"context");E(this,"avatarMarker",null);E(this,"_headTarget",new qt);E(this,"_handLeftTarget",new qt);E(this,"_handRightTarget",new qt);E(this,"_canInterpolate",!1);this.context=e,this.guid=t,this.webxr=n,this.setupCustomAvatar(this.webxr.defaultAvatar)}setVisible(e){this._isVisible=e,this.updateVisibility()}updateFlags(){if(!this.flags)return;let e=this.isLocalAvatar?Cr.FirstPerson:Cr.ThirdPerson;for(const t of this.flags)t.gameObject.visible=!0,t.UpdateVisible(e)}async setAvatarOverride(e){return this.hasAvatarOverride=e!==null,this.hasAvatarOverride&&this.lastAvatarId!==e&&(this.lastAvatarId=e,e!=null&&e.length>0)?await this.setupCustomAvatar(e):null}tryUpdate(e,t){if(e.guid===this.guid&&(this.lastAvatarId!==e.avatarId&&e.avatarId&&e.avatarId.length>0&&(this.lastAvatarId=e.avatarId,this.setupCustomAvatar(e.avatarId)),this.lastUpdate=e.time,this.head)){this._canInterpolate=!0;const n=this.isLocalAvatar?this.head:this._headTarget;if(n.position.set(e.position.x,e.position.y,e.position.z),n.quaternion.set(e.rotation.x,e.rotation.y,e.rotation.z,e.rotation.w),n.scale.set(e.scale,e.scale,e.scale),n.scale.multiply(this.headScale),this.handLeft){const i=this.isLocalAvatar?this.handLeft:this._handLeftTarget;i.position.set(e.posLeftHand.x,e.posLeftHand.y,e.posLeftHand.z),i.quaternion.set(e.rotLeftHand._x,e.rotLeftHand._y,e.rotLeftHand._z,e.rotLeftHand._w),i.quaternion.multiply(zm.invertRotation),i.scale.set(e.scale,e.scale,e.scale),i.scale.multiply(this.handLeftScale)}if(this.handRight){const i=this.isLocalAvatar?this.handRight:this._handRightTarget;i.position.set(e.posRightHand.x,e.posRightHand.y,e.posRightHand.z),i.quaternion.set(e.rotRightHand._x,e.rotRightHand._y,e.rotRightHand._z,e.rotRightHand._w),i.quaternion.multiply(zm.invertRotation),i.scale.set(e.scale,e.scale,e.scale),i.scale.multiply(this.handRightScale)}}}update(){if(this.isLocalAvatar||!this._canInterpolate)return;const e=this.context.time.deltaTime/.1;this.head&&(this.head.position.lerp(this._headTarget.position,e),this.head.quaternion.slerp(this._headTarget.quaternion,e),this.head.scale.lerp(this._headTarget.scale,e)),this.handLeft&&this._handLeftTarget&&(this.handLeft.position.lerp(this._handLeftTarget.position,e),this.handLeft.quaternion.slerp(this._handLeftTarget.quaternion,e),this.handLeft.scale.lerp(this._handLeftTarget.scale,e)),this.handRight&&this._handRightTarget&&(this.handRight.position.lerp(this._handRightTarget.position,e),this.handRight.quaternion.slerp(this._handRightTarget.quaternion,e),this.handRight.scale.lerp(this._handRightTarget.scale,e))}destroy(){var e,t;Rl&&console.log("Destroy avatar",this.guid),(e=this.root)==null||e.removeFromParent(),(t=this.avatarMarker)==null||t.destroy(),this.lastAvatarId=null,this.head&&zr.Remove(this.context,this.head)}updateVisibility(){const e=this.root;e&&Te.setActive(e,this._isVisible)}async setupCustomAvatar(e){var i,r,o,l,h;if(Rl&&console.log("LOAD",e,this),!e||typeof e=="string"&&e.length<=0)return!1;this.head&&zr.Remove(this.context,this.head);const t=e;if((t==null?void 0:t.loadAssetAsync)!==void 0){await t.loadAssetAsync();const u=t.asset;Te.setActive(u,!1),e=Te.instantiate(u),Te.setActive(e,!0)}Rl&&console.log(e);const n=await zm.loader.getOrCreateNewAvatarInstance(this.context,e);if(Rl&&console.log(n,n==null?void 0:n.isValid,this.lastAvatarId,e),n!=null&&n.isValid){if(this.root=n.root,this.root.position.set(0,0,0),this.root.quaternion.set(0,0,0,1),this.root.scale.set(1,1,1),this.avatarMarker=Te.addNewComponent(this.root,fr),this.avatarMarker.connectionId=this.guid,this.avatarMarker.avatar=this,this.head&&this.head!==n.head&&((i=this.head)==null||i.removeFromParent()),this.head=n.head,this.headScale.copy(this.head.scale),this.head&&!this.isLocalAvatar&&zr.Add(this.context,this.head,this.avatarMarker),n.leftHand&&((r=this.handLeft)==null||r.removeFromParent()),this.handLeft=(o=n.leftHand)!=null?o:this.handLeft,this.handLeft?this.handLeftScale.copy(this.handLeft.scale):this.handLeftScale.set(1,1,1),n.rigthHand&&((l=this.handRight)==null||l.removeFromParent()),this.handRight=(h=n.rigthHand)!=null?h:this.handRight,this.handRight?this.handRightScale.copy(this.handRight.scale):this.handRightScale.set(1,1,1),this.context.scene.add(this.root),this.flags==null&&(this.flags=[]),this.flags.length=0,this.flags.push(...Te.getComponentsInChildren(this.root,ur)),this.flags.length<=0&&this.head){const u=Te.addNewComponent(this.head,ur);u.visibleIn=Cr.ThirdPerson|Cr.VR,this.flags.push(u),Rl&&console.log("Added flag to head: "+u.visibleIn,this.head.name)}return Rl&&console.log("[Avatar], is Local? ",this.isLocalAvatar,this.root),this.updateFlags(),this.updateVisibility(),!0}else return Rl&&console.warn("build avatar failed"),!1}};let Rc=zm;E(Rc,"loader",new _S),E(Rc,"invertRotation",new Ot().setFromAxisAngle(new q(0,1,0),Math.PI));class zr{static Add(e,t,n=null){if(!!t){for(const i of this.Pois)if(i.obj===t)return;this.Pois.push({obj:t,avatar:n}),this.LastChangeTime=e.time.time}}static Remove(e,t){var n,i;if(!!t){for(const r of this.Pois)if(r.obj===t){this.Pois.splice(this.Pois.indexOf(r),1),this.LastChangeTime=(i=e==null?void 0:e.time.time)!=null?i:(n=_i.Current)==null?void 0:n.time.time;return}}}}E(zr,"Pois",[]),E(zr,"LastChangeTime",0);class QZ{constructor(){E(this,"guid");E(this,"position",new q)}}class ay extends Bt{constructor(){super(...arguments);E(this,"target",null);E(this,"avatar",null);E(this,"_model",null);E(this,"_targetModel",new QZ);E(this,"_currentTargetObject",null);E(this,"_lastUpdateTime",0);E(this,"_lookDuration",0);E(this,"_lastPoiChangedTime",0)}set controlledTarget(t){this.target=t;const n=je.get("MoveRandom");if(n&&this.target){const i=Te.getComponent(this.target,n);i&&i.destroy()}}awake(){if(this.avatar=Te.getComponentInParent(this.gameObject,fr),this.avatar){const t=Te.getComponentInParent(this.gameObject,fr);this._model=new dS(this.context.connection,this.guid),t!=null&&t.isLocalAvatar&&this._model.requestOwnership()}this.context.connection.beginListen("avatar-look-target-changed",t=>{var n;this.target&&t&&t.guid===((n=this.avatar)==null?void 0:n.guid)&&ys(this.target,t.position)})}update(){var n;if((!this.context.connection.isConnected||((n=this._model)==null?void 0:n.hasOwnership))&&(zr.LastChangeTime!==this._lastPoiChangedTime&&(this._lastPoiChangedTime=zr.LastChangeTime,this._lookDuration=0),this.selectTarget(),this._currentTargetObject&&this.context.time.frameCount%10===0&&this.target)){const i=ti(this._currentTargetObject);ys(this.target,i),this.context.connection.isConnected&&this.avatar&&(this.context.connection.send("avatar-look-target-changed",this._targetModel),this._targetModel.guid=this.avatar.guid,this._targetModel.position.copy(i))}}selectTarget(){if(this.context.time.time-this._lastUpdateTime>this._lookDuration){this._lastUpdateTime=this.context.time.time,this._lookDuration=Math.random()*.5+.2;const n=zr.Pois;if(n.length>0){const i=n[Math.floor(Math.random()*n.length)];if(i&&i.obj){if(i.avatar&&i.avatar===this.avatar)return;this._currentTargetObject=i.obj}}}}}var bS=(a=>(a[a.PhysicalDevice=0]="PhysicalDevice",a[a.Touch=1]="Touch",a))(bS||{}),Vl=(a=>(a.SelectStart="select-start",a.SelectEnd="select-end",a.Update="update",a))(Vl||{});class ES extends Bt{}const Vs=class extends Bt{constructor(){super(...arguments);E(this,"webXR");E(this,"index",-1);E(this,"controllerModel");E(this,"controller");E(this,"controllerGrip");E(this,"hand");E(this,"handPointerModel");E(this,"grabbed",null);E(this,"input",null);E(this,"type",0);E(this,"_wristQuaternion",null);E(this,"movementVector",new q);E(this,"worldRot",new Ot);E(this,"joystick",new Xe);E(this,"didRotate",!1);E(this,"didTeleport",!1);E(this,"didChangeScale",!1);E(this,"lastHit",null);E(this,"raycastLine",null);E(this,"_raycastHitPoint",null);E(this,"_connnectedCallback",null);E(this,"_disconnectedCallback",null);E(this,"_selectStartEvt",null);E(this,"_selectEndEvt",null);E(this,"_selectionPressed",!1);E(this,"_selectionPressedLastFrame",!1);E(this,"_selectionStartTime",0);E(this,"_selectionEndTime",0);E(this,"_useSmoothing",!0);E(this,"_isConnected",!1);E(this,"rayRotation",new Ot);E(this,"_pinchStartTime");E(this,"selectStartCallback",null);E(this,"lastSelectStartObject",null);E(this,"_didNotEndSelection",!1)}static CreateRaycastLine(){const t=new Ss(this.geometry),n=t.material;return n.color=this.raycastColor,t.layers.set(1),t.name="line",t.scale.z=1,t}static CreateRaycastHitPoint(){const t=new ho(.5,22,22),n=new Hi({color:this.raycastColor}),i=new _t(t,n);return i.visible=!1,i.layers.set(1),i}static Create(t,n,i,r){const o=i?Te.addNewComponent(i,Vs,!1):new Vs;o.webXR=t,o.index=n,o.type=r;const l=t.context;return o.controller=l.renderer.xr.getController(n),o.controllerGrip=l.renderer.xr.getControllerGrip(n),o.controllerModel=this.Factory.createControllerModel(o.controller),o.controllerGrip.add(o.controllerModel),o.hand=l.renderer.xr.getHand(n),o.hand.add(new kZ(o.hand)),o.hand.traverse(h=>h.layers.set(2)),o.handPointerModel=new WZ(o.hand,o.controller),o.controller.addEventListener("connected",h=>{o.setControllerLayers(o.controllerModel,2),o.setControllerLayers(o.controllerGrip,2),setTimeout(()=>{o.setControllerLayers(o.controllerGrip,2)},1e3)}),o.hand.addEventListener("connected",h=>{var f;if(h.data.hand){t.Rig&&t.Rig.add(o.hand),o.type=0,o.handPointerModel.traverse(m=>m.layers.set(2)),(f=o.handPointerModel.pointerObject)==null||f.traverse(m=>m.layers.set(2));const g=o.hand.joints;if(g)for(const m of Object.keys(g)){const A=g[m];A.parent||o.hand.add(A)}}}),o}static addEventListener(t,n){var r;const i=(r=this.eventSubs[t])!=null?r:[];i.push(n),this.eventSubs[t]=i}get isUsingHands(){var n;const t=(n=this.input)==null?void 0:n.hand;return t!=null}get wrist(){if(!this.hand)return null;const t=this.hand.joints;return t?t.wrist:null}getWristQuaternion(){const t=this.wrist;return t?(this._wristQuaternion||(this._wristQuaternion=new Ot),uo(t).multiply(this._wristQuaternion.setFromEuler(new vs(-Math.PI/4,0,0)))):null}get selectionDown(){return this._selectionPressed&&!this._selectionPressedLastFrame}get selectionUp(){return!this._selectionPressed&&this._selectionPressedLastFrame}get selectionPressed(){return this._selectionPressed}get selectionClick(){return this._selectionEndTime-this._selectionStartTime<.3}get raycastHitPoint(){return this._raycastHitPoint}get useSmoothing(){return this._useSmoothing}awake(){if(!this.controller){console.warn("Missing Controller!!!",this);return}this._connnectedCallback=this.onSourceConnected.bind(this),this._disconnectedCallback=this.onSourceDisconnected.bind(this),this._selectStartEvt=this.onSelectStart.bind(this),this._selectEndEvt=this.onSelectEnd.bind(this),this.type===1&&(this.controllerGrip.addEventListener("connected",this._connnectedCallback),this.controllerGrip.addEventListener("disconnected",this._disconnectedCallback),this.controller.addEventListener("selectstart",this._selectStartEvt),this.controller.addEventListener("selectend",this._selectEndEvt)),this.type===0&&(this.controller.addEventListener("selectstart",this._selectStartEvt),this.controller.addEventListener("selectend",this._selectEndEvt))}onDestroy(){var t,n,i;this.type===1&&(this.controllerGrip.removeEventListener("connected",this._connnectedCallback),this.controllerGrip.removeEventListener("disconnected",this._disconnectedCallback),this.controller.removeEventListener("selectstart",this._selectStartEvt),this.controller.removeEventListener("selectend",this._selectEndEvt)),this.type===0&&(this.controller.removeEventListener("selectstart",this._selectStartEvt),this.controller.removeEventListener("selectend",this._selectEndEvt)),(t=this.hand)==null||t.clear(),(n=this.controllerGrip)==null||n.clear(),(i=this.controller)==null||i.clear()}onEnable(){var t,n,i,r,o;this.hand&&(this.hand.name="Hand"),this.controllerGrip&&(this.controllerGrip.name="ControllerGrip"),this.controller&&(this.controller.name="Controller"),this.raycastLine&&(this.raycastLine.name="RaycastLine;"),this.webXR.Controllers.indexOf(this)<0&&this.webXR.Controllers.push(this),this.raycastLine||(this.raycastLine=Vs.CreateRaycastLine()),this._raycastHitPoint||(this._raycastHitPoint=Vs.CreateRaycastHitPoint()),(t=this.webXR.Rig)==null||t.add(this.hand),(n=this.webXR.Rig)==null||n.add(this.controllerGrip),(i=this.webXR.Rig)==null||i.add(this.controller),(r=this.webXR.Rig)==null||r.add(this.raycastLine),(o=this.raycastLine)==null||o.add(this._raycastHitPoint),this._raycastHitPoint.visible=!1,this.hand.add(this.handPointerModel),console.log("ADDED TO RIG",this.webXR.Rig)}onDisable(){var n,i,r,o,l;(n=this.hand)==null||n.removeFromParent(),(i=this.controllerGrip)==null||i.removeFromParent(),(r=this.controller)==null||r.removeFromParent(),(o=this.raycastLine)==null||o.removeFromParent(),(l=this._raycastHitPoint)==null||l.removeFromParent();const t=this.webXR.Controllers.indexOf(this);t>=0&&this.webXR.Controllers.splice(t,1)}onSourceConnected(t){if(this._isConnected){console.warn("Received connected event for controller that is already connected",this.index,t);return}this._isConnected=!0,this.input=t.data,this.type===1&&(this.onSelectStart(),this.createPointerEvent("down"))}onSourceDisconnected(t){if(!this._isConnected){console.warn("Received discnnected event for controller that is not connected",t);return}this._isConnected=!1,this.type===1&&(this.onSelectEnd(),this.createPointerEvent("up")),this.input=null}createPointerEvent(t){switch(t){case"down":this.context.input.createPointerDown({pointerId:this.index,clientX:0,clientY:0,button:this.index,pointerType:"touch"});break;case"move":break;case"up":this.context.input.createPointerUp({pointerId:this.index,clientX:0,clientY:0,button:this.index,pointerType:"touch"});break}}update(){this.context.time.frameCount%60===0&&(this.setControllerLayers(this.controller,2),this.setControllerLayers(this.controllerGrip,2),this.setControllerLayers(this.hand,2));const t=Vs.eventSubs.update;if(t&&t.length>0)for(const r of t)r(this);let n=1;this.type===0?n=this.context.time.deltaTime/.1:this.isUsingHands&&this.handPointerModel.pinched&&(n=this.context.time.deltaTime/.3),this.rayRotation.slerp(uo(this.controller),this.useSmoothing?n:1);const i=ti(this.controller);if(this.raycastLine)if(this.type===1)this.raycastLine.visible=!1;else if(this.isUsingHands){this.raycastLine.visible=!this.grabbed,ys(this.raycastLine,i);const r=this.hand.joints;if(r&&r.wrist&&this.grabbed&&this.grabbed.isCloseGrab){const l=this.getWristQuaternion();l&&this.rayRotation.copy(l)}Nr(this.raycastLine,this.rayRotation)}else this.raycastLine.visible=!0,Nr(this.raycastLine,this.rayRotation),ys(this.raycastLine,i);this.lastHit=this.updateLastHit(),this.grabbed&&this.grabbed.update(),this._selectionPressedLastFrame=this._selectionPressed,this.selectStartCallback&&this.selectStartCallback()}onUpdate(t){var r,o;if(this.lastHit=null,!t||t.inputSources.length<=this.index){this.input=null;return}if(this.type===0&&(this.input=t.inputSources[this.index]),!this.input)return;const n=this.webXR.Rig;if(!n)return;this._didNotEndSelection&&!this.handPointerModel.pinched&&(this._didNotEndSelection=!1,this.onSelectEnd()),this.updateStick(this.input);const i=(o=(r=this.input)==null?void 0:r.gamepad)==null?void 0:o.buttons;switch(this.input.handedness){case"left":const l=3*Vs.MovementSpeedFactor,h=2,u=Ei.clamp01(this.joystick.length()*2),f=this.joystick.x>0?1:-1;let g=Math.pow(this.joystick.x,h);g*=f,g*=u;const m=this.joystick.y>0?1:-1;let A=Math.pow(this.joystick.y,h);A*=m,g*=u,n.getWorldQuaternion(this.worldRot),this.movementVector.set(g,0,A),this.movementVector.applyQuaternion(this.webXR.TransformOrientation),this.movementVector.y=0,this.movementVector.applyQuaternion(this.worldRot),n.position.add(this.movementVector.multiplyScalar(l*this.context.time.deltaTime)),this.isUsingHands&&this.runTeleport(n,i);break;case"right":const v=this.joystick.x,w=Math.abs(v);if(w<.4)this.didRotate=!1;else if(w>.5&&!this.didRotate){const b=v>0?-1:1;n.rotateY(Ei.toRadians(30*b)),this.didRotate=!0}this.runTeleport(n,i);break}}runTeleport(t,n){var h,u,f;let i=-this.joystick.y;if(((h=this.hand)==null?void 0:h.visible)&&!this.grabbed){const g=this.handPointerModel.isPinched();g&&this._pinchStartTime===void 0&&(this._pinchStartTime=this.context.time.time),g&&this._pinchStartTime&&this.context.time.time-this._pinchStartTime>.8&&(i=this.handPointerModel.isPinched()?1:0),g||(this._pinchStartTime=void 0)}else this._pinchStartTime=void 0;let r=i>.5,o=this.webXR.Rig?((f=(u=this.webXR.Rig)==null?void 0:u.scale)==null?void 0:f.x)<.999:!1,l=null;if(n&&this.input&&!this.input.hand)for(let g=0;g<n.length;g++){const m=n[g];if(g===4)if(m.pressed&&!this.didChangeScale){this.didChangeScale=!0;const A=this.webXR.Rig;if(A)if(o){o=!1,A.scale.set(1,1,1),l=1,Vs.MovementSpeedFactor=1;const v=this.context.mainCamera;Vs.PreviousCameraFarDistance&&(v.far=Vs.PreviousCameraFarDistance)}else{o=!0,r=!0,l=.1,Vs.MovementSpeedFactor=l*2;const v=this.context.mainCamera;Vs.PreviousCameraFarDistance=v.far,v.far/=l}}else m.pressed||(this.didChangeScale=!1)}if(r){if(!this.didTeleport){const g=this.raycast();if(this.didTeleport=!0,g&&g.length>0){const m=g[0];if(o||this.isValidTeleportTarget(m.object)){const A=m.point;ys(t,A)}}}}else i<.1&&(this.didTeleport=!1);l!==null&&(t.scale.set(l,l,l),t.updateMatrixWorld())}isValidTeleportTarget(t){return Te.getComponentInParent(t,ES)!=null}updateStick(t){var n;!t||!t.gamepad||((n=t.gamepad.axes)==null?void 0:n.length)<4||(this.joystick.x=t.gamepad.axes[2],this.joystick.y=t.gamepad.axes[3])}updateLastHit(){var r,o;const t=this.raycast(),n=t?t[0]:null;this.lastHit=n;let i=1;if(this.webXR.Rig&&(i/=this.webXR.Rig.scale.x),this.raycastLine){this.raycastLine.scale.z=i*((o=(r=this.lastHit)==null?void 0:r.distance)!=null?o:9999);const l=this.raycastLine.material;n!=null?l.color=Vs.raycastColor:l.color=Vs.raycastNoHitColor}if(this._raycastHitPoint){if(this.lastHit!=null){this._raycastHitPoint.position.z=-1;const l=Ei.clamp(this.lastHit.distance*.01*i,.015,.1);this._raycastHitPoint.scale.set(l,l,l)}this._raycastHitPoint.visible=this.lastHit!==null}return n}onSelectStart(){!this.context.connection.allowEditing||(this.selectStartCallback=()=>this.onHandleSelectStart())}onHandleSelectStart(){this.selectStartCallback=null,this._selectionPressed=!0,this._selectionStartTime=this.context.time.time,this._selectionEndTime=1e3;let t=null,n=!1;if(this.isUsingHands?(t=this.overlap(),t.length<=0?(t=this.raycast(),n=!1):n=!0):t=this.raycast(),t&&t.length>0)for(const i of t){const r=i.object;if(!this.testIsVisible(r)){console.log("not visible");continue}this.lastSelectStartObject=r;const o={selected:r,grab:r},l=Vs.eventSubs["select-start"];if(l&&l.length>0)for(const h of l)h(this,o);o.grab!==r&&console.log("Grabbed object changed","original",r,"new",o.grab),o.grab&&(this.grabbed=oa.TryTake(this,o.grab,i,n));break}else{const i=Vs.eventSubs["select-start"],r={selected:null,grab:null};if(i&&i.length>0)for(const o of i)o(this,r)}}onSelectEnd(){var i,r;if(this.isUsingHands&&this.handPointerModel.pinched){this._didNotEndSelection=!0;return}if(!this._selectionPressed)return;this.selectStartCallback=null,this._selectionPressed=!1,this._selectionEndTime=this.context.time.time;const t={grab:(r=(i=this.grabbed)==null?void 0:i.selected)!=null?r:this.lastSelectStartObject},n=Vs.eventSubs["select-end"];if(n&&n.length>0)for(const o of n)o(this,t);this.grabbed&&(this.grabbed.free(),this.grabbed=null)}testIsVisible(t){return t?Te.isActiveInHierarchy(t):!0}setControllerLayers(t,n){var i,r;if(!!t&&(t.layers.set(n),t.children))for(const o of t.children)((i=this.grabbed)==null?void 0:i.selected)===o||((r=this.grabbed)==null?void 0:r.selectedMesh)===o||this.setControllerLayers(o,n)}getRay(){const t=new Pu;return t.origin.copy(ti(this.controller)),t.direction.set(0,0,-1).applyQuaternion(this.rayRotation),t}overlap(){const t=this.isUsingHands&&this.handPointerModel?this.handPointerModel.pointerObject:this.controllerGrip;if(!t)return new Array;const n=ti(t).clone();return this.context.physics.sphereOverlap(n,.02)}raycast(){const t=new Wc;return t.layerMask=new Va,t.layerMask.set(0),t.ray=this.getRay(),this.context.physics.raycast(t)}};let gs=Vs;E(gs,"Factory",new BZ),E(gs,"raycastColor",new _e(.9,.3,.3)),E(gs,"raycastNoHitColor",new _e(.6,.6,.6)),E(gs,"geometry",new Sn().setFromPoints([new q(0,0,0),new q(0,0,-1)])),E(gs,"handModels",{}),E(gs,"eventSubs",{}),E(gs,"PreviousCameraFarDistance"),E(gs,"MovementSpeedFactor",1);var RE=(a=>(a.WillTake="WillTake",a.DidTake="DidTake",a.WillFree="WillFree",a.DidFree="DidFree",a))(RE||{});const br=class{constructor(){E(this,"sync",null);E(this,"selected",null);E(this,"selectedParent",null);E(this,"selectedMesh",null);E(this,"controller",null);E(this,"grabTime",0);E(this,"grabUUID","");E(this,"isCloseGrab",!1);E(this,"originalMaterial",null);E(this,"usageMarker",null);E(this,"rigidbodies",null);E(this,"didReparent",!1);E(this,"grabDistance",0);E(this,"interactable",null);E(this,"positionSource",null);E(this,"grabPoint",new q);E(this,"localPositionOffsetToGrab",null);E(this,"localPositionOffsetToGrab_worldSpace",new q);E(this,"localQuaternionToGrab",new Ot(0,0,0,1));E(this,"targetDir",null);E(this,"quaternionLerp",null);E(this,"controllerDir",new q);E(this,"controllerWorldPos",new q);E(this,"lastControllerWorldPos",new q);E(this,"controllerPosDelta",new q);E(this,"totalChangeAlongDirection",0);E(this,"rigPositionLastFrame",new q)}static AddEventListener(e,t){return br.Events[e]||(br.Events[e]=[]),br.Events[e].push(t),t}static RemoveEventListener(e,t){if(!t||!br.Events[e])return;const n=br.Events[e].indexOf(t);n>=0&&br.Events[e].splice(n,1)}static Register(e){this.Current.find(t=>t===e)||this.Current.push(e)}static Remove(e){const t=this.Current.indexOf(e);t>=0&&this.Current.splice(t,1)}static TryTake(e,t,n,i){const r=Te.getComponentInParent(t,Ug);if(!r)return console.warn("Prevented taking object that is not interactable",t),null;let o=t;const l=Te.getComponentInParent(t,$l);l&&(l.requestOwnership(),o=l.gameObject);for(const u of this.Current)if(u.selected===o)return u.controller===e||(u.free(),u.Take(e,o,t,l,r,n,i)),u;const h=new br;return h.Take(e,o,t,l,r,n,i),h}Take(e,t,n,i,r,o,l){var A,v;if(console.assert(t!==null,"Expected object to be taken but was",t),e.isUsingHands?this.positionSource=l?e.wrist:e.controller:this.positionSource=e.controller,!this.positionSource)return console.warn("No position source"),this;const h={controller:e,take:t,hit:n,sync:i,interactable:r};(A=br.Events.WillTake)==null||A.forEach(w=>w(this,h));const u=n;u!=null&&u.material&&(this.originalMaterial=u.material,Array.isArray(u.material)||(u.material=u.material.clone(),u.material&&u.material.emissive&&(u.material.emissive.b=.2))),this.selected=t,this.selectedParent||(this.selectedParent=t.parent),this.selectedMesh=u,this.controller=e,this.interactable=r,this.isCloseGrab=l,this.didReparent=!1,this.sync=i,this.grabTime=e.context.time.time,this.grabUUID=Date.now().toString(),this.usageMarker=Te.addNewComponent(this.selected,zg),this.rigidbodies=Te.getComponentsInChildren(this.selected,Tr),ti(this.positionSource,this.lastControllerWorldPos);const f=()=>l?this.lastControllerWorldPos.clone():o.point.clone();this.grabDistance=f().distanceTo(this.lastControllerWorldPos),this.totalChangeAlongDirection=0,this.localPositionOffsetToGrab=this.selected.worldToLocal(f());const g=e.isUsingHands&&l?this.controller.getWristQuaternion().clone():e.rayRotation.clone();uo(this.selected,this.localQuaternionToGrab).premultiply(g.invert());const m=this.controller.webXR.Rig;return m&&this.rigPositionLastFrame.copy(ti(m)),zr.Add(e.context,this.selected),br.Register(this),this.sync&&(this.sync.fastMode=!0),(v=br.Events.DidTake)==null||v.forEach(w=>w(this,h)),this}free(){var i,r,o,l;if(!this.selected)return;const e={controller:this.controller,take:this.selected,hit:this.selected,sync:this.sync,interactable:null};(i=br.Events.WillFree)==null||i.forEach(h=>h(this,e)),zr.Remove(this.controller.context,this.selected),br.Remove(this),this.sync&&(this.sync.fastMode=!1);const t=this.selectedMesh;t&&this.originalMaterial&&t.material&&(t.material=this.originalMaterial);const n=this.selected;if(this.didReparent&&n.parent){const h=this.selectedParent;h?h.attach(n):(r=this.controller)==null||r.context.scene.attach(n)}if((o=this.usageMarker)==null||o.destroy(),this.controller&&(this.controller.grabbed=null),this.selected=null,this.selectedParent=null,this.selectedMesh=null,this.sync=null,this.rigidbodies)for(const h of this.rigidbodies)h.wakeUp(),h.smoothedVelocity&&h.setVelocity(h.smoothedVelocity.x,h.smoothedVelocity.y,h.smoothedVelocity.z);this.rigidbodies=null,this.localPositionOffsetToGrab=null,this.quaternionLerp=null,(l=br.Events.DidFree)==null||l.forEach(h=>h(this,e))}controllerMovementSinceLastFrame(){if(!this.positionSource||!this.controller)return 0;this.controllerDir.set(0,0,-1),this.controllerDir.applyQuaternion(this.controller.rayRotation),ti(this.positionSource,this.controllerWorldPos),this.controllerPosDelta.copy(this.controllerWorldPos),this.controllerPosDelta.sub(this.lastControllerWorldPos),this.lastControllerWorldPos.copy(this.controllerWorldPos);const e=this.controller.webXR.Rig;if(e){const n=ti(e),i=this.rigPositionLastFrame.sub(n);this.controllerPosDelta.add(i),this.rigPositionLastFrame.copy(n)}return this.controllerDir.dot(this.controllerPosDelta)}update(){var e,t;if(this.sync&&this.controller&&this.controller.context.connection.isInRoom&&this.controller.context.time.time-this.grabTime>3&&this.sync.hasOwnership()===!1&&(console.log("no ownership, will leave",this.sync.guid),this.free()),!(this.interactable&&!this.interactable.canGrab)){if(!this.didReparent&&this.selected&&this.controller){const n=(t=(e=this.controller.webXR.Rig)==null?void 0:e.scale.x)!=null?t:1;this.totalChangeAlongDirection+=this.controllerMovementSinceLastFrame();let i=1;this.controller.type===0&&(i=Math.max(0,1+this.totalChangeAlongDirection*2/n),i=i*i*i),this.grabDistance/n<.8&&(i=1),this.targetDir||(this.targetDir=new q),this.targetDir.set(0,0,-this.grabDistance*i);const r=this.targetDir.applyQuaternion(this.controller.rayRotation).add(this.controllerWorldPos),o=this.controller.rayRotation.clone().multiplyQuaternions(this.controller.rayRotation,this.localQuaternionToGrab);this.quaternionLerp||(this.quaternionLerp=o.clone()),this.quaternionLerp.slerp(o,this.controller.useSmoothing?this.controller.context.time.deltaTime/.03:1),Nr(this.selected,this.quaternionLerp),this.selected.updateWorldMatrix(!1,!1),this.grabPoint.copy(r),this.localPositionOffsetToGrab&&(this.localPositionOffsetToGrab_worldSpace.copy(this.localPositionOffsetToGrab),this.selected.localToWorld(this.localPositionOffsetToGrab_worldSpace).sub(ti(this.selected)),r.sub(this.localPositionOffsetToGrab_worldSpace)),ys(this.selected,r)}if(this.rigidbodies!=null)for(const n of this.rigidbodies)n.wakeUp(),n.setBodyFromGameObject({x:0,y:0,z:0});ro.markDirty(this.selected,!0)}}};let oa=br;E(oa,"Events",{}),E(oa,"Current",[]);var jZ=Object.defineProperty,qZ=Object.getOwnPropertyDescriptor,sO=(a,e,t,n)=>{for(var i=n>1?void 0:n?qZ(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&jZ(e,t,i),i};class zf extends Bt{constructor(){super(...arguments);E(this,"webAR",null);E(this,"invertForward",!1);E(this,"_arScale",5);E(this,"_rig",null);E(this,"_startPose",null);E(this,"_placementPose",null);E(this,"_isTouching",!1)}get arScale(){return this._arScale}set arScale(t){t!==this._arScale&&(this._arScale=t,this.setScale(t))}onBegin(t){this._placementPose=null,this.gameObject.visible=!1,this.gameObject.matrixAutoUpdate=!1,this._startPose=this.gameObject.matrix.clone(),t.addEventListener("selectstart",this.onSelectStart.bind(this)),t.addEventListener("selectend",this.onSelectEnd.bind(this)),setTimeout(()=>this.gameObject.visible=!1,1e3)}onUpdate(t,n,i){if(i&&!this._placementPose&&this._isTouching){if(this.webAR&&this.webAR.setReticleActive(!1),this._placementPose=new xn().fromArray(i.transform.matrix).invert(),t){if(this.invertForward){const r=new xn().makeRotationY(Math.PI);this._placementPose.premultiply(r)}this._rig=t,this.setScale(this.arScale)}else this._rig=null;this.gameObject.visible=!0}}onEnd(t,n){this._placementPose=null,this.gameObject.visible=!1,this._startPose&&this.gameObject.matrix.copy(this._startPose),this.gameObject.matrixAutoUpdate=!0,t&&(t.matrixAutoUpdate=!0),ro.markDirty(this.gameObject,!0),setTimeout(()=>this.gameObject.visible=!0,100)}onSelectStart(){this._isTouching=!0}onSelectEnd(){this._isTouching=!1}setScale(t){const n=this._rig;!n||!this._placementPose||(n.matrixAutoUpdate=!1,n.matrix.multiplyMatrices(new xn().makeScale(t,t,t),this._placementPose),n.matrix.decompose(n.position,n.quaternion,n.scale),n.updateMatrixWorld())}}sO([Re()],zf.prototype,"invertForward",2);sO([Re()],zf.prototype,"arScale",1);class CS extends Bt{awake(){}}const Xh=jt("debugaddressables");class XZ{constructor(e){E(this,"_context");E(this,"_assetReferences",{});this._context=e,this._context.pre_update_callbacks.push(this.preUpdate.bind(this))}preUpdate(){}findAssetReference(e){return this._assetReferences[e]||null}registerAssetReference(e){return e.uri&&(this._assetReferences[e.uri]?console.warn("Asset reference already registered",e):this._assetReferences[e.uri]=e),e}}class Nc{constructor(e){E(this,"_loading");E(this,"_asset");E(this,"_glbRoot");E(this,"_uri");E(this,"_progressListeners",[]);E(this,"_isLoadingRawBinary",!1);E(this,"_rawBinary");this._uri=e,r9(this._uri,this.onResolvePrefab.bind(this))}static getOrCreate(e,t,n){const i=v2(e,t);Xh&&console.log("GetOrCreate Addressable from",e,t,"FinalPath=",i);const r=n.addressables,o=r.findAssetReference(i);if(o)return o;const l=new Nc(i);return r.registerAssetReference(l),l}get asset(){var e;return(e=this._glbRoot)!=null?e:this._asset}set asset(e){this._asset=e}get uri(){return this._uri}get rawAsset(){return this._asset}async onResolvePrefab(e){return e===this.uri&&(this.mustLoad&&await this.loadAssetAsync(),this.asset)?this.asset:null}get mustLoad(){return!this.asset||this.asset.__destroyed===!0}isLoaded(){return this._rawBinary||this.asset!==void 0}unload(){this.asset&&(Xh&&console.log("Unload",this.asset),this.asset.scene?Te.destroy(this.asset.scene):Te.destroy(this.asset)),this.asset=null}async preload(){var t;if(!this.mustLoad||this._isLoadingRawBinary)return null;if(this._rawBinary!==void 0)return this._rawBinary;this._isLoadingRawBinary=!0,Xh&&console.log("Preload",this.uri);const e=await nZ(this.uri,n=>{this.raiseProgressEvent(n)});return this._rawBinary=(t=e==null?void 0:e.buffer)!=null?t:null,this._isLoadingRawBinary=!1,this._rawBinary}async loadAssetAsync(e){if(!this.mustLoad)return;if(e&&this._progressListeners.push(e),this._loading!==void 0)return this._loading;const t=_i.Current;this._rawBinary?(this._loading=zv(t,this._rawBinary,this.uri,null),this.raiseProgressEvent(new ProgressEvent("progress",{loaded:this._rawBinary.byteLength,total:this._rawBinary.byteLength}))):(Xh&&console.log("Load async",this.uri),this._loading=iA(t,this.uri,null,!0,i=>{this.raiseProgressEvent(i)}));const n=await this._loading;if(this._progressListeners.length=0,this._glbRoot=this.tryGetActualGameObjectRoot(n),this._loading=void 0,n)return Km(t),n.scene!==void 0&&(this.asset=n),this.asset}async instantiate(e){return this.onInstantiate(e,!1)}async instantiateSynced(e,t=!0){return this.onInstantiate(e,!0,t)}beginListenDownload(e){this._progressListeners.indexOf(e)<0&&this._progressListeners.push(e)}endListenDownload(e){const t=this._progressListeners.indexOf(e);t>=0&&this._progressListeners.splice(t,1)}raiseProgressEvent(e){for(const t of this._progressListeners)t(this,e)}async onInstantiate(e,t=!1,n){const i=_i.Current;if(e||(e=i.scene),this.mustLoad&&await this.loadAssetAsync(),Xh&&console.log("Instantiate",this.uri,"parent:",e),this.asset){Xh&&console.log("Add to scene",this.asset);let r=e instanceof Fo?e:null;if(r||(r=new Fo),typeof e=="object"&&(e instanceof qt?r.parent=e:Object.assign(r,e)),t){r.context=i;const o=this.asset;o.guid=this.uri;const l=P2(o,r,void 0,n);if(l)return l}else{const o=Te.instantiate(this.asset,r);if(o)return o}}else Xh&&console.warn("Failed to load asset",this.uri);return null}tryGetActualGameObjectRoot(e){if(e&&e.scene){const t=e.scene;return t.isGroup&&t.children.length===1&&t.children[0].name+"glb"===t.name?t.children[0]:t}return null}}class YZ extends kg{constructor(){super([Nc])}onSerialize(e,t){if(e&&e.uri!==void 0&&typeof e.uri=="string")return e.uri}onDeserialize(e,t){return typeof e=="string"?t.context?t.gltfId?Nc.getOrCreate(t.gltfId,e,t.context):(console.error("Missing spurce id"),null):(console.error("Missing context"),null):null}}new YZ;class hf{constructor(){E(this,"bb",null);E(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}x(){return this.bb.readFloat32(this.bb_pos)}y(){return this.bb.readFloat32(this.bb_pos+4)}z(){return this.bb.readFloat32(this.bb_pos+8)}w(){return this.bb.readFloat32(this.bb_pos+12)}static sizeOf(){return 16}static createVec4(e,t,n,i,r){return e.prep(4,16),e.writeFloat32(r),e.writeFloat32(i),e.writeFloat32(n),e.writeFloat32(t),e.offset()}}class hr{constructor(){E(this,"bb",null);E(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsVrUserStateBuffer(e,t){return(t||new hr).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsVrUserStateBuffer(e,t){return e.setPosition(e.position()+tv),(t||new hr).__init(e.readInt32(e.position())+e.position(),e)}guid(e){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}time(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readInt64(this.bb_pos+e):this.bb.createLong(0,0)}avatarId(e){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__string(this.bb_pos+t,e):null}position(e){const t=this.bb.__offset(this.bb_pos,10);return t?(e||new co).__init(this.bb_pos+t,this.bb):null}rotation(e){const t=this.bb.__offset(this.bb_pos,12);return t?(e||new hf).__init(this.bb_pos+t,this.bb):null}scale(){const e=this.bb.__offset(this.bb_pos,14);return e?this.bb.readFloat32(this.bb_pos+e):0}posLeftHand(e){const t=this.bb.__offset(this.bb_pos,16);return t?(e||new co).__init(this.bb_pos+t,this.bb):null}posRightHand(e){const t=this.bb.__offset(this.bb_pos,18);return t?(e||new co).__init(this.bb_pos+t,this.bb):null}rotLeftHand(e){const t=this.bb.__offset(this.bb_pos,20);return t?(e||new hf).__init(this.bb_pos+t,this.bb):null}rotRightHand(e){const t=this.bb.__offset(this.bb_pos,22);return t?(e||new hf).__init(this.bb_pos+t,this.bb):null}static startVrUserStateBuffer(e){e.startObject(10)}static addGuid(e,t){e.addFieldOffset(0,t,0)}static addTime(e,t){e.addFieldInt64(1,t,e.createLong(0,0))}static addAvatarId(e,t){e.addFieldOffset(2,t,0)}static addPosition(e,t){e.addFieldStruct(3,t,0)}static addRotation(e,t){e.addFieldStruct(4,t,0)}static addScale(e,t){e.addFieldFloat32(5,t,0)}static addPosLeftHand(e,t){e.addFieldStruct(6,t,0)}static addPosRightHand(e,t){e.addFieldStruct(7,t,0)}static addRotLeftHand(e,t){e.addFieldStruct(8,t,0)}static addRotRightHand(e,t){e.addFieldStruct(9,t,0)}static endVrUserStateBuffer(e){return e.endObject()}static finishVrUserStateBufferBuffer(e,t){e.finish(t)}static finishSizePrefixedVrUserStateBufferBuffer(e,t){e.finish(t,void 0,!0)}}const OP=jt("debugxr"),cm=jt("debugavatar"),SS="VRUS";uS(SS,hr.getRootAsVrUserStateBuffer);function PE(){return new Date().getTime()}function JZ(a){let e=a&4294967295,t=a/Math.pow(2,32)&1048575;return Ga.create(e,t)}const Gm=class{constructor(e){E(this,"guid");E(this,"time");E(this,"avatarId");E(this,"position",new q);E(this,"rotation",new On);E(this,"scale",1);E(this,"posLeftHand",new q);E(this,"posRightHand",new q);E(this,"rotLeftHand",new Ot);E(this,"rotRightHand",new Ot);this.guid=e}update(e,t,n,i,r){var f,g,m,A,v,w;this.time=PE(),this.avatarId=r,this.position.set(t.x,t.y,t.z),e&&this.position.applyMatrix4(e.matrixWorld);let o=Gm.quat0;const l=Gm.quat1;o.set(n.x,n.y,n.z,n.w),o=o.multiplyQuaternions(o,Gm.invertRotation),e&&(e.getWorldQuaternion(l),o.multiplyQuaternions(l,o)),this.rotation.set(o.x,o.y,o.z,o.w),this.scale=e.scale.x;const h=(f=i.LeftController)==null?void 0:f.controllerGrip;h&&(h.getWorldPosition(this.posLeftHand),h.getWorldQuaternion(this.rotLeftHand));const u=(g=i.RightController)==null?void 0:g.controllerGrip;if(u&&(u.getWorldPosition(this.posRightHand),u.getWorldQuaternion(this.rotRightHand)),(A=(m=i.LeftController)==null?void 0:m.hand)!=null&&A.visible){const b=i.LeftController.wrist;b&&(b.getWorldPosition(this.posLeftHand),b.getWorldQuaternion(this.rotLeftHand))}if((w=(v=i.RightController)==null?void 0:v.hand)!=null&&w.visible){const b=i.RightController.wrist;b&&(b.getWorldPosition(this.posRightHand),b.getWorldQuaternion(this.rotRightHand))}}sendAsBuffer(e,t){e.clear();const n=e.createString(this.guid),i=e.createString(this.avatarId);hr.startVrUserStateBuffer(e),hr.addGuid(e,n),hr.addTime(e,JZ(this.time)),hr.addAvatarId(e,i),hr.addPosition(e,co.createVec3(e,this.position.x,this.position.y,this.position.z)),hr.addRotation(e,hf.createVec4(e,this.rotation.x,this.rotation.y,this.rotation.z,this.rotation.w)),hr.addScale(e,this.scale),hr.addPosLeftHand(e,co.createVec3(e,this.posLeftHand.x,this.posLeftHand.y,this.posLeftHand.z)),hr.addPosRightHand(e,co.createVec3(e,this.posRightHand.x,this.posRightHand.y,this.posRightHand.z)),hr.addRotLeftHand(e,hf.createVec4(e,this.rotLeftHand.x,this.rotLeftHand.y,this.rotLeftHand.z,this.rotLeftHand.w)),hr.addRotRightHand(e,hf.createVec4(e,this.rotRightHand.x,this.rotRightHand.y,this.rotRightHand.z,this.rotRightHand.w));const r=hr.endVrUserStateBuffer(e);e.finish(r,SS);const o=e.asUint8Array();t.sendBinary(o)}setFromBuffer(e,t){if(!e)return;this.guid=e,this.time=t.time().toFloat64();const n=t.avatarId();n&&(this.avatarId=n);const i=t.position();i&&this.position.set(i.x(),i.y(),i.z());const r=t.rotation();r&&this.rotation.set(r.x(),r.y(),r.z(),r.w());const o=t.posLeftHand();o&&this.posLeftHand.set(o.x(),o.y(),o.z());const l=t.posRightHand();l&&this.posRightHand.set(l.x(),l.y(),l.z());const h=t.rotLeftHand();h&&this.rotLeftHand.set(h.x(),h.y(),h.z(),h.w());const u=t.rotRightHand();u&&this.rotRightHand.set(u.x(),u.y(),u.z(),u.w()),this.scale=t.scale()}};let Da=Gm;E(Da,"invertRotation",new Ot().setFromAxisAngle(new q(0,1,0),Math.PI)),E(Da,"quat0",new Ot),E(Da,"quat1",new Ot);class cy extends Bt{constructor(){super(...arguments);E(this,"webXR",null);E(this,"debugAvatarUser",null);E(this,"voip",null);E(this,"tempState",new Da(""));E(this,"_removeAvatarsList",[]);E(this,"eventSub_ConnectionEvent",null);E(this,"eventSub_WebXRStartEvent",null);E(this,"eventSub_WebXREndEvent",null);E(this,"eventSub_WebXRUpdateEvent",null);E(this,"avatars",{});E(this,"localAvatar",null);E(this,"k_LocalAvatarNoNetworkingGuid","local");E(this,"ownership",null);E(this,"xrState",null);E(this,"builder",new Of(1024))}async awake(){if(this.webXR||(this.webXR=this.gameObject.getComponent(Ti)),this.webXR||(this.webXR=Te.findObjectOfType(Ti,this.context)),!this.webXR&&(console.log("Missing webxr component"),this.webXR=Te.findObjectOfType(Ti,this.context),!this.webXR)){console.error("Could not find webxr component");return}if(this.voip||(this.voip=Te.findObjectOfType(lh,this.context)),cm){const t="debug-avatar-"+cm,n=new Rc(this.context,t,this.webXR);if(this.debugAvatarUser=n,typeof cm=="string"&&cm.length>0)if(await n.setAvatarOverride(cm)){const i=new Da(t);i.position.y+=1;const r=.5;i.posLeftHand.y+=r,i.posLeftHand.x+=r,i.posRightHand.y+=r,i.posRightHand.x-=r,n.tryUpdate(i,0)}else n.destroy()}}onEnable(){if(!this.webXR&&(this.webXR=Te.getComponent(this.gameObject,Ti),!this.webXR)){console.warn("Missing webxr component on "+this.gameObject.name);return}this.eventSub_WebXRStartEvent=this.onXRSessionStart.bind(this),Ti.addEventListener(Ks.XRStarted,this.eventSub_WebXRStartEvent),this.eventSub_WebXRUpdateEvent=this.onXRSessionUpdate.bind(this),Ti.addEventListener(Ks.XRUpdate,this.eventSub_WebXRUpdateEvent),this.eventSub_WebXREndEvent=this.onXRSessionEnded.bind(this),Ti.addEventListener(Ks.XRStopped,this.eventSub_WebXREndEvent),this.eventSub_ConnectionEvent=this.onConnected.bind(this),this.context.connection.beginListen(ha.JoinedRoom,this.eventSub_ConnectionEvent),this.context.connection.beginListen("webxr-user-joined",t=>{console.log("webxr user joined evt")}),this.context.connection.beginListen("webxr-user-left",t=>{const n=t.id!==null&&t.id!==void 0;if(!!n&&(console.log("webxr user left evt"),n)){const i=this.avatars[t.id];i==null||i.destroy(),this.avatars[t.id]=void 0}}),this.context.connection.beginListenBinrary(SS,t=>{const n=t.guid();if(!n)return;const i=t.time().toFloat64(),r=this.tempState;r.setFromBuffer(n,t);const o=this.onTryGetAvatar(n,i);o==null||o.tryUpdate(r,i)}),this.context.connection.beginListen("vr-session-update",t=>{const n=t.guid,i=t.time,r=this.onTryGetAvatar(n,i);r==null||r.tryUpdate(t,i)})}onTryGetAvatar(t,n){if(t===this.context.connection.connectionId)return null;const i=new Date().getTime()-n;if(i>5e3)return OP&&console.log("old data",i,t),null;let r=this.avatars[t];if(r===void 0)try{console.log("create new avatar");const o=new Rc(this.context,t,this.webXR);r=o,this.avatars[t]=o}catch(o){this.avatars[t]=null,console.error(o)}return r}onDisable(){this.eventSub_ConnectionEvent&&this.context.connection.stopListening(ha.JoinedRoom,this.eventSub_ConnectionEvent),Ti.removeEventListener(Ks.XRStarted,this.eventSub_WebXRStartEvent),Ti.removeEventListener(Ks.XRUpdate,this.eventSub_WebXRUpdateEvent),Ti.removeEventListener(Ks.XRStopped,this.eventSub_WebXREndEvent)}update(){const t=PE();this.debugAvatarUser&&(this.debugAvatarUser.lastUpdate=t),this.detectPotentiallyDisconnectedAvatarsAndRemove();for(const n in this.avatars){const i=this.avatars[n];!i||i.update()}}detectPotentiallyDisconnectedAvatarsAndRemove(){const t=PE();for(const n in this.avatars){const i=this.avatars[n];if(!i){this._removeAvatarsList.push(n);continue}t-i.lastUpdate>1e4&&(console.log("avatar timed out (didnt receive any updates in  a while) - destroying it now"),i.destroy(),this.avatars[n]=void 0)}for(const n of this._removeAvatarsList)delete this.avatars[n];this._removeAvatarsList.length=0}buildLocalAvatar(){var n,i;if(this.localAvatar)return;const t=(i=(n=this.context.connection)==null?void 0:n.connectionId)!=null?i:this.k_LocalAvatarNoNetworkingGuid;this.localAvatar=new Rc(this.context,t,this.webXR),this.localAvatar.isLocalAvatar=!0,this.localAvatar.setAvatarOverride(this.getAvatarId()),this.avatars[this.localAvatar.guid]=this.localAvatar}onConnected(){var t,n,i;OP&&console.log("Hey you are connected as "+this.context.connection.connectionId),((t=this.localAvatar)==null?void 0:t.guid)===this.k_LocalAvatarNoNetworkingGuid&&(this.localAvatar&&((n=this.localAvatar)==null||n.destroy(),this.avatars[this.localAvatar.guid]=void 0),this.localAvatar=null,this.xrState=null,(i=this.ownership)==null||i.freeOwnership(),this.ownership=null)}onXRSessionStart(t){var n,i,r;if(console.log("XR session started"),this.context.connection.send("webxr-user-joined",{id:this.context.connection.connectionId,mode:"vr"}),this.localAvatar&&((n=this.localAvatar)==null||n.destroy(),this.avatars[this.localAvatar.guid]=void 0,this.localAvatar=null),this.xrState=null,(i=this.ownership)==null||i.freeOwnership(),this.ownership=null,this.avatars)for(const o in this.avatars)(r=this.avatars[o])==null||r.updateFlags()}onXRSessionEnded(t){console.log("XR session ended"),this.context.connection.send("webxr-user-left",{id:this.context.connection.connectionId,mode:"vr"})}onXRSessionUpdate(t){var f,g,m,A,v;(g=this.xrState)!=null||(this.xrState=new Da((f=this.context.connection.connectionId)!=null?f:this.k_LocalAvatarNoNetworkingGuid)),(A=this.ownership)!=null||(this.ownership=new dS(this.context.connection,(m=this.context.connection.connectionId)!=null?m:this.k_LocalAvatarNoNetworkingGuid)),this.ownership.guid=(v=this.context.connection.connectionId)!=null?v:this.k_LocalAvatarNoNetworkingGuid,this.buildLocalAvatar();const{frame:n,xr:i,rig:r}=t,o=n.getViewerPose(i.getReferenceSpace());if(!o)return;const l=o==null?void 0:o.transform,h=l.position,u=l.orientation;this.xrState.update(r,h,u,this.webXR,this.getAvatarId()),this.localAvatar&&(this.context.connection.connectionId&&(this.localAvatar.guid=this.context.connection.connectionId),this.localAvatar.tryUpdate(this.xrState,0)),!(this.ownership&&!this.ownership.hasOwnership&&this.context.connection.isConnected&&(this.context.time.frameCount%120===0&&this.ownership.requestOwnership(),!this.ownership.hasOwnership))&&(!this.context.connection.isConnected||!this.context.connection.connectionId||this.xrState.sendAsBuffer(this.builder,this.context.connection))}getAvatarId(){return jt("avatar")}}var ZZ=Object.defineProperty,KZ=Object.getOwnPropertyDescriptor,$Z=(a,e,t,n)=>{for(var i=n>1?void 0:n?KZ(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&ZZ(e,t,i),i};async function eK(){return"xr"in navigator?await navigator.xr.isSessionSupported("immersive-ar")===!0:!1}async function tK(){return"xr"in navigator?await navigator.xr.isSessionSupported("immersive-vr")===!0:!1}let BE=!1,LE=!1;eK().then(a=>BE=a);tK().then(a=>LE=a);var Ks=(a=>(a.XRStarted="xrStarted",a.XRStopped="xrStopped",a.XRUpdate="xrUpdate",a.RequestVRSession="requestVRSession",a))(Ks||{}),__;const Zs=(__=class extends Bt{constructor(){super(...arguments);E(this,"enableVR",!0);E(this,"enableAR",!0);E(this,"defaultAvatar");E(this,"createVRButton",!0);E(this,"createARButton",!0);E(this,"controllers",[]);E(this,"rig");E(this,"isInit",!1);E(this,"_requestedAR",!1);E(this,"_requestedVR",!1);E(this,"_isInAR",!1);E(this,"_isInVR",!1);E(this,"_arButton");E(this,"_vrButton");E(this,"webAR",null);E(this,"_transformOrientation",new Ot);E(this,"_currentHeadPose",null);E(this,"_originalCameraParent",null);E(this,"_originalCameraPosition",new q);E(this,"_originalCameraRotation",new Ot);E(this,"xrMirrorWindow",null)}static get IsInWebXR(){return this._isInXr}static get XRSupported(){return"xr"in navigator&&(BE||LE)}static get IsARSupported(){return BE}static get IsVRSupported(){return LE}static addEventListener(e,t){return this.events.addEventListener(e,t),t}static removeEventListener(e,t){return this.events.removeEventListener(e,t),t}static createVRButton(e,t){var i;Zs.XRSupported||console.warn("WebXR is not supported on this device");const n=Pm.createButton(e.context.renderer);return n.classList.add("webxr-ar-button"),n.classList.add("webxr-button"),this.resetButtonStyles(n),((i=t==null?void 0:t.registerClick)==null||i)&&n.addEventListener("click",e.onClickedVRButton.bind(e)),n}static createARButton(e,t){var o,l;const n=(o=e.webAR)==null?void 0:o.getAROverlayContainer(),i={requiredFeatures:["hit-test"]};n&&(i.domOverlay={root:n},i.optionalFeatures=["dom-overlay"]);const r=gZ.createButton(e.context.renderer,i);return r.classList.add("webxr-ar-button"),r.classList.add("webxr-button"),Zs.resetButtonStyles(r),((l=t==null?void 0:t.registerClick)==null||l)&&r.addEventListener("click",e.onClickedARButton.bind(e)),r}static resetButtonStyles(e){!e||(e.style.position="",e.style.bottom="",e.style.left="")}endSession(){const e=this.context.renderer.xr.getSession();e&&e.end()}get Rig(){return this.rig}get Controllers(){return this.controllers}get LeftController(){var e,t;return this.controllers.length>0&&((e=this.controllers[0].input)==null?void 0:e.handedness)==="left"?this.controllers[0]:this.controllers.length>1&&((t=this.controllers[1].input)==null?void 0:t.handedness)==="left"?this.controllers[1]:null}get RightController(){var e,t;return this.controllers.length>0&&((e=this.controllers[0].input)==null?void 0:e.handedness)==="right"?this.controllers[0]:this.controllers.length>1&&((t=this.controllers[1].input)==null?void 0:t.handedness)==="right"?this.controllers[1]:null}get ARButton(){return this._arButton}get VRButton(){return this._vrButton}get IsInVR(){return this._isInVR}get IsInAR(){return this._isInAR}awake(){var e;if(this.defaultAvatar&&typeof this.defaultAvatar=="string"&&(this.defaultAvatar=Nc.getOrCreate((e=this.sourceId)!=null?e:"/",this.defaultAvatar,this.context)),!Te.findObjectOfType(cy,this.context)){const t=Te.addNewComponent(this.gameObject,cy,!1);t.webXR=this}}onEnable(){if(this.isInit||!this.enableAR&&!this.enableVR)return;this.isInit=!0,this.context.renderer.xr.enabled=!0,this.webAR=new uf(this);const e=Zs.XRSupported;let t,n;const i=document.createElement("div");i.classList.add("webxr-buttons"),this.context.domElement.append(i),this.enableAR&&this.createARButton&&(t=Zs.createARButton(this),this._arButton=t,i.appendChild(t)),this.createVRButton&&this.enableVR&&(e||!this.enableAR)&&(n=Zs.createVRButton(this),this._vrButton=n,i.appendChild(n)),setTimeout(()=>{Zs.resetButtonStyles(n),Zs.resetButtonStyles(t)},1e3)}get TransformOrientation(){return this._transformOrientation}get HeadPose(){return this._currentHeadPose}onBeforeRender(e){var n;if(!e)return;const t=this.context.renderer.xr.getSession();if(t){const i=e.getViewerPose(this.context.renderer.xr.getReferenceSpace());if(this._currentHeadPose=i,!i)return;const r=i==null?void 0:i.transform;r&&this._transformOrientation.set(r.orientation.x,r.orientation.y,r.orientation.z,r.orientation.w);for(const o of this.controllers)o.onUpdate(t);this._isInAR&&((n=this.webAR)==null||n.onUpdate(t,e))}Zs._isInXr===!1&&t&&this.onEnterXR(t,e),Zs.events.dispatchEvent({type:"xrUpdate",frame:e,xr:this.context.renderer.xr,rig:this.rig})}onClickedARButton(){this._isInAR||(this._requestedAR=!0,this._requestedVR=!1,this.captureCameraState())}onClickedVRButton(){if(!this._isInVR){if(this._requestedVR){this.onExitXR(null);return}this._requestedAR=!1,this._requestedVR=!0,this.captureCameraState(),this.ensureRig();for(let e=0;e<2;e++)gs.Create(this,e,this.gameObject,bS.PhysicalDevice);Zs.events.dispatchEvent({type:"requestVRSession"})}}captureCameraState(){this.context.mainCamera&&(this._originalCameraPosition.copy(ti(this.context.mainCamera)),this._originalCameraRotation.copy(uo(this.context.mainCamera)),this._originalCameraParent=this.context.mainCamera.parent)}ensureRig(){if(!this.rig){const e=Te.findObjectOfType(CS,this.context);e?(this.rig=e.gameObject,this.rig.rotateY(Math.PI)):(this.rig=new sa,this.rig.name="XRRig",this.context.scene.add(this.rig))}}onEnterXR(e,t){var o;console.log("[XR] session begin",e),Zs._isInXr=!0,this.ensureRig();const n=this.context.renderer.xr.getReferenceSpace();if(n&&this.rig){const l=t.getViewerPose(n),h=l==null?void 0:l.transform.orientation;if(h){const u=new Ot(h.x,h.y,h.z,h.w),f=new vs().setFromQuaternion(u);this.rig.rotateY(f.y)}}const i=this.context.renderer.xr;if(this.context.mainCamera){const l=i.getCamera(this.context.mainCamera);for(const h of l.cameras)h.layers.enableAll();this.rig.add(this.context.mainCamera)}const r=this._requestedAR?Cr.AR:Cr.VR;switch(Ha.Global.Set(r),r){case Cr.AR:this._isInAR=!0,(o=this.webAR)==null||o.onBegin(e);break;case Cr.VR:this._isInVR=!0,this.onEnterVR(e);break}e.addEventListener("end",()=>{console.log("[XR] session end"),Zs._isInXr=!1,this.onExitXR(e)}),this.onEnterXR_HandleMirrorWindow(e),Zs.events.dispatchEvent({type:"xrStarted",session:e})}onExitXR(e){var t,n;this._isInAR&&e&&((t=this.webAR)==null||t.onEnd(e)),this._isInAR=!1,this._isInVR=!1,this._requestedAR=!1,this._requestedVR=!1,this.xrMirrorWindow&&(this.xrMirrorWindow.close(),this.xrMirrorWindow=null),this.destroyControllers(),this.context.mainCamera&&((n=this._originalCameraParent)==null||n.add(this.context.mainCamera),ys(this.context.mainCamera,this._originalCameraPosition),Nr(this.context.mainCamera,this._originalCameraRotation),this.context.mainCamera.scale.set(1,1,1)),Ha.Global.Set(Cr.Browser|Cr.ThirdPerson),Zs.events.dispatchEvent({type:"xrStopped",session:e})}onEnterVR(e){}destroyControllers(){var e;for(let t=this.controllers.length-1;t>=0;t-=1)(e=this.controllers[t])==null||e.destroy();this.controllers.length=0}onEnterXR_HandleMirrorWindow(e){!jt("mirror")||setTimeout(()=>{if(!Zs.IsInWebXR)return;const t=new URL(window.location.href);$_(t.searchParams,oy,1),$_(t.searchParams,"isMirror",1);const n=t.toString();this.xrMirrorWindow=window.open(n,"webxr sync","popup=yes"),this.xrMirrorWindow&&(this.xrMirrorWindow.onload=()=>{this.xrMirrorWindow&&(this.xrMirrorWindow.onbeforeunload=()=>{Zs.IsInWebXR&&e.end()})})},1e3)}},E(__,"_isInXr",!1),E(__,"events",new Uo),__);let Ti=Zs;$Z([Re(Nc)],Ti.prototype,"defaultAvatar",2);const af=class{constructor(e){E(this,"webxr");E(this,"reticle",null);E(this,"hitTestSource",null);E(this,"reticleActive",!0);E(this,"previousBackground",null);E(this,"previousEnvironment",null);E(this,"sessionRoot",null);E(this,"_previousParent",null);E(this,"arDomOverlay",null);E(this,"arOverlayElement",null);this.webxr=e}get context(){return this.webxr.context}getAROverlayContainer(){return this.arDomOverlay=this.webxr.context.domElement,this.arOverlayElement=this.arDomOverlay.getAROverlayContainer(),this.arOverlayElement}setReticleActive(e){this.reticleActive=e}onBegin(e){var n,i;const t=this.webxr.context;this.reticleActive=!0;for(let r=0;r<4;r++)gs.Create(this.webxr,r,this.webxr.gameObject,bS.Touch);(!this.sessionRoot||this.sessionRoot.destroyed||!this.sessionRoot.activeAndEnabled)&&(this.sessionRoot=Te.findObjectOfType(zf,t)),this.previousBackground=t.scene.background,this.previousEnvironment=t.scene.environment,t.scene.background=null,e.requestReferenceSpace("viewer").then(r=>{e.requestHitTestSource({space:r}).then(o=>{this.hitTestSource=o})}),!this.reticle&&this.sessionRoot&&(this.reticle=new _t(new Pf(.07,.09,32).rotateX(-Math.PI/2),new Hi),this.reticle.name="AR Placement reticle",this.reticle.matrixAutoUpdate=!1,this.reticle.visible=!1,this.webxr.scene?(this.webxr.scene.add(this.reticle),this.webxr.scene.visible=!0):console.warn("Could not found WebXR Rig")),this._previousParent=this.webxr.gameObject,af.tempWebXRObject||(af.tempWebXRObject=new qt),this.context.scene.add(af.tempWebXRObject),Te.addComponent(af.tempWebXRObject,this.webxr),this.sessionRoot?(this.sessionRoot.webAR=this,(n=this.sessionRoot)==null||n.onBegin(e)):console.warn("No WebARSessionRoot found in scene"),this.arDomOverlay&&this.arOverlayElement&&this.arDomOverlay.onEnterAR(e,this.arOverlayElement),(i=this.context.mainCameraComponent)==null||i.applyClearFlagsIfIsActiveCamera()}onEnd(e){var n;this._previousParent&&(console.log("ADD",this._previousParent),Te.addComponent(this._previousParent,this.webxr),this._previousParent=null),this.hitTestSource=null;const t=this.webxr.context;t.scene.background=this.previousBackground,t.scene.environment=this.previousEnvironment,this.sessionRoot&&this.sessionRoot.onEnd(this.webxr.Rig,e),this.arDomOverlay&&this.arDomOverlay.onExitAR(e),(n=this.context.mainCameraComponent)==null||n.applyClearFlagsIfIsActiveCamera()}onUpdate(e,t){var i,r;if(!this.hitTestSource)return;const n=t.getHitTestResults(this.hitTestSource);if(n.length){const o=n[0],l=this.webxr.context.renderer.xr.getReferenceSpace();if(l){const h=o.getPose(l);if((i=this.sessionRoot)==null||i.onUpdate(this.webxr.Rig,e,h),this.reticle&&(this.reticle.visible=this.reticleActive,this.reticleActive&&h)){const u=h.transform.matrix;this.reticle.matrix.fromArray(u),this.webxr.Rig&&this.reticle.matrix.premultiply(this.webxr.Rig.matrix)}}}else(r=this.sessionRoot)==null||r.onUpdate(this.webxr.Rig,e,null),this.reticle&&(this.reticle.visible=!1)}};let uf=af;E(uf,"tempWebXRObject");var rO=(a=>(a.SelectStart="selectstart",a.SelectEnd="selectend",a))(rO||{});const cf=class extends Ug{constructor(){super();E(this,"transformSelf",!0);E(this,"selectStartEventListener",[]);E(this,"selectEndEventListener",[]);E(this,"_dragHelper",null);E(this,"_draggingRigidbodies",[]);E(this,"_waitingForDragStart",null);E(this,"_isDragging",!1);E(this,"_marker",null);E(this,"_dragDelta");E(this,"_didDrag",!1);this.selectStartEventListener=[],this.selectEndEventListener=[],this._dragDelta=new Xe}static get HasAnySelected(){return this._active!==null}addDragEventListener(t,n){switch(t){case"selectstart":this.selectStartEventListener.push(n);break;case"selectend":this.selectEndEventListener.push(n);break}}start(){}allowEdit(t=null){return this.context.connection.allowEditing}onPointerEnter(t){if(!this.allowEdit(this.gameObject)||Ti.IsInWebXR)return;const n=Te.getComponentInParent(t.object,cf);!n||n!==this||(cf.lastHovered=t.object,this.context.domElement.style.cursor="pointer")}onPointerExit(t){!this.allowEdit(this.gameObject)||Ti.IsInWebXR||cf.lastHovered===t.object&&(this.context.domElement.style.cursor="auto")}onPointerDown(t){!this.allowEdit(this.gameObject)||Ti.IsInWebXR||(this._dragDelta.set(0,0),this._didDrag=!1,this._waitingForDragStart=t,t.StopPropagation())}onPointerUp(t){this._waitingForDragStart=null,this.allowEdit(this.gameObject)&&(Ti.IsInWebXR||(this.onDragEnd(t),t.StopPropagation()))}update(){var t;if(!Ti.IsInWebXR){if(this._waitingForDragStart){if(!this._didDrag){const i=this.context.input.getPointerPositionDelta(0);if(i&&this._dragDelta.add(i),this._dragDelta.length()>2)this._didDrag=!0;else return}const n=this._waitingForDragStart;this._waitingForDragStart=null,this.onDragStart(n)}this._dragHelper&&this._dragHelper.hasSelected&&this.onUpdateDrag(),this._isDragging&&!((t=this._dragHelper)!=null&&t.hasSelected)&&this.onDragEnd(null)}}onDragStart(t){if(!this._dragHelper)if(this.context.mainCamera)this._dragHelper=new M_(this.context.mainCamera);else return;if(!t||!t.object)return;const n=Te.getComponentInParent(t.object,cf);if(!n||n!==this)return;let i=t.object;this.transformSelf&&(i=this.gameObject);const r={selected:i,attached:i};for(const u of this.selectStartEventListener)u(this,r);if(!r.attached)return;r.attached,i=r.attached,this._isDragging=!0,this._dragHelper.setSelected(i,this.context);const o=Te.getComponentInChildren(i,$l);o&&(o.fastMode=!0,o==null||o.requestOwnership()),this._marker=Te.addNewComponent(i,zg),this._draggingRigidbodies.length=0;const l=Te.getComponentsInChildren(i,Tr);l&&this._draggingRigidbodies.push(...l);const h=BR();Te.invokeOnChildren(this._dragHelper.selected,h("onDragStart"))}onUpdateDrag(){if(!!this._dragHelper){this._dragHelper.onUpdate(this.context);for(const t of this._draggingRigidbodies)t.wakeUp(),t.setBodyFromGameObject()}}onDragEnd(t){if(!this||!this._isDragging||(this._isDragging=!1,!this._dragHelper))return;this._draggingRigidbodies.length=0;const n=this._dragHelper.selected;if(this._dragHelper.setSelected(null,this.context),t!=null&&t.object){const r=Te.getComponentInChildren(t.object,$l);r&&(r.fastMode=!1),this._marker&&this._marker.destroy()}for(const r of this.selectEndEventListener)r(this);const i=BR();Te.invokeOnChildren(n,i("onDragEnd"))}};let Pc=cf;E(Pc,"_active",null),E(Pc,"lastHovered");const TM=class{constructor(e){E(this,"_selected",null);E(this,"_context",null);E(this,"_camera");E(this,"_cameraPlane",new Po);E(this,"_hasGroundPlane",!1);E(this,"_groundPlane",new Po);E(this,"_groundOffset",new q);E(this,"_groundOffsetFactor",0);E(this,"_groundDistance",0);E(this,"_groundPlanePoint",new q);E(this,"_raycaster",new Du);E(this,"_cameraPlaneOffset",new q);E(this,"_intersection",new q);E(this,"_worldPosition",new q);E(this,"_inverseMatrix",new xn);E(this,"_rbs",[]);E(this,"_groundLine");E(this,"_groundMarker");E(this,"_groundOffsetVector",new q(0,1,0));E(this,"_requireUpdateGroundPlane",!0);E(this,"_didDragOnGroundPlaneLastFrame",!1);this._camera=e;const t=new Ss(TM.geometry),n=t.material;n.color=new _e(.4,.4,.4),t.layers.set(2),t.name="line",t.scale.y=1,this._groundLine=t;const i=new ho(.5,22,22),r=new Hi({color:n.color}),o=new _t(i,r);o.visible=!1,o.layers.set(2),this._groundMarker=o}get hasSelected(){return this._selected!==null&&this._selected!==void 0}get selected(){return this._selected}setSelected(e,t){if(this._selected&&t)for(const n of this._rbs)n.wakeUp(),n.smoothedVelocity&&n.setVelocity(n.smoothedVelocity.x,n.smoothedVelocity.y,n.smoothedVelocity.z);if(this._selected&&zr.Remove(t,this._selected),this._selected=e,this._context=t,this._rbs.length=0,e?(t.scene.add(this._groundLine),t.scene.add(this._groundMarker)):(this._groundLine.removeFromParent(),this._groundMarker.removeFromParent()),this._selected){if(!t){console.error("DragHelper: no context");return}zr.Add(t,this._selected,null),this._groundOffsetFactor=0,this._hasGroundPlane=!0,this._groundOffset.set(0,0,0),this._requireUpdateGroundPlane=!0,this._rbs=Te.getComponentsInChildren(this._selected,Tr),this.onUpdateScreenSpacePlane()}}onUpdate(e){var l,h,u,f,g;if(!this._context)return;const t=Dc.SPACE,n=Dc.KEY_D;Dc.KEY_S;const i=((l=this._context)==null?void 0:l.input.isKeyPressed(t))||((h=this._context)==null?void 0:h.input.isKeyPressed(n)),r=this._context.input.getTouchesPressedCount()>=2||i;if(r){const m=this._context.input.getPointerPositionDelta(0);m&&(this._groundOffsetVector.set(0,1,0),(u=this._selected)==null||u.rotateOnWorldAxis(this._groundOffsetVector,m.x*this._context.time.deltaTime))}const o=this._context.input.getPointerPositionRC(0);if(!!o&&(this._raycaster.setFromCamera(o,this._camera),this._selected)){this._groundOffsetVector.set(0,1,0);const m=ti(this._camera).clone().sub(ti(this._selected)).normalize(),A=Math.abs(m.dot(this._groundOffsetVector)),v=((f=this._context)==null?void 0:f.input.isKeyPressed(t))||((g=this._context)==null?void 0:g.input.isKeyPressed(n)),w=!r&&A>.2&&!v&&this._context.input.getPointerPressedCount()<=1,b=this._didDragOnGroundPlaneLastFrame!==w;if(this._didDragOnGroundPlaneLastFrame=w,this._hasGroundPlane||(this._requireUpdateGroundPlane=!0),(this._requireUpdateGroundPlane||!w||b)&&this.onUpdateGroundPlane(),this._requireUpdateGroundPlane=!1,this._hasGroundPlane)if(this._raycaster.ray.intersectPlane(this._groundPlane,this._intersection)){const S=this._intersection.y;if(this._groundPlanePoint.copy(this._intersection).sub(this._groundOffset),this._groundPlanePoint.y=S,w){this._groundOffsetVector.set(0,1,0);const R=this._intersection.sub(this._groundOffset).add(this._groundOffsetVector.multiplyScalar(this._groundOffsetFactor));this.onUpdateWorldPosition(R,this._groundPlanePoint,!1),this.onDidUpdate();return}}else this._groundPlanePoint.set(0,99999,0);b&&this.onUpdateScreenSpacePlane(),this._requireUpdateGroundPlane=!0,this._raycaster.ray.intersectPlane(this._cameraPlane,this._intersection)&&(this.onUpdateWorldPosition(this._intersection.sub(this._cameraPlaneOffset),this._groundPlanePoint,!0),this.onDidUpdate())}}onUpdateWorldPosition(e,t,n){if(!!this._selected){if(n){const i=ti(this._selected);i.y=e.y,e=i}if(ys(this._selected,e),ys(this._groundLine,e),this._hasGroundPlane?this._groundLine.scale.y=this._groundDistance:this._groundLine.scale.y=1e3,this._groundMarker.visible=t!==null,t){const i=ti(this._camera).distanceTo(t)*.01;this._groundMarker.scale.set(i,i,i),ys(this._groundMarker,t)}}}onUpdateScreenSpacePlane(){if(!this._selected||!this._context)return;const e=this._context.input.getPointerPositionRC(0);!e||(this._raycaster.setFromCamera(e,this._camera),this._cameraPlane.setFromNormalAndCoplanarPoint(this._camera.getWorldDirection(this._cameraPlane.normal),this._worldPosition.setFromMatrixPosition(this._selected.matrixWorld)),this._raycaster.ray.intersectPlane(this._cameraPlane,this._intersection)&&this._selected.parent&&(this._inverseMatrix.copy(this._selected.parent.matrixWorld).invert(),this._cameraPlaneOffset.copy(this._intersection).sub(this._worldPosition.setFromMatrixPosition(this._selected.matrixWorld))))}onUpdateGroundPlane(){if(!this._selected||!this._context)return;const e=ti(this._selected),t=new Pu(new q(0,.1,0).add(e),new q(0,-1,0)),n=new Wc;n.ignore=[this._selected];const i=this._context.physics.raycastFromRay(t,n);for(let r=0;r<i.length;r++){const o=i[r];if(!o.face||this.contains(this._selected,o.object))continue;const l=new q(0,1,0);this._groundPlane.setFromNormalAndCoplanarPoint(l,o.point);break}this._hasGroundPlane=!0,this._groundPlane.setFromNormalAndCoplanarPoint(t.direction.multiplyScalar(-1),t.origin),this._raycaster.ray.intersectPlane(this._groundPlane,this._intersection),this._groundDistance=this._intersection.distanceTo(e),this._groundOffset.copy(this._intersection).sub(e)}onDidUpdate(){ro.markDirty(this._selected);for(const e of this._rbs)e.wakeUp(),e.setBodyFromGameObject({x:0,y:0,z:0}),e.setAngularVelocity(0,0,0)}contains(e,t){if(e===t)return!0;if(e.children){for(const n of e.children)if(this.contains(n,t))return!0}return!1}};let M_=TM;E(M_,"geometry",new Sn().setFromPoints([new q(0,0,0),new q(0,-1,0)]));var nK=Object.defineProperty,iK=Object.getOwnPropertyDescriptor,oO=(a,e,t,n)=>{for(var i=n>1?void 0:n?iK(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&nK(e,t,i),i};class cv extends Bt{constructor(){super(...arguments);E(this,"filesBackendUrl");E(this,"localhost");E(this,"_dragOver");E(this,"_drop")}onEnable(){this.filesBackendUrl=this.filesBackendUrl?Ru.GetUrl(this.filesBackendUrl,this.localhost):void 0,this._dragOver=this.onDrag.bind(this),this._drop=this.onDrop.bind(this),this.context.domElement.addEventListener("dragover",this._dragOver),this.context.domElement.addEventListener("drop",this._drop)}onDisable(){this.context.domElement.removeEventListener("dragover",this._dragOver),this.context.domElement.removeEventListener("drop",this._drop)}onDrag(t){t.preventDefault()}async onDrop(t){if(console.log(t),!t.dataTransfer)return;t.preventDefault();const n=t.dataTransfer.items;if(!!n)for(const i in n){const r=n[i];if(r.kind==="file"){const o=r.getAsFile();if(!o)continue;console.log("Register file "+o.name+" to",this.filesBackendUrl,o);const l=await sne(o,this.context,this.filesBackendUrl);l&&this.addObject(t,l)}else r.kind==="string"&&r.type=="text/plain"&&r.getAsString(async o=>{console.log("dropped url",o);try{const l=new URL(o);if(!l)return;const h=await rne(l,this.context);h&&this.addObject(t,h)}catch{console.log("dropped string is not a valid URL!",o)}})}}async addObject(t,n){console.log("Dropped",n);const i=new Wc;i.setMask(16777215),i.screenPointFromOffset(t.offsetX,t.offsetY);const r=this.context.physics.raycast(i),o=n.scene;if(r&&r.length>0)for(const l of r){o.position.copy(l.point);break}this.gameObject.add(o),this.dispatchEvent(new CustomEvent("object-added",{detail:n}))}}oO([Re()],cv.prototype,"filesBackendUrl",2);oO([Re()],cv.prototype,"localhost",2);var sK=Object.defineProperty,rK=Object.getOwnPropertyDescriptor,lv=(a,e,t,n)=>{for(var i=n>1?void 0:n?rK(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&sK(e,t,i),i};class Gf extends Ug{constructor(){super(...arguments);E(this,"parent",null);E(this,"object",null);E(this,"limitCount",10);E(this,"limitInterval",60);E(this,"_currentCount",0);E(this,"_startPosition",null);E(this,"_startQuaternion",null)}awake(){var n,i,r,o;if(this.object){if(this.object===this.gameObject){console.error("Can not duplicate self");return}this.object.visible=!1,this._startPosition=(i=(n=this.object.position)==null?void 0:n.clone())!=null?i:new q(0,0,0),this._startQuaternion=(o=(r=this.object.quaternion)==null?void 0:r.clone())!=null?o:new Ot(0,0,0,1)}const t=Te.getComponentInParent(this.gameObject,Pc);t?t.addDragEventListener(rO.SelectStart,(l,h)=>{if(this._currentCount>=this.limitCount){h.attached=null;return}const u=this.handleDuplication(h.selected);u&&(console.assert(u!==h.selected,"Duplicated object is original"),h.attached=u)}):console.warn("Could no find drag controls in parent",this.name),gs.addEventListener(Vl.SelectStart,(l,h)=>{if(this._currentCount>=this.limitCount){h.grab=null;return}const u=this.handleDuplication(h.selected);u&&(h.grab=u)}),this.cloneLimitIntervalFn()}cloneLimitIntervalFn(){this.destroyed||(this._currentCount>0&&(this._currentCount-=1),setTimeout(()=>{this.cloneLimitIntervalFn()},this.limitInterval/this.limitCount*1e3))}handleDuplication(t){var n,i;if(this._currentCount>=this.limitCount||!this.object)return null;if(t===this.gameObject||this.handleMultiObject(t)){if(this.object===this.gameObject)return null;this.object.visible=!0,this._startPosition&&this.object.position.copy(this._startPosition),this._startQuaternion&&this.object.quaternion.copy(this._startQuaternion);const r=new Fo;this.parent||(this.parent=this.gameObject.parent),this.parent&&(r.parent=(i=this.parent.guid)!=null?i:(n=this.parent.userData)==null?void 0:n.guid,r.keepWorldPosition=!0),r.position=this.worldPosition,r.rotation=this.worldQuaternion,r.context=this.context,this._currentCount+=1;const o=Te.instantiateSynced(this.object,r);return console.assert(o!==this.object,"Duplicated object is original"),this.object.visible=!1,this._startPosition&&this.object.position.clone().copy(this._startPosition),this._startQuaternion&&this.object.quaternion.clone().copy(this._startQuaternion),o}return null}handleMultiObject(t){return this.gameObject.type==="Group"||this.gameObject.type==="Object3D"?this.isInChildren(this.gameObject,t):!1}isInChildren(t,n){if(!t)return!1;if(t===n)return!0;if(t.children){for(let i of t.children)if(this.isInChildren(i,n))return!0}return!1}}lv([Re(qt)],Gf.prototype,"parent",2);lv([Re(qt)],Gf.prototype,"object",2);lv([Re()],Gf.prototype,"limitCount",2);lv([Re()],Gf.prototype,"limitInterval",2);class rg{constructor(e,t){E(this,"method");E(this,"enabled");this.method=e,this.enabled=t!==void 0?t:!0}invoke(...e){if(this.enabled!==!1){if(!this.method){console.warn("No function. Please check you assigned a method to invoke on export",this);return}this.method(...e)}}}const oK=a=>/^[A-Z]*$/.test(a);class MS extends Event{constructor(){super(...arguments);E(this,"args")}}class ua{constructor(e){E(this,"target");E(this,"key");E(this,"_isInvoking",!1);E(this,"methods",[]);this.methods=e!=null?e:[]}setEventTarget(e,t){if(this.key=e,this.target=t,this.key!==void 0){let n="",i=!1;for(let r of this.key)i&&oK(r)&&(n+="-"),i=!0,n+=r.toLowerCase();this.key=n}}invoke(...e){if(this._isInvoking){console.warn("Circular event invocation detected. Please check your event listeners for circular references.",this);return}this._isInvoking=!0;try{for(const t of this.methods)t.invoke(...e);if(typeof this.target=="object"&&typeof this.key=="string"){const t=this.target.dispatchEvent;if(typeof t=="function"){const n=new MS(this.key);n.args=e,t.call(this.target,n)}}}finally{this._isInvoking=!1}}addEventListener(e){return this.methods.push(new rg(e,!0)),e}removeEventListener(e){if(!!e)for(let t=this.methods.length-1;t>=0;t--)this.methods[t].method===e&&(this.methods[t].enabled=!1,this.methods.splice(t,1))}removeAllEventListeners(){this.methods.length=0}}class aO extends Bt{}const aK={type:"change"};class cK extends Uo{constructor(e,t){super(),this.object=e,this.domElement=t,this.movementSpeed=1,this.rollSpeed=.005,this.dragToLook=!1,this.autoForward=!1;const n=this,i=1e-6,r=new Ot,o=new q;this.tmpQuaternion=new Ot,this.status=0,this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this.moveVector=new q(0,0,0),this.rotationVector=new q(0,0,0),this.keydown=function(m){if(!m.altKey){switch(m.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=.1;break;case"KeyW":this.moveState.forward=1;break;case"KeyS":this.moveState.back=1;break;case"KeyA":this.moveState.left=1;break;case"KeyD":this.moveState.right=1;break;case"KeyR":this.moveState.up=1;break;case"KeyF":this.moveState.down=1;break;case"ArrowUp":this.moveState.pitchUp=1;break;case"ArrowDown":this.moveState.pitchDown=1;break;case"ArrowLeft":this.moveState.yawLeft=1;break;case"ArrowRight":this.moveState.yawRight=1;break;case"KeyQ":this.moveState.rollLeft=1;break;case"KeyE":this.moveState.rollRight=1;break}this.updateMovementVector(),this.updateRotationVector()}},this.keyup=function(m){switch(m.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=1;break;case"KeyW":this.moveState.forward=0;break;case"KeyS":this.moveState.back=0;break;case"KeyA":this.moveState.left=0;break;case"KeyD":this.moveState.right=0;break;case"KeyR":this.moveState.up=0;break;case"KeyF":this.moveState.down=0;break;case"ArrowUp":this.moveState.pitchUp=0;break;case"ArrowDown":this.moveState.pitchDown=0;break;case"ArrowLeft":this.moveState.yawLeft=0;break;case"ArrowRight":this.moveState.yawRight=0;break;case"KeyQ":this.moveState.rollLeft=0;break;case"KeyE":this.moveState.rollRight=0;break}this.updateMovementVector(),this.updateRotationVector()},this.pointerdown=function(m){if(this.dragToLook)this.status++;else{switch(m.button){case 0:this.moveState.forward=1;break;case 2:this.moveState.back=1;break}this.updateMovementVector()}},this.pointermove=function(m){if(!this.dragToLook||this.status>0){const A=this.getContainerDimensions(),v=A.size[0]/2,w=A.size[1]/2;this.moveState.yawLeft=-(m.pageX-A.offset[0]-v)/v,this.moveState.pitchDown=(m.pageY-A.offset[1]-w)/w,this.updateRotationVector()}},this.pointerup=function(m){if(this.dragToLook)this.status--,this.moveState.yawLeft=this.moveState.pitchDown=0;else{switch(m.button){case 0:this.moveState.forward=0;break;case 2:this.moveState.back=0;break}this.updateMovementVector()}this.updateRotationVector()},this.update=function(m){const A=m*n.movementSpeed,v=m*n.rollSpeed;n.object.translateX(n.moveVector.x*A),n.object.translateY(n.moveVector.y*A),n.object.translateZ(n.moveVector.z*A),n.tmpQuaternion.set(n.rotationVector.x*v,n.rotationVector.y*v,n.rotationVector.z*v,1).normalize(),n.object.quaternion.multiply(n.tmpQuaternion),(o.distanceToSquared(n.object.position)>i||8*(1-r.dot(n.object.quaternion))>i)&&(n.dispatchEvent(aK),r.copy(n.object.quaternion),o.copy(n.object.position))},this.updateMovementVector=function(){const m=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right,this.moveVector.y=-this.moveState.down+this.moveState.up,this.moveVector.z=-m+this.moveState.back},this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp,this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft,this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft},this.getContainerDimensions=function(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}},this.dispose=function(){this.domElement.removeEventListener("contextmenu",FP),this.domElement.removeEventListener("pointerdown",h),this.domElement.removeEventListener("pointermove",l),this.domElement.removeEventListener("pointerup",u),window.removeEventListener("keydown",f),window.removeEventListener("keyup",g)};const l=this.pointermove.bind(this),h=this.pointerdown.bind(this),u=this.pointerup.bind(this),f=this.keydown.bind(this),g=this.keyup.bind(this);this.domElement.addEventListener("contextmenu",FP),this.domElement.addEventListener("pointerdown",h),this.domElement.addEventListener("pointermove",l),this.domElement.addEventListener("pointerup",u),window.addEventListener("keydown",f),window.addEventListener("keyup",g),this.updateMovementVector(),this.updateRotationVector()}}function FP(a){a.preventDefault()}class cO extends Bt{constructor(){super(...arguments);E(this,"_controls",null)}onEnable(){var n;const t=(n=Te.getComponent(this.gameObject,Us))==null?void 0:n.cam;this._controls=new cK(t,this.context.renderer.domElement),this._controls.rollSpeed=.5,this._controls.movementSpeed=3,this._controls.dragToLook=!0}onDisable(){var t;(t=this._controls)==null||t.dispose(),this._controls=null}update(){this._controls&&this._controls.update(this.context.time.deltaTime)}}var lK=Object.defineProperty,hK=Object.getOwnPropertyDescriptor,TS=(a,e,t,n)=>{for(var i=n>1?void 0:n?hK(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&lK(e,t,i),i};class Gg extends Bt{constructor(){super(...arguments);E(this,"objectBounds",!1);E(this,"color");E(this,"isGizmo",!0);E(this,"_gizmoObject",null);E(this,"_boxHelper",null)}onEnable(){var t,n;this.isGizmo&&!Fg||(this._gizmoObject||(this.objectBounds&&this.gameObject.isMesh===!0?this._gizmoObject=new QC(this.gameObject,(t=this.color)!=null?t:16776960):(this.objectBounds=!1,this._gizmoObject=KD((n=this.color)!=null?n:16776960))),this.objectBounds?(this.scene.add(this._gizmoObject),this._boxHelper=this._gizmoObject,this.startCoroutine(this.syncObjectBounds(),No.OnBeforeRender)):this.gameObject.add(this._gizmoObject))}onDisable(){this._gizmoObject&&this.gameObject.remove(this._gizmoObject)}*syncObjectBounds(){var t;for(;this._boxHelper;)(t=this._boxHelper)==null||t.update(),yield}}TS([Re()],Gg.prototype,"objectBounds",2);TS([Re(_e)],Gg.prototype,"color",2);TS([Re()],Gg.prototype,"isGizmo",2);class IS{constructor(){this.pluginCallbacks=[],this.register(function(e){return new yK(e)}),this.register(function(e){return new vK(e)}),this.register(function(e){return new xK(e)}),this.register(function(e){return new EK(e)}),this.register(function(e){return new CK(e)}),this.register(function(e){return new wK(e)}),this.register(function(e){return new bK(e)})}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,i){const r=new _K,o=[];for(let l=0,h=this.pluginCallbacks.length;l<h;l++)o.push(this.pluginCallbacks[l](r));r.setPlugins(o),r.write(e,t,i).catch(n)}parseAsync(e,t){const n=this;return new Promise(function(i,r){n.parse(e,i,r,t)})}}const Ai={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,FLOAT:5126,UNSIGNED_INT:5125,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},io={};io[Ki]=Ai.NEAREST;io[Af]=Ai.NEAREST_MIPMAP_NEAREST;io[_f]=Ai.NEAREST_MIPMAP_LINEAR;io[yi]=Ai.LINEAR;io[fg]=Ai.LINEAR_MIPMAP_NEAREST;io[fa]=Ai.LINEAR_MIPMAP_LINEAR;io[$s]=Ai.CLAMP_TO_EDGE;io[Fc]=Ai.REPEAT;io[Cu]=Ai.MIRRORED_REPEAT;const kP={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},NP=12,uK=1179937895,dK=2,UP=8,fK=1313821514,pK=5130562;function _m(a,e){return a.length===e.length&&a.every(function(t,n){return t===e[n]})}function mK(a){return new TextEncoder().encode(a).buffer}function gK(a){return _m(a.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}function AK(a,e,t){const n={min:new Array(a.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(a.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let i=e;i<e+t;i++)for(let r=0;r<a.itemSize;r++){let o;a.itemSize>4?o=a.array[i*a.itemSize+r]:r===0?o=a.getX(i):r===1?o=a.getY(i):r===2?o=a.getZ(i):r===3&&(o=a.getW(i)),n.min[r]=Math.min(n.min[r],o),n.max[r]=Math.max(n.max[r],o)}return n}function lO(a){return Math.ceil(a/4)*4}function _b(a,e=0){const t=lO(a.byteLength);if(t!==a.byteLength){const n=new Uint8Array(t);if(n.set(new Uint8Array(a)),e!==0)for(let i=a.byteLength;i<t;i++)n[i]=e;return n.buffer}return a}function zP(){return typeof document>"u"&&typeof OffscreenCanvas<"u"?new OffscreenCanvas(1,1):document.createElement("canvas")}function GP(a,e){if(a.toBlob!==void 0)return new Promise(n=>a.toBlob(n,e));let t;return e==="image/jpeg"?t=.92:e==="image/webp"&&(t=.8),a.convertToBlob({type:e,quality:t})}class _K{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}async write(e,t,n){this.options=Object.assign({},{binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},n),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),await Promise.all(this.pending);const i=this,r=i.buffers,o=i.json;n=i.options;const l=i.extensionsUsed,h=new Blob(r,{type:"application/octet-stream"}),u=Object.keys(l);if(u.length>0&&(o.extensionsUsed=u),o.buffers&&o.buffers.length>0&&(o.buffers[0].byteLength=h.size),n.binary===!0){const f=new FileReader;f.readAsArrayBuffer(h),f.onloadend=function(){const g=_b(f.result),m=new DataView(new ArrayBuffer(UP));m.setUint32(0,g.byteLength,!0),m.setUint32(4,pK,!0);const A=_b(mK(JSON.stringify(o)),32),v=new DataView(new ArrayBuffer(UP));v.setUint32(0,A.byteLength,!0),v.setUint32(4,fK,!0);const w=new ArrayBuffer(NP),b=new DataView(w);b.setUint32(0,uK,!0),b.setUint32(4,dK,!0);const S=NP+v.byteLength+A.byteLength+m.byteLength+g.byteLength;b.setUint32(8,S,!0);const R=new Blob([w,v,A,m,g],{type:"application/octet-stream"}),M=new FileReader;M.readAsArrayBuffer(R),M.onloadend=function(){t(M.result)}}}else if(o.buffers&&o.buffers.length>0){const f=new FileReader;f.readAsDataURL(h),f.onloadend=function(){const g=f.result;o.buffers[0].uri=g,t(o)}}else t(o);this.temporaryRenderer&&this.temporaryRenderer.dispose()}serializeUserData(e,t){if(Object.keys(e.userData).length===0)return;const n=this.options,i=this.extensionsUsed;try{const r=JSON.parse(JSON.stringify(e.userData));if(n.includeCustomExtensions&&r.gltfExtensions){t.extensions===void 0&&(t.extensions={});for(const o in r.gltfExtensions)t.extensions[o]=r.gltfExtensions[o],i[o]=!0;delete r.gltfExtensions}Object.keys(r).length>0&&(t.extras=r)}catch(r){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+r.message)}}getUID(e,t=!1){if(this.uids.has(e)===!1){const i=new Map;i.set(!0,this.uid++),i.set(!1,this.uid++),this.uids.set(e,i)}return this.uids.get(e).get(t)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const n=new q;for(let i=0,r=e.count;i<r;i++)if(Math.abs(n.fromBufferAttribute(e,i).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const t=this.cache;if(t.attributesNormalized.has(e))return t.attributesNormalized.get(e);const n=e.clone(),i=new q;for(let r=0,o=n.count;r<o;r++)i.fromBufferAttribute(n,r),i.x===0&&i.y===0&&i.z===0?i.setX(1):i.normalize(),n.setXYZ(r,i.x,i.y,i.z);return t.attributesNormalized.set(e,n),n}applyTextureTransform(e,t){let n=!1;const i={};(t.offset.x!==0||t.offset.y!==0)&&(i.offset=t.offset.toArray(),n=!0),t.rotation!==0&&(i.rotation=t.rotation,n=!0),(t.repeat.x!==1||t.repeat.y!==1)&&(i.scale=t.repeat.toArray(),n=!0),n&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=i,this.extensionsUsed.KHR_texture_transform=!0)}buildReadableTexture(e,t){const n=new lo(2,2,1,1),i=new nr({uniforms:{blitTexture:new Bg(e)},vertexShader:`
				varying vec2 vUv;
				void main(){
					vUv = uv;
					gl_Position = vec4(position.xy * 1.0,0.,.999999);
				}`,fragmentShader:`
				uniform sampler2D blitTexture; 
				varying vec2 vUv;
				void main(){ 
					gl_FragColor = vec4(vUv.xy, 0, 1);
					gl_FragColor = texture2D( blitTexture, vUv);
				}`}),r=new _t(n,i);r.frustrumCulled=!1;const o=new ts,l=new vu;l.add(r),this.temporaryRenderer||(this.temporaryRenderer=new Ag({antialias:!1})),this.temporaryRenderer.setSize(Math.min(e.image.width,t),Math.min(e.image.height,t)),this.temporaryRenderer.clear(),this.temporaryRenderer.render(l,o);const h=new Vi(this.temporaryRenderer.domElement);return h.userData.mimeType="image/png",h}buildMetalRoughTexture(e,t){if(e===t)return e;function n(A){return A.encoding===Gn?function(w){return w<.04045?w*.0773993808:Math.pow(w*.9478672986+.0521327014,2.4)}:function(w){return w}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures."),typeof Bl<"u"&&(e instanceof Bl&&(e=this.buildReadableTexture(e)),t instanceof Bl&&(t=this.buildReadableTexture(t)));const i=e==null?void 0:e.image,r=t==null?void 0:t.image,o=Math.max((i==null?void 0:i.width)||0,(r==null?void 0:r.width)||0),l=Math.max((i==null?void 0:i.height)||0,(r==null?void 0:r.height)||0),h=zP();h.width=o,h.height=l;const u=h.getContext("2d");u.fillStyle="#00ffff",u.fillRect(0,0,o,l);const f=u.getImageData(0,0,o,l);if(i){u.drawImage(i,0,0,o,l);const A=n(e),v=u.getImageData(0,0,o,l).data;for(let w=2;w<v.length;w+=4)f.data[w]=A(v[w]/256)*256}if(r){u.drawImage(r,0,0,o,l);const A=n(t),v=u.getImageData(0,0,o,l).data;for(let w=1;w<v.length;w+=4)f.data[w]=A(v[w]/256)*256}u.putImageData(f,0,0);const m=(e||t).clone();return m.source=new Nl(h),m.encoding=pr,m}processBuffer(e){const t=this.json,n=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),n.push(e),0}processBufferView(e,t,n,i,r){const o=this.json;o.bufferViews||(o.bufferViews=[]);let l;t===Ai.UNSIGNED_BYTE||t===Ai.BYTE?l=1:t===Ai.UNSIGNED_SHORT?l=2:l=4;const h=lO(i*e.itemSize*l),u=new DataView(new ArrayBuffer(h));let f=0;for(let A=n;A<n+i;A++)for(let v=0;v<e.itemSize;v++){let w;e.itemSize>4?w=e.array[A*e.itemSize+v]:v===0?w=e.getX(A):v===1?w=e.getY(A):v===2?w=e.getZ(A):v===3&&(w=e.getW(A)),t===Ai.FLOAT?u.setFloat32(f,w,!0):t===Ai.UNSIGNED_INT?u.setUint32(f,w,!0):t===Ai.UNSIGNED_SHORT?u.setUint16(f,w,!0):t===Ai.UNSIGNED_BYTE?u.setUint8(f,w):t===Ai.BYTE?u.setInt8(f,w):t===Ai.SHORT&&u.setInt16(f,w),f+=l}const g={buffer:this.processBuffer(u.buffer),byteOffset:this.byteOffset,byteLength:h};return r!==void 0&&(g.target=r),r===Ai.ARRAY_BUFFER&&(g.byteStride=e.itemSize*l),this.byteOffset+=h,o.bufferViews.push(g),{id:o.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const t=this,n=t.json;return n.bufferViews||(n.bufferViews=[]),new Promise(function(i){const r=new FileReader;r.readAsArrayBuffer(e),r.onloadend=function(){const o=_b(r.result),l={buffer:t.processBuffer(o),byteOffset:t.byteOffset,byteLength:o.byteLength};t.byteOffset+=o.byteLength,i(n.bufferViews.push(l)-1)}})}processAccessor(e,t,n,i){const r=this.json,o={1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",16:"MAT4"};let l;if(e.array.constructor===Float32Array)l=Ai.FLOAT;else if(e.array.constructor===Uint32Array)l=Ai.UNSIGNED_INT;else if(e.array.constructor===Uint16Array)l=Ai.UNSIGNED_SHORT;else if(e.array.constructor===Uint8Array)l=Ai.UNSIGNED_BYTE;else if(e.array.constructor===Int8Array)l=Ai.BYTE;else if(e.array.constructor===Int16Array)l=Ai.SHORT;else throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type: "+e.array.constructor);if(n===void 0&&(n=0),i===void 0&&(i=e.count),i===0)return null;const h=AK(e,n,i);let u;t!==void 0&&(u=e===t.index?Ai.ELEMENT_ARRAY_BUFFER:Ai.ARRAY_BUFFER);const f=this.processBufferView(e,l,n,i,u),g={bufferView:f.id,byteOffset:f.byteOffset,componentType:l,count:i,max:h.max,min:h.min,type:o[e.itemSize]};return e.normalized===!0&&(g.normalized=!0),r.accessors||(r.accessors=[]),r.accessors.push(g)-1}processImage(e,t,n,i="image/png"){const r=this,o=r.cache,l=r.json,h=r.options,u=r.pending;o.images.has(e)||o.images.set(e,{});const f=o.images.get(e),g=i+":flipY/"+n.toString();if(f[g]!==void 0)return f[g];l.images||(l.images=[]);const m={mimeType:i},A=zP();A.width=Math.min(e.width,h.maxTextureSize),A.height=Math.min(e.height,h.maxTextureSize);const v=A.getContext("2d");if(n===!0&&(v.translate(0,A.height),v.scale(1,-1)),e.data!==void 0){if(t!==us&&console.error("GLTFExporter: Only RGBAFormat is supported."),e.width>h.maxTextureSize||e.height>h.maxTextureSize)v.drawImage(e,0,0,A.width,A.height);else{t!==us&&console.error("GLTFExporter: Only RGBAFormat is supported.",e),(e.width>h.maxTextureSize||e.height>h.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);const S=new Uint8ClampedArray(e.height*e.width*4);for(let R=0;R<S.length;R+=4)S[R+0]=e.data[R+0],S[R+1]=e.data[R+1],S[R+2]=e.data[R+2],S[R+3]=e.data[R+3];v.putImageData(new ImageData(S,e.width,e.height),0,0)}const b=new Uint8ClampedArray(e.height*e.width*4);for(let S=0;S<b.length;S+=4)b[S+0]=e.data[S+0],b[S+1]=e.data[S+1],b[S+2]=e.data[S+2],b[S+3]=e.data[S+3];v.putImageData(new ImageData(b,e.width,e.height),0,0)}else v.drawImage(e,0,0,A.width,A.height);h.binary===!0?u.push(GP(A,i).then(b=>r.processBufferViewImage(b)).then(b=>{m.bufferView=b})):A.toDataURL!==void 0?m.uri=A.toDataURL(i):u.push(GP(A,i).then(b=>new FileReader().readAsDataURL(b)).then(b=>{m.uri=b}));const w=l.images.push(m)-1;return f[g]=w,w}processSampler(e){const t=this.json;t.samplers||(t.samplers=[]);const n={magFilter:io[e.magFilter],minFilter:io[e.minFilter],wrapS:io[e.wrapS],wrapT:io[e.wrapT]};return t.samplers.push(n)-1}processTexture(e){const n=this.options,i=this.cache,r=this.json;if(i.textures.has(e))return i.textures.get(e);r.textures||(r.textures=[]);let o=e;typeof Bl<"u"&&e instanceof Bl&&(o=this.buildReadableTexture(e,n.maxTextureSize));let l=o.userData.mimeType;l==="image/webp"&&(l="image/png");const h={sampler:this.processSampler(e),source:this.processImage(o.image,o.format,o.flipY,l)};e.name&&(h.name=e.name),this._invokeAll(function(f){f.writeTexture&&f.writeTexture(o,h)});const u=r.textures.push(h)-1;return i.textures.set(e,u),u}processMaterial(e){const t=this.cache,n=this.json;if(t.materials.has(e))return t.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;n.materials||(n.materials=[]);const i={pbrMetallicRoughness:{}};e.isMeshStandardMaterial!==!0&&e.isMeshBasicMaterial!==!0&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const r=e.color.toArray().concat([e.opacity]);if(_m(r,[1,1,1,1])||(i.pbrMetallicRoughness.baseColorFactor=r),e.isMeshStandardMaterial?(i.pbrMetallicRoughness.metallicFactor=e.metalness,i.pbrMetallicRoughness.roughnessFactor=e.roughness):(i.pbrMetallicRoughness.metallicFactor=.5,i.pbrMetallicRoughness.roughnessFactor=.5),e.metalnessMap||e.roughnessMap){const l=this.buildMetalRoughTexture(e.metalnessMap,e.roughnessMap),h={index:this.processTexture(l)};this.applyTextureTransform(h,l),i.pbrMetallicRoughness.metallicRoughnessTexture=h}if(e.map){const l={index:this.processTexture(e.map)};this.applyTextureTransform(l,e.map),i.pbrMetallicRoughness.baseColorTexture=l}if(e.emissive){const l=e.emissive.clone().multiplyScalar(e.emissiveIntensity),h=Math.max(l.r,l.g,l.b);if(h>1&&(l.multiplyScalar(1/h),console.warn("THREE.GLTFExporter: Some emissive components exceed 1; emissive has been limited")),h>0&&(i.emissiveFactor=l.toArray()),e.emissiveMap){const u={index:this.processTexture(e.emissiveMap)};this.applyTextureTransform(u,e.emissiveMap),i.emissiveTexture=u}}if(e.normalMap){const l={index:this.processTexture(e.normalMap)};e.normalScale&&e.normalScale.x!==1&&(l.scale=e.normalScale.x),this.applyTextureTransform(l,e.normalMap),i.normalTexture=l}if(e.aoMap){const l={index:this.processTexture(e.aoMap),texCoord:1};e.aoMapIntensity!==1&&(l.strength=e.aoMapIntensity),this.applyTextureTransform(l,e.aoMap),i.occlusionTexture=l}e.transparent?i.alphaMode="BLEND":e.alphaTest>0&&(i.alphaMode="MASK",i.alphaCutoff=e.alphaTest),e.side===er&&(i.doubleSided=!0),e.name!==""&&(i.name=e.name),this.serializeUserData(e,i),this._invokeAll(function(l){l.writeMaterial&&l.writeMaterial(e,i)});const o=n.materials.push(i)-1;return t.materials.set(e,o),o}processMesh(e){const t=this.cache,n=this.json,i=[e.geometry.uuid];if(Array.isArray(e.material))for(let M=0,I=e.material.length;M<I;M++)i.push(e.material[M].uuid);else i.push(e.material.uuid);const r=i.join(":");if(t.meshes.has(r))return t.meshes.get(r);const o=e.geometry;let l;e.isLineSegments?l=Ai.LINES:e.isLineLoop?l=Ai.LINE_LOOP:e.isLine?l=Ai.LINE_STRIP:e.isPoints?l=Ai.POINTS:l=e.material.wireframe?Ai.LINES:Ai.TRIANGLES;const h={},u={},f=[],g=[],m={uv:"TEXCOORD_0",uv2:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},A=o.getAttribute("normal");A!==void 0&&!this.isNormalizedNormalAttribute(A)&&(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),o.setAttribute("normal",this.createNormalizedNormalAttribute(A)));let v=null;for(let M in o.attributes){if(M.slice(0,5)==="morph")continue;const I=o.attributes[M];if(M=m[M]||M.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(M)||(M="_"+M),t.attributes.has(this.getUID(I))){u[M]=t.attributes.get(this.getUID(I));continue}v=null;const B=I.array;M==="JOINTS_0"&&!(B instanceof Uint16Array)&&!(B instanceof Uint8Array)&&(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),v=new Jn(new Uint16Array(B),I.itemSize,I.normalized));const F=this.processAccessor(v||I,o);F!==null&&(u[M]=F,t.attributes.set(this.getUID(I),F))}if(A!==void 0&&o.setAttribute("normal",A),Object.keys(u).length===0)return null;if(e.morphTargetInfluences!==void 0&&e.morphTargetInfluences.length>0){const M=[],I=[],T={};if(e.morphTargetDictionary!==void 0)for(const B in e.morphTargetDictionary)T[e.morphTargetDictionary[B]]=B;for(let B=0;B<e.morphTargetInfluences.length;++B){const F={};let D=!1;for(const U in o.morphAttributes){if(U!=="position"&&U!=="normal"){D||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),D=!0);continue}const W=o.morphAttributes[U][B],J=U.toUpperCase(),ee=o.attributes[U];if(t.attributes.has(this.getUID(W,!0))){F[J]=t.attributes.get(this.getUID(W,!0));continue}const Q=W.clone();if(!o.morphTargetsRelative)for(let Y=0,se=W.count;Y<se;Y++)Q.setXYZ(Y,W.getX(Y)-ee.getX(Y),W.getY(Y)-ee.getY(Y),W.getZ(Y)-ee.getZ(Y));F[J]=this.processAccessor(Q,o),t.attributes.set(this.getUID(ee,!0),F[J])}g.push(F),M.push(e.morphTargetInfluences[B]),e.morphTargetDictionary!==void 0&&I.push(T[B])}h.weights=M,I.length>0&&(h.extras={},h.extras.targetNames=I)}const w=Array.isArray(e.material);if(w&&o.groups.length===0)return null;const b=w?e.material:[e.material],S=w?o.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let M=0,I=S.length;M<I;M++){const T={mode:l,attributes:u};if(this.serializeUserData(o,T),g.length>0&&(T.targets=g),o.index!==null){let F=this.getUID(o.index);(S[M].start!==void 0||S[M].count!==void 0)&&(F+=":"+S[M].start+":"+S[M].count),t.attributes.has(F)?T.indices=t.attributes.get(F):(T.indices=this.processAccessor(o.index,o,S[M].start,S[M].count),t.attributes.set(F,T.indices)),T.indices===null&&delete T.indices}const B=this.processMaterial(b[S[M].materialIndex]);B!==null&&(T.material=B),f.push(T)}h.primitives=f,n.meshes||(n.meshes=[]),this._invokeAll(function(M){M.writeMesh&&M.writeMesh(e,h)});const R=n.meshes.push(h)-1;return t.meshes.set(r,R),R}processCamera(e){const t=this.json;t.cameras||(t.cameras=[]);const n=e.isOrthographicCamera,i={type:n?"orthographic":"perspective"};return n?i.orthographic={xmag:e.right*2,ymag:e.top*2,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:i.perspective={aspectRatio:e.aspect,yfov:Tu.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},e.name!==""&&(i.name=e.type),t.cameras.push(i)-1}processAnimation(e,t){const n=this.json,i=this.nodeMap;n.animations||(n.animations=[]),e=IS.Utils.mergeMorphTargetTracks(e.clone(),t);const r=e.tracks,o=[],l=[];for(let h=0;h<r.length;++h){const u=r[h],f=ni.parseTrackName(u.name);let g=ni.findNode(t,f.nodeName);const m=kP[f.propertyName];if(f.objectName==="bones"&&(g.isSkinnedMesh===!0?g=g.skeleton.getBoneByName(f.objectIndex):g=void 0),!g||!m)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',u.name),null;const A=1;let v=u.values.length/u.times.length;m===kP.morphTargetInfluences&&(v/=g.morphTargetInfluences.length);let w;u.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline===!0?(w="CUBICSPLINE",v/=3):u.getInterpolation()===Mu?w="STEP":w="LINEAR",l.push({input:this.processAccessor(new Jn(u.times,A)),output:this.processAccessor(new Jn(u.values,v)),interpolation:w}),o.push({sampler:l.length-1,target:{node:i.get(g),path:m}})}return n.animations.push({name:e.name||"clip_"+n.animations.length,samplers:l,channels:o}),n.animations.length-1}processSkin(e){const t=this.json,n=this.nodeMap,i=t.nodes[n.get(e)],r=e.skeleton;if(r===void 0)return null;const o=e.skeleton.bones[0];if(o===void 0)return null;const l=[],h=new Float32Array(r.bones.length*16),u=new xn;for(let g=0;g<r.bones.length;++g)l.push(n.get(r.bones[g])),u.copy(r.boneInverses[g]),u.multiply(e.bindMatrix).toArray(h,g*16);return t.skins===void 0&&(t.skins=[]),t.skins.push({inverseBindMatrices:this.processAccessor(new Jn(h,16)),joints:l,skeleton:n.get(o)}),i.skin=t.skins.length-1}processNode(e){const t=this.json,n=this.options,i=this.nodeMap;t.nodes||(t.nodes=[]);const r={};if(n.trs){const l=e.quaternion.toArray(),h=e.position.toArray(),u=e.scale.toArray();_m(l,[0,0,0,1])||(r.rotation=l),_m(h,[0,0,0])||(r.translation=h),_m(u,[1,1,1])||(r.scale=u)}else e.matrixAutoUpdate&&e.updateMatrix(),gK(e.matrix)===!1&&(r.matrix=e.matrix.elements);if(e.name!==""&&(r.name=String(e.name)),this.serializeUserData(e,r),e.isMesh||e.isLine||e.isPoints){const l=this.processMesh(e);l!==null&&(r.mesh=l)}else e.isCamera&&(r.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){const l=[];for(let h=0,u=e.children.length;h<u;h++){const f=e.children[h];if(f.visible||n.onlyVisible===!1){const g=this.processNode(f);g!==null&&l.push(g)}}l.length>0&&(r.children=l)}this._invokeAll(function(l){l.writeNode&&l.writeNode(e,r)});const o=t.nodes.push(r)-1;return i.set(e,o),o}processScene(e){const t=this.json,n=this.options;t.scenes||(t.scenes=[],t.scene=0);const i={};e.name!==""&&(i.name=e.name),t.scenes.push(i);const r=[];for(let o=0,l=e.children.length;o<l;o++){const h=e.children[o];if(h.visible||n.onlyVisible===!1){const u=this.processNode(h);u!==null&&r.push(u)}}r.length>0&&(i.nodes=r),this.serializeUserData(e,i)}processObjects(e){const t=new vu;t.name="AuxScene";for(let n=0;n<e.length;n++)t.children.push(e[n]);this.processScene(t)}processInput(e){const t=this.options;e=e instanceof Array?e:[e],this._invokeAll(function(i){i.beforeParse&&i.beforeParse(e)});const n=[];for(let i=0;i<e.length;i++)e[i]instanceof vu?this.processScene(e[i]):n.push(e[i]);n.length>0&&this.processObjects(n);for(let i=0;i<this.skins.length;++i)this.processSkin(this.skins[i]);for(let i=0;i<t.animations.length;++i)this.processAnimation(t.animations[i],e[0]);this._invokeAll(function(i){i.afterParse&&i.afterParse(e)})}_invokeAll(e){for(let t=0,n=this.plugins.length;t<n;t++)e(this.plugins[t])}}class yK{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,t){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight){console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);return}const n=this.writer,i=n.json,r=n.extensionsUsed,o={};e.name&&(o.name=e.name),o.color=e.color.toArray(),o.intensity=e.intensity,e.isDirectionalLight?o.type="directional":e.isPointLight?(o.type="point",e.distance>0&&(o.range=e.distance)):e.isSpotLight&&(o.type="spot",e.distance>0&&(o.range=e.distance),o.spot={},o.spot.innerConeAngle=(e.penumbra-1)*e.angle*-1,o.spot.outerConeAngle=e.angle),e.decay!==void 0&&e.decay!==2&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),e.target&&(e.target.parent!==e||e.target.position.x!==0||e.target.position.y!==0||e.target.position.z!==-1)&&console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),r[this.name]||(i.extensions=i.extensions||{},i.extensions[this.name]={lights:[]},r[this.name]=!0);const l=i.extensions[this.name].lights;l.push(o),t.extensions=t.extensions||{},t.extensions[this.name]={light:l.length-1}}}class vK{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,t){if(!e.isMeshBasicMaterial)return;const i=this.writer.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},i[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}}class xK{constructor(e){this.writer=e,this.name="KHR_materials_pbrSpecularGlossiness"}writeMaterial(e,t){if(!e.isGLTFSpecularGlossinessMaterial)return;const n=this.writer,i=n.extensionsUsed,r={};t.pbrMetallicRoughness.baseColorFactor&&(r.diffuseFactor=t.pbrMetallicRoughness.baseColorFactor);const o=[1,1,1];if(e.specular.toArray(o,0),r.specularFactor=o,r.glossinessFactor=e.glossiness,t.pbrMetallicRoughness.baseColorTexture&&(r.diffuseTexture=t.pbrMetallicRoughness.baseColorTexture),e.specularMap){const l={index:n.processTexture(e.specularMap)};n.applyTextureTransform(l,e.specularMap),r.specularGlossinessTexture=l}t.extensions=t.extensions||{},t.extensions[this.name]=r,i[this.name]=!0}}class wK{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial)return;const n=this.writer,i=n.extensionsUsed,r={};if(r.clearcoatFactor=e.clearcoat,e.clearcoatMap){const o={index:n.processTexture(e.clearcoatMap)};n.applyTextureTransform(o,e.clearcoatMap),r.clearcoatTexture=o}if(r.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){const o={index:n.processTexture(e.clearcoatRoughnessMap)};n.applyTextureTransform(o,e.clearcoatRoughnessMap),r.clearcoatRoughnessTexture=o}if(e.clearcoatNormalMap){const o={index:n.processTexture(e.clearcoatNormalMap)};n.applyTextureTransform(o,e.clearcoatNormalMap),r.clearcoatNormalTexture=o}t.extensions=t.extensions||{},t.extensions[this.name]=r,i[this.name]=!0}}class bK{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial)return;const n=this.writer,i=n.extensionsUsed,r={};if(r.iridescenceFactor=e.iridescence,e.iridescenceMap){const o={index:n.processTexture(e.iridescenceMap)};n.applyTextureTransform(o,e.iridescenceMap),r.iridescenceTexture=o}if(r.iridescenceIor=e.iridescenceIOR,r.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],r.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){const o={index:n.processTexture(e.iridescenceThicknessMap)};n.applyTextureTransform(o,e.iridescenceThicknessMap),r.iridescenceThicknessTexture=o}t.extensions=t.extensions||{},t.extensions[this.name]=r,i[this.name]=!0}}class EK{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const n=this.writer,i=n.extensionsUsed,r={};if(r.transmissionFactor=e.transmission,e.transmissionMap){const o={index:n.processTexture(e.transmissionMap)};n.applyTextureTransform(o,e.transmissionMap),r.transmissionTexture=o}t.extensions=t.extensions||{},t.extensions[this.name]=r,i[this.name]=!0}}class CK{constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const n=this.writer,i=n.extensionsUsed,r={};if(r.thicknessFactor=e.thickness,e.thicknessMap){const o={index:n.processTexture(e.thicknessMap)};n.applyTextureTransform(o,e.thicknessMap),r.thicknessTexture=o}r.attenuationDistance=e.attenuationDistance,r.attenuationColor=e.attenuationColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=r,i[this.name]=!0}}IS.Utils={insertKeyframe:function(a,e){const n=a.getValueSize(),i=new a.TimeBufferType(a.times.length+1),r=new a.ValueBufferType(a.values.length+n),o=a.createInterpolant(new a.ValueBufferType(n));let l;if(a.times.length===0){i[0]=e;for(let h=0;h<n;h++)r[h]=0;l=0}else if(e<a.times[0]){if(Math.abs(a.times[0]-e)<.001)return 0;i[0]=e,i.set(a.times,1),r.set(o.evaluate(e),0),r.set(a.values,n),l=0}else if(e>a.times[a.times.length-1]){if(Math.abs(a.times[a.times.length-1]-e)<.001)return a.times.length-1;i[i.length-1]=e,i.set(a.times,0),r.set(a.values,0),r.set(o.evaluate(e),a.values.length),l=i.length-1}else for(let h=0;h<a.times.length;h++){if(Math.abs(a.times[h]-e)<.001)return h;if(a.times[h]<e&&a.times[h+1]>e){i.set(a.times.slice(0,h+1),0),i[h+1]=e,i.set(a.times.slice(h+1),h+2),r.set(a.values.slice(0,(h+1)*n),0),r.set(o.evaluate(e),(h+1)*n),r.set(a.values.slice((h+1)*n),(h+2)*n),l=h+1;break}}return a.times=i,a.values=r,l},mergeMorphTargetTracks:function(a,e){const t=[],n={},i=a.tracks;for(let r=0;r<i.length;++r){let o=i[r];const l=ni.parseTrackName(o.name),h=ni.findNode(e,l.nodeName);if(l.propertyName!=="morphTargetInfluences"||l.propertyIndex===void 0){t.push(o);continue}if(o.createInterpolant!==o.InterpolantFactoryMethodDiscrete&&o.createInterpolant!==o.InterpolantFactoryMethodLinear){if(o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),o=o.clone(),o.setInterpolation(kc)}const u=h.morphTargetInfluences.length,f=h.morphTargetDictionary[l.propertyIndex];if(f===void 0)throw new Error("THREE.GLTFExporter: Morph target name not found: "+l.propertyIndex);let g;if(n[h.uuid]===void 0){g=o.clone();const A=new g.ValueBufferType(u*g.times.length);for(let v=0;v<g.times.length;v++)A[v*u+f]=g.values[v];g.name=(l.nodeName||"")+".morphTargetInfluences",g.values=A,n[h.uuid]=g,t.push(g);continue}const m=o.createInterpolant(new o.ValueBufferType(1));g=n[h.uuid];for(let A=0;A<g.times.length;A++)g.values[A*u+f]=m.evaluate(g.times[A]);for(let A=0;A<o.times.length;A++){const v=this.insertKeyframe(g,o.times[A]);g.values[v*u+f]=o.values[A]}}return a.tracks=t,a}};class SK{constructor(e){this.writer=e,this.name="EXT_mesh_gpu_instancing"}writeNode(e,t){if(e.constructor.name!=="InstancedMesh")return;const n=this.writer,i=n.extensionsUsed,r={};t.extensions=t.extensions||{},t.extensions[this.name]=r;let o=new xn;const l=new Array,h=new Array,u=new Array;for(let A=0;A<e.count;A++){e.getMatrixAt(A,o);let v=new q,w=new Ot,b=new q;o.decompose(v,w,b),l.push(v.x,v.y,v.z),h.push(w.x,w.y,w.z,w.w),u.push(b.x,b.y,b.z)}const f=new Float32Array(l),g=new Float32Array(h),m=new Float32Array(u);r.attributes={TRANSLATION:n.processAccessor(new Jn(f,3)),ROTATION:n.processAccessor(new Jn(g,4)),SCALE:n.processAccessor(new Jn(m,3))},i[this.name]=!0}}const Sl=ao,u_="$___Export_Components",MK="NEEDLE_components";var Lne;class TK{constructor(){E(this,Lne)}}Lne=Xd;class IK{constructor(e,t,n){E(this,"node");E(this,"nodeIndex");E(this,"nodeDef");this.node=e,this.nodeIndex=t,this.nodeDef=n}}class hO{constructor(){E(this,"parser");E(this,"nodeToObjectMap",{});E(this,"exportContext");E(this,"objectToNodeMap",{});E(this,"context");E(this,"writer")}get name(){return MK}registerExport(e){e.register(t=>{const n=t.serializeUserData.bind(t);return this.writer=t,t.serializeUserData=(i,r)=>{try{this.serializeUserData(i,r),n(i,r)}finally{this.afterSerializeUserData(i,r)}},this})}beforeParse(){this.exportContext={},this.objectToNodeMap={}}serializeUserData(e,t){var i;const n=(i=e.userData)==null?void 0:i.components;!n||n.length<=0||(delete e.userData.components,e[u_]=n)}afterSerializeUserData(e,t){if(e.type==="Scene"&&Sl&&console.log("DONE",JSON.stringify(t)),e[u_]===void 0)return;const n=e[u_];delete e[u_],n!==null&&(e.userData.components=n)}writeNode(e,t){let n=this.writer.json.nodes.length;console.log(e.name,n,e.uuid);const i=new IK(e,n,t);this.exportContext[n]=i,this.objectToNodeMap[e.uuid]=n}afterParse(e){var t;Sl&&console.log("AFTER",e);for(const n in this.exportContext){const i=this.exportContext[n],r=i.node,o=i.nodeDef,l=i.nodeIndex,h=(t=r.userData)==null?void 0:t.components;if(!h||h.length<=0)continue;const u=new TK;o.extensions=o.extensions||{},o.extensions[this.name]=u,this.context.object=r,this.context.nodeId=l,this.context.objectToNode=this.objectToNodeMap;const f=[];for(const g of h){this.context.target=g;const m=Rte(g,this.context);m!==null&&f.push(m)}f.length>0&&(u[Xd]=f,Sl&&console.log("DID WRITE",r,"nodeIndex",l,f))}}beforeRoot(){return Sl&&console.log("BEGIN LOAD"),this.nodeToObjectMap={},null}async afterRoot(e){const t=e.parser,n=t==null?void 0:t.extensions;if(!n)return;const i=n[this.name];Sl&&console.log("After root",e,this.parser,n);const r=[];if(i===!0){const o=t.json.nodes;for(let l=0;l<o.length;l++){const h=await t.getDependency("node",l);this.nodeToObjectMap[l]=h}for(let l=0;l<o.length;l++){const h=o[l],u=l,f=h.extensions;if(!f)continue;const g=f[this.name];if(!g)continue;Sl&&console.log("NODE",h);const m=this.nodeToObjectMap[u];if(!m){console.error("Could not find object for node index: "+u,h,t);continue}r.push(this.createComponents(m,g))}}await Promise.all(r)}async createComponents(e,t){if(!t)return;const n=t[Xd];if(n){Sl&&console.log(e.name,n);for(const i in n){const r=n[i];Sl&&console.log("Serialized data",JSON.parse(JSON.stringify(r))),r&&this.parser&&await pS(this.parser,r),e.userData=e.userData||{},e.userData[Xd]=e.userData[Xd]||[],e.userData[Xd].push(r)}}}}class uO extends Ic{constructor(){super(...arguments);E(this,"sceneRoot")}start(){this.startCoroutine(this.updateGltfBox())}*updateGltfBox(){for(;;)for(let t=0;t<10;t++)yield}}class Ol extends Bt{constructor(){super(...arguments);E(this,"binary",!0);E(this,"objects",[]);E(this,"exporter");E(this,"ext")}async exportNow(t){console.log("DO EXPORT",this.objects);const n={binary:this.binary,pivot:Ol.calculateCenter(this.objects)},i=await this.export(this.objects,n);this.binary?t.endsWith(".glb")||(t+=".glb"):t.endsWith(".gltf")||(t+=".gltf"),this.binary?Ol.saveArrayBuffer(i,t):Ol.saveJson(i,t)}async export(t,n){var h;if(t===null||t.length<=0){console.log("no objects set to export");return}this.exporter||(this.exporter=new IS,this.exporter.register(u=>new SK(u)),this.ext=new hO,this.ext.registerExport(this.exporter)),Ol.filterTopmostParent(t);const i={trs:!1,onlyVisible:!0,truncateDrawRange:!1,binary:(h=n==null?void 0:n.binary)!=null?h:!0,maxTextureSize:1/0,embedImages:!0,includeCustomExtensions:!0,animations:Ol.collectAnimations(t)},r=new qt;n!=null&&n.pivot&&r.position.sub(n.pivot),console.log("EXPORT",t),t.forEach(u=>{u&&(r.children.push(u),u.matrixAutoUpdate=!1,u.matrix.copy(u.matrixWorld),Te.getComponentsInChildren(u,Vr).forEach(f=>{Te.isActiveInHierarchy(f.gameObject)&&f.setInstancingEnabled(!1)}))});const o=new HD(r);return this.ext.context=o,new Promise((u,f)=>{var g;try{(g=this.exporter)==null||g.parse(r,m=>{l(),u(m)},m=>{l(),f(m)},i)}catch(m){console.error(m),f(m)}finally{console.log("FINALLY")}});function l(){t.forEach(u=>{!u||(u.matrixAutoUpdate=!0,Te.getComponentsInChildren(u,Vr).forEach(f=>{Te.isActiveInHierarchy(f.gameObject)&&f.setInstancingEnabled(!1)}))})}}static saveArrayBuffer(t,n){this.save(new Blob([t],{type:"application/octet-stream"}),n)}static saveJson(t,n){this.save("data: text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(t)),n)}static save(t,n){const i=document.createElement("a");i.style.display="none",document.body.appendChild(i),typeof t=="string"?i.href=t:i.href=URL.createObjectURL(t),i.download=n,i.click(),i.remove()}static collectAnimations(t,n){n=n||[];for(const i of t)!i||i.traverseVisible(r=>{r.animations&&r.animations.length>0&&n.push(...r.animations)});return n}static calculateCenter(t,n){const i=n||new q;return i.set(0,0,0),t.forEach(r=>{i.add(ti(r))}),console.log(i),i.divideScalar(t.length),i}static filterTopmostParent(t){if(!(t.length<=0))for(let n=0;n<t.length;n++){let i=t[n];if(!i){t.splice(n,1),n--;continue}for(;i.parent;){if(t.includes(i.parent)){t.splice(n,1),n--;break}i=i.parent}}}}var RK=Object.defineProperty,PK=Object.getOwnPropertyDescriptor,RS=(a,e,t,n)=>{for(var i=n>1?void 0:n?PK(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&RK(e,t,i),i};class Hg extends Bt{constructor(){super(...arguments);E(this,"isGizmo",!1);E(this,"color0");E(this,"color1");E(this,"gridHelper");E(this,"size");E(this,"divisions");E(this,"offset")}onEnable(){var i,r;if(this.isGizmo&&!Fg)return;const t=this.size,n=this.divisions;this.gridHelper||(this.gridHelper=new m2(t,n,(i=this.color0)!=null?i:new _e(.4,.4,.4),(r=this.color1)!=null?r:new _e(.6,.6,.6)),this.offset!==void 0&&(this.gridHelper.position.y+=this.offset),this.gameObject.add(this.gridHelper))}}RS([Re()],Hg.prototype,"isGizmo",2);RS([Re(_e)],Hg.prototype,"color0",2);RS([Re(_e)],Hg.prototype,"color1",2);class BK extends _t{constructor(e,t){var b,S;const n=e.isCubeTexture,r=((S=n?(b=e.image[0])==null?void 0:b.width:e.image.width)!=null?S:1024)/4,o=Math.floor(Math.log2(r)),l=Math.pow(2,o),h=3*Math.max(l,16*7),u=4*l,f=[n?"#define ENVMAP_TYPE_CUBE":"",`#define CUBEUV_TEXEL_WIDTH ${1/h}`,`#define CUBEUV_TEXEL_HEIGHT ${1/u}`,`#define CUBEUV_MAX_MIP ${o}.0`],g=`
        varying vec3 vWorldPosition;

        void main() 
        {

            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );
            vWorldPosition = worldPosition.xyz;
            
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

        }
        `,m=f.join(`
`)+`
        #define ENVMAP_TYPE_CUBE_UV

        varying vec3 vWorldPosition;

        uniform float radius;
        uniform float height;
        uniform float angle;

        #ifdef ENVMAP_TYPE_CUBE

            uniform samplerCube map;

        #else

            uniform sampler2D map;

        #endif

        // From: https://www.shadertoy.com/view/4tsBD7
        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) 
        {

            float d = dot ( rd, n );
            
            if( d > 0.0 ) { return 1e6; }
            
            vec3  o = ro - c;
            float t = - dot( n, o ) / d;
            vec3  q = o + rd * t;
            
            return ( dot( q, q ) < r * r ) ? t : 1e6;

        }

        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm
        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) 
        {

            vec3 oc = ro - ce;
            float b = dot( oc, rd );
            float c = dot( oc, oc ) - ra * ra;
            float h = b * b - c;
            
            if( h < 0.0 ) { return -1.0; }
            
            h = sqrt( h );
            
            return - b + h;

        }

        vec3 project() 
        {

            vec3 p = normalize( vWorldPosition );
            vec3 camPos = cameraPosition;
            camPos.y -= height;

            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );
            if( intersection > 0.0 ) {
                
                vec3 h = vec3( 0.0, - height, 0.0 );
                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );
                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;

            } else {

                p = vec3( 0.0, 1.0, 0.0 );

            }

            return p;

        }

        #include <common>
        #include <cube_uv_reflection_fragment>

        void main() 
        {

            vec3 projectedWorldPosition = project();
            
            #ifdef ENVMAP_TYPE_CUBE

                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;

            #else

                vec3 direction = normalize( projectedWorldPosition );
                vec2 uv = equirectUv( direction );
                vec3 outcolor = texture2D( map, uv ).rgb;

            #endif

            gl_FragColor = vec4( outcolor, 1.0 );

            #include <tonemapping_fragment>
            #include <encodings_fragment>

        }
        `,A={map:{value:e},height:{value:(t==null?void 0:t.height)||15},radius:{value:(t==null?void 0:t.radius)||100}},v=new Rf(1,16),w=new nr({uniforms:A,fragmentShader:m,vertexShader:g,side:er});super(v,w)}set radius(e){this.material.uniforms.radius.value=e}get radius(){return this.material.uniforms.radius.value}set height(e){this.material.uniforms.height.value=e}get height(){return this.material.uniforms.height.value}}var LK=Object.defineProperty,DK=Object.getOwnPropertyDescriptor,PS=(a,e,t,n)=>{for(var i=n>1?void 0:n?DK(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&LK(e,t,i),i};class Vg extends Bt{constructor(){super(...arguments);E(this,"_scale",20);E(this,"_radius",100);E(this,"_height",100);E(this,"_lastEnvironment");E(this,"env");E(this,"_watcher")}set scale(t){var n;this._scale=t,(n=this.env)==null||n.scale.setScalar(t)}get scale(){return this._scale}set radius(t){this._radius=t,this.env&&(this.env.height=t)}get radius(){return this._radius}set height(t){this._height=t,this.env&&(this.env.height=t)}get height(){return this._height}onEnable(){this.updateProjection(),this._watcher||(this._watcher=new wq(this.context.scene,"environment"),this._watcher.subscribeWrite(this.updateProjection.bind(this))),this._watcher.apply()}onDisable(){var t,n;(t=this._watcher)==null||t.revoke(),(n=this.env)==null||n.removeFromParent()}updateProjection(){!this.context.scene.environment||((!this.env||this.context.scene.environment!==this._lastEnvironment)&&(console.log("Create/Update Ground Projection",this.context.scene.environment.name),this.env=new BK(this.context.scene.environment)),this._lastEnvironment=this.context.scene.environment,this.env.parent||this.gameObject.add(this.env),this.env.scale.setScalar(this._scale),this.env.radius=this._radius,this.env.height=this._height,this.env.isObject3D===!0&&this.env.layers.set(2))}}PS([Re()],Vg.prototype,"scale",1);PS([Re()],Vg.prototype,"radius",1);PS([Re()],Vg.prototype,"height",1);var OK=Object.defineProperty,FK=Object.getOwnPropertyDescriptor,qa=(a,e,t,n)=>{for(var i=n>1?void 0:n?FK(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&OK(e,t,i),i};function yb(a){return a*Math.PI/180}const HP=300,VP=jt("debuglights");class Go extends Bt{constructor(){super(...arguments);E(this,"type",0);E(this,"range",1);E(this,"spotAngle",1);E(this,"innerSpotAngle",1);E(this,"color",new _e(16777215));E(this,"_shadowNearPlane",.1);E(this,"_shadowBias",0);E(this,"_shadowNormalBias",1);E(this,"_shadows",1);E(this,"lightmapBakeType",4);E(this,"_intensity",1);E(this,"_shadowDistance");E(this,"shadowWidth");E(this,"shadowHeight");E(this,"_shadowResolution");E(this,"light");E(this,"_webXRStartedListener");E(this,"_webXREndedListener");E(this,"_webARRoot")}set shadowNearPlane(t){var n,i;if(t!==this._shadowNearPlane&&(this._shadowNearPlane=t,((i=(n=this.light)==null?void 0:n.shadow)==null?void 0:i.camera)!==void 0)){const r=this.light.shadow.camera;r.near=t}}get shadowNearPlane(){return this._shadowNearPlane}set shadowBias(t){var n,i;t!==this._shadowBias&&(this._shadowBias=t,((i=(n=this.light)==null?void 0:n.shadow)==null?void 0:i.bias)!==void 0&&(this.light.shadow.bias=t,this.light.shadow.needsUpdate=!0))}get shadowBias(){return this._shadowBias}set shadowNormalBias(t){var n,i;t!==this._shadowNormalBias&&(this._shadowNormalBias=t,((i=(n=this.light)==null?void 0:n.shadow)==null?void 0:i.normalBias)!==void 0&&(this.light.shadow.normalBias=t,this.light.shadow.needsUpdate=!0))}get shadowNormalBias(){return this._shadowNormalBias}set shadows(t){this._shadows=t,this.light&&(this.light.castShadow=t===1||t===2)}get shadows(){return this._shadows}set intensity(t){var n;if(this._intensity=t,this.light){let i=1;if(this.context.isInXR&&this._webARRoot){const r=(n=this._webARRoot)==null?void 0:n.arScale;typeof r=="number"&&r>0&&(i/=r)}this.light.intensity=t*i}}get intensity(){return this._intensity}get shadowDistance(){const t=this.light;return t?t.shadow.camera.far:-1}set shadowDistance(t){this._shadowDistance=t;const n=this.light;if(n){const i=n.shadow.camera;i.far=t,i.updateProjectionMatrix()}}get shadowResolution(){const t=this.light;return t?t.shadow.mapSize.x:-1}set shadowResolution(t){if(t===this._shadowResolution)return;this._shadowResolution=t;const n=this.light;n&&(n.shadow.mapSize.set(t,t),n.shadow.needsUpdate=!0)}get isBaked(){return this.lightmapBakeType===2}get selfIsLight(){if(this.gameObject.isLight===!0)return!0;switch(this.gameObject.type){case"SpotLight":case"PointLight":case"DirectionalLight":return!0}return!1}getWorldPosition(t){return this.light?this.type===1?this.light.getWorldPosition(t).multiplyScalar(1):this.light.getWorldPosition(t):t}updateIntensity(){this.intensity=this._intensity}awake(){var t;this.color=new _e((t=this.color)!=null?t:16777215)}onEnable(){this.createLight(),!this.isBaked&&(this.light&&(this.selfIsLight||this.light.parent!==this.gameObject&&this.gameObject.add(this.light)),this.type===1&&this.startCoroutine(this.updateMainLightRoutine(),No.LateUpdate),this._webXRStartedListener=Ti.addEventListener(Ks.XRStarted,this.onWebXRStarted.bind(this)),this._webXREndedListener=Ti.addEventListener(Ks.XRStopped,this.onWebXREnded.bind(this)))}onDisable(){Ti.removeEventListener(Ks.XRStarted,this._webXRStartedListener),Ti.removeEventListener(Ks.XRStopped,this._webXREndedListener)}onWebXRStarted(){var t;this._webARRoot=(t=this.gameObject.getComponentInParent(zf))!=null?t:void 0,this.startCoroutine(this._updateLightIntensityInARRoutine())}*_updateLightIntensityInARRoutine(){for(;this.context.isInXR;){yield,this.updateIntensity();for(let t=0;t<30;t++)yield}}onWebXREnded(){this.updateIntensity()}createLight(){if(this.light)return;let t=this.selfIsLight;if(t)switch(this.light=this.gameObject,this.type){case 1:this.setDirectionalLight(this.light);break}else switch(this.type){case 1:const n=new zy(this.color,this.intensity*Math.PI);if(n.position.set(0,0,-HP*.5).applyQuaternion(this.gameObject.quaternion),this.gameObject.add(n.target),$C(n.target,0,0,0),this.light=n,this.gameObject.position.set(0,0,0),this.gameObject.rotation.set(0,0,0),VP){const l=new g2(this.light,.2,this.color);this.context.scene.add(l)}break;case 0:const i=new Ny(this.color,this.intensity*Math.PI,this.range,yb(this.spotAngle/2),1-yb(this.innerSpotAngle/2)/yb(this.spotAngle/2),2);i.position.set(0,0,0),i.rotation.set(0,0,0),this.light=i;const r=i.target;i.add(r),r.position.set(0,0,this.range),r.rotation.set(0,0,0);break;case 2:const o=new Uy(this.color,this.intensity*Math.PI,this.range);this.light=o;break}if(this.light!==void 0){this.shadows!==0?this.light.castShadow=!0:this.light.castShadow=!1,this._shadowResolution!==void 0&&this._shadowResolution>4?(this.light.shadow.mapSize.width=this._shadowResolution,this.light.shadow.mapSize.height=this._shadowResolution):(this.light.shadow.mapSize.width=2048,this.light.shadow.mapSize.height=2048),this.light.shadow.bias=this.shadowBias*1e-5,this.light.shadow.normalBias=this.shadowNormalBias*1e-4;const n=this.light.shadow.camera;if(n.near=this.shadowNearPlane,this._shadowDistance!==void 0&&typeof this._shadowDistance=="number"?n.far=this._shadowDistance:n.far=HP*Math.abs(this.gameObject.scale.z),this.gameObject.scale.set(1,1,1),this.shadowWidth!==void 0)n.left=-this.shadowWidth/2,n.right=this.shadowWidth/2;else{const i=this.gameObject.scale.x;n.left*=i,n.right*=i}if(this.shadowHeight!==void 0)n.top=this.shadowHeight/2,n.bottom=-this.shadowHeight/2;else{const i=this.gameObject.scale.y;n.top*=i,n.bottom*=i}this.light.shadow.needsUpdate=!0,VP&&this.context.scene.add(new A2(n)),this.isBaked?this.light.removeFromParent():t||this.gameObject.add(this.light)}}*updateMainLightRoutine(){for(;;){this.type===1&&((!this.context.mainLight||this.intensity>this.context.mainLight.intensity)&&(this.context.mainLight=this),yield);break}}setDirectionalLight(t){t.add(t.target),t.target.position.set(0,0,-1)}}qa([Re()],Go.prototype,"type",2);qa([Re(_e)],Go.prototype,"color",2);qa([Re()],Go.prototype,"shadowNearPlane",1);qa([Re()],Go.prototype,"shadowBias",1);qa([Re()],Go.prototype,"shadowNormalBias",1);qa([Re()],Go.prototype,"shadows",1);qa([Re()],Go.prototype,"lightmapBakeType",2);qa([Re()],Go.prototype,"intensity",1);qa([Re()],Go.prototype,"shadowDistance",1);qa([Re()],Go.prototype,"shadowResolution",1);new q(0,0,0);var kK=Object.defineProperty,NK=Object.getOwnPropertyDescriptor,Wg=(a,e,t,n)=>{for(var i=n>1?void 0:n?NK(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&kK(e,t,i),i};const Jd=jt("debugLODs"),UK=jt("noLODs");class Hf{constructor(){E(this,"screenRelativeTransitionHeight");E(this,"distance");E(this,"renderers")}}Wg([Re()],Hf.prototype,"screenRelativeTransitionHeight",2);Wg([Re()],Hf.prototype,"distance",2);Wg([Re()],Hf.prototype,"renderers",2);class zK{constructor(e,t){E(this,"model");E(this,"renderers");this.model=t,this.renderers=[];for(const n of t.renderers){const i=this.findRenderer(n,e.gameObject);i&&i.gameObject?this.renderers.push(i):Jd&&console.warn("Renderer not found: "+n,e.gameObject)}}findRenderer(e,t){const n=Te.foreachComponent(t,i=>{var o;return i.guid===e||((o=Object.getPrototypeOf(i))==null?void 0:o.guid)===e?i:null});if(n)return n;for(const i of t.children){const r=this.findRenderer(e,i);if(r)return r}return null}}class hv extends Bt{constructor(){super(...arguments);E(this,"fadeMode",0);E(this,"localReferencePoint");E(this,"lodCount",0);E(this,"size",0);E(this,"animateCrossFading",!1);E(this,"lodModels");E(this,"_lods",[]);E(this,"_settings",[]);E(this,"_lodsHandler");E(this,"_distanceFactor",1)}start(){if(!UK&&!this._lodsHandler&&!!this.gameObject&&(Jd&&console.log(this),this.lodModels&&Array.isArray(this.lodModels))){let t=0,n=[];for(const r of this.lodModels){t=Math.max(r.distance,t);const o=new zK(this,r);this._lods.push(o);for(const l of o.renderers)n.includes(l)||n.push(l)}this._lodsHandler=new Array;for(let r=0;r<n.length;r++){const o=new yC;this._lodsHandler.push(o),this.gameObject.add(o)}const i=new qt;Jd&&console.log(n);for(let r=0;r<n.length;r++){const o=n[r],l=this._lodsHandler[r],h=o.gameObject;let u=0,f=0;Jd&&console.log(r,h.name);for(const m of this._lods){let A=null;m.renderers.includes(o)?A=h:A=i,Jd&&console.log("add",m.model.distance,A.name);const v=m.model.distance;f=v-u,u=Math.max(v,u),this.onAddLodLevel(l,A,v)}const g=u+f;Jd&&console.log("cull",g),this.onAddLodLevel(l,i,g)}}}update(){if(!this.gameObject||!this._lodsHandler)return;const t=this.context.mainCamera;if(!!t)for(const n of this._lodsHandler)n.update(t)}onAddLodLevel(t,n,i){t.addLevel(n,i*this._distanceFactor);const r={lod:t,levelIndex:t.levels.length-1,distance:i};this._settings.push(r)}distanceFactor(t){if(t!==this._distanceFactor){this._distanceFactor=t;for(const n of this._settings){const i=n.lod.levels[n.levelIndex];i.distance=n.distance*t}}}}Wg([Re(q)],hv.prototype,"localReferencePoint",2);Wg([Re(Hf)],hv.prototype,"lodModels",2);class dO extends Bt{}class fO extends Bt{}var GK=Object.defineProperty,HK=Object.getOwnPropertyDescriptor,VK=(a,e,t,n)=>{for(var i=n>1?void 0:n?HK(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&GK(e,t,i),i};const vb=jt("debugnestedgltf");class BS extends Bt{constructor(){super(...arguments);E(this,"filePath");E(this,"_isLoadingOrDoneLoading",!1)}listenToProgress(t){var n;(n=this.filePath)==null||n.beginListenDownload(t)}preload(){var t;(t=this.filePath)==null||t.preload()}async start(){var n,i,r,o,l,h;if(this._isLoadingOrDoneLoading)return;vb&&console.log(this,this.guid);const t=this.gameObject.parent;if(t){this._isLoadingOrDoneLoading=!0;const u=new Fo;u.idProvider=new la(this.hash(this.guid)),u.parent=t,this.gameObject.updateMatrix();const f=this.gameObject.matrix;vb&&console.log("Load nested:",(i=(n=this.filePath)==null?void 0:n.uri)!=null?i:this.filePath,this.gameObject.position);const g=await((o=(r=this.filePath)==null?void 0:r.instantiate)==null?void 0:o.call(this.filePath,u));g&&(g.matrixAutoUpdate=!1,g.matrix.identity(),g.applyMatrix4(f),g.matrixAutoUpdate=!0),this.destroy(),vb&&console.log("Nested loading done:",(h=(l=this.filePath)==null?void 0:l.uri)!=null?h:this.filePath,g)}}hash(t){let n=0;for(let i=0;i<t.length;i++)n=t.charCodeAt(i)+((n<<5)-n);return n}}VK([Re(Nc)],BS.prototype,"filePath",2);var WK=Object.defineProperty,QK=Object.getOwnPropertyDescriptor,uv=(a,e,t,n)=>{for(var i=n>1?void 0:n?QK(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&WK(e,t,i),i};class Vf extends Bt{constructor(){super(...arguments);E(this,"referenceSpace");E(this,"from");E(this,"affectPosition",!1);E(this,"affectRotation",!1);E(this,"alignLookDirection",!1);E(this,"levelLookDirection",!1);E(this,"levelPosition",!1);E(this,"positionOffset",new q(0,0,0));E(this,"rotationOffset",new q(0,0,0));E(this,"offset",new q(0,0,0))}update(){if(!this.from)return;var t=ti(this.from),n=uo(this.from);this.offset.copy(this.positionOffset);const i=this.offset.length();if(this.referenceSpace&&this.offset.transformDirection(this.referenceSpace.matrixWorld).multiplyScalar(i),t.add(this.offset),this.levelPosition&&this.referenceSpace){const h=new Po(this.gameObject.up,0),u=ti(this.referenceSpace);h.setFromNormalAndCoplanarPoint(this.gameObject.up,u);const f=new q(0,0,0);h.projectPoint(t,f),t.copy(f)}this.affectPosition&&ys(this.gameObject,t);const r=new vs(this.rotationOffset.x,this.rotationOffset.y,this.rotationOffset.z),o=new Ot().setFromEuler(r);this.affectRotation&&Nr(this.gameObject,n.multiply(o));let l=new q;this.from.getWorldDirection(l).multiplyScalar(50),this.levelLookDirection&&(l.y=0),this.alignLookDirection&&this.gameObject.lookAt(l)}}uv([Re(Te)],Vf.prototype,"referenceSpace",2);uv([Re(Te)],Vf.prototype,"from",2);uv([Re(q)],Vf.prototype,"positionOffset",2);uv([Re(q)],Vf.prototype,"rotationOffset",2);class pO{constructor(){E(this,"randomizeRotationDirection",0);E(this,"duration",5);E(this,"loop",!0);E(this,"prewarm",!1);E(this,"startDelay");E(this,"startDelayMultiplier",0);E(this,"startLifetime");E(this,"startLifetimeMultiplier",5);E(this,"startSpeed");E(this,"startSpeedMultiplier",5);E(this,"startSize3D",!1);E(this,"startSize");E(this,"startSizeMultiplier",1);E(this,"startSizeX");E(this,"startSizeXMultiplier",1);E(this,"startSizeY");E(this,"startSizeYMultiplier",1);E(this,"startSizeZ");E(this,"startSizeZMultiplier",1);E(this,"startRotation3D",!1);E(this,"startRotation");E(this,"startRotationMultiplier",0);E(this,"startRotationX");E(this,"startRotationXMultiplier",0);E(this,"startRotationY");E(this,"startRotationYMultiplier",0);E(this,"startRotationZ");E(this,"startRotationZMultiplier",0);E(this,"flipRotation",0);E(this,"startColor",new _e(1,1,1));E(this,"startColor1",new _e(0,0,0));E(this,"gravityModifier");E(this,"gravityModifierMultiplier",0);E(this,"simulationSpace",0);E(this,"customSimulationSpace",null);E(this,"simulationSpeed",1);E(this,"useUnscaledTime",!1);E(this,"scalingMode",1);E(this,"playOnAwake",!0);E(this,"maxParticles",1e3);E(this,"emitterVelocityMode",1);E(this,"stopAction",0);E(this,"ringBufferMode",0);E(this,"ringBufferLoopRange",new Xe(0,1));E(this,"cullingMode",0)}}class mO{constructor(){E(this,"burstCount",0);E(this,"enabled",!0);E(this,"rate",10);E(this,"rateMutliplier",1);E(this,"rateOverDistance",0);E(this,"rateOverDistanceMultiplier",0);E(this,"rateOverTime",0);E(this,"rateOverTimeMultiplier",0)}}class gO{constructor(){E(this,"shapeType",xc.Box);E(this,"enabled",!0);E(this,"alignToDirection",!1);E(this,"angle",0);E(this,"arc",360);E(this,"arcmode",0);E(this,"box",new q(1,1,1));E(this,"boxThickness",new q(0,0,0));E(this,"position",new q(0,0,0));E(this,"rotation",new q(0,0,0));E(this,"scale",new q(1,1,1));E(this,"radius",1);E(this,"sphericalDirectionAmount",0)}}var xc=(a=>(a[a.Sphere=0]="Sphere",a[a.SphereShell=1]="SphereShell",a[a.Hemisphere=2]="Hemisphere",a[a.HemisphereShell=3]="HemisphereShell",a[a.Cone=4]="Cone",a[a.Box=5]="Box",a[a.Mesh=6]="Mesh",a[a.ConeVolume=7]="ConeVolume",a[a.Circle=10]="Circle",a[a.SingleSidedEdge=11]="SingleSidedEdge",a[a.MeshRenderer=12]="MeshRenderer",a[a.SkinnedMeshRenderer=13]="SkinnedMeshRenderer",a[a.BoxShell=14]="BoxShell",a[a.BoxEdge=15]="BoxEdge",a[a.Donut=16]="Donut",a[a.Rectangle=17]="Rectangle",a[a.Sprite=18]="Sprite",a[a.SpriteRenderer=19]="SpriteRenderer",a))(xc||{});const AO=jt("debugparticles");class jK{constructor(){E(this,"age",0);E(this,"lifetime",0);E(this,"position");E(this,"velocity");E(this,"color")}}class LS extends Bt{constructor(){super(...arguments);E(this,"sharedMaterial");E(this,"mesh")}get mainTexture(){if(this.sharedMaterial){const t=this.context.assets.findTexture(this.sharedMaterial);if(t)return t}return null}getMesh(t){return this.mesh?this.context.assets.findMesh(this.mesh):null}awake(){AO&&console.log(this)}}class _O extends Bt{constructor(){super(...arguments);E(this,"main");E(this,"emission");E(this,"shape");E(this,"renderer");E(this,"geometry");E(this,"material");E(this,"particlesMesh");E(this,"positions");E(this,"positionsArray");E(this,"particleStates",[]);E(this,"activeCount",0);E(this,"shapeRotation",new Ot);E(this,"tempVec3",new q);E(this,"tempQuat",new Ot)}awake(){this.renderer=Te.getComponent(this.gameObject,LS),AO&&console.log(this)}onEnable(){if(this.geometry)return;this.particleStates=[],this.shapeRotation.setFromEuler(new vs(this.shape.rotation.x,this.shape.rotation.y,this.shape.rotation.z)),this.geometry=new Sn,this.positionsArray=new Float32Array(this.main.maxParticles*3),this.positions=new tn(this.positionsArray,3),this.geometry.setAttribute("position",this.positions);const t=new Float32Array(this.main.maxParticles*3);for(let i=0;i<t.length;i++)t[i*3]=1,t[i*3+1]=1,t[i*3+2]=1;const n=new tn(t,3);this.geometry.setAttribute("color",n),this.material=new vg({size:this.main.startSize,color:16777215,vertexColors:!0}),this.material.map=this.renderer.mainTexture,this.particlesMesh=new Dy(this.geometry,this.material),this.particlesMesh.layers.enable(2),this.gameObject.add(this.particlesMesh),this.activeCount=this.main.prewarm?this.main.maxParticles:0}update(){if(!this.geometry)return;const t=this.context.time.deltaTime;this.emit(t);for(let n=0;n<this.activeCount;n+=1){const i=this.particleStates[n];if(!i)continue;const r=i.velocity.x*t,o=i.velocity.y*t,l=i.velocity.z*t;i.position.x+=r,i.position.y+=o,i.position.z+=l,this.updateOverLifetime(n,i),this.geometry.attributes.position.setXYZ(n,i.position.x,i.position.y,i.position.z),this.geometry.attributes.color.setXYZ(n,i.color.r,i.color.g,i.color.b)}this.geometry&&(this.geometry.attributes.position.needsUpdate=!0,this.geometry.setDrawRange(0,this.activeCount))}emit(t){var i;const n=this.activeCount;for(let r=0;r<n;r+=1){if(r>=this.particleStates.length){const l=new jK;l.lifetime=(i=this.main.startLifetime)!=null?i:1,l.position=new q,l.velocity=new q,l.color=new _e(1,0,0),this.particleStates.push(l),this.initializeParticle(r,l),l.age=l.lifetime*Math.random()}const o=this.particleStates[r];if(o.age>o.lifetime){this.activeCount-=1,this.activeCount=Math.max(0,this.activeCount),this.initializeParticle(r,o);continue}o.age+=t,this.particleStates[r]=o}this.activeCount+=t*this.emission.rate,this.activeCount=Math.min(this.main.maxParticles,this.activeCount)}initializeParticle(t,n){if(!this.geometry)return;n.age=0,n.color.set(this.main.startColor),this.main.startColor1&&n.color.lerp(this.main.startColor1,Math.random()),this.geometry.attributes.color.needsUpdate=!0,this.assignPosition(n.position),this.assignVelocity(n.position,n.velocity);const i=n.position;i.multiply(this.shape.scale),i.applyQuaternion(this.shapeRotation),i.add(this.shape.position),this.particleStates.splice(t,1),this.particleStates.push(n)}updateOverLifetime(t,n){}assignPosition(t){switch(this.shape.shapeType){case xc.Sphere:t.set(Math.random()-.5,Math.random()-.5,Math.random()-.5).multiplyScalar(this.shape.radius);break;case xc.Box:t.set(Math.random()-.5,Math.random()-.5,Math.random()-.5);break;default:t.set(0,0,0);break}}assignVelocity(t,n){switch(this.shape.shapeType){case xc.Sphere:n.set(t.x,t.y,t.z);break;case xc.Box:n.set(0,0,1),this.shape.sphericalDirectionAmount>0&&(this.tempVec3.set(t.x,t.y,t.z).multiply(this.shape.scale).normalize(),n.lerp(this.tempVec3,this.shape.sphericalDirectionAmount));break;case xc.Cone:const i=new q(0,1,0);n.copy(i);break;case xc.Circle:this.tempQuat.setFromAxisAngle(this.tempVec3.set(0,0,1),Math.random()*Ei.toRadians(this.shape.arc)),n.copy(this.tempVec3.set(1,0,0).applyQuaternion(this.tempQuat));break;default:n.set(Math.random()*2-1,Math.random()*2-1,Math.random()*2-1);break}switch(n.normalize(),this.shape.shapeType){case xc.Circle:t.add(n).multiplyScalar(this.shape.radius);break}n.multiplyScalar(this.main.startSpeedMultiplier)}}function*qK(a,e=null){const t=e?e.time:_i.Current.time,n=t.time;for(;t.time-n<a;)yield}class eh extends Bt{constructor(){super(...arguments);E(this,"_didAssignPlayerColor",!1)}awake(){this.context.connection.beginListen(ha.JoinedRoom,this.tryAssignColor.bind(this))}onEnable(){this._didAssignPlayerColor||this.startCoroutine(this.waitForConnection())}*waitForConnection(){for(;!this.destroyed&&this.enabled&&(yield qK(.2),!this.tryAssignColor()););}tryAssignColor(){const t=Te.getComponentInParent(this.gameObject,fr);return t&&t.connectionId?(this._didAssignPlayerColor=!0,this.assignUserColor(t.connectionId),!0):!1}assignUserColor(t){const n=eh.hashCode(t),i=eh.colorFromHashCode(n);if(this.gameObject.type==="Mesh"){const r=this.gameObject;this.assignColor(i,t,r)}else if(this.gameObject.children)for(const r of this.gameObject.children){const o=r;o.material&&o.material.color&&this.assignColor(i,t,o)}}assignColor(t,n,i){let r=i.material;!r||(r._playerMaterial!==n?(r=r.clone(),r._playerMaterial=n,i.material=r):console.log("DONT CLONE",r),r.color=t)}static hashCode(t){var n=0,i,r;if(t.length===0)return n;for(i=0;i<t.length;i++)r=t.charCodeAt(i),n=(n<<5)-n+r,n|=0;return n}static colorFromHashCode(t){const n=(t&16711680)>>16,i=(t&65280)>>8,r=t&255;return new _e(n/255,i/255,r/255)}}function XK(){return new Promise((a,e)=>{let n=()=>{n!=null&&(document.removeEventListener("pointerdown",n),document.removeEventListener("click",n),document.removeEventListener("dragstart",n),document.removeEventListener("touchstart",n),a())};document.addEventListener("pointerdown",n),document.addEventListener("click",n),document.addEventListener("dragstart",n),document.addEventListener("touchstart",n)})}async function YK(a){await XK(),a()}var JK=Object.defineProperty,ZK=Object.getOwnPropertyDescriptor,Fu=(a,e,t,n)=>{for(var i=n>1?void 0:n?ZK(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&JK(e,t,i),i};const xb=jt("debugvideo");class Xa extends Bt{constructor(){super();E(this,"renderer",null);E(this,"playOnAwake",!0);E(this,"playOnEnable");E(this,"targetMaterialProperty");E(this,"time",0);E(this,"_playbackSpeed",1);E(this,"_isLooping",!1);E(this,"_crossOrigin","anonymous");E(this,"audioOutputMode",1);E(this,"source");E(this,"clip",null);E(this,"url",null);E(this,"videoElement",null);E(this,"videoTexture",null);E(this,"videoMaterial",null);E(this,"_isPlaying",!1);E(this,"wasPlaying",!1);E(this,"_receivedInput",!1);YK(()=>{this._receivedInput=!0,this.updateVideoElementSettings()})}get playbackSpeed(){var t,n;return(n=(t=this.videoElement)==null?void 0:t.playbackRate)!=null?n:this._playbackSpeed}set playbackSpeed(t){this._playbackSpeed=t,this.videoElement&&(this.videoElement.playbackRate=t)}get isLooping(){var t,n;return(n=(t=this.videoElement)==null?void 0:t.loop)!=null?n:this._isLooping}set isLooping(t){this._isLooping=t,this.videoElement&&(this.videoElement.loop=t)}get currentTime(){var t,n;return(n=(t=this.videoElement)==null?void 0:t.currentTime)!=null?n:this.time}set currentTime(t){this.videoElement?this.videoElement.currentTime=t:this.time=t}get isPlaying(){const t=this.videoElement;return t?t.currentTime>0&&!t.paused&&!t.ended&&t.readyState>t.HAVE_CURRENT_DATA:!1}get crossOrigin(){var t,n;return(n=(t=this.videoElement)==null?void 0:t.crossOrigin)!=null?n:this._crossOrigin}set crossOrigin(t){this._crossOrigin=t,this.videoElement&&(t!==null?this.videoElement.setAttribute("crossorigin",t):this.videoElement.removeAttribute("crossorigin"))}setClipURL(t){this.url!==t&&(this.url=t,this.source=1,xb&&console.log("set url",t),this.videoElement&&(this.videoElement.src=t,this._isPlaying&&this.videoElement.play()))}awake(){this.create(this.playOnAwake),window.addEventListener("visibilitychange",t=>{switch(document.visibilityState){case"hidden":this.wasPlaying=this._isPlaying,this.pause();break;case"visible":this.wasPlaying&&this.play();break}})}onEnable(){this.playOnEnable===!0&&this.handleBeginPlaying(!0)}onDisable(){this.pause()}onDestroy(){var t;this.videoElement&&((t=this.videoElement.parentElement)==null||t.removeChild(this.videoElement),this.videoElement=null),this.videoTexture&&(this.videoTexture.dispose(),this.videoTexture=null)}play(){var t,n,i;!this.videoElement||this._isPlaying&&!((t=this.videoElement)!=null&&t.ended)&&!((n=this.videoElement)!=null&&n.paused)||(this._isPlaying=!0,this._receivedInput||(this.videoElement.muted=!0),this.updateVideoElementSettings(),(i=this.videoElement)==null||i.play().catch(r=>{console.warn(r)}),xb&&console.log("play",this.videoElement))}stop(){this._isPlaying=!1,this.videoElement&&(this.videoElement.currentTime=0,this.videoElement.pause())}pause(){var t;this._isPlaying=!1,(t=this.videoElement)==null||t.pause()}create(t){var i;let n;switch(this.source){case 0:n=this.clip;break;case 1:n=this.url;break}!n||(this.videoElement||(this.videoElement=this.createVideoElement(),(i=this.context.domElement)==null||i.prepend(this.videoElement),this.updateVideoElementStyles()),typeof n=="string"?this.videoElement.src=n:this.videoElement.srcObject=n,this.videoTexture||(this.videoTexture=new zL(this.videoElement)),this.videoTexture.flipY=!1,this.videoTexture.encoding=Gn,this.handleBeginPlaying(t))}createVideoElement(){const t=document.createElement("video");return this._crossOrigin&&t.setAttribute("crossorigin",this._crossOrigin),xb&&console.log("create video elment",t),t}handleBeginPlaying(t){if(!this.enabled||!this.videoElement)return;const n=this.gameObject.material;if(n)if(n!==this.videoMaterial&&(this.videoMaterial=n.clone(),this.gameObject.material=this.videoMaterial),!this.targetMaterialProperty)this.videoMaterial.map=this.videoTexture;else switch(this.targetMaterialProperty){default:this.videoMaterial.map=this.videoTexture;break}else{console.warn("Can not play video, no material found, this might be a multimaterial case which is not supported yet");return}this.updateVideoElementSettings(),this.updateVideoElementStyles(),t&&this.play()}updateVideoElementSettings(){!this.videoElement||(this.videoElement.loop=this._isLooping,this.videoElement.currentTime=this.currentTime,this.videoElement.playbackRate=this._playbackSpeed,this.videoElement.playsInline=!0,this.videoElement.muted=!this._receivedInput&&this.audioOutputMode!==0,(this.playOnAwake||this.playOnEnable)&&(this.videoElement.autoplay=!0))}updateVideoElementStyles(){!this.videoElement||(this.videoElement.style.userSelect="none",this.videoElement.style.visibility="hidden",this.videoElement.style.display="none")}}Fu([Re(qt)],Xa.prototype,"renderer",2);Fu([Re()],Xa.prototype,"playOnAwake",2);Fu([Re()],Xa.prototype,"playOnEnable",2);Fu([Re()],Xa.prototype,"targetMaterialProperty",2);Fu([Re()],Xa.prototype,"time",2);Fu([Re()],Xa.prototype,"playbackSpeed",1);Fu([Re()],Xa.prototype,"isLooping",1);class yO extends Bt{constructor(){super(...arguments);E(this,"streamOnAwake",!0);E(this,"requestOpen",!1);E(this,"captureStream",null)}start(){this.streamOnAwake&&this.open()}async open(t=!1){if(!(this.captureStream&&!t)){this.close(),this.requestOpen=!0;try{const n=Te.getComponentInChildren(this.gameObject,Xa);if(n){const i={video:!0,audio:!1};this.captureStream=await navigator.mediaDevices.getDisplayMedia(i),this.captureStream&&this.requestOpen&&(n.clip=this.captureStream,n.create(!0))}}catch(n){console.error("Error: "+n)}}}close(){if(this.requestOpen=!1,this.captureStream){for(const t of this.captureStream.getTracks())t.stop();this.captureStream=null}}}var KK=Object.defineProperty,$K=Object.getOwnPropertyDescriptor,vO=(a,e,t,n)=>{for(var i=n>1?void 0:n?$K(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&KK(e,t,i),i};class dv extends Bt{constructor(){super(...arguments);E(this,"mode",0);E(this,"shadowColor",new oo(0,0,0,1))}awake(){switch(this.mode){case 0:this.applyShadowMaterial();break;case 1:this.applyLightBlendMaterial();break}}applyLightBlendMaterial(){const t=Te.getComponent(this.gameObject,Vr);if(t){const n=t.material;n.blending=G_,this.applyMaterialOptions(n),n.onBeforeCompile=i=>{i.fragmentShader=i.fragmentShader.replace("vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;",`vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
                
                // diffuse-only lighting with overdrive to somewhat compensate
                // for the loss of indirect lighting and to make it more visible.
                vec3 direct = reflectedLight.directDiffuse * 3.;
                float max = max(direct.r, max(direct.g, direct.b));
                
                // early out - we're simply returning direct lighting and some alpha based on it so it can 
                // be blended onto the scene.
                gl_FragColor = vec4(direct, max);
                return;
                `)}}}applyShadowMaterial(){var n;const t=Te.getComponent(this.gameObject,Vr);if(t)if(((n=t.material)==null?void 0:n.type)!=="ShadowMaterial"){const i=new PC;i.color=this.shadowColor,i.opacity=this.shadowColor.alpha,this.applyMaterialOptions(i),t.material=i}else{const i=t.material;i.color=this.shadowColor,i.opacity=this.shadowColor.alpha,this.applyMaterialOptions(i)}}applyMaterialOptions(t){t&&(t.depthWrite=!1,t.stencilWrite=!1)}}vO([Re()],dv.prototype,"mode",2);vO([Re(oo)],dv.prototype,"shadowColor",2);class e$ extends kC{constructor(e){super(e),this.type=Os}parse(e){const l=function(M,I){switch(M){case 1:console.error("THREE.RGBELoader Read Error: "+(I||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(I||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(I||""));break;default:case 4:console.error("THREE.RGBELoader: Error: "+(I||""))}return-1},g=`
`,m=function(M,I,T){I=I||1024;let F=M.pos,D=-1,U=0,W="",J=String.fromCharCode.apply(null,new Uint16Array(M.subarray(F,F+128)));for(;0>(D=J.indexOf(g))&&U<I&&F<M.byteLength;)W+=J,U+=J.length,F+=128,J+=String.fromCharCode.apply(null,new Uint16Array(M.subarray(F,F+128)));return-1<D?(T!==!1&&(M.pos+=U+D+1),W+J.slice(0,D)):!1},A=function(M){const I=/^#\?(\S+)/,T=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,B=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,F=/^\s*FORMAT=(\S+)\s*$/,D=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,U={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let W,J;if(M.pos>=M.byteLength||!(W=m(M)))return l(1,"no header found");if(!(J=W.match(I)))return l(3,"bad initial token");for(U.valid|=1,U.programtype=J[1],U.string+=W+`
`;W=m(M),W!==!1;){if(U.string+=W+`
`,W.charAt(0)==="#"){U.comments+=W+`
`;continue}if((J=W.match(T))&&(U.gamma=parseFloat(J[1])),(J=W.match(B))&&(U.exposure=parseFloat(J[1])),(J=W.match(F))&&(U.valid|=2,U.format=J[1]),(J=W.match(D))&&(U.valid|=4,U.height=parseInt(J[1],10),U.width=parseInt(J[2],10)),U.valid&2&&U.valid&4)break}return U.valid&2?U.valid&4?U:l(3,"missing image size specifier"):l(3,"missing format specifier")},v=function(M,I,T){const B=I;if(B<8||B>32767||M[0]!==2||M[1]!==2||M[2]&128)return new Uint8Array(M);if(B!==(M[2]<<8|M[3]))return l(3,"wrong scanline width");const F=new Uint8Array(4*I*T);if(!F.length)return l(4,"unable to allocate buffer space");let D=0,U=0;const W=4*B,J=new Uint8Array(4),ee=new Uint8Array(W);let Q=T;for(;Q>0&&U<M.byteLength;){if(U+4>M.byteLength)return l(1);if(J[0]=M[U++],J[1]=M[U++],J[2]=M[U++],J[3]=M[U++],J[0]!=2||J[1]!=2||(J[2]<<8|J[3])!=B)return l(3,"bad rgbe scanline format");let Y=0,se;for(;Y<W&&U<M.byteLength;){se=M[U++];const ve=se>128;if(ve&&(se-=128),se===0||Y+se>W)return l(3,"bad scanline data");if(ve){const xe=M[U++];for(let Ae=0;Ae<se;Ae++)ee[Y++]=xe}else ee.set(M.subarray(U,U+se),Y),Y+=se,U+=se}const ae=B;for(let ve=0;ve<ae;ve++){let xe=0;F[D]=ee[ve+xe],xe+=B,F[D+1]=ee[ve+xe],xe+=B,F[D+2]=ee[ve+xe],xe+=B,F[D+3]=ee[ve+xe],D+=4}Q--}return F},w=function(M,I,T,B){const F=M[I+3],D=Math.pow(2,F-128)/255;T[B+0]=M[I+0]*D,T[B+1]=M[I+1]*D,T[B+2]=M[I+2]*D,T[B+3]=1},b=function(M,I,T,B){const F=M[I+3],D=Math.pow(2,F-128)/255;T[B+0]=fu.toHalfFloat(Math.min(M[I+0]*D,65504)),T[B+1]=fu.toHalfFloat(Math.min(M[I+1]*D,65504)),T[B+2]=fu.toHalfFloat(Math.min(M[I+2]*D,65504)),T[B+3]=fu.toHalfFloat(1)},S=new Uint8Array(e);S.pos=0;const R=A(S);if(R!==-1){const M=R.width,I=R.height,T=v(S.subarray(S.pos),M,I);if(T!==-1){let B,F,D;switch(this.type){case Ms:D=T.length/4;const U=new Float32Array(D*4);for(let J=0;J<D;J++)w(T,J*4,U,J*4);B=U,F=Ms;break;case Os:D=T.length/4;const W=new Uint16Array(D*4);for(let J=0;J<D;J++)b(T,J*4,W,J*4);B=W,F=Os;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type);break}return{width:M,height:I,data:B,header:R.string,gamma:R.gamma,exposure:R.exposure,type:F}}}return null}setDataType(e){return this.type=e,this}load(e,t,n,i){function r(o,l){switch(o.type){case Ms:case Os:o.encoding=pr,o.minFilter=yi,o.magFilter=yi,o.generateMipmaps=!1,o.flipY=!0;break}t&&t(o,l)}return super.load(e,r,n,i)}}/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.6.9
*/var WP={},DE=function(a){return URL.createObjectURL(new Blob([a],{type:"text/javascript"}))},xO=function(a){return new Worker(a)};try{URL.revokeObjectURL(DE(""))}catch{DE=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)},xO=function(e){return new Worker(e,{type:"module"})}}var t$=function(a,e,t,n,i){var r=xO(WP[e]||(WP[e]=DE(a)));return r.onerror=function(o){return i(o.error,null)},r.onmessage=function(o){return i(null,o.data)},r.postMessage(t,n),r},ui=Uint8Array,Qs=Uint16Array,Uc=Uint32Array,Wf=new ui([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Qf=new ui([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),og=new ui([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),wO=function(a,e){for(var t=new Qs(31),n=0;n<31;++n)t[n]=e+=1<<a[n-1];for(var i=new Uc(t[30]),n=1;n<30;++n)for(var r=t[n];r<t[n+1];++r)i[r]=r-t[n]<<5|n;return[t,i]},bO=wO(Wf,2),DS=bO[0],ly=bO[1];DS[28]=258,ly[258]=28;var EO=wO(Qf,0),CO=EO[0],OE=EO[1],ag=new Qs(32768);for(var qi=0;qi<32768;++qi){var Ml=(qi&43690)>>>1|(qi&21845)<<1;Ml=(Ml&52428)>>>2|(Ml&13107)<<2,Ml=(Ml&61680)>>>4|(Ml&3855)<<4,ag[qi]=((Ml&65280)>>>8|(Ml&255)<<8)>>>1}var Lo=function(a,e,t){for(var n=a.length,i=0,r=new Qs(e);i<n;++i)++r[a[i]-1];var o=new Qs(e);for(i=0;i<e;++i)o[i]=o[i-1]+r[i-1]<<1;var l;if(t){l=new Qs(1<<e);var h=15-e;for(i=0;i<n;++i)if(a[i])for(var u=i<<4|a[i],f=e-a[i],g=o[a[i]-1]++<<f,m=g|(1<<f)-1;g<=m;++g)l[ag[g]>>>h]=u}else for(l=new Qs(n),i=0;i<n;++i)a[i]&&(l[i]=ag[o[a[i]-1]++]>>>15-a[i]);return l},zc=new ui(288);for(var qi=0;qi<144;++qi)zc[qi]=8;for(var qi=144;qi<256;++qi)zc[qi]=9;for(var qi=256;qi<280;++qi)zc[qi]=7;for(var qi=280;qi<288;++qi)zc[qi]=8;var Ef=new ui(32);for(var qi=0;qi<32;++qi)Ef[qi]=5;var SO=Lo(zc,9,0),MO=Lo(zc,9,1),TO=Lo(Ef,5,0),IO=Lo(Ef,5,1),T_=function(a){for(var e=a[0],t=1;t<a.length;++t)a[t]>e&&(e=a[t]);return e},Mo=function(a,e,t){var n=e/8|0;return(a[n]|a[n+1]<<8)>>(e&7)&t},I_=function(a,e){var t=e/8|0;return(a[t]|a[t+1]<<8|a[t+2]<<16)>>(e&7)},Qg=function(a){return(a/8|0)+(a&7&&1)},Do=function(a,e,t){(e==null||e<0)&&(e=0),(t==null||t>a.length)&&(t=a.length);var n=new(a instanceof Qs?Qs:a instanceof Uc?Uc:ui)(t-e);return n.set(a.subarray(e,t)),n},jg=function(a,e,t){var n=a.length;if(!n||t&&!t.l&&n<5)return e||new ui(0);var i=!e||t,r=!t||t.i;t||(t={}),e||(e=new ui(n*3));var o=function(He){var mn=e.length;if(He>mn){var Xt=new ui(Math.max(mn*2,He));Xt.set(e),e=Xt}},l=t.f||0,h=t.p||0,u=t.b||0,f=t.l,g=t.d,m=t.m,A=t.n,v=n*8;do{if(!f){t.f=l=Mo(a,h,1);var w=Mo(a,h+1,3);if(h+=3,w)if(w==1)f=MO,g=IO,m=9,A=5;else if(w==2){var M=Mo(a,h,31)+257,I=Mo(a,h+10,15)+4,T=M+Mo(a,h+5,31)+1;h+=14;for(var B=new ui(T),F=new ui(19),D=0;D<I;++D)F[og[D]]=Mo(a,h+D*3,7);h+=I*3;for(var U=T_(F),W=(1<<U)-1,J=Lo(F,U,1),D=0;D<T;){var ee=J[Mo(a,h,W)];h+=ee&15;var b=ee>>>4;if(b<16)B[D++]=b;else{var Q=0,Y=0;for(b==16?(Y=3+Mo(a,h,3),h+=2,Q=B[D-1]):b==17?(Y=3+Mo(a,h,7),h+=3):b==18&&(Y=11+Mo(a,h,127),h+=7);Y--;)B[D++]=Q}}var se=B.subarray(0,M),ae=B.subarray(M);m=T_(se),A=T_(ae),f=Lo(se,m,1),g=Lo(ae,A,1)}else throw"invalid block type";else{var b=Qg(h)+4,S=a[b-4]|a[b-3]<<8,R=b+S;if(R>n){if(r)throw"unexpected EOF";break}i&&o(u+S),e.set(a.subarray(b,R),u),t.b=u+=S,t.p=h=R*8;continue}if(h>v){if(r)throw"unexpected EOF";break}}i&&o(u+131072);for(var ve=(1<<m)-1,xe=(1<<A)-1,Ae=h;;Ae=h){var Q=f[I_(a,h)&ve],Me=Q>>>4;if(h+=Q&15,h>v){if(r)throw"unexpected EOF";break}if(!Q)throw"invalid length/literal";if(Me<256)e[u++]=Me;else if(Me==256){Ae=h,f=null;break}else{var Be=Me-254;if(Me>264){var D=Me-257,Le=Wf[D];Be=Mo(a,h,(1<<Le)-1)+DS[D],h+=Le}var $e=g[I_(a,h)&xe],yt=$e>>>4;if(!$e)throw"invalid distance";h+=$e&15;var ae=CO[yt];if(yt>3){var Le=Qf[yt];ae+=I_(a,h)&(1<<Le)-1,h+=Le}if(h>v){if(r)throw"unexpected EOF";break}i&&o(u+131072);for(var Nt=u+Be;u<Nt;u+=4)e[u]=e[u-ae],e[u+1]=e[u+1-ae],e[u+2]=e[u+2-ae],e[u+3]=e[u+3-ae];u=Nt}}t.l=f,t.p=Ae,t.b=u,f&&(l=1,t.m=m,t.d=g,t.n=A)}while(!l);return u==e.length?e:Do(e,0,u)},Sa=function(a,e,t){t<<=e&7;var n=e/8|0;a[n]|=t,a[n+1]|=t>>>8},Zd=function(a,e,t){t<<=e&7;var n=e/8|0;a[n]|=t,a[n+1]|=t>>>8,a[n+2]|=t>>>16},R_=function(a,e){for(var t=[],n=0;n<a.length;++n)a[n]&&t.push({s:n,f:a[n]});var i=t.length,r=t.slice();if(!i)return[Bc,0];if(i==1){var o=new ui(t[0].s+1);return o[t[0].s]=1,[o,1]}t.sort(function(T,B){return T.f-B.f}),t.push({s:-1,f:25001});var l=t[0],h=t[1],u=0,f=1,g=2;for(t[0]={s:-1,f:l.f+h.f,l,r:h};f!=i-1;)l=t[t[u].f<t[g].f?u++:g++],h=t[u!=f&&t[u].f<t[g].f?u++:g++],t[f++]={s:-1,f:l.f+h.f,l,r:h};for(var m=r[0].s,n=1;n<i;++n)r[n].s>m&&(m=r[n].s);var A=new Qs(m+1),v=hy(t[f-1],A,0);if(v>e){var n=0,w=0,b=v-e,S=1<<b;for(r.sort(function(B,F){return A[F.s]-A[B.s]||B.f-F.f});n<i;++n){var R=r[n].s;if(A[R]>e)w+=S-(1<<v-A[R]),A[R]=e;else break}for(w>>>=b;w>0;){var M=r[n].s;A[M]<e?w-=1<<e-A[M]++-1:++n}for(;n>=0&&w;--n){var I=r[n].s;A[I]==e&&(--A[I],++w)}v=e}return[new ui(A),v]},hy=function(a,e,t){return a.s==-1?Math.max(hy(a.l,e,t+1),hy(a.r,e,t+1)):e[a.s]=t},FE=function(a){for(var e=a.length;e&&!a[--e];);for(var t=new Qs(++e),n=0,i=a[0],r=1,o=function(h){t[n++]=h},l=1;l<=e;++l)if(a[l]==i&&l!=e)++r;else{if(!i&&r>2){for(;r>138;r-=138)o(32754);r>2&&(o(r>10?r-11<<5|28690:r-3<<5|12305),r=0)}else if(r>3){for(o(i),--r;r>6;r-=6)o(8304);r>2&&(o(r-3<<5|8208),r=0)}for(;r--;)o(i);r=1,i=a[l]}return[t.subarray(0,n),e]},Kd=function(a,e){for(var t=0,n=0;n<e.length;++n)t+=a[n]*e[n];return t},Bm=function(a,e,t){var n=t.length,i=Qg(e+2);a[i]=n&255,a[i+1]=n>>>8,a[i+2]=a[i]^255,a[i+3]=a[i+1]^255;for(var r=0;r<n;++r)a[i+r+4]=t[r];return(i+4+n)*8},kE=function(a,e,t,n,i,r,o,l,h,u,f){Sa(e,f++,t),++i[256];for(var g=R_(i,15),m=g[0],A=g[1],v=R_(r,15),w=v[0],b=v[1],S=FE(m),R=S[0],M=S[1],I=FE(w),T=I[0],B=I[1],F=new Qs(19),D=0;D<R.length;++D)F[R[D]&31]++;for(var D=0;D<T.length;++D)F[T[D]&31]++;for(var U=R_(F,7),W=U[0],J=U[1],ee=19;ee>4&&!W[og[ee-1]];--ee);var Q=u+5<<3,Y=Kd(i,zc)+Kd(r,Ef)+o,se=Kd(i,m)+Kd(r,w)+o+14+3*ee+Kd(F,W)+(2*F[16]+3*F[17]+7*F[18]);if(Q<=Y&&Q<=se)return Bm(e,f,a.subarray(h,h+u));var ae,ve,xe,Ae;if(Sa(e,f,1+(se<Y)),f+=2,se<Y){ae=Lo(m,A,0),ve=m,xe=Lo(w,b,0),Ae=w;var Me=Lo(W,J,0);Sa(e,f,M-257),Sa(e,f+5,B-1),Sa(e,f+10,ee-4),f+=14;for(var D=0;D<ee;++D)Sa(e,f+3*D,W[og[D]]);f+=3*ee;for(var Be=[R,T],Le=0;Le<2;++Le)for(var $e=Be[Le],D=0;D<$e.length;++D){var yt=$e[D]&31;Sa(e,f,Me[yt]),f+=W[yt],yt>15&&(Sa(e,f,$e[D]>>>5&127),f+=$e[D]>>>12)}}else ae=SO,ve=zc,xe=TO,Ae=Ef;for(var D=0;D<l;++D)if(n[D]>255){var yt=n[D]>>>18&31;Zd(e,f,ae[yt+257]),f+=ve[yt+257],yt>7&&(Sa(e,f,n[D]>>>23&31),f+=Wf[yt]);var Nt=n[D]&31;Zd(e,f,xe[Nt]),f+=Ae[Nt],Nt>3&&(Zd(e,f,n[D]>>>5&8191),f+=Qf[Nt])}else Zd(e,f,ae[n[D]]),f+=ve[n[D]];return Zd(e,f,ae[256]),f+ve[256]},RO=new Uc([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Bc=new ui(0),PO=function(a,e,t,n,i,r){var o=a.length,l=new ui(n+o+5*(1+Math.ceil(o/7e3))+i),h=l.subarray(n,l.length-i),u=0;if(!e||o<8)for(var f=0;f<=o;f+=65535){var g=f+65535;g<o?u=Bm(h,u,a.subarray(f,g)):(h[f]=r,u=Bm(h,u,a.subarray(f,o)))}else{for(var m=RO[e-1],A=m>>>13,v=m&8191,w=(1<<t)-1,b=new Qs(32768),S=new Qs(w+1),R=Math.ceil(t/3),M=2*R,I=function(vt){return(a[vt]^a[vt+1]<<R^a[vt+2]<<M)&w},T=new Uc(25e3),B=new Qs(288),F=new Qs(32),D=0,U=0,f=0,W=0,J=0,ee=0;f<o;++f){var Q=I(f),Y=f&32767,se=S[Q];if(b[Y]=se,S[Q]=Y,J<=f){var ae=o-f;if((D>7e3||W>24576)&&ae>423){u=kE(a,h,0,T,B,F,U,W,ee,f-ee,u),W=D=U=0,ee=f;for(var ve=0;ve<286;++ve)B[ve]=0;for(var ve=0;ve<30;++ve)F[ve]=0}var xe=2,Ae=0,Me=v,Be=Y-se&32767;if(ae>2&&Q==I(f-Be))for(var Le=Math.min(A,ae)-1,$e=Math.min(32767,f),yt=Math.min(258,ae);Be<=$e&&--Me&&Y!=se;){if(a[f+xe]==a[f+xe-Be]){for(var Nt=0;Nt<yt&&a[f+Nt]==a[f+Nt-Be];++Nt);if(Nt>xe){if(xe=Nt,Ae=Be,Nt>Le)break;for(var He=Math.min(Be,Nt-2),mn=0,ve=0;ve<He;++ve){var Xt=f-Be+ve+32768&32767,pn=b[Xt],Ft=Xt-pn+32768&32767;Ft>mn&&(mn=Ft,se=Xt)}}}Y=se,se=b[Y],Be+=Y-se+32768&32767}if(Ae){T[W++]=268435456|ly[xe]<<18|OE[Ae];var yn=ly[xe]&31,it=OE[Ae]&31;U+=Wf[yn]+Qf[it],++B[257+yn],++F[it],J=f+xe,++D}else T[W++]=a[f],++B[a[f]]}}u=kE(a,h,r,T,B,F,U,W,ee,f-ee,u),!r&&u&7&&(u=Bm(h,u+1,Bc))}return Do(l,0,n+Qg(u)+i)},BO=function(){for(var a=new Uc(256),e=0;e<256;++e){for(var t=e,n=9;--n;)t=(t&1&&3988292384)^t>>>1;a[e]=t}return a}(),jf=function(){var a=-1;return{p:function(e){for(var t=a,n=0;n<e.length;++n)t=BO[t&255^e[n]]^t>>>8;a=t},d:function(){return~a}}},OS=function(){var a=1,e=0;return{p:function(t){for(var n=a,i=e,r=t.length,o=0;o!=r;){for(var l=Math.min(o+2655,r);o<l;++o)i+=n+=t[o];n=(n&65535)+15*(n>>16),i=(i&65535)+15*(i>>16)}a=n,e=i},d:function(){return a%=65521,e%=65521,(a&255)<<24|a>>>8<<16|(e&255)<<8|e>>>8}}},ku=function(a,e,t,n,i){return PO(a,e.level==null?6:e.level,e.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(a.length)))*1.5):12+e.mem,t,n,!i)},qg=function(a,e){var t={};for(var n in a)t[n]=a[n];for(var n in e)t[n]=e[n];return t},QP=function(a,e,t){for(var n=a(),i=a.toString(),r=i.slice(i.indexOf("[")+1,i.lastIndexOf("]")).replace(/ /g,"").split(","),o=0;o<n.length;++o){var l=n[o],h=r[o];if(typeof l=="function"){e+=";"+h+"=";var u=l.toString();if(l.prototype)if(u.indexOf("[native code]")!=-1){var f=u.indexOf(" ",8)+1;e+=u.slice(f,u.indexOf("(",f))}else{e+=u;for(var g in l.prototype)e+=";"+h+".prototype."+g+"="+l.prototype[g].toString()}else e+=u}else t[h]=l}return[e,t]},d_=[],n$=function(a){var e=[];for(var t in a)(a[t]instanceof ui||a[t]instanceof Qs||a[t]instanceof Uc)&&e.push((a[t]=new a[t].constructor(a[t])).buffer);return e},LO=function(a,e,t,n){var i;if(!d_[t]){for(var r="",o={},l=a.length-1,h=0;h<l;++h)i=QP(a[h],r,o),r=i[0],o=i[1];d_[t]=QP(a[l],r,o)}var u=qg({},d_[t][1]);return t$(d_[t][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",t,u,n$(u),n)},qf=function(){return[ui,Qs,Uc,Wf,Qf,og,DS,CO,MO,IO,ag,Lo,T_,Mo,I_,Qg,Do,jg,Zf,hh,FS]},Xf=function(){return[ui,Qs,Uc,Wf,Qf,og,ly,OE,SO,zc,TO,Ef,ag,RO,Bc,Lo,Sa,Zd,R_,hy,FE,Kd,Bm,kE,Qg,Do,PO,ku,Xg,hh]},DO=function(){return[kS,US,Mi,jf,BO]},OO=function(){return[NS,NO]},FO=function(){return[zS,Mi,OS]},kO=function(){return[UO]},hh=function(a){return postMessage(a,[a.buffer])},FS=function(a){return a&&a.size&&new ui(a.size)},Yf=function(a,e,t,n,i,r){var o=LO(t,n,i,function(l,h){o.terminate(),r(l,h)});return o.postMessage([a,e],e.consume?[a.buffer]:[]),function(){o.terminate()}},ko=function(a){return a.ondata=function(e,t){return postMessage([e,t],[e.buffer])},function(e){return a.push(e.data[0],e.data[1])}},Jf=function(a,e,t,n,i){var r,o=LO(a,n,i,function(l,h){l?(o.terminate(),e.ondata.call(e,l)):(h[1]&&o.terminate(),e.ondata.call(e,l,h[0],h[1]))});o.postMessage(t),e.push=function(l,h){if(r)throw"stream finished";if(!e.ondata)throw"no stream handler";o.postMessage([l,r=h],[l.buffer])},e.terminate=function(){o.terminate()}},Sr=function(a,e){return a[e]|a[e+1]<<8},_s=function(a,e){return(a[e]|a[e+1]<<8|a[e+2]<<16|a[e+3]<<24)>>>0},wb=function(a,e){return _s(a,e)+_s(a,e+4)*4294967296},Mi=function(a,e,t){for(;t;++e)a[e]=t,t>>>=8},kS=function(a,e){var t=e.filename;if(a[0]=31,a[1]=139,a[2]=8,a[8]=e.level<2?4:e.level==9?2:0,a[9]=3,e.mtime!=0&&Mi(a,4,Math.floor(new Date(e.mtime||Date.now())/1e3)),t){a[3]=8;for(var n=0;n<=t.length;++n)a[n+10]=t.charCodeAt(n)}},NS=function(a){if(a[0]!=31||a[1]!=139||a[2]!=8)throw"invalid gzip data";var e=a[3],t=10;e&4&&(t+=a[10]|(a[11]<<8)+2);for(var n=(e>>3&1)+(e>>4&1);n>0;n-=!a[t++]);return t+(e&2)},NO=function(a){var e=a.length;return(a[e-4]|a[e-3]<<8|a[e-2]<<16|a[e-1]<<24)>>>0},US=function(a){return 10+(a.filename&&a.filename.length+1||0)},zS=function(a,e){var t=e.level,n=t==0?0:t<6?1:t==9?3:2;a[0]=120,a[1]=n<<6|(n?32-2*n:1)},UO=function(a){if((a[0]&15)!=8||a[0]>>>4>7||(a[0]<<8|a[1])%31)throw"invalid zlib data";if(a[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function GS(a,e){return!e&&typeof a=="function"&&(e=a,a={}),this.ondata=e,a}var Wa=function(){function a(e,t){!t&&typeof e=="function"&&(t=e,e={}),this.ondata=t,this.o=e||{}}return a.prototype.p=function(e,t){this.ondata(ku(e,this.o,0,0,!t),t)},a.prototype.push=function(e,t){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=t,this.p(e,t||!1)},a}(),zO=function(){function a(e,t){Jf([Xf,function(){return[ko,Wa]}],this,GS.call(this,e,t),function(n){var i=new Wa(n.data);onmessage=ko(i)},6)}return a}();function GO(a,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Yf(a,e,[Xf],function(n){return hh(Xg(n.data[0],n.data[1]))},0,t)}function Xg(a,e){return ku(a,e||{},0,0)}var Gr=function(){function a(e){this.s={},this.p=new ui(0),this.ondata=e}return a.prototype.e=function(e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var t=this.p.length,n=new ui(t+e.length);n.set(this.p),n.set(e,t),this.p=n},a.prototype.c=function(e){this.d=this.s.i=e||!1;var t=this.s.b,n=jg(this.p,this.o,this.s);this.ondata(Do(n,t,this.s.b),this.d),this.o=Do(n,this.s.b-32768),this.s.b=this.o.length,this.p=Do(this.p,this.s.p/8|0),this.s.p&=7},a.prototype.push=function(e,t){this.e(e),this.c(t)},a}(),HS=function(){function a(e){this.ondata=e,Jf([qf,function(){return[ko,Gr]}],this,0,function(){var t=new Gr;onmessage=ko(t)},7)}return a}();function VS(a,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Yf(a,e,[qf],function(n){return hh(Zf(n.data[0],FS(n.data[1])))},1,t)}function Zf(a,e){return jg(a,e)}var uy=function(){function a(e,t){this.c=jf(),this.l=0,this.v=1,Wa.call(this,e,t)}return a.prototype.push=function(e,t){Wa.prototype.push.call(this,e,t)},a.prototype.p=function(e,t){this.c.p(e),this.l+=e.length;var n=ku(e,this.o,this.v&&US(this.o),t&&8,!t);this.v&&(kS(n,this.o),this.v=0),t&&(Mi(n,n.length-8,this.c.d()),Mi(n,n.length-4,this.l)),this.ondata(n,t)},a}(),jP=function(){function a(e,t){Jf([Xf,DO,function(){return[ko,Wa,uy]}],this,GS.call(this,e,t),function(n){var i=new uy(n.data);onmessage=ko(i)},8)}return a}();function qP(a,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Yf(a,e,[Xf,DO,function(){return[dy]}],function(n){return hh(dy(n.data[0],n.data[1]))},2,t)}function dy(a,e){e||(e={});var t=jf(),n=a.length;t.p(a);var i=ku(a,e,US(e),8),r=i.length;return kS(i,e),Mi(i,r-8,t.d()),Mi(i,r-4,n),i}var fy=function(){function a(e){this.v=1,Gr.call(this,e)}return a.prototype.push=function(e,t){if(Gr.prototype.e.call(this,e),this.v){var n=this.p.length>3?NS(this.p):4;if(n>=this.p.length&&!t)return;this.p=this.p.subarray(n),this.v=0}if(t){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}Gr.prototype.c.call(this,t)},a}(),HO=function(){function a(e){this.ondata=e,Jf([qf,OO,function(){return[ko,Gr,fy]}],this,0,function(){var t=new fy;onmessage=ko(t)},9)}return a}();function VO(a,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Yf(a,e,[qf,OO,function(){return[py]}],function(n){return hh(py(n.data[0]))},3,t)}function py(a,e){return jg(a.subarray(NS(a),-8),e||new ui(NO(a)))}var NE=function(){function a(e,t){this.c=OS(),this.v=1,Wa.call(this,e,t)}return a.prototype.push=function(e,t){Wa.prototype.push.call(this,e,t)},a.prototype.p=function(e,t){this.c.p(e);var n=ku(e,this.o,this.v&&2,t&&4,!t);this.v&&(zS(n,this.o),this.v=0),t&&Mi(n,n.length-4,this.c.d()),this.ondata(n,t)},a}(),i$=function(){function a(e,t){Jf([Xf,FO,function(){return[ko,Wa,NE]}],this,GS.call(this,e,t),function(n){var i=new NE(n.data);onmessage=ko(i)},10)}return a}();function s$(a,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Yf(a,e,[Xf,FO,function(){return[UE]}],function(n){return hh(UE(n.data[0],n.data[1]))},4,t)}function UE(a,e){e||(e={});var t=OS();t.p(a);var n=ku(a,e,2,4);return zS(n,e),Mi(n,n.length-4,t.d()),n}var my=function(){function a(e){this.v=1,Gr.call(this,e)}return a.prototype.push=function(e,t){if(Gr.prototype.e.call(this,e),this.v){if(this.p.length<2&&!t)return;this.p=this.p.subarray(2),this.v=0}if(t){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}Gr.prototype.c.call(this,t)},a}(),WO=function(){function a(e){this.ondata=e,Jf([qf,kO,function(){return[ko,Gr,my]}],this,0,function(){var t=new my;onmessage=ko(t)},11)}return a}();function QO(a,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Yf(a,e,[qf,kO,function(){return[Ul]}],function(n){return hh(Ul(n.data[0],FS(n.data[1])))},5,t)}function Ul(a,e){return jg((UO(a),a.subarray(2,-4)),e)}var jO=function(){function a(e){this.G=fy,this.I=Gr,this.Z=my,this.ondata=e}return a.prototype.push=function(e,t){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(e,t);else{if(this.p&&this.p.length){var n=new ui(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var i=this,r=function(){i.ondata.apply(i,arguments)};this.s=this.p[0]==31&&this.p[1]==139&&this.p[2]==8?new this.G(r):(this.p[0]&15)!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(r):new this.Z(r),this.s.push(this.p,t),this.p=null}}},a}(),r$=function(){function a(e){this.G=HO,this.I=HS,this.Z=WO,this.ondata=e}return a.prototype.push=function(e,t){jO.prototype.push.call(this,e,t)},a}();function o$(a,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return a[0]==31&&a[1]==139&&a[2]==8?VO(a,e,t):(a[0]&15)!=8||a[0]>>4>7||(a[0]<<8|a[1])%31?VS(a,e,t):QO(a,e,t)}function a$(a,e){return a[0]==31&&a[1]==139&&a[2]==8?py(a,e):(a[0]&15)!=8||a[0]>>4>7||(a[0]<<8|a[1])%31?Zf(a,e):Ul(a,e)}var WS=function(a,e,t,n){for(var i in a){var r=a[i],o=e+i;r instanceof ui?t[o]=[r,n]:Array.isArray(r)?t[o]=[r[0],qg(n,r[1])]:WS(r,o+"/",t,n)}},XP=typeof TextEncoder<"u"&&new TextEncoder,zE=typeof TextDecoder<"u"&&new TextDecoder,qO=0;try{zE.decode(Bc,{stream:!0}),qO=1}catch{}var XO=function(a){for(var e="",t=0;;){var n=a[t++],i=(n>127)+(n>223)+(n>239);if(t+i>a.length)return[e,Do(a,t-1)];i?i==3?(n=((n&15)<<18|(a[t++]&63)<<12|(a[t++]&63)<<6|a[t++]&63)-65536,e+=String.fromCharCode(55296|n>>10,56320|n&1023)):i&1?e+=String.fromCharCode((n&31)<<6|a[t++]&63):e+=String.fromCharCode((n&15)<<12|(a[t++]&63)<<6|a[t++]&63):e+=String.fromCharCode(n)}},c$=function(){function a(e){this.ondata=e,qO?this.t=new TextDecoder:this.p=Bc}return a.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(t=!!t,this.t){if(this.ondata(this.t.decode(e,{stream:!0}),t),t){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}return}if(!this.p)throw"stream finished";var n=new ui(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length);var i=XO(n),r=i[0],o=i[1];if(t){if(o.length)throw"invalid utf-8 data";this.p=null}else this.p=o;this.ondata(r,t)},a}(),l$=function(){function a(e){this.ondata=e}return a.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(th(e),this.d=t||!1)},a}();function th(a,e){if(e){for(var t=new ui(a.length),n=0;n<a.length;++n)t[n]=a.charCodeAt(n);return t}if(XP)return XP.encode(a);for(var i=a.length,r=new ui(a.length+(a.length>>1)),o=0,l=function(f){r[o++]=f},n=0;n<i;++n){if(o+5>r.length){var h=new ui(o+8+(i-n<<1));h.set(r),r=h}var u=a.charCodeAt(n);u<128||e?l(u):u<2048?(l(192|u>>6),l(128|u&63)):u>55295&&u<57344?(u=65536+(u&1023<<10)|a.charCodeAt(++n)&1023,l(240|u>>18),l(128|u>>12&63),l(128|u>>6&63),l(128|u&63)):(l(224|u>>12),l(128|u>>6&63),l(128|u&63))}return Do(r,0,o)}function QS(a,e){if(e){for(var t="",n=0;n<a.length;n+=16384)t+=String.fromCharCode.apply(null,a.subarray(n,n+16384));return t}else{if(zE)return zE.decode(a);var i=XO(a),r=i[0],o=i[1];if(o.length)throw"invalid utf-8 data";return r}}var YO=function(a){return a==1?3:a<6?2:a==9?1:0},JO=function(a,e){return e+30+Sr(a,e+26)+Sr(a,e+28)},ZO=function(a,e,t){var n=Sr(a,e+28),i=QS(a.subarray(e+46,e+46+n),!(Sr(a,e+8)&2048)),r=e+46+n,o=_s(a,e+20),l=t&&o==4294967295?KO(a,r):[o,_s(a,e+24),_s(a,e+42)],h=l[0],u=l[1],f=l[2];return[Sr(a,e+10),h,u,i,r+Sr(a,e+30)+Sr(a,e+32),f]},KO=function(a,e){for(;Sr(a,e)!=1;e+=4+Sr(a,e+2));return[wb(a,e+12),wb(a,e+4),wb(a,e+20)]},Wl=function(a){var e=0;if(a)for(var t in a){var n=a[t].length;if(n>65535)throw"extra field too long";e+=n+4}return e},Cf=function(a,e,t,n,i,r,o,l){var h=n.length,u=t.extra,f=l&&l.length,g=Wl(u);Mi(a,e,o!=null?33639248:67324752),e+=4,o!=null&&(a[e++]=20,a[e++]=t.os),a[e]=20,e+=2,a[e++]=t.flag<<1|(r==null&&8),a[e++]=i&&8,a[e++]=t.compression&255,a[e++]=t.compression>>8;var m=new Date(t.mtime==null?Date.now():t.mtime),A=m.getFullYear()-1980;if(A<0||A>119)throw"date not in range 1980-2099";if(Mi(a,e,A<<25|m.getMonth()+1<<21|m.getDate()<<16|m.getHours()<<11|m.getMinutes()<<5|m.getSeconds()>>>1),e+=4,r!=null&&(Mi(a,e,t.crc),Mi(a,e+4,r),Mi(a,e+8,t.size)),Mi(a,e+12,h),Mi(a,e+14,g),e+=16,o!=null&&(Mi(a,e,f),Mi(a,e+6,t.attrs),Mi(a,e+10,o),e+=14),a.set(n,e),e+=h,g)for(var v in u){var w=u[v],b=w.length;Mi(a,e,+v),Mi(a,e+2,b),a.set(w,e+4),e+=4+b}return f&&(a.set(l,e),e+=f),e},jS=function(a,e,t,n,i){Mi(a,e,101010256),Mi(a,e+8,t),Mi(a,e+10,t),Mi(a,e+12,n),Mi(a,e+16,i)},cg=function(){function a(e){this.filename=e,this.c=jf(),this.size=0,this.compression=0}return a.prototype.process=function(e,t){this.ondata(null,e,t)},a.prototype.push=function(e,t){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(e),this.size+=e.length,t&&(this.crc=this.c.d()),this.process(e,t||!1)},a}(),h$=function(){function a(e,t){var n=this;t||(t={}),cg.call(this,e),this.d=new Wa(t,function(i,r){n.ondata(null,i,r)}),this.compression=8,this.flag=YO(t.level)}return a.prototype.process=function(e,t){try{this.d.push(e,t)}catch(n){this.ondata(n,null,t)}},a.prototype.push=function(e,t){cg.prototype.push.call(this,e,t)},a}(),u$=function(){function a(e,t){var n=this;t||(t={}),cg.call(this,e),this.d=new zO(t,function(i,r,o){n.ondata(i,r,o)}),this.compression=8,this.flag=YO(t.level),this.terminate=this.d.terminate}return a.prototype.process=function(e,t){this.d.push(e,t)},a.prototype.push=function(e,t){cg.prototype.push.call(this,e,t)},a}(),d$=function(){function a(e){this.ondata=e,this.u=[],this.d=1}return a.prototype.add=function(e){var t=this;if(this.d&2)throw"stream finished";var n=th(e.filename),i=n.length,r=e.comment,o=r&&th(r),l=i!=e.filename.length||o&&r.length!=o.length,h=i+Wl(e.extra)+30;if(i>65535)throw"filename too long";var u=new ui(h);Cf(u,0,e,n,l);var f=[u],g=function(){for(var b=0,S=f;b<S.length;b++){var R=S[b];t.ondata(null,R,!1)}f=[]},m=this.d;this.d=0;var A=this.u.length,v=qg(e,{f:n,u:l,o,t:function(){e.terminate&&e.terminate()},r:function(){if(g(),m){var b=t.u[A+1];b?b.r():t.d=1}m=1}}),w=0;e.ondata=function(b,S,R){if(b)t.ondata(b,S,R),t.terminate();else if(w+=S.length,f.push(S),R){var M=new ui(16);Mi(M,0,134695760),Mi(M,4,e.crc),Mi(M,8,w),Mi(M,12,e.size),f.push(M),v.c=w,v.b=h+w+16,v.crc=e.crc,v.size=e.size,m&&v.r(),m=1}else m&&g()},this.u.push(v)},a.prototype.end=function(){var e=this;if(this.d&2)throw this.d&1?"stream finishing":"stream finished";this.d?this.e():this.u.push({r:function(){!(e.d&1)||(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},a.prototype.e=function(){for(var e=0,t=0,n=0,i=0,r=this.u;i<r.length;i++){var o=r[i];n+=46+o.f.length+Wl(o.extra)+(o.o?o.o.length:0)}for(var l=new ui(n+22),h=0,u=this.u;h<u.length;h++){var o=u[h];Cf(l,e,o,o.f,o.u,o.c,t,o.o),e+=46+o.f.length+Wl(o.extra)+(o.o?o.o.length:0),t+=o.b}jS(l,e,this.u.length,n,t),this.ondata(null,l,!0),this.d=2},a.prototype.terminate=function(){for(var e=0,t=this.u;e<t.length;e++){var n=t[e];n.t()}this.d=2},a}();function f$(a,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";var n={};WS(a,"",n,e);var i=Object.keys(n),r=i.length,o=0,l=0,h=r,u=new Array(r),f=[],g=function(){for(var w=0;w<f.length;++w)f[w]()},m=function(){var w=new ui(l+22),b=o,S=l-o;l=0;for(var R=0;R<h;++R){var M=u[R];try{var I=M.c.length;Cf(w,l,M,M.f,M.u,I);var T=30+M.f.length+Wl(M.extra),B=l+T;w.set(M.c,B),Cf(w,o,M,M.f,M.u,I,l,M.m),o+=16+T+(M.m?M.m.length:0),l=B+I}catch(F){return t(F,null)}}jS(w,o,u.length,S,b),t(null,w)};r||m();for(var A=function(w){var b=i[w],S=n[b],R=S[0],M=S[1],I=jf(),T=R.length;I.p(R);var B=th(b),F=B.length,D=M.comment,U=D&&th(D),W=U&&U.length,J=Wl(M.extra),ee=M.level==0?0:8,Q=function(Y,se){if(Y)g(),t(Y,null);else{var ae=se.length;u[w]=qg(M,{size:T,crc:I.d(),c:se,f:B,m:U,u:F!=b.length||U&&D.length!=W,compression:ee}),o+=30+F+J+ae,l+=76+2*(F+J)+(W||0)+ae,--r||m()}};if(F>65535&&Q("filename too long",null),!ee)Q(null,R);else if(T<16e4)try{Q(null,Xg(R,M))}catch(Y){Q(Y,null)}else f.push(GO(R,M,Q))},v=0;v<h;++v)A(v);return g}function p$(a,e){e||(e={});var t={},n=[];WS(a,"",t,e);var i=0,r=0;for(var o in t){var l=t[o],h=l[0],u=l[1],f=u.level==0?0:8,g=th(o),m=g.length,A=u.comment,v=A&&th(A),w=v&&v.length,b=Wl(u.extra);if(m>65535)throw"filename too long";var S=f?Xg(h,u):h,R=S.length,M=jf();M.p(h),n.push(qg(u,{size:h.length,crc:M.d(),c:S,f:g,m:v,u:m!=o.length||v&&A.length!=w,o:i,compression:f})),i+=30+m+b+R,r+=76+2*(m+b)+(w||0)+R}for(var I=new ui(r+22),T=i,B=r-i,F=0;F<n.length;++F){var g=n[F];Cf(I,g.o,g,g.f,g.u,g.c.length);var D=30+g.f.length+Wl(g.extra);I.set(g.c,g.o+D),Cf(I,i,g,g.f,g.u,g.c.length,g.o,g.m),i+=16+D+(g.m?g.m.length:0)}return jS(I,i,n.length,B,T),I}var $O=function(){function a(){}return a.prototype.push=function(e,t){this.ondata(null,e,t)},a.compression=0,a}(),m$=function(){function a(){var e=this;this.i=new Gr(function(t,n){e.ondata(null,t,n)})}return a.prototype.push=function(e,t){try{this.i.push(e,t)}catch(n){this.ondata(n,e,t)}},a.compression=8,a}(),g$=function(){function a(e,t){var n=this;t<32e4?this.i=new Gr(function(i,r){n.ondata(null,i,r)}):(this.i=new HS(function(i,r,o){n.ondata(i,r,o)}),this.terminate=this.i.terminate)}return a.prototype.push=function(e,t){this.i.terminate&&(e=Do(e,0)),this.i.push(e,t)},a.compression=8,a}(),A$=function(){function a(e){this.onfile=e,this.k=[],this.o={0:$O},this.p=Bc}return a.prototype.push=function(e,t){var n=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var i=Math.min(this.c,e.length),r=e.subarray(0,i);if(this.c-=i,this.d?this.d.push(r,!this.c):this.k[0].push(r),e=e.subarray(i),e.length)return this.push(e,t)}else{var o=0,l=0,h=void 0,u=void 0;this.p.length?e.length?(u=new ui(this.p.length+e.length),u.set(this.p),u.set(e,this.p.length)):u=this.p:u=e;for(var f=u.length,g=this.c,m=g&&this.d,A=function(){var S,R=_s(u,l);if(R==67324752){o=1,h=l,v.d=null,v.c=0;var M=Sr(u,l+6),I=Sr(u,l+8),T=M&2048,B=M&8,F=Sr(u,l+26),D=Sr(u,l+28);if(f>l+30+F+D){var U=[];v.k.unshift(U),o=2;var W=_s(u,l+18),J=_s(u,l+22),ee=QS(u.subarray(l+30,l+=30+F),!T);W==4294967295?(S=B?[-2]:KO(u,l),W=S[0],J=S[1]):B&&(W=-1),l+=D,v.c=W;var Q,Y={name:ee,compression:I,start:function(){if(!Y.ondata)throw"no callback";if(!W)Y.ondata(null,Bc,!0);else{var se=n.o[I];if(!se)throw"unknown compression type "+I;Q=W<0?new se(ee):new se(ee,W,J),Q.ondata=function(Ae,Me,Be){Y.ondata(Ae,Me,Be)};for(var ae=0,ve=U;ae<ve.length;ae++){var xe=ve[ae];Q.push(xe,!1)}n.k[0]==U&&n.c?n.d=Q:Q.push(Bc,!0)}},terminate:function(){Q&&Q.terminate&&Q.terminate()}};W>=0&&(Y.size=W,Y.originalSize=J),v.onfile(Y)}return"break"}else if(g){if(R==134695760)return h=l+=12+(g==-2&&8),o=3,v.c=0,"break";if(R==33639248)return h=l-=4,o=3,v.c=0,"break"}},v=this;l<f-4;++l){var w=A();if(w==="break")break}if(this.p=Bc,g<0){var b=o?u.subarray(0,h-12-(g==-2&&8)-(_s(u,h-16)==134695760&&4)):u.subarray(0,l);m?m.push(b,!!o):this.k[+(o==2)].push(b)}if(o&2)return this.push(u.subarray(l),t);this.p=u.subarray(l)}if(t){if(this.c)throw"invalid zip file";this.p=null}},a.prototype.register=function(e){this.o[e.compression]=e},a}();function _$(a,e){if(typeof e!="function")throw"no callback";for(var t=[],n=function(){for(var m=0;m<t.length;++m)t[m]()},i={},r=a.length-22;_s(a,r)!=101010256;--r)if(!r||a.length-r>65558){e("invalid zip file",null);return}var o=Sr(a,r+8);o||e(null,{});var l=o,h=_s(a,r+16),u=h==4294967295;if(u){if(r=_s(a,r-12),_s(a,r)!=101075792){e("invalid zip file",null);return}l=o=_s(a,r+32),h=_s(a,r+48)}for(var f=function(m){var A=ZO(a,h,u),v=A[0],w=A[1],b=A[2],S=A[3],R=A[4],M=A[5],I=JO(a,M);h=R;var T=function(F,D){F?(n(),e(F,null)):(i[S]=D,--o||e(null,i))};if(!v)T(null,Do(a,I,I+w));else if(v==8){var B=a.subarray(I,I+w);if(w<32e4)try{T(null,Zf(B,new ui(b)))}catch(F){T(F,null)}else t.push(VS(B,{size:b},T))}else T("unknown compression type "+v,null)},g=0;g<l;++g)f();return n}function y$(a){for(var e={},t=a.length-22;_s(a,t)!=101010256;--t)if(!t||a.length-t>65558)throw"invalid zip file";var n=Sr(a,t+8);if(!n)return{};var i=_s(a,t+16),r=i==4294967295;if(r){if(t=_s(a,t-12),_s(a,t)!=101075792)throw"invalid zip file";n=_s(a,t+32),i=_s(a,t+48)}for(var o=0;o<n;++o){var l=ZO(a,i,r),h=l[0],u=l[1],f=l[2],g=l[3],m=l[4],A=l[5],v=JO(a,A);if(i=m,!h)e[g]=Do(a,v,v+u);else if(h==8)e[g]=Zf(a.subarray(v,v+u),new ui(f));else throw"unknown compression type "+h}return e}const YP=Object.freeze(Object.defineProperty({__proto__:null,Deflate:Wa,AsyncDeflate:zO,deflate:GO,deflateSync:Xg,Inflate:Gr,AsyncInflate:HS,inflate:VS,inflateSync:Zf,Gzip:uy,AsyncGzip:jP,gzip:qP,gzipSync:dy,Gunzip:fy,AsyncGunzip:HO,gunzip:VO,gunzipSync:py,Zlib:NE,AsyncZlib:i$,zlib:s$,zlibSync:UE,Unzlib:my,AsyncUnzlib:WO,unzlib:QO,unzlibSync:Ul,compress:qP,AsyncCompress:jP,compressSync:dy,Compress:uy,Decompress:jO,AsyncDecompress:r$,decompress:o$,decompressSync:a$,DecodeUTF8:c$,EncodeUTF8:l$,strToU8:th,strFromU8:QS,ZipPassThrough:cg,ZipDeflate:h$,AsyncZipDeflate:u$,Zip:d$,zip:f$,zipSync:p$,UnzipPassThrough:$O,UnzipInflate:m$,AsyncUnzipInflate:g$,Unzip:A$,unzip:_$,unzipSync:y$},Symbol.toStringTag,{value:"Module"}));class e3 extends kC{constructor(e){super(e),this.type=Os}parse(e){const U=Math.pow(2.7182818,2.2);function W(j,ie){let pe=0;for(let Ve=0;Ve<65536;++Ve)(Ve==0||j[Ve>>3]&1<<(Ve&7))&&(ie[pe++]=Ve);const Ee=pe-1;for(;pe<65536;)ie[pe++]=0;return Ee}function J(j){for(let ie=0;ie<16384;ie++)j[ie]={},j[ie].len=0,j[ie].lit=0,j[ie].p=null}const ee={l:0,c:0,lc:0};function Q(j,ie,pe,Ee,Ve){for(;pe<j;)ie=ie<<8|Bn(Ee,Ve),pe+=8;pe-=j,ee.l=ie>>pe&(1<<j)-1,ee.c=ie,ee.lc=pe}const Y=new Array(59);function se(j){for(let pe=0;pe<=58;++pe)Y[pe]=0;for(let pe=0;pe<65537;++pe)Y[j[pe]]+=1;let ie=0;for(let pe=58;pe>0;--pe){const Ee=ie+Y[pe]>>1;Y[pe]=ie,ie=Ee}for(let pe=0;pe<65537;++pe){const Ee=j[pe];Ee>0&&(j[pe]=Ee|Y[Ee]++<<6)}}function ae(j,ie,pe,Ee,Ve,De){const Ze=ie;let lt=0,St=0;for(;Ee<=Ve;Ee++){if(Ze.value-ie.value>pe)return!1;Q(6,lt,St,j,Ze);const ut=ee.l;if(lt=ee.c,St=ee.lc,De[Ee]=ut,ut==63){if(Ze.value-ie.value>pe)throw new Error("Something wrong with hufUnpackEncTable");Q(8,lt,St,j,Ze);let xt=ee.l+6;if(lt=ee.c,St=ee.lc,Ee+xt>Ve+1)throw new Error("Something wrong with hufUnpackEncTable");for(;xt--;)De[Ee++]=0;Ee--}else if(ut>=59){let xt=ut-59+2;if(Ee+xt>Ve+1)throw new Error("Something wrong with hufUnpackEncTable");for(;xt--;)De[Ee++]=0;Ee--}}se(De)}function ve(j){return j&63}function xe(j){return j>>6}function Ae(j,ie,pe,Ee){for(;ie<=pe;ie++){const Ve=xe(j[ie]),De=ve(j[ie]);if(Ve>>De)throw new Error("Invalid table entry");if(De>14){const Ze=Ee[Ve>>De-14];if(Ze.len)throw new Error("Invalid table entry");if(Ze.lit++,Ze.p){const lt=Ze.p;Ze.p=new Array(Ze.lit);for(let St=0;St<Ze.lit-1;++St)Ze.p[St]=lt[St]}else Ze.p=new Array(1);Ze.p[Ze.lit-1]=ie}else if(De){let Ze=0;for(let lt=1<<14-De;lt>0;lt--){const St=Ee[(Ve<<14-De)+Ze];if(St.len||St.p)throw new Error("Invalid table entry");St.len=De,St.lit=ie,Ze++}}}return!0}const Me={c:0,lc:0};function Be(j,ie,pe,Ee){j=j<<8|Bn(pe,Ee),ie+=8,Me.c=j,Me.lc=ie}const Le={c:0,lc:0};function $e(j,ie,pe,Ee,Ve,De,Ze,lt,St){if(j==ie){Ee<8&&(Be(pe,Ee,Ve,De),pe=Me.c,Ee=Me.lc),Ee-=8;let ut=pe>>Ee;if(ut=new Uint8Array([ut])[0],lt.value+ut>St)return!1;const xt=Ze[lt.value-1];for(;ut-- >0;)Ze[lt.value++]=xt}else if(lt.value<St)Ze[lt.value++]=j;else return!1;Le.c=pe,Le.lc=Ee}function yt(j){return j&65535}function Nt(j){const ie=yt(j);return ie>32767?ie-65536:ie}const He={a:0,b:0};function mn(j,ie){const pe=Nt(j),Ve=Nt(ie),De=pe+(Ve&1)+(Ve>>1),Ze=De,lt=De-Ve;He.a=Ze,He.b=lt}function Xt(j,ie){const pe=yt(j),Ee=yt(ie),Ve=pe-(Ee>>1)&65535,De=Ee+Ve-32768&65535;He.a=De,He.b=Ve}function pn(j,ie,pe,Ee,Ve,De,Ze){const lt=Ze<16384,St=pe>Ve?Ve:pe;let ut=1,xt,Kt;for(;ut<=St;)ut<<=1;for(ut>>=1,xt=ut,ut>>=1;ut>=1;){Kt=0;const wt=Kt+De*(Ve-xt),vn=De*ut,fn=De*xt,$t=Ee*ut,un=Ee*xt;let Fn,Ci,Kn,Wi;for(;Kt<=wt;Kt+=fn){let fi=Kt;const In=Kt+Ee*(pe-xt);for(;fi<=In;fi+=un){const Li=fi+$t,zs=fi+vn,Yi=zs+$t;lt?(mn(j[fi+ie],j[zs+ie]),Fn=He.a,Kn=He.b,mn(j[Li+ie],j[Yi+ie]),Ci=He.a,Wi=He.b,mn(Fn,Ci),j[fi+ie]=He.a,j[Li+ie]=He.b,mn(Kn,Wi),j[zs+ie]=He.a,j[Yi+ie]=He.b):(Xt(j[fi+ie],j[zs+ie]),Fn=He.a,Kn=He.b,Xt(j[Li+ie],j[Yi+ie]),Ci=He.a,Wi=He.b,Xt(Fn,Ci),j[fi+ie]=He.a,j[Li+ie]=He.b,Xt(Kn,Wi),j[zs+ie]=He.a,j[Yi+ie]=He.b)}if(pe&ut){const Li=fi+vn;lt?mn(j[fi+ie],j[Li+ie]):Xt(j[fi+ie],j[Li+ie]),Fn=He.a,j[Li+ie]=He.b,j[fi+ie]=Fn}}if(Ve&ut){let fi=Kt;const In=Kt+Ee*(pe-xt);for(;fi<=In;fi+=un){const Li=fi+$t;lt?mn(j[fi+ie],j[Li+ie]):Xt(j[fi+ie],j[Li+ie]),Fn=He.a,j[Li+ie]=He.b,j[fi+ie]=Fn}}xt=ut,ut>>=1}return Kt}function Ft(j,ie,pe,Ee,Ve,De,Ze,lt,St){let ut=0,xt=0;const Kt=Ze,wt=Math.trunc(Ee.value+(Ve+7)/8);for(;Ee.value<wt;)for(Be(ut,xt,pe,Ee),ut=Me.c,xt=Me.lc;xt>=14;){const fn=ut>>xt-14&16383,$t=ie[fn];if($t.len)xt-=$t.len,$e($t.lit,De,ut,xt,pe,Ee,lt,St,Kt),ut=Le.c,xt=Le.lc;else{if(!$t.p)throw new Error("hufDecode issues");let un;for(un=0;un<$t.lit;un++){const Fn=ve(j[$t.p[un]]);for(;xt<Fn&&Ee.value<wt;)Be(ut,xt,pe,Ee),ut=Me.c,xt=Me.lc;if(xt>=Fn&&xe(j[$t.p[un]])==(ut>>xt-Fn&(1<<Fn)-1)){xt-=Fn,$e($t.p[un],De,ut,xt,pe,Ee,lt,St,Kt),ut=Le.c,xt=Le.lc;break}}if(un==$t.lit)throw new Error("hufDecode issues")}}const vn=8-Ve&7;for(ut>>=vn,xt-=vn;xt>0;){const fn=ie[ut<<14-xt&16383];if(fn.len)xt-=fn.len,$e(fn.lit,De,ut,xt,pe,Ee,lt,St,Kt),ut=Le.c,xt=Le.lc;else throw new Error("hufDecode issues")}return!0}function yn(j,ie,pe,Ee,Ve,De){const Ze={value:0},lt=pe.value,St=Ht(ie,pe),ut=Ht(ie,pe);pe.value+=4;const xt=Ht(ie,pe);if(pe.value+=4,St<0||St>=65537||ut<0||ut>=65537)throw new Error("Something wrong with HUF_ENCSIZE");const Kt=new Array(65537),wt=new Array(16384);J(wt);const vn=Ee-(pe.value-lt);if(ae(j,pe,vn,St,ut,Kt),xt>8*(Ee-(pe.value-lt)))throw new Error("Something wrong with hufUncompress");Ae(Kt,St,ut,wt),Ft(Kt,wt,j,pe,xt,ut,De,Ve,Ze)}function it(j,ie,pe){for(let Ee=0;Ee<pe;++Ee)ie[Ee]=j[ie[Ee]]}function tt(j){for(let ie=1;ie<j.length;ie++){const pe=j[ie-1]+j[ie]-128;j[ie]=pe}}function vt(j,ie){let pe=0,Ee=Math.floor((j.length+1)/2),Ve=0;const De=j.length-1;for(;!(Ve>De||(ie[Ve++]=j[pe++],Ve>De));)ie[Ve++]=j[Ee++]}function Jt(j){let ie=j.byteLength;const pe=new Array;let Ee=0;const Ve=new DataView(j);for(;ie>0;){const De=Ve.getInt8(Ee++);if(De<0){const Ze=-De;ie-=Ze+1;for(let lt=0;lt<Ze;lt++)pe.push(Ve.getUint8(Ee++))}else{const Ze=De;ie-=2;const lt=Ve.getUint8(Ee++);for(let St=0;St<Ze+1;St++)pe.push(lt)}}return pe}function Lt(j,ie,pe,Ee,Ve,De){let Ze=new DataView(De.buffer);const lt=pe[j.idx[0]].width,St=pe[j.idx[0]].height,ut=3,xt=Math.floor(lt/8),Kt=Math.ceil(lt/8),wt=Math.ceil(St/8),vn=lt-(Kt-1)*8,fn=St-(wt-1)*8,$t={value:0},un=new Array(ut),Fn=new Array(ut),Ci=new Array(ut),Kn=new Array(ut),Wi=new Array(ut);for(let In=0;In<ut;++In)Wi[In]=ie[j.idx[In]],un[In]=In<1?0:un[In-1]+Kt*wt,Fn[In]=new Float32Array(64),Ci[In]=new Uint16Array(64),Kn[In]=new Uint16Array(Kt*64);for(let In=0;In<wt;++In){let Li=8;In==wt-1&&(Li=fn);let zs=8;for(let xi=0;xi<Kt;++xi){xi==Kt-1&&(zs=vn);for(let Ii=0;Ii<ut;++Ii)Ci[Ii].fill(0),Ci[Ii][0]=Ve[un[Ii]++],En($t,Ee,Ci[Ii]),Zt(Ci[Ii],Fn[Ii]),ln(Fn[Ii]);ii(Fn);for(let Ii=0;Ii<ut;++Ii)Zn(Fn[Ii],Kn[Ii],xi*64)}let Yi=0;for(let xi=0;xi<ut;++xi){const Ii=pe[j.idx[xi]].type;for(let gr=8*In;gr<8*In+Li;++gr){Yi=Wi[xi][gr];for(let Ho=0;Ho<xt;++Ho){const Ar=Ho*64+(gr&7)*8;Ze.setUint16(Yi+0*2*Ii,Kn[xi][Ar+0],!0),Ze.setUint16(Yi+1*2*Ii,Kn[xi][Ar+1],!0),Ze.setUint16(Yi+2*2*Ii,Kn[xi][Ar+2],!0),Ze.setUint16(Yi+3*2*Ii,Kn[xi][Ar+3],!0),Ze.setUint16(Yi+4*2*Ii,Kn[xi][Ar+4],!0),Ze.setUint16(Yi+5*2*Ii,Kn[xi][Ar+5],!0),Ze.setUint16(Yi+6*2*Ii,Kn[xi][Ar+6],!0),Ze.setUint16(Yi+7*2*Ii,Kn[xi][Ar+7],!0),Yi+=8*2*Ii}}if(xt!=Kt)for(let gr=8*In;gr<8*In+Li;++gr){const Ho=Wi[xi][gr]+8*xt*2*Ii,Ar=xt*64+(gr&7)*8;for(let go=0;go<zs;++go)Ze.setUint16(Ho+go*2*Ii,Kn[xi][Ar+go],!0)}}}const fi=new Uint16Array(lt);Ze=new DataView(De.buffer);for(let In=0;In<ut;++In){pe[j.idx[In]].decoded=!0;const Li=pe[j.idx[In]].type;if(pe[In].type==2)for(let zs=0;zs<St;++zs){const Yi=Wi[In][zs];for(let xi=0;xi<lt;++xi)fi[xi]=Ze.getUint16(Yi+xi*2*Li,!0);for(let xi=0;xi<lt;++xi)Ze.setFloat32(Yi+xi*2*Li,Ie(fi[xi]),!0)}}}function En(j,ie,pe){let Ee,Ve=1;for(;Ve<64;)Ee=ie[j.value],Ee==65280?Ve=64:Ee>>8==255?Ve+=Ee&255:(pe[Ve]=Ee,Ve++),j.value++}function Zt(j,ie){ie[0]=Ie(j[0]),ie[1]=Ie(j[1]),ie[2]=Ie(j[5]),ie[3]=Ie(j[6]),ie[4]=Ie(j[14]),ie[5]=Ie(j[15]),ie[6]=Ie(j[27]),ie[7]=Ie(j[28]),ie[8]=Ie(j[2]),ie[9]=Ie(j[4]),ie[10]=Ie(j[7]),ie[11]=Ie(j[13]),ie[12]=Ie(j[16]),ie[13]=Ie(j[26]),ie[14]=Ie(j[29]),ie[15]=Ie(j[42]),ie[16]=Ie(j[3]),ie[17]=Ie(j[8]),ie[18]=Ie(j[12]),ie[19]=Ie(j[17]),ie[20]=Ie(j[25]),ie[21]=Ie(j[30]),ie[22]=Ie(j[41]),ie[23]=Ie(j[43]),ie[24]=Ie(j[9]),ie[25]=Ie(j[11]),ie[26]=Ie(j[18]),ie[27]=Ie(j[24]),ie[28]=Ie(j[31]),ie[29]=Ie(j[40]),ie[30]=Ie(j[44]),ie[31]=Ie(j[53]),ie[32]=Ie(j[10]),ie[33]=Ie(j[19]),ie[34]=Ie(j[23]),ie[35]=Ie(j[32]),ie[36]=Ie(j[39]),ie[37]=Ie(j[45]),ie[38]=Ie(j[52]),ie[39]=Ie(j[54]),ie[40]=Ie(j[20]),ie[41]=Ie(j[22]),ie[42]=Ie(j[33]),ie[43]=Ie(j[38]),ie[44]=Ie(j[46]),ie[45]=Ie(j[51]),ie[46]=Ie(j[55]),ie[47]=Ie(j[60]),ie[48]=Ie(j[21]),ie[49]=Ie(j[34]),ie[50]=Ie(j[37]),ie[51]=Ie(j[47]),ie[52]=Ie(j[50]),ie[53]=Ie(j[56]),ie[54]=Ie(j[59]),ie[55]=Ie(j[61]),ie[56]=Ie(j[35]),ie[57]=Ie(j[36]),ie[58]=Ie(j[48]),ie[59]=Ie(j[49]),ie[60]=Ie(j[57]),ie[61]=Ie(j[58]),ie[62]=Ie(j[62]),ie[63]=Ie(j[63])}function ln(j){const ie=.5*Math.cos(.7853975),pe=.5*Math.cos(3.14159/16),Ee=.5*Math.cos(3.14159/8),Ve=.5*Math.cos(3*3.14159/16),De=.5*Math.cos(5*3.14159/16),Ze=.5*Math.cos(3*3.14159/8),lt=.5*Math.cos(7*3.14159/16),St=new Array(4),ut=new Array(4),xt=new Array(4),Kt=new Array(4);for(let wt=0;wt<8;++wt){const vn=wt*8;St[0]=Ee*j[vn+2],St[1]=Ze*j[vn+2],St[2]=Ee*j[vn+6],St[3]=Ze*j[vn+6],ut[0]=pe*j[vn+1]+Ve*j[vn+3]+De*j[vn+5]+lt*j[vn+7],ut[1]=Ve*j[vn+1]-lt*j[vn+3]-pe*j[vn+5]-De*j[vn+7],ut[2]=De*j[vn+1]-pe*j[vn+3]+lt*j[vn+5]+Ve*j[vn+7],ut[3]=lt*j[vn+1]-De*j[vn+3]+Ve*j[vn+5]-pe*j[vn+7],xt[0]=ie*(j[vn+0]+j[vn+4]),xt[3]=ie*(j[vn+0]-j[vn+4]),xt[1]=St[0]+St[3],xt[2]=St[1]-St[2],Kt[0]=xt[0]+xt[1],Kt[1]=xt[3]+xt[2],Kt[2]=xt[3]-xt[2],Kt[3]=xt[0]-xt[1],j[vn+0]=Kt[0]+ut[0],j[vn+1]=Kt[1]+ut[1],j[vn+2]=Kt[2]+ut[2],j[vn+3]=Kt[3]+ut[3],j[vn+4]=Kt[3]-ut[3],j[vn+5]=Kt[2]-ut[2],j[vn+6]=Kt[1]-ut[1],j[vn+7]=Kt[0]-ut[0]}for(let wt=0;wt<8;++wt)St[0]=Ee*j[16+wt],St[1]=Ze*j[16+wt],St[2]=Ee*j[48+wt],St[3]=Ze*j[48+wt],ut[0]=pe*j[8+wt]+Ve*j[24+wt]+De*j[40+wt]+lt*j[56+wt],ut[1]=Ve*j[8+wt]-lt*j[24+wt]-pe*j[40+wt]-De*j[56+wt],ut[2]=De*j[8+wt]-pe*j[24+wt]+lt*j[40+wt]+Ve*j[56+wt],ut[3]=lt*j[8+wt]-De*j[24+wt]+Ve*j[40+wt]-pe*j[56+wt],xt[0]=ie*(j[wt]+j[32+wt]),xt[3]=ie*(j[wt]-j[32+wt]),xt[1]=St[0]+St[3],xt[2]=St[1]-St[2],Kt[0]=xt[0]+xt[1],Kt[1]=xt[3]+xt[2],Kt[2]=xt[3]-xt[2],Kt[3]=xt[0]-xt[1],j[0+wt]=Kt[0]+ut[0],j[8+wt]=Kt[1]+ut[1],j[16+wt]=Kt[2]+ut[2],j[24+wt]=Kt[3]+ut[3],j[32+wt]=Kt[3]-ut[3],j[40+wt]=Kt[2]-ut[2],j[48+wt]=Kt[1]-ut[1],j[56+wt]=Kt[0]-ut[0]}function ii(j){for(let ie=0;ie<64;++ie){const pe=j[0][ie],Ee=j[1][ie],Ve=j[2][ie];j[0][ie]=pe+1.5747*Ve,j[1][ie]=pe-.1873*Ee-.4682*Ve,j[2][ie]=pe+1.8556*Ee}}function Zn(j,ie,pe){for(let Ee=0;Ee<64;++Ee)ie[pe+Ee]=fu.toHalfFloat(me(j[Ee]))}function me(j){return j<=1?Math.sign(j)*Math.pow(Math.abs(j),2.2):Math.sign(j)*Math.pow(U,Math.abs(j)-1)}function ce(j){return new DataView(j.array.buffer,j.offset.value,j.size)}function Qe(j){const ie=j.viewer.buffer.slice(j.offset.value,j.offset.value+j.size),pe=new Uint8Array(Jt(ie)),Ee=new Uint8Array(pe.length);return tt(pe),vt(pe,Ee),new DataView(Ee.buffer)}function At(j){const ie=j.array.slice(j.offset.value,j.offset.value+j.size);typeof YP>"u"&&console.error("THREE.EXRLoader: External library fflate.min.js required.");const pe=Ul(ie),Ee=new Uint8Array(pe.length);return tt(pe),vt(pe,Ee),new DataView(Ee.buffer)}function pt(j){const ie=j.viewer,pe={value:j.offset.value},Ee=new Uint16Array(j.width*j.scanlineBlockSize*(j.channels*j.type)),Ve=new Uint8Array(8192);let De=0;const Ze=new Array(j.channels);for(let fn=0;fn<j.channels;fn++)Ze[fn]={},Ze[fn].start=De,Ze[fn].end=Ze[fn].start,Ze[fn].nx=j.width,Ze[fn].ny=j.lines,Ze[fn].size=j.type,De+=Ze[fn].nx*Ze[fn].ny*Ze[fn].size;const lt=Ct(ie,pe),St=Ct(ie,pe);if(St>=8192)throw new Error("Something is wrong with PIZ_COMPRESSION BITMAP_SIZE");if(lt<=St)for(let fn=0;fn<St-lt+1;fn++)Ve[fn+lt]=Ln(ie,pe);const ut=new Uint16Array(65536),xt=W(Ve,ut),Kt=Ht(ie,pe);yn(j.array,ie,pe,Kt,Ee,De);for(let fn=0;fn<j.channels;++fn){const $t=Ze[fn];for(let un=0;un<Ze[fn].size;++un)pn(Ee,$t.start+un,$t.nx,$t.size,$t.ny,$t.nx*$t.size,xt)}it(ut,Ee,De);let wt=0;const vn=new Uint8Array(Ee.buffer.byteLength);for(let fn=0;fn<j.lines;fn++)for(let $t=0;$t<j.channels;$t++){const un=Ze[$t],Fn=un.nx*un.size,Ci=new Uint8Array(Ee.buffer,un.end*2,Fn*2);vn.set(Ci,wt),wt+=Fn*2,un.end+=Fn}return new DataView(vn.buffer)}function zt(j){const ie=j.array.slice(j.offset.value,j.offset.value+j.size);typeof YP>"u"&&console.error("THREE.EXRLoader: External library fflate.min.js required.");const pe=Ul(ie),Ee=j.lines*j.channels*j.width,Ve=j.type==1?new Uint16Array(Ee):new Uint32Array(Ee);let De=0,Ze=0;const lt=new Array(4);for(let St=0;St<j.lines;St++)for(let ut=0;ut<j.channels;ut++){let xt=0;switch(j.type){case 1:lt[0]=De,lt[1]=lt[0]+j.width,De=lt[1]+j.width;for(let Kt=0;Kt<j.width;++Kt)xt+=pe[lt[0]++]<<8|pe[lt[1]++],Ve[Ze]=xt,Ze++;break;case 2:lt[0]=De,lt[1]=lt[0]+j.width,lt[2]=lt[1]+j.width,De=lt[2]+j.width;for(let Kt=0;Kt<j.width;++Kt)xt+=pe[lt[0]++]<<24|pe[lt[1]++]<<16|pe[lt[2]++]<<8,Ve[Ze]=xt,Ze++;break}}return new DataView(Ve.buffer)}function Mn(j){const ie=j.viewer,pe={value:j.offset.value},Ee=new Uint8Array(j.width*j.lines*(j.channels*j.type*2)),Ve={version:Ce(ie,pe),unknownUncompressedSize:Ce(ie,pe),unknownCompressedSize:Ce(ie,pe),acCompressedSize:Ce(ie,pe),dcCompressedSize:Ce(ie,pe),rleCompressedSize:Ce(ie,pe),rleUncompressedSize:Ce(ie,pe),rleRawSize:Ce(ie,pe),totalAcUncompressedCount:Ce(ie,pe),totalDcUncompressedCount:Ce(ie,pe),acCompression:Ce(ie,pe)};if(Ve.version<2)throw new Error("EXRLoader.parse: "+ze.compression+" version "+Ve.version+" is unsupported");const De=new Array;let Ze=Ct(ie,pe)-2;for(;Ze>0;){const $t=we(ie.buffer,pe),un=Ln(ie,pe),Fn=un>>2&3,Ci=(un>>4)-1,Kn=new Int8Array([Ci])[0],Wi=Ln(ie,pe);De.push({name:$t,index:Kn,type:Wi,compression:Fn}),Ze-=$t.length+3}const lt=ze.channels,St=new Array(j.channels);for(let $t=0;$t<j.channels;++$t){const un=St[$t]={},Fn=lt[$t];un.name=Fn.name,un.compression=0,un.decoded=!1,un.type=Fn.pixelType,un.pLinear=Fn.pLinear,un.width=j.width,un.height=j.lines}const ut={idx:new Array(3)};for(let $t=0;$t<j.channels;++$t){const un=St[$t];for(let Fn=0;Fn<De.length;++Fn){const Ci=De[Fn];un.name==Ci.name&&(un.compression=Ci.compression,Ci.index>=0&&(ut.idx[Ci.index]=$t),un.offset=$t)}}let xt,Kt,wt;if(Ve.acCompressedSize>0)switch(Ve.acCompression){case 0:xt=new Uint16Array(Ve.totalAcUncompressedCount),yn(j.array,ie,pe,Ve.acCompressedSize,xt,Ve.totalAcUncompressedCount);break;case 1:const $t=j.array.slice(pe.value,pe.value+Ve.totalAcUncompressedCount),un=Ul($t);xt=new Uint16Array(un.buffer),pe.value+=Ve.totalAcUncompressedCount;break}if(Ve.dcCompressedSize>0){const $t={array:j.array,offset:pe,size:Ve.dcCompressedSize};Kt=new Uint16Array(At($t).buffer),pe.value+=Ve.dcCompressedSize}if(Ve.rleRawSize>0){const $t=j.array.slice(pe.value,pe.value+Ve.rleCompressedSize),un=Ul($t);wt=Jt(un.buffer),pe.value+=Ve.rleCompressedSize}let vn=0;const fn=new Array(St.length);for(let $t=0;$t<fn.length;++$t)fn[$t]=new Array;for(let $t=0;$t<j.lines;++$t)for(let un=0;un<St.length;++un)fn[un].push(vn),vn+=St[un].width*j.type*2;Lt(ut,fn,St,xt,Kt,Ee);for(let $t=0;$t<St.length;++$t){const un=St[$t];if(!un.decoded)switch(un.compression){case 2:let Fn=0,Ci=0;for(let Kn=0;Kn<j.lines;++Kn){let Wi=fn[$t][Fn];for(let fi=0;fi<un.width;++fi){for(let In=0;In<2*un.type;++In)Ee[Wi++]=wt[Ci+In*un.width*un.height];Ci++}Fn++}break;case 1:default:throw new Error("EXRLoader.parse: unsupported channel compression")}}return new DataView(Ee.buffer)}function we(j,ie){const pe=new Uint8Array(j);let Ee=0;for(;pe[ie.value+Ee]!=0;)Ee+=1;const Ve=new TextDecoder().decode(pe.slice(ie.value,ie.value+Ee));return ie.value=ie.value+Ee+1,Ve}function Fe(j,ie,pe){const Ee=new TextDecoder().decode(new Uint8Array(j).slice(ie.value,ie.value+pe));return ie.value=ie.value+pe,Ee}function bt(j,ie){const pe=nn(j,ie),Ee=Ht(j,ie);return[pe,Ee]}function hn(j,ie){const pe=Ht(j,ie),Ee=Ht(j,ie);return[pe,Ee]}function nn(j,ie){const pe=j.getInt32(ie.value,!0);return ie.value=ie.value+4,pe}function Ht(j,ie){const pe=j.getUint32(ie.value,!0);return ie.value=ie.value+4,pe}function Bn(j,ie){const pe=j[ie.value];return ie.value=ie.value+1,pe}function Ln(j,ie){const pe=j.getUint8(ie.value);return ie.value=ie.value+1,pe}const Ce=function(j,ie){const pe=Number(j.getBigInt64(ie.value,!0));return ie.value+=8,pe};function Rt(j,ie){const pe=j.getFloat32(ie.value,!0);return ie.value+=4,pe}function kt(j,ie){return fu.toHalfFloat(Rt(j,ie))}function Ie(j){const ie=(j&31744)>>10,pe=j&1023;return(j>>15?-1:1)*(ie?ie===31?pe?NaN:1/0:Math.pow(2,ie-15)*(1+pe/1024):6103515625e-14*(pe/1024))}function Ct(j,ie){const pe=j.getUint16(ie.value,!0);return ie.value+=2,pe}function wn(j,ie){return Ie(Ct(j,ie))}function di(j,ie,pe,Ee){const Ve=pe.value,De=[];for(;pe.value<Ve+Ee-1;){const Ze=we(ie,pe),lt=nn(j,pe),St=Ln(j,pe);pe.value+=3;const ut=nn(j,pe),xt=nn(j,pe);De.push({name:Ze,pixelType:lt,pLinear:St,xSampling:ut,ySampling:xt})}return pe.value+=1,De}function Gi(j,ie){const pe=Rt(j,ie),Ee=Rt(j,ie),Ve=Rt(j,ie),De=Rt(j,ie),Ze=Rt(j,ie),lt=Rt(j,ie),St=Rt(j,ie),ut=Rt(j,ie);return{redX:pe,redY:Ee,greenX:Ve,greenY:De,blueX:Ze,blueY:lt,whiteX:St,whiteY:ut}}function jr(j,ie){const pe=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],Ee=Ln(j,ie);return pe[Ee]}function vi(j,ie){const pe=Ht(j,ie),Ee=Ht(j,ie),Ve=Ht(j,ie),De=Ht(j,ie);return{xMin:pe,yMin:Ee,xMax:Ve,yMax:De}}function Ir(j,ie){const pe=["INCREASING_Y"],Ee=Ln(j,ie);return pe[Ee]}function js(j,ie){const pe=Rt(j,ie),Ee=Rt(j,ie);return[pe,Ee]}function ir(j,ie){const pe=Rt(j,ie),Ee=Rt(j,ie),Ve=Rt(j,ie);return[pe,Ee,Ve]}function Ja(j,ie,pe,Ee,Ve){if(Ee==="string"||Ee==="stringvector"||Ee==="iccProfile")return Fe(ie,pe,Ve);if(Ee==="chlist")return di(j,ie,pe,Ve);if(Ee==="chromaticities")return Gi(j,pe);if(Ee==="compression")return jr(j,pe);if(Ee==="box2i")return vi(j,pe);if(Ee==="lineOrder")return Ir(j,pe);if(Ee==="float")return Rt(j,pe);if(Ee==="v2f")return js(j,pe);if(Ee==="v3f")return ir(j,pe);if(Ee==="int")return nn(j,pe);if(Ee==="rational")return bt(j,pe);if(Ee==="timecode")return hn(j,pe);if(Ee==="preview")return pe.value+=Ve,"skipped";pe.value+=Ve}function fh(j,ie,pe){const Ee={};if(j.getUint32(0,!0)!=20000630)throw new Error("THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.");Ee.version=j.getUint8(4);const Ve=j.getUint8(5);Ee.spec={singleTile:!!(Ve&2),longName:!!(Ve&4),deepFormat:!!(Ve&8),multiPart:!!(Ve&16)},pe.value=8;let De=!0;for(;De;){const Ze=we(ie,pe);if(Ze==0)De=!1;else{const lt=we(ie,pe),St=Ht(j,pe),ut=Ja(j,ie,pe,lt,St);ut===void 0?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${lt}'.`):Ee[Ze]=ut}}if((Ve&-5)!=0)throw console.error("EXRHeader:",Ee),new Error("THREE.EXRLoader: provided file is currently unsupported.");return Ee}function mo(j,ie,pe,Ee,Ve){const De={size:0,viewer:ie,array:pe,offset:Ee,width:j.dataWindow.xMax-j.dataWindow.xMin+1,height:j.dataWindow.yMax-j.dataWindow.yMin+1,channels:j.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:j.channels[0].pixelType,uncompress:null,getter:null,format:null,encoding:null};switch(j.compression){case"NO_COMPRESSION":De.lines=1,De.uncompress=ce;break;case"RLE_COMPRESSION":De.lines=1,De.uncompress=Qe;break;case"ZIPS_COMPRESSION":De.lines=1,De.uncompress=At;break;case"ZIP_COMPRESSION":De.lines=16,De.uncompress=At;break;case"PIZ_COMPRESSION":De.lines=32,De.uncompress=pt;break;case"PXR24_COMPRESSION":De.lines=16,De.uncompress=zt;break;case"DWAA_COMPRESSION":De.lines=32,De.uncompress=Mn;break;case"DWAB_COMPRESSION":De.lines=256,De.uncompress=Mn;break;default:throw new Error("EXRLoader.parse: "+j.compression+" is unsupported")}if(De.scanlineBlockSize=De.lines,De.type==1)switch(Ve){case Ms:De.getter=wn,De.inputSize=2;break;case Os:De.getter=Ct,De.inputSize=2;break}else if(De.type==2)switch(Ve){case Ms:De.getter=Rt,De.inputSize=4;break;case Os:De.getter=kt,De.inputSize=4}else throw new Error("EXRLoader.parse: unsupported pixelType "+De.type+" for "+j.compression+".");De.blockCount=(j.dataWindow.yMax+1)/De.scanlineBlockSize;for(let lt=0;lt<De.blockCount;lt++)Ce(ie,Ee);De.outputChannels=De.channels==3?4:De.channels;const Ze=De.width*De.height*De.outputChannels;switch(Ve){case Ms:De.byteArray=new Float32Array(Ze),De.channels<De.outputChannels&&De.byteArray.fill(1,0,Ze);break;case Os:De.byteArray=new Uint16Array(Ze),De.channels<De.outputChannels&&De.byteArray.fill(15360,0,Ze);break;default:console.error("THREE.EXRLoader: unsupported type: ",Ve);break}return De.bytesPerLine=De.width*De.inputSize*De.channels,De.outputChannels==4?(De.format=us,De.encoding=pr):(De.format=lu,De.encoding=pr),De}const Rr=new DataView(e),Gu=new Uint8Array(e),he={value:0},ze=fh(Rr,e,he),Ue=mo(ze,Rr,Gu,he,this.type),ke={value:0},nt={R:0,G:1,B:2,A:3,Y:0};for(let j=0;j<Ue.height/Ue.scanlineBlockSize;j++){const ie=Ht(Rr,he);Ue.size=Ht(Rr,he),Ue.lines=ie+Ue.scanlineBlockSize>Ue.height?Ue.height-ie:Ue.scanlineBlockSize;const Ee=Ue.size<Ue.lines*Ue.bytesPerLine?Ue.uncompress(Ue):ce(Ue);he.value+=Ue.size;for(let Ve=0;Ve<Ue.scanlineBlockSize;Ve++){const De=Ve+j*Ue.scanlineBlockSize;if(De>=Ue.height)break;for(let Ze=0;Ze<Ue.channels;Ze++){const lt=nt[ze.channels[Ze].name];for(let St=0;St<Ue.width;St++){ke.value=(Ve*(Ue.channels*Ue.width)+Ze*Ue.width+St)*Ue.inputSize;const ut=(Ue.height-1-De)*(Ue.width*Ue.outputChannels)+St*Ue.outputChannels+lt;Ue.byteArray[ut]=Ue.getter(Ee,ke)}}}}return{header:ze,width:Ue.width,height:Ue.height,data:Ue.byteArray,format:Ue.format,encoding:Ue.encoding,type:this.type}}setDataType(e){return this.type=e,this}load(e,t,n,i){function r(o,l){o.encoding=l.encoding,o.minFilter=yi,o.magFilter=yi,o.generateMipmaps=!1,o.flipY=!1,t&&t(o,l)}return super.load(e,r,n,i)}}const t3=jt("debugautosync");class v${constructor(){E(this,"_syncers",{})}getOrCreateSyncer(e){if(!e.guid)return null;if(this._syncers[e.guid])return this._syncers[e.guid];const t=new x$(e);return this._syncers[e.guid]=t,t}}const n3=new v$;class x${constructor(e){E(this,"comp");E(this,"hasChanges",!1);E(this,"changedProperties",{});E(this,"data",{});E(this,"_boundEvent");E(this,"_isReceiving",!1);E(this,"_isInit",!1);this.comp=e}get networkingKey(){return this.comp.constructor.name}init(e){if(this._isInit)return;this._isInit=!0,this.comp=e,this._boundEvent=this.onHandleSending.bind(this),this.comp.context.post_render_callbacks.push(this._boundEvent),this.comp.context.connection.beginListen(this.networkingKey,this.onHandleReceiving.bind(this));const t=this.comp.context.connection.tryGetState(this.comp.guid);t&&this.onHandleReceiving(t)}notifyChanged(e,t){this._isReceiving||(this.hasChanges=!0,this.changedProperties[e]=t)}onHandleSending(){if(!this.hasChanges)return;this.hasChanges=!1;const e=this.comp.context.connection;if(!e||!e.isConnected){for(const t in this.changedProperties)delete this.changedProperties[t];return}for(const t in this.data)delete this.data[t];this.data.guid=this.comp.guid;for(const t in this.changedProperties){const n=this.changedProperties[t];delete this.changedProperties[t],this.data[t]=n}e.send(this.networkingKey,this.data)}onHandleReceiving(e){if(!this._isInit||!this.comp)return;const t=e.guid;if(!(t&&t!==this.comp.guid)){t3&&console.log("RECEIVED",this.comp.name,this.comp.guid,e);try{this._isReceiving=!0;for(const n in e){if(n==="guid")continue;const i=e[n];this.comp[n]=i}}catch(n){console.error(n)}finally{this._isReceiving=!1}}}}function w$(a,e){let t=e!==a;if(!t&&a&&e){if(Array.isArray(a)&&Array.isArray(e))t=!0;else if(typeof a=="object"&&typeof e=="object"){for(const n of Object.keys(a))if(a[n]!==e[n]){t=!0;break}}}return t}function b$(a){if(a.__autoPropertySyncHandler)return a.__autoPropertySyncHandler;const e=n3.getOrCreateSyncer(a);return e==null||e.init(a),a.__autoPropertySyncHandler=e,e}const i3=function(a){return function(e,t){let n=null;const i=a?e[a]:void 0,r=e,o=r.__internalAwake;t3&&console.log(t);const l=t+"k__BackingField";r.__internalAwake=function(){if(this[l]!==void 0)return;this[l]=this[t],o.call(this),n=n3.getOrCreateSyncer(this);const h=Object.getOwnPropertyDescriptor(this,t);(h==null?void 0:h.set)===void 0&&Object.defineProperty(this,t,{set:function(u){var g;const f=this[l];this[l]=u,w$(u,f)&&(i==null?void 0:i.call(this,u,f))!==!1&&((g=b$(this))==null||g.notifyChanged(t,u))},get:function(){return this[l]},configurable:!0,enumerable:!0}),n==null||n.init(this)}}};var E$=Object.defineProperty,C$=Object.getOwnPropertyDescriptor,s3=(a,e,t,n)=>{for(var i=n>1?void 0:n?C$(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&E$(e,t,i),i};class fv extends Bt{constructor(){super(...arguments);E(this,"url");E(this,"allowDrop",!0);E(this,"_loader");E(this,"_prevLoadedEnvironment");E(this,"_prevEnvironment",null);E(this,"_prevBackground",null);E(this,"dragOverEvent");E(this,"dropEvent")}onEnable(){this.setSkybox(this.url),this.registerDropEvents()}onDisable(){this.context.scene.environment===this._prevLoadedEnvironment&&(this.context.isInXR||(this.context.scene.environment=this._prevEnvironment,this.context.scene.background=this._prevBackground),this._prevLoadedEnvironment=void 0),this.unregisterDropEvents()}async setSkybox(t){if(!t)return;if(!(t!=null&&t.endsWith(".hdr"))&&!t.endsWith(".exr")&&console.warn("Potentially invalid skybox url",this.url,"on",this.name),!this._loader){const r=t.endsWith(".exr");this._loader=r?new e3:new e$}const n=await this._loader.loadAsync(t);if(!n||!this.enabled)return;this.url=t,n.mapping=gf,this._prevBackground=this.context.scene.background,this._prevEnvironment=this.context.scene.environment,console.log("Set skybox",this.url),this.context.scene.environment=n,this.context.scene.background=n,this._prevLoadedEnvironment=n;const i=t.lastIndexOf("/");n.name=t.substring(i>=0?i+1:0)}registerDropEvents(){this.dragOverEvent||(this.dragOverEvent=t=>{if(!!this.allowDrop&&!!t.dataTransfer)for(const n of t.dataTransfer.types)n==="text/uri-list"&&t.preventDefault()},this.dropEvent=t=>{var n,i,r,o;if(!!this.allowDrop&&(t.preventDefault(),!!t.dataTransfer)){for(const l of t.dataTransfer.types)if(l==="text/uri-list"){const h=t.dataTransfer.getData(l);console.log(l,h);let u=(i=(n=new RegExp(/polyhaven.com\/asset_img\/.+?\/(?<name>.+)\.png/).exec(h))==null?void 0:n.groups)==null?void 0:i.name;if(u||(u=(o=(r=new RegExp(/polyhaven\.com\/a\/(?<name>.+)/).exec(h))==null?void 0:r.groups)==null?void 0:o.name),console.log(u),u){const f="https://dl.polyhaven.org/file/ph-assets/HDRIs/exr/1k/"+u+"_1k.exr";this.setSkybox(f)}else console.warn("Could not resolve skybox name from dropped url",h)}}},this.context.domElement.addEventListener("dragover",this.dragOverEvent),this.context.domElement.addEventListener("drop",this.dropEvent))}unregisterDropEvents(){!this.dragOverEvent||(this.context.domElement.removeEventListener("dragover",this.dragOverEvent),this.context.domElement.removeEventListener("drop",this.dropEvent))}}s3([i3("setSkybox"),Re()],fv.prototype,"url",2);s3([Re()],fv.prototype,"allowDrop",2);var S$=Object.defineProperty,M$=Object.getOwnPropertyDescriptor,T$=(a,e,t,n)=>{for(var i=n>1?void 0:n?M$(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&S$(e,t,i),i},Bb;const r3=(Bb=class extends Bt{constructor(){super(...arguments);E(this,"target",null);E(this,"followFactor",.1);E(this,"rotateFactor",.1);E(this,"flipForward",!1);E(this,"_firstUpdate",!0)}onEnable(){const e=Te.getComponentInChildren(this.gameObject,Us);e&&e.cam&&(e.gameObject.position.set(0,0,0),e.cam.position.set(0,0,0),e.gameObject.quaternion.identity(),e.cam.quaternion.setFromEuler(new vs(0,Math.PI,0)))}onBeforeRender(){this.followFactor<=0||this.updateNow(!1)}updateNow(e){if(!(!this.target||this.target===this.gameObject)){if(this.followFactor>0){const t=ti(this.target),n=this._firstUpdate||e?1:Ei.clamp01(this.context.time.deltaTime*this.followFactor);this.worldPosition=this.worldPosition.lerp(t,n)}if(this.rotateFactor>0){const t=uo(this.target);this.flipForward&&t.premultiply(r3._invertForward);const n=this._firstUpdate||e?1:Ei.clamp01(this.context.time.deltaTime*this.rotateFactor);this.worldQuaternion=this.worldQuaternion.slerp(t,n)}this._firstUpdate=!1}}},E(Bb,"_invertForward",new Ot().setFromAxisAngle(new q(0,1,0),Math.PI)),Bb);let pv=r3;T$([Re(qt)],pv.prototype,"target",2);var I$=Object.defineProperty,R$=Object.getOwnPropertyDescriptor,Yg=(a,e,t,n)=>{for(var i=n>1?void 0:n?R$(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&I$(e,t,i),i};const P_=jt("debugspatialtrigger"),JP=new Va,ZP=new Va;function P$(a,e){return JP.mask=a,ZP.mask=e,JP.test(ZP)}class Oc extends Bt{constructor(){super(...arguments);E(this,"triggerMask",0);E(this,"onEnter");E(this,"onStay");E(this,"onExit");E(this,"currentIntersected",[]);E(this,"lastIntersected",[])}start(){P_&&console.log(this.name,this.triggerMask,this)}update(){this.currentIntersected.length=0;for(const t of mv.triggers)P$(t.triggerMask,this.triggerMask)&&t.test(this.gameObject)&&this.currentIntersected.push(t);for(let t=this.lastIntersected.length-1;t>=0;t--){const n=this.lastIntersected[t];this.currentIntersected.indexOf(n)<0&&(this.onExitTrigger(n),this.lastIntersected.splice(t,1))}for(const t of this.currentIntersected)this.lastIntersected.indexOf(t)<0&&this.onEnterTrigger(t),this.onStayTrigger(t);this.lastIntersected.length=0,this.lastIntersected.push(...this.currentIntersected)}onEnterTrigger(t){var n;P_&&console.log("ENTER TRIGGER",this.name,t.name,this,t),t.raiseOnEnterEvent(this),(n=this.onEnter)==null||n.invoke(this,t)}onExitTrigger(t){var n;P_&&console.log("EXIT TRIGGER",this.name,t.name,this,t),t.raiseOnExitEvent(this),(n=this.onExit)==null||n.invoke(this,t)}onStayTrigger(t){var n;t.raiseOnStayEvent(this),(n=this.onStay)==null||n.invoke(this,t)}}Yg([Re()],Oc.prototype,"triggerMask",2);Yg([Re(ua)],Oc.prototype,"onEnter",2);Yg([Re(ua)],Oc.prototype,"onStay",2);Yg([Re(ua)],Oc.prototype,"onExit",2);var Lb;const B_=(Lb=class extends Bt{constructor(){super(...arguments);E(this,"triggerMask");E(this,"boxHelper")}start(){P_&&console.log(this.name,this.triggerMask,this)}onEnable(){var e;B_.triggers.push(this),this.boxHelper||(this.boxHelper=Te.addNewComponent(this.gameObject,Ic),(e=this.boxHelper)==null||e.showHelper())}onDisable(){B_.triggers.splice(B_.triggers.indexOf(this),1)}test(e){var t;return this.boxHelper&&(t=this.boxHelper.isInBox(e))!=null?t:!1}raiseOnEnterEvent(e){Te.foreachComponent(this.gameObject,t=>{t!==e&&t instanceof Oc&&t.onEnterTrigger(this)},!1)}raiseOnStayEvent(e){Te.foreachComponent(this.gameObject,t=>{t!==e&&t instanceof Oc&&t.onStayTrigger(this)},!1)}raiseOnExitEvent(e){Te.foreachComponent(this.gameObject,t=>{t!==e&&t instanceof Oc&&t.onExitTrigger(this)},!1)}},E(Lb,"triggers",[]),Lb);let mv=B_;Yg([Re()],mv.prototype,"triggerMask",2);class o3 extends Bt{constructor(){super(...arguments);E(this,"cam",null);E(this,"_firstPersonMode",!0);E(this,"orbit",null);E(this,"firstPersonFollow",null);E(this,"spectatorUIDomElement",null);E(this,"eventSub_WebXRRequestStartEvent",null);E(this,"eventSub_WebXRStartEvent",null);E(this,"eventSub_WebXREndEvent",null);E(this,"_sessionHasStarted",!1);E(this,"_firstPersonIsSetup",!1);E(this,"_orbitStartPos",new q);E(this,"_orbitStartRot",new Ot);E(this,"_orbitStartPos2",new q);E(this,"_orbitStartRot2",new Ot)}get firstPersonMode(){var t;return(t=this._firstPersonMode)!=null?t:!1}set firstPersonMode(t){this._firstPersonMode=t}enableFirstPersonMode(){this._firstPersonMode=!0,this.updateUI(),this.cam&&(this.firstPersonFollow&&(this.firstPersonFollow.enabled=!0,this.firstPersonFollow.updateNow(!0)),this.orbit&&(this.orbit.enabled=!1))}enableThirdPersonMode(){this._firstPersonMode=!1,this.updateUI(),this.firstPersonFollow&&(this.firstPersonFollow.enabled=!1),this.cam&&(ys(this.cam.cam,this._orbitStartPos),Nr(this.cam.cam,this._orbitStartRot),ys(this.cam.gameObject,this._orbitStartPos2),Nr(this.cam.gameObject,this._orbitStartRot2),this.orbit&&(this.orbit.enabled=!0,this.orbit.setFromTargetPosition()))}awake(){var n,i;if(Te.setActive(this.gameObject,!1),!this.isSupportedPlatform()){console.log("Disable spectator cam",window.navigator.userAgent,this);return}if(this.cam=Te.getComponent(this.gameObject,Us),!this.cam){console.error("Spectator camera needs camera component",this);return}const t="#spectator-camera-ui";this.spectatorUIDomElement=this.context.domElement.querySelector(t),this.spectatorUIDomElement||console.warn("Could not find spectator camera UI element",t),(n=this.spectatorUIDomElement)==null||n.classList.add("hidden"),this.cam&&(this.cam.enabled=!0,this._orbitStartPos.copy(ti(this.cam.cam)),this._orbitStartRot.copy(uo(this.cam.cam)),this._orbitStartPos2.copy(ti(this.cam.gameObject)),this._orbitStartRot2.copy(uo(this.cam.gameObject))),this.eventSub_WebXRRequestStartEvent=this.onXRSessionRequestStart.bind(this),this.eventSub_WebXRStartEvent=this.onXRSessionStart.bind(this),this.eventSub_WebXREndEvent=this.onXRSessionEnded.bind(this),Ti.addEventListener(Ks.RequestVRSession,this.eventSub_WebXRRequestStartEvent),Ti.addEventListener(Ks.XRStarted,this.eventSub_WebXRStartEvent),Ti.addEventListener(Ks.XRStopped,this.eventSub_WebXREndEvent),(i=this.context.domElement.querySelector("button#toggle-spectator-view"))==null||i.addEventListener("click",this.toggleView.bind(this)),this.updateUI()}onDestroy(){Ti.removeEventListener(Ks.RequestVRSession,this.eventSub_WebXRStartEvent),Ti.removeEventListener(Ks.XRStarted,this.eventSub_WebXRStartEvent),Ti.removeEventListener(Ks.XRStopped,this.eventSub_WebXREndEvent)}toggleView(){this.firstPersonMode=!this.firstPersonMode}updateUI(){var n;const t=this.context.domElement.querySelector("button#toggle-spectator-view");if(!!t&&(t.disabled=!0,t.firstChild&&(this._sessionHasStarted?t.firstChild.textContent=this.firstPersonMode?"\u{1F441}\uFE0F":"\u{1F4F7}":t.firstChild.textContent="Waiting for VR session"),((n=t.children)==null?void 0:n.length)>1)){const i=t.children[1];i.style.display=this._sessionHasStarted?"block":"none",this.firstPersonMode?i.textContent="First-Person View. See what the person in VR sees":i.textContent="Third-Person View. Freely move the camera around"}}isSupportedPlatform(){const t=window.navigator.userAgent,n=/Windows|MacOS/.test(t),i=/Windows NT/.test(t)&&/Edg/.test(t)&&!/Win64/.test(t);return n&&!i}onXRSessionRequestStart(t){var n;this._sessionHasStarted=!1,(n=this.spectatorUIDomElement)==null||n.classList.remove("hidden"),Te.setActive(this.gameObject,!0),this.cam&&this.cam.cam&&(ys(this.cam.cam,this._orbitStartPos),Nr(this.cam.cam,this._orbitStartRot),ys(this.cam.gameObject,this._orbitStartPos2),Nr(this.cam.gameObject,this._orbitStartRot2)),this.firstPersonMode?this.enableFirstPersonMode():this.enableThirdPersonMode()}onXRSessionStart(t){if(this._sessionHasStarted=!0,this.updateUI(),this.context.mainCamera){const n=this.context.renderer.xr.getCamera(this.context.mainCamera);this.setupFollowMode(n)}}onXRSessionEnded(t){var n;this._sessionHasStarted=!1,this._firstPersonIsSetup=!1,(n=this.spectatorUIDomElement)==null||n.classList.add("hidden"),Te.setActive(this.gameObject,!1)}onAfterRender(){var h;if(!this.cam)return;this.context.input.isKeyDown(Dc.KEY_S)&&(this.firstPersonMode=!this.firstPersonMode),this.updateFollowSettings();const t=this.context.renderer,n=t.xr.enabled;if(!t.xr.isPresenting)return;const i=t.getRenderTarget();let r=null;if(!i){if(!t.state.bindFramebuffer||!t.state.bindXRFramebuffer)return;r=t._framebuffer,t.state.bindXRFramebuffer(null)}this.setAvatarFlagsBeforeRender(),t.setClearColor(new _e(1,1,1)),t.setRenderTarget(null),t.xr.enabled=!1;const o=(h=this.cam)==null?void 0:h.cam;this.context.updateAspect(o);const l=t.xr.isPresenting;t.xr.isPresenting=!1,t.setSize(this.context.domWidth,this.context.domHeight),t.render(this.context.scene,o),t.xr.isPresenting=l,t.xr.enabled=n,i?t.setRenderTarget(i):t.state.bindXRFramebuffer(r),this.resetAvatarFlags()}setupFollowMode(t){if(!t||!this.cam||this._firstPersonIsSetup)return;this._firstPersonIsSetup=!0,this.firstPersonFollow=Te.addNewComponent(this.cam.gameObject,pv);const n=new qt;t.add(n),n.add(new Lg(.2)),this.firstPersonFollow.target=n,this.updateFollowSettings();const i=this.context.mainCamera;i&&(this.cam.cam.near=i.near,this.cam.cam.far=i.far,this.cam.cam.updateProjectionMatrix()),this.orbit&&(this.orbit.enabled=!1)}updateFollowSettings(){var n;const t=(n=this.firstPersonFollow)==null?void 0:n.target;!t||!this.firstPersonFollow||(this.firstPersonMode===!1?(this.firstPersonFollow.followFactor=3,this.firstPersonFollow.rotateFactor=2,this.firstPersonFollow.flipForward=!1,t.position.set(0,.5,1.5),t.quaternion.identity()):(t.position.set(0,0,0),t.quaternion.identity(),this.firstPersonFollow.followFactor=12,this.firstPersonFollow.rotateFactor=5,this.firstPersonFollow.flipForward=!1))}setAvatarFlagsBeforeRender(){for(const t of fr.instances)if(t.avatar&&"isLocalAvatar"in t.avatar){const n=this.firstPersonMode&&this._firstPersonIsSetup&&t.avatar.isLocalAvatar?Cr.FirstPerson:Cr.ThirdPerson,i=t.avatar.flags;if(!i)continue;for(const r of i)r.UpdateVisible(n)}}resetAvatarFlags(){var t;for(const n of fr.instances)if(n.avatar&&"flags"in n.avatar){const i=n.avatar.flags;if(!i)continue;for(const r of i)(t=n.avatar)!=null&&t.isLocalAvatar?r.UpdateVisible(Cr.FirstPerson):r.UpdateVisible(Cr.ThirdPerson)}}}class a3 extends Bt{constructor(){super(...arguments);E(this,"anchor",null);E(this,"connectedBody",null);E(this,"connectedAnchor",null);E(this,"spring",10);E(this,"damper",.2);E(this,"rb",null)}awake(){if(this.rb=Te.getComponent(this.gameObject,Tr),!this.connectedBody||!this.connectedBody.body||!this.rb||!this.rb.body)return;this.connectedBody.body.mass=Math.min(this.rb.body.mass*.99,this.connectedBody.body.mass);const t=new uX(this.rb.body,this.connectedBody.body,{restLength:.01,stiffness:this.spring*.5,damping:this.damper});this.context.physics.addPostStepListener(n=>{t.applyForce()})}update(){}}var B$=Object.defineProperty,L$=Object.getOwnPropertyDescriptor,gv=(a,e,t,n)=>{for(var i=n>1?void 0:n?L$(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&B$(e,t,i),i};class qS{constructor(){E(this,"texture");E(this,"triangles");E(this,"uv");E(this,"vertices");E(this,"_geometry")}}gv([Re(Vi)],qS.prototype,"texture",2);class KP{static getOrCreateGeometry(e){if(e._geometry)return e._geometry;const t=new Sn;e._geometry=t;const n=new Float32Array(e.triangles.length*3),i=new Float32Array(e.triangles.length*2);for(let r=0;r<e.triangles.length;r+=1){const o=e.triangles[r];n[r*3]=-e.vertices[o].x,n[r*3+1]=e.vertices[o].y,n[r*3+2]=0;const l=e.uv[o];i[r*2]=l.x,i[r*2+1]=1-l.y}return t.setAttribute("position",new Jn(n,3)),t.setAttribute("uv",new Jn(i,2)),t}}class Jg extends Bt{constructor(){super(...arguments);E(this,"drawMode",0);E(this,"size",{x:1,y:1});E(this,"color");E(this,"sharedMaterial");E(this,"_sprite");E(this,"_currentSprite")}get sprite(){return this._sprite}set sprite(t){t!==this._sprite&&(this._sprite=t,this.updateSprite())}awake(){this._currentSprite=void 0}start(){this.drawMode===2&&console.warn("Tiled draw mode is not supported yet",this),this._currentSprite?this.gameObject&&this.gameObject.add(this._currentSprite):this.updateSprite()}updateSprite(){if(!!this.__didAwake&&!!this.sprite&&!!this.sharedMaterial){if(this._currentSprite)this._currentSprite.geometry=KP.getOrCreateGeometry(this.sprite),this._currentSprite.material.map=this.sprite.texture;else{const t=new Hi({color:16777215,side:er});if(!t)return;if(this.color&&(t.color||(t.color=new _e),t.color.copy(this.color),t.opacity=this.color.alpha),t.alphaTest=.5,this.sprite.texture&&!t.wireframe){const n=this.sprite.texture;t.map=n}this._currentSprite=new _t(KP.getOrCreateGeometry(this.sprite),t)}this._currentSprite.parent!==this.gameObject&&(this.drawMode===2&&this._currentSprite.scale.set(this.size.x,this.size.y,1),this.gameObject&&this.gameObject.add(this._currentSprite))}}}gv([Re()],Jg.prototype,"drawMode",2);gv([Re(oo)],Jg.prototype,"color",2);gv([Re(Ts)],Jg.prototype,"sharedMaterial",2);class Pa{constructor(){E(this,"bb",null);E(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsSyncedCameraModel(e,t){return(t||new Pa).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsSyncedCameraModel(e,t){return e.setPosition(e.position()+tv),(t||new Pa).__init(e.readInt32(e.position())+e.position(),e)}userId(e){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}guid(e){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__string(this.bb_pos+t,e):null}dontSave(){const e=this.bb.__offset(this.bb_pos,8);return e?!!this.bb.readInt8(this.bb_pos+e):!1}pos(e){const t=this.bb.__offset(this.bb_pos,10);return t?(e||new co).__init(this.bb_pos+t,this.bb):null}rot(e){const t=this.bb.__offset(this.bb_pos,12);return t?(e||new co).__init(this.bb_pos+t,this.bb):null}static startSyncedCameraModel(e){e.startObject(5)}static addUserId(e,t){e.addFieldOffset(0,t,0)}static addGuid(e,t){e.addFieldOffset(1,t,0)}static addDontSave(e,t){e.addFieldInt8(2,+t,0)}static addPos(e,t){e.addFieldStruct(3,t,0)}static addRot(e,t){e.addFieldStruct(4,t,0)}static endSyncedCameraModel(e){return e.endObject()}static finishSyncedCameraModelBuffer(e,t){e.finish(t)}static finishSizePrefixedSyncedCameraModelBuffer(e,t){e.finish(t,void 0,!0)}}var D$=Object.defineProperty,O$=Object.getOwnPropertyDescriptor,c3=(a,e,t,n)=>{for(var i=n>1?void 0:n?O$(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&D$(e,t,i),i};const gy="SCAM";uS(gy,Pa.getRootAsSyncedCameraModel);const eo=new Of;class F${constructor(e,t){E(this,"userId");E(this,"guid");this.guid=t,this.userId=e}send(e,t){var i;const n=(i=e.cam)==null?void 0:i.cam;if(n){eo.clear();const r=eo.createString(this.guid),o=eo.createString(this.userId);Pa.startSyncedCameraModel(eo),Pa.addGuid(eo,r),Pa.addUserId(eo,o);const l=ti(n),h=T2(n);Pa.addPos(eo,co.createVec3(eo,l.x,l.y,l.z)),Pa.addRot(eo,co.createVec3(eo,h.x,h.y,h.z));const u=Pa.endSyncedCameraModel(eo);eo.finish(u,gy),t.sendBinary(eo.asUint8Array())}}}class Av extends Bt{constructor(){super(...arguments);E(this,"cam",null);E(this,"cameraPrefab",null);E(this,"_lastWorldPosition");E(this,"_lastWorldQuaternion");E(this,"_model",null);E(this,"_needsUpdate",!0);E(this,"_lastUpdateTime",0);E(this,"remoteCams",{});E(this,"userToCamMap",{});E(this,"_camTimeoutInSeconds",10);E(this,"_receiveCallback",null)}getUserCamera(t){const n=this.userToCamMap[t];return n?this.remoteCams[n].obj:null}async awake(){this._lastWorldPosition=this.worldPosition.clone(),this._lastWorldQuaternion=this.worldQuaternion.clone(),this.cameraPrefab&&("uri"in this.cameraPrefab&&(this.cameraPrefab=await this.cameraPrefab.instantiate(this.gameObject)),this.cameraPrefab&&"isObject3D"in this.cameraPrefab&&(this.cameraPrefab.visible=!1))}start(){var t;this.cam||(console.warn("Missing camera, fallback to main camera",this),this.cam=(t=this.context.mainCameraComponent)!=null?t:null)}onEnable(){this._receiveCallback=this.context.connection.beginListenBinrary(gy,this.onReceivedRemoteCameraInfoBin.bind(this))}onDisable(){this.context.connection.stopListenBinary(gy,this._receiveCallback)}update(){for(const i in this.remoteCams){const r=this.remoteCams[i],o=this.context.time.realtimeSinceStartup-r.lastUpdate;if(!r||o>this._camTimeoutInSeconds){console.log("Remote cam timeout",r,o),r!=null&&r.obj&&Te.destroy(r.obj),delete this.remoteCams[i],r&&delete this.userToCamMap[r.userId];continue}}if(Ti.IsInWebXR)return;if(this.cam===null){this.enabled=!1;return}if(!this.context.connection.isConnected||this.context.connection.connectionId===null)return;this._model===null&&(this._model=new F$(this.context.connection.connectionId,this.context.connection.connectionId+"_camera"));const t=ti(this.cam.cam),n=uo(this.cam.cam);(t.distanceTo(this._lastWorldPosition)>.001||n.angleTo(this._lastWorldQuaternion)>.01)&&(this._needsUpdate=!0),this._lastWorldPosition.copy(t),this._lastWorldQuaternion.copy(n),!((!this._needsUpdate||this.context.time.frameCount%2!==0)&&!(this.context.time.realtimeSinceStartup-this._lastUpdateTime>this._camTimeoutInSeconds*.5))&&(this._lastUpdateTime=this.context.time.realtimeSinceStartup,this._needsUpdate=!1,this._model.send(this,this.context.connection))}onReceivedRemoteCameraInfoBin(t){const n=t.guid();if(!n)return;const i=t.userId();if(!i||!this.context.connection.userIsInRoom(i)||!this.cameraPrefab)return;let r=this.remoteCams[n];if(!r)if("isObject3D"in this.cameraPrefab){const u=new Fo;u.context=this.context;const f=Te.instantiate(this.cameraPrefab,u);r=this.remoteCams[n]={obj:f,lastUpdate:this.context.time.realtimeSinceStartup,userId:i},r.obj.visible=!0,this.gameObject.add(f),this.userToCamMap[i]=n;const g=Te.getOrAddComponent(f,fr);g.connectionId=i,g.avatar=f}else return;const o=r.obj;r.lastUpdate=this.context.time.realtimeSinceStartup,ro.markDirty(o);const l=t.pos();l&&$C(o,l.x(),l.y(),l.z());const h=t.rot();h&&I2(o,h.x(),h.y(),h.z())}}c3([Re(Us)],Av.prototype,"cam",2);c3([Re([qt,Nc])],Av.prototype,"cameraPrefab",2);var k$=Object.defineProperty,N$=Object.getOwnPropertyDescriptor,Zg=(a,e,t,n)=>{for(var i=n>1?void 0:n?N$(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&k$(e,t,i),i};const bb="view",$P=jt("debugsyncedroom");class Nu extends Bt{constructor(){super(...arguments);E(this,"roomName");E(this,"urlParameterName");E(this,"joinRandomRoom",!0);E(this,"requireRoomParameter",!1);E(this,"autoRejoin",!0);E(this,"_roomPrefix");E(this,"_lastPingTime",0);E(this,"_lastRoomTime",-1)}awake(){this._roomPrefix===void 0&&(this._roomPrefix=this.roomName,this.roomName="")}onEnable(){const t=jt(bb);if(t&&typeof t=="string"&&t.length>0){console.log("Join as viewer"),this.context.connection.joinRoom(t,!0);return}this.tryJoinRoom()}onDisable(){this.roomName&&this.roomName.length>0&&this.context.connection.leaveRoom(this.roomName)}tryJoinRoom(t=0){let n=!1;if(this.urlParameterName){const i=jt(this.urlParameterName);if(i&&typeof i=="string"){n=!0;const r=vq(i);this.roomName=r}else if(this.joinRandomRoom&&(console.log("No room name found in url, generating random one"),this.setRandomRoomUrlParameter(),t<1))return this.tryJoinRoom(t+1)}else this.joinRandomRoom&&(this.roomName===null||this.roomName===void 0||this.roomName.length<=0)&&(console.log("generate room name"),this.roomName=this.generateRoomName());return this.requireRoomParameter&&!n?($P&&console.log('No required room parameter "'+this.urlParameterName+'" in url - will not connect to networking backend.'),!1):!this.roomName||this.roomName.length<=0?($P&&console.error('Missing room name on "'+this.name+'". Make sure this is correctly configured in Unity',this.context.connection.isDebugEnabled?this:""),!1):(this.context.connection.isConnected||this.context.connection.connect(),this._roomPrefix&&(this.roomName=this._roomPrefix+this.roomName),this.context.connection.joinRoom(this.roomName),!0)}update(){this.context.connection.isConnected&&(this.context.time.time-this._lastPingTime>3&&(this._lastPingTime=this.context.time.time,this.context.connection.send("ping",{time:this.context.time.time})),this.context.connection.isInRoom&&(this._lastRoomTime=this.context.time.time)),this._lastRoomTime>0&&this.context.time.time-this._lastRoomTime>.3&&(this._lastRoomTime=-1,this.autoRejoin?(console.log("Disconnected from networking backend - attempt reconnecting now"),this.tryJoinRoom()):console.warn("You are not connected to a room anymore (possibly because the tab was inactive for too long and the server kicked you)"))}get currentRoomName(){const t=jt(bb);return t||jt(this.urlParameterName)}setRandomRoomUrlParameter(){const t=y2(),n=this.generateRoomName();jt(this.urlParameterName)?t.set(this.urlParameterName,n):t.append(this.urlParameterName,n),Aq(n,t)}generateRoomName(){return yq()+"_"+_q(100,999)}getViewOnlyUrl(){if(this.context.connection.isConnected&&this.context.connection.currentRoomViewId){const t=window.location.search,n=new URLSearchParams(t);return n.has(this.urlParameterName)&&n.delete(this.urlParameterName),n.set(bb,this.context.connection.currentRoomViewId),window.location.origin+window.location.pathname+"?"+n.toString()}return null}}Zg([Re()],Nu.prototype,"roomName",2);Zg([Re()],Nu.prototype,"urlParameterName",2);Zg([Re()],Nu.prototype,"joinRandomRoom",2);Zg([Re()],Nu.prototype,"requireRoomParameter",2);Zg([Re()],Nu.prototype,"autoRejoin",2);function U$(){const a=jt("testwindowcount")||0;a&&a>0&&z$(a)}function z$(a){if(jt("testwindow"))return null;const e=new URL(window.location.href);$_(e.searchParams,oy,1),$_(e.searchParams,"testwindow",1);const t=e.toString(),n=[];window.onbeforeunload=()=>{for(const h of n)h.close()};const i=.05,r=128;let o=0,l=0;for(let h=0;h<a;h++){o*r+r*.01>=window.innerWidth&&(l+=1,o=0);const u=o*(r*(1+i))+window.screenLeft,f=l*(r*(1+i))+window.screenTop+90+60*l;o+=1;const g=window.open(t,"test window "+h,`popup=yes width=${r} height=${r} top=${f} left=${u}`);if(!g){console.warn("Failed to open window");continue}n.push(g),g.onload=()=>{g.onbeforeunload=()=>{for(let m=0;m<n.length;m++){const A=n[m];A!==g&&A.close()}n.length=0}}}return n}class l3 extends Bt{awake(){U$()}}class h3 extends Bt{constructor(){super(...arguments);E(this,"transformsPerFrame",10);E(this,"interval",0);E(this,"useFlatbuffers",!0);E(this,"builder",null);E(this,"models",null)}awake(){if(this.useFlatbuffers)this.context.connection.beginListenBinrary(sg,t=>{});else{this.models=[];for(let t=0;t<this.transformsPerFrame;t++)this.models.push(new u3(this.context.connection.connectionId+"_simulatedTransform_"+t,this))}}update(){if(!!this.context.connection.isConnected){if(this.useFlatbuffers){if(!this.context.connection.connectionId||this.context.time.frameCount%this.interval!==0)return;this.builder===null&&(this.builder=new Of(1024));const t=this.builder;for(let n=0;n<this.transformsPerFrame;n++){t.clear();const i=nO(this.context.connection.connectionId,this);this.context.connection.sendBinary(i)}}else if(this.models)for(let t=0;t<this.models.length;t++){const n=this.models[t];n.dontSave=!0,n.update(this,null),this.context.connection.send("TestSimulateUserData-"+t,n)}}}}class u3{constructor(e,t){E(this,"guid");E(this,"fast",!1);E(this,"position");E(this,"rotation");E(this,"velocity");E(this,"dontSave");this.guid=e,this.position={x:0,y:0,z:0},this.rotation={x:0,y:0,z:0,w:0},this.update(t,null)}isValid(){return this.fast!==void 0||this.position!==void 0||this.rotation!==void 0||this.velocity!==void 0}update(e,t){const n=e.worldPosition;this.position.x=n.x,this.position.y=n.y,this.position.z=n.z;const i=e.worldQuaternion;if(this.rotation.x=i.x,this.rotation.y=i.y,this.rotation.z=i.z,this.rotation.w=i.w,this.fast=!1,t){const r=t.getVelocity();this.velocity===void 0&&(this.velocity={x:0,y:0,z:0}),this.velocity.x=r.x,this.velocity.y=r.y,this.velocity.z=r.z}}}E(u3,"temp",new q);const Yh=new Du,Or=new q,Tl=new q,Zi=new Ot,eB={X:new q(1,0,0),Y:new q(0,1,0),Z:new q(0,0,1)},Eb={type:"change"},tB={type:"mouseDown"},nB={type:"mouseUp",mode:null},iB={type:"objectChange"};class G$ extends qt{constructor(e,t){super(),t===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),t=document),this.isTransformControls=!0,this.visible=!1,this.domElement=t,this.domElement.style.touchAction="none";const n=new q$;this._gizmo=n,this.add(n);const i=new X$;this._plane=i,this.add(i);const r=this;function o(R,M){let I=M;Object.defineProperty(r,R,{get:function(){return I!==void 0?I:M},set:function(T){I!==T&&(I=T,i[R]=T,n[R]=T,r.dispatchEvent({type:R+"-changed",value:T}),r.dispatchEvent(Eb))}}),r[R]=M,i[R]=M,n[R]=M}o("camera",e),o("object",void 0),o("enabled",!0),o("axis",null),o("mode","translate"),o("translationSnap",null),o("rotationSnap",null),o("scaleSnap",null),o("space","world"),o("size",1),o("dragging",!1),o("showX",!0),o("showY",!0),o("showZ",!0);const l=new q,h=new q,u=new Ot,f=new Ot,g=new q,m=new Ot,A=new q,v=new q,w=new q,b=0,S=new q;o("worldPosition",l),o("worldPositionStart",h),o("worldQuaternion",u),o("worldQuaternionStart",f),o("cameraPosition",g),o("cameraQuaternion",m),o("pointStart",A),o("pointEnd",v),o("rotationAxis",w),o("rotationAngle",b),o("eye",S),this._offset=new q,this._startNorm=new q,this._endNorm=new q,this._cameraScale=new q,this._parentPosition=new q,this._parentQuaternion=new Ot,this._parentQuaternionInv=new Ot,this._parentScale=new q,this._worldScaleStart=new q,this._worldQuaternionInv=new Ot,this._worldScale=new q,this._positionStart=new q,this._quaternionStart=new Ot,this._scaleStart=new q,this._getPointer=H$.bind(this),this._onPointerDown=W$.bind(this),this._onPointerHover=V$.bind(this),this._onPointerMove=Q$.bind(this),this._onPointerUp=j$.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;Yh.setFromCamera(e,this.camera);const t=Cb(this._gizmo.picker[this.mode],Yh);t?this.axis=t.object.name:this.axis=null}pointerDown(e){if(!(this.object===void 0||this.dragging===!0||e.button!==0)&&this.axis!==null){Yh.setFromCamera(e,this.camera);const t=Cb(this._plane,Yh,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,tB.mode=this.mode,this.dispatchEvent(tB)}}pointerMove(e){const t=this.axis,n=this.mode,i=this.object;let r=this.space;if(n==="scale"?r="local":(t==="E"||t==="XYZE"||t==="XYZ")&&(r="world"),i===void 0||t===null||this.dragging===!1||e.button!==-1)return;Yh.setFromCamera(e,this.camera);const o=Cb(this._plane,Yh,!0);if(!!o){if(this.pointEnd.copy(o.point).sub(this.worldPositionStart),n==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),r==="local"&&t!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),t.indexOf("X")===-1&&(this._offset.x=0),t.indexOf("Y")===-1&&(this._offset.y=0),t.indexOf("Z")===-1&&(this._offset.z=0),r==="local"&&t!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),i.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(r==="local"&&(i.position.applyQuaternion(Zi.copy(this._quaternionStart).invert()),t.search("X")!==-1&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.position.applyQuaternion(this._quaternionStart)),r==="world"&&(i.parent&&i.position.add(Or.setFromMatrixPosition(i.parent.matrixWorld)),t.search("X")!==-1&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.parent&&i.position.sub(Or.setFromMatrixPosition(i.parent.matrixWorld))));else if(n==="scale"){if(t.search("XYZ")!==-1){let l=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(l*=-1),Tl.set(l,l,l)}else Or.copy(this.pointStart),Tl.copy(this.pointEnd),Or.applyQuaternion(this._worldQuaternionInv),Tl.applyQuaternion(this._worldQuaternionInv),Tl.divide(Or),t.search("X")===-1&&(Tl.x=1),t.search("Y")===-1&&(Tl.y=1),t.search("Z")===-1&&(Tl.z=1);i.scale.copy(this._scaleStart).multiply(Tl),this.scaleSnap&&(t.search("X")!==-1&&(i.scale.x=Math.round(i.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Y")!==-1&&(i.scale.y=Math.round(i.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Z")!==-1&&(i.scale.z=Math.round(i.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(n==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const l=20/this.worldPosition.distanceTo(Or.setFromMatrixPosition(this.camera.matrixWorld));t==="E"?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1):t==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(Or.copy(this.rotationAxis).cross(this.eye))*l):(t==="X"||t==="Y"||t==="Z")&&(this.rotationAxis.copy(eB[t]),Or.copy(eB[t]),r==="local"&&Or.applyQuaternion(this.worldQuaternion),this.rotationAngle=this._offset.dot(Or.cross(this.eye).normalize())*l),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),r==="local"&&t!=="E"&&t!=="XYZE"?(i.quaternion.copy(this._quaternionStart),i.quaternion.multiply(Zi.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),i.quaternion.copy(Zi.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),i.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(Eb),this.dispatchEvent(iB)}}pointerUp(e){e.button===0&&(this.dragging&&this.axis!==null&&(nB.mode=this.mode,this.dispatchEvent(nB)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){!this.enabled||this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(Eb),this.dispatchEvent(iB),this.pointStart.copy(this.pointEnd))}getRaycaster(){return Yh}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function H$(a){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:a.button};{const e=this.domElement.getBoundingClientRect();return{x:(a.clientX-e.left)/e.width*2-1,y:-(a.clientY-e.top)/e.height*2+1,button:a.button}}}function V$(a){if(!!this.enabled)switch(a.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(a));break}}function W$(a){!this.enabled||(document.pointerLockElement||this.domElement.setPointerCapture(a.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(a)),this.pointerDown(this._getPointer(a)))}function Q$(a){!this.enabled||this.pointerMove(this._getPointer(a))}function j$(a){!this.enabled||(this.domElement.releasePointerCapture(a.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(a)))}function Cb(a,e,t){const n=e.intersectObject(a,!0);for(let i=0;i<n.length;i++)if(n[i].object.visible||t)return n[i];return!1}const f_=new vs,Ni=new q(0,1,0),sB=new q(0,0,0),rB=new xn,p_=new Ot,L_=new Ot,Ca=new q,oB=new xn,ym=new q(1,0,0),su=new q(0,1,0),vm=new q(0,0,1),m_=new q,lm=new q,hm=new q;class q$ extends qt{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new Hi({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=new Is({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),n=e.clone();n.opacity=.15;const i=t.clone();i.opacity=.5;const r=e.clone();r.color.setHex(16711680);const o=e.clone();o.color.setHex(65280);const l=e.clone();l.color.setHex(255);const h=e.clone();h.color.setHex(16711680),h.opacity=.5;const u=e.clone();u.color.setHex(65280),u.opacity=.5;const f=e.clone();f.color.setHex(255),f.opacity=.5;const g=e.clone();g.opacity=.25;const m=e.clone();m.color.setHex(16776960),m.opacity=.25,e.clone().color.setHex(16776960);const v=e.clone();v.color.setHex(7895160);const w=new cs(0,.04,.1,12);w.translate(0,.05,0);const b=new Ui(.08,.08,.08);b.translate(0,.04,0);const S=new Sn;S.setAttribute("position",new tn([0,0,0,1,0,0],3));const R=new cs(.0075,.0075,.5,3);R.translate(0,.25,0);function M(se,ae){const ve=new Ba(se,.0075,3,64,ae*Math.PI*2);return ve.rotateY(Math.PI/2),ve.rotateX(Math.PI/2),ve}function I(){const se=new Sn;return se.setAttribute("position",new tn([0,0,0,1,1,1],3)),se}const T={X:[[new _t(w,r),[.5,0,0],[0,0,-Math.PI/2]],[new _t(w,r),[-.5,0,0],[0,0,Math.PI/2]],[new _t(R,r),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new _t(w,o),[0,.5,0]],[new _t(w,o),[0,-.5,0],[Math.PI,0,0]],[new _t(R,o)]],Z:[[new _t(w,l),[0,0,.5],[Math.PI/2,0,0]],[new _t(w,l),[0,0,-.5],[-Math.PI/2,0,0]],[new _t(R,l),null,[Math.PI/2,0,0]]],XYZ:[[new _t(new Oa(.1,0),g.clone()),[0,0,0]]],XY:[[new _t(new Ui(.15,.15,.01),f.clone()),[.15,.15,0]]],YZ:[[new _t(new Ui(.15,.15,.01),h.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new _t(new Ui(.15,.15,.01),u.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},B={X:[[new _t(new cs(.2,0,.6,4),n),[.3,0,0],[0,0,-Math.PI/2]],[new _t(new cs(.2,0,.6,4),n),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new _t(new cs(.2,0,.6,4),n),[0,.3,0]],[new _t(new cs(.2,0,.6,4),n),[0,-.3,0],[0,0,Math.PI]]],Z:[[new _t(new cs(.2,0,.6,4),n),[0,0,.3],[Math.PI/2,0,0]],[new _t(new cs(.2,0,.6,4),n),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new _t(new Oa(.2,0),n)]],XY:[[new _t(new Ui(.2,.2,.01),n),[.15,.15,0]]],YZ:[[new _t(new Ui(.2,.2,.01),n),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new _t(new Ui(.2,.2,.01),n),[.15,0,.15],[-Math.PI/2,0,0]]]},F={START:[[new _t(new Oa(.01,2),i),null,null,null,"helper"]],END:[[new _t(new Oa(.01,2),i),null,null,null,"helper"]],DELTA:[[new Ss(I(),i),null,null,null,"helper"]],X:[[new Ss(S,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Ss(S,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Ss(S,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},D={XYZE:[[new _t(M(.5,1),v),null,[0,Math.PI/2,0]]],X:[[new _t(M(.5,.5),r)]],Y:[[new _t(M(.5,.5),o),null,[0,0,-Math.PI/2]]],Z:[[new _t(M(.5,.5),l),null,[0,Math.PI/2,0]]],E:[[new _t(M(.75,1),m),null,[0,Math.PI/2,0]]]},U={AXIS:[[new Ss(S,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},W={XYZE:[[new _t(new ho(.25,10,8),n)]],X:[[new _t(new Ba(.5,.1,4,24),n),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new _t(new Ba(.5,.1,4,24),n),[0,0,0],[Math.PI/2,0,0]]],Z:[[new _t(new Ba(.5,.1,4,24),n),[0,0,0],[0,0,-Math.PI/2]]],E:[[new _t(new Ba(.75,.1,2,24),n)]]},J={X:[[new _t(b,r),[.5,0,0],[0,0,-Math.PI/2]],[new _t(R,r),[0,0,0],[0,0,-Math.PI/2]],[new _t(b,r),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new _t(b,o),[0,.5,0]],[new _t(R,o)],[new _t(b,o),[0,-.5,0],[0,0,Math.PI]]],Z:[[new _t(b,l),[0,0,.5],[Math.PI/2,0,0]],[new _t(R,l),[0,0,0],[Math.PI/2,0,0]],[new _t(b,l),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new _t(new Ui(.15,.15,.01),f),[.15,.15,0]]],YZ:[[new _t(new Ui(.15,.15,.01),h),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new _t(new Ui(.15,.15,.01),u),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new _t(new Ui(.1,.1,.1),g.clone())]]},ee={X:[[new _t(new cs(.2,0,.6,4),n),[.3,0,0],[0,0,-Math.PI/2]],[new _t(new cs(.2,0,.6,4),n),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new _t(new cs(.2,0,.6,4),n),[0,.3,0]],[new _t(new cs(.2,0,.6,4),n),[0,-.3,0],[0,0,Math.PI]]],Z:[[new _t(new cs(.2,0,.6,4),n),[0,0,.3],[Math.PI/2,0,0]],[new _t(new cs(.2,0,.6,4),n),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new _t(new Ui(.2,.2,.01),n),[.15,.15,0]]],YZ:[[new _t(new Ui(.2,.2,.01),n),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new _t(new Ui(.2,.2,.01),n),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new _t(new Ui(.2,.2,.2),n),[0,0,0]]]},Q={X:[[new Ss(S,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Ss(S,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Ss(S,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function Y(se){const ae=new qt;for(const ve in se)for(let xe=se[ve].length;xe--;){const Ae=se[ve][xe][0].clone(),Me=se[ve][xe][1],Be=se[ve][xe][2],Le=se[ve][xe][3],$e=se[ve][xe][4];Ae.name=ve,Ae.tag=$e,Me&&Ae.position.set(Me[0],Me[1],Me[2]),Be&&Ae.rotation.set(Be[0],Be[1],Be[2]),Le&&Ae.scale.set(Le[0],Le[1],Le[2]),Ae.updateMatrix();const yt=Ae.geometry.clone();yt.applyMatrix4(Ae.matrix),Ae.geometry=yt,Ae.renderOrder=1/0,Ae.position.set(0,0,0),Ae.rotation.set(0,0,0),Ae.scale.set(1,1,1),ae.add(Ae)}return ae}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=Y(T)),this.add(this.gizmo.rotate=Y(D)),this.add(this.gizmo.scale=Y(J)),this.add(this.picker.translate=Y(B)),this.add(this.picker.rotate=Y(W)),this.add(this.picker.scale=Y(ee)),this.add(this.helper.translate=Y(F)),this.add(this.helper.rotate=Y(U)),this.add(this.helper.scale=Y(Q)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const n=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:L_;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let i=[];i=i.concat(this.picker[this.mode].children),i=i.concat(this.gizmo[this.mode].children),i=i.concat(this.helper[this.mode].children);for(let r=0;r<i.length;r++){const o=i[r];o.visible=!0,o.rotation.set(0,0,0),o.position.copy(this.worldPosition);let l;if(this.camera.isOrthographicCamera?l=(this.camera.top-this.camera.bottom)/this.camera.zoom:l=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),o.scale.set(1,1,1).multiplyScalar(l*this.size/4),o.tag==="helper"){o.visible=!1,o.name==="AXIS"?(o.position.copy(this.worldPositionStart),o.visible=!!this.axis,this.axis==="X"&&(Zi.setFromEuler(f_.set(0,0,0)),o.quaternion.copy(n).multiply(Zi),Math.abs(Ni.copy(ym).applyQuaternion(n).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="Y"&&(Zi.setFromEuler(f_.set(0,0,Math.PI/2)),o.quaternion.copy(n).multiply(Zi),Math.abs(Ni.copy(su).applyQuaternion(n).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="Z"&&(Zi.setFromEuler(f_.set(0,Math.PI/2,0)),o.quaternion.copy(n).multiply(Zi),Math.abs(Ni.copy(vm).applyQuaternion(n).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="XYZE"&&(Zi.setFromEuler(f_.set(0,Math.PI/2,0)),Ni.copy(this.rotationAxis),o.quaternion.setFromRotationMatrix(rB.lookAt(sB,Ni,su)),o.quaternion.multiply(Zi),o.visible=this.dragging),this.axis==="E"&&(o.visible=!1)):o.name==="START"?(o.position.copy(this.worldPositionStart),o.visible=this.dragging):o.name==="END"?(o.position.copy(this.worldPosition),o.visible=this.dragging):o.name==="DELTA"?(o.position.copy(this.worldPositionStart),o.quaternion.copy(this.worldQuaternionStart),Or.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),Or.applyQuaternion(this.worldQuaternionStart.clone().invert()),o.scale.copy(Or),o.visible=this.dragging):(o.quaternion.copy(n),this.dragging?o.position.copy(this.worldPositionStart):o.position.copy(this.worldPosition),this.axis&&(o.visible=this.axis.search(o.name)!==-1));continue}o.quaternion.copy(n),this.mode==="translate"||this.mode==="scale"?(o.name==="X"&&Math.abs(Ni.copy(ym).applyQuaternion(n).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="Y"&&Math.abs(Ni.copy(su).applyQuaternion(n).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="Z"&&Math.abs(Ni.copy(vm).applyQuaternion(n).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="XY"&&Math.abs(Ni.copy(vm).applyQuaternion(n).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="YZ"&&Math.abs(Ni.copy(ym).applyQuaternion(n).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="XZ"&&Math.abs(Ni.copy(su).applyQuaternion(n).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1)):this.mode==="rotate"&&(p_.copy(n),Ni.copy(this.eye).applyQuaternion(Zi.copy(n).invert()),o.name.search("E")!==-1&&o.quaternion.setFromRotationMatrix(rB.lookAt(this.eye,sB,su)),o.name==="X"&&(Zi.setFromAxisAngle(ym,Math.atan2(-Ni.y,Ni.z)),Zi.multiplyQuaternions(p_,Zi),o.quaternion.copy(Zi)),o.name==="Y"&&(Zi.setFromAxisAngle(su,Math.atan2(Ni.x,Ni.z)),Zi.multiplyQuaternions(p_,Zi),o.quaternion.copy(Zi)),o.name==="Z"&&(Zi.setFromAxisAngle(vm,Math.atan2(Ni.y,Ni.x)),Zi.multiplyQuaternions(p_,Zi),o.quaternion.copy(Zi))),o.visible=o.visible&&(o.name.indexOf("X")===-1||this.showX),o.visible=o.visible&&(o.name.indexOf("Y")===-1||this.showY),o.visible=o.visible&&(o.name.indexOf("Z")===-1||this.showZ),o.visible=o.visible&&(o.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),o.material._color=o.material._color||o.material.color.clone(),o.material._opacity=o.material._opacity||o.material.opacity,o.material.color.copy(o.material._color),o.material.opacity=o.material._opacity,this.enabled&&this.axis&&(o.name===this.axis||this.axis.split("").some(function(h){return o.name===h}))&&(o.material.color.setHex(16776960),o.material.opacity=1)}super.updateMatrixWorld(e)}}class X$ extends _t{constructor(){super(new lo(1e5,1e5,2,2),new Hi({visible:!1,wireframe:!0,side:er,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let t=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(t="local"),m_.copy(ym).applyQuaternion(t==="local"?this.worldQuaternion:L_),lm.copy(su).applyQuaternion(t==="local"?this.worldQuaternion:L_),hm.copy(vm).applyQuaternion(t==="local"?this.worldQuaternion:L_),Ni.copy(lm),this.mode){case"translate":case"scale":switch(this.axis){case"X":Ni.copy(this.eye).cross(m_),Ca.copy(m_).cross(Ni);break;case"Y":Ni.copy(this.eye).cross(lm),Ca.copy(lm).cross(Ni);break;case"Z":Ni.copy(this.eye).cross(hm),Ca.copy(hm).cross(Ni);break;case"XY":Ca.copy(hm);break;case"YZ":Ca.copy(m_);break;case"XZ":Ni.copy(hm),Ca.copy(lm);break;case"XYZ":case"E":Ca.set(0,0,0);break}break;case"rotate":default:Ca.set(0,0,0)}Ca.length()===0?this.quaternion.copy(this.cameraQuaternion):(oB.lookAt(Or.set(0,0,0),Ca,Ni),this.quaternion.setFromRotationMatrix(oB)),super.updateMatrixWorld(e)}}var Y$=Object.defineProperty,J$=Object.getOwnPropertyDescriptor,Z$=(a,e,t,n)=>{for(var i=n>1?void 0:n?J$(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&Y$(e,t,i),i};class XS extends Bt{constructor(){super(...arguments);E(this,"isGizmo",!0);E(this,"control");E(this,"orbit");E(this,"changeEventListener");E(this,"windowKeyDownListener");E(this,"windowKeyUpListener")}awake(){this.isGizmo&&!Fg||!this.context.mainCamera||(this.control=new G$(this.context.mainCamera,this.context.renderer.domElement),this.control.visible=!0,this.control.enabled=!0,this.control.getRaycaster().layers.set(2),this.control.size=.6,this.control.traverse(t=>{const n=t;if(n.layers.set(2),n){const i=n.material;i&&(i.opacity=.3)}}))}start(){var t;if(this.context.mainCamera){const n=(t=Te.getComponentInParent(this.context.mainCamera,ND))!=null?t:void 0;this.orbit=n}}onEnable(){var t;this.control&&(this.context.scene.add(this.control),this.control.attach(this.gameObject)),this.changeEventListener=this.onControlChangedEvent.bind(this),(t=this.control)==null||t.addEventListener("dragging-changed",this.changeEventListener),this.attachWindowEvents()}onDisable(){var t,n;(t=this.control)==null||t.removeFromParent(),this.changeEventListener&&((n=this.control)==null||n.removeEventListener("dragging-changed",this.changeEventListener))}onControlChangedEvent(t){const n=this.orbit;if(n&&(n.enabled=!t.value),t.value){const i=Te.getComponentInParent(this.gameObject,$l);i&&i.requestOwnership()}}attachWindowEvents(){const t=this.control;!t||(this.windowKeyDownListener||(this.windowKeyDownListener=n=>{switch(n.keyCode){case 81:t.setSpace(t.space==="local"?"world":"local");break;case 16:t.setTranslationSnap(100),t.setRotationSnap(Tu.degToRad(15)),t.setScaleSnap(.25);break;case 87:t.setMode("translate");break;case 69:t.setMode("rotate");break;case 82:t.setMode("scale");break;case 187:case 107:t.setSize(t.size+.1);break;case 189:case 109:t.setSize(Math.max(t.size-.1,.1));break;case 88:t.showX=!t.showX;break;case 89:t.showY=!t.showY;break;case 90:t.showZ=!t.showZ;break;case 32:t.enabled=!t.enabled;break}}),this.windowKeyUpListener||(this.windowKeyUpListener=n=>{switch(n.keyCode){case 16:t.setTranslationSnap(null),t.setRotationSnap(null),t.setScaleSnap(null);break}}),window.addEventListener("keydown",this.windowKeyDownListener),window.addEventListener("keyup",this.windowKeyUpListener))}}Z$([Re()],XS.prototype,"isGizmo",2);var K$=Object.defineProperty,$$=Object.getOwnPropertyDescriptor,d3=(a,e,t,n)=>{for(var i=n>1?void 0:n?$$(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&K$(e,t,i),i};class f3{constructor(){E(this,"overrideState",!1);E(this,"value",0)}}class Kf{constructor(){E(this,"active",!1);E(this,"parameters")}}class _v extends Kf{constructor(){super(...arguments);E(this,"mode")}get isToneMapping(){return!0}}class yv extends Kf{constructor(){super(...arguments);E(this,"postExposure")}}function eee(a){return"mode"in a?_v:"postExposure"in a?yv:Kf}class vv{constructor(){E(this,"components")}apply(e){var t,n,i,r,o;if(!!this.components){for(const l of this.components)if(l instanceof _v){const h=l;if(!l.active){e.renderer.toneMapping=V_;continue}switch((n=(t=h.mode)==null?void 0:t.value)!=null?n:0){case 0:e.renderer.toneMapping=V_;break;case 1:e.renderer.toneMapping=eC;break;case 2:e.renderer.toneMapping=tC;break}}else if(l instanceof yv){const h=l;console.log(h.postExposure);const u=Math.pow(2,(r=(i=h.postExposure)==null?void 0:i.value)!=null?r:0);e.renderer.toneMappingExposure=(o=h.postExposure)!=null&&o.overrideState?u:1}}}}d3([Re([a=>eee(a),Kf])],vv.prototype,"components",2);class YS extends Bt{constructor(){super(...arguments);E(this,"sharedProfile")}onEnable(){var t;(t=this.sharedProfile)==null||t.apply(this.context)}}d3([Re(vv)],YS.prototype,"sharedProfile",2);class JS{constructor(){E(this,"guid");E(this,"dontSave",!0);E(this,"userId");E(this,"point",{x:0,y:0,z:0});E(this,"source",{x:0,y:0,z:0});E(this,"target")}update(e,t,n,i=void 0){this.userId=e.connection.connectionId,this.point.x=t.x,this.point.y=t.y,this.point.z=t.z,this.source.x=n.x,this.source.y=n.y,this.source.z=n.z,this.target=i}}class p3 extends Bt{constructor(){super(...arguments);E(this,"prefab",null);E(this,"_grabModels",[]);E(this,"_grabModelsUpdateTime",[]);E(this,"_addOrUpdateSub",null);E(this,"_endSub",null);E(this,"_freeSub",null);E(this,"_instances",{});E(this,"temp",new q)}awake(){this.prefab&&(this.prefab.visible=!1)}onEnable(){this._addOrUpdateSub=this.context.connection.beginListen("xr-grab-visual-start-or-update",this.onRemoteGrabStartOrUpdate.bind(this)),this._endSub=this.context.connection.beginListen("xr-grab-visual-end",this.onRemoteGrabEnd.bind(this)),this._freeSub=oa.AddEventListener(RE.WillFree,this.onAttachedObjectFree.bind(this))}onDisable(){this.context.connection.stopListening("xr-grab-visual-start-or-update",this._addOrUpdateSub),this.context.connection.stopListening("xr-grab-visual-end",this._endSub),oa.RemoveEventListener(RE.WillFree,this._freeSub)}addOrUpdateGrab(t){this.context.connection.send("xr-grab-visual-start-or-update",t,ny.Queued)}endGrab(t){this.context.connection.send("xr-grab-visual-end",t,ny.Queued)}onRemoteGrabStartOrUpdate(t){if(!this.prefab)return;const n=this._instances[t.guid];if(!n){const i=Te.instantiate(this.prefab);if(i.visible=!0,this._instances[t.guid]={instance:i,model:t},t.userId){const r=Te.getComponentsInChildren(i,eh);if((r==null?void 0:r.length)>0)for(const o of r)o.assignUserColor(t.userId)}return}n.model=t}onRemoteGrabEnd(t){if(!t)return;const n=t.guid;this._instances[n]&&(Te.destroy(this._instances[n].instance),delete this._instances[n])}onAttachedObjectFree(t){if(this._grabModels.length<=0)return;const n=this._grabModels[0];this.updateModel(n,t),this.endGrab(n)}onBeforeRender(){if(this.updateRendering(),!!this.prefab&&(this.prefab.visible=!1,this.context.time.frameCount%10===0))for(let t=0;t<oa.Current.length;t++){const n=oa.Current[t];if(!n.controller||!n.selected)continue;this._grabModels.length<=t&&(this._grabModels.push(new JS),this._grabModelsUpdateTime.push(0)),this._grabModelsUpdateTime[t]=this.context.time.time;const i=this._grabModels[t];this.updateModel(i,n),this.addOrUpdateGrab(i)}}updateModel(t,n){if(!n.controller||!n.selected)return;t.guid=n.grabUUID;const i=n.selected.guid;t.update(this.context,n.grabPoint,n.controller.worldPosition,i)}updateRendering(){const t=this.context.time.deltaTime/.5;for(const n in this._instances){const{instance:i,model:r}=this._instances[n];if(!i||!r)continue;const{point:o}=r,l=ti(i);this.temp.set(o.x,o.y,o.z),l.lerp(this.temp,t),ys(i,l)}}}var tee=Object.defineProperty,nee=Object.getOwnPropertyDescriptor,xv=(a,e,t,n)=>{for(var i=n>1?void 0:n?nee(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&tee(e,t,i),i};class $f extends Bt{constructor(){super(...arguments);E(this,"eyes",[]);E(this,"lastBlinkTime",0);E(this,"blinkLength",0);E(this,"eyesOpen",!0);E(this,"state",null)}awake(){this.state=Te.getComponentInParent(this.gameObject,ur)}update(){if(!this.gameObject||!this.gameObject.visible||!this.eyes||!Array.isArray(this.eyes)||this.eyes.length===0)return;if(this.context.time.time-this.lastBlinkTime>this.blinkLength){if(this.lastBlinkTime=this.context.time.time,this.state&&!this.state.isOn||!this.activeAndEnabled)return;if(this.eyesOpen=!this.eyesOpen,this.blinkLength=Math.random(),this.eyesOpen?(this.blinkLength*=3,this.blinkLength+=.5,Math.random()<.1&&(this.blinkLength=.1+Math.random()*.2)):(this.blinkLength*=Math.random()*.2,this.blinkLength+=.1),Math.random()<.1&&(this.blinkLength*=3),this.blinkLength=Math.max(.2,this.blinkLength),this.blinkLength=Math.min(3,this.blinkLength),this.eyes)for(const n of this.eyes)n&&(n.visible=this.eyesOpen)}}}xv([Re(qt)],$f.prototype,"eyes",2);xv([Re()],$f.prototype,"lastBlinkTime",2);xv([Re()],$f.prototype,"blinkLength",2);xv([Re()],$f.prototype,"eyesOpen",2);var iee=Object.defineProperty,see=Object.getOwnPropertyDescriptor,ZS=(a,e,t,n)=>{for(var i=n>1?void 0:n?see(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&iee(e,t,i),i},Db;const m3=(Db=class extends Bt{constructor(){super(...arguments);E(this,"head",null);E(this,"eyes",null);E(this,"target",null);E(this,"brain",null);E(this,"vec",new q);E(this,"currentTargetPoint",new q)}awake(){this.brain||(this.brain=Te.getComponentInParent(this.gameObject,ay)),this.brain||(console.log("No look at brain found, adding it now"),this.brain=Te.addNewComponent(this.gameObject,ay)),this.brain&&this.target&&(this.brain.controlledTarget=this.target)}update(){const e=this.target;if(e&&this.head){const t=this.eyes;if(t){const n=ti(e);this.currentTargetPoint.lerp(n,this.context.time.deltaTime/.1);const i=ti(this.head),r=this.vec.copy(this.currentTargetPoint).sub(i).normalize();if(r.length()<.1)return;const o=m3.forward;if(o.set(0,0,1),o.applyQuaternion(uo(this.head)),o.dot(r)>.45)for(let h=0;h<t.length;h++)t[h].lookAt(this.currentTargetPoint)}}}},E(Db,"forward",new q(0,0,1)),Db);let Kg=m3;ZS([Re(qt)],Kg.prototype,"head",2);ZS([Re(qt)],Kg.prototype,"eyes",2);ZS([Re(qt)],Kg.prototype,"target",2);var ree=Object.defineProperty,oee=Object.getOwnPropertyDescriptor,g3=(a,e,t,n)=>{for(var i=n>1?void 0:n?oee(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&ree(e,t,i),i};const aee=jt("debugmouth");class wv extends Bt{constructor(){super(...arguments);E(this,"idle",[]);E(this,"talking",[]);E(this,"marker",null);E(this,"voip",null);E(this,"lastMouthChangeTime",0);E(this,"mouthChangeLength",0)}awake(){setTimeout(()=>{this.voip=Te.findObjectOfType(lh,this.context),this.marker||(this.marker=Te.getComponentInParent(this.gameObject,fr))},3e3)}update(){var i,r,o;if(!this.voip||this.context.time.frameCount%10!==0)return;let t=(r=(i=this.marker)==null?void 0:i.connectionId)!=null?r:null;if(!t){aee&&(t=null);return}const n=(o=this.voip.getFrequency(t))!=null?o:0;this.updateLips(n)}updateLips(t){if(this.context.time.time-this.lastMouthChangeTime>this.mouthChangeLength){if(this.mouthChangeLength=.05+Math.random()*.1,this.talking&&this.talking.length>0&&t>30){this.lastMouthChangeTime=this.context.time.time;const n=Math.floor(Math.random()*this.talking.length);this.setMouthShapeActive(this.talking,n)}else if(this.idle.length>0&&this.context.time.time-this.lastMouthChangeTime>.5){this.lastMouthChangeTime=this.context.time.time;const n=Math.floor(Math.random()*this.idle.length);this.setMouthShapeActive(this.idle,n)}}}setMouthShapeActive(t,n){if(!!t){t!=this.idle?this.idle.map(i=>i.visible=!1):this.talking.map(i=>i.visible=!1);for(let i=0;i<t.length;i++){const r=t[i];r&&(r.visible=i===n)}}}}g3([Re(qt)],wv.prototype,"idle",2);g3([Re(qt)],wv.prototype,"talking",2);class A3 extends Bt{constructor(){super(...arguments);E(this,"voip",null);E(this,"marker",null);E(this,"_startPosition",null)}awake(){this.voip=Te.findObjectOfType(lh,this.context),this.marker=Te.getComponentInParent(this.gameObject,fr)}update(){if(!this.voip||!this.marker||this.context.time.frameCount%10!==0)return;const t=this.marker.connectionId,n=this.voip.getFrequency(t);if(n==null)return;this._startPosition||(this._startPosition=this.gameObject.position.clone());let i=n/100;this.gameObject.position.y=this._startPosition.y+i*.07}}const cee=jt("logstats");class _3 extends Bt{onEnable(){console.log(this),cee&&this.startCoroutine(this.run(),No.OnAfterRender)}*run(){for(;this.enabled;){const e=this.context.renderer.info;console.log(e.memory,e.render,e.programs),yield}}}var lee=Object.defineProperty,hee=Object.getOwnPropertyDescriptor,uee=(a,e,t,n)=>{for(var i=n>1?void 0:n?hee(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&lee(e,t,i),i};class KS{constructor(){E(this,"guid")}}class $S{constructor(){E(this,"signal");E(this,"reaction");E(this,"$serializedTypes",{signal:KS,reaction:ua})}}class bv extends Bt{constructor(){super(...arguments);E(this,"events")}start(){console.log(this)}invoke(t){if(!this.events||!Array.isArray(this.events))return;let n=typeof t=="object"?t.guid:t;for(const i of this.events)if(i.signal.guid===n)try{if(i.reaction){if(!i.reaction.invoke){console.warn("Missing invoke - possibly a serialization error",i,this);continue}}else{console.warn("Missing reaction for signal",i,this);continue}i.reaction.invoke()}catch(r){console.error(r)}}}uee([Re($S)],bv.prototype,"events",2);var Ma=(a=>(a.Activation="ActivationTrack",a.Animation="AnimationTrack",a.Audio="AudioTrack",a.Control="ControlTrack",a.Marker="MarkerTrack",a.Signal="SignalTrack",a))(Ma||{}),D_=(a=>(a[a.None=0]="None",a[a.Hold=1]="Hold",a[a.Loop=2]="Loop",a[a.PingPong=3]="PingPong",a[a.Continue=4]="Continue",a))(D_||{}),y3=(a=>(a.Signal="SignalEmitter",a))(y3||{});const df=jt("debugtimeline");class Ev{constructor(){E(this,"director");E(this,"track")}get muted(){return this.track.muted}set muted(e){var t;e!==this.track.muted&&(this.track.muted=e,(t=this.onMuteChanged)==null||t.call(this))}*forEachClip(e=!1){var t;if(!!((t=this.track)!=null&&t.clips))if(e)for(let n=this.track.clips.length-1;n>=0;n--)yield this.track.clips[n];else for(const n of this.track.clips)yield n}getClipTime(e,t){return t.clipIn+(e-t.start)*t.timeScale}getClipTimeNormalized(e,t){return(e-t.start)/t.duration}evaluateWeight(e,t,n,i=!0){if(t<0||t>=n.length)return 0;const r=n[t];if(i||e>=r.start&&e<=r.end){let o=1,l=!1;return r.easeInDuration>0&&(o*=Math.min((e-r.start)/r.easeInDuration,1)),r.easeOutDuration>0&&!l&&(o*=Math.min((r.end-e)/r.easeOutDuration,1)),o}return 0}}class dee{constructor(e){E(this,"clip");E(this,"rootPositionOffset");E(this,"rootQuaternionOffset");E(this,"rootStartPosition");E(this,"rootEndPosition");E(this,"rootStartQuaternion");E(this,"rootEndQuaternion");const t=e.getClip();this.clip=t;const n=e.getRoot(),i=n.name+".position",r=n.name+".quaternion";df&&console.log(t.name,t.tracks,i);for(const o of t.tracks)if(!(o.times.length<=0)){if(o.name.endsWith(i))this.rootStartPosition=new q().fromArray(o.values,0),this.rootEndPosition=new q().fromArray(o.values,o.values.length-3),this.rootPositionOffset=this.rootEndPosition.clone().sub(this.rootStartPosition),df&&console.log(this.rootPositionOffset);else if(o.name.endsWith(r)&&(this.rootStartQuaternion=new Ot().fromArray(o.values,0),this.rootEndQuaternion=new Ot().fromArray(o.values,o.values.length-4),this.rootQuaternionOffset=this.rootEndQuaternion.clone().multiply(this.rootStartQuaternion),df)){const l=new vs().setFromQuaternion(this.rootQuaternionOffset);console.log("ROT",l)}}}get hasOffsets(){return this.rootPositionOffset!==void 0||this.rootQuaternionOffset!==void 0}}class eM extends Ev{constructor(){super(...arguments);E(this,"models",[]);E(this,"trackOffset");E(this,"target");E(this,"mixer");E(this,"clips",[]);E(this,"actions",[]);E(this,"_actionOffsets",[]);E(this,"_didBind",!1);E(this,"_useclipOffsets",!0);E(this,"_totalOffsetPosition",new q);E(this,"_totalOffsetRotation",new Ot);E(this,"_totalOffsetPosition2",new q);E(this,"_totalOffsetRotation2",new Ot);E(this,"_summedPos",new q);E(this,"_tempPos",new q);E(this,"_summedRot",new Ot);E(this,"_tempRot",new Ot)}createHooks(t,n){var f,g;if(((f=n.tracks)==null?void 0:f.length)<=0){console.warn("No tracks in AnimationClip",n);return}const i=n.tracks[0].name.split("."),r=i[i.length-2],o=r+".position",l=r+".quaternion";let h=!1,u=!1;for(const m of n.tracks)m.name.endsWith(o)?(h=!0,this.createPositionInterpolant(n,t,m)):m.name.endsWith(l)&&(u=!0,this.createRotationInterpolant(n,t,m));if(!h||!u){const m=(g=this.mixer)==null?void 0:g.getRoot(),A=n.tracks[0],v=A.name.lastIndexOf("."),w=A.name.substring(0,v),b=w.substring(w.lastIndexOf(".")+1),S=m.getObjectByName(b);if(S)if(h){if(!u){const R=n.tracks[0].name.substring(0,v)+".quaternion";df&&console.warn("Create quaternion track",b,S);const M=S.quaternion,I=new ja(R,[0,n.duration],[M.x,M.y,M.z,M.w,M.x,M.y,M.z,M.w]);n.tracks.push(I),this.createRotationInterpolant(n,t,I)}}else{const R=w+".position";df&&console.warn("Create position track",b,S);const M=S.position,I=new Zl(R,[0,n.duration],[M.x,M.y,M.z,M.x,M.y,M.z]);n.tracks.push(I),this.createPositionInterpolant(n,t,I)}}}bind(){if(!this._didBind){this._didBind=!0,df&&console.log(this.models),this.mixer?this.target=this.mixer.getRoot():console.warn("No mixer was assigned to animation track");for(const t of this.actions){const n=new dee(t);this._actionOffsets.push(n)}for(const t of this.models){const n=t.asset,i=n.position,r=n.rotation;i.x!==void 0&&(i.isVector3||(n.position=new q(i.x,i.y,i.z)),r.isQuaternion||(n.rotation=new Ot(r.x,r.y,r.z,r.w)))}this.ensureTrackOffsets()}}ensureTrackOffsets(){if(this.trackOffset){const t=this.trackOffset.position;t&&(t.isVector3||(this.trackOffset.position=new q(t.x,t.y,t.z)));const n=this.trackOffset.rotation;n&&(n.isQuaternion||(this.trackOffset.rotation=new Ot(n.x,n.y,n.z,n.w)))}}evaluate(t){if(this.track.muted||!this.mixer)return;this.bind(),this._totalOffsetPosition.set(0,0,0),this._totalOffsetRotation.set(0,0,0,1),this._totalOffsetPosition2.set(0,0,0),this._totalOffsetRotation2.set(0,0,0,1);let n=0,i=0,r=!1;for(let o=0;o<this.clips.length;o++){const l=this.models[o],h=this.actions[o],u=l.asset;h.weight=0;const f=t>=l.start&&t<=l.end,g=l.postExtrapolationMode;let m=f;if(!m&&!r&&l.end<t&&l.postExtrapolationMode!==D_.None){const A=o<this.clips.length-1?this.models[o+1]:null;(!A||A.start>t)&&(m=!0,r=!0)}if(m){let A=1;A*=this.evaluateWeight(t,o,this.models,m);let v=this.getClipTime(t,l),w=0;const b=u.duration;if(f){if(u.loop)for(w+=Math.floor(v/(b+1e-6));v>b;)v-=b}else if(!f)switch(g){case D_.Loop:v%=b;break;case D_.PingPong:const M=Math.floor(v/b)%2!==0;v%=b,M&&(v=b-v);break}h.time=v,h.timeScale=0;const S=A*this.director.weight;if(h.weight=S,h.clampWhenFinished=!0,h.isRunning()||h.play(),this._useclipOffsets){const R=n==0?this._totalOffsetPosition:this._totalOffsetPosition2,M=n==0?this._totalOffsetRotation:this._totalOffsetRotation2;n<1&&(i=1-A),n+=1;const I=this._summedPos.set(0,0,0),T=this._tempPos.set(0,0,0),B=this._summedRot.identity(),F=this._tempRot.identity(),D=u.rotation,U=new Ot;U.slerp(D,A);const W=this._actionOffsets[o];if(W.hasOffsets)for(let J=0;J<w;J++)W.rootPositionOffset?T.copy(W.rootPositionOffset):T.set(0,0,0),T.applyQuaternion(B).applyQuaternion(U),W.rootQuaternionOffset&&(F.copy(W.rootQuaternionOffset),B.multiply(F)),I.add(T);M.multiply(U),M.multiply(B),I.add(u.position),R.add(I)}}}this._useclipOffsets&&(this._totalOffsetPosition.lerp(this._totalOffsetPosition2,i),this._totalOffsetRotation.slerp(this._totalOffsetRotation2,i)),this.mixer.update(t)}createRotationInterpolant(t,n,i){var h;const r=i.createInterpolant.bind(i),o=new Ot;this.ensureTrackOffsets();const l=(h=this.trackOffset)==null?void 0:h.rotation;i.createInterpolant=()=>{const u=r(),f=u.evaluate.bind(u);return u.evaluate=g=>{const m=f(g);return o.set(m[0],m[1],m[2],m[3]),o.premultiply(this._totalOffsetRotation),l&&o.premultiply(l),m[0]=o.x,m[1]=o.y,m[2]=o.z,m[3]=o.w,m},u}}createPositionInterpolant(t,n,i){var f,g;const r=i.createInterpolant.bind(i),o=new q;this.ensureTrackOffsets();const l=(f=this.trackOffset)==null?void 0:f.rotation,h=(g=this.trackOffset)==null?void 0:g.position;let u;i.createInterpolant=()=>{const m=r(),A=m.evaluate.bind(m);return m.evaluate=v=>{var b,S;const w=A(v);return o.set(w[0],w[1],w[2]),n.removeStartOffset&&(u===void 0?(u=null,u=(S=(b=this._actionOffsets.find(R=>R.clip===t))==null?void 0:b.rootStartPosition)==null?void 0:S.clone()):u!=null&&u.isVector3&&o.sub(u)),o.applyQuaternion(this._totalOffsetRotation),o.add(this._totalOffsetPosition),l&&o.applyQuaternion(l),h&&(o.x-=h.x,o.y+=h.y,o.z+=h.z),w[0]=o.x,w[1]=o.y,w[2]=o.z,w},m}}}class tM extends Ev{constructor(){super(...arguments);E(this,"models",[]);E(this,"listener");E(this,"audio",[]);E(this,"audioContextTimeOffset",[]);E(this,"lastTime",0)}getAudioFilePath(t){const n=this.director.sourceId;return v2(n,t)}onAllowAudioChanged(t){for(let n=0;n<this.models.length;n++){const i=this.models[n];this.audio[n].setVolume(t?i.asset.volume:0)}}addModel(t){const n=this.getAudioFilePath(t.asset.clip),i=new Vy(this.listener);i.setVolume(t.asset.volume);const r=new K_;console.log(n,this.director.sourceId),r.load(n,o=>{i.setBuffer(o),i.loop=t.asset.loop,this.audio.push(i),this.models.push(t)})}onDisable(){for(const t of this.audio)t.isPlaying&&t.stop()}onMuteChanged(){if(this.muted)for(let t=0;t<this.audio.length;t++){const n=this.audio[t];n!=null&&n.isPlaying&&n.stop()}}evaluate(t){if(!this.track.muted){for(let n=0;n<this.models.length;n++){const i=this.models[n],r=this.audio[n];if(t>=i.start&&t<=i.end){if(this.director.isPaused&&(r.isPlaying&&r.stop(),this.lastTime===t))continue;r.isPlaying||(r.offset=i.clipIn+(t-i.start)*i.timeScale,r.play());let o=i.asset.volume;i.easeInDuration>0&&(o*=Math.min((t-i.start)/i.easeInDuration,1)),i.easeOutDuration>0&&(o*=Math.min((i.end-t)/i.easeOutDuration,1)),r.setVolume(o*this.director.weight)}else r.isPlaying&&r.stop()}this.lastTime=t}}}class Ay extends Ev{constructor(){super(...arguments);E(this,"models",[]);E(this,"didTrigger",[]);E(this,"receivers",[])}evaluate(t){if(!(this.receivers.length<=0)&&!this.track.muted)for(let n=0;n<this.models.length;n++){const i=this.models[n],r=this.didTrigger[n],o=i.time-t;if(i.retroActive?o<0:o<0&&Math.abs(o)<.1){if(!r){this.didTrigger[n]=!0;for(const h of this.receivers)!h||h.invoke(i.asset)}}else i.emitOnce||(this.didTrigger[n]=!1)}}}const Hm=class extends Ev{constructor(){super(...arguments);E(this,"models",[]);E(this,"timelines",[]);E(this,"_previousActiveModel",null)}resolveSourceObjects(t){for(let n=this.models.length-1;n>=0;n--){const r=this.models[n].asset;if(typeof r.sourceObject=="string"){const o=r.sourceObject;Hm.resolved[o]?r.sourceObject=Hm.resolved[o]:(r.sourceObject=Te.findByGuid(o,t.scene),Hm.resolved[o]=r.sourceObject)}if(r.sourceObject){const o=Te.getComponent(r.sourceObject,pf);this.timelines.push(o),o&&r.updateDirector&&(o.playOnAwake=!1)}else{this.models.splice(n,1);continue}}}evaluate(t){var n;this._previousActiveModel=null;for(let i=0;i<this.models.length;i++){const r=this.models[i],o=r.asset;if(t>=r.start&&t<=r.end){this._previousActiveModel=r;const l=this.getClipTime(t,r);if(o.controlActivation){const h=o.sourceObject;h.visible=!0}if(o.updateDirector){const h=this.timelines[i];h&&(h.isPlaying&&h.pause(),h.time=l,h.evaluate())}}else{const l=(n=this._previousActiveModel)==null?void 0:n.asset;if(o.controlActivation){const h=o.sourceObject;(l==null?void 0:l.sourceObject)!==h&&(h.visible=!1)}}}}};let ff=Hm;E(ff,"resolved",{});const aB=jt("debugtimeline"),wy=class extends Bt{constructor(){super(...arguments);E(this,"playableAsset");E(this,"playOnAwake");E(this,"extrapolationMode",1);E(this,"_visibilityChangeEvt");E(this,"_clonedPlayableAsset",!1);E(this,"_guidsMap");E(this,"_isPlaying",!1);E(this,"_internalUpdateRoutine");E(this,"_isPaused",!1);E(this,"_time",0);E(this,"_duration",0);E(this,"_weight",1);E(this,"_animationTracks",[]);E(this,"_audioTracks",[]);E(this,"_signalTracks",[]);E(this,"_controlTracks",[]);E(this,"_customTracks",[]);E(this,"_allTracks",[this._animationTracks,this._audioTracks,this._signalTracks,this._controlTracks,this._customTracks])}static registerCreateTrack(t,n){this.createTrackFunctions[t]=n}get isPlaying(){return this._isPlaying}get isPaused(){return this._isPaused}get time(){return this._time}set time(t){this._time=t}get duration(){return this._duration}set duration(t){this._duration=t}get weight(){return this._weight}set weight(t){this._weight=t}awake(){var t,n,i;aB&&console.log(this,(t=this.playableAsset)==null?void 0:t.tracks),this.rebuildGraph(),this.playOnAwake?this.play():this.evaluate(),this.isValid()||console.warn("PlayableDirector is not valid",this.playableAsset,(n=this.playableAsset)==null?void 0:n.tracks,Array.isArray((i=this.playableAsset)==null?void 0:i.tracks),this)}onEnable(){var t,n;for(const i of this._audioTracks)(t=i.onEnable)==null||t.call(i);for(const i of this._customTracks)(n=i.onEnable)==null||n.call(i);this.playOnAwake&&this.play(),this._visibilityChangeEvt||(this._visibilityChangeEvt=()=>{switch(document.visibilityState){case"hidden":this.setAudioTracksAllowPlaying(!1);break;case"visible":this.setAudioTracksAllowPlaying(!0);break}}),window.addEventListener("visibilitychange",this._visibilityChangeEvt)}onDisable(){var t,n;this.stop();for(const i of this._audioTracks)(t=i.onDisable)==null||t.call(i);for(const i of this._customTracks)(n=i.onDisable)==null||n.call(i);this._visibilityChangeEvt&&window.removeEventListener("visibilitychange",this._visibilityChangeEvt)}onDestroy(){var t;for(const n of this._audioTracks)(t=n.onDestroy)==null||t.call(n)}rebuildGraph(){!this.isValid()||(this.resolveBindings(),this.updateTimelineDuration(),this.setupAndCreateTrackHandlers())}play(){!this.isValid()||(this._isPaused=!1,!this._isPlaying&&(this._isPlaying=!0,this._internalUpdateRoutine=this.startCoroutine(this.internalUpdate())))}pause(){this._isPaused=!0}stop(){this._isPlaying&&(this._time=0,this._isPlaying=!1,this._isPaused=!1,this.evaluate()),this._isPlaying=!1,this._isPaused=!1,this._internalUpdateRoutine&&this.stopCoroutine(this._internalUpdateRoutine),this._internalUpdateRoutine=null}evaluate(){if(!this.isValid())return;let t=this._time;switch(this.extrapolationMode){case 0:t=Math.min(t,this._duration);break;case 1:t%=this._duration;break;case 2:if(t>this._duration){this.stop();return}break}this.internalEvaluate(t)}isValid(){return this.playableAsset&&this.playableAsset.tracks&&Array.isArray(this.playableAsset.tracks)}*forEachTrack(){for(const t of this._allTracks)for(const n of t)yield n}get audioTracks(){return this._audioTracks}resolveGuids(t){this._guidsMap=t}*internalUpdate(){for(;this._isPlaying;)!this._isPaused&&this._isPlaying&&(this._time+=this.context.time.deltaTime,this.evaluate()),yield}internalEvaluate(t){for(const n of this.playableAsset.tracks)if(!n.muted)switch(n.type){case Ma.Activation:for(let i=0;i<n.outputs.length;i++){const r=n.outputs[i];if(typeof r=="object"){let o=!1;for(const h of n.clips)h.start<=t&&t<=h.end&&(o=!0);const l=r;l.visible!==void 0&&(l.visible=o)}}break}for(const n of this._animationTracks)n.evaluate(t);for(const n of this._audioTracks)n.evaluate(t);for(const n of this._signalTracks)n.evaluate(t);for(const n of this._controlTracks)n.evaluate(t);for(const n of this._customTracks)n.evaluate(t)}resolveBindings(){if(this._clonedPlayableAsset||(this._clonedPlayableAsset=!0,this.playableAsset=qC(this.playableAsset)),!this.playableAsset||!this.playableAsset.tracks)return;const t=this.findRoot(this.gameObject);for(const n of this.playableAsset.tracks)for(let i=n.outputs.length-1;i>=0;i--){let r=n.outputs[i];if(typeof r=="string"){this._guidsMap&&this._guidsMap[r]&&(r=this._guidsMap[r]);const o=Te.findByGuid(r,t);o===null||typeof o!="object"?(n.outputs.splice(i,1),console.warn("Failed to resolve binding",r,n.name,n.type)):(aB&&console.log("Resolved binding",r,"to",o),n.outputs[i]=o)}else if(r===null){if(n.outputs.splice(i,1),wy.createTrackFunctions[n.type])continue;n.type!==Ma.Audio&&n.type!==Ma.Control&&n.type!==Ma.Marker&&console.warn("Missing binding",r,n.name,n.type,this.name,this.playableAsset.name)}}}findRoot(t){return t.parent?this.findRoot(t.parent):t}updateTimelineDuration(){if(this._duration=0,!(!this.playableAsset||!this.playableAsset.tracks)){for(const t of this.playableAsset.tracks)if(t.muted!==!0)for(const n of t.clips)n.end>this._duration&&(this._duration=n.end)}}setupAndCreateTrackHandlers(){var n,i;if(this._animationTracks.length=0,this._audioTracks.length=0,this._signalTracks.length=0,!this.playableAsset)return;const t=[];for(const r of this.playableAsset.tracks){const o=r.type,l=wy.createTrackFunctions[o];if(l!=null){const h=l(this,r);if(typeof h.evaluate=="function"){h.director=this,h.track=r,this._customTracks.push(h);continue}}if(r.type===Ma.Animation){if(r.clips.length<=0)continue;for(let h=r.outputs.length-1;h>=0;h--){const u=r.outputs[h];typeof u.enabled=="boolean"&&(u.enabled=!1);const f=(n=u==null?void 0:u.gameObject)==null?void 0:n.animations;if(f){const g=new eM;g.trackOffset=r.trackOffset,g.director=this,g.track=r;for(let m=0;m<r.clips.length;m++){const A=r.clips[m],v=A.asset;if(!v){console.error("MISSING anim model?","clip#"+m,A,r,this.playableAsset,this.name);continue}const w=v.clip;let b=w;if((typeof b=="string"||typeof b=="number")&&(b=f.find(R=>R.name===w)),!b){console.warn("Could not find animationClip for model",A,r.name,this.name,(i=this.playableAsset)==null?void 0:i.name);continue}g.mixer||(g.mixer=new Wy(u.gameObject)),g.clips.push(b),g.mixer.uncacheAction(b),g.createHooks(A.asset,b);const S=g.mixer.clipAction(b);g.actions.push(S),g.models.push(A)}this._animationTracks.push(g)}}}else if(r.type===Ma.Audio){if(r.clips.length<=0)continue;t.push(r)}else if(r.type===Ma.Marker){const h=new Ay;h.director=this,h.track=r;for(const u of r.markers)switch(u.type){case y3.Signal:h.models.push(u),h.didTrigger.push(!1);break}if(h!==null&&h.models.length>0){const u=Te.getComponent(this.gameObject,bv);u&&(h.receivers.push(u),this._signalTracks.push(h))}}else if(r.type===Ma.Signal){const h=new Ay;h.director=this,h.track=r;for(const u of r.markers)h.models.push(u),h.didTrigger.push(!1);for(const u of r.outputs)h.receivers.push(u);this._signalTracks.push(h)}else if(r.type===Ma.Control){const h=new ff;h.director=this,h.track=r;for(const u of r.clips)h.models.push(u);h.resolveSourceObjects(this.context),this._controlTracks.push(h)}}Wr.registerWaitForAllowAudio(()=>{const r=Te.findObjectOfType(ig,this.context);if(!!r)for(const o of t){const l=new tM;l.director=this,l.track=o,l.listener=r.listener;for(let h=0;h<o.clips.length;h++){const u=o.clips[h];l.addModel(u)}this._audioTracks.push(l)}})}setAudioTracksAllowPlaying(t){for(const n of this._audioTracks)n.onAllowAudioChanged(t)}};let pf=wy;E(pf,"createTrackFunctions",{});var tr={};tr.d=(a,e)=>{for(var t in e)tr.o(e,t)&&!tr.o(a,t)&&Object.defineProperty(a,t,{enumerable:!0,get:e[t]})};tr.o=(a,e)=>Object.prototype.hasOwnProperty.call(a,e);tr.r=a=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})};var po={};tr.d(po,{g1:()=>Sv,gO:()=>Dm,km:()=>Cv,zV:()=>lg,ol:()=>AM,uM:()=>Mv,N1:()=>H3,xv:()=>gM,PH:()=>Iv,UH:()=>Tv,ZP:()=>Gee,Vx:()=>V3});var Cv={};tr.r(Cv);tr.d(Cv,{COLUMN:()=>Rv,COLUMN_REVERSE:()=>x3,ROW:()=>Lm,ROW_REVERSE:()=>v3,contentDirection:()=>w3});var Sv={};tr.r(Sv);tr.d(Sv,{CENTER:()=>iM,END:()=>sM,START:()=>nM,STRETCH:()=>b3,alignItems:()=>E3,warnAboutDeprecatedAlignItems:()=>C3});var Mv={};tr.r(Mv);tr.d(Mv,{CENTER:()=>oM,END:()=>aM,SPACE_AROUND:()=>cM,SPACE_BETWEEN:()=>lM,SPACE_EVENLY:()=>hM,START:()=>rM,justifyContent:()=>S3});var Tv={};tr.r(Tv);tr.d(Tv,{NORMAL:()=>Pv,NOWRAP:()=>$g,PRE:()=>Bv,PRE_LINE:()=>ep,PRE_WRAP:()=>Lv,WHITE_CHARS:()=>GE,collapseWhitespaceOnInlines:()=>R3,collapseWhitespaceOnString:()=>M3,newlineBreakability:()=>T3,shouldBreak:()=>I3});var Iv={};tr.r(Iv);tr.d(Iv,{CENTER:()=>dM,JUSTIFY:()=>fM,JUSTIFY_CENTER:()=>O3,JUSTIFY_LEFT:()=>D3,JUSTIFY_RIGHT:()=>_y,LEFT:()=>B3,RIGHT:()=>L3,textAlign:()=>F3});var fee=a=>{var e={};return tr.d(e,a),e};const hi=fee({BufferAttribute:()=>Jn,BufferGeometry:()=>Sn,CanvasTexture:()=>bC,Color:()=>_e,FileLoader:()=>Fs,LinearFilter:()=>yi,Mesh:()=>_t,Object3D:()=>qt,Plane:()=>Po,PlaneBufferGeometry:()=>_2,PlaneGeometry:()=>lo,ShaderMaterial:()=>nr,TextureLoader:()=>Pg,Vector2:()=>Xe,Vector3:()=>q}),Lm="row",v3="row-reverse",Rv="column",x3="column-reverse";function w3(a,e,t,n){let i=t,r="getWidth",o="x",l="y";e.indexOf(Rv)===0&&(r="getHeight",o="y",l="x");for(let h=0;h<a.childrenBoxes.length;h++){const u=a.childrenBoxes[h],f=u.id,g=u[r](),m=u.margin||0;i+=m*n,a.childrenPos[f]={[o]:i+g/2*n,[l]:0},i+=n*(g+m)}}const nM="start",iM="center",sM="end",b3="stretch";function E3(a,e){const t=a.getAlignItems();pee.indexOf(t)===-1&&console.warn(`alignItems === '${t}' is not supported`);let n="getWidth",i="x";e.indexOf(Lm)===0&&(n="getHeight",i="y");const r=a[n]()/2-(a.padding||0);a.childrenBoxes.forEach(o=>{let l;switch(t){case sM:case"right":case"bottom":e.indexOf(Lm)===0?l=-r+o[n]()/2+(o.margin||0):l=r-o[n]()/2-(o.margin||0);break;case nM:case"left":case"top":e.indexOf(Lm)===0?l=r-o[n]()/2-(o.margin||0):l=-r+o[n]()/2+(o.margin||0);break}a.childrenPos[o.id][i]=l||0})}function C3(a){mee.indexOf(a)!==-1&&console.warn(`alignItems === '${a}' is deprecated and will be remove in 7.x.x. Fallback are 'start'|'end'`)}const pee=[nM,iM,sM,b3,"top","right","bottom","left"],mee=["top","right","bottom","left"],rM="start",oM="center",aM="end",cM="space-around",lM="space-between",hM="space-evenly";function S3(a,e,t,n){const i=a.getJustifyContent();gee.indexOf(i)===-1&&console.warn(`justifyContent === '${i}' is not supported`);const r=e.indexOf("row")===0?"width":"height",o=a.getChildrenSideSum(r),h=(r==="width"?a.getInnerWidth():a.getInnerHeight())-o,u=t*2-o*Math.sign(t),f=Aee(i,u),g=_ee(a.childrenBoxes,h,i,n),m=e.indexOf("row")===0?"x":"y";a.childrenBoxes.forEach((A,v)=>{a.childrenPos[A.id][m]-=f-g[v]})}const gee=[rM,oM,aM,cM,lM,hM];function Aee(a,e){switch(a){case aM:return e;case oM:return e/2}return 0}function _ee(a,e,t,n){const i=Array(a.length).fill(0);if(e>0)switch(t){case lM:if(a.length>1){const r=e/(a.length-1)*n;i[0]=0;for(let o=1;o<a.length;o++)i[o]=r*o}break;case hM:if(a.length>1){const r=e/(a.length+1)*n;for(let o=0;o<a.length;o++)i[o]=r*(o+1)}break;case cM:if(a.length>1){const r=e/a.length*n,o=r/2;i[0]=o;for(let l=1;l<a.length;l++)i[l]=o+r*l}break}return i}function uM(a){return class extends a{constructor(t){super(t),this.isBoxComponent=!0,this.childrenPos={}}getInnerWidth(){const t=this.getContentDirection();switch(t){case"row":case"row-reverse":return this.width-(this.padding*2||0)||this.getChildrenSideSum("width");case"column":case"column-reverse":return this.getHighestChildSizeOn("width");default:console.error(`Invalid contentDirection : ${t}`);break}}getInnerHeight(){const t=this.getContentDirection();switch(t){case"row":case"row-reverse":return this.getHighestChildSizeOn("height");case"column":case"column-reverse":return this.height-(this.padding*2||0)||this.getChildrenSideSum("height");default:console.error(`Invalid contentDirection : ${t}`);break}}getChildrenSideSum(t){return this.childrenBoxes.reduce((n,i)=>{const r=i.margin*2||0,o=t==="width"?i.getWidth()+r:i.getHeight()+r;return n+o},0)}setPosFromParentRecords(){this.parentUI&&this.parentUI.childrenPos[this.id]&&(this.position.x=this.parentUI.childrenPos[this.id].x,this.position.y=this.parentUI.childrenPos[this.id].y)}computeChildrenPosition(){if(this.children.length>0){const t=this.getContentDirection();let n;switch(t){case Lm:n=-this.getInnerWidth()/2;break;case v3:n=this.getInnerWidth()/2;break;case Rv:n=this.getInnerHeight()/2;break;case x3:n=-this.getInnerHeight()/2;break}const i=-Math.sign(n);w3(this,t,n,i),S3(this,t,n,i),E3(this,t)}}getHighestChildSizeOn(t){return this.childrenBoxes.reduce((n,i)=>{const r=i.margin||0,o=t==="width"?i.getWidth()+r*2:i.getHeight()+r*2;return Math.max(n,o)},0)}getWidth(){return this.parentUI&&this.parentUI.getAlignItems()==="stretch"&&this.parentUI.getContentDirection().indexOf("column")!==-1?this.parentUI.getWidth()-(this.parentUI.padding*2||0):this.width||this.getInnerWidth()+(this.padding*2||0)}getHeight(){return this.parentUI&&this.parentUI.getAlignItems()==="stretch"&&this.parentUI.getContentDirection().indexOf("row")!==-1?this.parentUI.getHeight()-(this.parentUI.padding*2||0):this.height||this.getInnerHeight()+(this.padding*2||0)}}}const GE={"	":"	","\n":`
`,"\r":"\r"," ":" "},Pv="normal",$g="nowrap",Bv="pre",ep="pre-line",Lv="pre-wrap",M3=function(a,e){switch(e){case $g:case Pv:a=a.replace(/\n/g," ");case ep:a=a.replace(/[ ]{2,}/g," ");break}return a},T3=function(a){switch(a){case Bv:case Lv:case ep:return"mandatory"}},I3=function(a,e,t,n){const i=a[e];switch(n.WHITESPACE){case Pv:case ep:case Lv:if(i.lineBreak==="mandatory")return!0;const r=i.kerning?i.kerning:0,o=i.xoffset?i.xoffset:0,l=i.xadvance?i.xadvance:i.width;if(t+l+o+r>n.INNER_WIDTH)return!0;const h=P3(a,e,n);return yee(a[e-1],t,h,n);case Bv:return i.lineBreak==="mandatory";case $g:default:return!1}},R3=function(a,e){const t=a[0],n=a[a.length-1];switch(e){case Lv:t.glyph&&t.glyph===`
`&&a.length>1&&lB([t],a[1]),n.glyph&&n.glyph===`
`&&a.length>1&&cB([n],a[a.length-2]);break;case ep:case $g:case Pv:let i=[],r;for(let o=0;o<a.length;o++){const l=a[o];if(l.glyph&&GE[l.glyph]&&a.length>o){i.push(l),r=a[o+1];continue}break}lB(i,r),i=[],r=null;for(let o=a.length-1;o>0;o--){const l=a[o];if(l.glyph&&GE[l.glyph]&&o>0){i.push(l),r=a[o-1];continue}break}cB(i,r);break;case Bv:break;default:return console.warn(`whiteSpace: '${e}' is not valid`),0}return t.offsetX};function cB(a,e){if(!!e)for(let t=0;t<a.length;t++){const n=a[t];n.width=0,n.height=0,n.offsetX=e.offsetX+e.width}}function lB(a,e){if(!!e)for(let t=0;t<a.length;t++){const n=a[t];n.width=0,n.height=0,n.offsetX=e.offsetX}}function P3(a,e,t,n){if(n=n||0,!a[e])return n;const i=a[e],r=i.kerning?i.kerning:0,o=i.xoffset?i.xoffset:0,l=i.xadvance?i.xadvance:i.width;return i.lineBreak?n+l:P3(a,e+1,t,n+l+t.LETTERSPACING+o+r)}function yee(a,e,t,n){return!a||!a.glyph||e+t<n.INNER_WIDTH?!1:n.BREAKON.indexOf(a.glyph)>-1}const B3="left",L3="right",dM="center",fM="justify",D3="justify-left",_y="justify-right",O3="justify-center";function F3(a,e,t){for(let n=0;n<a.length;n++){const i=a[n],r=vee(i,e,t,n===a.length-1);for(let o=0;o<i.length;o++)i[o].offsetX+=r}if(e.indexOf(fM)===0)for(let n=0;n<a.length;n++){const i=a[n];if(e.indexOf("-")!==-1&&n===a.length-1)return;const r=t-i.width;if(r<=0)return;let o=0;for(let f=1;f<i.length-1;f++)o+=i[f].glyph===" "?1:0;const l=r/o;let h=1;e===_y&&(i.reverse(),h=-1);let u=0;for(let f=1;f<=i.length-1;f++){const g=i[f];g.offsetX+=u*h,u+=g.glyph===" "?l:0}e===_y&&i.reverse()}}const vee=(a,e,t,n)=>{switch(e){case D3:case fM:case B3:return-t/2;case _y:case L3:return-a.width+t/2;case dM:return-a.width/2;case O3:return n?-a.width/2:-t/2;default:console.warn(`textAlign: '${e}' is not valid`)}};function k3(a){return class extends a{computeInlinesPosition(){const t=this.getWidth()-(this.padding*2||0),n=this.getHeight()-(this.padding*2||0),i=this.getJustifyContent(),r=this.getTextAlign(),o=this.getInterLine(),l=this.computeLines();let h=l.reduce((f,g,m,A)=>{const v=g.lineHeight-g.lineBase;return g.forEach(w=>{w.offsetY=f-g.lineHeight+v+A[0].lineHeight}),f-g.lineHeight-o},0)+o;h=Math.abs(h);const u=(()=>{switch(i){case"start":return n/2-l[0].lineHeight;case"end":return h-l[0].lineHeight-n/2+(l[l.length-1].lineHeight-l[l.length-1].lineHeight);case"center":return h/2-l[0].lineHeight;default:console.warn(`justifyContent: '${i}' is not valid`)}})();l.forEach(f=>{f.forEach(g=>{g.offsetY+=u})}),F3(l,r,t),this.lines=l}calculateBestFit(t){if(this.childrenInlines.length!==0)switch(t){case"grow":this.calculateGrowFit();break;case"shrink":this.calculateShrinkFit();break;case"auto":this.calculateAutoFit();break}}calculateGrowFit(){const t=this.getHeight()-(this.padding*2||0);let n=1;const i=.075,r=this.childrenInlines.find(f=>f.isText);let o=1,l=2,h=r._fitFontSize?r._fitFontSize/r.getFontSize():1,u;do if(u=this.calculateHeight(h),u>t){if(h<=o){this.childrenInlines.forEach(f=>{f.isInlineBlock||(f._fitFontSize=f.getFontSize())});break}l=h,h-=(l-o)/2}else{if(Math.abs(t-u)<i)break;Math.abs(h-l)<5e-10&&(l*=2),o=h,h+=(l-o)/2}while(++n<=10)}calculateShrinkFit(){const t=this.getHeight()-(this.padding*2||0);let n=1;const i=.075,r=this.childrenInlines.find(f=>f.isText);let o=0,l=1,h=r._fitFontSize?r._fitFontSize/r.getFontSize():1,u;do if(u=this.calculateHeight(h),u>t)l=h,h-=(l-o)/2;else{if(h>=l){this.childrenInlines.forEach(f=>{f.isInlineBlock||(f._fitFontSize=f.getFontSize())});break}if(Math.abs(t-u)<i)break;o=h,h+=(l-o)/2}while(++n<=10)}calculateAutoFit(){const t=this.getHeight()-(this.padding*2||0);let n=1;const i=.075,r=this.childrenInlines.find(f=>f.isText);let o=0,l=2,h=r._fitFontSize?r._fitFontSize/r.getFontSize():1,u;do if(u=this.calculateHeight(h),u>t)l=h,h-=(l-o)/2;else{if(Math.abs(t-u)<i)break;Math.abs(h-l)<5e-10&&(l*=2),o=h,h+=(l-o)/2}while(++n<=10)}computeLines(){const t=this.getWidth()-(this.padding*2||0),n=[[]];return this.childrenInlines.reduce((i,r)=>{if(!r.inlines)return;const o=r._fitFontSize||r.getFontSize(),l=r.isText?r.getLetterSpacing()*o:0,h=r.getWhiteSpace(),u=r.getBreakOn(),f={WHITESPACE:h,LETTERSPACING:l,BREAKON:u,INNER_WIDTH:t};return r.inlines.reduce((m,A,v,w)=>{const b=A.kerning?A.kerning:0,S=A.xoffset?A.xoffset:0,R=A.xadvance?A.xadvance:A.width;return I3(w,v,m,f)?(n.push([A]),A.offsetX=S,A.width===0?0:R+l):(n[n.length-1].push(A),A.offsetX=m+S+b,m+R+b+l)},i)},0),n.forEach(i=>{if(i.lineHeight=i.reduce((o,l)=>{const h=l.lineHeight!==void 0?l.lineHeight:l.height;return Math.max(o,h)},0),i.lineBase=i.reduce((o,l)=>{const h=l.lineBase!==void 0?l.lineBase:l.height;return Math.max(o,h)},0),i.width=0,i[0]){const o=this.getWhiteSpace(),l=R3(i,o);i.forEach(h=>{h.offsetX-=l}),i.width=this.computeLineWidth(i)}}),n}calculateHeight(t){this.childrenInlines.forEach(o=>{o.isInlineBlock||(o._fitFontSize=o.getFontSize()*t,o.calculateInlines(o._fitFontSize))});const n=this.computeLines(),i=this.getInterLine(),r=n.reduce((o,l)=>o-l.lineHeight-i,0)+i;return Math.abs(r)}computeLineWidth(t){const n=t[0],i=t[t.length-1];return i.offsetX+i.width+n.offsetX}}}const xee=new hi.FileLoader,HE=[],O_={},wee=new hi.TextureLoader,VE=[],F_={},dr={};function bee(a,e){typeof e=="string"?Cee(a,e):(dr[a.id]||(dr[a.id]={component:a}),pM(e),dr[a.id].json=e,a._updateFontFamily(e))}function Eee(a,e){VE.indexOf(e)===-1&&(VE.push(e),wee.load(e,t=>{t.generateMipmaps=!1,t.minFilter=hi.LinearFilter,t.magFilter=hi.LinearFilter,F_[e]=t;for(const n of Object.keys(dr))e===dr[n].textureURL&&dr[n].component._updateFontTexture(t)})),dr[a.id]||(dr[a.id]={component:a}),dr[a.id].textureURL=e,F_[e]&&a._updateFontTexture(F_[e])}function N3(a){const e=dr[a.id];return!e&&a.parentUI?N3(a.parentUI):e}function Cee(a,e){HE.indexOf(e)===-1&&(HE.push(e),xee.load(e,t=>{const n=JSON.parse(t);pM(n),O_[e]=n;for(const i of Object.keys(dr))e===dr[i].jsonURL&&dr[i].component._updateFontFamily(n)})),dr[a.id]||(dr[a.id]={component:a}),dr[a.id].jsonURL=e,O_[e]&&a._updateFontFamily(O_[e])}function pM(a){if(a._kernings)return;const e={};for(let t=0;t<a.kernings.length;t++){const n=a.kernings[t];if(n.amount===0)continue;const i=String.fromCharCode(n.first,n.second);e[i]=n.amount}a._kernings=e}function See(a,e,t){t.generateMipmaps=!1,t.minFilter=hi.LinearFilter,t.magFilter=hi.LinearFilter,HE.push(a),O_[a]=e,pM(e),t&&(VE.push(a),F_[a]=t)}const Mee={setFontFamily:bee,setFontTexture:Eee,getFontOf:N3,addFont:See},lg=Mee;class bu{static requestUpdate(e,t,n,i){e.traverse(r=>{!r.isUI||(this.requestedUpdates[r.id]?(t&&(this.requestedUpdates[r.id].updateParsing=!0),n&&(this.requestedUpdates[r.id].updateLayout=!0),i&&(this.requestedUpdates[r.id].updateInner=!0)):this.requestedUpdates[r.id]={updateParsing:t,updateLayout:n,updateInner:i,needCallback:t||n||i})})}static register(e){this.components.includes(e)||this.components.push(e)}static disposeOf(e){const t=this.components.indexOf(e);t>-1&&this.components.splice(t,1)}static update(){if(Object.keys(this.requestedUpdates).length>0){const e=this.components.filter(t=>!t.parentUI);e.forEach(t=>this.traverseParsing(t)),e.forEach(t=>this.traverseUpdates(t))}}static traverseParsing(e){const t=this.requestedUpdates[e.id];t&&t.updateParsing&&(e.parseParams(),t.updateParsing=!1),e.childrenUIs.forEach(n=>this.traverseParsing(n))}static traverseUpdates(e){const t=this.requestedUpdates[e.id];delete this.requestedUpdates[e.id],t&&t.updateLayout&&(t.updateLayout=!1,e.updateLayout()),t&&t.updateInner&&(t.updateInner=!1,e.updateInner()),e.childrenUIs.forEach(n=>{this.traverseUpdates(n)}),t&&t.needCallback&&e.onAfterUpdate()}}bu.components=[];bu.requestedUpdates={};const lr={container:null,fontFamily:null,fontSize:.05,fontKerning:"normal",bestFit:"none",offset:.01,interLine:.01,breakOn:`- ,.:?!
`,whiteSpace:ep,contentDirection:Rv,alignItems:iM,justifyContent:rM,fontTexture:null,textAlign:dM,textType:"MSDF",fontColor:new hi.Color(16777215),fontOpacity:1,fontPXRange:4,fontSupersampling:!0,borderRadius:.01,borderWidth:0,borderColor:new hi.Color("black"),borderOpacity:1,backgroundSize:"cover",backgroundColor:new hi.Color(2236962),backgroundWhiteColor:new hi.Color(16777215),backgroundOpacity:.8,backgroundOpaqueOpacity:1,backgroundTexture:Tee,hiddenOverflow:!1,letterSpacing:0};let g_;function Tee(){if(!g_){const a=document.createElement("canvas").getContext("2d");a.canvas.width=1,a.canvas.height=1,a.fillStyle="#ffffff",a.fillRect(0,0,1,1),g_=new hi.CanvasTexture(a.canvas),g_.isDefault=!0}return g_}function Dv(a){return class extends a{constructor(n){super(n);E(this,"_rebuildParentUI",()=>{this.parent&&this.parent.isUI?this.parentUI=this.parent:this.parentUI=null});this.states={},this.currentState=void 0,this.isUI=!0,this.autoLayout=!0,this.childrenUIs=[],this.childrenBoxes=[],this.childrenTexts=[],this.childrenInlines=[],this.parentUI=null,this.addEventListener("added",this._rebuildParentUI),this.addEventListener("removed",this._rebuildParentUI)}getClippingPlanes(){const n=[];if(this.parentUI){if(this.isBlock&&this.parentUI.getHiddenOverflow()){const i=this.parentUI.getHeight()/2-(this.parentUI.padding||0),r=this.parentUI.getWidth()/2-(this.parentUI.padding||0),o=[new hi.Plane(new hi.Vector3(0,1,0),i),new hi.Plane(new hi.Vector3(0,-1,0),i),new hi.Plane(new hi.Vector3(1,0,0),r),new hi.Plane(new hi.Vector3(-1,0,0),r)];o.forEach(l=>{l.applyMatrix4(this.parent.matrixWorld)}),n.push(...o)}this.parentUI.parentUI&&n.push(...this.parentUI.getClippingPlanes())}return n}getHighestParent(){return this.parentUI?this.parent.getHighestParent():this}_getProperty(n){return this[n]===void 0&&this.parentUI?this.parent._getProperty(n):this[n]!==void 0?this[n]:lr[n]}getFontSize(){return this._getProperty("fontSize")}getFontKerning(){return this._getProperty("fontKerning")}getLetterSpacing(){return this._getProperty("letterSpacing")}getFontTexture(){return this._getProperty("fontTexture")}getFontFamily(){return this._getProperty("fontFamily")}getBreakOn(){return this._getProperty("breakOn")}getWhiteSpace(){return this._getProperty("whiteSpace")}getTextAlign(){return this._getProperty("textAlign")}getTextType(){return this._getProperty("textType")}getFontColor(){return this._getProperty("fontColor")}getFontSupersampling(){return this._getProperty("fontSupersampling")}getFontOpacity(){return this._getProperty("fontOpacity")}getFontPXRange(){return this._getProperty("fontPXRange")}getBorderRadius(){return this._getProperty("borderRadius")}getBorderWidth(){return this._getProperty("borderWidth")}getBorderColor(){return this._getProperty("borderColor")}getBorderOpacity(){return this._getProperty("borderOpacity")}getContainer(){return!this.threeOBJ&&this.parent?this.parent.getContainer():this.threeOBJ?this:lr.container}getParentsNumber(n){return n=n||0,this.parentUI?this.parentUI.getParentsNumber(n+1):n}getBackgroundOpacity(){return!this.backgroundOpacity&&this.backgroundOpacity!==0?lr.backgroundOpacity:this.backgroundOpacity}getBackgroundColor(){return this.backgroundColor||lr.backgroundColor}getBackgroundTexture(){return this.backgroundTexture||lr.backgroundTexture()}getAlignContent(){return this.alignContent||lr.alignContent}getAlignItems(){return this.alignItems||lr.alignItems}getContentDirection(){return this.contentDirection||lr.contentDirection}getJustifyContent(){return this.justifyContent||lr.justifyContent}getInterLine(){return this.interLine===void 0?lr.interLine:this.interLine}getOffset(){return this.offset===void 0?lr.offset:this.offset}getBackgroundSize(){return this.backgroundSize===void 0?lr.backgroundSize:this.backgroundSize}getHiddenOverflow(){return this.hiddenOverflow===void 0?lr.hiddenOverflow:this.hiddenOverflow}getBestFit(){return this.bestFit===void 0?lr.bestFit:this.bestFit}_rebuildChildrenLists(){this.childrenUIs=this.children.filter(n=>n.isUI),this.childrenBoxes=this.children.filter(n=>n.isBoxComponent),this.childrenInlines=this.children.filter(n=>n.isInline),this.childrenTexts=this.children.filter(n=>n.isText)}add(){for(const i of Object.keys(arguments))arguments[i].isInline&&this.update(null,!0);const n=super.add(...arguments);return this._rebuildChildrenLists(),n}remove(){for(const i of Object.keys(arguments))arguments[i].isInline&&this.update(null,!0);const n=super.remove(...arguments);return this._rebuildChildrenLists(),n}update(n,i,r){bu.requestUpdate(this,n,i,r)}onAfterUpdate(){}_updateFontFamily(n){this.fontFamily=n,this.traverse(i=>{i.isUI&&i.update(!0,!0,!1)}),this.getHighestParent().update(!1,!0,!1)}_updateFontTexture(n){this.fontTexture=n,this.getHighestParent().update(!1,!0,!1)}set(n){let i,r,o;if(bu.register(this),!(!n||JSON.stringify(n)===JSON.stringify({}))){n.alignContent&&(n.alignItems=n.alignContent,n.textAlign||(n.textAlign=n.alignContent),console.warn("`alignContent` property has been deprecated, please rely on `alignItems` and `textAlign` instead."),delete n.alignContent),n.alignItems&&C3(n.alignItems);for(const l of Object.keys(n))if(this[l]!=n[l])switch(l){case"content":case"fontSize":case"fontKerning":case"breakOn":case"whiteSpace":this.isText&&(i=!0),r=!0,this[l]=n[l];break;case"bestFit":this.isBlock&&(i=!0,r=!0),this[l]=n[l];break;case"width":case"height":case"padding":(this.isInlineBlock||this.isBlock&&this.getBestFit()!="none")&&(i=!0),r=!0,this[l]=n[l];break;case"letterSpacing":case"interLine":this.isBlock&&this.getBestFit()!="none"&&(i=!0),r=!0,this[l]=n[l];break;case"margin":case"contentDirection":case"justifyContent":case"alignContent":case"alignItems":case"textAlign":case"textType":r=!0,this[l]=n[l];break;case"fontColor":case"fontOpacity":case"fontSupersampling":case"offset":case"backgroundColor":case"backgroundOpacity":case"backgroundTexture":case"backgroundSize":case"borderRadius":case"borderWidth":case"borderColor":case"borderOpacity":o=!0,this[l]=n[l];break;case"hiddenOverflow":this[l]=n[l];break}n.fontFamily&&lg.setFontFamily(this,n.fontFamily),n.fontTexture&&lg.setFontTexture(this,n.fontTexture),this.parentUI&&this.parentUI.getBestFit()!="none"&&this.parentUI.update(!0,!0,!1),this.update(i,r,o),r&&this.getHighestParent().update(!1,!0,!1)}}setupState(n){this.states[n.state]={attributes:n.attributes,onSet:n.onSet}}setState(n){const i=this.states[n];if(!i){console.warn(`state "${n}" does not exist within this component`);return}n!==this.currentState&&(this.currentState=n,i.onSet&&i.onSet(),i.attributes&&this.set(i.attributes))}clear(){this.traverse(n=>{bu.disposeOf(n),n.material&&n.material.dispose(),n.geometry&&n.geometry.dispose()})}}}function mM(a){return class extends a{constructor(t){super(t),this.textUniforms={u_texture:{value:null},u_color:{value:null},u_opacity:{value:null},u_pxRange:{value:null},u_useRGSS:{value:null}},this.backgroundUniforms={u_texture:{value:null},u_color:{value:null},u_opacity:{value:null},u_backgroundMapping:{value:null},u_borderWidth:{value:null},u_borderColor:{value:null},u_borderRadiusTopLeft:{value:null},u_borderRadiusTopRight:{value:null},u_borderRadiusBottomRight:{value:null},u_borderRadiusBottomLeft:{value:null},u_borderOpacity:{value:null},u_size:{value:new hi.Vector2(1,1)},u_tSize:{value:new hi.Vector2(1,1)}}}updateBackgroundMaterial(){this.backgroundUniforms.u_texture.value=this.getBackgroundTexture(),this.backgroundUniforms.u_tSize.value.set(this.backgroundUniforms.u_texture.value.image.width,this.backgroundUniforms.u_texture.value.image.height),this.size&&this.backgroundUniforms.u_size.value.copy(this.size),this.backgroundUniforms.u_texture.value.isDefault?(this.backgroundUniforms.u_color.value=this.getBackgroundColor(),this.backgroundUniforms.u_opacity.value=this.getBackgroundOpacity()):(this.backgroundUniforms.u_color.value=this.backgroundColor||lr.backgroundWhiteColor,this.backgroundUniforms.u_opacity.value=!this.backgroundOpacity&&this.backgroundOpacity!==0?lr.backgroundOpaqueOpacity:this.backgroundOpacity),this.backgroundUniforms.u_backgroundMapping.value=(()=>{switch(this.getBackgroundSize()){case"stretch":return 0;case"contain":return 1;case"cover":return 2}})();const t=this.getBorderRadius();this.backgroundUniforms.u_borderWidth.value=this.getBorderWidth(),this.backgroundUniforms.u_borderColor.value=this.getBorderColor(),this.backgroundUniforms.u_borderOpacity.value=this.getBorderOpacity(),Array.isArray(t)?(this.backgroundUniforms.u_borderRadiusTopLeft.value=t[0],this.backgroundUniforms.u_borderRadiusTopRight.value=t[1],this.backgroundUniforms.u_borderRadiusBottomRight.value=t[2],this.backgroundUniforms.u_borderRadiusBottomLeft.value=t[3]):(this.backgroundUniforms.u_borderRadiusTopLeft.value=t,this.backgroundUniforms.u_borderRadiusTopRight.value=t,this.backgroundUniforms.u_borderRadiusBottomRight.value=t,this.backgroundUniforms.u_borderRadiusBottomLeft.value=t)}updateTextMaterial(){this.textUniforms.u_texture.value=this.getFontTexture(),this.textUniforms.u_color.value=this.getFontColor(),this.textUniforms.u_opacity.value=this.getFontOpacity(),this.textUniforms.u_pxRange.value=this.getFontPXRange(),this.textUniforms.u_useRGSS.value=this.getFontSupersampling()}getBackgroundMaterial(){return(!this.backgroundMaterial||!this.backgroundUniforms)&&(this.backgroundMaterial=this._makeBackgroundMaterial()),this.backgroundMaterial}getFontMaterial(){return(!this.fontMaterial||!this.textUniforms)&&(this.fontMaterial=this._makeTextMaterial()),this.fontMaterial}_makeTextMaterial(){return new hi.ShaderMaterial({uniforms:this.textUniforms,transparent:!0,clipping:!0,vertexShader:Iee,fragmentShader:Ree,extensions:{derivatives:!0}})}_makeBackgroundMaterial(){return new hi.ShaderMaterial({uniforms:this.backgroundUniforms,transparent:!0,clipping:!0,vertexShader:Pee,fragmentShader:Bee,extensions:{derivatives:!0}})}updateClippingPlanes(t){const n=t!==void 0?t:this.getClippingPlanes();JSON.stringify(n)!==JSON.stringify(this.clippingPlanes)&&(this.clippingPlanes=n,this.fontMaterial&&(this.fontMaterial.clippingPlanes=this.clippingPlanes),this.backgroundMaterial&&(this.backgroundMaterial.clippingPlanes=this.clippingPlanes))}}}const Iee=`
varying vec2 vUv;

#include <clipping_planes_pars_vertex>

void main() {

	vUv = uv;
	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
	gl_Position = projectionMatrix * mvPosition;
	gl_Position.z -= 0.00001;

	#include <clipping_planes_vertex>

}
`,Ree=`

uniform sampler2D u_texture;
uniform vec3 u_color;
uniform float u_opacity;
uniform float u_pxRange;
uniform bool u_useRGSS;

varying vec2 vUv;

#include <clipping_planes_pars_fragment>

// functions from the original msdf repo:
// https://github.com/Chlumsky/msdfgen#using-a-multi-channel-distance-field

float median(float r, float g, float b) {
	return max(min(r, g), min(max(r, g), b));
}

float screenPxRange() {
	vec2 unitRange = vec2(u_pxRange)/vec2(textureSize(u_texture, 0));
	vec2 screenTexSize = vec2(1.0)/fwidth(vUv);
	return max(0.5*dot(unitRange, screenTexSize), 1.0);
}

float tap(vec2 offsetUV) {
	vec3 msd = texture( u_texture, offsetUV ).rgb;
	float sd = median(msd.r, msd.g, msd.b);
	float screenPxDistance = screenPxRange() * (sd - 0.5);
	float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);
	return alpha;
}

void main() {

	float alpha;

	if ( u_useRGSS ) {

		// shader-based supersampling based on https://bgolus.medium.com/sharper-mipmapping-using-shader-based-supersampling-ed7aadb47bec
		// per pixel partial derivatives
		vec2 dx = dFdx(vUv);
		vec2 dy = dFdy(vUv);

		// rotated grid uv offsets
		vec2 uvOffsets = vec2(0.125, 0.375);
		vec2 offsetUV = vec2(0.0, 0.0);

		// supersampled using 2x2 rotated grid
		alpha = 0.0;
		offsetUV.xy = vUv + uvOffsets.x * dx + uvOffsets.y * dy;
		alpha += tap(offsetUV);
		offsetUV.xy = vUv - uvOffsets.x * dx - uvOffsets.y * dy;
		alpha += tap(offsetUV);
		offsetUV.xy = vUv + uvOffsets.y * dx - uvOffsets.x * dy;
		alpha += tap(offsetUV);
		offsetUV.xy = vUv - uvOffsets.y * dx + uvOffsets.x * dy;
		alpha += tap(offsetUV);
		alpha *= 0.25;

	} else {

		alpha = tap( vUv );

	}


	// apply the opacity
	alpha *= u_opacity;

	// this is useful to avoid z-fighting when quads overlap because of kerning
	if ( alpha < 0.02) discard;


	gl_FragColor = vec4( u_color, alpha );

	#include <clipping_planes_fragment>

}
`,Pee=`
varying vec2 vUv;

#include <clipping_planes_pars_vertex>

void main() {

	vUv = uv;
	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
	gl_Position = projectionMatrix * mvPosition;

	#include <clipping_planes_vertex>

}
`,Bee=`

uniform sampler2D u_texture;
uniform vec3 u_color;
uniform float u_opacity;

uniform float u_borderRadiusTopLeft;
uniform float u_borderRadiusTopRight;
uniform float u_borderRadiusBottomLeft;
uniform float u_borderRadiusBottomRight;
uniform float u_borderWidth;
uniform vec3 u_borderColor;
uniform float u_borderOpacity;
uniform vec2 u_size;
uniform vec2 u_tSize;
uniform int u_backgroundMapping;

varying vec2 vUv;

#include <clipping_planes_pars_fragment>

float getEdgeDist() {
	vec2 ndc = vec2( vUv.x * 2.0 - 1.0, vUv.y * 2.0 - 1.0 );
	vec2 planeSpaceCoord = vec2( u_size.x * 0.5 * ndc.x, u_size.y * 0.5 * ndc.y );
	vec2 corner = u_size * 0.5;
	vec2 offsetCorner = corner - abs( planeSpaceCoord );
	float innerRadDist = min( offsetCorner.x, offsetCorner.y ) * -1.0;
	if (vUv.x < 0.5 && vUv.y >= 0.5) {
		float roundedDist = length( max( abs( planeSpaceCoord ) - u_size * 0.5 + u_borderRadiusTopLeft, 0.0 ) ) - u_borderRadiusTopLeft;
		float s = step( innerRadDist * -1.0, u_borderRadiusTopLeft );
		return mix( innerRadDist, roundedDist, s );
	}
	if (vUv.x >= 0.5 && vUv.y >= 0.5) {
		float roundedDist = length( max( abs( planeSpaceCoord ) - u_size * 0.5 + u_borderRadiusTopRight, 0.0 ) ) - u_borderRadiusTopRight;
		float s = step( innerRadDist * -1.0, u_borderRadiusTopRight );
		return mix( innerRadDist, roundedDist, s );
	}
	if (vUv.x >= 0.5 && vUv.y < 0.5) {
		float roundedDist = length( max( abs( planeSpaceCoord ) - u_size * 0.5 + u_borderRadiusBottomRight, 0.0 ) ) - u_borderRadiusBottomRight;
		float s = step( innerRadDist * -1.0, u_borderRadiusBottomRight );
		return mix( innerRadDist, roundedDist, s );
	}
	if (vUv.x < 0.5 && vUv.y < 0.5) {
		float roundedDist = length( max( abs( planeSpaceCoord ) - u_size * 0.5 + u_borderRadiusBottomLeft, 0.0 ) ) - u_borderRadiusBottomLeft;
		float s = step( innerRadDist * -1.0, u_borderRadiusBottomLeft );
		return mix( innerRadDist, roundedDist, s );
	}
}

vec4 sampleTexture() {
	float textureRatio = u_tSize.x / u_tSize.y;
	float panelRatio = u_size.x / u_size.y;
	vec2 uv = vUv;
	if ( u_backgroundMapping == 1 ) { // contain
		if ( textureRatio < panelRatio ) { // repeat on X
			float newX = uv.x * ( panelRatio / textureRatio );
			newX += 0.5 - 0.5 * ( panelRatio / textureRatio );
			uv.x = newX;
		} else { // repeat on Y
			float newY = uv.y * ( textureRatio / panelRatio );
			newY += 0.5 - 0.5 * ( textureRatio / panelRatio );
			uv.y = newY;
		}
	} else if ( u_backgroundMapping == 2 ) { // cover
		if ( textureRatio < panelRatio ) { // stretch on Y
			float newY = uv.y * ( textureRatio / panelRatio );
			newY += 0.5 - 0.5 * ( textureRatio / panelRatio );
			uv.y = newY;
		} else { // stretch on X
			float newX = uv.x * ( panelRatio / textureRatio );
			newX += 0.5 - 0.5 * ( panelRatio / textureRatio );
			uv.x = newX;
		}
	}
	return texture2D( u_texture, uv ).rgba;
}

void main() {

	float edgeDist = getEdgeDist();
	float change = fwidth( edgeDist );

	vec4 textureSample = sampleTexture();
	vec3 blendedColor = textureSample.rgb * u_color;

	float alpha = smoothstep( change, 0.0, edgeDist );
	float blendedOpacity = u_opacity * textureSample.a * alpha;

	vec4 frameColor = vec4( blendedColor, blendedOpacity );

	if ( u_borderWidth <= 0.0 ) {
		gl_FragColor = frameColor;
	} else {
		vec4 borderColor = vec4( u_borderColor, u_borderOpacity * alpha );
		float stp = smoothstep( edgeDist + change, edgeDist, u_borderWidth * -1.0 );
		gl_FragColor = mix( frameColor, borderColor, stp );
	}

	#include <clipping_planes_fragment>
}
`;class U3 extends hi.Mesh{constructor(e){const t=new hi.PlaneGeometry;super(t,e),this.castShadow=!0,this.receiveShadow=!0,this.name="MeshUI-Frame"}}let k_=null;function Sf(...a){if(!k_)throw new Error("Cannot use mixins with Base null");let e=k_;k_=null;let t=a.length,n;for(;--t>=0;)n=a[t],e=n(e);return e}Sf.withBase=a=>(k_=a,Sf);class Dm extends Sf.withBase(hi.Object3D)(uM,k3,mM,Dv){constructor(e){super(e),this.isBlock=!0,this.size=new hi.Vector2(1,1),this.frame=new U3(this.getBackgroundMaterial()),this.frame.onBeforeRender=()=>{this.updateClippingPlanes&&this.updateClippingPlanes()},this.add(this.frame),this.set(e)}parseParams(){const e=this.getBestFit();e!="none"&&this.childrenTexts.length?this.calculateBestFit(e):this.childrenTexts.forEach(t=>{t._fitFontSize=void 0})}updateLayout(){const e=this.getWidth(),t=this.getHeight();if(!e||!t){console.warn("Block got no dimension from its parameters or from children parameters");return}this.size.set(e,t),this.frame.scale.set(e,t,1),this.frame&&this.updateBackgroundMaterial(),this.frame.renderOrder=this.getParentsNumber(),this.autoLayout&&this.setPosFromParentRecords(),this.childrenInlines.length&&this.computeInlinesPosition(),this.computeChildrenPosition(),this.parentUI&&(this.position.z=this.getOffset())}updateInner(){this.parentUI&&(this.position.z=this.getOffset()),this.frame&&this.updateBackgroundMaterial()}}function z3(a){return class extends a{constructor(t){super(t),this.isInline=!0}}}function Lee(a,e=!1){const t=a[0].index!==null,n=new Set(Object.keys(a[0].attributes)),i=new Set(Object.keys(a[0].morphAttributes)),r={},o={},l=a[0].morphTargetsRelative,h=new hi.BufferGeometry;let u=0;for(let f=0;f<a.length;++f){const g=a[f];let m=0;if(t!==(g.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+f+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const A in g.attributes){if(!n.has(A))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+f+'. All geometries must have compatible attributes; make sure "'+A+'" attribute exists among all geometries, or in none of them.'),null;r[A]===void 0&&(r[A]=[]),r[A].push(g.attributes[A]),m++}if(m!==n.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+f+". Make sure all geometries have the same number of attributes."),null;if(l!==g.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+f+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const A in g.morphAttributes){if(!i.has(A))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+f+".  .morphAttributes must be consistent throughout all geometries."),null;o[A]===void 0&&(o[A]=[]),o[A].push(g.morphAttributes[A])}if(h.userData.mergedUserData=h.userData.mergedUserData||[],h.userData.mergedUserData.push(g.userData),e){let A;if(t)A=g.index.count;else if(g.attributes.position!==void 0)A=g.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+f+". The geometry must have either an index or a position attribute"),null;h.addGroup(u,A,f),u+=A}}if(t){let f=0;const g=[];for(let m=0;m<a.length;++m){const A=a[m].index;for(let v=0;v<A.count;++v)g.push(A.getX(v)+f);f+=a[m].attributes.position.count}h.setIndex(g)}for(const f in r){const g=hB(r[f]);if(!g)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+f+" attribute."),null;h.setAttribute(f,g)}for(const f in o){const g=o[f][0].length;if(g===0)break;h.morphAttributes=h.morphAttributes||{},h.morphAttributes[f]=[];for(let m=0;m<g;++m){const A=[];for(let w=0;w<o[f].length;++w)A.push(o[f][w][m]);const v=hB(A);if(!v)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+f+" morphAttribute."),null;h.morphAttributes[f].push(v)}}return h}function hB(a){let e,t,n,i=0;for(let l=0;l<a.length;++l){const h=a[l];if(h.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(e===void 0&&(e=h.array.constructor),e!==h.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(t===void 0&&(t=h.itemSize),t!==h.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(n===void 0&&(n=h.normalized),n!==h.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;i+=h.array.length}const r=new e(i);let o=0;for(let l=0;l<a.length;++l)r.set(a[l].array,o),o+=a[l].array.length;return new hi.BufferAttribute(r,t,n)}class Dee extends hi.PlaneBufferGeometry{constructor(e,t){const n=e.glyph,i=e.fontSize;super(i,i),n.match(/\s/g)===null?(t.info.charset.indexOf(n)===-1&&console.error(`The character '${n}' is not included in the font characters set.`),this.mapUVs(t,n),this.transformGeometry(t,i,n,e)):(this.nullifyUVs(),this.scale(0,0,1),this.translate(0,i/2,0))}mapUVs(e,t){const n=e.chars.find(f=>f.char===t),i=e.common,r=n.x/i.scaleW,o=(n.x+n.width)/i.scaleW,l=1-(n.y+n.height)/i.scaleH,h=1-n.y/i.scaleH,u=this.attributes.uv;for(let f=0;f<u.count;f++){let g=u.getX(f),m=u.getY(f);[g,m]=(()=>{switch(f){case 0:return[r,h];case 1:return[o,h];case 2:return[r,l];case 3:return[o,l]}})(),u.setXY(f,g,m)}}nullifyUVs(){const e=this.attributes.uv;for(let t=0;t<e.count;t++)e.setXY(t,0,0)}transformGeometry(e,t,n,i){const r=e.chars.find(u=>u.char===n),o=e.common,l=r.height/o.lineHeight,h=r.width*l/r.height;this.scale(h,l,1),this.translate(i.width/2,i.height/2-i.anchor,0)}}function Oee(a){const e=a.font,t=a.fontSize,n=a.glyph,i=t/e.info.size,r=e.chars.find(g=>g.char===n);let o=r?r.width*i:t/3,l=r?r.height*i:0;o===0&&(o=r?r.xadvance*i:t),l===0&&(l=t*.7),n===`
`&&(o=0);const h=r?r.xadvance*i:o,u=r?r.xoffset*i:0,f=r?(r.yoffset+r.height-e.common.base)*t/e.common.lineHeight:0;return{width:o,height:l,anchor:f,xadvance:h,xoffset:u}}function Fee(a,e){const t=a._kernings;return t[e]?t[e]:0}function kee(){const a=[];this.inlines.forEach((n,i)=>{a[i]=new Dee(n,this.getFontFamily()),a[i].translate(n.offsetX,n.offsetY,0)});const e=Lee(a);return new hi.Mesh(e,this.getFontMaterial())}const Sb={getGlyphDimensions:Oee,getGlyphPairKerning:Fee,buildText:kee};function Nee(a){return class extends a{createText(){const t=this,n=(()=>{switch(this.getTextType()){case"MSDF":return Sb.buildText.call(this);default:console.warn(`'${this.getTextType()}' is not a supported text type.
See https://github.com/felixmariotto/three-mesh-ui/wiki/Using-a-custom-text-type`);break}})();return n.renderOrder=1/0,n.onBeforeRender=function(){t.updateClippingPlanes&&t.updateClippingPlanes()},n}getGlyphDimensions(t){switch(t.textType){case"MSDF":return Sb.getGlyphDimensions(t);default:console.warn(`'${t.textType}' is not a supported text type.
See https://github.com/felixmariotto/three-mesh-ui/wiki/Using-a-custom-text-type`);break}}getGlyphPairKerning(t,n,i){switch(t){case"MSDF":return Sb.getGlyphPairKerning(n,i);default:console.warn(`'${t}' is not a supported text type.
See https://github.com/felixmariotto/three-mesh-ui/wiki/Using-a-custom-text-type`);break}}}}function G3(a){a.children.forEach(e=>{e.children.length>0&&G3(e),a.remove(e),bu.disposeOf(e),e.material&&e.material.dispose(),e.geometry&&e.geometry.dispose()}),a.children=[]}const Uee=G3;class gM extends Sf.withBase(hi.Object3D)(z3,Nee,mM,Dv){constructor(e){super(e),this.isText=!0,this.set(e)}parseParams(){this.calculateInlines(this._fitFontSize||this.getFontSize())}updateLayout(){Uee(this),this.inlines&&(this.textContent=this.createText(),this.updateTextMaterial(),this.add(this.textContent)),this.position.z=this.getOffset()}updateInner(){this.position.z=this.getOffset(),this.textContent&&this.updateTextMaterial()}calculateInlines(e){const t=this.content,n=this.getFontFamily(),i=this.getBreakOn(),r=this.getTextType(),o=this.getWhiteSpace();if(!n||typeof n=="string"){lg.getFontOf(this)||console.warn("no font was found");return}if(!this.content){this.inlines=null;return}if(!r){console.error(`You must provide a 'textType' attribute so three-mesh-ui knows how to render your text.
 See https://github.com/felixmariotto/three-mesh-ui/wiki/Using-a-custom-text-type`);return}const l=M3(t,o),h=Array.from?Array.from(l):String(l).split(""),u=e/n.info.size,f=n.common.lineHeight*u,g=n.common.base*u,m=h.map(A=>{const v=this.getGlyphDimensions({textType:r,glyph:A,font:n,fontSize:e});let w=null;return o!==$g&&(i.includes(A)||A.match(/\s/g))&&(w="possible"),A.match(/\n/g)&&(w=T3(o)),{height:v.height,width:v.width,anchor:v.anchor,xadvance:v.xadvance,xoffset:v.xoffset,lineBreak:w,glyph:A,fontSize:e,lineHeight:f,lineBase:g}});if(this.getFontKerning()!=="none")for(let A=1;A<m.length;A++){const v=m[A],w=m[A-1].glyph+m[A].glyph,b=this.getGlyphPairKerning(r,n,w);v.kerning=b*(e/n.info.size)}this.inlines=m}}class AM extends Sf.withBase(hi.Object3D)(z3,uM,k3,mM,Dv){constructor(e){super(e),this.isInlineBlock=!0,this.size=new hi.Vector2(1,1),this.frame=new U3(this.getBackgroundMaterial()),this.frame.onBeforeRender=()=>{this.updateClippingPlanes&&this.updateClippingPlanes()},this.add(this.frame),this.set(e)}parseParams(){this.width||console.warn("inlineBlock has no width. Set to 0.3 by default"),this.height||console.warn("inlineBlock has no height. Set to 0.3 by default"),this.inlines=[{height:this.height||.3,width:this.width||.3,anchor:0,lineBreak:"possible"}]}updateLayout(){const e=this.getWidth(),t=this.getHeight();if(this.inlines){const n=this.inlines[0];this.position.set(n.width/2,n.height/2,0),this.position.x+=n.offsetX,this.position.y+=n.offsetY}this.size.set(e,t),this.frame.scale.set(e,t,1),this.frame&&this.updateBackgroundMaterial(),this.frame.renderOrder=this.getParentsNumber(),this.childrenInlines.length&&this.computeInlinesPosition(),this.computeChildrenPosition(),this.position.z=this.getOffset()}updateInner(){this.position.z=this.getOffset(),this.frame&&this.updateBackgroundMaterial()}}const Il={fr:[[[{width:.1,chars:[{lowerCase:"a",upperCase:"A"}]},{width:.1,chars:[{lowerCase:"z",upperCase:"Z"}]},{width:.1,chars:[{lowerCase:"e",upperCase:"E"}]},{width:.1,chars:[{lowerCase:"r",upperCase:"R"}]},{width:.1,chars:[{lowerCase:"t",upperCase:"T"}]},{width:.1,chars:[{lowerCase:"y",upperCase:"Y"}]},{width:.1,chars:[{lowerCase:"u",upperCase:"U"}]},{width:.1,chars:[{lowerCase:"i",upperCase:"I"}]},{width:.1,chars:[{lowerCase:"o",upperCase:"O"}]},{width:.1,chars:[{lowerCase:"p",upperCase:"P"}]}],[{width:.1,chars:[{lowerCase:"q",upperCase:"Q"}]},{width:.1,chars:[{lowerCase:"s",upperCase:"S"}]},{width:.1,chars:[{lowerCase:"d",upperCase:"D"}]},{width:.1,chars:[{lowerCase:"f",upperCase:"F"}]},{width:.1,chars:[{lowerCase:"g",upperCase:"G"}]},{width:.1,chars:[{lowerCase:"h",upperCase:"H"}]},{width:.1,chars:[{lowerCase:"j",upperCase:"J"}]},{width:.1,chars:[{lowerCase:"k",upperCase:"K"}]},{width:.1,chars:[{lowerCase:"l",upperCase:"L"}]},{width:.1,chars:[{lowerCase:"m",upperCase:"M"}]}],[{width:.2,command:"shift",chars:[{icon:"shift"}]},{width:.1,chars:[{lowerCase:"w",upperCase:"W"}]},{width:.1,chars:[{lowerCase:"x",upperCase:"X"}]},{width:.1,chars:[{lowerCase:"c",upperCase:"C"}]},{width:.1,chars:[{lowerCase:"v",upperCase:"V"}]},{width:.1,chars:[{lowerCase:"b",upperCase:"B"}]},{width:.1,chars:[{lowerCase:"n",upperCase:"N"}]},{width:.2,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]],[[{width:.1,chars:[{lowerCase:"1"}]},{width:.1,chars:[{lowerCase:"2"}]},{width:.1,chars:[{lowerCase:"3"}]},{width:.1,chars:[{lowerCase:"4"}]},{width:.1,chars:[{lowerCase:"5"}]},{width:.1,chars:[{lowerCase:"6"}]},{width:.1,chars:[{lowerCase:"7"}]},{width:.1,chars:[{lowerCase:"8"}]},{width:.1,chars:[{lowerCase:"9"}]},{width:.1,chars:[{lowerCase:"0"}]}],[{width:.1,chars:[{lowerCase:"@"}]},{width:.1,chars:[{lowerCase:"#"}]},{width:.1,chars:[{lowerCase:"|"}]},{width:.1,chars:[{lowerCase:"_"}]},{width:.1,chars:[{lowerCase:"&"}]},{width:.1,chars:[{lowerCase:"-"}]},{width:.1,chars:[{lowerCase:"+"}]},{width:.1,chars:[{lowerCase:"("}]},{width:.1,chars:[{lowerCase:")"}]},{width:.1,chars:[{lowerCase:"/"}]}],[{width:.1,chars:[{lowerCase:"="}]},{width:.1,chars:[{lowerCase:"*"}]},{width:.1,chars:[{lowerCase:'"'}]},{width:.1,chars:[{lowerCase:"'"}]},{width:.1,chars:[{lowerCase:":"}]},{width:.1,chars:[{lowerCase:";"}]},{width:.1,chars:[{lowerCase:"!"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]]],eng:[[[{width:.1,chars:[{lowerCase:"q",upperCase:"Q"}]},{width:.1,chars:[{lowerCase:"w",upperCase:"W"}]},{width:.1,chars:[{lowerCase:"e",upperCase:"E"}]},{width:.1,chars:[{lowerCase:"r",upperCase:"R"}]},{width:.1,chars:[{lowerCase:"t",upperCase:"T"}]},{width:.1,chars:[{lowerCase:"y",upperCase:"Y"}]},{width:.1,chars:[{lowerCase:"u",upperCase:"U"}]},{width:.1,chars:[{lowerCase:"i",upperCase:"I"}]},{width:.1,chars:[{lowerCase:"o",upperCase:"O"}]},{width:.1,chars:[{lowerCase:"p",upperCase:"P"}]}],[{width:.1,chars:[{lowerCase:"a",upperCase:"A"}]},{width:.1,chars:[{lowerCase:"s",upperCase:"S"}]},{width:.1,chars:[{lowerCase:"d",upperCase:"D"}]},{width:.1,chars:[{lowerCase:"f",upperCase:"F"}]},{width:.1,chars:[{lowerCase:"g",upperCase:"G"}]},{width:.1,chars:[{lowerCase:"h",upperCase:"H"}]},{width:.1,chars:[{lowerCase:"j",upperCase:"J"}]},{width:.1,chars:[{lowerCase:"k",upperCase:"K"}]},{width:.1,chars:[{lowerCase:"l",upperCase:"L"}]}],[{width:.15,command:"shift",chars:[{icon:"shift"}]},{width:.1,chars:[{lowerCase:"z",upperCase:"Z"}]},{width:.1,chars:[{lowerCase:"x",upperCase:"X"}]},{width:.1,chars:[{lowerCase:"c",upperCase:"C"}]},{width:.1,chars:[{lowerCase:"v",upperCase:"V"}]},{width:.1,chars:[{lowerCase:"b",upperCase:"B"}]},{width:.1,chars:[{lowerCase:"n",upperCase:"N"}]},{width:.1,chars:[{lowerCase:"m",upperCase:"M"}]},{width:.15,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]],[[{width:.1,chars:[{lowerCase:"1"}]},{width:.1,chars:[{lowerCase:"2"}]},{width:.1,chars:[{lowerCase:"3"}]},{width:.1,chars:[{lowerCase:"4"}]},{width:.1,chars:[{lowerCase:"5"}]},{width:.1,chars:[{lowerCase:"6"}]},{width:.1,chars:[{lowerCase:"7"}]},{width:.1,chars:[{lowerCase:"8"}]},{width:.1,chars:[{lowerCase:"9"}]},{width:.1,chars:[{lowerCase:"0"}]}],[{width:.1,chars:[{lowerCase:"@"}]},{width:.1,chars:[{lowerCase:"#"}]},{width:.1,chars:[{lowerCase:"|"}]},{width:.1,chars:[{lowerCase:"_"}]},{width:.1,chars:[{lowerCase:"&"}]},{width:.1,chars:[{lowerCase:"-"}]},{width:.1,chars:[{lowerCase:"+"}]},{width:.1,chars:[{lowerCase:"("}]},{width:.1,chars:[{lowerCase:")"}]},{width:.1,chars:[{lowerCase:"/"}]}],[{width:.1,chars:[{lowerCase:"="}]},{width:.1,chars:[{lowerCase:"*"}]},{width:.1,chars:[{lowerCase:'"'}]},{width:.1,chars:[{lowerCase:"'"}]},{width:.1,chars:[{lowerCase:":"}]},{width:.1,chars:[{lowerCase:";"}]},{width:.1,chars:[{lowerCase:"!"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]]],ru:[[[{width:1/12,chars:[{lowerCase:"\u0439",upperCase:"\u0419"},{lowerCase:"q",upperCase:"Q"}]},{width:1/12,chars:[{lowerCase:"\u0446",upperCase:"\u0426"},{lowerCase:"w",upperCase:"W"}]},{width:1/12,chars:[{lowerCase:"\u0443",upperCase:"\u0423"},{lowerCase:"e",upperCase:"E"}]},{width:1/12,chars:[{lowerCase:"\u043A",upperCase:"\u041A"},{lowerCase:"r",upperCase:"R"}]},{width:1/12,chars:[{lowerCase:"\u0435",upperCase:"\u0415"},{lowerCase:"t",upperCase:"T"}]},{width:1/12,chars:[{lowerCase:"\u043D",upperCase:"\u041D"},{lowerCase:"y",upperCase:"Y"}]},{width:1/12,chars:[{lowerCase:"\u0433",upperCase:"\u0413"},{lowerCase:"u",upperCase:"U"}]},{width:1/12,chars:[{lowerCase:"\u0448",upperCase:"\u0428"},{lowerCase:"i",upperCase:"I"}]},{width:1/12,chars:[{lowerCase:"\u0449",upperCase:"\u0429"},{lowerCase:"o",upperCase:"O"}]},{width:1/12,chars:[{lowerCase:"\u0437",upperCase:"\u0417"},{lowerCase:"p",upperCase:"P"}]},{width:1/12,chars:[{lowerCase:"\u0445",upperCase:"\u0425"},{lowerCase:"{",upperCase:"["}]},{width:1/12,chars:[{lowerCase:"\u044A",upperCase:"\u042A"},{lowerCase:"}",upperCase:"]"}]}],[{width:1/12,chars:[{lowerCase:"\u0444",upperCase:"\u0424"},{lowerCase:"a",upperCase:"A"}]},{width:1/12,chars:[{lowerCase:"\u044B",upperCase:"\u042B"},{lowerCase:"s",upperCase:"S"}]},{width:1/12,chars:[{lowerCase:"\u0432",upperCase:"\u0412"},{lowerCase:"d",upperCase:"D"}]},{width:1/12,chars:[{lowerCase:"\u0430",upperCase:"\u0410"},{lowerCase:"f",upperCase:"F"}]},{width:1/12,chars:[{lowerCase:"\u043F",upperCase:"\u041F"},{lowerCase:"g",upperCase:"G"}]},{width:1/12,chars:[{lowerCase:"\u0440",upperCase:"\u0420"},{lowerCase:"h",upperCase:"H"}]},{width:1/12,chars:[{lowerCase:"\u043E",upperCase:"\u041E"},{lowerCase:"j",upperCase:"J"}]},{width:1/12,chars:[{lowerCase:"\u043B",upperCase:"\u041B"},{lowerCase:"k",upperCase:"K"}]},{width:1/12,chars:[{lowerCase:"\u0434",upperCase:"\u0414"},{lowerCase:"l",upperCase:"L"}]},{width:1/12,chars:[{lowerCase:"\u0436",upperCase:"\u0416"},{lowerCase:":",upperCase:";"}]},{width:1/12,chars:[{lowerCase:"\u044D",upperCase:"\u042D"},{lowerCase:'"',upperCase:"'"}]},{width:1/12,chars:[{lowerCase:"\u0451",upperCase:"\u0401"},{lowerCase:"|",upperCase:"\\"}]}],[{width:1.5/12,command:"shift",chars:[{icon:"shift"}]},{width:1/12,chars:[{lowerCase:"\u044F",upperCase:"\u042F"},{lowerCase:"z",upperCase:"Z"}]},{width:1/12,chars:[{lowerCase:"\u0447",upperCase:"\u0427"},{lowerCase:"x",upperCase:"X"}]},{width:1/12,chars:[{lowerCase:"\u0441",upperCase:"\u0421"},{lowerCase:"c",upperCase:"C"}]},{width:1/12,chars:[{lowerCase:"\u043C",upperCase:"\u041C"},{lowerCase:"v",upperCase:"V"}]},{width:1/12,chars:[{lowerCase:"\u0438",upperCase:"\u0418"},{lowerCase:"b",upperCase:"B"}]},{width:1/12,chars:[{lowerCase:"\u0442",upperCase:"\u0422"},{lowerCase:"n",upperCase:"N"}]},{width:1/12,chars:[{lowerCase:"\u044C",upperCase:"\u042C"},{lowerCase:"m",upperCase:"M"}]},{width:1/12,chars:[{lowerCase:"\u0431",upperCase:"\u0411"},{lowerCase:",",upperCase:""}]},{width:1/12,chars:[{lowerCase:"\u044E",upperCase:"\u042E"},{lowerCase:".",upperCase:""}]},{width:1.5/12,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.15,command:"switch-set",chars:[{lowerCase:"eng"}]},{width:.15,command:"switch",chars:[{lowerCase:".?12"}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]],[[{width:.1,chars:[{lowerCase:"1"}]},{width:.1,chars:[{lowerCase:"2"}]},{width:.1,chars:[{lowerCase:"3"}]},{width:.1,chars:[{lowerCase:"4"}]},{width:.1,chars:[{lowerCase:"5"}]},{width:.1,chars:[{lowerCase:"6"}]},{width:.1,chars:[{lowerCase:"7"}]},{width:.1,chars:[{lowerCase:"8"}]},{width:.1,chars:[{lowerCase:"9"}]},{width:.1,chars:[{lowerCase:"0"}]}],[{width:.1,chars:[{lowerCase:"@"}]},{width:.1,chars:[{lowerCase:"#"}]},{width:.1,chars:[{lowerCase:"|"}]},{width:.1,chars:[{lowerCase:"_"}]},{width:.1,chars:[{lowerCase:"&"}]},{width:.1,chars:[{lowerCase:"-"}]},{width:.1,chars:[{lowerCase:"+"}]},{width:.1,chars:[{lowerCase:"("}]},{width:.1,chars:[{lowerCase:")"}]},{width:.1,chars:[{lowerCase:"/"}]}],[{width:.1,chars:[{lowerCase:"="}]},{width:.1,chars:[{lowerCase:"*"}]},{width:.1,chars:[{lowerCase:'"'}]},{width:.1,chars:[{lowerCase:"'"}]},{width:.1,chars:[{lowerCase:":"}]},{width:.1,chars:[{lowerCase:";"}]},{width:.1,chars:[{lowerCase:"!"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.3,command:"switch",chars:[{lowerCase:"\u0410\u0411\u0412"}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]]],de:[[[{width:1/11,chars:[{lowerCase:"q",upperCase:"Q"}]},{width:1/11,chars:[{lowerCase:"w",upperCase:"W"}]},{width:1/11,chars:[{lowerCase:"e",upperCase:"E"}]},{width:1/11,chars:[{lowerCase:"r",upperCase:"R"}]},{width:1/11,chars:[{lowerCase:"t",upperCase:"T"}]},{width:1/11,chars:[{lowerCase:"z",upperCase:"Z"}]},{width:1/11,chars:[{lowerCase:"u",upperCase:"U"}]},{width:1/11,chars:[{lowerCase:"i",upperCase:"I"}]},{width:1/11,chars:[{lowerCase:"o",upperCase:"O"}]},{width:1/11,chars:[{lowerCase:"p",upperCase:"P"}]},{width:1/11,chars:[{lowerCase:"\xFC",upperCase:"\xDC"}]}],[{width:1/11,chars:[{lowerCase:"a",upperCase:"A"}]},{width:1/11,chars:[{lowerCase:"s",upperCase:"S"}]},{width:1/11,chars:[{lowerCase:"d",upperCase:"D"}]},{width:1/11,chars:[{lowerCase:"f",upperCase:"F"}]},{width:1/11,chars:[{lowerCase:"g",upperCase:"G"}]},{width:1/11,chars:[{lowerCase:"h",upperCase:"H"}]},{width:1/11,chars:[{lowerCase:"j",upperCase:"J"}]},{width:1/11,chars:[{lowerCase:"k",upperCase:"K"}]},{width:1/11,chars:[{lowerCase:"l",upperCase:"L"}]},{width:1/11,chars:[{lowerCase:"\xF6",upperCase:"\xD6"}]},{width:1/11,chars:[{lowerCase:"\xE4",upperCase:"\xC4"}]}],[{width:2/11,command:"shift",chars:[{icon:"shift"}]},{width:1/11,chars:[{lowerCase:"y",upperCase:"Y"}]},{width:1/11,chars:[{lowerCase:"x",upperCase:"X"}]},{width:1/11,chars:[{lowerCase:"c",upperCase:"C"}]},{width:1/11,chars:[{lowerCase:"v",upperCase:"V"}]},{width:1/11,chars:[{lowerCase:"b",upperCase:"B"}]},{width:1/11,chars:[{lowerCase:"n",upperCase:"N"}]},{width:1/11,chars:[{lowerCase:"m",upperCase:"M"}]},{width:2/11,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]],[[{width:.1,chars:[{lowerCase:"1"}]},{width:.1,chars:[{lowerCase:"2"}]},{width:.1,chars:[{lowerCase:"3"}]},{width:.1,chars:[{lowerCase:"4"}]},{width:.1,chars:[{lowerCase:"5"}]},{width:.1,chars:[{lowerCase:"6"}]},{width:.1,chars:[{lowerCase:"7"}]},{width:.1,chars:[{lowerCase:"8"}]},{width:.1,chars:[{lowerCase:"9"}]},{width:.1,chars:[{lowerCase:"0"}]}],[{width:.1,chars:[{lowerCase:"@"}]},{width:.1,chars:[{lowerCase:"#"}]},{width:.1,chars:[{lowerCase:"|"}]},{width:.1,chars:[{lowerCase:"_"}]},{width:.1,chars:[{lowerCase:"&"}]},{width:.1,chars:[{lowerCase:"-"}]},{width:.1,chars:[{lowerCase:"+"}]},{width:.1,chars:[{lowerCase:"("}]},{width:.1,chars:[{lowerCase:")"}]},{width:.1,chars:[{lowerCase:"/"}]}],[{width:.1,chars:[{lowerCase:"="}]},{width:.1,chars:[{lowerCase:"*"}]},{width:.1,chars:[{lowerCase:'"'}]},{width:.1,chars:[{lowerCase:"'"}]},{width:.1,chars:[{lowerCase:":"}]},{width:.1,chars:[{lowerCase:";"}]},{width:.1,chars:[{lowerCase:"!"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]]],es:[[[{width:.1,chars:[{lowerCase:"q",upperCase:"Q"}]},{width:.1,chars:[{lowerCase:"w",upperCase:"W"}]},{width:.1,chars:[{lowerCase:"e",upperCase:"E"}]},{width:.1,chars:[{lowerCase:"r",upperCase:"R"}]},{width:.1,chars:[{lowerCase:"t",upperCase:"T"}]},{width:.1,chars:[{lowerCase:"y",upperCase:"Y"}]},{width:.1,chars:[{lowerCase:"u",upperCase:"U"}]},{width:.1,chars:[{lowerCase:"i",upperCase:"I"}]},{width:.1,chars:[{lowerCase:"o",upperCase:"O"}]},{width:.1,chars:[{lowerCase:"p",upperCase:"P"}]}],[{width:.1,chars:[{lowerCase:"a",upperCase:"A"}]},{width:.1,chars:[{lowerCase:"s",upperCase:"S"}]},{width:.1,chars:[{lowerCase:"d",upperCase:"D"}]},{width:.1,chars:[{lowerCase:"f",upperCase:"F"}]},{width:.1,chars:[{lowerCase:"g",upperCase:"G"}]},{width:.1,chars:[{lowerCase:"h",upperCase:"H"}]},{width:.1,chars:[{lowerCase:"j",upperCase:"J"}]},{width:.1,chars:[{lowerCase:"k",upperCase:"K"}]},{width:.1,chars:[{lowerCase:"l",upperCase:"L"}]},{width:.1,chars:[{lowerCase:"\xF1",upperCase:"\xD1"}]}],[{width:.15,command:"shift",chars:[{icon:"shift"}]},{width:.1,chars:[{lowerCase:"z",upperCase:"Z"}]},{width:.1,chars:[{lowerCase:"x",upperCase:"X"}]},{width:.1,chars:[{lowerCase:"c",upperCase:"C"}]},{width:.1,chars:[{lowerCase:"v",upperCase:"V"}]},{width:.1,chars:[{lowerCase:"b",upperCase:"B"}]},{width:.1,chars:[{lowerCase:"n",upperCase:"N"}]},{width:.1,chars:[{lowerCase:"m",upperCase:"M"}]},{width:.15,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]],[[{width:.1,chars:[{lowerCase:"1"}]},{width:.1,chars:[{lowerCase:"2"}]},{width:.1,chars:[{lowerCase:"3"}]},{width:.1,chars:[{lowerCase:"4"}]},{width:.1,chars:[{lowerCase:"5"}]},{width:.1,chars:[{lowerCase:"6"}]},{width:.1,chars:[{lowerCase:"7"}]},{width:.1,chars:[{lowerCase:"8"}]},{width:.1,chars:[{lowerCase:"9"}]},{width:.1,chars:[{lowerCase:"0"}]}],[{width:.1,chars:[{lowerCase:"@"}]},{width:.1,chars:[{lowerCase:"#"}]},{width:.1,chars:[{lowerCase:"|"}]},{width:.1,chars:[{lowerCase:"_"}]},{width:.1,chars:[{lowerCase:"&"}]},{width:.1,chars:[{lowerCase:"-"}]},{width:.1,chars:[{lowerCase:"+"}]},{width:.1,chars:[{lowerCase:"("}]},{width:.1,chars:[{lowerCase:")"}]},{width:.1,chars:[{lowerCase:"/"}]}],[{width:.1,chars:[{lowerCase:"="}]},{width:.1,chars:[{lowerCase:"*"}]},{width:.1,chars:[{lowerCase:'"'}]},{width:.1,chars:[{lowerCase:"'"}]},{width:.1,chars:[{lowerCase:":"}]},{width:.1,chars:[{lowerCase:";"}]},{width:.1,chars:[{lowerCase:"!"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]]],el:[[[{width:.1,chars:[{lowerCase:";",upperCase:":"},{lowerCase:"q",upperCase:"Q"}]},{width:.1,chars:[{lowerCase:"\u03C2",upperCase:"\u03C2"},{lowerCase:"w",upperCase:"W"}]},{width:.1,chars:[{lowerCase:"\u03B5",upperCase:"\u0395"},{lowerCase:"e",upperCase:"E"}]},{width:.1,chars:[{lowerCase:"\u03C1",upperCase:"\u03A1"},{lowerCase:"r",upperCase:"R"}]},{width:.1,chars:[{lowerCase:"\u03C4",upperCase:"\u03A4"},{lowerCase:"t",upperCase:"T"}]},{width:.1,chars:[{lowerCase:"\u03C5",upperCase:"\u03A5"},{lowerCase:"y",upperCase:"Y"}]},{width:.1,chars:[{lowerCase:"\u03B8",upperCase:"\u0398"},{lowerCase:"u",upperCase:"U"}]},{width:.1,chars:[{lowerCase:"\u03B9",upperCase:"\u0399"},{lowerCase:"i",upperCase:"I"}]},{width:.1,chars:[{lowerCase:"\u03BF",upperCase:"\u039F"},{lowerCase:"o",upperCase:"O"}]},{width:.1,chars:[{lowerCase:"\u03C0",upperCase:"\u03A0"},{lowerCase:"p",upperCase:"P"}]}],[{width:.1,chars:[{lowerCase:"\u03B1",upperCase:"\u0391"},{lowerCase:"a",upperCase:"A"}]},{width:.1,chars:[{lowerCase:"\u03C3",upperCase:"\u03A3"},{lowerCase:"s",upperCase:"S"}]},{width:.1,chars:[{lowerCase:"\u03B4",upperCase:"\u0394"},{lowerCase:"d",upperCase:"D"}]},{width:.1,chars:[{lowerCase:"\u03C6",upperCase:"\u03A6"},{lowerCase:"f",upperCase:"F"}]},{width:.1,chars:[{lowerCase:"\u03B3",upperCase:"\u0393"},{lowerCase:"g",upperCase:"G"}]},{width:.1,chars:[{lowerCase:"\u03B7",upperCase:"\u0397"},{lowerCase:"h",upperCase:"H"}]},{width:.1,chars:[{lowerCase:"\u03BE",upperCase:"\u039E"},{lowerCase:"j",upperCase:"J"}]},{width:.1,chars:[{lowerCase:"\u03BA",upperCase:"\u039A"},{lowerCase:"k",upperCase:"K"}]},{width:.1,chars:[{lowerCase:"\u03BB",upperCase:"\u039B"},{lowerCase:"l",upperCase:"L"}]}],[{width:.15,command:"shift",chars:[{icon:"shift"}]},{width:.1,chars:[{lowerCase:"\u03B6",upperCase:"\u0396"},{lowerCase:"z",upperCase:"Z"}]},{width:.1,chars:[{lowerCase:"\u03C7",upperCase:"\u03A7"},{lowerCase:"x",upperCase:"X"}]},{width:.1,chars:[{lowerCase:"\u03C8",upperCase:"\u03A8"},{lowerCase:"c",upperCase:"C"}]},{width:.1,chars:[{lowerCase:"\u03C9",upperCase:"\u03A9"},{lowerCase:"v",upperCase:"V"}]},{width:.1,chars:[{lowerCase:"\u03B2",upperCase:"\u0392"},{lowerCase:"b",upperCase:"B"}]},{width:.1,chars:[{lowerCase:"\u03BD",upperCase:"\u039D"},{lowerCase:"n",upperCase:"N"}]},{width:.1,chars:[{lowerCase:"\u03BC",upperCase:"\u039C"},{lowerCase:"m",upperCase:"M"}]},{width:.15,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.15,command:"switch-set",chars:[{lowerCase:"eng"}]},{width:.15,command:"switch",chars:[{lowerCase:".?12"}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]],[[{width:.1,chars:[{lowerCase:"1"}]},{width:.1,chars:[{lowerCase:"2"}]},{width:.1,chars:[{lowerCase:"3"}]},{width:.1,chars:[{lowerCase:"4"}]},{width:.1,chars:[{lowerCase:"5"}]},{width:.1,chars:[{lowerCase:"6"}]},{width:.1,chars:[{lowerCase:"7"}]},{width:.1,chars:[{lowerCase:"8"}]},{width:.1,chars:[{lowerCase:"9"}]},{width:.1,chars:[{lowerCase:"0"}]}],[{width:.1,chars:[{lowerCase:"@"}]},{width:.1,chars:[{lowerCase:"#"}]},{width:.1,chars:[{lowerCase:"|"}]},{width:.1,chars:[{lowerCase:"_"}]},{width:.1,chars:[{lowerCase:"&"}]},{width:.1,chars:[{lowerCase:"-"}]},{width:.1,chars:[{lowerCase:"+"}]},{width:.1,chars:[{lowerCase:"("}]},{width:.1,chars:[{lowerCase:")"}]},{width:.1,chars:[{lowerCase:"/"}]}],[{width:.1,chars:[{lowerCase:"="}]},{width:.1,chars:[{lowerCase:"*"}]},{width:.1,chars:[{lowerCase:'"'}]},{width:.1,chars:[{lowerCase:"'"}]},{width:.1,chars:[{lowerCase:":"}]},{width:.1,chars:[{lowerCase:";"}]},{width:.1,chars:[{lowerCase:"!"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]]],nord:[[[{width:1/11,chars:[{lowerCase:"q",upperCase:"Q"}]},{width:1/11,chars:[{lowerCase:"w",upperCase:"W"}]},{width:1/11,chars:[{lowerCase:"e",upperCase:"E"}]},{width:1/11,chars:[{lowerCase:"r",upperCase:"R"}]},{width:1/11,chars:[{lowerCase:"t",upperCase:"T"}]},{width:1/11,chars:[{lowerCase:"y",upperCase:"Y"}]},{width:1/11,chars:[{lowerCase:"u",upperCase:"U"}]},{width:1/11,chars:[{lowerCase:"i",upperCase:"I"}]},{width:1/11,chars:[{lowerCase:"o",upperCase:"O"}]},{width:1/11,chars:[{lowerCase:"p",upperCase:"P"}]},{width:1/11,chars:[{lowerCase:"\xE5",upperCase:"\xC5"}]}],[{width:1/11,chars:[{lowerCase:"a",upperCase:"A"}]},{width:1/11,chars:[{lowerCase:"s",upperCase:"S"}]},{width:1/11,chars:[{lowerCase:"d",upperCase:"D"}]},{width:1/11,chars:[{lowerCase:"f",upperCase:"F"}]},{width:1/11,chars:[{lowerCase:"g",upperCase:"G"}]},{width:1/11,chars:[{lowerCase:"h",upperCase:"H"}]},{width:1/11,chars:[{lowerCase:"j",upperCase:"J"}]},{width:1/11,chars:[{lowerCase:"k",upperCase:"K"}]},{width:1/11,chars:[{lowerCase:"l",upperCase:"L"}]},{width:1/11,chars:[{lowerCase:"\xE6",upperCase:"\xC6"}]},{width:1/11,chars:[{lowerCase:"\xF8",upperCase:"\xD8"}]}],[{width:2/11,command:"shift",chars:[{icon:"shift"}]},{width:1/11,chars:[{lowerCase:"z",upperCase:"Z"}]},{width:1/11,chars:[{lowerCase:"x",upperCase:"X"}]},{width:1/11,chars:[{lowerCase:"c",upperCase:"C"}]},{width:1/11,chars:[{lowerCase:"v",upperCase:"V"}]},{width:1/11,chars:[{lowerCase:"b",upperCase:"B"}]},{width:1/11,chars:[{lowerCase:"n",upperCase:"N"}]},{width:1/11,chars:[{lowerCase:"m",upperCase:"M"}]},{width:2/11,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]],[[{width:.1,chars:[{lowerCase:"1"}]},{width:.1,chars:[{lowerCase:"2"}]},{width:.1,chars:[{lowerCase:"3"}]},{width:.1,chars:[{lowerCase:"4"}]},{width:.1,chars:[{lowerCase:"5"}]},{width:.1,chars:[{lowerCase:"6"}]},{width:.1,chars:[{lowerCase:"7"}]},{width:.1,chars:[{lowerCase:"8"}]},{width:.1,chars:[{lowerCase:"9"}]},{width:.1,chars:[{lowerCase:"0"}]}],[{width:.1,chars:[{lowerCase:"@"}]},{width:.1,chars:[{lowerCase:"#"}]},{width:.1,chars:[{lowerCase:"|"}]},{width:.1,chars:[{lowerCase:"_"}]},{width:.1,chars:[{lowerCase:"&"}]},{width:.1,chars:[{lowerCase:"-"}]},{width:.1,chars:[{lowerCase:"+"}]},{width:.1,chars:[{lowerCase:"("}]},{width:.1,chars:[{lowerCase:")"}]},{width:.1,chars:[{lowerCase:"/"}]}],[{width:.1,chars:[{lowerCase:"="}]},{width:.1,chars:[{lowerCase:"*"}]},{width:.1,chars:[{lowerCase:'"'}]},{width:.1,chars:[{lowerCase:"'"}]},{width:.1,chars:[{lowerCase:":"}]},{width:.1,chars:[{lowerCase:";"}]},{width:.1,chars:[{lowerCase:"!"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]]]},zee=new hi.TextureLoader;class H3 extends Sf.withBase(hi.Object3D)(uM,Dv){constructor(e){e||(e={}),e.width||(e.width=1),e.height||(e.height=.4),e.margin||(e.margin=.003),e.padding||(e.padding=.01),super(e),this.currentPanel=0,this.isLowerCase=!0,this.charsetCount=1;let t;if(e.language||navigator.language)switch(e.language||navigator.language){case"fr":case"fr-CH":case"fr-CA":t=Il.fr;break;case"ru":this.charsetCount=2,t=Il.ru;break;case"de":case"de-DE":case"de-AT":case"de-LI":case"de-CH":t=Il.de;break;case"es":case"es-419":case"es-AR":case"es-CL":case"es-CO":case"es-ES":case"es-CR":case"es-US":case"es-HN":case"es-MX":case"es-PE":case"es-UY":case"es-VE":t=Il.es;break;case"el":this.charsetCount=2,t=Il.el;break;case"nord":t=Il.nord;break;default:t=Il.eng;break}else t=Il.eng;this.keys=[],this.panels=t.map(n=>{const i=e.height/n.length-e.margin*2,r=new Dm({width:e.width+e.padding*2,height:e.height+e.padding*2,offset:0,padding:e.padding,fontFamily:e.fontFamily,fontTexture:e.fontTexture,backgroundColor:e.backgroundColor,backgroundOpacity:e.backgroundOpacity});return r.charset=0,r.add(...n.map(o=>{const l=new Dm({width:e.width,height:i,margin:e.margin,contentDirection:"row",justifyContent:"center"});l.frame.visible=!1;const h=[];return o.forEach(u=>{const f=new Dm({width:e.width*u.width-e.margin*2,height:i,margin:e.margin,justifyContent:"center",offset:0}),g=u.chars[r.charset].lowerCase||u.chars[r.charset].icon||"undif";if(g==="enter"&&e.enterTexture||g==="shift"&&e.shiftTexture||g==="backspace"&&e.backspaceTexture){const m=(()=>{switch(g){case"backspace":return e.backspaceTexture;case"enter":return e.enterTexture;case"shift":return e.shiftTexture;default:console.warn("There is no icon image for this key")}})();zee.load(m,A=>{f.add(new AM({width:f.width*.65,height:f.height*.65,backgroundSize:"contain",backgroundTexture:A}))})}else f.add(new gM({content:g,offset:0}));f.type="Key",f.info=u,f.info.input=g,f.panel=r,h.push(f),this.keys.push(f)}),l.add(...h),l})),r}),this.add(this.panels[0]),this.set(e)}setNextPanel(){this.panels.forEach(e=>{this.remove(e)}),this.currentPanel=(this.currentPanel+1)%this.panels.length,this.add(this.panels[this.currentPanel]),this.update(!0,!0,!0)}setNextCharset(){this.panels[this.currentPanel].charset=(this.panels[this.currentPanel].charset+1)%this.charsetCount,this.keys.forEach(e=>{if(!this.panels[this.currentPanel].getObjectById(e.id))return;const n=e.info.chars[e.panel.charset]||e.info.chars[0],i=this.isLowerCase||!n.upperCase?n.lowerCase:n.upperCase;if(!e.childrenTexts.length)return;const r=e.childrenTexts[0];e.info.input=i,r.set({content:i}),r.update(!0,!0,!0)})}toggleCase(){this.isLowerCase=!this.isLowerCase,this.keys.forEach(e=>{const t=e.info.chars[e.panel.charset]||e.info.chars[0],n=this.isLowerCase||!t.upperCase?t.lowerCase:t.upperCase;if(!e.childrenTexts.length)return;const i=e.childrenTexts[0];e.info.input=n,i.set({content:n}),i.update(!0,!0,!0)})}parseParams(){}updateLayout(){}updateInner(){}}const V3=()=>bu.update(),W3={Block:Dm,Text:gM,InlineBlock:AM,Keyboard:H3,FontLibrary:lg,update:V3,TextAlign:Iv,Whitespace:Tv,JustifyContent:Mv,AlignItems:Sv,ContentDirection:Cv};typeof global<"u"&&(global.ThreeMeshUI=W3);const Gee=W3;var Hee=po.g1,_M=po.gO,Vee=po.km,Wee=po.zV,Qee=po.ol,jee=po.uM,Q3=po.N1,j3=po.xv,qee=po.PH,Xee=po.UH,Yee=po.ZP,Jee=po.Vx;const Zee=Object.freeze(Object.defineProperty({__proto__:null,AlignItems:Hee,Block:_M,ContentDirection:Vee,FontLibrary:Wee,InlineBlock:Qee,JustifyContent:jee,Keyboard:Q3,Text:j3,TextAlign:qee,Whitespace:Xee,default:Yee,update:Jee},Symbol.toStringTag,{value:"Module"}));class of{constructor(e){E(this,"used",!1);E(this,"inputSource");E(this,"object");E(this,"isDown");E(this,"isUp");E(this,"isPressed");E(this,"isClicked");E(this,"event");this.event=e}Use(){this.used=!0}StopPropagation(){var e;(e=this.event)==null||e.stopImmediatePropagation()}}const Kee=jt("debugeventsystem"),Ia=class extends Bt{constructor(){super();E(this,"orbitControl",null);E(this,"orbitControlWasEnabled",!1);E(this,"raycaster",[]);E(this,"lastPointerEvent",null);E(this,"objectsHoveredThisFrame",[]);E(this,"objectsHoveredLastFrame",[]);E(this,"raisedPointerDownEvents",[]);E(this,"_didMove",!1);E(this,"_tempComponentsArray",[]);E(this,"_sortedHits",[]);E(this,"_sortingBuffer",[]);E(this,"_noDepthTestingResults",[]);E(this,"handleEventsArray",[]);E(this,"currentActiveMeshUIComponents",[]);Ia.systems.push(this)}static createIfNoneExists(t){this.didSearchEventSystem||(this.didSearchEventSystem=!0,Ia.systems.length<=0&&Ia.systems.push(...Te.findObjectsOfType(Ia,t)));for(const i of Ia.systems)if(i.context===t)return;const n=new qt;Te.addNewComponent(n,Ia),t.scene.add(n)}static ensureUpdateMeshUI(t,n){bc.update(t,n)}static markUIDirty(t){bc.markDirty()}static get instance(){return this.systems[0]}onDestroy(){Ia.systems.splice(Ia.systems.indexOf(this),1)}start(){}register(t){var n;t&&this.raycaster&&!this.raycaster.includes(t)&&((n=this.raycaster)==null||n.push(t))}unregister(t){var i,r;const n=(i=this.raycaster)==null?void 0:i.indexOf(t);n!==void 0&&n!==-1&&((r=this.raycaster)==null||r.splice(n,1))}onEnable(){gs.addEventListener(Vl.SelectStart,(n,i)=>{if(!i.grab)return;bc.resetLastSelected();const r=new of;r.inputSource=n,r.isDown=n.selectionDown,r.isUp=n.selectionUp,r.isPressed=n.selectionPressed,r.isClicked=!1,i.grab&&!this.handleEvents(i.grab,r)&&(i.grab=null)});const t=new Wc;gs.addEventListener(Vl.SelectEnd,(n,i)=>{if(!i.grab)return;const r=new of;r.inputSource=n,r.isDown=n.selectionDown,r.isUp=n.selectionUp,r.isPressed=n.selectionPressed,r.isClicked=n.selectionClick,this.handleEvents(i.grab,r)}),gs.addEventListener(Vl.Update,n=>{t.ray=n.getRay();const i=this.performRaycast(t);if(!i)return;const r=new of;r.inputSource=n,this.handleIntersections(i,r)}),this.context.pre_update_callbacks.push(this.onBeforeUpdate.bind(this)),this.context.input.addEventListener(O2.PointerDown,this.onPointerDown.bind(this))}onDisable(){}onPointerDown(){this.onBeforeUpdate()}onBeforeUpdate(){var r,o;if(this.objectsHoveredThisFrame.length=0,this.resetMeshUIStates(),Ti.IsInWebXR||this.context.input.isKeyPressed(Dc.ALT))return;if(!this._didMove){const l=this.context.input.getPointerPositionRC(0);if(l&&l.x===0&&l.y===0)return;this._didMove=!0}const t=this.performRaycast(null),n=new of(this.context.input.getPointerEvent(0));if(n.inputSource=this.context.input,n.isClicked=this.context.input.mouseClick,n.isDown=this.context.input.mouseDown,n.isUp=this.context.input.mouseUp,n.isPressed=this.context.input.mousePressed,this.lastPointerEvent=n,!t)return;let i=null;this.context.input.mouseDown&&this.currentActiveMeshUIComponents.length>0&&this.context.mainCameraComponent&&(i=(r=Te.getComponent(this.context.mainCameraComponent.gameObject,Ff))!=null?r:null,i&&(i.enabled,i.enabled=!1)),this.handleIntersections(t,n),i&&(this.orbitControl=i,(o=this.orbitControl)!=null&&o.enabled?(this.orbitControlWasEnabled=this.orbitControl.enabled,this.orbitControl.enabled=!1):this.orbitControl&&!this.context.input.mousePressed&&(this.orbitControl.enabled=this.orbitControlWasEnabled,this.orbitControl=null))}onBeforeRender(){if(this.lastPointerEvent)this.lastPointerEvent.used=!1;else return;if(this.lastPointerEvent.isUp){for(const n of this.raisedPointerDownEvents)n.onPointerUp&&n.onPointerUp(this.lastPointerEvent);this.raisedPointerDownEvents.length=0}for(const n of this.objectsHoveredLastFrame)if(this.objectsHoveredThisFrame.indexOf(n)<0){this._tempComponentsArray.length=0;const i=Te.getComponentsInParent(n,Bt,this._tempComponentsArray);this.lastPointerEvent.object=n;for(let r=0;r<i.length;r++){const o=i[r];if(!o.gameObject||o.destroyed)continue;const l=o;l.onPointerExit&&l.onPointerExit(this.lastPointerEvent)}}const t=this.objectsHoveredLastFrame;this.objectsHoveredLastFrame=this.objectsHoveredThisFrame,this.objectsHoveredThisFrame=t}performRaycast(t){if(!this.raycaster)return null;this._sortedHits.length=0;for(const n of this.raycaster){if(!n.activeAndEnabled)continue;const i=n.performRaycast(t);i&&i.length>0&&this._sortedHits.push(...i)}return this._sortedHits.sort((n,i)=>n.distance-i.distance),this._sortedHits}handleIntersections(t,n){if(!t||t.length<=0)return!1;t=this.sortCandidates(t);for(const i of t){const{object:r}=i;if(this.handleEvents(r,n))return!0}return!1}sortCandidates(t){this._sortingBuffer.length=0,this._noDepthTestingResults.length=0;for(let n=0;n<t.length;n++){const i=t[n],r=i.object;if(r.material&&r.material.depthTest===!1){this._noDepthTestingResults.push(i);continue}this._sortingBuffer.push(i)}for(const n of this._sortingBuffer)this._noDepthTestingResults.push(n);return this._noDepthTestingResults}handleEvents(t,n){var l,h;if(!this.testIsVisible(t))return n.isClicked&&Kee&&console.log("not allowed",t),!1;n.object=t,this.lastPointerEvent=n;const i=t.parent;let r=!1;(l=n.isClicked)!=null;let o=null;if(i&&i.isUI){const u=(h=n.isPressed||n.isClicked)!=null?h:!1;if(i.shadowComponentOwner){const f=i.shadowComponentOwner.gameObject;if(f){if(o=this.tryFindCanvasGroup(f),(o==null?void 0:o.blocksRaycasts)===!1)return!1;if((o==null?void 0:o.interactable)===!1)return!0;this.handleMeshUIIntersection(t,u),t=f,r=!0}}if(!r&&this.handleMeshUiObjectWithoutShadowDom(i,u))return!0}if(this.objectsHoveredThisFrame.push(t),o===null||o.interactable){const u=this.objectsHoveredLastFrame.indexOf(t)>=0;this.handleEventsArray.length=0;const f=Te.getComponentsInParent(t,Bt,this.handleEventsArray);for(let g=0;g<f.length;g++){if(n.used)return!0;if(f[g].destroyed)continue;const m=f[g];m.interactable!==!1&&(m.onPointerEnter&&(u||m.onPointerEnter(n)),n.isDown&&m.onPointerDown&&!this.raisedPointerDownEvents.includes(m)&&(m.onPointerDown(n),this.raisedPointerDownEvents.push(m)),n.isUp&&m.onPointerUp&&m.onPointerUp(n),n.isClicked&&m.onPointerClick&&m.onPointerClick(n))}}return!0}handleMeshUiObjectWithoutShadowDom(t,n){return!t||!t.isUI?!0:this.handleMeshUIIntersection(t,n)}handleMeshUIIntersection(t,n){const i=bc.updateState(t,n);return i&&this.currentActiveMeshUIComponents.push(i),i!==null}resetMeshUIStates(){if(this.context.input.getPointerPressedCount()>0&&bc.resetLastSelected(),!(!this.currentActiveMeshUIComponents||this.currentActiveMeshUIComponents.length<=0)){for(let t=0;t<this.currentActiveMeshUIComponents.length;t++){const n=this.currentActiveMeshUIComponents[t];bc.resetState(n)}this.currentActiveMeshUIComponents.length=0}}testIsVisible(t){return t?Te.isActiveSelf(t)?this.testIsVisible(t.parent):!1:!0}tryFindCanvasGroup(t){if(!t)return null;const n=Te.foreachComponent(t,i=>{const r=i;if(r.blocksRaycasts!==void 0&&r.interactable!==void 0)return r},!1);return n!==void 0?n:this.tryFindCanvasGroup(t.parent)}};let aa=Ia;E(aa,"didSearchEventSystem",!1),E(aa,"systems",[]);class bc{static markDirty(){this.needsUpdate=!0}static update(e,t){for(const n of this.lastUpdateFrame)if(n.context===t){if(t.time.frameCount===n.frame)return;n.frame=t.time.frameCount,(this.needsUpdate||t.time.frameCount<30)&&(this.needsUpdate=!1,e.update());return}this.lastUpdateFrame=[{context:t,frame:t.time.frameCount}],e.update()}static updateState(e,t){let n=null;if(e&&(n=this.findBlockInParent(e),n&&n!==this.lastSelected)){if(n.interactable===!1)return null;t?(this.lastSelected=n,n.states.pressed&&n.setState("pressed")):n.states.hovered&&n.setState("hovered"),this.needsUpdate=!0}return n}static resetLastSelected(){const e=this.lastSelected;!e||(this.lastSelected=null,this.resetState(e))}static resetState(e){if(!e)return;e.interactable===!1?e.states.disabled&&e.setState("disabled"):e===this.lastSelected&&e.states.selected?e.setState("selected"):e.setState("normal"),this.needsUpdate=!0}static findBlockInParent(e){return e?e.isBlock&&Object.keys(e.states).length>0?e:this.findBlockInParent(e.parent):null}}E(bc,"lastSelected",null),E(bc,"lastUpdateFrame",[]),E(bc,"needsUpdate",!1);const um="./include";_M.prototype.interactable={get(){return this.interactive},set(a){this.interactable=a}};class Qc extends Bt{constructor(){super(...arguments);E(this,"shadowComponent",null);E(this,"_controlsChildLayout",!0);E(this,"_root");E(this,"_parentComponent")}isRoot(){var t;return((t=this.Root)==null?void 0:t.gameObject)===this.gameObject}markDirty(){aa.markUIDirty(this.context)}get controlsChildLayout(){return this._controlsChildLayout}set controlsChildLayout(t){this._controlsChildLayout=t,this.shadowComponent&&(this.shadowComponent.autoLayout=t)}get Root(){return this._root===void 0&&(this._root=Te.getComponentInParent(this.gameObject,Ov)),this._root}onEnable(){super.onEnable()}addShadowComponent(t,n){var r,o;this.removeShadowComponent();const i=this.isRoot()?this.gameObject:this.gameObject.parent;if(this._parentComponent=Te.getComponentInParent(i,Qc),!this._parentComponent){console.warn(`Component "${this.name}" doesn't have a UI parent anywhere. Do you have a UI element outside a Canvas?`,this);return}if(t.name=this.name+" ("+((r=this.constructor.name)!=null?r:"UI")+")",t.autoLayout=this._parentComponent.controlsChildLayout,t.shadowComponentOwner=this,t.traverse(l=>{l.shadowComponentOwner===void 0&&(l.shadowComponentOwner=this)}),((o=this.Root)==null?void 0:o.gameObject)===this.gameObject)this.gameObject.add(t);else{let l=this._parentComponent.shadowComponent;l&&(l==null||l.add(t))}this.shadowComponent=t,n&&n.shadowComponent&&this.shadowComponent&&n.shadowComponent.add(this.shadowComponent),Fg&&t.add(new Lg(.5)),this.onAfterAddedToScene()}set(t){}traverseOwnedShadowComponents(t,n,i){if(!!t&&t.shadowComponentOwner===n){i(t);for(const r of t.children)this.traverseOwnedShadowComponents(r,n,i)}}removeShadowComponent(){this.shadowComponent&&this.shadowComponent.removeFromParent()}onAfterAddedToScene(){}setInteractable(t){this.shadowComponent&&(this.shadowComponent.interactable=t)}}class Ov extends Qc{awake(){super.awake()}}var $ee=Object.defineProperty,ete=Object.getOwnPropertyDescriptor,Fv=(a,e,t,n)=>{for(var i=n>1?void 0:n?ete(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&$ee(e,t,i),i};const uB=jt("debugui");class q3{constructor(){E(this,"width");E(this,"height")}}class yM{constructor(){E(this,"x");E(this,"y");E(this,"width");E(this,"height")}}class uh extends Qc{constructor(){super(...arguments);E(this,"offset",.01);E(this,"_anchoredPosition");E(this,"rect");E(this,"sizeDelta");E(this,"anchoredPosition3D");E(this,"pivot");E(this,"lastMatrix");E(this,"rectBlock");E(this,"_transformNeedsUpdate",!1);E(this,"_createdBlocks",[])}get translation(){return this.gameObject.position}get rotation(){return this.gameObject.quaternion}get scale(){return this.gameObject.scale}get anchoredPosition(){return this._anchoredPosition||(this._anchoredPosition=new q),this._anchoredPosition}awake(){super.awake(),this.lastMatrix=new xn,this.rectBlock=new qt,this.rectBlock.position.z=.1,this.rectBlock.name=this.name,this._anchoredPosition||(this._anchoredPosition=new q),vS(this,"_anchoredPosition",()=>{this._transformNeedsUpdate=!0})}onEnable(){super.onEnable(),this.addShadowComponent(this.rectBlock),this._transformNeedsUpdate=!0}onDisable(){super.onDisable(),this.removeShadowComponent()}applyTransform(){const t=this.shadowComponent;!t||(this._transformNeedsUpdate=!1,this.isRoot()?t.rotation.y=Math.PI:(t.position.copy(this.gameObject.position),t.position.x*=-1,t.position.z*=-1,t.position.z-=this.offset,t.quaternion.copy(this.gameObject.quaternion),t.rotation.x*=-1,t.rotation.z*=-1,t.scale.copy(this.gameObject.scale)),this.applyAnchoring(t.position),this.lastMatrix.copy(this.gameObject.matrix))}markDirty(){this._transformNeedsUpdate=!0}onBeforeRender(){(this._transformNeedsUpdate||this.lastMatrix.equals(this.gameObject.matrix)===!1)&&(uB&&console.log("updating",this.name),this.applyTransform()),aa.ensureUpdateMeshUI(Zee,this.context)}applyAnchoring(t){if(this.pivot&&this.sizeDelta){let n=this.pivot.x*2-1,i=this.pivot.y*2-1;i-=this.anchoredPosition.y*.05;const r=this.sizeDelta.x*n,o=this.sizeDelta.y*i;t.x-=r*.5,t.y-=o*.5}}getBasicOptions(){const t={width:this.rect.width,height:this.rect.height,offset:this.offset,backgroundOpacity:0,borderWidth:0,borderRadius:0,borderOpacity:0};return this.ensureValidSize(t),t}ensureValidSize(t,n=1e-4){return t.width<=0&&(t.width=n),t.height<=0&&(t.height=1e-4),t}createNewBlock(t){t={...this.getBasicOptions(),...t},uB&&console.log(this.name,t);const n=new _M(t);return this._createdBlocks.push(n),n}}Fv([Re(yM)],uh.prototype,"rect",2);Fv([Re(Xe)],uh.prototype,"sizeDelta",2);Fv([Re(q)],uh.prototype,"anchoredPosition3D",2);Fv([Re(Xe)],uh.prototype,"pivot",2);var tte=Object.defineProperty,nte=Object.getOwnPropertyDescriptor,X3=(a,e,t,n)=>{for(var i=n>1?void 0:n?nte(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&tte(e,t,i),i};class Uu extends Qc{constructor(){super(...arguments);E(this,"raycastTarget",!0);E(this,"uiObject",null);E(this,"_color",null);E(this,"_rect",null);E(this,"_currentlyCreatingPanel",!1)}get color(){return this._color||(this._color=new oo(1,1,1,1)),this._color}set color(t){(!this._color||this._color.r!==t.r||this._color.g!==t.g||this._color.b!==t.b||this._color.alpha!==t.alpha)&&(this._color||(this._color=new oo(1,1,1,1)),this._color.copy(t))}onColorChanged(){const t=this.color;this.setOptions({backgroundColor:t,backgroundOpacity:t.alpha,borderOpacity:t.alpha})}get m_Color(){return this._color}get rectTransform(){return this._rect||(this._rect=this.gameObject.getComponent(uh)),this._rect}setState(t){this.makePanel(),this.uiObject&&this.uiObject.setState(t)}setupState(t){this.makePanel(),this.uiObject&&this.uiObject.setupState(t)}setOptions(t){var n;this.makePanel(),this.uiObject&&(this.uiObject.set(t),(t.backgroundColor!==void 0||t.backgroundOpacity!==void 0)&&((n=this.uiObject.updateBackgroundMaterial)==null||n.call(this.uiObject)))}awake(){super.awake(),this.makePanel(),vS(this,"_color",()=>aZ(this,this.onColorChanged))}onEnable(){var t;super.onEnable(),this.uiObject&&((t=this.rectTransform.shadowComponent)==null||t.add(this.uiObject),this.addShadowComponent(this.uiObject,this.rectTransform))}onDisable(){super.onDisable(),this.uiObject&&this.removeShadowComponent()}makePanel(){if(this.uiObject||this._currentlyCreatingPanel)return;this._currentlyCreatingPanel=!0;const t={backgroundColor:this.color,backgroundOpacity:this.color.alpha,offset:1};this.onBeforeCreate(t),this.onCreate(t),this.controlsChildLayout=!1,this._currentlyCreatingPanel=!1,this.onAfterCreated()}onBeforeCreate(t){}onCreate(t){this.uiObject=this.rectTransform.createNewBlock(t),this.uiObject.name=this.name}onAfterCreated(){}async setTexture(t){!t||(this.setOptions({backgroundOpacity:0}),t&&this.setOptions({backgroundTexture:t,borderRadius:0,backgroundOpacity:this.color.alpha,backgroundSize:"stretch"}))}onAfterAddedToScene(){this.shadowComponent&&(this.shadowComponent.offset=this.shadowComponent.position.z)}}X3([Re(oo)],Uu.prototype,"color",1);X3([Re()],Uu.prototype,"raycastTarget",2);class kv extends Uu{onAfterCreated(){this.uiObject&&(this.uiObject.scale.y*=-1)}}var ite=Object.defineProperty,ste=Object.getOwnPropertyDescriptor,vM=(a,e,t,n)=>{for(var i=n>1?void 0:n?ste(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&ite(e,t,i),i};class Y3{constructor(){E(this,"texture");E(this,"rect")}}vM([Re(Vi)],Y3.prototype,"texture",2);class Nv extends kv{constructor(){super(...arguments);E(this,"sprite")}isBuiltinSprite(){var t,n,i,r,o,l,h,u;switch((n=(t=this.sprite)==null?void 0:t.texture)==null?void 0:n.name){case"InputFieldBackground":case"UISprite":case"Background":return!0}return((o=(r=(i=this.sprite)==null?void 0:i.texture)==null?void 0:r.image)==null?void 0:o.width)===32&&((u=(h=(l=this.sprite)==null?void 0:l.texture)==null?void 0:h.image)==null?void 0:u.height)===32}onBeforeCreate(t){this.isBuiltinSprite()&&(t.borderRadius=5,t.borderColor=new _e(.4,.4,.4),t.borderOpacity=this.color.alpha,t.borderWidth=.3)}onAfterCreated(){var t;super.onAfterCreated(),!this.isBuiltinSprite()&&this.setTexture((t=this.sprite)==null?void 0:t.texture)}}vM([Re(Y3)],Nv.prototype,"sprite",2);class xM extends kv{constructor(){super(...arguments);E(this,"mainTexture")}onAfterCreated(){super.onAfterCreated(),this.setTexture(this.mainTexture)}}vM([Re(Vi)],xM.prototype,"mainTexture",2);var rte=Object.defineProperty,ote=Object.getOwnPropertyDescriptor,tp=(a,e,t,n)=>{for(var i=n>1?void 0:n?ote(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&rte(e,t,i),i};const Qd=jt("debugbutton");class dh extends Bt{constructor(){super(...arguments);E(this,"onClick");E(this,"_isHovered",!1);E(this,"colors");E(this,"transition");E(this,"animationTriggers");E(this,"animator");E(this,"_interactable",!0);E(this,"_requestedAnimatorTrigger");E(this,"_isInit",!1);E(this,"_image")}onPointerEnter(t){var n,i;Qd&&console.log("Button Enter",(n=this.animationTriggers)==null?void 0:n.highlightedTrigger,this.animator),this._isHovered=!0,this.transition==3&&this.animationTriggers&&this.animator?this.animator.SetTrigger(this.animationTriggers.highlightedTrigger):this.transition===1&&this.colors&&((i=this._image)==null||i.setState("hovered"))}onPointerExit(){var t,n;Qd&&console.log("Button Exit",(t=this.animationTriggers)==null?void 0:t.highlightedTrigger,this.animator),this._isHovered=!1,this.transition==3&&this.animationTriggers&&this.animator?this.animator.SetTrigger(this.animationTriggers.normalTrigger):this.transition===1&&this.colors&&((n=this._image)==null||n.setState("normal"))}onPointerDown(t){var n,i;Qd&&console.log("Button Down",(n=this.animationTriggers)==null?void 0:n.highlightedTrigger,this.animator),this.transition==3&&this.animationTriggers&&this.animator?this.animator.SetTrigger(this.animationTriggers.pressedTrigger):this.transition===1&&this.colors&&((i=this._image)==null||i.setState("pressed"))}onPointerUp(t){var n,i;Qd&&console.log("Button Down",(n=this.animationTriggers)==null?void 0:n.highlightedTrigger,this.animator),this.transition==3&&this.animationTriggers&&this.animator?this.animator.SetTrigger(this._isHovered?this.animationTriggers.highlightedTrigger:this.animationTriggers.normalTrigger):this.transition===1&&this.colors&&((i=this._image)==null||i.setState(this._isHovered?"hovered":"normal"))}onPointerClick(t){var n;Qd&&console.trace("Button Click",this.onClick),(n=this.onClick)==null||n.invoke()}set interactable(t){this._interactable=t,this._image&&(this._image.setInteractable(t),t?this._image.setState("normal"):this._image.setState("disabled"))}get interactable(){return this._interactable}set_interactable(t){this.interactable=t}awake(){super.awake(),Qd&&console.log(this),this.init()}start(){var t;(t=this._image)==null||t.setInteractable(this.interactable)}onEnable(){super.onEnable()}*setAnimatorTriggerAtEndOfFrame(t){var n;this._requestedAnimatorTrigger=t,yield,yield,this._requestedAnimatorTrigger==t&&((n=this.animator)==null||n.SetTrigger(t))}init(){this._isInit||(this._isInit=!0,this._image=Te.getComponent(this.gameObject,Nv),this._image&&(this.stateSetup(this._image),this.interactable?this._image.setState("normal"):this._image.setState("disabled")))}stateSetup(t){var A,v,w,b,S;t.setInteractable(this.interactable);const n=this.getFinalColor(t.color,(A=this.colors)==null?void 0:A.normalColor),i={state:"normal",attributes:{backgroundColor:n,backgroundOpacity:n.alpha}};t.setupState(i);const r=this.getFinalColor(t.color,(v=this.colors)==null?void 0:v.highlightedColor),o={state:"hovered",attributes:{backgroundColor:r,backgroundOpacity:r.alpha}};t.setupState(o);const l=this.getFinalColor(t.color,(w=this.colors)==null?void 0:w.pressedColor),h={state:"pressed",attributes:{backgroundColor:l,backgroundOpacity:l.alpha}};t.setupState(h);const u=this.getFinalColor(t.color,(b=this.colors)==null?void 0:b.selectedColor),f={state:"selected",attributes:{backgroundColor:u,backgroundOpacity:u.alpha}};t.setupState(f);const g=this.getFinalColor(t.color,(S=this.colors)==null?void 0:S.disabledColor),m={state:"disabled",attributes:{backgroundColor:g,backgroundOpacity:g.alpha}};t.setupState(m)}getFinalColor(t,n){return n?t.clone().multiply(n):t.clone()}}tp([Re(ua)],dh.prototype,"onClick",2);tp([Re()],dh.prototype,"colors",2);tp([Re()],dh.prototype,"transition",2);tp([Re()],dh.prototype,"animationTriggers",2);tp([Re(rh)],dh.prototype,"animator",2);tp([Re()],dh.prototype,"interactable",1);var ate=Object.defineProperty,cte=Object.getOwnPropertyDescriptor,zu=(a,e,t,n)=>{for(var i=n>1?void 0:n?cte(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&ate(e,t,i),i};const J3=class extends Ov{constructor(){super(...arguments);E(this,"_renderOnTop",!1);E(this,"_depthWrite",!1);E(this,"_doubleSided",!0);E(this,"_castShadows",!0);E(this,"_receiveShadows",!0);E(this,"_renderMode",-1);E(this,"_rootCanvas");E(this,"previousAspect",-1);E(this,"_updateRenderSettingsRoutine");E(this,"_activeRenderMode",-1)}set renderOnTop(e){e!==this._renderOnTop&&(this._renderOnTop=e,this.onRenderSettingsChanged())}get renderOnTop(){return this._renderOnTop}set depthWrite(e){this._depthWrite!==e&&(this._depthWrite=e,this.onRenderSettingsChanged())}get depthWrite(){return this._depthWrite}set doubleSided(e){this._doubleSided!==e&&(this._doubleSided=e,this.onRenderSettingsChanged())}get doubleSided(){return this._doubleSided}set castShadows(e){this._castShadows!==e&&(this._castShadows=e,this.onRenderSettingsChanged())}get castShadows(){return this._castShadows}set receiveShadows(e){this._receiveShadows!==e&&(this._receiveShadows=e,this.onRenderSettingsChanged())}get receiveShadows(){return this._receiveShadows}get renderMode(){return this._renderMode}set renderMode(e){this._renderMode!==e&&(this._renderMode=e,this.onRenderSettingsChanged())}set rootCanvas(e){this._rootCanvas instanceof J3||(this._rootCanvas=e)}get rootCanvas(){return this._rootCanvas}awake(){this.shadowComponent=this.gameObject,super.awake()}onEnable(){super.onEnable(),this._updateRenderSettingsRoutine=void 0,this.onRenderSettingsChanged()}onBeforeRender(){this.isScreenSpace&&this.context.mainCameraComponent&&this.context.mainCameraComponent.aspect!==this.previousAspect&&(this.previousAspect=this.context.mainCameraComponent.aspect,this.updateRenderMode())}onRenderSettingsChanged(){this._updateRenderSettingsRoutine||(this._updateRenderSettingsRoutine=this.startCoroutine(this._updateRenderSettingsDelayed(),No.OnBeforeRender))}*_updateRenderSettingsDelayed(){if(yield,this._updateRenderSettingsRoutine=void 0,this.shadowComponent){this.updateRenderMode(),ry(this.shadowComponent,this);for(const e of this.gameObject.getComponentsInChildren(Qc))ry(e.shadowComponent,this)}}get isScreenSpace(){return this._activeRenderMode===1||this._activeRenderMode===0}updateRenderMode(){if(this.renderMode!==this._activeRenderMode)switch(this.renderMode){case 0:case 1:const e=this.context.mainCameraComponent;if(!e)return;const t=this.gameObject,n=e.gameObject;n==null||n.add(t);const i=e.farClipPlane;t.position.x=0,t.position.y=0,t.position.z=-i;const r=Math.tan(Ei.toRadians(e.fieldOfView)*i)*(e.aspect*1.333333),o=r*(this.context.domHeight/this.context.domWidth);t.scale.x=-r,t.scale.y=o;break}}};let da=J3;zu([Re()],da.prototype,"renderOnTop",1);zu([Re()],da.prototype,"depthWrite",1);zu([Re()],da.prototype,"doubleSided",1);zu([Re()],da.prototype,"castShadows",1);zu([Re()],da.prototype,"receiveShadows",1);zu([Re()],da.prototype,"renderMode",1);zu([Re(da)],da.prototype,"rootCanvas",1);var lte=Object.defineProperty,hte=Object.getOwnPropertyDescriptor,wM=(a,e,t,n)=>{for(var i=n>1?void 0:n?hte(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&lte(e,t,i),i};class eA extends Bt{constructor(){super(...arguments);E(this,"_alpha",1);E(this,"interactable",!0);E(this,"blocksRaycasts",!0);E(this,"_isDirty",!1);E(this,"_buffer",[])}get alpha(){return this._alpha}set alpha(t){t!==this._alpha&&(this._alpha=t,this.markDirty())}markDirty(){this._isDirty||(this._isDirty=!0,this.startCoroutine(this.applyChangesDelayed(),No.OnBeforeRender))}*applyChangesDelayed(){this._isDirty=!1,this.applyChangesNow()}applyChangesNow(){for(const t of Te.getComponentsInChildren(this.gameObject,Uu,this._buffer)){const n=t.color;n.alpha=this._alpha,t.color=n}}}wM([Re()],eA.prototype,"alpha",1);wM([Re()],eA.prototype,"interactable",2);wM([Re()],eA.prototype,"blocksRaycasts",2);var ute=Object.defineProperty,dte=Object.getOwnPropertyDescriptor,Ya=(a,e,t,n)=>{for(var i=n>1?void 0:n?dte(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&ute(e,t,i),i};const fte=jt("debugtext");class Qr extends Uu{constructor(){super(...arguments);E(this,"canvas");E(this,"alignment",0);E(this,"verticalOverflow",0);E(this,"horizontalOverflow",0);E(this,"lineSpacing",1);E(this,"supportRichText",!1);E(this,"font");E(this,"fontStyle",0);E(this,"_isWaitingForRebuild",!1);E(this,"_text","");E(this,"_fontSize",12);E(this,"_textMeshUi",null);E(this,"_textContainer",null);E(this,"_didHandleTextRenderOnTop",!1)}get text(){return this._text}set text(t){if(this._text=t,!this._textMeshUi&&this._text.length>0&&this.context.time.frame>0&&this.createText(t,this.getTextOpts(),this.supportRichText),this._textMeshUi){if(this._textMeshUi.length>1){this.requestRebuild();return}this._textMeshUi[0].set({content:t}),this.markDirty()}}set_text(t){this.text=t}get fontSize(){return this._fontSize}set fontSize(t){if(this._fontSize=t,this._textMeshUi){if(this._textMeshUi.length>1){this.requestRebuild();return}this._textMeshUi[0].set({content:t}),this.markDirty()}}onColorChanged(){if(this._textMeshUi){if(this._textMeshUi.length>1){this.requestRebuild();return}const t=this.color;this._textMeshUi[0].set({fontColor:t,fontOpacity:t.alpha}),this.markDirty()}}requestRebuild(){this._isWaitingForRebuild||(this._isWaitingForRebuild=!0,this.startCoroutine(this.rebuildDelayedRoutine(),No.EarlyUpdate))}*rebuildDelayedRoutine(){if(this._isWaitingForRebuild=!1,this._textMeshUi){for(const t of this._textMeshUi)t.removeFromParent();this._textMeshUi.length=0}this.createText(this.text,this.getTextOpts(),this.supportRichText),this.markDirty()}onCreate(t){fte&&console.log(this);const n=this.verticalOverflow==0&&this.horizontalOverflow==0;n&&(this.context.renderer.localClippingEnabled=!0);const i=this.rectTransform;this._textContainer=this.uiObject=this.createBlock(i,n,null,!0),this.createText(this.text,this.getTextOpts(),this.supportRichText),this.uiObject,this.uiObject=this.createBlock(i,n,this.uiObject,!1)}onAfterAddedToScene(){super.onAfterAddedToScene(),this.handleTextRenderOnTop()}getTextOpts(){var n;const t={content:this.text,fontColor:this.color,fontOpacity:this.color.alpha,fontSize:this.fontSize,fontKerning:"normal"};return this.font=(n=this.font)==null?void 0:n.toLocaleLowerCase(),this.setFont(t,this.fontStyle),t}onEnable(){super.onEnable(),this._didHandleTextRenderOnTop=!1,this.uiObject&&(this.uiObject.onAfterUpdate=this.updateWidth.bind(this))}createBlock(t,n,i,r=!1){const o={};o.hiddenOverflow=n,o.interLine=(this.lineSpacing-1)*this.fontSize*1.333,this.getAlignment(o,r);const l=t.createNewBlock(o);return i&&(Array.isArray(i)?l.add(...i):l.add(i)),l}getAlignment(t,n=!1){switch(n||(t.contentDirection="row"),this.alignment){default:case 0:case 1:case 2:t.justifyContent="start";break;case 3:case 4:case 5:t.justifyContent="center";break;case 6:case 7:case 8:t.justifyContent="end";break}switch(this.alignment){case 0:case 3:case 6:t.alignContent=n?"left":"top";break;case 1:case 4:case 7:t.alignContent="center";break;case 2:case 5:case 8:t.alignContent=n?"right":"bottom";break}return t}updateWidth(){this.horizontalOverflow===1&&setTimeout(()=>{if(!this._textMeshUi)return;const t=this._textMeshUi[0].parent;if(!!t&&t.lines){let n=t.lines.reduce((i,r)=>i+r.width,0);n+=t.getFontSize()*5,n+=t.padding*2||0,n+=this.fontSize*1.5,t.set({width:n}),this.ensureShadowComponentOwner()}},1)}ensureShadowComponentOwner(){this.shadowComponent&&this.shadowComponent.traverse(t=>{t.shadowComponentOwner===void 0&&(t.shadowComponentOwner=this)})}createText(t,n,i){if(!(!t||t.length<=0))if(this._textMeshUi||(this._textMeshUi=[]),i){let r=this.getNextTag(t);if(r)r.startIndex>0&&this.createText(t.substring(0,r.startIndex),n,!1);else return this.createText(t,n,!1);const o=[];for(;r;){const l=this.getNextTag(t,r.endIndex);if(l){const h=this.getText(t,r,l);this.handleTag(r,n,o),this.createText(h,n,!1)}else{const h=t.substring(r.endIndex);this.handleTag(r,n,o),this.createText(h,n,!1)}r=l}}else{const r={...n};r.content=t;const o=new j3(r);this._textMeshUi.push(o),this._textContainer&&this._textContainer.add(o)}}handleTextRenderOnTop(){this._didHandleTextRenderOnTop||(this._didHandleTextRenderOnTop=!0,this.startCoroutine(this.renderOnTopCoroutine()))}*renderOnTopCoroutine(){if(!this.canvas)return;const t=[],n=this.canvas,i={renderOnTop:n.renderOnTop,depthWrite:n.depthWrite,doubleSided:n.doubleSided};for(;;){let r=!1;if(this._textMeshUi)for(let o=0;o<this._textMeshUi.length;o++){if(t[o]===!0)continue;r=!0;const l=this._textMeshUi[o];!l.textContent||(ry(l,i),t[o]=!0)}if(!r)break;yield}}handleTag(t,n,i){if(t.isEndTag){if(i.length>0){const r=i.pop();if(r)for(const o in r.previousValues){const l=r.previousValues[o];n[o]=l}}}else if(t.type.includes("color")){const r=new Mb(t,{fontColor:n.fontColor});if(i.push(r),t.type.length>6){const o=t.type.substring(6);n.fontColor=pte(o)}else n.fontColor=new _e(1,1,1)}else if(t.type=="b"){const r=new Mb(t,{fontFamily:n.fontFamily,fontTexture:n.fontTexture});i.push(r),this.setFont(n,1)}else if(t.type=="i"){const r=new Mb(t,{fontFamily:n.fontFamily,fontTexture:n.fontTexture});i.push(r),this.setFont(n,2)}}getText(t,n,i){return t.substring(n.endIndex,i.startIndex)}getNextTag(t,n=0){const i=t.indexOf("<",n),r=t.indexOf(">",i);if(i>=0&&r>=0){const o=t.substring(i+1,r);return{type:o,startIndex:i,endIndex:r+1,isEndTag:o.startsWith("/")}}return null}setFont(t,n){const i=this.getFontName(n);let r=i;r!=null&&r.endsWith("-msdf.json")||(r+="-msdf.json"),t.fontFamily=r;let o=i;o!=null&&o.endsWith(".png")||(o+=".png"),t.fontTexture=o}getFontName(t){return this.font?this.font:null}}Ya([Re(da)],Qr.prototype,"canvas",2);Ya([Re()],Qr.prototype,"alignment",2);Ya([Re()],Qr.prototype,"verticalOverflow",2);Ya([Re()],Qr.prototype,"horizontalOverflow",2);Ya([Re()],Qr.prototype,"lineSpacing",2);Ya([Re()],Qr.prototype,"supportRichText",2);Ya([Re()],Qr.prototype,"font",2);Ya([Re()],Qr.prototype,"fontStyle",2);Ya([Re()],Qr.prototype,"text",1);Ya([Re()],Qr.prototype,"fontSize",1);class Mb{constructor(e,t){E(this,"tag");E(this,"previousValues");this.tag=e,this.previousValues=t}}function pte(a){if(a.startsWith("#")){const t=a.substring(1);var e=parseInt(t,16);const n=e>>16&255,i=e>>8&255,r=e&255;return new _e(n/255,i/255,r/255)}switch(a){case"black":return new _e(0,0,0);case"white":return new _e(1,1,1);case"red":return new _e(1,0,0);case"lime":return new _e(0,1,0);case"blue":return new _e(0,0,1);case"yellow":return new _e(1,1,0);case"cyan":return new _e(0,1,1);case"magenta":return new _e(1,0,1);case"silver":return new _e(.75,.75,.75);case"gray":return new _e(.5,.5,.5);case"maroon":return new _e(.5,0,0);case"olive":return new _e(.5,.5,0);case"green":return new _e(0,.5,0);case"purple":return new _e(.5,0,.5);case"teal":return new _e(0,.5,.5);case"navy":return new _e(0,0,.5);case"darkred":return new _e(.54,0,0);case"brown":return new _e(.55,.27,0);case"firebrick":return new _e(.69,.13,.13);case"crimson":return new _e(.86,.08,.24);case"tomato":return new _e(1,.39,.28);case"coral":return new _e(1,.49,.31);case"indianred":return new _e(.6,.31,.51);case"lightcoral":return new _e(.94,.5,.5);case"darkorange":return new _e(1,.55,0);case"orange":return new _e(1,.65,0);case"gold":return new _e(1,.84,0);case"darkgoldenrod":return new _e(.72,.53,.04);case"goldenrod":return new _e(.85,.65,.13);case"palegoldenrod":return new _e(.93,.87,.67);case"darkkhaki":return new _e(.74,.7,.42);case"khaki":return new _e(.94,.9,.55);case"yellowgreen":return new _e(.6,.8,.19);case"darkolivegreen":return new _e(.33,.42,.18);case"olivedrab":return new _e(.42,.56,.14);case"lawngreen":return new _e(.49,.99,0);case"chartreuse":return new _e(.5,1,0);case"greenyellow":return new _e(.68,1,.18);case"darkgreen":return new _e(0,.39,0);case"forestgreen":return new _e(.13,.55,.13);case"limegreen":return new _e(.19,.8,.19);case"lightgreen":return new _e(.56,.93,.56);case"palegreen":return new _e(.59,.98,.59);case"darkseagreen":return new _e(.56,.74,.56);case"mediumspringgreen":return new _e(0,.98,.6);case"springgreen":return new _e(0,1,.5);case"seagreen":return new _e(.18,.31,.31);case"mediumaquamarine":return new _e(.4,.8,.66);case"mediumseagreen":return new _e(.24,.7,.44);case"lightseagreen":return new _e(.13,.7,.67);case"darkslategray":return new _e(.18,.31,.31);case"darkcyan":return new _e(0,.55,.55);case"aqua":return new _e(0,1,1);case"lightcyan":return new _e(.8,1,1);case"darkturquoise":return new _e(0,.81,.82);case"turquoise":return new _e(0,.82,.82);case"mediumturquoise":return new _e(.28,.82,.8);case"paleturquoise":return new _e(.68,1,.93);case"aquamarine":return new _e(.5,1,.83);case"powderblue":return new _e(.69,.88,.9);case"cadetblue":return new _e(.37,.62,.63);case"steelblue":return new _e(.27,.51,.71);case"cornflowerblue":return new _e(.39,.58,.93);case"deepskyblue":return new _e(0,.7,1);case"dodgerblue":return new _e(.12,.56,1);case"lightblue":return new _e(.68,.85,.9);case"skyblue":return new _e(.53,.81,.92);case"lightskyblue":return new _e(.53,.81,.98);case"midnightblue":return new _e(.18,.18,.31);case"darkblue":return new _e(0,0,.55);case"mediumblue":return new _e(0,0,.82);case"royalblue":return new _e(.25,.41,.88);case"blueviolet":return new _e(.54,.17,.89);case"indigo":return new _e(.29,0,.51);case"darkslateblue":return new _e(.28,.24,.55);case"slateblue":return new _e(.42,.35,.8);case"mediumslateblue":return new _e(.48,.41,.9);case"mediumpurple":return new _e(.58,.44,.86);case"darkmagenta":return new _e(.55,0,.55);case"darkviolet":return new _e(.58,0,.83);case"darkorchid":return new _e(.6,.2,.8);case"mediumorchid":return new _e(.73,.33,.83);case"thistle":return new _e(.84,.75,.85);case"plum":return new _e(.87,.63,.87);case"violet":return new _e(.93,.51,.93);case"fuchsia":return new _e(1,0,1);case"orchid":return new _e(.85,.44,.84);case"mediumvioletred":return new _e(.78,.08,.52);case"palevioletred":return new _e(.86,.44,.58);case"hotpink":return new _e(1,.4,.71);case"deeppink":return new _e(1,.08,.58);case"lightpink":return new _e(1,.71,.76);case"pink":return new _e(1,.75,.78);case"antiquewhite":return new _e(.98,.92,.84);case"beige":return new _e(.96,.96,.86);case"bisque":return new _e(1,.89,.77);case"blanchedalmond":return new _e(1,.92,.82);case"wheat":return new _e(.96,.87,.87);case"cornsilk":return new _e(1,.97,.86);case"lemonchiffon":return new _e(1,.98,.8);case"lightgoldenrodyellow":return new _e(.98,.98,.82);case"lightyellow":return new _e(1,1,.8);case"saddlebrown":return new _e(.55,.27,.07);case"sienna":return new _e(.63,.32,.18);case"chocolate":return new _e(.82,.41,.12);case"peru":return new _e(.82,.52,.25);case"sandybrown":return new _e(.96,.64,.38);case"burlywood":return new _e(.87,.72,.53);case"tan":return new _e(.82,.71,.55);case"rosybrown":return new _e(.74,.56,.56);case"moccasin":return new _e(1,.89,.71);case"navajowhite":return new _e(1,.87,.68);case"peachpuff":return new _e(1,.85,.73);case"mistyrose":return new _e(1,.89,.88);case"lavenderblush":return new _e(1,.94,.93);case"linen":return new _e(.98,.94,.9);case"oldlace":return new _e(.99,.96,.9);case"papayawhip":return new _e(1,.94,.84);case"seashell":return new _e(1,.96,.93);case"mintcream":return new _e(.98,1,.98);case"slategray":return new _e(.44,.5,.56);case"lightslategray":return new _e(.47,.53,.6);case"lightsteelblue":return new _e(.69,.77,.87);case"lavender":return new _e(.9,.9,.98);case"floralwhite":return new _e(1,.98,.98);case"aliceblue":return new _e(.94,.97,1);case"ghostwhite":return new _e(.97,.97,1);case"honeydew":return new _e(.94,1,.94);case"ivory":return new _e(1,1,.94);case"azure":return new _e(.94,1,1);case"snow":return new _e(1,.98,.98);case"dimgray":return new _e(.4,.4,.4);case"darkgray":return new _e(.66,.66,.66);case"lightgray":return new _e(.83,.83,.83);case"gainsboro":return new _e(.86,.86,.86);case"whitesmoke":return new _e(.96,.96,.96)}return new _e(1,1,1)}var mte=Object.defineProperty,gte=Object.getOwnPropertyDescriptor,Uv=(a,e,t,n)=>{for(var i=n>1?void 0:n?gte(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&mte(e,t,i),i};const Jh=jt("debuginputfield");var pm;const jn=(pm=class extends Bt{constructor(){super(...arguments);E(this,"textComponent");E(this,"placeholder");E(this,"onValueChanged");E(this,"onEndEdit");E(this,"inputEventFn")}get text(){var e,t;return(t=(e=this.textComponent)==null?void 0:e.text)!=null?t:""}get isFocused(){return jn.active===this}start(){Jh&&console.log(this.name,this)}onEnable(){var e;jn.htmlField||(jn.htmlField=document.createElement("input"),jn.htmlField.classList.add("ar"),document.body.appendChild(jn.htmlField)),this.inputEventFn||(this.inputEventFn=this.onInput.bind(this)),jn.htmlField.addEventListener("keyup",this.inputEventFn),this.placeholder&&((e=this.textComponent)==null?void 0:e.text.length)&&Te.setActive(this.placeholder.gameObject,!1)}onDisable(){var e;(e=jn.htmlField)==null||e.removeEventListener("keyup",this.inputEventFn),this.onDeselected()}onPointerClick(e){Jh&&console.log("CLICK",e,jn.active),jn.activeTime=this.context.time.time,jn.active!==this&&this.startCoroutine(this.activeLoop(),No.LateUpdate),this.selectInputField()}*activeLoop(){for(this.onSelected();jn.active===this&&!(this.context.input.getPointerUp(0)&&this.context.time.time-jn.activeTime>.2);)this.setTextFromInputField(),yield;this.onDeselected()}onSelected(){var e,t,n,i;if(jn.active!==this&&(Jh&&console.log("Select",this.name,this,jn.htmlField,this.context.isInXR,this.context.arOverlayElement,(e=this.textComponent)==null?void 0:e.text,(t=jn.htmlField)==null?void 0:t.value),(n=jn.active)==null||n.onDeselected(),jn.active=this,this.placeholder&&Te.setActive(this.placeholder.gameObject,!1),jn.htmlField)){if(jn.htmlField.value=((i=this.textComponent)==null?void 0:i.text)||"",Jh&&console.log("set input field value",jn.htmlField.value),this.context.isInXR){const r=this.context.arOverlayElement;r&&(jn.htmlField.style.width="0px",jn.htmlField.style.height="0px",r.append(jn.htmlField))}this.selectInputField()}}onDeselected(){var e;jn.active===this&&(jn.active=null,Jh&&console.log("Deselect",this.name,this),jn.htmlField&&(jn.htmlField.blur(),document.body.append(jn.htmlField),jn.htmlField.style.width="",jn.htmlField.style.height=""),this.placeholder&&(!this.textComponent||this.textComponent.text.length<=0)&&Te.setActive(this.placeholder.gameObject,!0),(e=this.onEndEdit)==null||e.invoke())}onInput(e){var t,n;if(jn.active===this){if(Jh&&console.log(e.code,e,(t=jn.htmlField)==null?void 0:t.value,(n=this.textComponent)==null?void 0:n.text),e.code==="Escape"||e.code==="Enter"){this.onDeselected();return}jn.htmlField&&(this.textComponent&&(this.setTextFromInputField(),this.placeholder&&Te.setActive(this.placeholder.gameObject,this.textComponent.text.length<=0)),this.selectInputField())}}setTextFromInputField(){var e;if(this.textComponent&&jn.htmlField){if(this.textComponent.text!==jn.htmlField.value){Jh&&console.log("VALUE CHANGED");const t=this.textComponent.text,n=jn.htmlField.value;(e=this.onValueChanged)==null||e.invoke(n,t)}this.textComponent.text=jn.htmlField.value}}selectInputField(){jn.htmlField&&(jn.htmlField.setSelectionRange(jn.htmlField.value.length,jn.htmlField.value.length),jn.htmlField.focus())}},E(pm,"active",null),E(pm,"activeTime",-1),E(pm,"htmlField",null),pm);let np=jn;Uv([Re(Qr)],np.prototype,"textComponent",2);Uv([Re(Qr)],np.prototype,"placeholder",2);Uv([Re(ua)],np.prototype,"onValueChanged",2);Uv([Re(ua)],np.prototype,"onEndEdit",2);var Z3=(a=>(a[a.fr=0]="fr",a[a.ru=1]="ru",a[a.de=2]="de",a[a.es=3]="es",a[a.el=4]="el",a[a.nord=5]="nord",a[a.eng=6]="eng",a))(Z3||{});class K3 extends Qc{constructor(){super(...arguments);E(this,"font");E(this,"text");E(this,"keymap");E(this,"padding");E(this,"margin");E(this,"fontSize");E(this,"borderRadius");E(this,"colors",{keyboardBack:8750469,panelBack:2500134,button:3552822,hovered:1842204,selected:1088605});E(this,"keyboard",null);E(this,"_lastKeyPressed");E(this,"_lastKeyPressedStartTime",0);E(this,"_lastKeyPressedTime",0)}awake(){super.awake();const t=Z3[this.keymap||6];this.makeKeyboard(t)}onEnable(){this.addShadowComponent(this.keyboard)}onDisable(){this.removeShadowComponent()}makeKeyboard(t){!t&&!navigator.language&&(t="en");const n=this.font?this.font:"arial",i=this.gameObject.getComponent(uh);if(!i){console.error("Missing rect transform, please add this component inside a canvas");return}const r={...i.getBasicOptions(),margin:this.margin||0,padding:this.padding||0,language:t,fontFamily:um+"/"+n+"-msdf.json",fontTexture:um+"/"+n+".png",fontSize:this.fontSize||6,backgroundColor:new _e(this.colors.keyboardBack),backspaceTexture:um+"/backspace.png",shiftTexture:um+"/shift.png",enterTexture:um+"/enter.png",borderRadius:this.borderRadius||0,autoLayout:!1},o=this.gameObject.scale;r.width*=this.gameObject.scale.x,r.height*=this.gameObject.scale.y,r.fontSize*=Math.max(o.x,o.y),this.keyboard=new Q3(r),this.gameObject.scale.set(1,1,1),this.keyboard.keys.forEach(l=>{l.setupState({state:"normal",attributes:{offset:.003,backgroundColor:new _e(this.colors.button),backgroundOpacity:1}}),l.setState("normal"),l.setupState({state:"hovered",attributes:{offset:.3,backgroundColor:new _e(this.colors.hovered),backgroundOpacity:1}}),l.setupState({state:"pressed",attributes:{offset:.1,backgroundColor:new _e(this.colors.selected),backgroundOpacity:1},onSet:()=>{var f,g,m;const h=l.info.input,u=l.info.command;if(this._lastKeyPressed!==h)this._lastKeyPressedStartTime=this.context.time.time;else if(this.context.time.time-this._lastKeyPressedTime>.05)this._lastKeyPressedStartTime=this.context.time.time;else if(this.context.time.time-this._lastKeyPressedStartTime<.5||u=="switch"||u=="shift"||u=="switch-set"){this._lastKeyPressedTime=this.context.time.time;return}if(this._lastKeyPressedTime=this.context.time.time,this._lastKeyPressed=h,u)switch(u){case"switch":this.keyboard.setNextPanel();break;case"switch-set":this.keyboard.setNextCharset();break;case"enter":this.tryAppend(`
`);break;case"space":this.tryAppend(" ");break;case"backspace":if(!((g=(f=this.text)==null?void 0:f.text)!=null&&g.length))break;(m=this.text)!=null&&m.text&&(this.text.text=this.text.text.substring(0,this.text.text.length-1)||"");break;case"shift":this.keyboard.toggleCase();break}else l.info.input!==void 0&&this.tryAppend(l.info.input)}})})}tryAppend(t){this.text&&(this.text.text+=t,this.markDirty())}}class tA extends Bt{constructor(){super(...arguments);E(this,"reverseArrangement",!1)}}class $3 extends tA{}class eF extends tA{}class tF extends tA{}class bM extends Bt{awake(){aa.createIfNoneExists(this.context)}onEnable(){var e;(e=aa.instance)==null||e.register(this)}onDisable(){var e;(e=aa.instance)==null||e.unregister(this)}performRaycast(e=null){return null}}class hg extends bM{constructor(){super(...arguments);E(this,"targets",null);E(this,"raycastHits",[])}start(){this.targets=[this.gameObject]}performRaycast(t=null){return this.targets?(t!=null||(t=new Wc),t.targets=this.targets,t.results=this.raycastHits,this.context.physics.raycast(t)):null}}class nF extends hg{constructor(){super(...arguments);E(this,"eventCamera",null);E(this,"ignoreReversedGraphics",!1);E(this,"rootRaycaster",null)}}class Ate extends _t{constructor(e){const t=new _te(e),n=new lo(t.image.width*.001,t.image.height*.001),i=new Hi({map:t,toneMapped:!1,transparent:!0});super(n,i);function r(o){i.map.dispatchDOMEvent(o)}this.addEventListener("mousedown",r),this.addEventListener("mousemove",r),this.addEventListener("mouseup",r),this.addEventListener("click",r),this.dispose=function(){n.dispose(),i.dispose(),i.map.dispose(),this.removeEventListener("mousedown",r),this.removeEventListener("mousemove",r),this.removeEventListener("mouseup",r),this.removeEventListener("click",r)}}}class _te extends bC{constructor(e){super(fB(e)),this.dom=e,this.anisotropy=16,this.encoding=Gn,this.minFilter=yi,this.magFilter=yi;const t=new MutationObserver(()=>{this.scheduleUpdate||(this.scheduleUpdate=setTimeout(()=>this.update(),16))}),n={attributes:!0,childList:!0,subtree:!0,characterData:!0};t.observe(e,n),this.observer=t}dispatchDOMEvent(e){e.data&&yte(this.dom,e.type,e.data.x,e.data.y)}update(){this.image=fB(this.dom),this.needsUpdate=!0,this.scheduleUpdate=null}dispose(){this.observer&&this.observer.disconnect(),this.scheduleUpdate=clearTimeout(this.scheduleUpdate),super.dispose()}}const dB=new WeakMap;function fB(a){const e=document.createRange(),t=new _e;function n(m){const A=[];let v=!1;function w(){if(v&&(v=!1,m.restore()),A.length===0)return;let b=-1/0,S=-1/0,R=1/0,M=1/0;for(let I=0;I<A.length;I++){const T=A[I];b=Math.max(b,T.x),S=Math.max(S,T.y),R=Math.min(R,T.x+T.width),M=Math.min(M,T.y+T.height)}m.save(),m.beginPath(),m.rect(b,S,R-b,M-S),m.clip(),v=!0}return{add:function(b){A.push(b),w()},remove:function(){A.pop(),w()}}}function i(m,A,v,w){w!==""&&(m.textTransform==="uppercase"&&(w=w.toUpperCase()),f.font=m.fontWeight+" "+m.fontSize+" "+m.fontFamily,f.textBaseline="top",f.fillStyle=m.color,f.fillText(w,A,v+parseFloat(m.fontSize)*.1))}function r(m,A,v,w,b){v<2*b&&(b=v/2),w<2*b&&(b=w/2),f.beginPath(),f.moveTo(m+b,A),f.arcTo(m+v,A,m+v,A+w,b),f.arcTo(m+v,A+w,m,A+w,b),f.arcTo(m,A+w,m,A,b),f.arcTo(m,A,m+v,A,b),f.closePath()}function o(m,A,v,w,b,S){const R=m[A+"Width"],M=m[A+"Style"],I=m[A+"Color"];R!=="0px"&&M!=="none"&&I!=="transparent"&&I!=="rgba(0, 0, 0, 0)"&&(f.strokeStyle=I,f.lineWidth=parseFloat(R),f.beginPath(),f.moveTo(v,w),f.lineTo(v+b,w+S),f.stroke())}function l(m,A){let v=0,w=0,b=0,S=0;if(m.nodeType===Node.TEXT_NODE){e.selectNode(m);const M=e.getBoundingClientRect();v=M.left-h.left-.5,w=M.top-h.top-.5,b=M.width,S=M.height,i(A,v,w,m.nodeValue.trim())}else{if(m.nodeType===Node.COMMENT_NODE)return;if(m instanceof HTMLCanvasElement){if(m.style.display==="none")return;f.save();const M=window.devicePixelRatio;f.scale(1/M,1/M),f.drawImage(m,0,0),f.restore()}else{if(m.style.display==="none")return;const M=m.getBoundingClientRect();v=M.left-h.left-.5,w=M.top-h.top-.5,b=M.width,S=M.height,A=window.getComputedStyle(m),r(v,w,b,S,parseFloat(A.borderRadius));const I=A.backgroundColor;I!=="transparent"&&I!=="rgba(0, 0, 0, 0)"&&(f.fillStyle=I,f.fill());const T=["borderTop","borderLeft","borderBottom","borderRight"];let B=!0,F=null;for(const D of T){if(F!==null&&(B=A[D+"Width"]===A[F+"Width"]&&A[D+"Color"]===A[F+"Color"]&&A[D+"Style"]===A[F+"Style"]),B===!1)break;F=D}if(B===!0){const D=parseFloat(A.borderTopWidth);A.borderTopWidth!=="0px"&&A.borderTopStyle!=="none"&&A.borderTopColor!=="transparent"&&A.borderTopColor!=="rgba(0, 0, 0, 0)"&&(f.strokeStyle=A.borderTopColor,f.lineWidth=D,f.stroke())}else o(A,"borderTop",v,w,b,0),o(A,"borderLeft",v,w,0,S),o(A,"borderBottom",v,w+S,b,0),o(A,"borderRight",v+b,w,0,S);if(m instanceof HTMLInputElement){let D=A.accentColor;(D===void 0||D==="auto")&&(D=A.color),t.set(D);const W=Math.sqrt(.299*t.r**2+.587*t.g**2+.114*t.b**2)<.5?"white":"#111111";if(m.type==="radio"&&(r(v,w,b,S,S),f.fillStyle="white",f.strokeStyle=D,f.lineWidth=1,f.fill(),f.stroke(),m.checked&&(r(v+2,w+2,b-4,S-4,S),f.fillStyle=D,f.strokeStyle=W,f.lineWidth=2,f.fill(),f.stroke())),m.type==="checkbox"&&(r(v,w,b,S,2),f.fillStyle=m.checked?D:"white",f.strokeStyle=m.checked?W:D,f.lineWidth=1,f.stroke(),f.fill(),m.checked)){const J=f.textAlign;f.textAlign="center";const ee={color:W,fontFamily:A.fontFamily,fontSize:S+"px",fontWeight:"bold"};i(ee,v+b/2,w,"\u2714"),f.textAlign=J}if(m.type==="range"){const[J,ee,Q]=["min","max","value"].map(se=>parseFloat(m[se])),Y=(Q-J)/(ee-J)*(b-S);r(v,w+S/4,b,S/2,S/4),f.fillStyle=W,f.strokeStyle=D,f.lineWidth=1,f.fill(),f.stroke(),r(v,w+S/4,Y+S/2,S/2,S/4),f.fillStyle=D,f.fill(),r(v+Y,w,S,S,S/2),f.fillStyle=D,f.fill()}(m.type==="color"||m.type==="text"||m.type==="number")&&(g.add({x:v,y:w,width:b,height:S}),i(A,v+parseInt(A.paddingLeft),w+parseInt(A.paddingTop),m.value),g.remove())}}}const R=A.overflow==="auto"||A.overflow==="hidden";R&&g.add({x:v,y:w,width:b,height:S});for(let M=0;M<m.childNodes.length;M++)l(m.childNodes[M],A);R&&g.remove()}const h=a.getBoundingClientRect();let u=dB.get(a);u===void 0&&(u=document.createElement("canvas"),u.width=h.width,u.height=h.height,dB.set(a,u));const f=u.getContext("2d"),g=new n(f);return l(a),u}function yte(a,e,t,n){const i={clientX:t*a.offsetWidth+a.offsetLeft,clientY:n*a.offsetHeight+a.offsetTop,view:a.ownerDocument.defaultView};window.dispatchEvent(new MouseEvent(e,i));const r=a.getBoundingClientRect();t=t*r.width+r.left,n=n*r.height+r.top;function o(l){if(l.nodeType!==Node.TEXT_NODE&&l.nodeType!==Node.COMMENT_NODE){const h=l.getBoundingClientRect();if(t>h.left&&t<h.right&&n>h.top&&n<h.bottom&&(l.dispatchEvent(new MouseEvent(e,i)),l instanceof HTMLInputElement&&l.type==="range"&&(e==="mousedown"||e==="click"))){const[u,f]=["min","max"].map(v=>parseFloat(l[v])),g=h.width,A=(t-h.x)/g;l.value=u+(f-u)*A,l.dispatchEvent(new InputEvent("input",{bubbles:!0}))}for(let u=0;u<l.childNodes.length;u++)o(l.childNodes[u])}}o(a)}const N_=new Xe,jd={type:"",data:N_};class vte extends sa{constructor(e,t){super();const n=this,i=new Du,r=new xn,o=e.domElement;function l(m){m.stopPropagation();const A=e.domElement.getBoundingClientRect();N_.x=(m.clientX-A.left)/A.width*2-1,N_.y=-(m.clientY-A.top)/A.height*2+1,i.setFromCamera(N_,t);const v=i.intersectObjects(n.children,!1);if(v.length>0){const w=v[0],b=w.object,S=w.uv;jd.type=m.type,jd.data.set(S.x,1-S.y),b.dispatchEvent(jd)}}o.addEventListener("pointerdown",l),o.addEventListener("pointerup",l),o.addEventListener("pointermove",l),o.addEventListener("mousedown",l),o.addEventListener("mouseup",l),o.addEventListener("mousemove",l),o.addEventListener("click",l);const h={move:"mousemove",select:"click",selectstart:"mousedown",selectend:"mouseup"};function u(m){const A=m.target;r.identity().extractRotation(A.matrixWorld),i.ray.origin.setFromMatrixPosition(A.matrixWorld),i.ray.direction.set(0,0,-1).applyMatrix4(r);const v=i.intersectObjects(n.children,!1);if(v.length>0){const w=v[0],b=w.object,S=w.uv;jd.type=h[m.type],jd.data.set(S.x,1-S.y),b.dispatchEvent(jd)}}const f=e.xr.getController(0);f.addEventListener("move",u),f.addEventListener("select",u),f.addEventListener("selectstart",u),f.addEventListener("selectend",u);const g=e.xr.getController(1);g.addEventListener("move",u),g.addEventListener("select",u),g.addEventListener("selectstart",u),g.addEventListener("selectend",u)}}class iF extends Bt{constructor(){super(...arguments);E(this,"id",null);E(this,"keepAspect",!1)}start(){if(!this.id||!this.context.mainCamera)return;const t=document.getElementById(this.id);if(!t){console.warn('Could not find element with id "'+this.id+'"');return}t.style.display="block",t.style.visibility="hidden";const n=new vte(this.context.renderer,this.context.mainCamera);this.gameObject.add(n);const i=new Ate(t);n.add(i),i.visible=!1,console.log(i);const r=i.material;r.transparent=!0,setTimeout(()=>{i.visible=!0;const o=T2(this.gameObject).clone();I2(this.gameObject,0,0,0),this.gameObject.updateMatrixWorld();const l=new Mr;l.setFromObject(n),this.setWorldRotation(o.x,o.y,o.z);const h=l.max.x-l.min.x,u=l.max.y-l.min.y;if(this.keepAspect){const g=h/u;h>u?i.scale.set(1/h,1/u/g,1):i.scale.set(1/h*g,1/u,1)}else i.scale.set(1/h,1/u,1);const f=this.gameObject.scale;i.scale.multiply(f)},1)}}class xte extends Bt{constructor(){super(...arguments);E(this,"toggleKey",Dc.KEY_P)}update(){this.context.input.isKeyDown(Dc.KEY_P)&&this.context.domElement.classList.toggle("presentation-mode")}}var ug={exports:{}},K={};/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */var pB;function wte(){if(pB)return K;pB=1,Object.defineProperty(K,"__esModule",{value:!0});const a="145",e={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},t={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},n=0,i=1,r=2,o=3,l=0,h=1,u=2,f=3,g=0,m=1,A=2,v=0,w=1,b=2,S=3,R=4,M=5,I=100,T=101,B=102,F=103,D=104,U=200,W=201,J=202,ee=203,Q=204,Y=205,se=206,ae=207,ve=208,xe=209,Ae=210,Me=0,Be=1,Le=2,$e=3,yt=4,Nt=5,He=6,mn=7,Xt=0,pn=1,Ft=2,yn=0,it=1,tt=2,vt=3,Jt=4,Lt=5,En=300,Zt=301,ln=302,ii=303,Zn=304,me=306,ce=1e3,Qe=1001,At=1002,pt=1003,zt=1004,Mn=1004,we=1005,Fe=1005,bt=1006,hn=1007,nn=1007,Ht=1008,Bn=1008,Ln=1009,Ce=1010,Rt=1011,kt=1012,Ie=1013,Ct=1014,wn=1015,di=1016,Gi=1017,jr=1018,vi=1020,Ir=1021,js=1022,ir=1023,Ja=1024,fh=1025,mo=1026,Rr=1027,Gu=1028,he=1029,ze=1030,Ue=1031,ke=1033,nt=33776,j=33777,ie=33778,pe=33779,Ee=35840,Ve=35841,De=35842,Ze=35843,lt=36196,St=37492,ut=37496,xt=37808,Kt=37809,wt=37810,vn=37811,fn=37812,$t=37813,un=37814,Fn=37815,Ci=37816,Kn=37817,Wi=37818,fi=37819,In=37820,Li=37821,zs=36492,Yi=2200,xi=2201,Ii=2202,gr=2300,Ho=2301,Ar=2302,go=2400,ph=2401,ip=2402,sA=2500,Gv=2501,yF=0,vF=1,xF=2,jc=3e3,$i=3001,RM=3200,PM=3201,qc=0,BM=1,wF="",ga="srgb",Xc="srgb-linear",bF=0,rA=7680,EF=7681,CF=7682,SF=7683,MF=34055,TF=34056,IF=5386,RF=512,PF=513,BF=514,LF=515,DF=516,OF=517,FF=518,LM=519,sp=35044,kF=35048,NF=35040,UF=35045,zF=35049,GF=35041,HF=35046,VF=35050,WF=35042,QF="100",Hv="300 es",oA=1035;class Za{addEventListener(s,c){this._listeners===void 0&&(this._listeners={});const d=this._listeners;d[s]===void 0&&(d[s]=[]),d[s].indexOf(c)===-1&&d[s].push(c)}hasEventListener(s,c){if(this._listeners===void 0)return!1;const d=this._listeners;return d[s]!==void 0&&d[s].indexOf(c)!==-1}removeEventListener(s,c){if(this._listeners===void 0)return;const p=this._listeners[s];if(p!==void 0){const _=p.indexOf(c);_!==-1&&p.splice(_,1)}}dispatchEvent(s){if(this._listeners===void 0)return;const d=this._listeners[s.type];if(d!==void 0){s.target=this;const p=d.slice(0);for(let _=0,x=p.length;_<x;_++)p[_].call(this,s);s.target=null}}}const sr=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let DM=1234567;const mh=Math.PI/180,rp=180/Math.PI;function qr(){const y=Math.random()*4294967295|0,s=Math.random()*4294967295|0,c=Math.random()*4294967295|0,d=Math.random()*4294967295|0;return(sr[y&255]+sr[y>>8&255]+sr[y>>16&255]+sr[y>>24&255]+"-"+sr[s&255]+sr[s>>8&255]+"-"+sr[s>>16&15|64]+sr[s>>24&255]+"-"+sr[c&63|128]+sr[c>>8&255]+"-"+sr[c>>16&255]+sr[c>>24&255]+sr[d&255]+sr[d>>8&255]+sr[d>>16&255]+sr[d>>24&255]).toLowerCase()}function ds(y,s,c){return Math.max(s,Math.min(c,y))}function Vv(y,s){return(y%s+s)%s}function jF(y,s,c,d,p){return d+(y-s)*(p-d)/(c-s)}function qF(y,s,c){return y!==s?(c-y)/(s-y):0}function op(y,s,c){return(1-c)*y+c*s}function XF(y,s,c,d){return op(y,s,1-Math.exp(-c*d))}function YF(y,s=1){return s-Math.abs(Vv(y,s*2)-s)}function JF(y,s,c){return y<=s?0:y>=c?1:(y=(y-s)/(c-s),y*y*(3-2*y))}function ZF(y,s,c){return y<=s?0:y>=c?1:(y=(y-s)/(c-s),y*y*y*(y*(y*6-15)+10))}function KF(y,s){return y+Math.floor(Math.random()*(s-y+1))}function $F(y,s){return y+Math.random()*(s-y)}function ek(y){return y*(.5-Math.random())}function tk(y){y!==void 0&&(DM=y);let s=DM+=1831565813;return s=Math.imul(s^s>>>15,s|1),s^=s+Math.imul(s^s>>>7,s|61),((s^s>>>14)>>>0)/4294967296}function nk(y){return y*mh}function ik(y){return y*rp}function Wv(y){return(y&y-1)===0&&y!==0}function OM(y){return Math.pow(2,Math.ceil(Math.log(y)/Math.LN2))}function aA(y){return Math.pow(2,Math.floor(Math.log(y)/Math.LN2))}function sk(y,s,c,d,p){const _=Math.cos,x=Math.sin,C=_(c/2),P=x(c/2),L=_((s+d)/2),O=x((s+d)/2),k=_((s-d)/2),N=x((s-d)/2),z=_((d-s)/2),V=x((d-s)/2);switch(p){case"XYX":y.set(C*O,P*k,P*N,C*L);break;case"YZY":y.set(P*N,C*O,P*k,C*L);break;case"ZXZ":y.set(P*k,P*N,C*O,C*L);break;case"XZX":y.set(C*O,P*V,P*z,C*L);break;case"YXY":y.set(P*z,C*O,P*V,C*L);break;case"ZYZ":y.set(P*V,P*z,C*O,C*L);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+p)}}function Ka(y,s){switch(s.constructor){case Float32Array:return y;case Uint16Array:return y/65535;case Uint8Array:return y/255;case Int16Array:return Math.max(y/32767,-1);case Int8Array:return Math.max(y/127,-1);default:throw new Error("Invalid component type.")}}function Di(y,s){switch(s.constructor){case Float32Array:return y;case Uint16Array:return Math.round(y*65535);case Uint8Array:return Math.round(y*255);case Int16Array:return Math.round(y*32767);case Int8Array:return Math.round(y*127);default:throw new Error("Invalid component type.")}}var rk=Object.freeze({__proto__:null,DEG2RAD:mh,RAD2DEG:rp,generateUUID:qr,clamp:ds,euclideanModulo:Vv,mapLinear:jF,inverseLerp:qF,lerp:op,damp:XF,pingpong:YF,smoothstep:JF,smootherstep:ZF,randInt:KF,randFloat:$F,randFloatSpread:ek,seededRandom:tk,degToRad:nk,radToDeg:ik,isPowerOfTwo:Wv,ceilPowerOfTwo:OM,floorPowerOfTwo:aA,setQuaternionFromProperEuler:sk,normalize:Di,denormalize:Ka});class mt{constructor(s=0,c=0){mt.prototype.isVector2=!0,this.x=s,this.y=c}get width(){return this.x}set width(s){this.x=s}get height(){return this.y}set height(s){this.y=s}set(s,c){return this.x=s,this.y=c,this}setScalar(s){return this.x=s,this.y=s,this}setX(s){return this.x=s,this}setY(s){return this.y=s,this}setComponent(s,c){switch(s){case 0:this.x=c;break;case 1:this.y=c;break;default:throw new Error("index is out of range: "+s)}return this}getComponent(s){switch(s){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+s)}}clone(){return new this.constructor(this.x,this.y)}copy(s){return this.x=s.x,this.y=s.y,this}add(s){return this.x+=s.x,this.y+=s.y,this}addScalar(s){return this.x+=s,this.y+=s,this}addVectors(s,c){return this.x=s.x+c.x,this.y=s.y+c.y,this}addScaledVector(s,c){return this.x+=s.x*c,this.y+=s.y*c,this}sub(s){return this.x-=s.x,this.y-=s.y,this}subScalar(s){return this.x-=s,this.y-=s,this}subVectors(s,c){return this.x=s.x-c.x,this.y=s.y-c.y,this}multiply(s){return this.x*=s.x,this.y*=s.y,this}multiplyScalar(s){return this.x*=s,this.y*=s,this}divide(s){return this.x/=s.x,this.y/=s.y,this}divideScalar(s){return this.multiplyScalar(1/s)}applyMatrix3(s){const c=this.x,d=this.y,p=s.elements;return this.x=p[0]*c+p[3]*d+p[6],this.y=p[1]*c+p[4]*d+p[7],this}min(s){return this.x=Math.min(this.x,s.x),this.y=Math.min(this.y,s.y),this}max(s){return this.x=Math.max(this.x,s.x),this.y=Math.max(this.y,s.y),this}clamp(s,c){return this.x=Math.max(s.x,Math.min(c.x,this.x)),this.y=Math.max(s.y,Math.min(c.y,this.y)),this}clampScalar(s,c){return this.x=Math.max(s,Math.min(c,this.x)),this.y=Math.max(s,Math.min(c,this.y)),this}clampLength(s,c){const d=this.length();return this.divideScalar(d||1).multiplyScalar(Math.max(s,Math.min(c,d)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(s){return this.x*s.x+this.y*s.y}cross(s){return this.x*s.y-this.y*s.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(s){return Math.sqrt(this.distanceToSquared(s))}distanceToSquared(s){const c=this.x-s.x,d=this.y-s.y;return c*c+d*d}manhattanDistanceTo(s){return Math.abs(this.x-s.x)+Math.abs(this.y-s.y)}setLength(s){return this.normalize().multiplyScalar(s)}lerp(s,c){return this.x+=(s.x-this.x)*c,this.y+=(s.y-this.y)*c,this}lerpVectors(s,c,d){return this.x=s.x+(c.x-s.x)*d,this.y=s.y+(c.y-s.y)*d,this}equals(s){return s.x===this.x&&s.y===this.y}fromArray(s,c=0){return this.x=s[c],this.y=s[c+1],this}toArray(s=[],c=0){return s[c]=this.x,s[c+1]=this.y,s}fromBufferAttribute(s,c){return this.x=s.getX(c),this.y=s.getY(c),this}rotateAround(s,c){const d=Math.cos(c),p=Math.sin(c),_=this.x-s.x,x=this.y-s.y;return this.x=_*d-x*p+s.x,this.y=_*p+x*d+s.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Pr{constructor(){Pr.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(s,c,d,p,_,x,C,P,L){const O=this.elements;return O[0]=s,O[1]=p,O[2]=C,O[3]=c,O[4]=_,O[5]=P,O[6]=d,O[7]=x,O[8]=L,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(s){const c=this.elements,d=s.elements;return c[0]=d[0],c[1]=d[1],c[2]=d[2],c[3]=d[3],c[4]=d[4],c[5]=d[5],c[6]=d[6],c[7]=d[7],c[8]=d[8],this}extractBasis(s,c,d){return s.setFromMatrix3Column(this,0),c.setFromMatrix3Column(this,1),d.setFromMatrix3Column(this,2),this}setFromMatrix4(s){const c=s.elements;return this.set(c[0],c[4],c[8],c[1],c[5],c[9],c[2],c[6],c[10]),this}multiply(s){return this.multiplyMatrices(this,s)}premultiply(s){return this.multiplyMatrices(s,this)}multiplyMatrices(s,c){const d=s.elements,p=c.elements,_=this.elements,x=d[0],C=d[3],P=d[6],L=d[1],O=d[4],k=d[7],N=d[2],z=d[5],V=d[8],H=p[0],G=p[3],X=p[6],Z=p[1],ne=p[4],te=p[7],oe=p[2],ue=p[5],be=p[8];return _[0]=x*H+C*Z+P*oe,_[3]=x*G+C*ne+P*ue,_[6]=x*X+C*te+P*be,_[1]=L*H+O*Z+k*oe,_[4]=L*G+O*ne+k*ue,_[7]=L*X+O*te+k*be,_[2]=N*H+z*Z+V*oe,_[5]=N*G+z*ne+V*ue,_[8]=N*X+z*te+V*be,this}multiplyScalar(s){const c=this.elements;return c[0]*=s,c[3]*=s,c[6]*=s,c[1]*=s,c[4]*=s,c[7]*=s,c[2]*=s,c[5]*=s,c[8]*=s,this}determinant(){const s=this.elements,c=s[0],d=s[1],p=s[2],_=s[3],x=s[4],C=s[5],P=s[6],L=s[7],O=s[8];return c*x*O-c*C*L-d*_*O+d*C*P+p*_*L-p*x*P}invert(){const s=this.elements,c=s[0],d=s[1],p=s[2],_=s[3],x=s[4],C=s[5],P=s[6],L=s[7],O=s[8],k=O*x-C*L,N=C*P-O*_,z=L*_-x*P,V=c*k+d*N+p*z;if(V===0)return this.set(0,0,0,0,0,0,0,0,0);const H=1/V;return s[0]=k*H,s[1]=(p*L-O*d)*H,s[2]=(C*d-p*x)*H,s[3]=N*H,s[4]=(O*c-p*P)*H,s[5]=(p*_-C*c)*H,s[6]=z*H,s[7]=(d*P-L*c)*H,s[8]=(x*c-d*_)*H,this}transpose(){let s;const c=this.elements;return s=c[1],c[1]=c[3],c[3]=s,s=c[2],c[2]=c[6],c[6]=s,s=c[5],c[5]=c[7],c[7]=s,this}getNormalMatrix(s){return this.setFromMatrix4(s).invert().transpose()}transposeIntoArray(s){const c=this.elements;return s[0]=c[0],s[1]=c[3],s[2]=c[6],s[3]=c[1],s[4]=c[4],s[5]=c[7],s[6]=c[2],s[7]=c[5],s[8]=c[8],this}setUvTransform(s,c,d,p,_,x,C){const P=Math.cos(_),L=Math.sin(_);return this.set(d*P,d*L,-d*(P*x+L*C)+x+s,-p*L,p*P,-p*(-L*x+P*C)+C+c,0,0,1),this}scale(s,c){const d=this.elements;return d[0]*=s,d[3]*=s,d[6]*=s,d[1]*=c,d[4]*=c,d[7]*=c,this}rotate(s){const c=Math.cos(s),d=Math.sin(s),p=this.elements,_=p[0],x=p[3],C=p[6],P=p[1],L=p[4],O=p[7];return p[0]=c*_+d*P,p[3]=c*x+d*L,p[6]=c*C+d*O,p[1]=-d*_+c*P,p[4]=-d*x+c*L,p[7]=-d*C+c*O,this}translate(s,c){const d=this.elements;return d[0]+=s*d[2],d[3]+=s*d[5],d[6]+=s*d[8],d[1]+=c*d[2],d[4]+=c*d[5],d[7]+=c*d[8],this}equals(s){const c=this.elements,d=s.elements;for(let p=0;p<9;p++)if(c[p]!==d[p])return!1;return!0}fromArray(s,c=0){for(let d=0;d<9;d++)this.elements[d]=s[d+c];return this}toArray(s=[],c=0){const d=this.elements;return s[c]=d[0],s[c+1]=d[1],s[c+2]=d[2],s[c+3]=d[3],s[c+4]=d[4],s[c+5]=d[5],s[c+6]=d[6],s[c+7]=d[7],s[c+8]=d[8],s}clone(){return new this.constructor().fromArray(this.elements)}}function FM(y){for(let s=y.length-1;s>=0;--s)if(y[s]>=65535)return!0;return!1}const ok={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Hu(y,s){return new ok[y](s)}function ap(y){return document.createElementNS("http://www.w3.org/1999/xhtml",y)}function gh(y){return y<.04045?y*.0773993808:Math.pow(y*.9478672986+.0521327014,2.4)}function cA(y){return y<.0031308?y*12.92:1.055*Math.pow(y,.41666)-.055}const Qv={[ga]:{[Xc]:gh},[Xc]:{[ga]:cA}},Ao={legacyMode:!0,get workingColorSpace(){return Xc},set workingColorSpace(y){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(y,s,c){if(this.legacyMode||s===c||!s||!c)return y;if(Qv[s]&&Qv[s][c]!==void 0){const d=Qv[s][c];return y.r=d(y.r),y.g=d(y.g),y.b=d(y.b),y}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(y,s){return this.convert(y,this.workingColorSpace,s)},toWorkingColorSpace:function(y,s){return this.convert(y,s,this.workingColorSpace)}},kM={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Rs={r:0,g:0,b:0},Vo={h:0,s:0,l:0},lA={h:0,s:0,l:0};function jv(y,s,c){return c<0&&(c+=1),c>1&&(c-=1),c<1/6?y+(s-y)*6*c:c<1/2?s:c<2/3?y+(s-y)*6*(2/3-c):y}function hA(y,s){return s.r=y.r,s.g=y.g,s.b=y.b,s}class dn{constructor(s,c,d){return this.isColor=!0,this.r=1,this.g=1,this.b=1,c===void 0&&d===void 0?this.set(s):this.setRGB(s,c,d)}set(s){return s&&s.isColor?this.copy(s):typeof s=="number"?this.setHex(s):typeof s=="string"&&this.setStyle(s),this}setScalar(s){return this.r=s,this.g=s,this.b=s,this}setHex(s,c=ga){return s=Math.floor(s),this.r=(s>>16&255)/255,this.g=(s>>8&255)/255,this.b=(s&255)/255,Ao.toWorkingColorSpace(this,c),this}setRGB(s,c,d,p=Xc){return this.r=s,this.g=c,this.b=d,Ao.toWorkingColorSpace(this,p),this}setHSL(s,c,d,p=Xc){if(s=Vv(s,1),c=ds(c,0,1),d=ds(d,0,1),c===0)this.r=this.g=this.b=d;else{const _=d<=.5?d*(1+c):d+c-d*c,x=2*d-_;this.r=jv(x,_,s+1/3),this.g=jv(x,_,s),this.b=jv(x,_,s-1/3)}return Ao.toWorkingColorSpace(this,p),this}setStyle(s,c=ga){function d(_){_!==void 0&&parseFloat(_)<1&&console.warn("THREE.Color: Alpha component of "+s+" will be ignored.")}let p;if(p=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(s)){let _;const x=p[1],C=p[2];switch(x){case"rgb":case"rgba":if(_=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(C))return this.r=Math.min(255,parseInt(_[1],10))/255,this.g=Math.min(255,parseInt(_[2],10))/255,this.b=Math.min(255,parseInt(_[3],10))/255,Ao.toWorkingColorSpace(this,c),d(_[4]),this;if(_=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(C))return this.r=Math.min(100,parseInt(_[1],10))/100,this.g=Math.min(100,parseInt(_[2],10))/100,this.b=Math.min(100,parseInt(_[3],10))/100,Ao.toWorkingColorSpace(this,c),d(_[4]),this;break;case"hsl":case"hsla":if(_=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(C)){const P=parseFloat(_[1])/360,L=parseFloat(_[2])/100,O=parseFloat(_[3])/100;return d(_[4]),this.setHSL(P,L,O,c)}break}}else if(p=/^\#([A-Fa-f\d]+)$/.exec(s)){const _=p[1],x=_.length;if(x===3)return this.r=parseInt(_.charAt(0)+_.charAt(0),16)/255,this.g=parseInt(_.charAt(1)+_.charAt(1),16)/255,this.b=parseInt(_.charAt(2)+_.charAt(2),16)/255,Ao.toWorkingColorSpace(this,c),this;if(x===6)return this.r=parseInt(_.charAt(0)+_.charAt(1),16)/255,this.g=parseInt(_.charAt(2)+_.charAt(3),16)/255,this.b=parseInt(_.charAt(4)+_.charAt(5),16)/255,Ao.toWorkingColorSpace(this,c),this}return s&&s.length>0?this.setColorName(s,c):this}setColorName(s,c=ga){const d=kM[s.toLowerCase()];return d!==void 0?this.setHex(d,c):console.warn("THREE.Color: Unknown color "+s),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(s){return this.r=s.r,this.g=s.g,this.b=s.b,this}copySRGBToLinear(s){return this.r=gh(s.r),this.g=gh(s.g),this.b=gh(s.b),this}copyLinearToSRGB(s){return this.r=cA(s.r),this.g=cA(s.g),this.b=cA(s.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(s=ga){return Ao.fromWorkingColorSpace(hA(this,Rs),s),ds(Rs.r*255,0,255)<<16^ds(Rs.g*255,0,255)<<8^ds(Rs.b*255,0,255)<<0}getHexString(s=ga){return("000000"+this.getHex(s).toString(16)).slice(-6)}getHSL(s,c=Xc){Ao.fromWorkingColorSpace(hA(this,Rs),c);const d=Rs.r,p=Rs.g,_=Rs.b,x=Math.max(d,p,_),C=Math.min(d,p,_);let P,L;const O=(C+x)/2;if(C===x)P=0,L=0;else{const k=x-C;switch(L=O<=.5?k/(x+C):k/(2-x-C),x){case d:P=(p-_)/k+(p<_?6:0);break;case p:P=(_-d)/k+2;break;case _:P=(d-p)/k+4;break}P/=6}return s.h=P,s.s=L,s.l=O,s}getRGB(s,c=Xc){return Ao.fromWorkingColorSpace(hA(this,Rs),c),s.r=Rs.r,s.g=Rs.g,s.b=Rs.b,s}getStyle(s=ga){return Ao.fromWorkingColorSpace(hA(this,Rs),s),s!==ga?`color(${s} ${Rs.r} ${Rs.g} ${Rs.b})`:`rgb(${Rs.r*255|0},${Rs.g*255|0},${Rs.b*255|0})`}offsetHSL(s,c,d){return this.getHSL(Vo),Vo.h+=s,Vo.s+=c,Vo.l+=d,this.setHSL(Vo.h,Vo.s,Vo.l),this}add(s){return this.r+=s.r,this.g+=s.g,this.b+=s.b,this}addColors(s,c){return this.r=s.r+c.r,this.g=s.g+c.g,this.b=s.b+c.b,this}addScalar(s){return this.r+=s,this.g+=s,this.b+=s,this}sub(s){return this.r=Math.max(0,this.r-s.r),this.g=Math.max(0,this.g-s.g),this.b=Math.max(0,this.b-s.b),this}multiply(s){return this.r*=s.r,this.g*=s.g,this.b*=s.b,this}multiplyScalar(s){return this.r*=s,this.g*=s,this.b*=s,this}lerp(s,c){return this.r+=(s.r-this.r)*c,this.g+=(s.g-this.g)*c,this.b+=(s.b-this.b)*c,this}lerpColors(s,c,d){return this.r=s.r+(c.r-s.r)*d,this.g=s.g+(c.g-s.g)*d,this.b=s.b+(c.b-s.b)*d,this}lerpHSL(s,c){this.getHSL(Vo),s.getHSL(lA);const d=op(Vo.h,lA.h,c),p=op(Vo.s,lA.s,c),_=op(Vo.l,lA.l,c);return this.setHSL(d,p,_),this}equals(s){return s.r===this.r&&s.g===this.g&&s.b===this.b}fromArray(s,c=0){return this.r=s[c],this.g=s[c+1],this.b=s[c+2],this}toArray(s=[],c=0){return s[c]=this.r,s[c+1]=this.g,s[c+2]=this.b,s}fromBufferAttribute(s,c){return this.r=s.getX(c),this.g=s.getY(c),this.b=s.getZ(c),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}dn.NAMES=kM;let Vu;class qv{static getDataURL(s){if(/^data:/i.test(s.src)||typeof HTMLCanvasElement>"u")return s.src;let c;if(s instanceof HTMLCanvasElement)c=s;else{Vu===void 0&&(Vu=ap("canvas")),Vu.width=s.width,Vu.height=s.height;const d=Vu.getContext("2d");s instanceof ImageData?d.putImageData(s,0,0):d.drawImage(s,0,0,s.width,s.height),c=Vu}return c.width>2048||c.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",s),c.toDataURL("image/jpeg",.6)):c.toDataURL("image/png")}static sRGBToLinear(s){if(typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&s instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&s instanceof ImageBitmap){const c=ap("canvas");c.width=s.width,c.height=s.height;const d=c.getContext("2d");d.drawImage(s,0,0,s.width,s.height);const p=d.getImageData(0,0,s.width,s.height),_=p.data;for(let x=0;x<_.length;x++)_[x]=gh(_[x]/255)*255;return d.putImageData(p,0,0),c}else if(s.data){const c=s.data.slice(0);for(let d=0;d<c.length;d++)c instanceof Uint8Array||c instanceof Uint8ClampedArray?c[d]=Math.floor(gh(c[d]/255)*255):c[d]=gh(c[d]);return{data:c,width:s.width,height:s.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),s}}class Ah{constructor(s=null){this.isSource=!0,this.uuid=qr(),this.data=s,this.version=0}set needsUpdate(s){s===!0&&this.version++}toJSON(s){const c=s===void 0||typeof s=="string";if(!c&&s.images[this.uuid]!==void 0)return s.images[this.uuid];const d={uuid:this.uuid,url:""},p=this.data;if(p!==null){let _;if(Array.isArray(p)){_=[];for(let x=0,C=p.length;x<C;x++)p[x].isDataTexture?_.push(Xv(p[x].image)):_.push(Xv(p[x]))}else _=Xv(p);d.url=_}return c||(s.images[this.uuid]=d),d}}function Xv(y){return typeof HTMLImageElement<"u"&&y instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&y instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&y instanceof ImageBitmap?qv.getDataURL(y):y.data?{data:Array.from(y.data),width:y.width,height:y.height,type:y.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let ak=0;class Ps extends Za{constructor(s=Ps.DEFAULT_IMAGE,c=Ps.DEFAULT_MAPPING,d=Qe,p=Qe,_=bt,x=Ht,C=ir,P=Ln,L=1,O=jc){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:ak++}),this.uuid=qr(),this.name="",this.source=new Ah(s),this.mipmaps=[],this.mapping=c,this.wrapS=d,this.wrapT=p,this.magFilter=_,this.minFilter=x,this.anisotropy=L,this.format=C,this.internalFormat=null,this.type=P,this.offset=new mt(0,0),this.repeat=new mt(1,1),this.center=new mt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Pr,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=O,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(s){this.source.data=s}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(s){return this.name=s.name,this.source=s.source,this.mipmaps=s.mipmaps.slice(0),this.mapping=s.mapping,this.wrapS=s.wrapS,this.wrapT=s.wrapT,this.magFilter=s.magFilter,this.minFilter=s.minFilter,this.anisotropy=s.anisotropy,this.format=s.format,this.internalFormat=s.internalFormat,this.type=s.type,this.offset.copy(s.offset),this.repeat.copy(s.repeat),this.center.copy(s.center),this.rotation=s.rotation,this.matrixAutoUpdate=s.matrixAutoUpdate,this.matrix.copy(s.matrix),this.generateMipmaps=s.generateMipmaps,this.premultiplyAlpha=s.premultiplyAlpha,this.flipY=s.flipY,this.unpackAlignment=s.unpackAlignment,this.encoding=s.encoding,this.userData=JSON.parse(JSON.stringify(s.userData)),this.needsUpdate=!0,this}toJSON(s){const c=s===void 0||typeof s=="string";if(!c&&s.textures[this.uuid]!==void 0)return s.textures[this.uuid];const d={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(s).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return JSON.stringify(this.userData)!=="{}"&&(d.userData=this.userData),c||(s.textures[this.uuid]=d),d}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(s){if(this.mapping!==En)return s;if(s.applyMatrix3(this.matrix),s.x<0||s.x>1)switch(this.wrapS){case ce:s.x=s.x-Math.floor(s.x);break;case Qe:s.x=s.x<0?0:1;break;case At:Math.abs(Math.floor(s.x)%2)===1?s.x=Math.ceil(s.x)-s.x:s.x=s.x-Math.floor(s.x);break}if(s.y<0||s.y>1)switch(this.wrapT){case ce:s.y=s.y-Math.floor(s.y);break;case Qe:s.y=s.y<0?0:1;break;case At:Math.abs(Math.floor(s.y)%2)===1?s.y=Math.ceil(s.y)-s.y:s.y=s.y-Math.floor(s.y);break}return this.flipY&&(s.y=1-s.y),s}set needsUpdate(s){s===!0&&(this.version++,this.source.needsUpdate=!0)}}Ps.DEFAULT_IMAGE=null,Ps.DEFAULT_MAPPING=En;class Ri{constructor(s=0,c=0,d=0,p=1){Ri.prototype.isVector4=!0,this.x=s,this.y=c,this.z=d,this.w=p}get width(){return this.z}set width(s){this.z=s}get height(){return this.w}set height(s){this.w=s}set(s,c,d,p){return this.x=s,this.y=c,this.z=d,this.w=p,this}setScalar(s){return this.x=s,this.y=s,this.z=s,this.w=s,this}setX(s){return this.x=s,this}setY(s){return this.y=s,this}setZ(s){return this.z=s,this}setW(s){return this.w=s,this}setComponent(s,c){switch(s){case 0:this.x=c;break;case 1:this.y=c;break;case 2:this.z=c;break;case 3:this.w=c;break;default:throw new Error("index is out of range: "+s)}return this}getComponent(s){switch(s){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+s)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(s){return this.x=s.x,this.y=s.y,this.z=s.z,this.w=s.w!==void 0?s.w:1,this}add(s){return this.x+=s.x,this.y+=s.y,this.z+=s.z,this.w+=s.w,this}addScalar(s){return this.x+=s,this.y+=s,this.z+=s,this.w+=s,this}addVectors(s,c){return this.x=s.x+c.x,this.y=s.y+c.y,this.z=s.z+c.z,this.w=s.w+c.w,this}addScaledVector(s,c){return this.x+=s.x*c,this.y+=s.y*c,this.z+=s.z*c,this.w+=s.w*c,this}sub(s){return this.x-=s.x,this.y-=s.y,this.z-=s.z,this.w-=s.w,this}subScalar(s){return this.x-=s,this.y-=s,this.z-=s,this.w-=s,this}subVectors(s,c){return this.x=s.x-c.x,this.y=s.y-c.y,this.z=s.z-c.z,this.w=s.w-c.w,this}multiply(s){return this.x*=s.x,this.y*=s.y,this.z*=s.z,this.w*=s.w,this}multiplyScalar(s){return this.x*=s,this.y*=s,this.z*=s,this.w*=s,this}applyMatrix4(s){const c=this.x,d=this.y,p=this.z,_=this.w,x=s.elements;return this.x=x[0]*c+x[4]*d+x[8]*p+x[12]*_,this.y=x[1]*c+x[5]*d+x[9]*p+x[13]*_,this.z=x[2]*c+x[6]*d+x[10]*p+x[14]*_,this.w=x[3]*c+x[7]*d+x[11]*p+x[15]*_,this}divideScalar(s){return this.multiplyScalar(1/s)}setAxisAngleFromQuaternion(s){this.w=2*Math.acos(s.w);const c=Math.sqrt(1-s.w*s.w);return c<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=s.x/c,this.y=s.y/c,this.z=s.z/c),this}setAxisAngleFromRotationMatrix(s){let c,d,p,_;const P=s.elements,L=P[0],O=P[4],k=P[8],N=P[1],z=P[5],V=P[9],H=P[2],G=P[6],X=P[10];if(Math.abs(O-N)<.01&&Math.abs(k-H)<.01&&Math.abs(V-G)<.01){if(Math.abs(O+N)<.1&&Math.abs(k+H)<.1&&Math.abs(V+G)<.1&&Math.abs(L+z+X-3)<.1)return this.set(1,0,0,0),this;c=Math.PI;const ne=(L+1)/2,te=(z+1)/2,oe=(X+1)/2,ue=(O+N)/4,be=(k+H)/4,$=(V+G)/4;return ne>te&&ne>oe?ne<.01?(d=0,p=.707106781,_=.707106781):(d=Math.sqrt(ne),p=ue/d,_=be/d):te>oe?te<.01?(d=.707106781,p=0,_=.707106781):(p=Math.sqrt(te),d=ue/p,_=$/p):oe<.01?(d=.707106781,p=.707106781,_=0):(_=Math.sqrt(oe),d=be/_,p=$/_),this.set(d,p,_,c),this}let Z=Math.sqrt((G-V)*(G-V)+(k-H)*(k-H)+(N-O)*(N-O));return Math.abs(Z)<.001&&(Z=1),this.x=(G-V)/Z,this.y=(k-H)/Z,this.z=(N-O)/Z,this.w=Math.acos((L+z+X-1)/2),this}min(s){return this.x=Math.min(this.x,s.x),this.y=Math.min(this.y,s.y),this.z=Math.min(this.z,s.z),this.w=Math.min(this.w,s.w),this}max(s){return this.x=Math.max(this.x,s.x),this.y=Math.max(this.y,s.y),this.z=Math.max(this.z,s.z),this.w=Math.max(this.w,s.w),this}clamp(s,c){return this.x=Math.max(s.x,Math.min(c.x,this.x)),this.y=Math.max(s.y,Math.min(c.y,this.y)),this.z=Math.max(s.z,Math.min(c.z,this.z)),this.w=Math.max(s.w,Math.min(c.w,this.w)),this}clampScalar(s,c){return this.x=Math.max(s,Math.min(c,this.x)),this.y=Math.max(s,Math.min(c,this.y)),this.z=Math.max(s,Math.min(c,this.z)),this.w=Math.max(s,Math.min(c,this.w)),this}clampLength(s,c){const d=this.length();return this.divideScalar(d||1).multiplyScalar(Math.max(s,Math.min(c,d)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(s){return this.x*s.x+this.y*s.y+this.z*s.z+this.w*s.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(s){return this.normalize().multiplyScalar(s)}lerp(s,c){return this.x+=(s.x-this.x)*c,this.y+=(s.y-this.y)*c,this.z+=(s.z-this.z)*c,this.w+=(s.w-this.w)*c,this}lerpVectors(s,c,d){return this.x=s.x+(c.x-s.x)*d,this.y=s.y+(c.y-s.y)*d,this.z=s.z+(c.z-s.z)*d,this.w=s.w+(c.w-s.w)*d,this}equals(s){return s.x===this.x&&s.y===this.y&&s.z===this.z&&s.w===this.w}fromArray(s,c=0){return this.x=s[c],this.y=s[c+1],this.z=s[c+2],this.w=s[c+3],this}toArray(s=[],c=0){return s[c]=this.x,s[c+1]=this.y,s[c+2]=this.z,s[c+3]=this.w,s}fromBufferAttribute(s,c){return this.x=s.getX(c),this.y=s.getY(c),this.z=s.getZ(c),this.w=s.getW(c),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class _o extends Za{constructor(s,c,d={}){super(),this.isWebGLRenderTarget=!0,this.width=s,this.height=c,this.depth=1,this.scissor=new Ri(0,0,s,c),this.scissorTest=!1,this.viewport=new Ri(0,0,s,c);const p={width:s,height:c,depth:1};this.texture=new Ps(p,d.mapping,d.wrapS,d.wrapT,d.magFilter,d.minFilter,d.format,d.type,d.anisotropy,d.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=d.generateMipmaps!==void 0?d.generateMipmaps:!1,this.texture.internalFormat=d.internalFormat!==void 0?d.internalFormat:null,this.texture.minFilter=d.minFilter!==void 0?d.minFilter:bt,this.depthBuffer=d.depthBuffer!==void 0?d.depthBuffer:!0,this.stencilBuffer=d.stencilBuffer!==void 0?d.stencilBuffer:!1,this.depthTexture=d.depthTexture!==void 0?d.depthTexture:null,this.samples=d.samples!==void 0?d.samples:0}setSize(s,c,d=1){(this.width!==s||this.height!==c||this.depth!==d)&&(this.width=s,this.height=c,this.depth=d,this.texture.image.width=s,this.texture.image.height=c,this.texture.image.depth=d,this.dispose()),this.viewport.set(0,0,s,c),this.scissor.set(0,0,s,c)}clone(){return new this.constructor().copy(this)}copy(s){this.width=s.width,this.height=s.height,this.depth=s.depth,this.viewport.copy(s.viewport),this.texture=s.texture.clone(),this.texture.isRenderTargetTexture=!0;const c=Object.assign({},s.texture.image);return this.texture.source=new Ah(c),this.depthBuffer=s.depthBuffer,this.stencilBuffer=s.stencilBuffer,s.depthTexture!==null&&(this.depthTexture=s.depthTexture.clone()),this.samples=s.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class cp extends Ps{constructor(s=null,c=1,d=1,p=1){super(null),this.isDataArrayTexture=!0,this.image={data:s,width:c,height:d,depth:p},this.magFilter=pt,this.minFilter=pt,this.wrapR=Qe,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class ck extends _o{constructor(s,c,d){super(s,c),this.isWebGLArrayRenderTarget=!0,this.depth=d,this.texture=new cp(null,s,c,d),this.texture.isRenderTargetTexture=!0}}class uA extends Ps{constructor(s=null,c=1,d=1,p=1){super(null),this.isData3DTexture=!0,this.image={data:s,width:c,height:d,depth:p},this.magFilter=pt,this.minFilter=pt,this.wrapR=Qe,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class lk extends _o{constructor(s,c,d){super(s,c),this.isWebGL3DRenderTarget=!0,this.depth=d,this.texture=new uA(null,s,c,d),this.texture.isRenderTargetTexture=!0}}class hk extends _o{constructor(s,c,d,p={}){super(s,c,p),this.isWebGLMultipleRenderTargets=!0;const _=this.texture;this.texture=[];for(let x=0;x<d;x++)this.texture[x]=_.clone(),this.texture[x].isRenderTargetTexture=!0}setSize(s,c,d=1){if(this.width!==s||this.height!==c||this.depth!==d){this.width=s,this.height=c,this.depth=d;for(let p=0,_=this.texture.length;p<_;p++)this.texture[p].image.width=s,this.texture[p].image.height=c,this.texture[p].image.depth=d;this.dispose()}return this.viewport.set(0,0,s,c),this.scissor.set(0,0,s,c),this}copy(s){this.dispose(),this.width=s.width,this.height=s.height,this.depth=s.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=s.depthBuffer,this.stencilBuffer=s.stencilBuffer,s.depthTexture!==null&&(this.depthTexture=s.depthTexture.clone()),this.texture.length=0;for(let c=0,d=s.texture.length;c<d;c++)this.texture[c]=s.texture[c].clone(),this.texture[c].isRenderTargetTexture=!0;return this}}class Br{constructor(s=0,c=0,d=0,p=1){this.isQuaternion=!0,this._x=s,this._y=c,this._z=d,this._w=p}static slerpFlat(s,c,d,p,_,x,C){let P=d[p+0],L=d[p+1],O=d[p+2],k=d[p+3];const N=_[x+0],z=_[x+1],V=_[x+2],H=_[x+3];if(C===0){s[c+0]=P,s[c+1]=L,s[c+2]=O,s[c+3]=k;return}if(C===1){s[c+0]=N,s[c+1]=z,s[c+2]=V,s[c+3]=H;return}if(k!==H||P!==N||L!==z||O!==V){let G=1-C;const X=P*N+L*z+O*V+k*H,Z=X>=0?1:-1,ne=1-X*X;if(ne>Number.EPSILON){const oe=Math.sqrt(ne),ue=Math.atan2(oe,X*Z);G=Math.sin(G*ue)/oe,C=Math.sin(C*ue)/oe}const te=C*Z;if(P=P*G+N*te,L=L*G+z*te,O=O*G+V*te,k=k*G+H*te,G===1-C){const oe=1/Math.sqrt(P*P+L*L+O*O+k*k);P*=oe,L*=oe,O*=oe,k*=oe}}s[c]=P,s[c+1]=L,s[c+2]=O,s[c+3]=k}static multiplyQuaternionsFlat(s,c,d,p,_,x){const C=d[p],P=d[p+1],L=d[p+2],O=d[p+3],k=_[x],N=_[x+1],z=_[x+2],V=_[x+3];return s[c]=C*V+O*k+P*z-L*N,s[c+1]=P*V+O*N+L*k-C*z,s[c+2]=L*V+O*z+C*N-P*k,s[c+3]=O*V-C*k-P*N-L*z,s}get x(){return this._x}set x(s){this._x=s,this._onChangeCallback()}get y(){return this._y}set y(s){this._y=s,this._onChangeCallback()}get z(){return this._z}set z(s){this._z=s,this._onChangeCallback()}get w(){return this._w}set w(s){this._w=s,this._onChangeCallback()}set(s,c,d,p){return this._x=s,this._y=c,this._z=d,this._w=p,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(s){return this._x=s.x,this._y=s.y,this._z=s.z,this._w=s.w,this._onChangeCallback(),this}setFromEuler(s,c){const d=s._x,p=s._y,_=s._z,x=s._order,C=Math.cos,P=Math.sin,L=C(d/2),O=C(p/2),k=C(_/2),N=P(d/2),z=P(p/2),V=P(_/2);switch(x){case"XYZ":this._x=N*O*k+L*z*V,this._y=L*z*k-N*O*V,this._z=L*O*V+N*z*k,this._w=L*O*k-N*z*V;break;case"YXZ":this._x=N*O*k+L*z*V,this._y=L*z*k-N*O*V,this._z=L*O*V-N*z*k,this._w=L*O*k+N*z*V;break;case"ZXY":this._x=N*O*k-L*z*V,this._y=L*z*k+N*O*V,this._z=L*O*V+N*z*k,this._w=L*O*k-N*z*V;break;case"ZYX":this._x=N*O*k-L*z*V,this._y=L*z*k+N*O*V,this._z=L*O*V-N*z*k,this._w=L*O*k+N*z*V;break;case"YZX":this._x=N*O*k+L*z*V,this._y=L*z*k+N*O*V,this._z=L*O*V-N*z*k,this._w=L*O*k-N*z*V;break;case"XZY":this._x=N*O*k-L*z*V,this._y=L*z*k-N*O*V,this._z=L*O*V+N*z*k,this._w=L*O*k+N*z*V;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+x)}return c!==!1&&this._onChangeCallback(),this}setFromAxisAngle(s,c){const d=c/2,p=Math.sin(d);return this._x=s.x*p,this._y=s.y*p,this._z=s.z*p,this._w=Math.cos(d),this._onChangeCallback(),this}setFromRotationMatrix(s){const c=s.elements,d=c[0],p=c[4],_=c[8],x=c[1],C=c[5],P=c[9],L=c[2],O=c[6],k=c[10],N=d+C+k;if(N>0){const z=.5/Math.sqrt(N+1);this._w=.25/z,this._x=(O-P)*z,this._y=(_-L)*z,this._z=(x-p)*z}else if(d>C&&d>k){const z=2*Math.sqrt(1+d-C-k);this._w=(O-P)/z,this._x=.25*z,this._y=(p+x)/z,this._z=(_+L)/z}else if(C>k){const z=2*Math.sqrt(1+C-d-k);this._w=(_-L)/z,this._x=(p+x)/z,this._y=.25*z,this._z=(P+O)/z}else{const z=2*Math.sqrt(1+k-d-C);this._w=(x-p)/z,this._x=(_+L)/z,this._y=(P+O)/z,this._z=.25*z}return this._onChangeCallback(),this}setFromUnitVectors(s,c){let d=s.dot(c)+1;return d<Number.EPSILON?(d=0,Math.abs(s.x)>Math.abs(s.z)?(this._x=-s.y,this._y=s.x,this._z=0,this._w=d):(this._x=0,this._y=-s.z,this._z=s.y,this._w=d)):(this._x=s.y*c.z-s.z*c.y,this._y=s.z*c.x-s.x*c.z,this._z=s.x*c.y-s.y*c.x,this._w=d),this.normalize()}angleTo(s){return 2*Math.acos(Math.abs(ds(this.dot(s),-1,1)))}rotateTowards(s,c){const d=this.angleTo(s);if(d===0)return this;const p=Math.min(1,c/d);return this.slerp(s,p),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(s){return this._x*s._x+this._y*s._y+this._z*s._z+this._w*s._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let s=this.length();return s===0?(this._x=0,this._y=0,this._z=0,this._w=1):(s=1/s,this._x=this._x*s,this._y=this._y*s,this._z=this._z*s,this._w=this._w*s),this._onChangeCallback(),this}multiply(s){return this.multiplyQuaternions(this,s)}premultiply(s){return this.multiplyQuaternions(s,this)}multiplyQuaternions(s,c){const d=s._x,p=s._y,_=s._z,x=s._w,C=c._x,P=c._y,L=c._z,O=c._w;return this._x=d*O+x*C+p*L-_*P,this._y=p*O+x*P+_*C-d*L,this._z=_*O+x*L+d*P-p*C,this._w=x*O-d*C-p*P-_*L,this._onChangeCallback(),this}slerp(s,c){if(c===0)return this;if(c===1)return this.copy(s);const d=this._x,p=this._y,_=this._z,x=this._w;let C=x*s._w+d*s._x+p*s._y+_*s._z;if(C<0?(this._w=-s._w,this._x=-s._x,this._y=-s._y,this._z=-s._z,C=-C):this.copy(s),C>=1)return this._w=x,this._x=d,this._y=p,this._z=_,this;const P=1-C*C;if(P<=Number.EPSILON){const z=1-c;return this._w=z*x+c*this._w,this._x=z*d+c*this._x,this._y=z*p+c*this._y,this._z=z*_+c*this._z,this.normalize(),this._onChangeCallback(),this}const L=Math.sqrt(P),O=Math.atan2(L,C),k=Math.sin((1-c)*O)/L,N=Math.sin(c*O)/L;return this._w=x*k+this._w*N,this._x=d*k+this._x*N,this._y=p*k+this._y*N,this._z=_*k+this._z*N,this._onChangeCallback(),this}slerpQuaternions(s,c,d){return this.copy(s).slerp(c,d)}random(){const s=Math.random(),c=Math.sqrt(1-s),d=Math.sqrt(s),p=2*Math.PI*Math.random(),_=2*Math.PI*Math.random();return this.set(c*Math.cos(p),d*Math.sin(_),d*Math.cos(_),c*Math.sin(p))}equals(s){return s._x===this._x&&s._y===this._y&&s._z===this._z&&s._w===this._w}fromArray(s,c=0){return this._x=s[c],this._y=s[c+1],this._z=s[c+2],this._w=s[c+3],this._onChangeCallback(),this}toArray(s=[],c=0){return s[c]=this._x,s[c+1]=this._y,s[c+2]=this._z,s[c+3]=this._w,s}fromBufferAttribute(s,c){return this._x=s.getX(c),this._y=s.getY(c),this._z=s.getZ(c),this._w=s.getW(c),this}_onChange(s){return this._onChangeCallback=s,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class de{constructor(s=0,c=0,d=0){de.prototype.isVector3=!0,this.x=s,this.y=c,this.z=d}set(s,c,d){return d===void 0&&(d=this.z),this.x=s,this.y=c,this.z=d,this}setScalar(s){return this.x=s,this.y=s,this.z=s,this}setX(s){return this.x=s,this}setY(s){return this.y=s,this}setZ(s){return this.z=s,this}setComponent(s,c){switch(s){case 0:this.x=c;break;case 1:this.y=c;break;case 2:this.z=c;break;default:throw new Error("index is out of range: "+s)}return this}getComponent(s){switch(s){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+s)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(s){return this.x=s.x,this.y=s.y,this.z=s.z,this}add(s){return this.x+=s.x,this.y+=s.y,this.z+=s.z,this}addScalar(s){return this.x+=s,this.y+=s,this.z+=s,this}addVectors(s,c){return this.x=s.x+c.x,this.y=s.y+c.y,this.z=s.z+c.z,this}addScaledVector(s,c){return this.x+=s.x*c,this.y+=s.y*c,this.z+=s.z*c,this}sub(s){return this.x-=s.x,this.y-=s.y,this.z-=s.z,this}subScalar(s){return this.x-=s,this.y-=s,this.z-=s,this}subVectors(s,c){return this.x=s.x-c.x,this.y=s.y-c.y,this.z=s.z-c.z,this}multiply(s){return this.x*=s.x,this.y*=s.y,this.z*=s.z,this}multiplyScalar(s){return this.x*=s,this.y*=s,this.z*=s,this}multiplyVectors(s,c){return this.x=s.x*c.x,this.y=s.y*c.y,this.z=s.z*c.z,this}applyEuler(s){return this.applyQuaternion(NM.setFromEuler(s))}applyAxisAngle(s,c){return this.applyQuaternion(NM.setFromAxisAngle(s,c))}applyMatrix3(s){const c=this.x,d=this.y,p=this.z,_=s.elements;return this.x=_[0]*c+_[3]*d+_[6]*p,this.y=_[1]*c+_[4]*d+_[7]*p,this.z=_[2]*c+_[5]*d+_[8]*p,this}applyNormalMatrix(s){return this.applyMatrix3(s).normalize()}applyMatrix4(s){const c=this.x,d=this.y,p=this.z,_=s.elements,x=1/(_[3]*c+_[7]*d+_[11]*p+_[15]);return this.x=(_[0]*c+_[4]*d+_[8]*p+_[12])*x,this.y=(_[1]*c+_[5]*d+_[9]*p+_[13])*x,this.z=(_[2]*c+_[6]*d+_[10]*p+_[14])*x,this}applyQuaternion(s){const c=this.x,d=this.y,p=this.z,_=s.x,x=s.y,C=s.z,P=s.w,L=P*c+x*p-C*d,O=P*d+C*c-_*p,k=P*p+_*d-x*c,N=-_*c-x*d-C*p;return this.x=L*P+N*-_+O*-C-k*-x,this.y=O*P+N*-x+k*-_-L*-C,this.z=k*P+N*-C+L*-x-O*-_,this}project(s){return this.applyMatrix4(s.matrixWorldInverse).applyMatrix4(s.projectionMatrix)}unproject(s){return this.applyMatrix4(s.projectionMatrixInverse).applyMatrix4(s.matrixWorld)}transformDirection(s){const c=this.x,d=this.y,p=this.z,_=s.elements;return this.x=_[0]*c+_[4]*d+_[8]*p,this.y=_[1]*c+_[5]*d+_[9]*p,this.z=_[2]*c+_[6]*d+_[10]*p,this.normalize()}divide(s){return this.x/=s.x,this.y/=s.y,this.z/=s.z,this}divideScalar(s){return this.multiplyScalar(1/s)}min(s){return this.x=Math.min(this.x,s.x),this.y=Math.min(this.y,s.y),this.z=Math.min(this.z,s.z),this}max(s){return this.x=Math.max(this.x,s.x),this.y=Math.max(this.y,s.y),this.z=Math.max(this.z,s.z),this}clamp(s,c){return this.x=Math.max(s.x,Math.min(c.x,this.x)),this.y=Math.max(s.y,Math.min(c.y,this.y)),this.z=Math.max(s.z,Math.min(c.z,this.z)),this}clampScalar(s,c){return this.x=Math.max(s,Math.min(c,this.x)),this.y=Math.max(s,Math.min(c,this.y)),this.z=Math.max(s,Math.min(c,this.z)),this}clampLength(s,c){const d=this.length();return this.divideScalar(d||1).multiplyScalar(Math.max(s,Math.min(c,d)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(s){return this.x*s.x+this.y*s.y+this.z*s.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(s){return this.normalize().multiplyScalar(s)}lerp(s,c){return this.x+=(s.x-this.x)*c,this.y+=(s.y-this.y)*c,this.z+=(s.z-this.z)*c,this}lerpVectors(s,c,d){return this.x=s.x+(c.x-s.x)*d,this.y=s.y+(c.y-s.y)*d,this.z=s.z+(c.z-s.z)*d,this}cross(s){return this.crossVectors(this,s)}crossVectors(s,c){const d=s.x,p=s.y,_=s.z,x=c.x,C=c.y,P=c.z;return this.x=p*P-_*C,this.y=_*x-d*P,this.z=d*C-p*x,this}projectOnVector(s){const c=s.lengthSq();if(c===0)return this.set(0,0,0);const d=s.dot(this)/c;return this.copy(s).multiplyScalar(d)}projectOnPlane(s){return Yv.copy(this).projectOnVector(s),this.sub(Yv)}reflect(s){return this.sub(Yv.copy(s).multiplyScalar(2*this.dot(s)))}angleTo(s){const c=Math.sqrt(this.lengthSq()*s.lengthSq());if(c===0)return Math.PI/2;const d=this.dot(s)/c;return Math.acos(ds(d,-1,1))}distanceTo(s){return Math.sqrt(this.distanceToSquared(s))}distanceToSquared(s){const c=this.x-s.x,d=this.y-s.y,p=this.z-s.z;return c*c+d*d+p*p}manhattanDistanceTo(s){return Math.abs(this.x-s.x)+Math.abs(this.y-s.y)+Math.abs(this.z-s.z)}setFromSpherical(s){return this.setFromSphericalCoords(s.radius,s.phi,s.theta)}setFromSphericalCoords(s,c,d){const p=Math.sin(c)*s;return this.x=p*Math.sin(d),this.y=Math.cos(c)*s,this.z=p*Math.cos(d),this}setFromCylindrical(s){return this.setFromCylindricalCoords(s.radius,s.theta,s.y)}setFromCylindricalCoords(s,c,d){return this.x=s*Math.sin(c),this.y=d,this.z=s*Math.cos(c),this}setFromMatrixPosition(s){const c=s.elements;return this.x=c[12],this.y=c[13],this.z=c[14],this}setFromMatrixScale(s){const c=this.setFromMatrixColumn(s,0).length(),d=this.setFromMatrixColumn(s,1).length(),p=this.setFromMatrixColumn(s,2).length();return this.x=c,this.y=d,this.z=p,this}setFromMatrixColumn(s,c){return this.fromArray(s.elements,c*4)}setFromMatrix3Column(s,c){return this.fromArray(s.elements,c*3)}setFromEuler(s){return this.x=s._x,this.y=s._y,this.z=s._z,this}equals(s){return s.x===this.x&&s.y===this.y&&s.z===this.z}fromArray(s,c=0){return this.x=s[c],this.y=s[c+1],this.z=s[c+2],this}toArray(s=[],c=0){return s[c]=this.x,s[c+1]=this.y,s[c+2]=this.z,s}fromBufferAttribute(s,c){return this.x=s.getX(c),this.y=s.getY(c),this.z=s.getZ(c),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const s=(Math.random()-.5)*2,c=Math.random()*Math.PI*2,d=Math.sqrt(1-s**2);return this.x=d*Math.cos(c),this.y=d*Math.sin(c),this.z=s,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Yv=new de,NM=new Br;class _h{constructor(s=new de(1/0,1/0,1/0),c=new de(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=s,this.max=c}set(s,c){return this.min.copy(s),this.max.copy(c),this}setFromArray(s){let c=1/0,d=1/0,p=1/0,_=-1/0,x=-1/0,C=-1/0;for(let P=0,L=s.length;P<L;P+=3){const O=s[P],k=s[P+1],N=s[P+2];O<c&&(c=O),k<d&&(d=k),N<p&&(p=N),O>_&&(_=O),k>x&&(x=k),N>C&&(C=N)}return this.min.set(c,d,p),this.max.set(_,x,C),this}setFromBufferAttribute(s){let c=1/0,d=1/0,p=1/0,_=-1/0,x=-1/0,C=-1/0;for(let P=0,L=s.count;P<L;P++){const O=s.getX(P),k=s.getY(P),N=s.getZ(P);O<c&&(c=O),k<d&&(d=k),N<p&&(p=N),O>_&&(_=O),k>x&&(x=k),N>C&&(C=N)}return this.min.set(c,d,p),this.max.set(_,x,C),this}setFromPoints(s){this.makeEmpty();for(let c=0,d=s.length;c<d;c++)this.expandByPoint(s[c]);return this}setFromCenterAndSize(s,c){const d=yh.copy(c).multiplyScalar(.5);return this.min.copy(s).sub(d),this.max.copy(s).add(d),this}setFromObject(s,c=!1){return this.makeEmpty(),this.expandByObject(s,c)}clone(){return new this.constructor().copy(this)}copy(s){return this.min.copy(s.min),this.max.copy(s.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(s){return this.isEmpty()?s.set(0,0,0):s.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(s){return this.isEmpty()?s.set(0,0,0):s.subVectors(this.max,this.min)}expandByPoint(s){return this.min.min(s),this.max.max(s),this}expandByVector(s){return this.min.sub(s),this.max.add(s),this}expandByScalar(s){return this.min.addScalar(-s),this.max.addScalar(s),this}expandByObject(s,c=!1){s.updateWorldMatrix(!1,!1);const d=s.geometry;if(d!==void 0)if(c&&d.attributes!=null&&d.attributes.position!==void 0){const _=d.attributes.position;for(let x=0,C=_.count;x<C;x++)yh.fromBufferAttribute(_,x).applyMatrix4(s.matrixWorld),this.expandByPoint(yh)}else d.boundingBox===null&&d.computeBoundingBox(),Jv.copy(d.boundingBox),Jv.applyMatrix4(s.matrixWorld),this.union(Jv);const p=s.children;for(let _=0,x=p.length;_<x;_++)this.expandByObject(p[_],c);return this}containsPoint(s){return!(s.x<this.min.x||s.x>this.max.x||s.y<this.min.y||s.y>this.max.y||s.z<this.min.z||s.z>this.max.z)}containsBox(s){return this.min.x<=s.min.x&&s.max.x<=this.max.x&&this.min.y<=s.min.y&&s.max.y<=this.max.y&&this.min.z<=s.min.z&&s.max.z<=this.max.z}getParameter(s,c){return c.set((s.x-this.min.x)/(this.max.x-this.min.x),(s.y-this.min.y)/(this.max.y-this.min.y),(s.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(s){return!(s.max.x<this.min.x||s.min.x>this.max.x||s.max.y<this.min.y||s.min.y>this.max.y||s.max.z<this.min.z||s.min.z>this.max.z)}intersectsSphere(s){return this.clampPoint(s.center,yh),yh.distanceToSquared(s.center)<=s.radius*s.radius}intersectsPlane(s){let c,d;return s.normal.x>0?(c=s.normal.x*this.min.x,d=s.normal.x*this.max.x):(c=s.normal.x*this.max.x,d=s.normal.x*this.min.x),s.normal.y>0?(c+=s.normal.y*this.min.y,d+=s.normal.y*this.max.y):(c+=s.normal.y*this.max.y,d+=s.normal.y*this.min.y),s.normal.z>0?(c+=s.normal.z*this.min.z,d+=s.normal.z*this.max.z):(c+=s.normal.z*this.max.z,d+=s.normal.z*this.min.z),c<=-s.constant&&d>=-s.constant}intersectsTriangle(s){if(this.isEmpty())return!1;this.getCenter(lp),dA.subVectors(this.max,lp),Wu.subVectors(s.a,lp),Qu.subVectors(s.b,lp),ju.subVectors(s.c,lp),Yc.subVectors(Qu,Wu),Jc.subVectors(ju,Qu),vh.subVectors(Wu,ju);let c=[0,-Yc.z,Yc.y,0,-Jc.z,Jc.y,0,-vh.z,vh.y,Yc.z,0,-Yc.x,Jc.z,0,-Jc.x,vh.z,0,-vh.x,-Yc.y,Yc.x,0,-Jc.y,Jc.x,0,-vh.y,vh.x,0];return!Zv(c,Wu,Qu,ju,dA)||(c=[1,0,0,0,1,0,0,0,1],!Zv(c,Wu,Qu,ju,dA))?!1:(fA.crossVectors(Yc,Jc),c=[fA.x,fA.y,fA.z],Zv(c,Wu,Qu,ju,dA))}clampPoint(s,c){return c.copy(s).clamp(this.min,this.max)}distanceToPoint(s){return yh.copy(s).clamp(this.min,this.max).sub(s).length()}getBoundingSphere(s){return this.getCenter(s.center),s.radius=this.getSize(yh).length()*.5,s}intersect(s){return this.min.max(s.min),this.max.min(s.max),this.isEmpty()&&this.makeEmpty(),this}union(s){return this.min.min(s.min),this.max.max(s.max),this}applyMatrix4(s){return this.isEmpty()?this:($a[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(s),$a[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(s),$a[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(s),$a[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(s),$a[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(s),$a[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(s),$a[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(s),$a[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(s),this.setFromPoints($a),this)}translate(s){return this.min.add(s),this.max.add(s),this}equals(s){return s.min.equals(this.min)&&s.max.equals(this.max)}}const $a=[new de,new de,new de,new de,new de,new de,new de,new de],yh=new de,Jv=new _h,Wu=new de,Qu=new de,ju=new de,Yc=new de,Jc=new de,vh=new de,lp=new de,dA=new de,fA=new de,xh=new de;function Zv(y,s,c,d,p){for(let _=0,x=y.length-3;_<=x;_+=3){xh.fromArray(y,_);const C=p.x*Math.abs(xh.x)+p.y*Math.abs(xh.y)+p.z*Math.abs(xh.z),P=s.dot(xh),L=c.dot(xh),O=d.dot(xh);if(Math.max(-Math.max(P,L,O),Math.min(P,L,O))>C)return!1}return!0}const uk=new _h,UM=new de,pA=new de,Kv=new de;class wh{constructor(s=new de,c=-1){this.center=s,this.radius=c}set(s,c){return this.center.copy(s),this.radius=c,this}setFromPoints(s,c){const d=this.center;c!==void 0?d.copy(c):uk.setFromPoints(s).getCenter(d);let p=0;for(let _=0,x=s.length;_<x;_++)p=Math.max(p,d.distanceToSquared(s[_]));return this.radius=Math.sqrt(p),this}copy(s){return this.center.copy(s.center),this.radius=s.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(s){return s.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(s){return s.distanceTo(this.center)-this.radius}intersectsSphere(s){const c=this.radius+s.radius;return s.center.distanceToSquared(this.center)<=c*c}intersectsBox(s){return s.intersectsSphere(this)}intersectsPlane(s){return Math.abs(s.distanceToPoint(this.center))<=this.radius}clampPoint(s,c){const d=this.center.distanceToSquared(s);return c.copy(s),d>this.radius*this.radius&&(c.sub(this.center).normalize(),c.multiplyScalar(this.radius).add(this.center)),c}getBoundingBox(s){return this.isEmpty()?(s.makeEmpty(),s):(s.set(this.center,this.center),s.expandByScalar(this.radius),s)}applyMatrix4(s){return this.center.applyMatrix4(s),this.radius=this.radius*s.getMaxScaleOnAxis(),this}translate(s){return this.center.add(s),this}expandByPoint(s){if(this.isEmpty())return this.center.copy(s),this.radius=0,this;Kv.subVectors(s,this.center);const c=Kv.lengthSq();if(c>this.radius*this.radius){const d=Math.sqrt(c),p=(d-this.radius)*.5;this.center.add(Kv.multiplyScalar(p/d)),this.radius+=p}return this}union(s){return s.isEmpty()?this:this.isEmpty()?(this.copy(s),this):(this.center.equals(s.center)===!0?pA.set(0,0,1).multiplyScalar(s.radius):pA.subVectors(s.center,this.center).normalize().multiplyScalar(s.radius),this.expandByPoint(UM.copy(s.center).add(pA)),this.expandByPoint(UM.copy(s.center).sub(pA)),this)}equals(s){return s.center.equals(this.center)&&s.radius===this.radius}clone(){return new this.constructor().copy(this)}}const ec=new de,$v=new de,mA=new de,Zc=new de,ex=new de,gA=new de,tx=new de;class hp{constructor(s=new de,c=new de(0,0,-1)){this.origin=s,this.direction=c}set(s,c){return this.origin.copy(s),this.direction.copy(c),this}copy(s){return this.origin.copy(s.origin),this.direction.copy(s.direction),this}at(s,c){return c.copy(this.direction).multiplyScalar(s).add(this.origin)}lookAt(s){return this.direction.copy(s).sub(this.origin).normalize(),this}recast(s){return this.origin.copy(this.at(s,ec)),this}closestPointToPoint(s,c){c.subVectors(s,this.origin);const d=c.dot(this.direction);return d<0?c.copy(this.origin):c.copy(this.direction).multiplyScalar(d).add(this.origin)}distanceToPoint(s){return Math.sqrt(this.distanceSqToPoint(s))}distanceSqToPoint(s){const c=ec.subVectors(s,this.origin).dot(this.direction);return c<0?this.origin.distanceToSquared(s):(ec.copy(this.direction).multiplyScalar(c).add(this.origin),ec.distanceToSquared(s))}distanceSqToSegment(s,c,d,p){$v.copy(s).add(c).multiplyScalar(.5),mA.copy(c).sub(s).normalize(),Zc.copy(this.origin).sub($v);const _=s.distanceTo(c)*.5,x=-this.direction.dot(mA),C=Zc.dot(this.direction),P=-Zc.dot(mA),L=Zc.lengthSq(),O=Math.abs(1-x*x);let k,N,z,V;if(O>0)if(k=x*P-C,N=x*C-P,V=_*O,k>=0)if(N>=-V)if(N<=V){const H=1/O;k*=H,N*=H,z=k*(k+x*N+2*C)+N*(x*k+N+2*P)+L}else N=_,k=Math.max(0,-(x*N+C)),z=-k*k+N*(N+2*P)+L;else N=-_,k=Math.max(0,-(x*N+C)),z=-k*k+N*(N+2*P)+L;else N<=-V?(k=Math.max(0,-(-x*_+C)),N=k>0?-_:Math.min(Math.max(-_,-P),_),z=-k*k+N*(N+2*P)+L):N<=V?(k=0,N=Math.min(Math.max(-_,-P),_),z=N*(N+2*P)+L):(k=Math.max(0,-(x*_+C)),N=k>0?_:Math.min(Math.max(-_,-P),_),z=-k*k+N*(N+2*P)+L);else N=x>0?-_:_,k=Math.max(0,-(x*N+C)),z=-k*k+N*(N+2*P)+L;return d&&d.copy(this.direction).multiplyScalar(k).add(this.origin),p&&p.copy(mA).multiplyScalar(N).add($v),z}intersectSphere(s,c){ec.subVectors(s.center,this.origin);const d=ec.dot(this.direction),p=ec.dot(ec)-d*d,_=s.radius*s.radius;if(p>_)return null;const x=Math.sqrt(_-p),C=d-x,P=d+x;return C<0&&P<0?null:C<0?this.at(P,c):this.at(C,c)}intersectsSphere(s){return this.distanceSqToPoint(s.center)<=s.radius*s.radius}distanceToPlane(s){const c=s.normal.dot(this.direction);if(c===0)return s.distanceToPoint(this.origin)===0?0:null;const d=-(this.origin.dot(s.normal)+s.constant)/c;return d>=0?d:null}intersectPlane(s,c){const d=this.distanceToPlane(s);return d===null?null:this.at(d,c)}intersectsPlane(s){const c=s.distanceToPoint(this.origin);return c===0||s.normal.dot(this.direction)*c<0}intersectBox(s,c){let d,p,_,x,C,P;const L=1/this.direction.x,O=1/this.direction.y,k=1/this.direction.z,N=this.origin;return L>=0?(d=(s.min.x-N.x)*L,p=(s.max.x-N.x)*L):(d=(s.max.x-N.x)*L,p=(s.min.x-N.x)*L),O>=0?(_=(s.min.y-N.y)*O,x=(s.max.y-N.y)*O):(_=(s.max.y-N.y)*O,x=(s.min.y-N.y)*O),d>x||_>p||((_>d||d!==d)&&(d=_),(x<p||p!==p)&&(p=x),k>=0?(C=(s.min.z-N.z)*k,P=(s.max.z-N.z)*k):(C=(s.max.z-N.z)*k,P=(s.min.z-N.z)*k),d>P||C>p)||((C>d||d!==d)&&(d=C),(P<p||p!==p)&&(p=P),p<0)?null:this.at(d>=0?d:p,c)}intersectsBox(s){return this.intersectBox(s,ec)!==null}intersectTriangle(s,c,d,p,_){ex.subVectors(c,s),gA.subVectors(d,s),tx.crossVectors(ex,gA);let x=this.direction.dot(tx),C;if(x>0){if(p)return null;C=1}else if(x<0)C=-1,x=-x;else return null;Zc.subVectors(this.origin,s);const P=C*this.direction.dot(gA.crossVectors(Zc,gA));if(P<0)return null;const L=C*this.direction.dot(ex.cross(Zc));if(L<0||P+L>x)return null;const O=-C*Zc.dot(tx);return O<0?null:this.at(O/x,_)}applyMatrix4(s){return this.origin.applyMatrix4(s),this.direction.transformDirection(s),this}equals(s){return s.origin.equals(this.origin)&&s.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class $n{constructor(){$n.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(s,c,d,p,_,x,C,P,L,O,k,N,z,V,H,G){const X=this.elements;return X[0]=s,X[4]=c,X[8]=d,X[12]=p,X[1]=_,X[5]=x,X[9]=C,X[13]=P,X[2]=L,X[6]=O,X[10]=k,X[14]=N,X[3]=z,X[7]=V,X[11]=H,X[15]=G,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new $n().fromArray(this.elements)}copy(s){const c=this.elements,d=s.elements;return c[0]=d[0],c[1]=d[1],c[2]=d[2],c[3]=d[3],c[4]=d[4],c[5]=d[5],c[6]=d[6],c[7]=d[7],c[8]=d[8],c[9]=d[9],c[10]=d[10],c[11]=d[11],c[12]=d[12],c[13]=d[13],c[14]=d[14],c[15]=d[15],this}copyPosition(s){const c=this.elements,d=s.elements;return c[12]=d[12],c[13]=d[13],c[14]=d[14],this}setFromMatrix3(s){const c=s.elements;return this.set(c[0],c[3],c[6],0,c[1],c[4],c[7],0,c[2],c[5],c[8],0,0,0,0,1),this}extractBasis(s,c,d){return s.setFromMatrixColumn(this,0),c.setFromMatrixColumn(this,1),d.setFromMatrixColumn(this,2),this}makeBasis(s,c,d){return this.set(s.x,c.x,d.x,0,s.y,c.y,d.y,0,s.z,c.z,d.z,0,0,0,0,1),this}extractRotation(s){const c=this.elements,d=s.elements,p=1/qu.setFromMatrixColumn(s,0).length(),_=1/qu.setFromMatrixColumn(s,1).length(),x=1/qu.setFromMatrixColumn(s,2).length();return c[0]=d[0]*p,c[1]=d[1]*p,c[2]=d[2]*p,c[3]=0,c[4]=d[4]*_,c[5]=d[5]*_,c[6]=d[6]*_,c[7]=0,c[8]=d[8]*x,c[9]=d[9]*x,c[10]=d[10]*x,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,this}makeRotationFromEuler(s){const c=this.elements,d=s.x,p=s.y,_=s.z,x=Math.cos(d),C=Math.sin(d),P=Math.cos(p),L=Math.sin(p),O=Math.cos(_),k=Math.sin(_);if(s.order==="XYZ"){const N=x*O,z=x*k,V=C*O,H=C*k;c[0]=P*O,c[4]=-P*k,c[8]=L,c[1]=z+V*L,c[5]=N-H*L,c[9]=-C*P,c[2]=H-N*L,c[6]=V+z*L,c[10]=x*P}else if(s.order==="YXZ"){const N=P*O,z=P*k,V=L*O,H=L*k;c[0]=N+H*C,c[4]=V*C-z,c[8]=x*L,c[1]=x*k,c[5]=x*O,c[9]=-C,c[2]=z*C-V,c[6]=H+N*C,c[10]=x*P}else if(s.order==="ZXY"){const N=P*O,z=P*k,V=L*O,H=L*k;c[0]=N-H*C,c[4]=-x*k,c[8]=V+z*C,c[1]=z+V*C,c[5]=x*O,c[9]=H-N*C,c[2]=-x*L,c[6]=C,c[10]=x*P}else if(s.order==="ZYX"){const N=x*O,z=x*k,V=C*O,H=C*k;c[0]=P*O,c[4]=V*L-z,c[8]=N*L+H,c[1]=P*k,c[5]=H*L+N,c[9]=z*L-V,c[2]=-L,c[6]=C*P,c[10]=x*P}else if(s.order==="YZX"){const N=x*P,z=x*L,V=C*P,H=C*L;c[0]=P*O,c[4]=H-N*k,c[8]=V*k+z,c[1]=k,c[5]=x*O,c[9]=-C*O,c[2]=-L*O,c[6]=z*k+V,c[10]=N-H*k}else if(s.order==="XZY"){const N=x*P,z=x*L,V=C*P,H=C*L;c[0]=P*O,c[4]=-k,c[8]=L*O,c[1]=N*k+H,c[5]=x*O,c[9]=z*k-V,c[2]=V*k-z,c[6]=C*O,c[10]=H*k+N}return c[3]=0,c[7]=0,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,this}makeRotationFromQuaternion(s){return this.compose(dk,s,fk)}lookAt(s,c,d){const p=this.elements;return Xr.subVectors(s,c),Xr.lengthSq()===0&&(Xr.z=1),Xr.normalize(),Kc.crossVectors(d,Xr),Kc.lengthSq()===0&&(Math.abs(d.z)===1?Xr.x+=1e-4:Xr.z+=1e-4,Xr.normalize(),Kc.crossVectors(d,Xr)),Kc.normalize(),AA.crossVectors(Xr,Kc),p[0]=Kc.x,p[4]=AA.x,p[8]=Xr.x,p[1]=Kc.y,p[5]=AA.y,p[9]=Xr.y,p[2]=Kc.z,p[6]=AA.z,p[10]=Xr.z,this}multiply(s){return this.multiplyMatrices(this,s)}premultiply(s){return this.multiplyMatrices(s,this)}multiplyMatrices(s,c){const d=s.elements,p=c.elements,_=this.elements,x=d[0],C=d[4],P=d[8],L=d[12],O=d[1],k=d[5],N=d[9],z=d[13],V=d[2],H=d[6],G=d[10],X=d[14],Z=d[3],ne=d[7],te=d[11],oe=d[15],ue=p[0],be=p[4],$=p[8],ge=p[12],Se=p[1],et=p[5],Mt=p[9],Ye=p[13],Oe=p[2],rt=p[6],gt=p[10],Et=p[14],at=p[3],We=p[7],Je=p[11],Tt=p[15];return _[0]=x*ue+C*Se+P*Oe+L*at,_[4]=x*be+C*et+P*rt+L*We,_[8]=x*$+C*Mt+P*gt+L*Je,_[12]=x*ge+C*Ye+P*Et+L*Tt,_[1]=O*ue+k*Se+N*Oe+z*at,_[5]=O*be+k*et+N*rt+z*We,_[9]=O*$+k*Mt+N*gt+z*Je,_[13]=O*ge+k*Ye+N*Et+z*Tt,_[2]=V*ue+H*Se+G*Oe+X*at,_[6]=V*be+H*et+G*rt+X*We,_[10]=V*$+H*Mt+G*gt+X*Je,_[14]=V*ge+H*Ye+G*Et+X*Tt,_[3]=Z*ue+ne*Se+te*Oe+oe*at,_[7]=Z*be+ne*et+te*rt+oe*We,_[11]=Z*$+ne*Mt+te*gt+oe*Je,_[15]=Z*ge+ne*Ye+te*Et+oe*Tt,this}multiplyScalar(s){const c=this.elements;return c[0]*=s,c[4]*=s,c[8]*=s,c[12]*=s,c[1]*=s,c[5]*=s,c[9]*=s,c[13]*=s,c[2]*=s,c[6]*=s,c[10]*=s,c[14]*=s,c[3]*=s,c[7]*=s,c[11]*=s,c[15]*=s,this}determinant(){const s=this.elements,c=s[0],d=s[4],p=s[8],_=s[12],x=s[1],C=s[5],P=s[9],L=s[13],O=s[2],k=s[6],N=s[10],z=s[14],V=s[3],H=s[7],G=s[11],X=s[15];return V*(+_*P*k-p*L*k-_*C*N+d*L*N+p*C*z-d*P*z)+H*(+c*P*z-c*L*N+_*x*N-p*x*z+p*L*O-_*P*O)+G*(+c*L*k-c*C*z-_*x*k+d*x*z+_*C*O-d*L*O)+X*(-p*C*O-c*P*k+c*C*N+p*x*k-d*x*N+d*P*O)}transpose(){const s=this.elements;let c;return c=s[1],s[1]=s[4],s[4]=c,c=s[2],s[2]=s[8],s[8]=c,c=s[6],s[6]=s[9],s[9]=c,c=s[3],s[3]=s[12],s[12]=c,c=s[7],s[7]=s[13],s[13]=c,c=s[11],s[11]=s[14],s[14]=c,this}setPosition(s,c,d){const p=this.elements;return s.isVector3?(p[12]=s.x,p[13]=s.y,p[14]=s.z):(p[12]=s,p[13]=c,p[14]=d),this}invert(){const s=this.elements,c=s[0],d=s[1],p=s[2],_=s[3],x=s[4],C=s[5],P=s[6],L=s[7],O=s[8],k=s[9],N=s[10],z=s[11],V=s[12],H=s[13],G=s[14],X=s[15],Z=k*G*L-H*N*L+H*P*z-C*G*z-k*P*X+C*N*X,ne=V*N*L-O*G*L-V*P*z+x*G*z+O*P*X-x*N*X,te=O*H*L-V*k*L+V*C*z-x*H*z-O*C*X+x*k*X,oe=V*k*P-O*H*P-V*C*N+x*H*N+O*C*G-x*k*G,ue=c*Z+d*ne+p*te+_*oe;if(ue===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const be=1/ue;return s[0]=Z*be,s[1]=(H*N*_-k*G*_-H*p*z+d*G*z+k*p*X-d*N*X)*be,s[2]=(C*G*_-H*P*_+H*p*L-d*G*L-C*p*X+d*P*X)*be,s[3]=(k*P*_-C*N*_-k*p*L+d*N*L+C*p*z-d*P*z)*be,s[4]=ne*be,s[5]=(O*G*_-V*N*_+V*p*z-c*G*z-O*p*X+c*N*X)*be,s[6]=(V*P*_-x*G*_-V*p*L+c*G*L+x*p*X-c*P*X)*be,s[7]=(x*N*_-O*P*_+O*p*L-c*N*L-x*p*z+c*P*z)*be,s[8]=te*be,s[9]=(V*k*_-O*H*_-V*d*z+c*H*z+O*d*X-c*k*X)*be,s[10]=(x*H*_-V*C*_+V*d*L-c*H*L-x*d*X+c*C*X)*be,s[11]=(O*C*_-x*k*_-O*d*L+c*k*L+x*d*z-c*C*z)*be,s[12]=oe*be,s[13]=(O*H*p-V*k*p+V*d*N-c*H*N-O*d*G+c*k*G)*be,s[14]=(V*C*p-x*H*p-V*d*P+c*H*P+x*d*G-c*C*G)*be,s[15]=(x*k*p-O*C*p+O*d*P-c*k*P-x*d*N+c*C*N)*be,this}scale(s){const c=this.elements,d=s.x,p=s.y,_=s.z;return c[0]*=d,c[4]*=p,c[8]*=_,c[1]*=d,c[5]*=p,c[9]*=_,c[2]*=d,c[6]*=p,c[10]*=_,c[3]*=d,c[7]*=p,c[11]*=_,this}getMaxScaleOnAxis(){const s=this.elements,c=s[0]*s[0]+s[1]*s[1]+s[2]*s[2],d=s[4]*s[4]+s[5]*s[5]+s[6]*s[6],p=s[8]*s[8]+s[9]*s[9]+s[10]*s[10];return Math.sqrt(Math.max(c,d,p))}makeTranslation(s,c,d){return this.set(1,0,0,s,0,1,0,c,0,0,1,d,0,0,0,1),this}makeRotationX(s){const c=Math.cos(s),d=Math.sin(s);return this.set(1,0,0,0,0,c,-d,0,0,d,c,0,0,0,0,1),this}makeRotationY(s){const c=Math.cos(s),d=Math.sin(s);return this.set(c,0,d,0,0,1,0,0,-d,0,c,0,0,0,0,1),this}makeRotationZ(s){const c=Math.cos(s),d=Math.sin(s);return this.set(c,-d,0,0,d,c,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(s,c){const d=Math.cos(c),p=Math.sin(c),_=1-d,x=s.x,C=s.y,P=s.z,L=_*x,O=_*C;return this.set(L*x+d,L*C-p*P,L*P+p*C,0,L*C+p*P,O*C+d,O*P-p*x,0,L*P-p*C,O*P+p*x,_*P*P+d,0,0,0,0,1),this}makeScale(s,c,d){return this.set(s,0,0,0,0,c,0,0,0,0,d,0,0,0,0,1),this}makeShear(s,c,d,p,_,x){return this.set(1,d,_,0,s,1,x,0,c,p,1,0,0,0,0,1),this}compose(s,c,d){const p=this.elements,_=c._x,x=c._y,C=c._z,P=c._w,L=_+_,O=x+x,k=C+C,N=_*L,z=_*O,V=_*k,H=x*O,G=x*k,X=C*k,Z=P*L,ne=P*O,te=P*k,oe=d.x,ue=d.y,be=d.z;return p[0]=(1-(H+X))*oe,p[1]=(z+te)*oe,p[2]=(V-ne)*oe,p[3]=0,p[4]=(z-te)*ue,p[5]=(1-(N+X))*ue,p[6]=(G+Z)*ue,p[7]=0,p[8]=(V+ne)*be,p[9]=(G-Z)*be,p[10]=(1-(N+H))*be,p[11]=0,p[12]=s.x,p[13]=s.y,p[14]=s.z,p[15]=1,this}decompose(s,c,d){const p=this.elements;let _=qu.set(p[0],p[1],p[2]).length();const x=qu.set(p[4],p[5],p[6]).length(),C=qu.set(p[8],p[9],p[10]).length();this.determinant()<0&&(_=-_),s.x=p[12],s.y=p[13],s.z=p[14],Wo.copy(this);const L=1/_,O=1/x,k=1/C;return Wo.elements[0]*=L,Wo.elements[1]*=L,Wo.elements[2]*=L,Wo.elements[4]*=O,Wo.elements[5]*=O,Wo.elements[6]*=O,Wo.elements[8]*=k,Wo.elements[9]*=k,Wo.elements[10]*=k,c.setFromRotationMatrix(Wo),d.x=_,d.y=x,d.z=C,this}makePerspective(s,c,d,p,_,x){const C=this.elements,P=2*_/(c-s),L=2*_/(d-p),O=(c+s)/(c-s),k=(d+p)/(d-p),N=-(x+_)/(x-_),z=-2*x*_/(x-_);return C[0]=P,C[4]=0,C[8]=O,C[12]=0,C[1]=0,C[5]=L,C[9]=k,C[13]=0,C[2]=0,C[6]=0,C[10]=N,C[14]=z,C[3]=0,C[7]=0,C[11]=-1,C[15]=0,this}makeOrthographic(s,c,d,p,_,x){const C=this.elements,P=1/(c-s),L=1/(d-p),O=1/(x-_),k=(c+s)*P,N=(d+p)*L,z=(x+_)*O;return C[0]=2*P,C[4]=0,C[8]=0,C[12]=-k,C[1]=0,C[5]=2*L,C[9]=0,C[13]=-N,C[2]=0,C[6]=0,C[10]=-2*O,C[14]=-z,C[3]=0,C[7]=0,C[11]=0,C[15]=1,this}equals(s){const c=this.elements,d=s.elements;for(let p=0;p<16;p++)if(c[p]!==d[p])return!1;return!0}fromArray(s,c=0){for(let d=0;d<16;d++)this.elements[d]=s[d+c];return this}toArray(s=[],c=0){const d=this.elements;return s[c]=d[0],s[c+1]=d[1],s[c+2]=d[2],s[c+3]=d[3],s[c+4]=d[4],s[c+5]=d[5],s[c+6]=d[6],s[c+7]=d[7],s[c+8]=d[8],s[c+9]=d[9],s[c+10]=d[10],s[c+11]=d[11],s[c+12]=d[12],s[c+13]=d[13],s[c+14]=d[14],s[c+15]=d[15],s}}const qu=new de,Wo=new $n,dk=new de(0,0,0),fk=new de(1,1,1),Kc=new de,AA=new de,Xr=new de,zM=new $n,GM=new Br;class Xu{constructor(s=0,c=0,d=0,p=Xu.DefaultOrder){this.isEuler=!0,this._x=s,this._y=c,this._z=d,this._order=p}get x(){return this._x}set x(s){this._x=s,this._onChangeCallback()}get y(){return this._y}set y(s){this._y=s,this._onChangeCallback()}get z(){return this._z}set z(s){this._z=s,this._onChangeCallback()}get order(){return this._order}set order(s){this._order=s,this._onChangeCallback()}set(s,c,d,p=this._order){return this._x=s,this._y=c,this._z=d,this._order=p,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(s){return this._x=s._x,this._y=s._y,this._z=s._z,this._order=s._order,this._onChangeCallback(),this}setFromRotationMatrix(s,c=this._order,d=!0){const p=s.elements,_=p[0],x=p[4],C=p[8],P=p[1],L=p[5],O=p[9],k=p[2],N=p[6],z=p[10];switch(c){case"XYZ":this._y=Math.asin(ds(C,-1,1)),Math.abs(C)<.9999999?(this._x=Math.atan2(-O,z),this._z=Math.atan2(-x,_)):(this._x=Math.atan2(N,L),this._z=0);break;case"YXZ":this._x=Math.asin(-ds(O,-1,1)),Math.abs(O)<.9999999?(this._y=Math.atan2(C,z),this._z=Math.atan2(P,L)):(this._y=Math.atan2(-k,_),this._z=0);break;case"ZXY":this._x=Math.asin(ds(N,-1,1)),Math.abs(N)<.9999999?(this._y=Math.atan2(-k,z),this._z=Math.atan2(-x,L)):(this._y=0,this._z=Math.atan2(P,_));break;case"ZYX":this._y=Math.asin(-ds(k,-1,1)),Math.abs(k)<.9999999?(this._x=Math.atan2(N,z),this._z=Math.atan2(P,_)):(this._x=0,this._z=Math.atan2(-x,L));break;case"YZX":this._z=Math.asin(ds(P,-1,1)),Math.abs(P)<.9999999?(this._x=Math.atan2(-O,L),this._y=Math.atan2(-k,_)):(this._x=0,this._y=Math.atan2(C,z));break;case"XZY":this._z=Math.asin(-ds(x,-1,1)),Math.abs(x)<.9999999?(this._x=Math.atan2(N,L),this._y=Math.atan2(C,_)):(this._x=Math.atan2(-O,z),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+c)}return this._order=c,d===!0&&this._onChangeCallback(),this}setFromQuaternion(s,c,d){return zM.makeRotationFromQuaternion(s),this.setFromRotationMatrix(zM,c,d)}setFromVector3(s,c=this._order){return this.set(s.x,s.y,s.z,c)}reorder(s){return GM.setFromEuler(this),this.setFromQuaternion(GM,s)}equals(s){return s._x===this._x&&s._y===this._y&&s._z===this._z&&s._order===this._order}fromArray(s){return this._x=s[0],this._y=s[1],this._z=s[2],s[3]!==void 0&&(this._order=s[3]),this._onChangeCallback(),this}toArray(s=[],c=0){return s[c]=this._x,s[c+1]=this._y,s[c+2]=this._z,s[c+3]=this._order,s}_onChange(s){return this._onChangeCallback=s,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}toVector3(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")}}Xu.DefaultOrder="XYZ",Xu.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class _A{constructor(){this.mask=1}set(s){this.mask=(1<<s|0)>>>0}enable(s){this.mask|=1<<s|0}enableAll(){this.mask=-1}toggle(s){this.mask^=1<<s|0}disable(s){this.mask&=~(1<<s|0)}disableAll(){this.mask=0}test(s){return(this.mask&s.mask)!==0}isEnabled(s){return(this.mask&(1<<s|0))!==0}}let pk=0;const HM=new de,Yu=new Br,tc=new $n,yA=new de,up=new de,mk=new de,gk=new Br,VM=new de(1,0,0),WM=new de(0,1,0),QM=new de(0,0,1),Ak={type:"added"},jM={type:"removed"};class wi extends Za{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:pk++}),this.uuid=qr(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=wi.DefaultUp.clone();const s=new de,c=new Xu,d=new Br,p=new de(1,1,1);function _(){d.setFromEuler(c,!1)}function x(){c.setFromQuaternion(d,void 0,!1)}c._onChange(_),d._onChange(x),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:s},rotation:{configurable:!0,enumerable:!0,value:c},quaternion:{configurable:!0,enumerable:!0,value:d},scale:{configurable:!0,enumerable:!0,value:p},modelViewMatrix:{value:new $n},normalMatrix:{value:new Pr}}),this.matrix=new $n,this.matrixWorld=new $n,this.matrixAutoUpdate=wi.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=wi.DefaultMatrixWorldAutoUpdate,this.layers=new _A,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(s){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(s),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(s){return this.quaternion.premultiply(s),this}setRotationFromAxisAngle(s,c){this.quaternion.setFromAxisAngle(s,c)}setRotationFromEuler(s){this.quaternion.setFromEuler(s,!0)}setRotationFromMatrix(s){this.quaternion.setFromRotationMatrix(s)}setRotationFromQuaternion(s){this.quaternion.copy(s)}rotateOnAxis(s,c){return Yu.setFromAxisAngle(s,c),this.quaternion.multiply(Yu),this}rotateOnWorldAxis(s,c){return Yu.setFromAxisAngle(s,c),this.quaternion.premultiply(Yu),this}rotateX(s){return this.rotateOnAxis(VM,s)}rotateY(s){return this.rotateOnAxis(WM,s)}rotateZ(s){return this.rotateOnAxis(QM,s)}translateOnAxis(s,c){return HM.copy(s).applyQuaternion(this.quaternion),this.position.add(HM.multiplyScalar(c)),this}translateX(s){return this.translateOnAxis(VM,s)}translateY(s){return this.translateOnAxis(WM,s)}translateZ(s){return this.translateOnAxis(QM,s)}localToWorld(s){return s.applyMatrix4(this.matrixWorld)}worldToLocal(s){return s.applyMatrix4(tc.copy(this.matrixWorld).invert())}lookAt(s,c,d){s.isVector3?yA.copy(s):yA.set(s,c,d);const p=this.parent;this.updateWorldMatrix(!0,!1),up.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?tc.lookAt(up,yA,this.up):tc.lookAt(yA,up,this.up),this.quaternion.setFromRotationMatrix(tc),p&&(tc.extractRotation(p.matrixWorld),Yu.setFromRotationMatrix(tc),this.quaternion.premultiply(Yu.invert()))}add(s){if(arguments.length>1){for(let c=0;c<arguments.length;c++)this.add(arguments[c]);return this}return s===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",s),this):(s&&s.isObject3D?(s.parent!==null&&s.parent.remove(s),s.parent=this,this.children.push(s),s.dispatchEvent(Ak)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",s),this)}remove(s){if(arguments.length>1){for(let d=0;d<arguments.length;d++)this.remove(arguments[d]);return this}const c=this.children.indexOf(s);return c!==-1&&(s.parent=null,this.children.splice(c,1),s.dispatchEvent(jM)),this}removeFromParent(){const s=this.parent;return s!==null&&s.remove(this),this}clear(){for(let s=0;s<this.children.length;s++){const c=this.children[s];c.parent=null,c.dispatchEvent(jM)}return this.children.length=0,this}attach(s){return this.updateWorldMatrix(!0,!1),tc.copy(this.matrixWorld).invert(),s.parent!==null&&(s.parent.updateWorldMatrix(!0,!1),tc.multiply(s.parent.matrixWorld)),s.applyMatrix4(tc),this.add(s),s.updateWorldMatrix(!1,!0),this}getObjectById(s){return this.getObjectByProperty("id",s)}getObjectByName(s){return this.getObjectByProperty("name",s)}getObjectByProperty(s,c){if(this[s]===c)return this;for(let d=0,p=this.children.length;d<p;d++){const x=this.children[d].getObjectByProperty(s,c);if(x!==void 0)return x}}getWorldPosition(s){return this.updateWorldMatrix(!0,!1),s.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(s){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(up,s,mk),s}getWorldScale(s){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(up,gk,s),s}getWorldDirection(s){this.updateWorldMatrix(!0,!1);const c=this.matrixWorld.elements;return s.set(c[8],c[9],c[10]).normalize()}raycast(){}traverse(s){s(this);const c=this.children;for(let d=0,p=c.length;d<p;d++)c[d].traverse(s)}traverseVisible(s){if(this.visible===!1)return;s(this);const c=this.children;for(let d=0,p=c.length;d<p;d++)c[d].traverseVisible(s)}traverseAncestors(s){const c=this.parent;c!==null&&(s(c),c.traverseAncestors(s))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(s){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||s)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,s=!0);const c=this.children;for(let d=0,p=c.length;d<p;d++){const _=c[d];(_.matrixWorldAutoUpdate===!0||s===!0)&&_.updateMatrixWorld(s)}}updateWorldMatrix(s,c){const d=this.parent;if(s===!0&&d!==null&&d.matrixWorldAutoUpdate===!0&&d.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),c===!0){const p=this.children;for(let _=0,x=p.length;_<x;_++){const C=p[_];C.matrixWorldAutoUpdate===!0&&C.updateWorldMatrix(!1,!0)}}}toJSON(s){const c=s===void 0||typeof s=="string",d={};c&&(s={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},d.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const p={};p.uuid=this.uuid,p.type=this.type,this.name!==""&&(p.name=this.name),this.castShadow===!0&&(p.castShadow=!0),this.receiveShadow===!0&&(p.receiveShadow=!0),this.visible===!1&&(p.visible=!1),this.frustumCulled===!1&&(p.frustumCulled=!1),this.renderOrder!==0&&(p.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(p.userData=this.userData),p.layers=this.layers.mask,p.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(p.matrixAutoUpdate=!1),this.isInstancedMesh&&(p.type="InstancedMesh",p.count=this.count,p.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(p.instanceColor=this.instanceColor.toJSON()));function _(C,P){return C[P.uuid]===void 0&&(C[P.uuid]=P.toJSON(s)),P.uuid}if(this.isScene)this.background&&(this.background.isColor?p.background=this.background.toJSON():this.background.isTexture&&(p.background=this.background.toJSON(s).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(p.environment=this.environment.toJSON(s).uuid);else if(this.isMesh||this.isLine||this.isPoints){p.geometry=_(s.geometries,this.geometry);const C=this.geometry.parameters;if(C!==void 0&&C.shapes!==void 0){const P=C.shapes;if(Array.isArray(P))for(let L=0,O=P.length;L<O;L++){const k=P[L];_(s.shapes,k)}else _(s.shapes,P)}}if(this.isSkinnedMesh&&(p.bindMode=this.bindMode,p.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(_(s.skeletons,this.skeleton),p.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const C=[];for(let P=0,L=this.material.length;P<L;P++)C.push(_(s.materials,this.material[P]));p.material=C}else p.material=_(s.materials,this.material);if(this.children.length>0){p.children=[];for(let C=0;C<this.children.length;C++)p.children.push(this.children[C].toJSON(s).object)}if(this.animations.length>0){p.animations=[];for(let C=0;C<this.animations.length;C++){const P=this.animations[C];p.animations.push(_(s.animations,P))}}if(c){const C=x(s.geometries),P=x(s.materials),L=x(s.textures),O=x(s.images),k=x(s.shapes),N=x(s.skeletons),z=x(s.animations),V=x(s.nodes);C.length>0&&(d.geometries=C),P.length>0&&(d.materials=P),L.length>0&&(d.textures=L),O.length>0&&(d.images=O),k.length>0&&(d.shapes=k),N.length>0&&(d.skeletons=N),z.length>0&&(d.animations=z),V.length>0&&(d.nodes=V)}return d.object=p,d;function x(C){const P=[];for(const L in C){const O=C[L];delete O.metadata,P.push(O)}return P}}clone(s){return new this.constructor().copy(this,s)}copy(s,c=!0){if(this.name=s.name,this.up.copy(s.up),this.position.copy(s.position),this.rotation.order=s.rotation.order,this.quaternion.copy(s.quaternion),this.scale.copy(s.scale),this.matrix.copy(s.matrix),this.matrixWorld.copy(s.matrixWorld),this.matrixAutoUpdate=s.matrixAutoUpdate,this.matrixWorldNeedsUpdate=s.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=s.matrixWorldAutoUpdate,this.layers.mask=s.layers.mask,this.visible=s.visible,this.castShadow=s.castShadow,this.receiveShadow=s.receiveShadow,this.frustumCulled=s.frustumCulled,this.renderOrder=s.renderOrder,this.userData=JSON.parse(JSON.stringify(s.userData)),c===!0)for(let d=0;d<s.children.length;d++){const p=s.children[d];this.add(p.clone())}return this}}wi.DefaultUp=new de(0,1,0),wi.DefaultMatrixAutoUpdate=!0,wi.DefaultMatrixWorldAutoUpdate=!0;const Qo=new de,nc=new de,nx=new de,ic=new de,Ju=new de,Zu=new de,qM=new de,ix=new de,sx=new de,rx=new de;class yo{constructor(s=new de,c=new de,d=new de){this.a=s,this.b=c,this.c=d}static getNormal(s,c,d,p){p.subVectors(d,c),Qo.subVectors(s,c),p.cross(Qo);const _=p.lengthSq();return _>0?p.multiplyScalar(1/Math.sqrt(_)):p.set(0,0,0)}static getBarycoord(s,c,d,p,_){Qo.subVectors(p,c),nc.subVectors(d,c),nx.subVectors(s,c);const x=Qo.dot(Qo),C=Qo.dot(nc),P=Qo.dot(nx),L=nc.dot(nc),O=nc.dot(nx),k=x*L-C*C;if(k===0)return _.set(-2,-1,-1);const N=1/k,z=(L*P-C*O)*N,V=(x*O-C*P)*N;return _.set(1-z-V,V,z)}static containsPoint(s,c,d,p){return this.getBarycoord(s,c,d,p,ic),ic.x>=0&&ic.y>=0&&ic.x+ic.y<=1}static getUV(s,c,d,p,_,x,C,P){return this.getBarycoord(s,c,d,p,ic),P.set(0,0),P.addScaledVector(_,ic.x),P.addScaledVector(x,ic.y),P.addScaledVector(C,ic.z),P}static isFrontFacing(s,c,d,p){return Qo.subVectors(d,c),nc.subVectors(s,c),Qo.cross(nc).dot(p)<0}set(s,c,d){return this.a.copy(s),this.b.copy(c),this.c.copy(d),this}setFromPointsAndIndices(s,c,d,p){return this.a.copy(s[c]),this.b.copy(s[d]),this.c.copy(s[p]),this}setFromAttributeAndIndices(s,c,d,p){return this.a.fromBufferAttribute(s,c),this.b.fromBufferAttribute(s,d),this.c.fromBufferAttribute(s,p),this}clone(){return new this.constructor().copy(this)}copy(s){return this.a.copy(s.a),this.b.copy(s.b),this.c.copy(s.c),this}getArea(){return Qo.subVectors(this.c,this.b),nc.subVectors(this.a,this.b),Qo.cross(nc).length()*.5}getMidpoint(s){return s.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(s){return yo.getNormal(this.a,this.b,this.c,s)}getPlane(s){return s.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(s,c){return yo.getBarycoord(s,this.a,this.b,this.c,c)}getUV(s,c,d,p,_){return yo.getUV(s,this.a,this.b,this.c,c,d,p,_)}containsPoint(s){return yo.containsPoint(s,this.a,this.b,this.c)}isFrontFacing(s){return yo.isFrontFacing(this.a,this.b,this.c,s)}intersectsBox(s){return s.intersectsTriangle(this)}closestPointToPoint(s,c){const d=this.a,p=this.b,_=this.c;let x,C;Ju.subVectors(p,d),Zu.subVectors(_,d),ix.subVectors(s,d);const P=Ju.dot(ix),L=Zu.dot(ix);if(P<=0&&L<=0)return c.copy(d);sx.subVectors(s,p);const O=Ju.dot(sx),k=Zu.dot(sx);if(O>=0&&k<=O)return c.copy(p);const N=P*k-O*L;if(N<=0&&P>=0&&O<=0)return x=P/(P-O),c.copy(d).addScaledVector(Ju,x);rx.subVectors(s,_);const z=Ju.dot(rx),V=Zu.dot(rx);if(V>=0&&z<=V)return c.copy(_);const H=z*L-P*V;if(H<=0&&L>=0&&V<=0)return C=L/(L-V),c.copy(d).addScaledVector(Zu,C);const G=O*V-z*k;if(G<=0&&k-O>=0&&z-V>=0)return qM.subVectors(_,p),C=(k-O)/(k-O+(z-V)),c.copy(p).addScaledVector(qM,C);const X=1/(G+H+N);return x=H*X,C=N*X,c.copy(d).addScaledVector(Ju,x).addScaledVector(Zu,C)}equals(s){return s.a.equals(this.a)&&s.b.equals(this.b)&&s.c.equals(this.c)}}let _k=0;class rr extends Za{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:_k++}),this.uuid=qr(),this.name="",this.type="Material",this.blending=w,this.side=g,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=Q,this.blendDst=Y,this.blendEquation=I,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=$e,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=LM,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=rA,this.stencilZFail=rA,this.stencilZPass=rA,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(s){this._alphaTest>0!=s>0&&this.version++,this._alphaTest=s}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(s){if(s!==void 0)for(const c in s){const d=s[c];if(d===void 0){console.warn("THREE.Material: '"+c+"' parameter is undefined.");continue}const p=this[c];if(p===void 0){console.warn("THREE."+this.type+": '"+c+"' is not a property of this material.");continue}p&&p.isColor?p.set(d):p&&p.isVector3&&d&&d.isVector3?p.copy(d):this[c]=d}}toJSON(s){const c=s===void 0||typeof s=="string";c&&(s={textures:{},images:{}});const d={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};d.uuid=this.uuid,d.type=this.type,this.name!==""&&(d.name=this.name),this.color&&this.color.isColor&&(d.color=this.color.getHex()),this.roughness!==void 0&&(d.roughness=this.roughness),this.metalness!==void 0&&(d.metalness=this.metalness),this.sheen!==void 0&&(d.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(d.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(d.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(d.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(d.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(d.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(d.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(d.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(d.shininess=this.shininess),this.clearcoat!==void 0&&(d.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(d.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(d.clearcoatMap=this.clearcoatMap.toJSON(s).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(d.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(s).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(d.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(s).uuid,d.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(d.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(d.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(d.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(d.iridescenceMap=this.iridescenceMap.toJSON(s).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(d.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(s).uuid),this.map&&this.map.isTexture&&(d.map=this.map.toJSON(s).uuid),this.matcap&&this.matcap.isTexture&&(d.matcap=this.matcap.toJSON(s).uuid),this.alphaMap&&this.alphaMap.isTexture&&(d.alphaMap=this.alphaMap.toJSON(s).uuid),this.lightMap&&this.lightMap.isTexture&&(d.lightMap=this.lightMap.toJSON(s).uuid,d.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(d.aoMap=this.aoMap.toJSON(s).uuid,d.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(d.bumpMap=this.bumpMap.toJSON(s).uuid,d.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(d.normalMap=this.normalMap.toJSON(s).uuid,d.normalMapType=this.normalMapType,d.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(d.displacementMap=this.displacementMap.toJSON(s).uuid,d.displacementScale=this.displacementScale,d.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(d.roughnessMap=this.roughnessMap.toJSON(s).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(d.metalnessMap=this.metalnessMap.toJSON(s).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(d.emissiveMap=this.emissiveMap.toJSON(s).uuid),this.specularMap&&this.specularMap.isTexture&&(d.specularMap=this.specularMap.toJSON(s).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(d.specularIntensityMap=this.specularIntensityMap.toJSON(s).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(d.specularColorMap=this.specularColorMap.toJSON(s).uuid),this.envMap&&this.envMap.isTexture&&(d.envMap=this.envMap.toJSON(s).uuid,this.combine!==void 0&&(d.combine=this.combine)),this.envMapIntensity!==void 0&&(d.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(d.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(d.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(d.gradientMap=this.gradientMap.toJSON(s).uuid),this.transmission!==void 0&&(d.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(d.transmissionMap=this.transmissionMap.toJSON(s).uuid),this.thickness!==void 0&&(d.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(d.thicknessMap=this.thicknessMap.toJSON(s).uuid),this.attenuationDistance!==void 0&&(d.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(d.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(d.size=this.size),this.shadowSide!==null&&(d.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(d.sizeAttenuation=this.sizeAttenuation),this.blending!==w&&(d.blending=this.blending),this.side!==g&&(d.side=this.side),this.vertexColors&&(d.vertexColors=!0),this.opacity<1&&(d.opacity=this.opacity),this.transparent===!0&&(d.transparent=this.transparent),d.depthFunc=this.depthFunc,d.depthTest=this.depthTest,d.depthWrite=this.depthWrite,d.colorWrite=this.colorWrite,d.stencilWrite=this.stencilWrite,d.stencilWriteMask=this.stencilWriteMask,d.stencilFunc=this.stencilFunc,d.stencilRef=this.stencilRef,d.stencilFuncMask=this.stencilFuncMask,d.stencilFail=this.stencilFail,d.stencilZFail=this.stencilZFail,d.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(d.rotation=this.rotation),this.polygonOffset===!0&&(d.polygonOffset=!0),this.polygonOffsetFactor!==0&&(d.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(d.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(d.linewidth=this.linewidth),this.dashSize!==void 0&&(d.dashSize=this.dashSize),this.gapSize!==void 0&&(d.gapSize=this.gapSize),this.scale!==void 0&&(d.scale=this.scale),this.dithering===!0&&(d.dithering=!0),this.alphaTest>0&&(d.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(d.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(d.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(d.wireframe=this.wireframe),this.wireframeLinewidth>1&&(d.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(d.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(d.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(d.flatShading=this.flatShading),this.visible===!1&&(d.visible=!1),this.toneMapped===!1&&(d.toneMapped=!1),this.fog===!1&&(d.fog=!1),JSON.stringify(this.userData)!=="{}"&&(d.userData=this.userData);function p(_){const x=[];for(const C in _){const P=_[C];delete P.metadata,x.push(P)}return x}if(c){const _=p(s.textures),x=p(s.images);_.length>0&&(d.textures=_),x.length>0&&(d.images=x)}return d}clone(){return new this.constructor().copy(this)}copy(s){this.name=s.name,this.blending=s.blending,this.side=s.side,this.vertexColors=s.vertexColors,this.opacity=s.opacity,this.transparent=s.transparent,this.blendSrc=s.blendSrc,this.blendDst=s.blendDst,this.blendEquation=s.blendEquation,this.blendSrcAlpha=s.blendSrcAlpha,this.blendDstAlpha=s.blendDstAlpha,this.blendEquationAlpha=s.blendEquationAlpha,this.depthFunc=s.depthFunc,this.depthTest=s.depthTest,this.depthWrite=s.depthWrite,this.stencilWriteMask=s.stencilWriteMask,this.stencilFunc=s.stencilFunc,this.stencilRef=s.stencilRef,this.stencilFuncMask=s.stencilFuncMask,this.stencilFail=s.stencilFail,this.stencilZFail=s.stencilZFail,this.stencilZPass=s.stencilZPass,this.stencilWrite=s.stencilWrite;const c=s.clippingPlanes;let d=null;if(c!==null){const p=c.length;d=new Array(p);for(let _=0;_!==p;++_)d[_]=c[_].clone()}return this.clippingPlanes=d,this.clipIntersection=s.clipIntersection,this.clipShadows=s.clipShadows,this.shadowSide=s.shadowSide,this.colorWrite=s.colorWrite,this.precision=s.precision,this.polygonOffset=s.polygonOffset,this.polygonOffsetFactor=s.polygonOffsetFactor,this.polygonOffsetUnits=s.polygonOffsetUnits,this.dithering=s.dithering,this.alphaTest=s.alphaTest,this.alphaToCoverage=s.alphaToCoverage,this.premultipliedAlpha=s.premultipliedAlpha,this.visible=s.visible,this.toneMapped=s.toneMapped,this.userData=JSON.parse(JSON.stringify(s.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(s){s===!0&&this.version++}}class $c extends rr{constructor(s){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new dn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Xt,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(s)}copy(s){return super.copy(s),this.color.copy(s.color),this.map=s.map,this.lightMap=s.lightMap,this.lightMapIntensity=s.lightMapIntensity,this.aoMap=s.aoMap,this.aoMapIntensity=s.aoMapIntensity,this.specularMap=s.specularMap,this.alphaMap=s.alphaMap,this.envMap=s.envMap,this.combine=s.combine,this.reflectivity=s.reflectivity,this.refractionRatio=s.refractionRatio,this.wireframe=s.wireframe,this.wireframeLinewidth=s.wireframeLinewidth,this.wireframeLinecap=s.wireframeLinecap,this.wireframeLinejoin=s.wireframeLinejoin,this.fog=s.fog,this}}const xs=new de,vA=new mt;class Oi{constructor(s,c,d){if(Array.isArray(s))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=s,this.itemSize=c,this.count=s!==void 0?s.length/c:0,this.normalized=d===!0,this.usage=sp,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(s){s===!0&&this.version++}setUsage(s){return this.usage=s,this}copy(s){return this.name=s.name,this.array=new s.array.constructor(s.array),this.itemSize=s.itemSize,this.count=s.count,this.normalized=s.normalized,this.usage=s.usage,this}copyAt(s,c,d){s*=this.itemSize,d*=c.itemSize;for(let p=0,_=this.itemSize;p<_;p++)this.array[s+p]=c.array[d+p];return this}copyArray(s){return this.array.set(s),this}applyMatrix3(s){if(this.itemSize===2)for(let c=0,d=this.count;c<d;c++)vA.fromBufferAttribute(this,c),vA.applyMatrix3(s),this.setXY(c,vA.x,vA.y);else if(this.itemSize===3)for(let c=0,d=this.count;c<d;c++)xs.fromBufferAttribute(this,c),xs.applyMatrix3(s),this.setXYZ(c,xs.x,xs.y,xs.z);return this}applyMatrix4(s){for(let c=0,d=this.count;c<d;c++)xs.fromBufferAttribute(this,c),xs.applyMatrix4(s),this.setXYZ(c,xs.x,xs.y,xs.z);return this}applyNormalMatrix(s){for(let c=0,d=this.count;c<d;c++)xs.fromBufferAttribute(this,c),xs.applyNormalMatrix(s),this.setXYZ(c,xs.x,xs.y,xs.z);return this}transformDirection(s){for(let c=0,d=this.count;c<d;c++)xs.fromBufferAttribute(this,c),xs.transformDirection(s),this.setXYZ(c,xs.x,xs.y,xs.z);return this}set(s,c=0){return this.array.set(s,c),this}getX(s){let c=this.array[s*this.itemSize];return this.normalized&&(c=Ka(c,this.array)),c}setX(s,c){return this.normalized&&(c=Di(c,this.array)),this.array[s*this.itemSize]=c,this}getY(s){let c=this.array[s*this.itemSize+1];return this.normalized&&(c=Ka(c,this.array)),c}setY(s,c){return this.normalized&&(c=Di(c,this.array)),this.array[s*this.itemSize+1]=c,this}getZ(s){let c=this.array[s*this.itemSize+2];return this.normalized&&(c=Ka(c,this.array)),c}setZ(s,c){return this.normalized&&(c=Di(c,this.array)),this.array[s*this.itemSize+2]=c,this}getW(s){let c=this.array[s*this.itemSize+3];return this.normalized&&(c=Ka(c,this.array)),c}setW(s,c){return this.normalized&&(c=Di(c,this.array)),this.array[s*this.itemSize+3]=c,this}setXY(s,c,d){return s*=this.itemSize,this.normalized&&(c=Di(c,this.array),d=Di(d,this.array)),this.array[s+0]=c,this.array[s+1]=d,this}setXYZ(s,c,d,p){return s*=this.itemSize,this.normalized&&(c=Di(c,this.array),d=Di(d,this.array),p=Di(p,this.array)),this.array[s+0]=c,this.array[s+1]=d,this.array[s+2]=p,this}setXYZW(s,c,d,p,_){return s*=this.itemSize,this.normalized&&(c=Di(c,this.array),d=Di(d,this.array),p=Di(p,this.array),_=Di(_,this.array)),this.array[s+0]=c,this.array[s+1]=d,this.array[s+2]=p,this.array[s+3]=_,this}onUpload(s){return this.onUploadCallback=s,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const s={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(s.name=this.name),this.usage!==sp&&(s.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(s.updateRange=this.updateRange),s}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class yk extends Oi{constructor(s,c,d){super(new Int8Array(s),c,d)}}class vk extends Oi{constructor(s,c,d){super(new Uint8Array(s),c,d)}}class xk extends Oi{constructor(s,c,d){super(new Uint8ClampedArray(s),c,d)}}class wk extends Oi{constructor(s,c,d){super(new Int16Array(s),c,d)}}class ox extends Oi{constructor(s,c,d){super(new Uint16Array(s),c,d)}}class bk extends Oi{constructor(s,c,d){super(new Int32Array(s),c,d)}}class ax extends Oi{constructor(s,c,d){super(new Uint32Array(s),c,d)}}class Ek extends Oi{constructor(s,c,d){super(new Uint16Array(s),c,d),this.isFloat16BufferAttribute=!0}}class gn extends Oi{constructor(s,c,d){super(new Float32Array(s),c,d)}}class Ck extends Oi{constructor(s,c,d){super(new Float64Array(s),c,d)}}let Sk=0;const vo=new $n,cx=new wi,Ku=new de,Yr=new _h,dp=new _h,Gs=new de;class si extends Za{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Sk++}),this.uuid=qr(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(s){return Array.isArray(s)?this.index=new(FM(s)?ax:ox)(s,1):this.index=s,this}getAttribute(s){return this.attributes[s]}setAttribute(s,c){return this.attributes[s]=c,this}deleteAttribute(s){return delete this.attributes[s],this}hasAttribute(s){return this.attributes[s]!==void 0}addGroup(s,c,d=0){this.groups.push({start:s,count:c,materialIndex:d})}clearGroups(){this.groups=[]}setDrawRange(s,c){this.drawRange.start=s,this.drawRange.count=c}applyMatrix4(s){const c=this.attributes.position;c!==void 0&&(c.applyMatrix4(s),c.needsUpdate=!0);const d=this.attributes.normal;if(d!==void 0){const _=new Pr().getNormalMatrix(s);d.applyNormalMatrix(_),d.needsUpdate=!0}const p=this.attributes.tangent;return p!==void 0&&(p.transformDirection(s),p.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(s){return vo.makeRotationFromQuaternion(s),this.applyMatrix4(vo),this}rotateX(s){return vo.makeRotationX(s),this.applyMatrix4(vo),this}rotateY(s){return vo.makeRotationY(s),this.applyMatrix4(vo),this}rotateZ(s){return vo.makeRotationZ(s),this.applyMatrix4(vo),this}translate(s,c,d){return vo.makeTranslation(s,c,d),this.applyMatrix4(vo),this}scale(s,c,d){return vo.makeScale(s,c,d),this.applyMatrix4(vo),this}lookAt(s){return cx.lookAt(s),cx.updateMatrix(),this.applyMatrix4(cx.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Ku).negate(),this.translate(Ku.x,Ku.y,Ku.z),this}setFromPoints(s){const c=[];for(let d=0,p=s.length;d<p;d++){const _=s[d];c.push(_.x,_.y,_.z||0)}return this.setAttribute("position",new gn(c,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new _h);const s=this.attributes.position,c=this.morphAttributes.position;if(s&&s.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new de(-1/0,-1/0,-1/0),new de(1/0,1/0,1/0));return}if(s!==void 0){if(this.boundingBox.setFromBufferAttribute(s),c)for(let d=0,p=c.length;d<p;d++){const _=c[d];Yr.setFromBufferAttribute(_),this.morphTargetsRelative?(Gs.addVectors(this.boundingBox.min,Yr.min),this.boundingBox.expandByPoint(Gs),Gs.addVectors(this.boundingBox.max,Yr.max),this.boundingBox.expandByPoint(Gs)):(this.boundingBox.expandByPoint(Yr.min),this.boundingBox.expandByPoint(Yr.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new wh);const s=this.attributes.position,c=this.morphAttributes.position;if(s&&s.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new de,1/0);return}if(s){const d=this.boundingSphere.center;if(Yr.setFromBufferAttribute(s),c)for(let _=0,x=c.length;_<x;_++){const C=c[_];dp.setFromBufferAttribute(C),this.morphTargetsRelative?(Gs.addVectors(Yr.min,dp.min),Yr.expandByPoint(Gs),Gs.addVectors(Yr.max,dp.max),Yr.expandByPoint(Gs)):(Yr.expandByPoint(dp.min),Yr.expandByPoint(dp.max))}Yr.getCenter(d);let p=0;for(let _=0,x=s.count;_<x;_++)Gs.fromBufferAttribute(s,_),p=Math.max(p,d.distanceToSquared(Gs));if(c)for(let _=0,x=c.length;_<x;_++){const C=c[_],P=this.morphTargetsRelative;for(let L=0,O=C.count;L<O;L++)Gs.fromBufferAttribute(C,L),P&&(Ku.fromBufferAttribute(s,L),Gs.add(Ku)),p=Math.max(p,d.distanceToSquared(Gs))}this.boundingSphere.radius=Math.sqrt(p),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const s=this.index,c=this.attributes;if(s===null||c.position===void 0||c.normal===void 0||c.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const d=s.array,p=c.position.array,_=c.normal.array,x=c.uv.array,C=p.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Oi(new Float32Array(4*C),4));const P=this.getAttribute("tangent").array,L=[],O=[];for(let Se=0;Se<C;Se++)L[Se]=new de,O[Se]=new de;const k=new de,N=new de,z=new de,V=new mt,H=new mt,G=new mt,X=new de,Z=new de;function ne(Se,et,Mt){k.fromArray(p,Se*3),N.fromArray(p,et*3),z.fromArray(p,Mt*3),V.fromArray(x,Se*2),H.fromArray(x,et*2),G.fromArray(x,Mt*2),N.sub(k),z.sub(k),H.sub(V),G.sub(V);const Ye=1/(H.x*G.y-G.x*H.y);!isFinite(Ye)||(X.copy(N).multiplyScalar(G.y).addScaledVector(z,-H.y).multiplyScalar(Ye),Z.copy(z).multiplyScalar(H.x).addScaledVector(N,-G.x).multiplyScalar(Ye),L[Se].add(X),L[et].add(X),L[Mt].add(X),O[Se].add(Z),O[et].add(Z),O[Mt].add(Z))}let te=this.groups;te.length===0&&(te=[{start:0,count:d.length}]);for(let Se=0,et=te.length;Se<et;++Se){const Mt=te[Se],Ye=Mt.start,Oe=Mt.count;for(let rt=Ye,gt=Ye+Oe;rt<gt;rt+=3)ne(d[rt+0],d[rt+1],d[rt+2])}const oe=new de,ue=new de,be=new de,$=new de;function ge(Se){be.fromArray(_,Se*3),$.copy(be);const et=L[Se];oe.copy(et),oe.sub(be.multiplyScalar(be.dot(et))).normalize(),ue.crossVectors($,et);const Ye=ue.dot(O[Se])<0?-1:1;P[Se*4]=oe.x,P[Se*4+1]=oe.y,P[Se*4+2]=oe.z,P[Se*4+3]=Ye}for(let Se=0,et=te.length;Se<et;++Se){const Mt=te[Se],Ye=Mt.start,Oe=Mt.count;for(let rt=Ye,gt=Ye+Oe;rt<gt;rt+=3)ge(d[rt+0]),ge(d[rt+1]),ge(d[rt+2])}}computeVertexNormals(){const s=this.index,c=this.getAttribute("position");if(c!==void 0){let d=this.getAttribute("normal");if(d===void 0)d=new Oi(new Float32Array(c.count*3),3),this.setAttribute("normal",d);else for(let N=0,z=d.count;N<z;N++)d.setXYZ(N,0,0,0);const p=new de,_=new de,x=new de,C=new de,P=new de,L=new de,O=new de,k=new de;if(s)for(let N=0,z=s.count;N<z;N+=3){const V=s.getX(N+0),H=s.getX(N+1),G=s.getX(N+2);p.fromBufferAttribute(c,V),_.fromBufferAttribute(c,H),x.fromBufferAttribute(c,G),O.subVectors(x,_),k.subVectors(p,_),O.cross(k),C.fromBufferAttribute(d,V),P.fromBufferAttribute(d,H),L.fromBufferAttribute(d,G),C.add(O),P.add(O),L.add(O),d.setXYZ(V,C.x,C.y,C.z),d.setXYZ(H,P.x,P.y,P.z),d.setXYZ(G,L.x,L.y,L.z)}else for(let N=0,z=c.count;N<z;N+=3)p.fromBufferAttribute(c,N+0),_.fromBufferAttribute(c,N+1),x.fromBufferAttribute(c,N+2),O.subVectors(x,_),k.subVectors(p,_),O.cross(k),d.setXYZ(N+0,O.x,O.y,O.z),d.setXYZ(N+1,O.x,O.y,O.z),d.setXYZ(N+2,O.x,O.y,O.z);this.normalizeNormals(),d.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){const s=this.attributes.normal;for(let c=0,d=s.count;c<d;c++)Gs.fromBufferAttribute(s,c),Gs.normalize(),s.setXYZ(c,Gs.x,Gs.y,Gs.z)}toNonIndexed(){function s(C,P){const L=C.array,O=C.itemSize,k=C.normalized,N=new L.constructor(P.length*O);let z=0,V=0;for(let H=0,G=P.length;H<G;H++){C.isInterleavedBufferAttribute?z=P[H]*C.data.stride+C.offset:z=P[H]*O;for(let X=0;X<O;X++)N[V++]=L[z++]}return new Oi(N,O,k)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const c=new si,d=this.index.array,p=this.attributes;for(const C in p){const P=p[C],L=s(P,d);c.setAttribute(C,L)}const _=this.morphAttributes;for(const C in _){const P=[],L=_[C];for(let O=0,k=L.length;O<k;O++){const N=L[O],z=s(N,d);P.push(z)}c.morphAttributes[C]=P}c.morphTargetsRelative=this.morphTargetsRelative;const x=this.groups;for(let C=0,P=x.length;C<P;C++){const L=x[C];c.addGroup(L.start,L.count,L.materialIndex)}return c}toJSON(){const s={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),Object.keys(this.userData).length>0&&(s.userData=this.userData),this.parameters!==void 0){const P=this.parameters;for(const L in P)P[L]!==void 0&&(s[L]=P[L]);return s}s.data={attributes:{}};const c=this.index;c!==null&&(s.data.index={type:c.array.constructor.name,array:Array.prototype.slice.call(c.array)});const d=this.attributes;for(const P in d){const L=d[P];s.data.attributes[P]=L.toJSON(s.data)}const p={};let _=!1;for(const P in this.morphAttributes){const L=this.morphAttributes[P],O=[];for(let k=0,N=L.length;k<N;k++){const z=L[k];O.push(z.toJSON(s.data))}O.length>0&&(p[P]=O,_=!0)}_&&(s.data.morphAttributes=p,s.data.morphTargetsRelative=this.morphTargetsRelative);const x=this.groups;x.length>0&&(s.data.groups=JSON.parse(JSON.stringify(x)));const C=this.boundingSphere;return C!==null&&(s.data.boundingSphere={center:C.center.toArray(),radius:C.radius}),s}clone(){return new this.constructor().copy(this)}copy(s){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const c={};this.name=s.name;const d=s.index;d!==null&&this.setIndex(d.clone(c));const p=s.attributes;for(const L in p){const O=p[L];this.setAttribute(L,O.clone(c))}const _=s.morphAttributes;for(const L in _){const O=[],k=_[L];for(let N=0,z=k.length;N<z;N++)O.push(k[N].clone(c));this.morphAttributes[L]=O}this.morphTargetsRelative=s.morphTargetsRelative;const x=s.groups;for(let L=0,O=x.length;L<O;L++){const k=x[L];this.addGroup(k.start,k.count,k.materialIndex)}const C=s.boundingBox;C!==null&&(this.boundingBox=C.clone());const P=s.boundingSphere;return P!==null&&(this.boundingSphere=P.clone()),this.drawRange.start=s.drawRange.start,this.drawRange.count=s.drawRange.count,this.userData=s.userData,s.parameters!==void 0&&(this.parameters=Object.assign({},s.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}const XM=new $n,$u=new hp,lx=new wh,el=new de,tl=new de,nl=new de,hx=new de,ux=new de,dx=new de,xA=new de,wA=new de,bA=new de,EA=new mt,CA=new mt,SA=new mt,fx=new de,MA=new de;class qs extends wi{constructor(s=new si,c=new $c){super(),this.isMesh=!0,this.type="Mesh",this.geometry=s,this.material=c,this.updateMorphTargets()}copy(s,c){return super.copy(s,c),s.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=s.morphTargetInfluences.slice()),s.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},s.morphTargetDictionary)),this.material=s.material,this.geometry=s.geometry,this}updateMorphTargets(){const c=this.geometry.morphAttributes,d=Object.keys(c);if(d.length>0){const p=c[d[0]];if(p!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let _=0,x=p.length;_<x;_++){const C=p[_].name||String(_);this.morphTargetInfluences.push(0),this.morphTargetDictionary[C]=_}}}}raycast(s,c){const d=this.geometry,p=this.material,_=this.matrixWorld;if(p===void 0||(d.boundingSphere===null&&d.computeBoundingSphere(),lx.copy(d.boundingSphere),lx.applyMatrix4(_),s.ray.intersectsSphere(lx)===!1)||(XM.copy(_).invert(),$u.copy(s.ray).applyMatrix4(XM),d.boundingBox!==null&&$u.intersectsBox(d.boundingBox)===!1))return;let x;const C=d.index,P=d.attributes.position,L=d.morphAttributes.position,O=d.morphTargetsRelative,k=d.attributes.uv,N=d.attributes.uv2,z=d.groups,V=d.drawRange;if(C!==null)if(Array.isArray(p))for(let H=0,G=z.length;H<G;H++){const X=z[H],Z=p[X.materialIndex],ne=Math.max(X.start,V.start),te=Math.min(C.count,Math.min(X.start+X.count,V.start+V.count));for(let oe=ne,ue=te;oe<ue;oe+=3){const be=C.getX(oe),$=C.getX(oe+1),ge=C.getX(oe+2);x=TA(this,Z,s,$u,P,L,O,k,N,be,$,ge),x&&(x.faceIndex=Math.floor(oe/3),x.face.materialIndex=X.materialIndex,c.push(x))}}else{const H=Math.max(0,V.start),G=Math.min(C.count,V.start+V.count);for(let X=H,Z=G;X<Z;X+=3){const ne=C.getX(X),te=C.getX(X+1),oe=C.getX(X+2);x=TA(this,p,s,$u,P,L,O,k,N,ne,te,oe),x&&(x.faceIndex=Math.floor(X/3),c.push(x))}}else if(P!==void 0)if(Array.isArray(p))for(let H=0,G=z.length;H<G;H++){const X=z[H],Z=p[X.materialIndex],ne=Math.max(X.start,V.start),te=Math.min(P.count,Math.min(X.start+X.count,V.start+V.count));for(let oe=ne,ue=te;oe<ue;oe+=3){const be=oe,$=oe+1,ge=oe+2;x=TA(this,Z,s,$u,P,L,O,k,N,be,$,ge),x&&(x.faceIndex=Math.floor(oe/3),x.face.materialIndex=X.materialIndex,c.push(x))}}else{const H=Math.max(0,V.start),G=Math.min(P.count,V.start+V.count);for(let X=H,Z=G;X<Z;X+=3){const ne=X,te=X+1,oe=X+2;x=TA(this,p,s,$u,P,L,O,k,N,ne,te,oe),x&&(x.faceIndex=Math.floor(X/3),c.push(x))}}}}function Mk(y,s,c,d,p,_,x,C){let P;if(s.side===m?P=d.intersectTriangle(x,_,p,!0,C):P=d.intersectTriangle(p,_,x,s.side!==A,C),P===null)return null;MA.copy(C),MA.applyMatrix4(y.matrixWorld);const L=c.ray.origin.distanceTo(MA);return L<c.near||L>c.far?null:{distance:L,point:MA.clone(),object:y}}function TA(y,s,c,d,p,_,x,C,P,L,O,k){el.fromBufferAttribute(p,L),tl.fromBufferAttribute(p,O),nl.fromBufferAttribute(p,k);const N=y.morphTargetInfluences;if(_&&N){xA.set(0,0,0),wA.set(0,0,0),bA.set(0,0,0);for(let V=0,H=_.length;V<H;V++){const G=N[V],X=_[V];G!==0&&(hx.fromBufferAttribute(X,L),ux.fromBufferAttribute(X,O),dx.fromBufferAttribute(X,k),x?(xA.addScaledVector(hx,G),wA.addScaledVector(ux,G),bA.addScaledVector(dx,G)):(xA.addScaledVector(hx.sub(el),G),wA.addScaledVector(ux.sub(tl),G),bA.addScaledVector(dx.sub(nl),G)))}el.add(xA),tl.add(wA),nl.add(bA)}y.isSkinnedMesh&&(y.boneTransform(L,el),y.boneTransform(O,tl),y.boneTransform(k,nl));const z=Mk(y,s,c,d,el,tl,nl,fx);if(z){C&&(EA.fromBufferAttribute(C,L),CA.fromBufferAttribute(C,O),SA.fromBufferAttribute(C,k),z.uv=yo.getUV(fx,el,tl,nl,EA,CA,SA,new mt)),P&&(EA.fromBufferAttribute(P,L),CA.fromBufferAttribute(P,O),SA.fromBufferAttribute(P,k),z.uv2=yo.getUV(fx,el,tl,nl,EA,CA,SA,new mt));const V={a:L,b:O,c:k,normal:new de,materialIndex:0};yo.getNormal(el,tl,nl,V.normal),z.face=V}return z}class il extends si{constructor(s=1,c=1,d=1,p=1,_=1,x=1){super(),this.type="BoxGeometry",this.parameters={width:s,height:c,depth:d,widthSegments:p,heightSegments:_,depthSegments:x};const C=this;p=Math.floor(p),_=Math.floor(_),x=Math.floor(x);const P=[],L=[],O=[],k=[];let N=0,z=0;V("z","y","x",-1,-1,d,c,s,x,_,0),V("z","y","x",1,-1,d,c,-s,x,_,1),V("x","z","y",1,1,s,d,c,p,x,2),V("x","z","y",1,-1,s,d,-c,p,x,3),V("x","y","z",1,-1,s,c,d,p,_,4),V("x","y","z",-1,-1,s,c,-d,p,_,5),this.setIndex(P),this.setAttribute("position",new gn(L,3)),this.setAttribute("normal",new gn(O,3)),this.setAttribute("uv",new gn(k,2));function V(H,G,X,Z,ne,te,oe,ue,be,$,ge){const Se=te/be,et=oe/$,Mt=te/2,Ye=oe/2,Oe=ue/2,rt=be+1,gt=$+1;let Et=0,at=0;const We=new de;for(let Je=0;Je<gt;Je++){const Tt=Je*et-Ye;for(let It=0;It<rt;It++){const Pt=It*Se-Mt;We[H]=Pt*Z,We[G]=Tt*ne,We[X]=Oe,L.push(We.x,We.y,We.z),We[H]=0,We[G]=0,We[X]=ue>0?1:-1,O.push(We.x,We.y,We.z),k.push(It/be),k.push(1-Je/$),Et+=1}}for(let Je=0;Je<$;Je++)for(let Tt=0;Tt<be;Tt++){const It=N+Tt+rt*Je,Pt=N+Tt+rt*(Je+1),An=N+(Tt+1)+rt*(Je+1),Hn=N+(Tt+1)+rt*Je;P.push(It,Pt,Hn),P.push(Pt,An,Hn),at+=6}C.addGroup(z,at,ge),z+=at,N+=Et}}static fromJSON(s){return new il(s.width,s.height,s.depth,s.widthSegments,s.heightSegments,s.depthSegments)}}function ed(y){const s={};for(const c in y){s[c]={};for(const d in y[c]){const p=y[c][d];p&&(p.isColor||p.isMatrix3||p.isMatrix4||p.isVector2||p.isVector3||p.isVector4||p.isTexture||p.isQuaternion)?s[c][d]=p.clone():Array.isArray(p)?s[c][d]=p.slice():s[c][d]=p}}return s}function or(y){const s={};for(let c=0;c<y.length;c++){const d=ed(y[c]);for(const p in d)s[p]=d[p]}return s}function Tk(y){const s=[];for(let c=0;c<y.length;c++)s.push(y[c].clone());return s}const YM={clone:ed,merge:or};var Ik=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,Rk=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Aa extends rr{constructor(s){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=Ik,this.fragmentShader=Rk,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,s!==void 0&&this.setValues(s)}copy(s){return super.copy(s),this.fragmentShader=s.fragmentShader,this.vertexShader=s.vertexShader,this.uniforms=ed(s.uniforms),this.uniformsGroups=Tk(s.uniformsGroups),this.defines=Object.assign({},s.defines),this.wireframe=s.wireframe,this.wireframeLinewidth=s.wireframeLinewidth,this.fog=s.fog,this.lights=s.lights,this.clipping=s.clipping,this.extensions=Object.assign({},s.extensions),this.glslVersion=s.glslVersion,this}toJSON(s){const c=super.toJSON(s);c.glslVersion=this.glslVersion,c.uniforms={};for(const p in this.uniforms){const x=this.uniforms[p].value;x&&x.isTexture?c.uniforms[p]={type:"t",value:x.toJSON(s).uuid}:x&&x.isColor?c.uniforms[p]={type:"c",value:x.getHex()}:x&&x.isVector2?c.uniforms[p]={type:"v2",value:x.toArray()}:x&&x.isVector3?c.uniforms[p]={type:"v3",value:x.toArray()}:x&&x.isVector4?c.uniforms[p]={type:"v4",value:x.toArray()}:x&&x.isMatrix3?c.uniforms[p]={type:"m3",value:x.toArray()}:x&&x.isMatrix4?c.uniforms[p]={type:"m4",value:x.toArray()}:c.uniforms[p]={value:x}}Object.keys(this.defines).length>0&&(c.defines=this.defines),c.vertexShader=this.vertexShader,c.fragmentShader=this.fragmentShader;const d={};for(const p in this.extensions)this.extensions[p]===!0&&(d[p]=!0);return Object.keys(d).length>0&&(c.extensions=d),c}}class IA extends wi{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new $n,this.projectionMatrix=new $n,this.projectionMatrixInverse=new $n}copy(s,c){return super.copy(s,c),this.matrixWorldInverse.copy(s.matrixWorldInverse),this.projectionMatrix.copy(s.projectionMatrix),this.projectionMatrixInverse.copy(s.projectionMatrixInverse),this}getWorldDirection(s){this.updateWorldMatrix(!0,!1);const c=this.matrixWorld.elements;return s.set(-c[8],-c[9],-c[10]).normalize()}updateMatrixWorld(s){super.updateMatrixWorld(s),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(s,c){super.updateWorldMatrix(s,c),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}class Xs extends IA{constructor(s=50,c=1,d=.1,p=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=s,this.zoom=1,this.near=d,this.far=p,this.focus=10,this.aspect=c,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(s,c){return super.copy(s,c),this.fov=s.fov,this.zoom=s.zoom,this.near=s.near,this.far=s.far,this.focus=s.focus,this.aspect=s.aspect,this.view=s.view===null?null:Object.assign({},s.view),this.filmGauge=s.filmGauge,this.filmOffset=s.filmOffset,this}setFocalLength(s){const c=.5*this.getFilmHeight()/s;this.fov=rp*2*Math.atan(c),this.updateProjectionMatrix()}getFocalLength(){const s=Math.tan(mh*.5*this.fov);return .5*this.getFilmHeight()/s}getEffectiveFOV(){return rp*2*Math.atan(Math.tan(mh*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(s,c,d,p,_,x){this.aspect=s/c,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=s,this.view.fullHeight=c,this.view.offsetX=d,this.view.offsetY=p,this.view.width=_,this.view.height=x,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const s=this.near;let c=s*Math.tan(mh*.5*this.fov)/this.zoom,d=2*c,p=this.aspect*d,_=-.5*p;const x=this.view;if(this.view!==null&&this.view.enabled){const P=x.fullWidth,L=x.fullHeight;_+=x.offsetX*p/P,c-=x.offsetY*d/L,p*=x.width/P,d*=x.height/L}const C=this.filmOffset;C!==0&&(_+=s*C/this.getFilmWidth()),this.projectionMatrix.makePerspective(_,_+p,c,c-d,s,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(s){const c=super.toJSON(s);return c.object.fov=this.fov,c.object.zoom=this.zoom,c.object.near=this.near,c.object.far=this.far,c.object.focus=this.focus,c.object.aspect=this.aspect,this.view!==null&&(c.object.view=Object.assign({},this.view)),c.object.filmGauge=this.filmGauge,c.object.filmOffset=this.filmOffset,c}}const td=90,nd=1;class JM extends wi{constructor(s,c,d){super(),this.type="CubeCamera",this.renderTarget=d;const p=new Xs(td,nd,s,c);p.layers=this.layers,p.up.set(0,-1,0),p.lookAt(new de(1,0,0)),this.add(p);const _=new Xs(td,nd,s,c);_.layers=this.layers,_.up.set(0,-1,0),_.lookAt(new de(-1,0,0)),this.add(_);const x=new Xs(td,nd,s,c);x.layers=this.layers,x.up.set(0,0,1),x.lookAt(new de(0,1,0)),this.add(x);const C=new Xs(td,nd,s,c);C.layers=this.layers,C.up.set(0,0,-1),C.lookAt(new de(0,-1,0)),this.add(C);const P=new Xs(td,nd,s,c);P.layers=this.layers,P.up.set(0,-1,0),P.lookAt(new de(0,0,1)),this.add(P);const L=new Xs(td,nd,s,c);L.layers=this.layers,L.up.set(0,-1,0),L.lookAt(new de(0,0,-1)),this.add(L)}update(s,c){this.parent===null&&this.updateMatrixWorld();const d=this.renderTarget,[p,_,x,C,P,L]=this.children,O=s.getRenderTarget(),k=s.toneMapping,N=s.xr.enabled;s.toneMapping=yn,s.xr.enabled=!1;const z=d.texture.generateMipmaps;d.texture.generateMipmaps=!1,s.setRenderTarget(d,0),s.render(c,p),s.setRenderTarget(d,1),s.render(c,_),s.setRenderTarget(d,2),s.render(c,x),s.setRenderTarget(d,3),s.render(c,C),s.setRenderTarget(d,4),s.render(c,P),d.texture.generateMipmaps=z,s.setRenderTarget(d,5),s.render(c,L),s.setRenderTarget(O),s.toneMapping=k,s.xr.enabled=N,d.texture.needsPMREMUpdate=!0}}class fp extends Ps{constructor(s,c,d,p,_,x,C,P,L,O){s=s!==void 0?s:[],c=c!==void 0?c:Zt,super(s,c,d,p,_,x,C,P,L,O),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(s){this.image=s}}class ZM extends _o{constructor(s,c={}){super(s,s,c),this.isWebGLCubeRenderTarget=!0;const d={width:s,height:s,depth:1},p=[d,d,d,d,d,d];this.texture=new fp(p,c.mapping,c.wrapS,c.wrapT,c.magFilter,c.minFilter,c.format,c.type,c.anisotropy,c.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=c.generateMipmaps!==void 0?c.generateMipmaps:!1,this.texture.minFilter=c.minFilter!==void 0?c.minFilter:bt}fromEquirectangularTexture(s,c){this.texture.type=c.type,this.texture.encoding=c.encoding,this.texture.generateMipmaps=c.generateMipmaps,this.texture.minFilter=c.minFilter,this.texture.magFilter=c.magFilter;const d={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},p=new il(5,5,5),_=new Aa({name:"CubemapFromEquirect",uniforms:ed(d.uniforms),vertexShader:d.vertexShader,fragmentShader:d.fragmentShader,side:m,blending:v});_.uniforms.tEquirect.value=c;const x=new qs(p,_),C=c.minFilter;return c.minFilter===Ht&&(c.minFilter=bt),new JM(1,10,this).update(s,x),c.minFilter=C,x.geometry.dispose(),x.material.dispose(),this}clear(s,c,d,p){const _=s.getRenderTarget();for(let x=0;x<6;x++)s.setRenderTarget(this,x),s.clear(c,d,p);s.setRenderTarget(_)}}const px=new de,Pk=new de,Bk=new Pr;class sl{constructor(s=new de(1,0,0),c=0){this.isPlane=!0,this.normal=s,this.constant=c}set(s,c){return this.normal.copy(s),this.constant=c,this}setComponents(s,c,d,p){return this.normal.set(s,c,d),this.constant=p,this}setFromNormalAndCoplanarPoint(s,c){return this.normal.copy(s),this.constant=-c.dot(this.normal),this}setFromCoplanarPoints(s,c,d){const p=px.subVectors(d,c).cross(Pk.subVectors(s,c)).normalize();return this.setFromNormalAndCoplanarPoint(p,s),this}copy(s){return this.normal.copy(s.normal),this.constant=s.constant,this}normalize(){const s=1/this.normal.length();return this.normal.multiplyScalar(s),this.constant*=s,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(s){return this.normal.dot(s)+this.constant}distanceToSphere(s){return this.distanceToPoint(s.center)-s.radius}projectPoint(s,c){return c.copy(this.normal).multiplyScalar(-this.distanceToPoint(s)).add(s)}intersectLine(s,c){const d=s.delta(px),p=this.normal.dot(d);if(p===0)return this.distanceToPoint(s.start)===0?c.copy(s.start):null;const _=-(s.start.dot(this.normal)+this.constant)/p;return _<0||_>1?null:c.copy(d).multiplyScalar(_).add(s.start)}intersectsLine(s){const c=this.distanceToPoint(s.start),d=this.distanceToPoint(s.end);return c<0&&d>0||d<0&&c>0}intersectsBox(s){return s.intersectsPlane(this)}intersectsSphere(s){return s.intersectsPlane(this)}coplanarPoint(s){return s.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(s,c){const d=c||Bk.getNormalMatrix(s),p=this.coplanarPoint(px).applyMatrix4(s),_=this.normal.applyMatrix3(d).normalize();return this.constant=-p.dot(_),this}translate(s){return this.constant-=s.dot(this.normal),this}equals(s){return s.normal.equals(this.normal)&&s.constant===this.constant}clone(){return new this.constructor().copy(this)}}const id=new wh,RA=new de;class PA{constructor(s=new sl,c=new sl,d=new sl,p=new sl,_=new sl,x=new sl){this.planes=[s,c,d,p,_,x]}set(s,c,d,p,_,x){const C=this.planes;return C[0].copy(s),C[1].copy(c),C[2].copy(d),C[3].copy(p),C[4].copy(_),C[5].copy(x),this}copy(s){const c=this.planes;for(let d=0;d<6;d++)c[d].copy(s.planes[d]);return this}setFromProjectionMatrix(s){const c=this.planes,d=s.elements,p=d[0],_=d[1],x=d[2],C=d[3],P=d[4],L=d[5],O=d[6],k=d[7],N=d[8],z=d[9],V=d[10],H=d[11],G=d[12],X=d[13],Z=d[14],ne=d[15];return c[0].setComponents(C-p,k-P,H-N,ne-G).normalize(),c[1].setComponents(C+p,k+P,H+N,ne+G).normalize(),c[2].setComponents(C+_,k+L,H+z,ne+X).normalize(),c[3].setComponents(C-_,k-L,H-z,ne-X).normalize(),c[4].setComponents(C-x,k-O,H-V,ne-Z).normalize(),c[5].setComponents(C+x,k+O,H+V,ne+Z).normalize(),this}intersectsObject(s){const c=s.geometry;return c.boundingSphere===null&&c.computeBoundingSphere(),id.copy(c.boundingSphere).applyMatrix4(s.matrixWorld),this.intersectsSphere(id)}intersectsSprite(s){return id.center.set(0,0,0),id.radius=.7071067811865476,id.applyMatrix4(s.matrixWorld),this.intersectsSphere(id)}intersectsSphere(s){const c=this.planes,d=s.center,p=-s.radius;for(let _=0;_<6;_++)if(c[_].distanceToPoint(d)<p)return!1;return!0}intersectsBox(s){const c=this.planes;for(let d=0;d<6;d++){const p=c[d];if(RA.x=p.normal.x>0?s.max.x:s.min.x,RA.y=p.normal.y>0?s.max.y:s.min.y,RA.z=p.normal.z>0?s.max.z:s.min.z,p.distanceToPoint(RA)<0)return!1}return!0}containsPoint(s){const c=this.planes;for(let d=0;d<6;d++)if(c[d].distanceToPoint(s)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function KM(){let y=null,s=!1,c=null,d=null;function p(_,x){c(_,x),d=y.requestAnimationFrame(p)}return{start:function(){s!==!0&&c!==null&&(d=y.requestAnimationFrame(p),s=!0)},stop:function(){y.cancelAnimationFrame(d),s=!1},setAnimationLoop:function(_){c=_},setContext:function(_){y=_}}}function Lk(y,s){const c=s.isWebGL2,d=new WeakMap;function p(L,O){const k=L.array,N=L.usage,z=y.createBuffer();y.bindBuffer(O,z),y.bufferData(O,k,N),L.onUploadCallback();let V;if(k instanceof Float32Array)V=y.FLOAT;else if(k instanceof Uint16Array)if(L.isFloat16BufferAttribute)if(c)V=y.HALF_FLOAT;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else V=y.UNSIGNED_SHORT;else if(k instanceof Int16Array)V=y.SHORT;else if(k instanceof Uint32Array)V=y.UNSIGNED_INT;else if(k instanceof Int32Array)V=y.INT;else if(k instanceof Int8Array)V=y.BYTE;else if(k instanceof Uint8Array)V=y.UNSIGNED_BYTE;else if(k instanceof Uint8ClampedArray)V=y.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+k);return{buffer:z,type:V,bytesPerElement:k.BYTES_PER_ELEMENT,version:L.version}}function _(L,O,k){const N=O.array,z=O.updateRange;y.bindBuffer(k,L),z.count===-1?y.bufferSubData(k,0,N):(c?y.bufferSubData(k,z.offset*N.BYTES_PER_ELEMENT,N,z.offset,z.count):y.bufferSubData(k,z.offset*N.BYTES_PER_ELEMENT,N.subarray(z.offset,z.offset+z.count)),z.count=-1)}function x(L){return L.isInterleavedBufferAttribute&&(L=L.data),d.get(L)}function C(L){L.isInterleavedBufferAttribute&&(L=L.data);const O=d.get(L);O&&(y.deleteBuffer(O.buffer),d.delete(L))}function P(L,O){if(L.isGLBufferAttribute){const N=d.get(L);(!N||N.version<L.version)&&d.set(L,{buffer:L.buffer,type:L.type,bytesPerElement:L.elementSize,version:L.version});return}L.isInterleavedBufferAttribute&&(L=L.data);const k=d.get(L);k===void 0?d.set(L,p(L,O)):k.version<L.version&&(_(k.buffer,L,O),k.version=L.version)}return{get:x,remove:C,update:P}}class sd extends si{constructor(s=1,c=1,d=1,p=1){super(),this.type="PlaneGeometry",this.parameters={width:s,height:c,widthSegments:d,heightSegments:p};const _=s/2,x=c/2,C=Math.floor(d),P=Math.floor(p),L=C+1,O=P+1,k=s/C,N=c/P,z=[],V=[],H=[],G=[];for(let X=0;X<O;X++){const Z=X*N-x;for(let ne=0;ne<L;ne++){const te=ne*k-_;V.push(te,-Z,0),H.push(0,0,1),G.push(ne/C),G.push(1-X/P)}}for(let X=0;X<P;X++)for(let Z=0;Z<C;Z++){const ne=Z+L*X,te=Z+L*(X+1),oe=Z+1+L*(X+1),ue=Z+1+L*X;z.push(ne,te,ue),z.push(te,oe,ue)}this.setIndex(z),this.setAttribute("position",new gn(V,3)),this.setAttribute("normal",new gn(H,3)),this.setAttribute("uv",new gn(G,2))}static fromJSON(s){return new sd(s.width,s.height,s.widthSegments,s.heightSegments)}}var Dk=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,Ok=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,Fk=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,kk=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,Nk=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,Uk=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,zk="vec3 transformed = vec3( position );",Gk=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,Hk=`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
		float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
		float x2 = x * x;
		float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
		return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
#ifdef USE_IRIDESCENCE
	vec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,Vk=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,	0.0556434,
		-1.5371385,	1.8760108, -0.2040259,
		-0.4985314,	0.0415560,	1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,Wk=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,Qk=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,jk=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,qk=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,Xk=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,Yk=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,Jk=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,Zk=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,Kk=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,$k=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,eN=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,tN=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,nN=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,iN=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,sN=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,rN=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,oN="gl_FragColor = linearToOutputTexel( gl_FragColor );",aN=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,cN=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,lN=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,hN=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,uN=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,dN=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,fN=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,pN=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,mN=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,gN=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,AN=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,_N=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,yN=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,vN=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,xN=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert
#define Material_LightProbeLOD( material )	(0)`,wN=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,bN=`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,EN=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,CN=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,SN=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,MN=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,TN=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,IN=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(		0, 1,		0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	#ifdef USE_IRIDESCENCE
		reflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );
	#else
		reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,RN=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,PN=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,BN=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,LN=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,DN=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,ON=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,FN=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,kN=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,NN=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,UN=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,zN=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,GN=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,HN=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,VN=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,WN=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,QN=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,jN=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,qN=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,XN=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,YN=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,JN=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,ZN=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,KN=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,$N=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,eU=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,tU=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,nU=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,iU=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,sU=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,rU=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,oU=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,aU=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,cU=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,lU=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,hU=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,uU=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
							texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
							f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
							texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
							f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,dU=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,fU=`#if defined( USE_SHADOWMAP ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_COORDS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,pU=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,mU=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,gU=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,AU=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,_U=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,yU=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,vU=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,xU=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,wU=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(	1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,	1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,	1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,bU=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
#endif`,EU=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef texture2DLodEXT
			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#else
			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#endif
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,CU=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,SU=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,MU=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,TU=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,IU=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,RU=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,PU=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const oi={alphamap_fragment:Dk,alphamap_pars_fragment:Ok,alphatest_fragment:Fk,alphatest_pars_fragment:kk,aomap_fragment:Nk,aomap_pars_fragment:Uk,begin_vertex:zk,beginnormal_vertex:Gk,bsdfs:Hk,iridescence_fragment:Vk,bumpmap_pars_fragment:Wk,clipping_planes_fragment:Qk,clipping_planes_pars_fragment:jk,clipping_planes_pars_vertex:qk,clipping_planes_vertex:Xk,color_fragment:Yk,color_pars_fragment:Jk,color_pars_vertex:Zk,color_vertex:Kk,common:$k,cube_uv_reflection_fragment:eN,defaultnormal_vertex:tN,displacementmap_pars_vertex:nN,displacementmap_vertex:iN,emissivemap_fragment:sN,emissivemap_pars_fragment:rN,encodings_fragment:oN,encodings_pars_fragment:aN,envmap_fragment:cN,envmap_common_pars_fragment:lN,envmap_pars_fragment:hN,envmap_pars_vertex:uN,envmap_physical_pars_fragment:bN,envmap_vertex:dN,fog_vertex:fN,fog_pars_vertex:pN,fog_fragment:mN,fog_pars_fragment:gN,gradientmap_pars_fragment:AN,lightmap_fragment:_N,lightmap_pars_fragment:yN,lights_lambert_fragment:vN,lights_lambert_pars_fragment:xN,lights_pars_begin:wN,lights_toon_fragment:EN,lights_toon_pars_fragment:CN,lights_phong_fragment:SN,lights_phong_pars_fragment:MN,lights_physical_fragment:TN,lights_physical_pars_fragment:IN,lights_fragment_begin:RN,lights_fragment_maps:PN,lights_fragment_end:BN,logdepthbuf_fragment:LN,logdepthbuf_pars_fragment:DN,logdepthbuf_pars_vertex:ON,logdepthbuf_vertex:FN,map_fragment:kN,map_pars_fragment:NN,map_particle_fragment:UN,map_particle_pars_fragment:zN,metalnessmap_fragment:GN,metalnessmap_pars_fragment:HN,morphcolor_vertex:VN,morphnormal_vertex:WN,morphtarget_pars_vertex:QN,morphtarget_vertex:jN,normal_fragment_begin:qN,normal_fragment_maps:XN,normal_pars_fragment:YN,normal_pars_vertex:JN,normal_vertex:ZN,normalmap_pars_fragment:KN,clearcoat_normal_fragment_begin:$N,clearcoat_normal_fragment_maps:eU,clearcoat_pars_fragment:tU,iridescence_pars_fragment:nU,output_fragment:iU,packing:sU,premultiplied_alpha_fragment:rU,project_vertex:oU,dithering_fragment:aU,dithering_pars_fragment:cU,roughnessmap_fragment:lU,roughnessmap_pars_fragment:hU,shadowmap_pars_fragment:uU,shadowmap_pars_vertex:dU,shadowmap_vertex:fU,shadowmask_pars_fragment:pU,skinbase_vertex:mU,skinning_pars_vertex:gU,skinning_vertex:AU,skinnormal_vertex:_U,specularmap_fragment:yU,specularmap_pars_fragment:vU,tonemapping_fragment:xU,tonemapping_pars_fragment:wU,transmission_fragment:bU,transmission_pars_fragment:EU,uv_pars_fragment:CU,uv_pars_vertex:SU,uv_vertex:MU,uv2_pars_fragment:TU,uv2_pars_vertex:IU,uv2_vertex:RU,worldpos_vertex:PU,background_vert:`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,background_frag:`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	gl_FragColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		gl_FragColor = vec4( mix( pow( gl_FragColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), gl_FragColor.rgb * 0.0773993808, vec3( lessThanEqual( gl_FragColor.rgb, vec3( 0.04045 ) ) ) ), gl_FragColor.w );
	#endif
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,cube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,cube_frag:`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,depth_vert:`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,depth_frag:`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,distanceRGBA_vert:`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,distanceRGBA_frag:`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,equirect_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,equirect_frag:`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,linedashed_vert:`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,linedashed_frag:`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,meshbasic_vert:`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,meshbasic_frag:`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshlambert_vert:`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshlambert_frag:`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshmatcap_vert:`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,meshmatcap_frag:`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshnormal_vert:`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,meshnormal_frag:`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,meshphong_vert:`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshphong_frag:`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphysical_vert:`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,meshphysical_frag:`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshtoon_vert:`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshtoon_frag:`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,points_vert:`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,points_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,shadow_vert:`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,shadow_frag:`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,sprite_vert:`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,sprite_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`},Vt={common:{diffuse:{value:new dn(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Pr},uv2Transform:{value:new Pr},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new mt(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new dn(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new dn(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Pr}},sprite:{diffuse:{value:new dn(16777215)},opacity:{value:1},center:{value:new mt(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Pr}}},jo={basic:{uniforms:or([Vt.common,Vt.specularmap,Vt.envmap,Vt.aomap,Vt.lightmap,Vt.fog]),vertexShader:oi.meshbasic_vert,fragmentShader:oi.meshbasic_frag},lambert:{uniforms:or([Vt.common,Vt.specularmap,Vt.envmap,Vt.aomap,Vt.lightmap,Vt.emissivemap,Vt.bumpmap,Vt.normalmap,Vt.displacementmap,Vt.fog,Vt.lights,{emissive:{value:new dn(0)}}]),vertexShader:oi.meshlambert_vert,fragmentShader:oi.meshlambert_frag},phong:{uniforms:or([Vt.common,Vt.specularmap,Vt.envmap,Vt.aomap,Vt.lightmap,Vt.emissivemap,Vt.bumpmap,Vt.normalmap,Vt.displacementmap,Vt.fog,Vt.lights,{emissive:{value:new dn(0)},specular:{value:new dn(1118481)},shininess:{value:30}}]),vertexShader:oi.meshphong_vert,fragmentShader:oi.meshphong_frag},standard:{uniforms:or([Vt.common,Vt.envmap,Vt.aomap,Vt.lightmap,Vt.emissivemap,Vt.bumpmap,Vt.normalmap,Vt.displacementmap,Vt.roughnessmap,Vt.metalnessmap,Vt.fog,Vt.lights,{emissive:{value:new dn(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:oi.meshphysical_vert,fragmentShader:oi.meshphysical_frag},toon:{uniforms:or([Vt.common,Vt.aomap,Vt.lightmap,Vt.emissivemap,Vt.bumpmap,Vt.normalmap,Vt.displacementmap,Vt.gradientmap,Vt.fog,Vt.lights,{emissive:{value:new dn(0)}}]),vertexShader:oi.meshtoon_vert,fragmentShader:oi.meshtoon_frag},matcap:{uniforms:or([Vt.common,Vt.bumpmap,Vt.normalmap,Vt.displacementmap,Vt.fog,{matcap:{value:null}}]),vertexShader:oi.meshmatcap_vert,fragmentShader:oi.meshmatcap_frag},points:{uniforms:or([Vt.points,Vt.fog]),vertexShader:oi.points_vert,fragmentShader:oi.points_frag},dashed:{uniforms:or([Vt.common,Vt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:oi.linedashed_vert,fragmentShader:oi.linedashed_frag},depth:{uniforms:or([Vt.common,Vt.displacementmap]),vertexShader:oi.depth_vert,fragmentShader:oi.depth_frag},normal:{uniforms:or([Vt.common,Vt.bumpmap,Vt.normalmap,Vt.displacementmap,{opacity:{value:1}}]),vertexShader:oi.meshnormal_vert,fragmentShader:oi.meshnormal_frag},sprite:{uniforms:or([Vt.sprite,Vt.fog]),vertexShader:oi.sprite_vert,fragmentShader:oi.sprite_frag},background:{uniforms:{uvTransform:{value:new Pr},t2D:{value:null}},vertexShader:oi.background_vert,fragmentShader:oi.background_frag},cube:{uniforms:or([Vt.envmap,{opacity:{value:1}}]),vertexShader:oi.cube_vert,fragmentShader:oi.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:oi.equirect_vert,fragmentShader:oi.equirect_frag},distanceRGBA:{uniforms:or([Vt.common,Vt.displacementmap,{referencePosition:{value:new de},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:oi.distanceRGBA_vert,fragmentShader:oi.distanceRGBA_frag},shadow:{uniforms:or([Vt.lights,Vt.fog,{color:{value:new dn(0)},opacity:{value:1}}]),vertexShader:oi.shadow_vert,fragmentShader:oi.shadow_frag}};jo.physical={uniforms:or([jo.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new mt(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new dn(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new mt},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new dn(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new dn(1,1,1)},specularColorMap:{value:null}}]),vertexShader:oi.meshphysical_vert,fragmentShader:oi.meshphysical_frag};function BU(y,s,c,d,p,_){const x=new dn(0);let C=p===!0?0:1,P,L,O=null,k=0,N=null;function z(H,G){let X=!1,Z=G.isScene===!0?G.background:null;Z&&Z.isTexture&&(Z=s.get(Z));const ne=y.xr,te=ne.getSession&&ne.getSession();te&&te.environmentBlendMode==="additive"&&(Z=null),Z===null?V(x,C):Z&&Z.isColor&&(V(Z,1),X=!0),(y.autoClear||X)&&y.clear(y.autoClearColor,y.autoClearDepth,y.autoClearStencil),Z&&(Z.isCubeTexture||Z.mapping===me)?(L===void 0&&(L=new qs(new il(1,1,1),new Aa({name:"BackgroundCubeMaterial",uniforms:ed(jo.cube.uniforms),vertexShader:jo.cube.vertexShader,fragmentShader:jo.cube.fragmentShader,side:m,depthTest:!1,depthWrite:!1,fog:!1})),L.geometry.deleteAttribute("normal"),L.geometry.deleteAttribute("uv"),L.onBeforeRender=function(oe,ue,be){this.matrixWorld.copyPosition(be.matrixWorld)},Object.defineProperty(L.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),d.update(L)),L.material.uniforms.envMap.value=Z,L.material.uniforms.flipEnvMap.value=Z.isCubeTexture&&Z.isRenderTargetTexture===!1?-1:1,(O!==Z||k!==Z.version||N!==y.toneMapping)&&(L.material.needsUpdate=!0,O=Z,k=Z.version,N=y.toneMapping),L.layers.enableAll(),H.unshift(L,L.geometry,L.material,0,0,null)):Z&&Z.isTexture&&(P===void 0&&(P=new qs(new sd(2,2),new Aa({name:"BackgroundMaterial",uniforms:ed(jo.background.uniforms),vertexShader:jo.background.vertexShader,fragmentShader:jo.background.fragmentShader,side:g,depthTest:!1,depthWrite:!1,fog:!1})),P.geometry.deleteAttribute("normal"),Object.defineProperty(P.material,"map",{get:function(){return this.uniforms.t2D.value}}),d.update(P)),P.material.uniforms.t2D.value=Z,Z.matrixAutoUpdate===!0&&Z.updateMatrix(),P.material.uniforms.uvTransform.value.copy(Z.matrix),(O!==Z||k!==Z.version||N!==y.toneMapping)&&(P.material.needsUpdate=!0,O=Z,k=Z.version,N=y.toneMapping),P.layers.enableAll(),H.unshift(P,P.geometry,P.material,0,0,null))}function V(H,G){c.buffers.color.setClear(H.r,H.g,H.b,G,_)}return{getClearColor:function(){return x},setClearColor:function(H,G=1){x.set(H),C=G,V(x,C)},getClearAlpha:function(){return C},setClearAlpha:function(H){C=H,V(x,C)},render:z}}function LU(y,s,c,d){const p=y.getParameter(y.MAX_VERTEX_ATTRIBS),_=d.isWebGL2?null:s.get("OES_vertex_array_object"),x=d.isWebGL2||_!==null,C={},P=G(null);let L=P,O=!1;function k(Oe,rt,gt,Et,at){let We=!1;if(x){const Je=H(Et,gt,rt);L!==Je&&(L=Je,z(L.object)),We=X(Oe,Et,gt,at),We&&Z(Oe,Et,gt,at)}else{const Je=rt.wireframe===!0;(L.geometry!==Et.id||L.program!==gt.id||L.wireframe!==Je)&&(L.geometry=Et.id,L.program=gt.id,L.wireframe=Je,We=!0)}at!==null&&c.update(at,y.ELEMENT_ARRAY_BUFFER),(We||O)&&(O=!1,$(Oe,rt,gt,Et),at!==null&&y.bindBuffer(y.ELEMENT_ARRAY_BUFFER,c.get(at).buffer))}function N(){return d.isWebGL2?y.createVertexArray():_.createVertexArrayOES()}function z(Oe){return d.isWebGL2?y.bindVertexArray(Oe):_.bindVertexArrayOES(Oe)}function V(Oe){return d.isWebGL2?y.deleteVertexArray(Oe):_.deleteVertexArrayOES(Oe)}function H(Oe,rt,gt){const Et=gt.wireframe===!0;let at=C[Oe.id];at===void 0&&(at={},C[Oe.id]=at);let We=at[rt.id];We===void 0&&(We={},at[rt.id]=We);let Je=We[Et];return Je===void 0&&(Je=G(N()),We[Et]=Je),Je}function G(Oe){const rt=[],gt=[],Et=[];for(let at=0;at<p;at++)rt[at]=0,gt[at]=0,Et[at]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:rt,enabledAttributes:gt,attributeDivisors:Et,object:Oe,attributes:{},index:null}}function X(Oe,rt,gt,Et){const at=L.attributes,We=rt.attributes;let Je=0;const Tt=gt.getAttributes();for(const It in Tt)if(Tt[It].location>=0){const An=at[It];let Hn=We[It];if(Hn===void 0&&(It==="instanceMatrix"&&Oe.instanceMatrix&&(Hn=Oe.instanceMatrix),It==="instanceColor"&&Oe.instanceColor&&(Hn=Oe.instanceColor)),An===void 0||An.attribute!==Hn||Hn&&An.data!==Hn.data)return!0;Je++}return L.attributesNum!==Je||L.index!==Et}function Z(Oe,rt,gt,Et){const at={},We=rt.attributes;let Je=0;const Tt=gt.getAttributes();for(const It in Tt)if(Tt[It].location>=0){let An=We[It];An===void 0&&(It==="instanceMatrix"&&Oe.instanceMatrix&&(An=Oe.instanceMatrix),It==="instanceColor"&&Oe.instanceColor&&(An=Oe.instanceColor));const Hn={};Hn.attribute=An,An&&An.data&&(Hn.data=An.data),at[It]=Hn,Je++}L.attributes=at,L.attributesNum=Je,L.index=Et}function ne(){const Oe=L.newAttributes;for(let rt=0,gt=Oe.length;rt<gt;rt++)Oe[rt]=0}function te(Oe){oe(Oe,0)}function oe(Oe,rt){const gt=L.newAttributes,Et=L.enabledAttributes,at=L.attributeDivisors;gt[Oe]=1,Et[Oe]===0&&(y.enableVertexAttribArray(Oe),Et[Oe]=1),at[Oe]!==rt&&((d.isWebGL2?y:s.get("ANGLE_instanced_arrays"))[d.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](Oe,rt),at[Oe]=rt)}function ue(){const Oe=L.newAttributes,rt=L.enabledAttributes;for(let gt=0,Et=rt.length;gt<Et;gt++)rt[gt]!==Oe[gt]&&(y.disableVertexAttribArray(gt),rt[gt]=0)}function be(Oe,rt,gt,Et,at,We){d.isWebGL2===!0&&(gt===y.INT||gt===y.UNSIGNED_INT)?y.vertexAttribIPointer(Oe,rt,gt,at,We):y.vertexAttribPointer(Oe,rt,gt,Et,at,We)}function $(Oe,rt,gt,Et){if(d.isWebGL2===!1&&(Oe.isInstancedMesh||Et.isInstancedBufferGeometry)&&s.get("ANGLE_instanced_arrays")===null)return;ne();const at=Et.attributes,We=gt.getAttributes(),Je=rt.defaultAttributeValues;for(const Tt in We){const It=We[Tt];if(It.location>=0){let Pt=at[Tt];if(Pt===void 0&&(Tt==="instanceMatrix"&&Oe.instanceMatrix&&(Pt=Oe.instanceMatrix),Tt==="instanceColor"&&Oe.instanceColor&&(Pt=Oe.instanceColor)),Pt!==void 0){const An=Pt.normalized,Hn=Pt.itemSize,Ne=c.get(Pt);if(Ne===void 0)continue;const ai=Ne.buffer,Dn=Ne.type,Vn=Ne.bytesPerElement;if(Pt.isInterleavedBufferAttribute){const on=Pt.data,li=on.stride,dt=Pt.offset;if(on.isInstancedInterleavedBuffer){for(let ct=0;ct<It.locationSize;ct++)oe(It.location+ct,on.meshPerAttribute);Oe.isInstancedMesh!==!0&&Et._maxInstanceCount===void 0&&(Et._maxInstanceCount=on.meshPerAttribute*on.count)}else for(let ct=0;ct<It.locationSize;ct++)te(It.location+ct);y.bindBuffer(y.ARRAY_BUFFER,ai);for(let ct=0;ct<It.locationSize;ct++)be(It.location+ct,Hn/It.locationSize,Dn,An,li*Vn,(dt+Hn/It.locationSize*ct)*Vn)}else{if(Pt.isInstancedBufferAttribute){for(let on=0;on<It.locationSize;on++)oe(It.location+on,Pt.meshPerAttribute);Oe.isInstancedMesh!==!0&&Et._maxInstanceCount===void 0&&(Et._maxInstanceCount=Pt.meshPerAttribute*Pt.count)}else for(let on=0;on<It.locationSize;on++)te(It.location+on);y.bindBuffer(y.ARRAY_BUFFER,ai);for(let on=0;on<It.locationSize;on++)be(It.location+on,Hn/It.locationSize,Dn,An,Hn*Vn,Hn/It.locationSize*on*Vn)}}else if(Je!==void 0){const An=Je[Tt];if(An!==void 0)switch(An.length){case 2:y.vertexAttrib2fv(It.location,An);break;case 3:y.vertexAttrib3fv(It.location,An);break;case 4:y.vertexAttrib4fv(It.location,An);break;default:y.vertexAttrib1fv(It.location,An)}}}}ue()}function ge(){Mt();for(const Oe in C){const rt=C[Oe];for(const gt in rt){const Et=rt[gt];for(const at in Et)V(Et[at].object),delete Et[at];delete rt[gt]}delete C[Oe]}}function Se(Oe){if(C[Oe.id]===void 0)return;const rt=C[Oe.id];for(const gt in rt){const Et=rt[gt];for(const at in Et)V(Et[at].object),delete Et[at];delete rt[gt]}delete C[Oe.id]}function et(Oe){for(const rt in C){const gt=C[rt];if(gt[Oe.id]===void 0)continue;const Et=gt[Oe.id];for(const at in Et)V(Et[at].object),delete Et[at];delete gt[Oe.id]}}function Mt(){Ye(),O=!0,L!==P&&(L=P,z(L.object))}function Ye(){P.geometry=null,P.program=null,P.wireframe=!1}return{setup:k,reset:Mt,resetDefaultState:Ye,dispose:ge,releaseStatesOfGeometry:Se,releaseStatesOfProgram:et,initAttributes:ne,enableAttribute:te,disableUnusedAttributes:ue}}function DU(y,s,c,d){const p=d.isWebGL2;let _;function x(L){_=L}function C(L,O){y.drawArrays(_,L,O),c.update(O,_,1)}function P(L,O,k){if(k===0)return;let N,z;if(p)N=y,z="drawArraysInstanced";else if(N=s.get("ANGLE_instanced_arrays"),z="drawArraysInstancedANGLE",N===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}N[z](_,L,O,k),c.update(O,_,k)}this.setMode=x,this.render=C,this.renderInstances=P}function OU(y,s,c){let d;function p(){if(d!==void 0)return d;if(s.has("EXT_texture_filter_anisotropic")===!0){const be=s.get("EXT_texture_filter_anisotropic");d=y.getParameter(be.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else d=0;return d}function _(be){if(be==="highp"){if(y.getShaderPrecisionFormat(y.VERTEX_SHADER,y.HIGH_FLOAT).precision>0&&y.getShaderPrecisionFormat(y.FRAGMENT_SHADER,y.HIGH_FLOAT).precision>0)return"highp";be="mediump"}return be==="mediump"&&y.getShaderPrecisionFormat(y.VERTEX_SHADER,y.MEDIUM_FLOAT).precision>0&&y.getShaderPrecisionFormat(y.FRAGMENT_SHADER,y.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const x=typeof WebGL2RenderingContext<"u"&&y instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext<"u"&&y instanceof WebGL2ComputeRenderingContext;let C=c.precision!==void 0?c.precision:"highp";const P=_(C);P!==C&&(console.warn("THREE.WebGLRenderer:",C,"not supported, using",P,"instead."),C=P);const L=x||s.has("WEBGL_draw_buffers"),O=c.logarithmicDepthBuffer===!0,k=y.getParameter(y.MAX_TEXTURE_IMAGE_UNITS),N=y.getParameter(y.MAX_VERTEX_TEXTURE_IMAGE_UNITS),z=y.getParameter(y.MAX_TEXTURE_SIZE),V=y.getParameter(y.MAX_CUBE_MAP_TEXTURE_SIZE),H=y.getParameter(y.MAX_VERTEX_ATTRIBS),G=y.getParameter(y.MAX_VERTEX_UNIFORM_VECTORS),X=y.getParameter(y.MAX_VARYING_VECTORS),Z=y.getParameter(y.MAX_FRAGMENT_UNIFORM_VECTORS),ne=N>0,te=x||s.has("OES_texture_float"),oe=ne&&te,ue=x?y.getParameter(y.MAX_SAMPLES):0;return{isWebGL2:x,drawBuffers:L,getMaxAnisotropy:p,getMaxPrecision:_,precision:C,logarithmicDepthBuffer:O,maxTextures:k,maxVertexTextures:N,maxTextureSize:z,maxCubemapSize:V,maxAttributes:H,maxVertexUniforms:G,maxVaryings:X,maxFragmentUniforms:Z,vertexTextures:ne,floatFragmentTextures:te,floatVertexTextures:oe,maxSamples:ue}}function FU(y){const s=this;let c=null,d=0,p=!1,_=!1;const x=new sl,C=new Pr,P={value:null,needsUpdate:!1};this.uniform=P,this.numPlanes=0,this.numIntersection=0,this.init=function(k,N,z){const V=k.length!==0||N||d!==0||p;return p=N,c=O(k,z,0),d=k.length,V},this.beginShadows=function(){_=!0,O(null)},this.endShadows=function(){_=!1,L()},this.setState=function(k,N,z){const V=k.clippingPlanes,H=k.clipIntersection,G=k.clipShadows,X=y.get(k);if(!p||V===null||V.length===0||_&&!G)_?O(null):L();else{const Z=_?0:d,ne=Z*4;let te=X.clippingState||null;P.value=te,te=O(V,N,ne,z);for(let oe=0;oe!==ne;++oe)te[oe]=c[oe];X.clippingState=te,this.numIntersection=H?this.numPlanes:0,this.numPlanes+=Z}};function L(){P.value!==c&&(P.value=c,P.needsUpdate=d>0),s.numPlanes=d,s.numIntersection=0}function O(k,N,z,V){const H=k!==null?k.length:0;let G=null;if(H!==0){if(G=P.value,V!==!0||G===null){const X=z+H*4,Z=N.matrixWorldInverse;C.getNormalMatrix(Z),(G===null||G.length<X)&&(G=new Float32Array(X));for(let ne=0,te=z;ne!==H;++ne,te+=4)x.copy(k[ne]).applyMatrix4(Z,C),x.normal.toArray(G,te),G[te+3]=x.constant}P.value=G,P.needsUpdate=!0}return s.numPlanes=H,s.numIntersection=0,G}}function kU(y){let s=new WeakMap;function c(x,C){return C===ii?x.mapping=Zt:C===Zn&&(x.mapping=ln),x}function d(x){if(x&&x.isTexture&&x.isRenderTargetTexture===!1){const C=x.mapping;if(C===ii||C===Zn)if(s.has(x)){const P=s.get(x).texture;return c(P,x.mapping)}else{const P=x.image;if(P&&P.height>0){const L=new ZM(P.height/2);return L.fromEquirectangularTexture(y,x),s.set(x,L),x.addEventListener("dispose",p),c(L.texture,x.mapping)}else return null}}return x}function p(x){const C=x.target;C.removeEventListener("dispose",p);const P=s.get(C);P!==void 0&&(s.delete(C),P.dispose())}function _(){s=new WeakMap}return{get:d,dispose:_}}class BA extends IA{constructor(s=-1,c=1,d=1,p=-1,_=.1,x=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=s,this.right=c,this.top=d,this.bottom=p,this.near=_,this.far=x,this.updateProjectionMatrix()}copy(s,c){return super.copy(s,c),this.left=s.left,this.right=s.right,this.top=s.top,this.bottom=s.bottom,this.near=s.near,this.far=s.far,this.zoom=s.zoom,this.view=s.view===null?null:Object.assign({},s.view),this}setViewOffset(s,c,d,p,_,x){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=s,this.view.fullHeight=c,this.view.offsetX=d,this.view.offsetY=p,this.view.width=_,this.view.height=x,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const s=(this.right-this.left)/(2*this.zoom),c=(this.top-this.bottom)/(2*this.zoom),d=(this.right+this.left)/2,p=(this.top+this.bottom)/2;let _=d-s,x=d+s,C=p+c,P=p-c;if(this.view!==null&&this.view.enabled){const L=(this.right-this.left)/this.view.fullWidth/this.zoom,O=(this.top-this.bottom)/this.view.fullHeight/this.zoom;_+=L*this.view.offsetX,x=_+L*this.view.width,C-=O*this.view.offsetY,P=C-O*this.view.height}this.projectionMatrix.makeOrthographic(_,x,C,P,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(s){const c=super.toJSON(s);return c.object.zoom=this.zoom,c.object.left=this.left,c.object.right=this.right,c.object.top=this.top,c.object.bottom=this.bottom,c.object.near=this.near,c.object.far=this.far,this.view!==null&&(c.object.view=Object.assign({},this.view)),c}}const rd=4,$M=[.125,.215,.35,.446,.526,.582],bh=20,mx=new BA,e1=new dn;let gx=null;const Eh=(1+Math.sqrt(5))/2,od=1/Eh,t1=[new de(1,1,1),new de(-1,1,1),new de(1,1,-1),new de(-1,1,-1),new de(0,Eh,od),new de(0,Eh,-od),new de(od,0,Eh),new de(-od,0,Eh),new de(Eh,od,0),new de(-Eh,od,0)];class Ax{constructor(s){this._renderer=s,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(s,c=0,d=.1,p=100){gx=this._renderer.getRenderTarget(),this._setSize(256);const _=this._allocateTargets();return _.depthBuffer=!0,this._sceneToCubeUV(s,d,p,_),c>0&&this._blur(_,0,0,c),this._applyPMREM(_),this._cleanup(_),_}fromEquirectangular(s,c=null){return this._fromTexture(s,c)}fromCubemap(s,c=null){return this._fromTexture(s,c)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=s1(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=i1(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(s){this._lodMax=Math.floor(Math.log2(s)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let s=0;s<this._lodPlanes.length;s++)this._lodPlanes[s].dispose()}_cleanup(s){this._renderer.setRenderTarget(gx),s.scissorTest=!1,LA(s,0,0,s.width,s.height)}_fromTexture(s,c){s.mapping===Zt||s.mapping===ln?this._setSize(s.image.length===0?16:s.image[0].width||s.image[0].image.width):this._setSize(s.image.width/4),gx=this._renderer.getRenderTarget();const d=c||this._allocateTargets();return this._textureToCubeUV(s,d),this._applyPMREM(d),this._cleanup(d),d}_allocateTargets(){const s=3*Math.max(this._cubeSize,112),c=4*this._cubeSize,d={magFilter:bt,minFilter:bt,generateMipmaps:!1,type:di,format:ir,encoding:jc,depthBuffer:!1},p=n1(s,c,d);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==s){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=n1(s,c,d);const{_lodMax:_}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=NU(_)),this._blurMaterial=UU(_,s,c)}return p}_compileMaterial(s){const c=new qs(this._lodPlanes[0],s);this._renderer.compile(c,mx)}_sceneToCubeUV(s,c,d,p){const C=new Xs(90,1,c,d),P=[1,-1,1,1,1,1],L=[1,1,1,-1,-1,-1],O=this._renderer,k=O.autoClear,N=O.toneMapping;O.getClearColor(e1),O.toneMapping=yn,O.autoClear=!1;const z=new $c({name:"PMREM.Background",side:m,depthWrite:!1,depthTest:!1}),V=new qs(new il,z);let H=!1;const G=s.background;G?G.isColor&&(z.color.copy(G),s.background=null,H=!0):(z.color.copy(e1),H=!0);for(let X=0;X<6;X++){const Z=X%3;Z===0?(C.up.set(0,P[X],0),C.lookAt(L[X],0,0)):Z===1?(C.up.set(0,0,P[X]),C.lookAt(0,L[X],0)):(C.up.set(0,P[X],0),C.lookAt(0,0,L[X]));const ne=this._cubeSize;LA(p,Z*ne,X>2?ne:0,ne,ne),O.setRenderTarget(p),H&&O.render(V,C),O.render(s,C)}V.geometry.dispose(),V.material.dispose(),O.toneMapping=N,O.autoClear=k,s.background=G}_textureToCubeUV(s,c){const d=this._renderer,p=s.mapping===Zt||s.mapping===ln;p?(this._cubemapMaterial===null&&(this._cubemapMaterial=s1()),this._cubemapMaterial.uniforms.flipEnvMap.value=s.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=i1());const _=p?this._cubemapMaterial:this._equirectMaterial,x=new qs(this._lodPlanes[0],_),C=_.uniforms;C.envMap.value=s;const P=this._cubeSize;LA(c,0,0,3*P,2*P),d.setRenderTarget(c),d.render(x,mx)}_applyPMREM(s){const c=this._renderer,d=c.autoClear;c.autoClear=!1;for(let p=1;p<this._lodPlanes.length;p++){const _=Math.sqrt(this._sigmas[p]*this._sigmas[p]-this._sigmas[p-1]*this._sigmas[p-1]),x=t1[(p-1)%t1.length];this._blur(s,p-1,p,_,x)}c.autoClear=d}_blur(s,c,d,p,_){const x=this._pingPongRenderTarget;this._halfBlur(s,x,c,d,p,"latitudinal",_),this._halfBlur(x,s,d,d,p,"longitudinal",_)}_halfBlur(s,c,d,p,_,x,C){const P=this._renderer,L=this._blurMaterial;x!=="latitudinal"&&x!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const O=3,k=new qs(this._lodPlanes[p],L),N=L.uniforms,z=this._sizeLods[d]-1,V=isFinite(_)?Math.PI/(2*z):2*Math.PI/(2*bh-1),H=_/V,G=isFinite(_)?1+Math.floor(O*H):bh;G>bh&&console.warn(`sigmaRadians, ${_}, is too large and will clip, as it requested ${G} samples when the maximum is set to ${bh}`);const X=[];let Z=0;for(let be=0;be<bh;++be){const $=be/H,ge=Math.exp(-$*$/2);X.push(ge),be===0?Z+=ge:be<G&&(Z+=2*ge)}for(let be=0;be<X.length;be++)X[be]=X[be]/Z;N.envMap.value=s.texture,N.samples.value=G,N.weights.value=X,N.latitudinal.value=x==="latitudinal",C&&(N.poleAxis.value=C);const{_lodMax:ne}=this;N.dTheta.value=V,N.mipInt.value=ne-d;const te=this._sizeLods[p],oe=3*te*(p>ne-rd?p-ne+rd:0),ue=4*(this._cubeSize-te);LA(c,oe,ue,3*te,2*te),P.setRenderTarget(c),P.render(k,mx)}}function NU(y){const s=[],c=[],d=[];let p=y;const _=y-rd+1+$M.length;for(let x=0;x<_;x++){const C=Math.pow(2,p);c.push(C);let P=1/C;x>y-rd?P=$M[x-y+rd-1]:x===0&&(P=0),d.push(P);const L=1/(C-2),O=-L,k=1+L,N=[O,O,k,O,k,k,O,O,k,k,O,k],z=6,V=6,H=3,G=2,X=1,Z=new Float32Array(H*V*z),ne=new Float32Array(G*V*z),te=new Float32Array(X*V*z);for(let ue=0;ue<z;ue++){const be=ue%3*2/3-1,$=ue>2?0:-1,ge=[be,$,0,be+2/3,$,0,be+2/3,$+1,0,be,$,0,be+2/3,$+1,0,be,$+1,0];Z.set(ge,H*V*ue),ne.set(N,G*V*ue);const Se=[ue,ue,ue,ue,ue,ue];te.set(Se,X*V*ue)}const oe=new si;oe.setAttribute("position",new Oi(Z,H)),oe.setAttribute("uv",new Oi(ne,G)),oe.setAttribute("faceIndex",new Oi(te,X)),s.push(oe),p>rd&&p--}return{lodPlanes:s,sizeLods:c,sigmas:d}}function n1(y,s,c){const d=new _o(y,s,c);return d.texture.mapping=me,d.texture.name="PMREM.cubeUv",d.scissorTest=!0,d}function LA(y,s,c,d,p){y.viewport.set(s,c,d,p),y.scissor.set(s,c,d,p)}function UU(y,s,c){const d=new Float32Array(bh),p=new de(0,1,0);return new Aa({name:"SphericalGaussianBlur",defines:{n:bh,CUBEUV_TEXEL_WIDTH:1/s,CUBEUV_TEXEL_HEIGHT:1/c,CUBEUV_MAX_MIP:`${y}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:d},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:p}},vertexShader:_x(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:v,depthTest:!1,depthWrite:!1})}function i1(){return new Aa({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:_x(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:v,depthTest:!1,depthWrite:!1})}function s1(){return new Aa({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:_x(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:v,depthTest:!1,depthWrite:!1})}function _x(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function zU(y){let s=new WeakMap,c=null;function d(C){if(C&&C.isTexture){const P=C.mapping,L=P===ii||P===Zn,O=P===Zt||P===ln;if(L||O)if(C.isRenderTargetTexture&&C.needsPMREMUpdate===!0){C.needsPMREMUpdate=!1;let k=s.get(C);return c===null&&(c=new Ax(y)),k=L?c.fromEquirectangular(C,k):c.fromCubemap(C,k),s.set(C,k),k.texture}else{if(s.has(C))return s.get(C).texture;{const k=C.image;if(L&&k&&k.height>0||O&&k&&p(k)){c===null&&(c=new Ax(y));const N=L?c.fromEquirectangular(C):c.fromCubemap(C);return s.set(C,N),C.addEventListener("dispose",_),N.texture}else return null}}}return C}function p(C){let P=0;const L=6;for(let O=0;O<L;O++)C[O]!==void 0&&P++;return P===L}function _(C){const P=C.target;P.removeEventListener("dispose",_);const L=s.get(P);L!==void 0&&(s.delete(P),L.dispose())}function x(){s=new WeakMap,c!==null&&(c.dispose(),c=null)}return{get:d,dispose:x}}function GU(y){const s={};function c(d){if(s[d]!==void 0)return s[d];let p;switch(d){case"WEBGL_depth_texture":p=y.getExtension("WEBGL_depth_texture")||y.getExtension("MOZ_WEBGL_depth_texture")||y.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":p=y.getExtension("EXT_texture_filter_anisotropic")||y.getExtension("MOZ_EXT_texture_filter_anisotropic")||y.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":p=y.getExtension("WEBGL_compressed_texture_s3tc")||y.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||y.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":p=y.getExtension("WEBGL_compressed_texture_pvrtc")||y.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:p=y.getExtension(d)}return s[d]=p,p}return{has:function(d){return c(d)!==null},init:function(d){d.isWebGL2?c("EXT_color_buffer_float"):(c("WEBGL_depth_texture"),c("OES_texture_float"),c("OES_texture_half_float"),c("OES_texture_half_float_linear"),c("OES_standard_derivatives"),c("OES_element_index_uint"),c("OES_vertex_array_object"),c("ANGLE_instanced_arrays")),c("OES_texture_float_linear"),c("EXT_color_buffer_half_float"),c("WEBGL_multisampled_render_to_texture")},get:function(d){const p=c(d);return p===null&&console.warn("THREE.WebGLRenderer: "+d+" extension not supported."),p}}}function HU(y,s,c,d){const p={},_=new WeakMap;function x(k){const N=k.target;N.index!==null&&s.remove(N.index);for(const V in N.attributes)s.remove(N.attributes[V]);N.removeEventListener("dispose",x),delete p[N.id];const z=_.get(N);z&&(s.remove(z),_.delete(N)),d.releaseStatesOfGeometry(N),N.isInstancedBufferGeometry===!0&&delete N._maxInstanceCount,c.memory.geometries--}function C(k,N){return p[N.id]===!0||(N.addEventListener("dispose",x),p[N.id]=!0,c.memory.geometries++),N}function P(k){const N=k.attributes;for(const V in N)s.update(N[V],y.ARRAY_BUFFER);const z=k.morphAttributes;for(const V in z){const H=z[V];for(let G=0,X=H.length;G<X;G++)s.update(H[G],y.ARRAY_BUFFER)}}function L(k){const N=[],z=k.index,V=k.attributes.position;let H=0;if(z!==null){const Z=z.array;H=z.version;for(let ne=0,te=Z.length;ne<te;ne+=3){const oe=Z[ne+0],ue=Z[ne+1],be=Z[ne+2];N.push(oe,ue,ue,be,be,oe)}}else{const Z=V.array;H=V.version;for(let ne=0,te=Z.length/3-1;ne<te;ne+=3){const oe=ne+0,ue=ne+1,be=ne+2;N.push(oe,ue,ue,be,be,oe)}}const G=new(FM(N)?ax:ox)(N,1);G.version=H;const X=_.get(k);X&&s.remove(X),_.set(k,G)}function O(k){const N=_.get(k);if(N){const z=k.index;z!==null&&N.version<z.version&&L(k)}else L(k);return _.get(k)}return{get:C,update:P,getWireframeAttribute:O}}function VU(y,s,c,d){const p=d.isWebGL2;let _;function x(N){_=N}let C,P;function L(N){C=N.type,P=N.bytesPerElement}function O(N,z){y.drawElements(_,z,C,N*P),c.update(z,_,1)}function k(N,z,V){if(V===0)return;let H,G;if(p)H=y,G="drawElementsInstanced";else if(H=s.get("ANGLE_instanced_arrays"),G="drawElementsInstancedANGLE",H===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}H[G](_,z,C,N*P,V),c.update(z,_,V)}this.setMode=x,this.setIndex=L,this.render=O,this.renderInstances=k}function WU(y){const s={geometries:0,textures:0},c={frame:0,calls:0,triangles:0,points:0,lines:0};function d(_,x,C){switch(c.calls++,x){case y.TRIANGLES:c.triangles+=C*(_/3);break;case y.LINES:c.lines+=C*(_/2);break;case y.LINE_STRIP:c.lines+=C*(_-1);break;case y.LINE_LOOP:c.lines+=C*_;break;case y.POINTS:c.points+=C*_;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",x);break}}function p(){c.frame++,c.calls=0,c.triangles=0,c.points=0,c.lines=0}return{memory:s,render:c,programs:null,autoReset:!0,reset:p,update:d}}function QU(y,s){return y[0]-s[0]}function jU(y,s){return Math.abs(s[1])-Math.abs(y[1])}function qU(y,s,c){const d={},p=new Float32Array(8),_=new WeakMap,x=new Ri,C=[];for(let L=0;L<8;L++)C[L]=[L,0];function P(L,O,k,N){const z=L.morphTargetInfluences;if(s.isWebGL2===!0){const H=O.morphAttributes.position||O.morphAttributes.normal||O.morphAttributes.color,G=H!==void 0?H.length:0;let X=_.get(O);if(X===void 0||X.count!==G){let gt=function(){Oe.dispose(),_.delete(O),O.removeEventListener("dispose",gt)};var V=gt;X!==void 0&&X.texture.dispose();const te=O.morphAttributes.position!==void 0,oe=O.morphAttributes.normal!==void 0,ue=O.morphAttributes.color!==void 0,be=O.morphAttributes.position||[],$=O.morphAttributes.normal||[],ge=O.morphAttributes.color||[];let Se=0;te===!0&&(Se=1),oe===!0&&(Se=2),ue===!0&&(Se=3);let et=O.attributes.position.count*Se,Mt=1;et>s.maxTextureSize&&(Mt=Math.ceil(et/s.maxTextureSize),et=s.maxTextureSize);const Ye=new Float32Array(et*Mt*4*G),Oe=new cp(Ye,et,Mt,G);Oe.type=wn,Oe.needsUpdate=!0;const rt=Se*4;for(let Et=0;Et<G;Et++){const at=be[Et],We=$[Et],Je=ge[Et],Tt=et*Mt*4*Et;for(let It=0;It<at.count;It++){const Pt=It*rt;te===!0&&(x.fromBufferAttribute(at,It),Ye[Tt+Pt+0]=x.x,Ye[Tt+Pt+1]=x.y,Ye[Tt+Pt+2]=x.z,Ye[Tt+Pt+3]=0),oe===!0&&(x.fromBufferAttribute(We,It),Ye[Tt+Pt+4]=x.x,Ye[Tt+Pt+5]=x.y,Ye[Tt+Pt+6]=x.z,Ye[Tt+Pt+7]=0),ue===!0&&(x.fromBufferAttribute(Je,It),Ye[Tt+Pt+8]=x.x,Ye[Tt+Pt+9]=x.y,Ye[Tt+Pt+10]=x.z,Ye[Tt+Pt+11]=Je.itemSize===4?x.w:1)}}X={count:G,texture:Oe,size:new mt(et,Mt)},_.set(O,X),O.addEventListener("dispose",gt)}let Z=0;for(let te=0;te<z.length;te++)Z+=z[te];const ne=O.morphTargetsRelative?1:1-Z;N.getUniforms().setValue(y,"morphTargetBaseInfluence",ne),N.getUniforms().setValue(y,"morphTargetInfluences",z),N.getUniforms().setValue(y,"morphTargetsTexture",X.texture,c),N.getUniforms().setValue(y,"morphTargetsTextureSize",X.size)}else{const H=z===void 0?0:z.length;let G=d[O.id];if(G===void 0||G.length!==H){G=[];for(let oe=0;oe<H;oe++)G[oe]=[oe,0];d[O.id]=G}for(let oe=0;oe<H;oe++){const ue=G[oe];ue[0]=oe,ue[1]=z[oe]}G.sort(jU);for(let oe=0;oe<8;oe++)oe<H&&G[oe][1]?(C[oe][0]=G[oe][0],C[oe][1]=G[oe][1]):(C[oe][0]=Number.MAX_SAFE_INTEGER,C[oe][1]=0);C.sort(QU);const X=O.morphAttributes.position,Z=O.morphAttributes.normal;let ne=0;for(let oe=0;oe<8;oe++){const ue=C[oe],be=ue[0],$=ue[1];be!==Number.MAX_SAFE_INTEGER&&$?(X&&O.getAttribute("morphTarget"+oe)!==X[be]&&O.setAttribute("morphTarget"+oe,X[be]),Z&&O.getAttribute("morphNormal"+oe)!==Z[be]&&O.setAttribute("morphNormal"+oe,Z[be]),p[oe]=$,ne+=$):(X&&O.hasAttribute("morphTarget"+oe)===!0&&O.deleteAttribute("morphTarget"+oe),Z&&O.hasAttribute("morphNormal"+oe)===!0&&O.deleteAttribute("morphNormal"+oe),p[oe]=0)}const te=O.morphTargetsRelative?1:1-ne;N.getUniforms().setValue(y,"morphTargetBaseInfluence",te),N.getUniforms().setValue(y,"morphTargetInfluences",p)}}return{update:P}}function XU(y,s,c,d){let p=new WeakMap;function _(P){const L=d.render.frame,O=P.geometry,k=s.get(P,O);return p.get(k)!==L&&(s.update(k),p.set(k,L)),P.isInstancedMesh&&(P.hasEventListener("dispose",C)===!1&&P.addEventListener("dispose",C),c.update(P.instanceMatrix,y.ARRAY_BUFFER),P.instanceColor!==null&&c.update(P.instanceColor,y.ARRAY_BUFFER)),k}function x(){p=new WeakMap}function C(P){const L=P.target;L.removeEventListener("dispose",C),c.remove(L.instanceMatrix),L.instanceColor!==null&&c.remove(L.instanceColor)}return{update:_,dispose:x}}const r1=new Ps,o1=new cp,a1=new uA,c1=new fp,l1=[],h1=[],u1=new Float32Array(16),d1=new Float32Array(9),f1=new Float32Array(4);function ad(y,s,c){const d=y[0];if(d<=0||d>0)return y;const p=s*c;let _=l1[p];if(_===void 0&&(_=new Float32Array(p),l1[p]=_),s!==0){d.toArray(_,0);for(let x=1,C=0;x!==s;++x)C+=c,y[x].toArray(_,C)}return _}function Bs(y,s){if(y.length!==s.length)return!1;for(let c=0,d=y.length;c<d;c++)if(y[c]!==s[c])return!1;return!0}function Ls(y,s){for(let c=0,d=s.length;c<d;c++)y[c]=s[c]}function DA(y,s){let c=h1[s];c===void 0&&(c=new Int32Array(s),h1[s]=c);for(let d=0;d!==s;++d)c[d]=y.allocateTextureUnit();return c}function YU(y,s){const c=this.cache;c[0]!==s&&(y.uniform1f(this.addr,s),c[0]=s)}function JU(y,s){const c=this.cache;if(s.x!==void 0)(c[0]!==s.x||c[1]!==s.y)&&(y.uniform2f(this.addr,s.x,s.y),c[0]=s.x,c[1]=s.y);else{if(Bs(c,s))return;y.uniform2fv(this.addr,s),Ls(c,s)}}function ZU(y,s){const c=this.cache;if(s.x!==void 0)(c[0]!==s.x||c[1]!==s.y||c[2]!==s.z)&&(y.uniform3f(this.addr,s.x,s.y,s.z),c[0]=s.x,c[1]=s.y,c[2]=s.z);else if(s.r!==void 0)(c[0]!==s.r||c[1]!==s.g||c[2]!==s.b)&&(y.uniform3f(this.addr,s.r,s.g,s.b),c[0]=s.r,c[1]=s.g,c[2]=s.b);else{if(Bs(c,s))return;y.uniform3fv(this.addr,s),Ls(c,s)}}function KU(y,s){const c=this.cache;if(s.x!==void 0)(c[0]!==s.x||c[1]!==s.y||c[2]!==s.z||c[3]!==s.w)&&(y.uniform4f(this.addr,s.x,s.y,s.z,s.w),c[0]=s.x,c[1]=s.y,c[2]=s.z,c[3]=s.w);else{if(Bs(c,s))return;y.uniform4fv(this.addr,s),Ls(c,s)}}function $U(y,s){const c=this.cache,d=s.elements;if(d===void 0){if(Bs(c,s))return;y.uniformMatrix2fv(this.addr,!1,s),Ls(c,s)}else{if(Bs(c,d))return;f1.set(d),y.uniformMatrix2fv(this.addr,!1,f1),Ls(c,d)}}function ez(y,s){const c=this.cache,d=s.elements;if(d===void 0){if(Bs(c,s))return;y.uniformMatrix3fv(this.addr,!1,s),Ls(c,s)}else{if(Bs(c,d))return;d1.set(d),y.uniformMatrix3fv(this.addr,!1,d1),Ls(c,d)}}function tz(y,s){const c=this.cache,d=s.elements;if(d===void 0){if(Bs(c,s))return;y.uniformMatrix4fv(this.addr,!1,s),Ls(c,s)}else{if(Bs(c,d))return;u1.set(d),y.uniformMatrix4fv(this.addr,!1,u1),Ls(c,d)}}function nz(y,s){const c=this.cache;c[0]!==s&&(y.uniform1i(this.addr,s),c[0]=s)}function iz(y,s){const c=this.cache;Bs(c,s)||(y.uniform2iv(this.addr,s),Ls(c,s))}function sz(y,s){const c=this.cache;Bs(c,s)||(y.uniform3iv(this.addr,s),Ls(c,s))}function rz(y,s){const c=this.cache;Bs(c,s)||(y.uniform4iv(this.addr,s),Ls(c,s))}function oz(y,s){const c=this.cache;c[0]!==s&&(y.uniform1ui(this.addr,s),c[0]=s)}function az(y,s){const c=this.cache;Bs(c,s)||(y.uniform2uiv(this.addr,s),Ls(c,s))}function cz(y,s){const c=this.cache;Bs(c,s)||(y.uniform3uiv(this.addr,s),Ls(c,s))}function lz(y,s){const c=this.cache;Bs(c,s)||(y.uniform4uiv(this.addr,s),Ls(c,s))}function hz(y,s,c){const d=this.cache,p=c.allocateTextureUnit();d[0]!==p&&(y.uniform1i(this.addr,p),d[0]=p),c.setTexture2D(s||r1,p)}function uz(y,s,c){const d=this.cache,p=c.allocateTextureUnit();d[0]!==p&&(y.uniform1i(this.addr,p),d[0]=p),c.setTexture3D(s||a1,p)}function dz(y,s,c){const d=this.cache,p=c.allocateTextureUnit();d[0]!==p&&(y.uniform1i(this.addr,p),d[0]=p),c.setTextureCube(s||c1,p)}function fz(y,s,c){const d=this.cache,p=c.allocateTextureUnit();d[0]!==p&&(y.uniform1i(this.addr,p),d[0]=p),c.setTexture2DArray(s||o1,p)}function pz(y){switch(y){case 5126:return YU;case 35664:return JU;case 35665:return ZU;case 35666:return KU;case 35674:return $U;case 35675:return ez;case 35676:return tz;case 5124:case 35670:return nz;case 35667:case 35671:return iz;case 35668:case 35672:return sz;case 35669:case 35673:return rz;case 5125:return oz;case 36294:return az;case 36295:return cz;case 36296:return lz;case 35678:case 36198:case 36298:case 36306:case 35682:return hz;case 35679:case 36299:case 36307:return uz;case 35680:case 36300:case 36308:case 36293:return dz;case 36289:case 36303:case 36311:case 36292:return fz}}function mz(y,s){y.uniform1fv(this.addr,s)}function gz(y,s){const c=ad(s,this.size,2);y.uniform2fv(this.addr,c)}function Az(y,s){const c=ad(s,this.size,3);y.uniform3fv(this.addr,c)}function _z(y,s){const c=ad(s,this.size,4);y.uniform4fv(this.addr,c)}function yz(y,s){const c=ad(s,this.size,4);y.uniformMatrix2fv(this.addr,!1,c)}function vz(y,s){const c=ad(s,this.size,9);y.uniformMatrix3fv(this.addr,!1,c)}function xz(y,s){const c=ad(s,this.size,16);y.uniformMatrix4fv(this.addr,!1,c)}function wz(y,s){y.uniform1iv(this.addr,s)}function bz(y,s){y.uniform2iv(this.addr,s)}function Ez(y,s){y.uniform3iv(this.addr,s)}function Cz(y,s){y.uniform4iv(this.addr,s)}function Sz(y,s){y.uniform1uiv(this.addr,s)}function Mz(y,s){y.uniform2uiv(this.addr,s)}function Tz(y,s){y.uniform3uiv(this.addr,s)}function Iz(y,s){y.uniform4uiv(this.addr,s)}function Rz(y,s,c){const d=this.cache,p=s.length,_=DA(c,p);Bs(d,_)||(y.uniform1iv(this.addr,_),Ls(d,_));for(let x=0;x!==p;++x)c.setTexture2D(s[x]||r1,_[x])}function Pz(y,s,c){const d=this.cache,p=s.length,_=DA(c,p);Bs(d,_)||(y.uniform1iv(this.addr,_),Ls(d,_));for(let x=0;x!==p;++x)c.setTexture3D(s[x]||a1,_[x])}function Bz(y,s,c){const d=this.cache,p=s.length,_=DA(c,p);Bs(d,_)||(y.uniform1iv(this.addr,_),Ls(d,_));for(let x=0;x!==p;++x)c.setTextureCube(s[x]||c1,_[x])}function Lz(y,s,c){const d=this.cache,p=s.length,_=DA(c,p);Bs(d,_)||(y.uniform1iv(this.addr,_),Ls(d,_));for(let x=0;x!==p;++x)c.setTexture2DArray(s[x]||o1,_[x])}function Dz(y){switch(y){case 5126:return mz;case 35664:return gz;case 35665:return Az;case 35666:return _z;case 35674:return yz;case 35675:return vz;case 35676:return xz;case 5124:case 35670:return wz;case 35667:case 35671:return bz;case 35668:case 35672:return Ez;case 35669:case 35673:return Cz;case 5125:return Sz;case 36294:return Mz;case 36295:return Tz;case 36296:return Iz;case 35678:case 36198:case 36298:case 36306:case 35682:return Rz;case 35679:case 36299:case 36307:return Pz;case 35680:case 36300:case 36308:case 36293:return Bz;case 36289:case 36303:case 36311:case 36292:return Lz}}class Oz{constructor(s,c,d){this.id=s,this.addr=d,this.cache=[],this.setValue=pz(c.type)}}class Fz{constructor(s,c,d){this.id=s,this.addr=d,this.cache=[],this.size=c.size,this.setValue=Dz(c.type)}}class kz{constructor(s){this.id=s,this.seq=[],this.map={}}setValue(s,c,d){const p=this.seq;for(let _=0,x=p.length;_!==x;++_){const C=p[_];C.setValue(s,c[C.id],d)}}}const yx=/(\w+)(\])?(\[|\.)?/g;function p1(y,s){y.seq.push(s),y.map[s.id]=s}function Nz(y,s,c){const d=y.name,p=d.length;for(yx.lastIndex=0;;){const _=yx.exec(d),x=yx.lastIndex;let C=_[1];const P=_[2]==="]",L=_[3];if(P&&(C=C|0),L===void 0||L==="["&&x+2===p){p1(c,L===void 0?new Oz(C,y,s):new Fz(C,y,s));break}else{let k=c.map[C];k===void 0&&(k=new kz(C),p1(c,k)),c=k}}}class OA{constructor(s,c){this.seq=[],this.map={};const d=s.getProgramParameter(c,s.ACTIVE_UNIFORMS);for(let p=0;p<d;++p){const _=s.getActiveUniform(c,p),x=s.getUniformLocation(c,_.name);Nz(_,x,this)}}setValue(s,c,d,p){const _=this.map[c];_!==void 0&&_.setValue(s,d,p)}setOptional(s,c,d){const p=c[d];p!==void 0&&this.setValue(s,d,p)}static upload(s,c,d,p){for(let _=0,x=c.length;_!==x;++_){const C=c[_],P=d[C.id];P.needsUpdate!==!1&&C.setValue(s,P.value,p)}}static seqWithValue(s,c){const d=[];for(let p=0,_=s.length;p!==_;++p){const x=s[p];x.id in c&&d.push(x)}return d}}function m1(y,s,c){const d=y.createShader(s);return y.shaderSource(d,c),y.compileShader(d),d}let Uz=0;function zz(y,s){const c=y.split(`
`),d=[],p=Math.max(s-6,0),_=Math.min(s+6,c.length);for(let x=p;x<_;x++){const C=x+1;d.push(`${C===s?">":" "} ${C}: ${c[x]}`)}return d.join(`
`)}function Gz(y){switch(y){case jc:return["Linear","( value )"];case $i:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",y),["Linear","( value )"]}}function g1(y,s,c){const d=y.getShaderParameter(s,y.COMPILE_STATUS),p=y.getShaderInfoLog(s).trim();if(d&&p==="")return"";const _=/ERROR: 0:(\d+)/.exec(p);if(_){const x=parseInt(_[1]);return c.toUpperCase()+`

`+p+`

`+zz(y.getShaderSource(s),x)}else return p}function Hz(y,s){const c=Gz(s);return"vec4 "+y+"( vec4 value ) { return LinearTo"+c[0]+c[1]+"; }"}function Vz(y,s){let c;switch(s){case it:c="Linear";break;case tt:c="Reinhard";break;case vt:c="OptimizedCineon";break;case Jt:c="ACESFilmic";break;case Lt:c="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",s),c="Linear"}return"vec3 "+y+"( vec3 color ) { return "+c+"ToneMapping( color ); }"}function Wz(y){return[y.extensionDerivatives||!!y.envMapCubeUVHeight||y.bumpMap||y.tangentSpaceNormalMap||y.clearcoatNormalMap||y.flatShading||y.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(y.extensionFragDepth||y.logarithmicDepthBuffer)&&y.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",y.extensionDrawBuffers&&y.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(y.extensionShaderTextureLOD||y.envMap||y.transmission)&&y.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(pp).join(`
`)}function Qz(y){const s=[];for(const c in y){const d=y[c];d!==!1&&s.push("#define "+c+" "+d)}return s.join(`
`)}function jz(y,s){const c={},d=y.getProgramParameter(s,y.ACTIVE_ATTRIBUTES);for(let p=0;p<d;p++){const _=y.getActiveAttrib(s,p),x=_.name;let C=1;_.type===y.FLOAT_MAT2&&(C=2),_.type===y.FLOAT_MAT3&&(C=3),_.type===y.FLOAT_MAT4&&(C=4),c[x]={type:_.type,location:y.getAttribLocation(s,x),locationSize:C}}return c}function pp(y){return y!==""}function A1(y,s){const c=s.numSpotLightShadows+s.numSpotLightMaps-s.numSpotLightShadowsWithMaps;return y.replace(/NUM_DIR_LIGHTS/g,s.numDirLights).replace(/NUM_SPOT_LIGHTS/g,s.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,s.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,c).replace(/NUM_RECT_AREA_LIGHTS/g,s.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,s.numPointLights).replace(/NUM_HEMI_LIGHTS/g,s.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,s.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,s.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,s.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,s.numPointLightShadows)}function _1(y,s){return y.replace(/NUM_CLIPPING_PLANES/g,s.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,s.numClippingPlanes-s.numClipIntersection)}const qz=/^[ \t]*#include +<([\w\d./]+)>/gm;function vx(y){return y.replace(qz,Xz)}function Xz(y,s){const c=oi[s];if(c===void 0)throw new Error("Can not resolve #include <"+s+">");return vx(c)}const Yz=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function y1(y){return y.replace(Yz,Jz)}function Jz(y,s,c,d){let p="";for(let _=parseInt(s);_<parseInt(c);_++)p+=d.replace(/\[\s*i\s*\]/g,"[ "+_+" ]").replace(/UNROLLED_LOOP_INDEX/g,_);return p}function v1(y){let s="precision "+y.precision+` float;
precision `+y.precision+" int;";return y.precision==="highp"?s+=`
#define HIGH_PRECISION`:y.precision==="mediump"?s+=`
#define MEDIUM_PRECISION`:y.precision==="lowp"&&(s+=`
#define LOW_PRECISION`),s}function Zz(y){let s="SHADOWMAP_TYPE_BASIC";return y.shadowMapType===h?s="SHADOWMAP_TYPE_PCF":y.shadowMapType===u?s="SHADOWMAP_TYPE_PCF_SOFT":y.shadowMapType===f&&(s="SHADOWMAP_TYPE_VSM"),s}function Kz(y){let s="ENVMAP_TYPE_CUBE";if(y.envMap)switch(y.envMapMode){case Zt:case ln:s="ENVMAP_TYPE_CUBE";break;case me:s="ENVMAP_TYPE_CUBE_UV";break}return s}function $z(y){let s="ENVMAP_MODE_REFLECTION";if(y.envMap)switch(y.envMapMode){case ln:s="ENVMAP_MODE_REFRACTION";break}return s}function eG(y){let s="ENVMAP_BLENDING_NONE";if(y.envMap)switch(y.combine){case Xt:s="ENVMAP_BLENDING_MULTIPLY";break;case pn:s="ENVMAP_BLENDING_MIX";break;case Ft:s="ENVMAP_BLENDING_ADD";break}return s}function tG(y){const s=y.envMapCubeUVHeight;if(s===null)return null;const c=Math.log2(s)-2,d=1/s;return{texelWidth:1/(3*Math.max(Math.pow(2,c),7*16)),texelHeight:d,maxMip:c}}function nG(y,s,c,d){const p=y.getContext(),_=c.defines;let x=c.vertexShader,C=c.fragmentShader;const P=Zz(c),L=Kz(c),O=$z(c),k=eG(c),N=tG(c),z=c.isWebGL2?"":Wz(c),V=Qz(_),H=p.createProgram();let G,X,Z=c.glslVersion?"#version "+c.glslVersion+`
`:"";c.isRawShaderMaterial?(G=[V].filter(pp).join(`
`),G.length>0&&(G+=`
`),X=[z,V].filter(pp).join(`
`),X.length>0&&(X+=`
`)):(G=[v1(c),"#define SHADER_NAME "+c.shaderName,V,c.instancing?"#define USE_INSTANCING":"",c.instancingColor?"#define USE_INSTANCING_COLOR":"",c.supportsVertexTextures?"#define VERTEX_TEXTURES":"",c.useFog&&c.fog?"#define USE_FOG":"",c.useFog&&c.fogExp2?"#define FOG_EXP2":"",c.map?"#define USE_MAP":"",c.envMap?"#define USE_ENVMAP":"",c.envMap?"#define "+O:"",c.lightMap?"#define USE_LIGHTMAP":"",c.aoMap?"#define USE_AOMAP":"",c.emissiveMap?"#define USE_EMISSIVEMAP":"",c.bumpMap?"#define USE_BUMPMAP":"",c.normalMap?"#define USE_NORMALMAP":"",c.normalMap&&c.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",c.normalMap&&c.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",c.clearcoatMap?"#define USE_CLEARCOATMAP":"",c.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",c.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",c.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",c.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",c.displacementMap&&c.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",c.specularMap?"#define USE_SPECULARMAP":"",c.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",c.specularColorMap?"#define USE_SPECULARCOLORMAP":"",c.roughnessMap?"#define USE_ROUGHNESSMAP":"",c.metalnessMap?"#define USE_METALNESSMAP":"",c.alphaMap?"#define USE_ALPHAMAP":"",c.transmission?"#define USE_TRANSMISSION":"",c.transmissionMap?"#define USE_TRANSMISSIONMAP":"",c.thicknessMap?"#define USE_THICKNESSMAP":"",c.sheenColorMap?"#define USE_SHEENCOLORMAP":"",c.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",c.vertexTangents?"#define USE_TANGENT":"",c.vertexColors?"#define USE_COLOR":"",c.vertexAlphas?"#define USE_COLOR_ALPHA":"",c.vertexUvs?"#define USE_UV":"",c.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",c.flatShading?"#define FLAT_SHADED":"",c.skinning?"#define USE_SKINNING":"",c.morphTargets?"#define USE_MORPHTARGETS":"",c.morphNormals&&c.flatShading===!1?"#define USE_MORPHNORMALS":"",c.morphColors&&c.isWebGL2?"#define USE_MORPHCOLORS":"",c.morphTargetsCount>0&&c.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",c.morphTargetsCount>0&&c.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+c.morphTextureStride:"",c.morphTargetsCount>0&&c.isWebGL2?"#define MORPHTARGETS_COUNT "+c.morphTargetsCount:"",c.doubleSided?"#define DOUBLE_SIDED":"",c.flipSided?"#define FLIP_SIDED":"",c.shadowMapEnabled?"#define USE_SHADOWMAP":"",c.shadowMapEnabled?"#define "+P:"",c.sizeAttenuation?"#define USE_SIZEATTENUATION":"",c.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",c.logarithmicDepthBuffer&&c.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(pp).join(`
`),X=[z,v1(c),"#define SHADER_NAME "+c.shaderName,V,c.useFog&&c.fog?"#define USE_FOG":"",c.useFog&&c.fogExp2?"#define FOG_EXP2":"",c.map?"#define USE_MAP":"",c.matcap?"#define USE_MATCAP":"",c.envMap?"#define USE_ENVMAP":"",c.envMap?"#define "+L:"",c.envMap?"#define "+O:"",c.envMap?"#define "+k:"",N?"#define CUBEUV_TEXEL_WIDTH "+N.texelWidth:"",N?"#define CUBEUV_TEXEL_HEIGHT "+N.texelHeight:"",N?"#define CUBEUV_MAX_MIP "+N.maxMip+".0":"",c.lightMap?"#define USE_LIGHTMAP":"",c.aoMap?"#define USE_AOMAP":"",c.emissiveMap?"#define USE_EMISSIVEMAP":"",c.bumpMap?"#define USE_BUMPMAP":"",c.normalMap?"#define USE_NORMALMAP":"",c.normalMap&&c.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",c.normalMap&&c.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",c.clearcoat?"#define USE_CLEARCOAT":"",c.clearcoatMap?"#define USE_CLEARCOATMAP":"",c.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",c.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",c.iridescence?"#define USE_IRIDESCENCE":"",c.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",c.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",c.specularMap?"#define USE_SPECULARMAP":"",c.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",c.specularColorMap?"#define USE_SPECULARCOLORMAP":"",c.roughnessMap?"#define USE_ROUGHNESSMAP":"",c.metalnessMap?"#define USE_METALNESSMAP":"",c.alphaMap?"#define USE_ALPHAMAP":"",c.alphaTest?"#define USE_ALPHATEST":"",c.sheen?"#define USE_SHEEN":"",c.sheenColorMap?"#define USE_SHEENCOLORMAP":"",c.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",c.transmission?"#define USE_TRANSMISSION":"",c.transmissionMap?"#define USE_TRANSMISSIONMAP":"",c.thicknessMap?"#define USE_THICKNESSMAP":"",c.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",c.vertexTangents?"#define USE_TANGENT":"",c.vertexColors||c.instancingColor?"#define USE_COLOR":"",c.vertexAlphas?"#define USE_COLOR_ALPHA":"",c.vertexUvs?"#define USE_UV":"",c.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",c.gradientMap?"#define USE_GRADIENTMAP":"",c.flatShading?"#define FLAT_SHADED":"",c.doubleSided?"#define DOUBLE_SIDED":"",c.flipSided?"#define FLIP_SIDED":"",c.shadowMapEnabled?"#define USE_SHADOWMAP":"",c.shadowMapEnabled?"#define "+P:"",c.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",c.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",c.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",c.logarithmicDepthBuffer&&c.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",c.toneMapping!==yn?"#define TONE_MAPPING":"",c.toneMapping!==yn?oi.tonemapping_pars_fragment:"",c.toneMapping!==yn?Vz("toneMapping",c.toneMapping):"",c.dithering?"#define DITHERING":"",c.opaque?"#define OPAQUE":"",oi.encodings_pars_fragment,Hz("linearToOutputTexel",c.outputEncoding),c.useDepthPacking?"#define DEPTH_PACKING "+c.depthPacking:"",`
`].filter(pp).join(`
`)),x=vx(x),x=A1(x,c),x=_1(x,c),C=vx(C),C=A1(C,c),C=_1(C,c),x=y1(x),C=y1(C),c.isWebGL2&&c.isRawShaderMaterial!==!0&&(Z=`#version 300 es
`,G=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+G,X=["#define varying in",c.glslVersion===Hv?"":"layout(location = 0) out highp vec4 pc_fragColor;",c.glslVersion===Hv?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+X);const ne=Z+G+x,te=Z+X+C,oe=m1(p,p.VERTEX_SHADER,ne),ue=m1(p,p.FRAGMENT_SHADER,te);if(p.attachShader(H,oe),p.attachShader(H,ue),c.index0AttributeName!==void 0?p.bindAttribLocation(H,0,c.index0AttributeName):c.morphTargets===!0&&p.bindAttribLocation(H,0,"position"),p.linkProgram(H),y.debug.checkShaderErrors){const ge=p.getProgramInfoLog(H).trim(),Se=p.getShaderInfoLog(oe).trim(),et=p.getShaderInfoLog(ue).trim();let Mt=!0,Ye=!0;if(p.getProgramParameter(H,p.LINK_STATUS)===!1){Mt=!1;const Oe=g1(p,oe,"vertex"),rt=g1(p,ue,"fragment");console.error("THREE.WebGLProgram: Shader Error "+p.getError()+" - VALIDATE_STATUS "+p.getProgramParameter(H,p.VALIDATE_STATUS)+`

Program Info Log: `+ge+`
`+Oe+`
`+rt)}else ge!==""?console.warn("THREE.WebGLProgram: Program Info Log:",ge):(Se===""||et==="")&&(Ye=!1);Ye&&(this.diagnostics={runnable:Mt,programLog:ge,vertexShader:{log:Se,prefix:G},fragmentShader:{log:et,prefix:X}})}p.deleteShader(oe),p.deleteShader(ue);let be;this.getUniforms=function(){return be===void 0&&(be=new OA(p,H)),be};let $;return this.getAttributes=function(){return $===void 0&&($=jz(p,H)),$},this.destroy=function(){d.releaseStatesOfProgram(this),p.deleteProgram(H),this.program=void 0},this.name=c.shaderName,this.id=Uz++,this.cacheKey=s,this.usedTimes=1,this.program=H,this.vertexShader=oe,this.fragmentShader=ue,this}let iG=0;class sG{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(s){const c=s.vertexShader,d=s.fragmentShader,p=this._getShaderStage(c),_=this._getShaderStage(d),x=this._getShaderCacheForMaterial(s);return x.has(p)===!1&&(x.add(p),p.usedTimes++),x.has(_)===!1&&(x.add(_),_.usedTimes++),this}remove(s){const c=this.materialCache.get(s);for(const d of c)d.usedTimes--,d.usedTimes===0&&this.shaderCache.delete(d.code);return this.materialCache.delete(s),this}getVertexShaderID(s){return this._getShaderStage(s.vertexShader).id}getFragmentShaderID(s){return this._getShaderStage(s.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(s){const c=this.materialCache;let d=c.get(s);return d===void 0&&(d=new Set,c.set(s,d)),d}_getShaderStage(s){const c=this.shaderCache;let d=c.get(s);return d===void 0&&(d=new rG(s),c.set(s,d)),d}}class rG{constructor(s){this.id=iG++,this.code=s,this.usedTimes=0}}function oG(y,s,c,d,p,_,x){const C=new _A,P=new sG,L=[],O=p.isWebGL2,k=p.logarithmicDepthBuffer,N=p.vertexTextures;let z=p.precision;const V={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function H($,ge,Se,et,Mt){const Ye=et.fog,Oe=Mt.geometry,rt=$.isMeshStandardMaterial?et.environment:null,gt=($.isMeshStandardMaterial?c:s).get($.envMap||rt),Et=!!gt&&gt.mapping===me?gt.image.height:null,at=V[$.type];$.precision!==null&&(z=p.getMaxPrecision($.precision),z!==$.precision&&console.warn("THREE.WebGLProgram.getParameters:",$.precision,"not supported, using",z,"instead."));const We=Oe.morphAttributes.position||Oe.morphAttributes.normal||Oe.morphAttributes.color,Je=We!==void 0?We.length:0;let Tt=0;Oe.morphAttributes.position!==void 0&&(Tt=1),Oe.morphAttributes.normal!==void 0&&(Tt=2),Oe.morphAttributes.color!==void 0&&(Tt=3);let It,Pt,An,Hn;if(at){const li=jo[at];It=li.vertexShader,Pt=li.fragmentShader}else It=$.vertexShader,Pt=$.fragmentShader,P.update($),An=P.getVertexShaderID($),Hn=P.getFragmentShaderID($);const Ne=y.getRenderTarget(),ai=$.alphaTest>0,Dn=$.clearcoat>0,Vn=$.iridescence>0;return{isWebGL2:O,shaderID:at,shaderName:$.type,vertexShader:It,fragmentShader:Pt,defines:$.defines,customVertexShaderID:An,customFragmentShaderID:Hn,isRawShaderMaterial:$.isRawShaderMaterial===!0,glslVersion:$.glslVersion,precision:z,instancing:Mt.isInstancedMesh===!0,instancingColor:Mt.isInstancedMesh===!0&&Mt.instanceColor!==null,supportsVertexTextures:N,outputEncoding:Ne===null?y.outputEncoding:Ne.isXRRenderTarget===!0?Ne.texture.encoding:jc,map:!!$.map,matcap:!!$.matcap,envMap:!!gt,envMapMode:gt&&gt.mapping,envMapCubeUVHeight:Et,lightMap:!!$.lightMap,aoMap:!!$.aoMap,emissiveMap:!!$.emissiveMap,bumpMap:!!$.bumpMap,normalMap:!!$.normalMap,objectSpaceNormalMap:$.normalMapType===BM,tangentSpaceNormalMap:$.normalMapType===qc,decodeVideoTexture:!!$.map&&$.map.isVideoTexture===!0&&$.map.encoding===$i,clearcoat:Dn,clearcoatMap:Dn&&!!$.clearcoatMap,clearcoatRoughnessMap:Dn&&!!$.clearcoatRoughnessMap,clearcoatNormalMap:Dn&&!!$.clearcoatNormalMap,iridescence:Vn,iridescenceMap:Vn&&!!$.iridescenceMap,iridescenceThicknessMap:Vn&&!!$.iridescenceThicknessMap,displacementMap:!!$.displacementMap,roughnessMap:!!$.roughnessMap,metalnessMap:!!$.metalnessMap,specularMap:!!$.specularMap,specularIntensityMap:!!$.specularIntensityMap,specularColorMap:!!$.specularColorMap,opaque:$.transparent===!1&&$.blending===w,alphaMap:!!$.alphaMap,alphaTest:ai,gradientMap:!!$.gradientMap,sheen:$.sheen>0,sheenColorMap:!!$.sheenColorMap,sheenRoughnessMap:!!$.sheenRoughnessMap,transmission:$.transmission>0,transmissionMap:!!$.transmissionMap,thicknessMap:!!$.thicknessMap,combine:$.combine,vertexTangents:!!$.normalMap&&!!Oe.attributes.tangent,vertexColors:$.vertexColors,vertexAlphas:$.vertexColors===!0&&!!Oe.attributes.color&&Oe.attributes.color.itemSize===4,vertexUvs:!!$.map||!!$.bumpMap||!!$.normalMap||!!$.specularMap||!!$.alphaMap||!!$.emissiveMap||!!$.roughnessMap||!!$.metalnessMap||!!$.clearcoatMap||!!$.clearcoatRoughnessMap||!!$.clearcoatNormalMap||!!$.iridescenceMap||!!$.iridescenceThicknessMap||!!$.displacementMap||!!$.transmissionMap||!!$.thicknessMap||!!$.specularIntensityMap||!!$.specularColorMap||!!$.sheenColorMap||!!$.sheenRoughnessMap,uvsVertexOnly:!(!!$.map||!!$.bumpMap||!!$.normalMap||!!$.specularMap||!!$.alphaMap||!!$.emissiveMap||!!$.roughnessMap||!!$.metalnessMap||!!$.clearcoatNormalMap||!!$.iridescenceMap||!!$.iridescenceThicknessMap||$.transmission>0||!!$.transmissionMap||!!$.thicknessMap||!!$.specularIntensityMap||!!$.specularColorMap||$.sheen>0||!!$.sheenColorMap||!!$.sheenRoughnessMap)&&!!$.displacementMap,fog:!!Ye,useFog:$.fog===!0,fogExp2:Ye&&Ye.isFogExp2,flatShading:!!$.flatShading,sizeAttenuation:$.sizeAttenuation,logarithmicDepthBuffer:k,skinning:Mt.isSkinnedMesh===!0,morphTargets:Oe.morphAttributes.position!==void 0,morphNormals:Oe.morphAttributes.normal!==void 0,morphColors:Oe.morphAttributes.color!==void 0,morphTargetsCount:Je,morphTextureStride:Tt,numDirLights:ge.directional.length,numPointLights:ge.point.length,numSpotLights:ge.spot.length,numSpotLightMaps:ge.spotLightMap.length,numRectAreaLights:ge.rectArea.length,numHemiLights:ge.hemi.length,numDirLightShadows:ge.directionalShadowMap.length,numPointLightShadows:ge.pointShadowMap.length,numSpotLightShadows:ge.spotShadowMap.length,numSpotLightShadowsWithMaps:ge.numSpotLightShadowsWithMaps,numClippingPlanes:x.numPlanes,numClipIntersection:x.numIntersection,dithering:$.dithering,shadowMapEnabled:y.shadowMap.enabled&&Se.length>0,shadowMapType:y.shadowMap.type,toneMapping:$.toneMapped?y.toneMapping:yn,physicallyCorrectLights:y.physicallyCorrectLights,premultipliedAlpha:$.premultipliedAlpha,doubleSided:$.side===A,flipSided:$.side===m,useDepthPacking:!!$.depthPacking,depthPacking:$.depthPacking||0,index0AttributeName:$.index0AttributeName,extensionDerivatives:$.extensions&&$.extensions.derivatives,extensionFragDepth:$.extensions&&$.extensions.fragDepth,extensionDrawBuffers:$.extensions&&$.extensions.drawBuffers,extensionShaderTextureLOD:$.extensions&&$.extensions.shaderTextureLOD,rendererExtensionFragDepth:O||d.has("EXT_frag_depth"),rendererExtensionDrawBuffers:O||d.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:O||d.has("EXT_shader_texture_lod"),customProgramCacheKey:$.customProgramCacheKey()}}function G($){const ge=[];if($.shaderID?ge.push($.shaderID):(ge.push($.customVertexShaderID),ge.push($.customFragmentShaderID)),$.defines!==void 0)for(const Se in $.defines)ge.push(Se),ge.push($.defines[Se]);return $.isRawShaderMaterial===!1&&(X(ge,$),Z(ge,$),ge.push(y.outputEncoding)),ge.push($.customProgramCacheKey),ge.join()}function X($,ge){$.push(ge.precision),$.push(ge.outputEncoding),$.push(ge.envMapMode),$.push(ge.envMapCubeUVHeight),$.push(ge.combine),$.push(ge.vertexUvs),$.push(ge.fogExp2),$.push(ge.sizeAttenuation),$.push(ge.morphTargetsCount),$.push(ge.morphAttributeCount),$.push(ge.numDirLights),$.push(ge.numPointLights),$.push(ge.numSpotLights),$.push(ge.numSpotLightMaps),$.push(ge.numHemiLights),$.push(ge.numRectAreaLights),$.push(ge.numDirLightShadows),$.push(ge.numPointLightShadows),$.push(ge.numSpotLightShadows),$.push(ge.numSpotLightShadowsWithMaps),$.push(ge.shadowMapType),$.push(ge.toneMapping),$.push(ge.numClippingPlanes),$.push(ge.numClipIntersection),$.push(ge.depthPacking)}function Z($,ge){C.disableAll(),ge.isWebGL2&&C.enable(0),ge.supportsVertexTextures&&C.enable(1),ge.instancing&&C.enable(2),ge.instancingColor&&C.enable(3),ge.map&&C.enable(4),ge.matcap&&C.enable(5),ge.envMap&&C.enable(6),ge.lightMap&&C.enable(7),ge.aoMap&&C.enable(8),ge.emissiveMap&&C.enable(9),ge.bumpMap&&C.enable(10),ge.normalMap&&C.enable(11),ge.objectSpaceNormalMap&&C.enable(12),ge.tangentSpaceNormalMap&&C.enable(13),ge.clearcoat&&C.enable(14),ge.clearcoatMap&&C.enable(15),ge.clearcoatRoughnessMap&&C.enable(16),ge.clearcoatNormalMap&&C.enable(17),ge.iridescence&&C.enable(18),ge.iridescenceMap&&C.enable(19),ge.iridescenceThicknessMap&&C.enable(20),ge.displacementMap&&C.enable(21),ge.specularMap&&C.enable(22),ge.roughnessMap&&C.enable(23),ge.metalnessMap&&C.enable(24),ge.gradientMap&&C.enable(25),ge.alphaMap&&C.enable(26),ge.alphaTest&&C.enable(27),ge.vertexColors&&C.enable(28),ge.vertexAlphas&&C.enable(29),ge.vertexUvs&&C.enable(30),ge.vertexTangents&&C.enable(31),ge.uvsVertexOnly&&C.enable(32),$.push(C.mask),C.disableAll(),ge.fog&&C.enable(0),ge.useFog&&C.enable(1),ge.flatShading&&C.enable(2),ge.logarithmicDepthBuffer&&C.enable(3),ge.skinning&&C.enable(4),ge.morphTargets&&C.enable(5),ge.morphNormals&&C.enable(6),ge.morphColors&&C.enable(7),ge.premultipliedAlpha&&C.enable(8),ge.shadowMapEnabled&&C.enable(9),ge.physicallyCorrectLights&&C.enable(10),ge.doubleSided&&C.enable(11),ge.flipSided&&C.enable(12),ge.useDepthPacking&&C.enable(13),ge.dithering&&C.enable(14),ge.specularIntensityMap&&C.enable(15),ge.specularColorMap&&C.enable(16),ge.transmission&&C.enable(17),ge.transmissionMap&&C.enable(18),ge.thicknessMap&&C.enable(19),ge.sheen&&C.enable(20),ge.sheenColorMap&&C.enable(21),ge.sheenRoughnessMap&&C.enable(22),ge.decodeVideoTexture&&C.enable(23),ge.opaque&&C.enable(24),$.push(C.mask)}function ne($){const ge=V[$.type];let Se;if(ge){const et=jo[ge];Se=YM.clone(et.uniforms)}else Se=$.uniforms;return Se}function te($,ge){let Se;for(let et=0,Mt=L.length;et<Mt;et++){const Ye=L[et];if(Ye.cacheKey===ge){Se=Ye,++Se.usedTimes;break}}return Se===void 0&&(Se=new nG(y,ge,$,_),L.push(Se)),Se}function oe($){if(--$.usedTimes===0){const ge=L.indexOf($);L[ge]=L[L.length-1],L.pop(),$.destroy()}}function ue($){P.remove($)}function be(){P.dispose()}return{getParameters:H,getProgramCacheKey:G,getUniforms:ne,acquireProgram:te,releaseProgram:oe,releaseShaderCache:ue,programs:L,dispose:be}}function aG(){let y=new WeakMap;function s(_){let x=y.get(_);return x===void 0&&(x={},y.set(_,x)),x}function c(_){y.delete(_)}function d(_,x,C){y.get(_)[x]=C}function p(){y=new WeakMap}return{get:s,remove:c,update:d,dispose:p}}function cG(y,s){return y.groupOrder!==s.groupOrder?y.groupOrder-s.groupOrder:y.renderOrder!==s.renderOrder?y.renderOrder-s.renderOrder:y.material.id!==s.material.id?y.material.id-s.material.id:y.z!==s.z?y.z-s.z:y.id-s.id}function x1(y,s){return y.groupOrder!==s.groupOrder?y.groupOrder-s.groupOrder:y.renderOrder!==s.renderOrder?y.renderOrder-s.renderOrder:y.z!==s.z?s.z-y.z:y.id-s.id}function w1(){const y=[];let s=0;const c=[],d=[],p=[];function _(){s=0,c.length=0,d.length=0,p.length=0}function x(k,N,z,V,H,G){let X=y[s];return X===void 0?(X={id:k.id,object:k,geometry:N,material:z,groupOrder:V,renderOrder:k.renderOrder,z:H,group:G},y[s]=X):(X.id=k.id,X.object=k,X.geometry=N,X.material=z,X.groupOrder=V,X.renderOrder=k.renderOrder,X.z=H,X.group=G),s++,X}function C(k,N,z,V,H,G){const X=x(k,N,z,V,H,G);z.transmission>0?d.push(X):z.transparent===!0?p.push(X):c.push(X)}function P(k,N,z,V,H,G){const X=x(k,N,z,V,H,G);z.transmission>0?d.unshift(X):z.transparent===!0?p.unshift(X):c.unshift(X)}function L(k,N){c.length>1&&c.sort(k||cG),d.length>1&&d.sort(N||x1),p.length>1&&p.sort(N||x1)}function O(){for(let k=s,N=y.length;k<N;k++){const z=y[k];if(z.id===null)break;z.id=null,z.object=null,z.geometry=null,z.material=null,z.group=null}}return{opaque:c,transmissive:d,transparent:p,init:_,push:C,unshift:P,finish:O,sort:L}}function lG(){let y=new WeakMap;function s(d,p){const _=y.get(d);let x;return _===void 0?(x=new w1,y.set(d,[x])):p>=_.length?(x=new w1,_.push(x)):x=_[p],x}function c(){y=new WeakMap}return{get:s,dispose:c}}function hG(){const y={};return{get:function(s){if(y[s.id]!==void 0)return y[s.id];let c;switch(s.type){case"DirectionalLight":c={direction:new de,color:new dn};break;case"SpotLight":c={position:new de,direction:new de,color:new dn,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":c={position:new de,color:new dn,distance:0,decay:0};break;case"HemisphereLight":c={direction:new de,skyColor:new dn,groundColor:new dn};break;case"RectAreaLight":c={color:new dn,position:new de,halfWidth:new de,halfHeight:new de};break}return y[s.id]=c,c}}}function uG(){const y={};return{get:function(s){if(y[s.id]!==void 0)return y[s.id];let c;switch(s.type){case"DirectionalLight":c={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new mt};break;case"SpotLight":c={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new mt};break;case"PointLight":c={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new mt,shadowCameraNear:1,shadowCameraFar:1e3};break}return y[s.id]=c,c}}}let dG=0;function fG(y,s){return(s.castShadow?2:0)-(y.castShadow?2:0)+(s.map?1:0)-(y.map?1:0)}function pG(y,s){const c=new hG,d=uG(),p={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let O=0;O<9;O++)p.probe.push(new de);const _=new de,x=new $n,C=new $n;function P(O,k){let N=0,z=0,V=0;for(let et=0;et<9;et++)p.probe[et].set(0,0,0);let H=0,G=0,X=0,Z=0,ne=0,te=0,oe=0,ue=0,be=0,$=0;O.sort(fG);const ge=k!==!0?Math.PI:1;for(let et=0,Mt=O.length;et<Mt;et++){const Ye=O[et],Oe=Ye.color,rt=Ye.intensity,gt=Ye.distance,Et=Ye.shadow&&Ye.shadow.map?Ye.shadow.map.texture:null;if(Ye.isAmbientLight)N+=Oe.r*rt*ge,z+=Oe.g*rt*ge,V+=Oe.b*rt*ge;else if(Ye.isLightProbe)for(let at=0;at<9;at++)p.probe[at].addScaledVector(Ye.sh.coefficients[at],rt);else if(Ye.isDirectionalLight){const at=c.get(Ye);if(at.color.copy(Ye.color).multiplyScalar(Ye.intensity*ge),Ye.castShadow){const We=Ye.shadow,Je=d.get(Ye);Je.shadowBias=We.bias,Je.shadowNormalBias=We.normalBias,Je.shadowRadius=We.radius,Je.shadowMapSize=We.mapSize,p.directionalShadow[H]=Je,p.directionalShadowMap[H]=Et,p.directionalShadowMatrix[H]=Ye.shadow.matrix,te++}p.directional[H]=at,H++}else if(Ye.isSpotLight){const at=c.get(Ye);at.position.setFromMatrixPosition(Ye.matrixWorld),at.color.copy(Oe).multiplyScalar(rt*ge),at.distance=gt,at.coneCos=Math.cos(Ye.angle),at.penumbraCos=Math.cos(Ye.angle*(1-Ye.penumbra)),at.decay=Ye.decay,p.spot[X]=at;const We=Ye.shadow;if(Ye.map&&(p.spotLightMap[be]=Ye.map,be++,We.updateMatrices(Ye),Ye.castShadow&&$++),p.spotLightMatrix[X]=We.matrix,Ye.castShadow){const Je=d.get(Ye);Je.shadowBias=We.bias,Je.shadowNormalBias=We.normalBias,Je.shadowRadius=We.radius,Je.shadowMapSize=We.mapSize,p.spotShadow[X]=Je,p.spotShadowMap[X]=Et,ue++}X++}else if(Ye.isRectAreaLight){const at=c.get(Ye);at.color.copy(Oe).multiplyScalar(rt),at.halfWidth.set(Ye.width*.5,0,0),at.halfHeight.set(0,Ye.height*.5,0),p.rectArea[Z]=at,Z++}else if(Ye.isPointLight){const at=c.get(Ye);if(at.color.copy(Ye.color).multiplyScalar(Ye.intensity*ge),at.distance=Ye.distance,at.decay=Ye.decay,Ye.castShadow){const We=Ye.shadow,Je=d.get(Ye);Je.shadowBias=We.bias,Je.shadowNormalBias=We.normalBias,Je.shadowRadius=We.radius,Je.shadowMapSize=We.mapSize,Je.shadowCameraNear=We.camera.near,Je.shadowCameraFar=We.camera.far,p.pointShadow[G]=Je,p.pointShadowMap[G]=Et,p.pointShadowMatrix[G]=Ye.shadow.matrix,oe++}p.point[G]=at,G++}else if(Ye.isHemisphereLight){const at=c.get(Ye);at.skyColor.copy(Ye.color).multiplyScalar(rt*ge),at.groundColor.copy(Ye.groundColor).multiplyScalar(rt*ge),p.hemi[ne]=at,ne++}}Z>0&&(s.isWebGL2||y.has("OES_texture_float_linear")===!0?(p.rectAreaLTC1=Vt.LTC_FLOAT_1,p.rectAreaLTC2=Vt.LTC_FLOAT_2):y.has("OES_texture_half_float_linear")===!0?(p.rectAreaLTC1=Vt.LTC_HALF_1,p.rectAreaLTC2=Vt.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),p.ambient[0]=N,p.ambient[1]=z,p.ambient[2]=V;const Se=p.hash;(Se.directionalLength!==H||Se.pointLength!==G||Se.spotLength!==X||Se.rectAreaLength!==Z||Se.hemiLength!==ne||Se.numDirectionalShadows!==te||Se.numPointShadows!==oe||Se.numSpotShadows!==ue||Se.numSpotMaps!==be)&&(p.directional.length=H,p.spot.length=X,p.rectArea.length=Z,p.point.length=G,p.hemi.length=ne,p.directionalShadow.length=te,p.directionalShadowMap.length=te,p.pointShadow.length=oe,p.pointShadowMap.length=oe,p.spotShadow.length=ue,p.spotShadowMap.length=ue,p.directionalShadowMatrix.length=te,p.pointShadowMatrix.length=oe,p.spotLightMatrix.length=ue+be-$,p.spotLightMap.length=be,p.numSpotLightShadowsWithMaps=$,Se.directionalLength=H,Se.pointLength=G,Se.spotLength=X,Se.rectAreaLength=Z,Se.hemiLength=ne,Se.numDirectionalShadows=te,Se.numPointShadows=oe,Se.numSpotShadows=ue,Se.numSpotMaps=be,p.version=dG++)}function L(O,k){let N=0,z=0,V=0,H=0,G=0;const X=k.matrixWorldInverse;for(let Z=0,ne=O.length;Z<ne;Z++){const te=O[Z];if(te.isDirectionalLight){const oe=p.directional[N];oe.direction.setFromMatrixPosition(te.matrixWorld),_.setFromMatrixPosition(te.target.matrixWorld),oe.direction.sub(_),oe.direction.transformDirection(X),N++}else if(te.isSpotLight){const oe=p.spot[V];oe.position.setFromMatrixPosition(te.matrixWorld),oe.position.applyMatrix4(X),oe.direction.setFromMatrixPosition(te.matrixWorld),_.setFromMatrixPosition(te.target.matrixWorld),oe.direction.sub(_),oe.direction.transformDirection(X),V++}else if(te.isRectAreaLight){const oe=p.rectArea[H];oe.position.setFromMatrixPosition(te.matrixWorld),oe.position.applyMatrix4(X),C.identity(),x.copy(te.matrixWorld),x.premultiply(X),C.extractRotation(x),oe.halfWidth.set(te.width*.5,0,0),oe.halfHeight.set(0,te.height*.5,0),oe.halfWidth.applyMatrix4(C),oe.halfHeight.applyMatrix4(C),H++}else if(te.isPointLight){const oe=p.point[z];oe.position.setFromMatrixPosition(te.matrixWorld),oe.position.applyMatrix4(X),z++}else if(te.isHemisphereLight){const oe=p.hemi[G];oe.direction.setFromMatrixPosition(te.matrixWorld),oe.direction.transformDirection(X),G++}}}return{setup:P,setupView:L,state:p}}function b1(y,s){const c=new pG(y,s),d=[],p=[];function _(){d.length=0,p.length=0}function x(k){d.push(k)}function C(k){p.push(k)}function P(k){c.setup(d,k)}function L(k){c.setupView(d,k)}return{init:_,state:{lightsArray:d,shadowsArray:p,lights:c},setupLights:P,setupLightsView:L,pushLight:x,pushShadow:C}}function mG(y,s){let c=new WeakMap;function d(_,x){const C=c.get(_);let P;return C===void 0?(P=new b1(y,s),c.set(_,[P])):x>=C.length?(P=new b1(y,s),C.push(P)):P=C[x],P}function p(){c=new WeakMap}return{get:d,dispose:p}}class xx extends rr{constructor(s){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=RM,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(s)}copy(s){return super.copy(s),this.depthPacking=s.depthPacking,this.map=s.map,this.alphaMap=s.alphaMap,this.displacementMap=s.displacementMap,this.displacementScale=s.displacementScale,this.displacementBias=s.displacementBias,this.wireframe=s.wireframe,this.wireframeLinewidth=s.wireframeLinewidth,this}}class wx extends rr{constructor(s){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new de,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(s)}copy(s){return super.copy(s),this.referencePosition.copy(s.referencePosition),this.nearDistance=s.nearDistance,this.farDistance=s.farDistance,this.map=s.map,this.alphaMap=s.alphaMap,this.displacementMap=s.displacementMap,this.displacementScale=s.displacementScale,this.displacementBias=s.displacementBias,this}}const gG=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,AG=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function _G(y,s,c){let d=new PA;const p=new mt,_=new mt,x=new Ri,C=new xx({depthPacking:PM}),P=new wx,L={},O=c.maxTextureSize,k={0:m,1:g,2:A},N=new Aa({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new mt},radius:{value:4}},vertexShader:gG,fragmentShader:AG}),z=N.clone();z.defines.HORIZONTAL_PASS=1;const V=new si;V.setAttribute("position",new Oi(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const H=new qs(V,N),G=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=h,this.render=function(te,oe,ue){if(G.enabled===!1||G.autoUpdate===!1&&G.needsUpdate===!1||te.length===0)return;const be=y.getRenderTarget(),$=y.getActiveCubeFace(),ge=y.getActiveMipmapLevel(),Se=y.state;Se.setBlending(v),Se.buffers.color.setClear(1,1,1,1),Se.buffers.depth.setTest(!0),Se.setScissorTest(!1);for(let et=0,Mt=te.length;et<Mt;et++){const Ye=te[et],Oe=Ye.shadow;if(Oe===void 0){console.warn("THREE.WebGLShadowMap:",Ye,"has no shadow.");continue}if(Oe.autoUpdate===!1&&Oe.needsUpdate===!1)continue;p.copy(Oe.mapSize);const rt=Oe.getFrameExtents();if(p.multiply(rt),_.copy(Oe.mapSize),(p.x>O||p.y>O)&&(p.x>O&&(_.x=Math.floor(O/rt.x),p.x=_.x*rt.x,Oe.mapSize.x=_.x),p.y>O&&(_.y=Math.floor(O/rt.y),p.y=_.y*rt.y,Oe.mapSize.y=_.y)),Oe.map===null){const Et=this.type!==f?{minFilter:pt,magFilter:pt}:{};Oe.map=new _o(p.x,p.y,Et),Oe.map.texture.name=Ye.name+".shadowMap",Oe.camera.updateProjectionMatrix()}y.setRenderTarget(Oe.map),y.clear();const gt=Oe.getViewportCount();for(let Et=0;Et<gt;Et++){const at=Oe.getViewport(Et);x.set(_.x*at.x,_.y*at.y,_.x*at.z,_.y*at.w),Se.viewport(x),Oe.updateMatrices(Ye,Et),d=Oe.getFrustum(),ne(oe,ue,Oe.camera,Ye,this.type)}Oe.isPointLightShadow!==!0&&this.type===f&&X(Oe,ue),Oe.needsUpdate=!1}G.needsUpdate=!1,y.setRenderTarget(be,$,ge)};function X(te,oe){const ue=s.update(H);N.defines.VSM_SAMPLES!==te.blurSamples&&(N.defines.VSM_SAMPLES=te.blurSamples,z.defines.VSM_SAMPLES=te.blurSamples,N.needsUpdate=!0,z.needsUpdate=!0),te.mapPass===null&&(te.mapPass=new _o(p.x,p.y)),N.uniforms.shadow_pass.value=te.map.texture,N.uniforms.resolution.value=te.mapSize,N.uniforms.radius.value=te.radius,y.setRenderTarget(te.mapPass),y.clear(),y.renderBufferDirect(oe,null,ue,N,H,null),z.uniforms.shadow_pass.value=te.mapPass.texture,z.uniforms.resolution.value=te.mapSize,z.uniforms.radius.value=te.radius,y.setRenderTarget(te.map),y.clear(),y.renderBufferDirect(oe,null,ue,z,H,null)}function Z(te,oe,ue,be,$,ge){let Se=null;const et=ue.isPointLight===!0?te.customDistanceMaterial:te.customDepthMaterial;if(et!==void 0?Se=et:Se=ue.isPointLight===!0?P:C,y.localClippingEnabled&&oe.clipShadows===!0&&Array.isArray(oe.clippingPlanes)&&oe.clippingPlanes.length!==0||oe.displacementMap&&oe.displacementScale!==0||oe.alphaMap&&oe.alphaTest>0){const Mt=Se.uuid,Ye=oe.uuid;let Oe=L[Mt];Oe===void 0&&(Oe={},L[Mt]=Oe);let rt=Oe[Ye];rt===void 0&&(rt=Se.clone(),Oe[Ye]=rt),Se=rt}return Se.visible=oe.visible,Se.wireframe=oe.wireframe,ge===f?Se.side=oe.shadowSide!==null?oe.shadowSide:oe.side:Se.side=oe.shadowSide!==null?oe.shadowSide:k[oe.side],Se.alphaMap=oe.alphaMap,Se.alphaTest=oe.alphaTest,Se.clipShadows=oe.clipShadows,Se.clippingPlanes=oe.clippingPlanes,Se.clipIntersection=oe.clipIntersection,Se.displacementMap=oe.displacementMap,Se.displacementScale=oe.displacementScale,Se.displacementBias=oe.displacementBias,Se.wireframeLinewidth=oe.wireframeLinewidth,Se.linewidth=oe.linewidth,ue.isPointLight===!0&&Se.isMeshDistanceMaterial===!0&&(Se.referencePosition.setFromMatrixPosition(ue.matrixWorld),Se.nearDistance=be,Se.farDistance=$),Se}function ne(te,oe,ue,be,$){if(te.visible===!1)return;if(te.layers.test(oe.layers)&&(te.isMesh||te.isLine||te.isPoints)&&(te.castShadow||te.receiveShadow&&$===f)&&(!te.frustumCulled||d.intersectsObject(te))){te.modelViewMatrix.multiplyMatrices(ue.matrixWorldInverse,te.matrixWorld);const et=s.update(te),Mt=te.material;if(Array.isArray(Mt)){const Ye=et.groups;for(let Oe=0,rt=Ye.length;Oe<rt;Oe++){const gt=Ye[Oe],Et=Mt[gt.materialIndex];if(Et&&Et.visible){const at=Z(te,Et,be,ue.near,ue.far,$);y.renderBufferDirect(ue,null,et,at,te,gt)}}}else if(Mt.visible){const Ye=Z(te,Mt,be,ue.near,ue.far,$);y.renderBufferDirect(ue,null,et,Ye,te,null)}}const Se=te.children;for(let et=0,Mt=Se.length;et<Mt;et++)ne(Se[et],oe,ue,be,$)}}function yG(y,s,c){const d=c.isWebGL2;function p(){let Pe=!1;const _n=new Ri;let Qt=null;const ht=new Ri(0,0,0,0);return{setMask:function(Yt){Qt!==Yt&&!Pe&&(y.colorMask(Yt,Yt,Yt,Yt),Qt=Yt)},setLocked:function(Yt){Pe=Yt},setClear:function(Yt,Un,ji,ps,ll){ll===!0&&(Yt*=ps,Un*=ps,ji*=ps),_n.set(Yt,Un,ji,ps),ht.equals(_n)===!1&&(y.clearColor(Yt,Un,ji,ps),ht.copy(_n))},reset:function(){Pe=!1,Qt=null,ht.set(-1,0,0,0)}}}function _(){let Pe=!1,_n=null,Qt=null,ht=null;return{setTest:function(Yt){Yt?ai(y.DEPTH_TEST):Dn(y.DEPTH_TEST)},setMask:function(Yt){_n!==Yt&&!Pe&&(y.depthMask(Yt),_n=Yt)},setFunc:function(Yt){if(Qt!==Yt){switch(Yt){case Me:y.depthFunc(y.NEVER);break;case Be:y.depthFunc(y.ALWAYS);break;case Le:y.depthFunc(y.LESS);break;case $e:y.depthFunc(y.LEQUAL);break;case yt:y.depthFunc(y.EQUAL);break;case Nt:y.depthFunc(y.GEQUAL);break;case He:y.depthFunc(y.GREATER);break;case mn:y.depthFunc(y.NOTEQUAL);break;default:y.depthFunc(y.LEQUAL)}Qt=Yt}},setLocked:function(Yt){Pe=Yt},setClear:function(Yt){ht!==Yt&&(y.clearDepth(Yt),ht=Yt)},reset:function(){Pe=!1,_n=null,Qt=null,ht=null}}}function x(){let Pe=!1,_n=null,Qt=null,ht=null,Yt=null,Un=null,ji=null,ps=null,ll=null;return{setTest:function(ss){Pe||(ss?ai(y.STENCIL_TEST):Dn(y.STENCIL_TEST))},setMask:function(ss){_n!==ss&&!Pe&&(y.stencilMask(ss),_n=ss)},setFunc:function(ss,cc,wo){(Qt!==ss||ht!==cc||Yt!==wo)&&(y.stencilFunc(ss,cc,wo),Qt=ss,ht=cc,Yt=wo)},setOp:function(ss,cc,wo){(Un!==ss||ji!==cc||ps!==wo)&&(y.stencilOp(ss,cc,wo),Un=ss,ji=cc,ps=wo)},setLocked:function(ss){Pe=ss},setClear:function(ss){ll!==ss&&(y.clearStencil(ss),ll=ss)},reset:function(){Pe=!1,_n=null,Qt=null,ht=null,Yt=null,Un=null,ji=null,ps=null,ll=null}}}const C=new p,P=new _,L=new x,O=new WeakMap,k=new WeakMap;let N={},z={},V=new WeakMap,H=[],G=null,X=!1,Z=null,ne=null,te=null,oe=null,ue=null,be=null,$=null,ge=!1,Se=null,et=null,Mt=null,Ye=null,Oe=null;const rt=y.getParameter(y.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let gt=!1,Et=0;const at=y.getParameter(y.VERSION);at.indexOf("WebGL")!==-1?(Et=parseFloat(/^WebGL (\d)/.exec(at)[1]),gt=Et>=1):at.indexOf("OpenGL ES")!==-1&&(Et=parseFloat(/^OpenGL ES (\d)/.exec(at)[1]),gt=Et>=2);let We=null,Je={};const Tt=y.getParameter(y.SCISSOR_BOX),It=y.getParameter(y.VIEWPORT),Pt=new Ri().fromArray(Tt),An=new Ri().fromArray(It);function Hn(Pe,_n,Qt){const ht=new Uint8Array(4),Yt=y.createTexture();y.bindTexture(Pe,Yt),y.texParameteri(Pe,y.TEXTURE_MIN_FILTER,y.NEAREST),y.texParameteri(Pe,y.TEXTURE_MAG_FILTER,y.NEAREST);for(let Un=0;Un<Qt;Un++)y.texImage2D(_n+Un,0,y.RGBA,1,1,0,y.RGBA,y.UNSIGNED_BYTE,ht);return Yt}const Ne={};Ne[y.TEXTURE_2D]=Hn(y.TEXTURE_2D,y.TEXTURE_2D,1),Ne[y.TEXTURE_CUBE_MAP]=Hn(y.TEXTURE_CUBE_MAP,y.TEXTURE_CUBE_MAP_POSITIVE_X,6),C.setClear(0,0,0,1),P.setClear(1),L.setClear(0),ai(y.DEPTH_TEST),P.setFunc($e),sn(!1),ei(i),ai(y.CULL_FACE),Ut(v);function ai(Pe){N[Pe]!==!0&&(y.enable(Pe),N[Pe]=!0)}function Dn(Pe){N[Pe]!==!1&&(y.disable(Pe),N[Pe]=!1)}function Vn(Pe,_n){return z[Pe]!==_n?(y.bindFramebuffer(Pe,_n),z[Pe]=_n,d&&(Pe===y.DRAW_FRAMEBUFFER&&(z[y.FRAMEBUFFER]=_n),Pe===y.FRAMEBUFFER&&(z[y.DRAW_FRAMEBUFFER]=_n)),!0):!1}function on(Pe,_n){let Qt=H,ht=!1;if(Pe)if(Qt=V.get(_n),Qt===void 0&&(Qt=[],V.set(_n,Qt)),Pe.isWebGLMultipleRenderTargets){const Yt=Pe.texture;if(Qt.length!==Yt.length||Qt[0]!==y.COLOR_ATTACHMENT0){for(let Un=0,ji=Yt.length;Un<ji;Un++)Qt[Un]=y.COLOR_ATTACHMENT0+Un;Qt.length=Yt.length,ht=!0}}else Qt[0]!==y.COLOR_ATTACHMENT0&&(Qt[0]=y.COLOR_ATTACHMENT0,ht=!0);else Qt[0]!==y.BACK&&(Qt[0]=y.BACK,ht=!0);ht&&(c.isWebGL2?y.drawBuffers(Qt):s.get("WEBGL_draw_buffers").drawBuffersWEBGL(Qt))}function li(Pe){return G!==Pe?(y.useProgram(Pe),G=Pe,!0):!1}const dt={[I]:y.FUNC_ADD,[T]:y.FUNC_SUBTRACT,[B]:y.FUNC_REVERSE_SUBTRACT};if(d)dt[F]=y.MIN,dt[D]=y.MAX;else{const Pe=s.get("EXT_blend_minmax");Pe!==null&&(dt[F]=Pe.MIN_EXT,dt[D]=Pe.MAX_EXT)}const ct={[U]:y.ZERO,[W]:y.ONE,[J]:y.SRC_COLOR,[Q]:y.SRC_ALPHA,[Ae]:y.SRC_ALPHA_SATURATE,[ve]:y.DST_COLOR,[se]:y.DST_ALPHA,[ee]:y.ONE_MINUS_SRC_COLOR,[Y]:y.ONE_MINUS_SRC_ALPHA,[xe]:y.ONE_MINUS_DST_COLOR,[ae]:y.ONE_MINUS_DST_ALPHA};function Ut(Pe,_n,Qt,ht,Yt,Un,ji,ps){if(Pe===v){X===!0&&(Dn(y.BLEND),X=!1);return}if(X===!1&&(ai(y.BLEND),X=!0),Pe!==M){if(Pe!==Z||ps!==ge){if((ne!==I||ue!==I)&&(y.blendEquation(y.FUNC_ADD),ne=I,ue=I),ps)switch(Pe){case w:y.blendFuncSeparate(y.ONE,y.ONE_MINUS_SRC_ALPHA,y.ONE,y.ONE_MINUS_SRC_ALPHA);break;case b:y.blendFunc(y.ONE,y.ONE);break;case S:y.blendFuncSeparate(y.ZERO,y.ONE_MINUS_SRC_COLOR,y.ZERO,y.ONE);break;case R:y.blendFuncSeparate(y.ZERO,y.SRC_COLOR,y.ZERO,y.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",Pe);break}else switch(Pe){case w:y.blendFuncSeparate(y.SRC_ALPHA,y.ONE_MINUS_SRC_ALPHA,y.ONE,y.ONE_MINUS_SRC_ALPHA);break;case b:y.blendFunc(y.SRC_ALPHA,y.ONE);break;case S:y.blendFuncSeparate(y.ZERO,y.ONE_MINUS_SRC_COLOR,y.ZERO,y.ONE);break;case R:y.blendFunc(y.ZERO,y.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",Pe);break}te=null,oe=null,be=null,$=null,Z=Pe,ge=ps}return}Yt=Yt||_n,Un=Un||Qt,ji=ji||ht,(_n!==ne||Yt!==ue)&&(y.blendEquationSeparate(dt[_n],dt[Yt]),ne=_n,ue=Yt),(Qt!==te||ht!==oe||Un!==be||ji!==$)&&(y.blendFuncSeparate(ct[Qt],ct[ht],ct[Un],ct[ji]),te=Qt,oe=ht,be=Un,$=ji),Z=Pe,ge=null}function bn(Pe,_n){Pe.side===A?Dn(y.CULL_FACE):ai(y.CULL_FACE);let Qt=Pe.side===m;_n&&(Qt=!Qt),sn(Qt),Pe.blending===w&&Pe.transparent===!1?Ut(v):Ut(Pe.blending,Pe.blendEquation,Pe.blendSrc,Pe.blendDst,Pe.blendEquationAlpha,Pe.blendSrcAlpha,Pe.blendDstAlpha,Pe.premultipliedAlpha),P.setFunc(Pe.depthFunc),P.setTest(Pe.depthTest),P.setMask(Pe.depthWrite),C.setMask(Pe.colorWrite);const ht=Pe.stencilWrite;L.setTest(ht),ht&&(L.setMask(Pe.stencilWriteMask),L.setFunc(Pe.stencilFunc,Pe.stencilRef,Pe.stencilFuncMask),L.setOp(Pe.stencilFail,Pe.stencilZFail,Pe.stencilZPass)),Pn(Pe.polygonOffset,Pe.polygonOffsetFactor,Pe.polygonOffsetUnits),Pe.alphaToCoverage===!0?ai(y.SAMPLE_ALPHA_TO_COVERAGE):Dn(y.SAMPLE_ALPHA_TO_COVERAGE)}function sn(Pe){Se!==Pe&&(Pe?y.frontFace(y.CW):y.frontFace(y.CCW),Se=Pe)}function ei(Pe){Pe!==n?(ai(y.CULL_FACE),Pe!==et&&(Pe===i?y.cullFace(y.BACK):Pe===r?y.cullFace(y.FRONT):y.cullFace(y.FRONT_AND_BACK))):Dn(y.CULL_FACE),et=Pe}function kn(Pe){Pe!==Mt&&(gt&&y.lineWidth(Pe),Mt=Pe)}function Pn(Pe,_n,Qt){Pe?(ai(y.POLYGON_OFFSET_FILL),(Ye!==_n||Oe!==Qt)&&(y.polygonOffset(_n,Qt),Ye=_n,Oe=Qt)):Dn(y.POLYGON_OFFSET_FILL)}function Qi(Pe){Pe?ai(y.SCISSOR_TEST):Dn(y.SCISSOR_TEST)}function Fi(Pe){Pe===void 0&&(Pe=y.TEXTURE0+rt-1),We!==Pe&&(y.activeTexture(Pe),We=Pe)}function ye(Pe,_n,Qt){Qt===void 0&&(We===null?Qt=y.TEXTURE0+rt-1:Qt=We);let ht=Je[Qt];ht===void 0&&(ht={type:void 0,texture:void 0},Je[Qt]=ht),(ht.type!==Pe||ht.texture!==_n)&&(We!==Qt&&(y.activeTexture(Qt),We=Qt),y.bindTexture(Pe,_n||Ne[Pe]),ht.type=Pe,ht.texture=_n)}function le(){const Pe=Je[We];Pe!==void 0&&Pe.type!==void 0&&(y.bindTexture(Pe.type,null),Pe.type=void 0,Pe.texture=void 0)}function Ke(){try{y.compressedTexImage2D.apply(y,arguments)}catch(Pe){console.error("THREE.WebGLState:",Pe)}}function Dt(){try{y.texSubImage2D.apply(y,arguments)}catch(Pe){console.error("THREE.WebGLState:",Pe)}}function Wt(){try{y.texSubImage3D.apply(y,arguments)}catch(Pe){console.error("THREE.WebGLState:",Pe)}}function an(){try{y.compressedTexSubImage2D.apply(y,arguments)}catch(Pe){console.error("THREE.WebGLState:",Pe)}}function zn(){try{y.texStorage2D.apply(y,arguments)}catch(Pe){console.error("THREE.WebGLState:",Pe)}}function cn(){try{y.texStorage3D.apply(y,arguments)}catch(Pe){console.error("THREE.WebGLState:",Pe)}}function ft(){try{y.texImage2D.apply(y,arguments)}catch(Pe){console.error("THREE.WebGLState:",Pe)}}function Tn(){try{y.texImage3D.apply(y,arguments)}catch(Pe){console.error("THREE.WebGLState:",Pe)}}function Wn(Pe){Pt.equals(Pe)===!1&&(y.scissor(Pe.x,Pe.y,Pe.z,Pe.w),Pt.copy(Pe))}function Cn(Pe){An.equals(Pe)===!1&&(y.viewport(Pe.x,Pe.y,Pe.z,Pe.w),An.copy(Pe))}function Nn(Pe,_n){let Qt=k.get(_n);Qt===void 0&&(Qt=new WeakMap,k.set(_n,Qt));let ht=Qt.get(Pe);ht===void 0&&(ht=y.getUniformBlockIndex(_n,Pe.name),Qt.set(Pe,ht))}function ri(Pe,_n){const ht=k.get(_n).get(Pe);O.get(Pe)!==ht&&(y.uniformBlockBinding(_n,ht,Pe.__bindingPointIndex),O.set(Pe,ht))}function Bi(){y.disable(y.BLEND),y.disable(y.CULL_FACE),y.disable(y.DEPTH_TEST),y.disable(y.POLYGON_OFFSET_FILL),y.disable(y.SCISSOR_TEST),y.disable(y.STENCIL_TEST),y.disable(y.SAMPLE_ALPHA_TO_COVERAGE),y.blendEquation(y.FUNC_ADD),y.blendFunc(y.ONE,y.ZERO),y.blendFuncSeparate(y.ONE,y.ZERO,y.ONE,y.ZERO),y.colorMask(!0,!0,!0,!0),y.clearColor(0,0,0,0),y.depthMask(!0),y.depthFunc(y.LESS),y.clearDepth(1),y.stencilMask(4294967295),y.stencilFunc(y.ALWAYS,0,4294967295),y.stencilOp(y.KEEP,y.KEEP,y.KEEP),y.clearStencil(0),y.cullFace(y.BACK),y.frontFace(y.CCW),y.polygonOffset(0,0),y.activeTexture(y.TEXTURE0),y.bindFramebuffer(y.FRAMEBUFFER,null),d===!0&&(y.bindFramebuffer(y.DRAW_FRAMEBUFFER,null),y.bindFramebuffer(y.READ_FRAMEBUFFER,null)),y.useProgram(null),y.lineWidth(1),y.scissor(0,0,y.canvas.width,y.canvas.height),y.viewport(0,0,y.canvas.width,y.canvas.height),N={},We=null,Je={},z={},V=new WeakMap,H=[],G=null,X=!1,Z=null,ne=null,te=null,oe=null,ue=null,be=null,$=null,ge=!1,Se=null,et=null,Mt=null,Ye=null,Oe=null,Pt.set(0,0,y.canvas.width,y.canvas.height),An.set(0,0,y.canvas.width,y.canvas.height),C.reset(),P.reset(),L.reset()}return{buffers:{color:C,depth:P,stencil:L},enable:ai,disable:Dn,bindFramebuffer:Vn,drawBuffers:on,useProgram:li,setBlending:Ut,setMaterial:bn,setFlipSided:sn,setCullFace:ei,setLineWidth:kn,setPolygonOffset:Pn,setScissorTest:Qi,activeTexture:Fi,bindTexture:ye,unbindTexture:le,compressedTexImage2D:Ke,texImage2D:ft,texImage3D:Tn,updateUBOMapping:Nn,uniformBlockBinding:ri,texStorage2D:zn,texStorage3D:cn,texSubImage2D:Dt,texSubImage3D:Wt,compressedTexSubImage2D:an,scissor:Wn,viewport:Cn,reset:Bi}}function vG(y,s,c,d,p,_,x){const C=p.isWebGL2,P=p.maxTextures,L=p.maxCubemapSize,O=p.maxTextureSize,k=p.maxSamples,N=s.has("WEBGL_multisampled_render_to_texture")?s.get("WEBGL_multisampled_render_to_texture"):null,z=/OculusBrowser/g.test(navigator.userAgent),V=new WeakMap;let H;const G=new WeakMap;let X=!1;try{X=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function Z(ye,le){return X?new OffscreenCanvas(ye,le):ap("canvas")}function ne(ye,le,Ke,Dt){let Wt=1;if((ye.width>Dt||ye.height>Dt)&&(Wt=Dt/Math.max(ye.width,ye.height)),Wt<1||le===!0)if(typeof HTMLImageElement<"u"&&ye instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&ye instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&ye instanceof ImageBitmap){const an=le?aA:Math.floor,zn=an(Wt*ye.width),cn=an(Wt*ye.height);H===void 0&&(H=Z(zn,cn));const ft=Ke?Z(zn,cn):H;return ft.width=zn,ft.height=cn,ft.getContext("2d").drawImage(ye,0,0,zn,cn),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+ye.width+"x"+ye.height+") to ("+zn+"x"+cn+")."),ft}else return"data"in ye&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+ye.width+"x"+ye.height+")."),ye;return ye}function te(ye){return Wv(ye.width)&&Wv(ye.height)}function oe(ye){return C?!1:ye.wrapS!==Qe||ye.wrapT!==Qe||ye.minFilter!==pt&&ye.minFilter!==bt}function ue(ye,le){return ye.generateMipmaps&&le&&ye.minFilter!==pt&&ye.minFilter!==bt}function be(ye){y.generateMipmap(ye)}function $(ye,le,Ke,Dt,Wt=!1){if(C===!1)return le;if(ye!==null){if(y[ye]!==void 0)return y[ye];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+ye+"'")}let an=le;return le===y.RED&&(Ke===y.FLOAT&&(an=y.R32F),Ke===y.HALF_FLOAT&&(an=y.R16F),Ke===y.UNSIGNED_BYTE&&(an=y.R8)),le===y.RG&&(Ke===y.FLOAT&&(an=y.RG32F),Ke===y.HALF_FLOAT&&(an=y.RG16F),Ke===y.UNSIGNED_BYTE&&(an=y.RG8)),le===y.RGBA&&(Ke===y.FLOAT&&(an=y.RGBA32F),Ke===y.HALF_FLOAT&&(an=y.RGBA16F),Ke===y.UNSIGNED_BYTE&&(an=Dt===$i&&Wt===!1?y.SRGB8_ALPHA8:y.RGBA8),Ke===y.UNSIGNED_SHORT_4_4_4_4&&(an=y.RGBA4),Ke===y.UNSIGNED_SHORT_5_5_5_1&&(an=y.RGB5_A1)),(an===y.R16F||an===y.R32F||an===y.RG16F||an===y.RG32F||an===y.RGBA16F||an===y.RGBA32F)&&s.get("EXT_color_buffer_float"),an}function ge(ye,le,Ke){return ue(ye,Ke)===!0||ye.isFramebufferTexture&&ye.minFilter!==pt&&ye.minFilter!==bt?Math.log2(Math.max(le.width,le.height))+1:ye.mipmaps!==void 0&&ye.mipmaps.length>0?ye.mipmaps.length:ye.isCompressedTexture&&Array.isArray(ye.image)?le.mipmaps.length:1}function Se(ye){return ye===pt||ye===zt||ye===we?y.NEAREST:y.LINEAR}function et(ye){const le=ye.target;le.removeEventListener("dispose",et),Ye(le),le.isVideoTexture&&V.delete(le)}function Mt(ye){const le=ye.target;le.removeEventListener("dispose",Mt),rt(le)}function Ye(ye){const le=d.get(ye);if(le.__webglInit===void 0)return;const Ke=ye.source,Dt=G.get(Ke);if(Dt){const Wt=Dt[le.__cacheKey];Wt.usedTimes--,Wt.usedTimes===0&&Oe(ye),Object.keys(Dt).length===0&&G.delete(Ke)}d.remove(ye)}function Oe(ye){const le=d.get(ye);y.deleteTexture(le.__webglTexture);const Ke=ye.source,Dt=G.get(Ke);delete Dt[le.__cacheKey],x.memory.textures--}function rt(ye){const le=ye.texture,Ke=d.get(ye),Dt=d.get(le);if(Dt.__webglTexture!==void 0&&(y.deleteTexture(Dt.__webglTexture),x.memory.textures--),ye.depthTexture&&ye.depthTexture.dispose(),ye.isWebGLCubeRenderTarget)for(let Wt=0;Wt<6;Wt++)y.deleteFramebuffer(Ke.__webglFramebuffer[Wt]),Ke.__webglDepthbuffer&&y.deleteRenderbuffer(Ke.__webglDepthbuffer[Wt]);else{if(y.deleteFramebuffer(Ke.__webglFramebuffer),Ke.__webglDepthbuffer&&y.deleteRenderbuffer(Ke.__webglDepthbuffer),Ke.__webglMultisampledFramebuffer&&y.deleteFramebuffer(Ke.__webglMultisampledFramebuffer),Ke.__webglColorRenderbuffer)for(let Wt=0;Wt<Ke.__webglColorRenderbuffer.length;Wt++)Ke.__webglColorRenderbuffer[Wt]&&y.deleteRenderbuffer(Ke.__webglColorRenderbuffer[Wt]);Ke.__webglDepthRenderbuffer&&y.deleteRenderbuffer(Ke.__webglDepthRenderbuffer)}if(ye.isWebGLMultipleRenderTargets)for(let Wt=0,an=le.length;Wt<an;Wt++){const zn=d.get(le[Wt]);zn.__webglTexture&&(y.deleteTexture(zn.__webglTexture),x.memory.textures--),d.remove(le[Wt])}d.remove(le),d.remove(ye)}let gt=0;function Et(){gt=0}function at(){const ye=gt;return ye>=P&&console.warn("THREE.WebGLTextures: Trying to use "+ye+" texture units while this GPU supports only "+P),gt+=1,ye}function We(ye){const le=[];return le.push(ye.wrapS),le.push(ye.wrapT),le.push(ye.magFilter),le.push(ye.minFilter),le.push(ye.anisotropy),le.push(ye.internalFormat),le.push(ye.format),le.push(ye.type),le.push(ye.generateMipmaps),le.push(ye.premultiplyAlpha),le.push(ye.flipY),le.push(ye.unpackAlignment),le.push(ye.encoding),le.join()}function Je(ye,le){const Ke=d.get(ye);if(ye.isVideoTexture&&Qi(ye),ye.isRenderTargetTexture===!1&&ye.version>0&&Ke.__version!==ye.version){const Dt=ye.image;if(Dt===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(Dt.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Dn(Ke,ye,le);return}}c.bindTexture(y.TEXTURE_2D,Ke.__webglTexture,y.TEXTURE0+le)}function Tt(ye,le){const Ke=d.get(ye);if(ye.version>0&&Ke.__version!==ye.version){Dn(Ke,ye,le);return}c.bindTexture(y.TEXTURE_2D_ARRAY,Ke.__webglTexture,y.TEXTURE0+le)}function It(ye,le){const Ke=d.get(ye);if(ye.version>0&&Ke.__version!==ye.version){Dn(Ke,ye,le);return}c.bindTexture(y.TEXTURE_3D,Ke.__webglTexture,y.TEXTURE0+le)}function Pt(ye,le){const Ke=d.get(ye);if(ye.version>0&&Ke.__version!==ye.version){Vn(Ke,ye,le);return}c.bindTexture(y.TEXTURE_CUBE_MAP,Ke.__webglTexture,y.TEXTURE0+le)}const An={[ce]:y.REPEAT,[Qe]:y.CLAMP_TO_EDGE,[At]:y.MIRRORED_REPEAT},Hn={[pt]:y.NEAREST,[zt]:y.NEAREST_MIPMAP_NEAREST,[we]:y.NEAREST_MIPMAP_LINEAR,[bt]:y.LINEAR,[hn]:y.LINEAR_MIPMAP_NEAREST,[Ht]:y.LINEAR_MIPMAP_LINEAR};function Ne(ye,le,Ke){if(Ke?(y.texParameteri(ye,y.TEXTURE_WRAP_S,An[le.wrapS]),y.texParameteri(ye,y.TEXTURE_WRAP_T,An[le.wrapT]),(ye===y.TEXTURE_3D||ye===y.TEXTURE_2D_ARRAY)&&y.texParameteri(ye,y.TEXTURE_WRAP_R,An[le.wrapR]),y.texParameteri(ye,y.TEXTURE_MAG_FILTER,Hn[le.magFilter]),y.texParameteri(ye,y.TEXTURE_MIN_FILTER,Hn[le.minFilter])):(y.texParameteri(ye,y.TEXTURE_WRAP_S,y.CLAMP_TO_EDGE),y.texParameteri(ye,y.TEXTURE_WRAP_T,y.CLAMP_TO_EDGE),(ye===y.TEXTURE_3D||ye===y.TEXTURE_2D_ARRAY)&&y.texParameteri(ye,y.TEXTURE_WRAP_R,y.CLAMP_TO_EDGE),(le.wrapS!==Qe||le.wrapT!==Qe)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),y.texParameteri(ye,y.TEXTURE_MAG_FILTER,Se(le.magFilter)),y.texParameteri(ye,y.TEXTURE_MIN_FILTER,Se(le.minFilter)),le.minFilter!==pt&&le.minFilter!==bt&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),s.has("EXT_texture_filter_anisotropic")===!0){const Dt=s.get("EXT_texture_filter_anisotropic");if(le.type===wn&&s.has("OES_texture_float_linear")===!1||C===!1&&le.type===di&&s.has("OES_texture_half_float_linear")===!1)return;(le.anisotropy>1||d.get(le).__currentAnisotropy)&&(y.texParameterf(ye,Dt.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(le.anisotropy,p.getMaxAnisotropy())),d.get(le).__currentAnisotropy=le.anisotropy)}}function ai(ye,le){let Ke=!1;ye.__webglInit===void 0&&(ye.__webglInit=!0,le.addEventListener("dispose",et));const Dt=le.source;let Wt=G.get(Dt);Wt===void 0&&(Wt={},G.set(Dt,Wt));const an=We(le);if(an!==ye.__cacheKey){Wt[an]===void 0&&(Wt[an]={texture:y.createTexture(),usedTimes:0},x.memory.textures++,Ke=!0),Wt[an].usedTimes++;const zn=Wt[ye.__cacheKey];zn!==void 0&&(Wt[ye.__cacheKey].usedTimes--,zn.usedTimes===0&&Oe(le)),ye.__cacheKey=an,ye.__webglTexture=Wt[an].texture}return Ke}function Dn(ye,le,Ke){let Dt=y.TEXTURE_2D;le.isDataArrayTexture&&(Dt=y.TEXTURE_2D_ARRAY),le.isData3DTexture&&(Dt=y.TEXTURE_3D);const Wt=ai(ye,le),an=le.source;c.bindTexture(Dt,ye.__webglTexture,y.TEXTURE0+Ke);const zn=d.get(an);if(an.version!==zn.__version||Wt===!0){c.activeTexture(y.TEXTURE0+Ke),y.pixelStorei(y.UNPACK_FLIP_Y_WEBGL,le.flipY),y.pixelStorei(y.UNPACK_PREMULTIPLY_ALPHA_WEBGL,le.premultiplyAlpha),y.pixelStorei(y.UNPACK_ALIGNMENT,le.unpackAlignment),y.pixelStorei(y.UNPACK_COLORSPACE_CONVERSION_WEBGL,y.NONE);const cn=oe(le)&&te(le.image)===!1;let ft=ne(le.image,cn,!1,O);ft=Fi(le,ft);const Tn=te(ft)||C,Wn=_.convert(le.format,le.encoding);let Cn=_.convert(le.type),Nn=$(le.internalFormat,Wn,Cn,le.encoding,le.isVideoTexture);Ne(Dt,le,Tn);let ri;const Bi=le.mipmaps,Pe=C&&le.isVideoTexture!==!0,_n=zn.__version===void 0||Wt===!0,Qt=ge(le,ft,Tn);if(le.isDepthTexture)Nn=y.DEPTH_COMPONENT,C?le.type===wn?Nn=y.DEPTH_COMPONENT32F:le.type===Ct?Nn=y.DEPTH_COMPONENT24:le.type===vi?Nn=y.DEPTH24_STENCIL8:Nn=y.DEPTH_COMPONENT16:le.type===wn&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),le.format===mo&&Nn===y.DEPTH_COMPONENT&&le.type!==kt&&le.type!==Ct&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),le.type=Ct,Cn=_.convert(le.type)),le.format===Rr&&Nn===y.DEPTH_COMPONENT&&(Nn=y.DEPTH_STENCIL,le.type!==vi&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),le.type=vi,Cn=_.convert(le.type))),_n&&(Pe?c.texStorage2D(y.TEXTURE_2D,1,Nn,ft.width,ft.height):c.texImage2D(y.TEXTURE_2D,0,Nn,ft.width,ft.height,0,Wn,Cn,null));else if(le.isDataTexture)if(Bi.length>0&&Tn){Pe&&_n&&c.texStorage2D(y.TEXTURE_2D,Qt,Nn,Bi[0].width,Bi[0].height);for(let ht=0,Yt=Bi.length;ht<Yt;ht++)ri=Bi[ht],Pe?c.texSubImage2D(y.TEXTURE_2D,ht,0,0,ri.width,ri.height,Wn,Cn,ri.data):c.texImage2D(y.TEXTURE_2D,ht,Nn,ri.width,ri.height,0,Wn,Cn,ri.data);le.generateMipmaps=!1}else Pe?(_n&&c.texStorage2D(y.TEXTURE_2D,Qt,Nn,ft.width,ft.height),c.texSubImage2D(y.TEXTURE_2D,0,0,0,ft.width,ft.height,Wn,Cn,ft.data)):c.texImage2D(y.TEXTURE_2D,0,Nn,ft.width,ft.height,0,Wn,Cn,ft.data);else if(le.isCompressedTexture){Pe&&_n&&c.texStorage2D(y.TEXTURE_2D,Qt,Nn,Bi[0].width,Bi[0].height);for(let ht=0,Yt=Bi.length;ht<Yt;ht++)ri=Bi[ht],le.format!==ir?Wn!==null?Pe?c.compressedTexSubImage2D(y.TEXTURE_2D,ht,0,0,ri.width,ri.height,Wn,ri.data):c.compressedTexImage2D(y.TEXTURE_2D,ht,Nn,ri.width,ri.height,0,ri.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Pe?c.texSubImage2D(y.TEXTURE_2D,ht,0,0,ri.width,ri.height,Wn,Cn,ri.data):c.texImage2D(y.TEXTURE_2D,ht,Nn,ri.width,ri.height,0,Wn,Cn,ri.data)}else if(le.isDataArrayTexture)Pe?(_n&&c.texStorage3D(y.TEXTURE_2D_ARRAY,Qt,Nn,ft.width,ft.height,ft.depth),c.texSubImage3D(y.TEXTURE_2D_ARRAY,0,0,0,0,ft.width,ft.height,ft.depth,Wn,Cn,ft.data)):c.texImage3D(y.TEXTURE_2D_ARRAY,0,Nn,ft.width,ft.height,ft.depth,0,Wn,Cn,ft.data);else if(le.isData3DTexture)Pe?(_n&&c.texStorage3D(y.TEXTURE_3D,Qt,Nn,ft.width,ft.height,ft.depth),c.texSubImage3D(y.TEXTURE_3D,0,0,0,0,ft.width,ft.height,ft.depth,Wn,Cn,ft.data)):c.texImage3D(y.TEXTURE_3D,0,Nn,ft.width,ft.height,ft.depth,0,Wn,Cn,ft.data);else if(le.isFramebufferTexture){if(_n)if(Pe)c.texStorage2D(y.TEXTURE_2D,Qt,Nn,ft.width,ft.height);else{let ht=ft.width,Yt=ft.height;for(let Un=0;Un<Qt;Un++)c.texImage2D(y.TEXTURE_2D,Un,Nn,ht,Yt,0,Wn,Cn,null),ht>>=1,Yt>>=1}}else if(Bi.length>0&&Tn){Pe&&_n&&c.texStorage2D(y.TEXTURE_2D,Qt,Nn,Bi[0].width,Bi[0].height);for(let ht=0,Yt=Bi.length;ht<Yt;ht++)ri=Bi[ht],Pe?c.texSubImage2D(y.TEXTURE_2D,ht,0,0,Wn,Cn,ri):c.texImage2D(y.TEXTURE_2D,ht,Nn,Wn,Cn,ri);le.generateMipmaps=!1}else Pe?(_n&&c.texStorage2D(y.TEXTURE_2D,Qt,Nn,ft.width,ft.height),c.texSubImage2D(y.TEXTURE_2D,0,0,0,Wn,Cn,ft)):c.texImage2D(y.TEXTURE_2D,0,Nn,Wn,Cn,ft);ue(le,Tn)&&be(Dt),zn.__version=an.version,le.onUpdate&&le.onUpdate(le)}ye.__version=le.version}function Vn(ye,le,Ke){if(le.image.length!==6)return;const Dt=ai(ye,le),Wt=le.source;c.bindTexture(y.TEXTURE_CUBE_MAP,ye.__webglTexture,y.TEXTURE0+Ke);const an=d.get(Wt);if(Wt.version!==an.__version||Dt===!0){c.activeTexture(y.TEXTURE0+Ke),y.pixelStorei(y.UNPACK_FLIP_Y_WEBGL,le.flipY),y.pixelStorei(y.UNPACK_PREMULTIPLY_ALPHA_WEBGL,le.premultiplyAlpha),y.pixelStorei(y.UNPACK_ALIGNMENT,le.unpackAlignment),y.pixelStorei(y.UNPACK_COLORSPACE_CONVERSION_WEBGL,y.NONE);const zn=le.isCompressedTexture||le.image[0].isCompressedTexture,cn=le.image[0]&&le.image[0].isDataTexture,ft=[];for(let ht=0;ht<6;ht++)!zn&&!cn?ft[ht]=ne(le.image[ht],!1,!0,L):ft[ht]=cn?le.image[ht].image:le.image[ht],ft[ht]=Fi(le,ft[ht]);const Tn=ft[0],Wn=te(Tn)||C,Cn=_.convert(le.format,le.encoding),Nn=_.convert(le.type),ri=$(le.internalFormat,Cn,Nn,le.encoding),Bi=C&&le.isVideoTexture!==!0,Pe=an.__version===void 0||Dt===!0;let _n=ge(le,Tn,Wn);Ne(y.TEXTURE_CUBE_MAP,le,Wn);let Qt;if(zn){Bi&&Pe&&c.texStorage2D(y.TEXTURE_CUBE_MAP,_n,ri,Tn.width,Tn.height);for(let ht=0;ht<6;ht++){Qt=ft[ht].mipmaps;for(let Yt=0;Yt<Qt.length;Yt++){const Un=Qt[Yt];le.format!==ir?Cn!==null?Bi?c.compressedTexSubImage2D(y.TEXTURE_CUBE_MAP_POSITIVE_X+ht,Yt,0,0,Un.width,Un.height,Cn,Un.data):c.compressedTexImage2D(y.TEXTURE_CUBE_MAP_POSITIVE_X+ht,Yt,ri,Un.width,Un.height,0,Un.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Bi?c.texSubImage2D(y.TEXTURE_CUBE_MAP_POSITIVE_X+ht,Yt,0,0,Un.width,Un.height,Cn,Nn,Un.data):c.texImage2D(y.TEXTURE_CUBE_MAP_POSITIVE_X+ht,Yt,ri,Un.width,Un.height,0,Cn,Nn,Un.data)}}}else{Qt=le.mipmaps,Bi&&Pe&&(Qt.length>0&&_n++,c.texStorage2D(y.TEXTURE_CUBE_MAP,_n,ri,ft[0].width,ft[0].height));for(let ht=0;ht<6;ht++)if(cn){Bi?c.texSubImage2D(y.TEXTURE_CUBE_MAP_POSITIVE_X+ht,0,0,0,ft[ht].width,ft[ht].height,Cn,Nn,ft[ht].data):c.texImage2D(y.TEXTURE_CUBE_MAP_POSITIVE_X+ht,0,ri,ft[ht].width,ft[ht].height,0,Cn,Nn,ft[ht].data);for(let Yt=0;Yt<Qt.length;Yt++){const ji=Qt[Yt].image[ht].image;Bi?c.texSubImage2D(y.TEXTURE_CUBE_MAP_POSITIVE_X+ht,Yt+1,0,0,ji.width,ji.height,Cn,Nn,ji.data):c.texImage2D(y.TEXTURE_CUBE_MAP_POSITIVE_X+ht,Yt+1,ri,ji.width,ji.height,0,Cn,Nn,ji.data)}}else{Bi?c.texSubImage2D(y.TEXTURE_CUBE_MAP_POSITIVE_X+ht,0,0,0,Cn,Nn,ft[ht]):c.texImage2D(y.TEXTURE_CUBE_MAP_POSITIVE_X+ht,0,ri,Cn,Nn,ft[ht]);for(let Yt=0;Yt<Qt.length;Yt++){const Un=Qt[Yt];Bi?c.texSubImage2D(y.TEXTURE_CUBE_MAP_POSITIVE_X+ht,Yt+1,0,0,Cn,Nn,Un.image[ht]):c.texImage2D(y.TEXTURE_CUBE_MAP_POSITIVE_X+ht,Yt+1,ri,Cn,Nn,Un.image[ht])}}}ue(le,Wn)&&be(y.TEXTURE_CUBE_MAP),an.__version=Wt.version,le.onUpdate&&le.onUpdate(le)}ye.__version=le.version}function on(ye,le,Ke,Dt,Wt){const an=_.convert(Ke.format,Ke.encoding),zn=_.convert(Ke.type),cn=$(Ke.internalFormat,an,zn,Ke.encoding);d.get(le).__hasExternalTextures||(Wt===y.TEXTURE_3D||Wt===y.TEXTURE_2D_ARRAY?c.texImage3D(Wt,0,cn,le.width,le.height,le.depth,0,an,zn,null):c.texImage2D(Wt,0,cn,le.width,le.height,0,an,zn,null)),c.bindFramebuffer(y.FRAMEBUFFER,ye),Pn(le)?N.framebufferTexture2DMultisampleEXT(y.FRAMEBUFFER,Dt,Wt,d.get(Ke).__webglTexture,0,kn(le)):y.framebufferTexture2D(y.FRAMEBUFFER,Dt,Wt,d.get(Ke).__webglTexture,0),c.bindFramebuffer(y.FRAMEBUFFER,null)}function li(ye,le,Ke){if(y.bindRenderbuffer(y.RENDERBUFFER,ye),le.depthBuffer&&!le.stencilBuffer){let Dt=y.DEPTH_COMPONENT16;if(Ke||Pn(le)){const Wt=le.depthTexture;Wt&&Wt.isDepthTexture&&(Wt.type===wn?Dt=y.DEPTH_COMPONENT32F:Wt.type===Ct&&(Dt=y.DEPTH_COMPONENT24));const an=kn(le);Pn(le)?N.renderbufferStorageMultisampleEXT(y.RENDERBUFFER,an,Dt,le.width,le.height):y.renderbufferStorageMultisample(y.RENDERBUFFER,an,Dt,le.width,le.height)}else y.renderbufferStorage(y.RENDERBUFFER,Dt,le.width,le.height);y.framebufferRenderbuffer(y.FRAMEBUFFER,y.DEPTH_ATTACHMENT,y.RENDERBUFFER,ye)}else if(le.depthBuffer&&le.stencilBuffer){const Dt=kn(le);Ke&&Pn(le)===!1?y.renderbufferStorageMultisample(y.RENDERBUFFER,Dt,y.DEPTH24_STENCIL8,le.width,le.height):Pn(le)?N.renderbufferStorageMultisampleEXT(y.RENDERBUFFER,Dt,y.DEPTH24_STENCIL8,le.width,le.height):y.renderbufferStorage(y.RENDERBUFFER,y.DEPTH_STENCIL,le.width,le.height),y.framebufferRenderbuffer(y.FRAMEBUFFER,y.DEPTH_STENCIL_ATTACHMENT,y.RENDERBUFFER,ye)}else{const Dt=le.isWebGLMultipleRenderTargets===!0?le.texture:[le.texture];for(let Wt=0;Wt<Dt.length;Wt++){const an=Dt[Wt],zn=_.convert(an.format,an.encoding),cn=_.convert(an.type),ft=$(an.internalFormat,zn,cn,an.encoding),Tn=kn(le);Ke&&Pn(le)===!1?y.renderbufferStorageMultisample(y.RENDERBUFFER,Tn,ft,le.width,le.height):Pn(le)?N.renderbufferStorageMultisampleEXT(y.RENDERBUFFER,Tn,ft,le.width,le.height):y.renderbufferStorage(y.RENDERBUFFER,ft,le.width,le.height)}}y.bindRenderbuffer(y.RENDERBUFFER,null)}function dt(ye,le){if(le&&le.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(c.bindFramebuffer(y.FRAMEBUFFER,ye),!(le.depthTexture&&le.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!d.get(le.depthTexture).__webglTexture||le.depthTexture.image.width!==le.width||le.depthTexture.image.height!==le.height)&&(le.depthTexture.image.width=le.width,le.depthTexture.image.height=le.height,le.depthTexture.needsUpdate=!0),Je(le.depthTexture,0);const Dt=d.get(le.depthTexture).__webglTexture,Wt=kn(le);if(le.depthTexture.format===mo)Pn(le)?N.framebufferTexture2DMultisampleEXT(y.FRAMEBUFFER,y.DEPTH_ATTACHMENT,y.TEXTURE_2D,Dt,0,Wt):y.framebufferTexture2D(y.FRAMEBUFFER,y.DEPTH_ATTACHMENT,y.TEXTURE_2D,Dt,0);else if(le.depthTexture.format===Rr)Pn(le)?N.framebufferTexture2DMultisampleEXT(y.FRAMEBUFFER,y.DEPTH_STENCIL_ATTACHMENT,y.TEXTURE_2D,Dt,0,Wt):y.framebufferTexture2D(y.FRAMEBUFFER,y.DEPTH_STENCIL_ATTACHMENT,y.TEXTURE_2D,Dt,0);else throw new Error("Unknown depthTexture format")}function ct(ye){const le=d.get(ye),Ke=ye.isWebGLCubeRenderTarget===!0;if(ye.depthTexture&&!le.__autoAllocateDepthBuffer){if(Ke)throw new Error("target.depthTexture not supported in Cube render targets");dt(le.__webglFramebuffer,ye)}else if(Ke){le.__webglDepthbuffer=[];for(let Dt=0;Dt<6;Dt++)c.bindFramebuffer(y.FRAMEBUFFER,le.__webglFramebuffer[Dt]),le.__webglDepthbuffer[Dt]=y.createRenderbuffer(),li(le.__webglDepthbuffer[Dt],ye,!1)}else c.bindFramebuffer(y.FRAMEBUFFER,le.__webglFramebuffer),le.__webglDepthbuffer=y.createRenderbuffer(),li(le.__webglDepthbuffer,ye,!1);c.bindFramebuffer(y.FRAMEBUFFER,null)}function Ut(ye,le,Ke){const Dt=d.get(ye);le!==void 0&&on(Dt.__webglFramebuffer,ye,ye.texture,y.COLOR_ATTACHMENT0,y.TEXTURE_2D),Ke!==void 0&&ct(ye)}function bn(ye){const le=ye.texture,Ke=d.get(ye),Dt=d.get(le);ye.addEventListener("dispose",Mt),ye.isWebGLMultipleRenderTargets!==!0&&(Dt.__webglTexture===void 0&&(Dt.__webglTexture=y.createTexture()),Dt.__version=le.version,x.memory.textures++);const Wt=ye.isWebGLCubeRenderTarget===!0,an=ye.isWebGLMultipleRenderTargets===!0,zn=te(ye)||C;if(Wt){Ke.__webglFramebuffer=[];for(let cn=0;cn<6;cn++)Ke.__webglFramebuffer[cn]=y.createFramebuffer()}else{if(Ke.__webglFramebuffer=y.createFramebuffer(),an)if(p.drawBuffers){const cn=ye.texture;for(let ft=0,Tn=cn.length;ft<Tn;ft++){const Wn=d.get(cn[ft]);Wn.__webglTexture===void 0&&(Wn.__webglTexture=y.createTexture(),x.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(C&&ye.samples>0&&Pn(ye)===!1){const cn=an?le:[le];Ke.__webglMultisampledFramebuffer=y.createFramebuffer(),Ke.__webglColorRenderbuffer=[],c.bindFramebuffer(y.FRAMEBUFFER,Ke.__webglMultisampledFramebuffer);for(let ft=0;ft<cn.length;ft++){const Tn=cn[ft];Ke.__webglColorRenderbuffer[ft]=y.createRenderbuffer(),y.bindRenderbuffer(y.RENDERBUFFER,Ke.__webglColorRenderbuffer[ft]);const Wn=_.convert(Tn.format,Tn.encoding),Cn=_.convert(Tn.type),Nn=$(Tn.internalFormat,Wn,Cn,Tn.encoding,ye.isXRRenderTarget===!0),ri=kn(ye);y.renderbufferStorageMultisample(y.RENDERBUFFER,ri,Nn,ye.width,ye.height),y.framebufferRenderbuffer(y.FRAMEBUFFER,y.COLOR_ATTACHMENT0+ft,y.RENDERBUFFER,Ke.__webglColorRenderbuffer[ft])}y.bindRenderbuffer(y.RENDERBUFFER,null),ye.depthBuffer&&(Ke.__webglDepthRenderbuffer=y.createRenderbuffer(),li(Ke.__webglDepthRenderbuffer,ye,!0)),c.bindFramebuffer(y.FRAMEBUFFER,null)}}if(Wt){c.bindTexture(y.TEXTURE_CUBE_MAP,Dt.__webglTexture),Ne(y.TEXTURE_CUBE_MAP,le,zn);for(let cn=0;cn<6;cn++)on(Ke.__webglFramebuffer[cn],ye,le,y.COLOR_ATTACHMENT0,y.TEXTURE_CUBE_MAP_POSITIVE_X+cn);ue(le,zn)&&be(y.TEXTURE_CUBE_MAP),c.unbindTexture()}else if(an){const cn=ye.texture;for(let ft=0,Tn=cn.length;ft<Tn;ft++){const Wn=cn[ft],Cn=d.get(Wn);c.bindTexture(y.TEXTURE_2D,Cn.__webglTexture),Ne(y.TEXTURE_2D,Wn,zn),on(Ke.__webglFramebuffer,ye,Wn,y.COLOR_ATTACHMENT0+ft,y.TEXTURE_2D),ue(Wn,zn)&&be(y.TEXTURE_2D)}c.unbindTexture()}else{let cn=y.TEXTURE_2D;(ye.isWebGL3DRenderTarget||ye.isWebGLArrayRenderTarget)&&(C?cn=ye.isWebGL3DRenderTarget?y.TEXTURE_3D:y.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),c.bindTexture(cn,Dt.__webglTexture),Ne(cn,le,zn),on(Ke.__webglFramebuffer,ye,le,y.COLOR_ATTACHMENT0,cn),ue(le,zn)&&be(cn),c.unbindTexture()}ye.depthBuffer&&ct(ye)}function sn(ye){const le=te(ye)||C,Ke=ye.isWebGLMultipleRenderTargets===!0?ye.texture:[ye.texture];for(let Dt=0,Wt=Ke.length;Dt<Wt;Dt++){const an=Ke[Dt];if(ue(an,le)){const zn=ye.isWebGLCubeRenderTarget?y.TEXTURE_CUBE_MAP:y.TEXTURE_2D,cn=d.get(an).__webglTexture;c.bindTexture(zn,cn),be(zn),c.unbindTexture()}}}function ei(ye){if(C&&ye.samples>0&&Pn(ye)===!1){const le=ye.isWebGLMultipleRenderTargets?ye.texture:[ye.texture],Ke=ye.width,Dt=ye.height;let Wt=y.COLOR_BUFFER_BIT;const an=[],zn=ye.stencilBuffer?y.DEPTH_STENCIL_ATTACHMENT:y.DEPTH_ATTACHMENT,cn=d.get(ye),ft=ye.isWebGLMultipleRenderTargets===!0;if(ft)for(let Tn=0;Tn<le.length;Tn++)c.bindFramebuffer(y.FRAMEBUFFER,cn.__webglMultisampledFramebuffer),y.framebufferRenderbuffer(y.FRAMEBUFFER,y.COLOR_ATTACHMENT0+Tn,y.RENDERBUFFER,null),c.bindFramebuffer(y.FRAMEBUFFER,cn.__webglFramebuffer),y.framebufferTexture2D(y.DRAW_FRAMEBUFFER,y.COLOR_ATTACHMENT0+Tn,y.TEXTURE_2D,null,0);c.bindFramebuffer(y.READ_FRAMEBUFFER,cn.__webglMultisampledFramebuffer),c.bindFramebuffer(y.DRAW_FRAMEBUFFER,cn.__webglFramebuffer);for(let Tn=0;Tn<le.length;Tn++){an.push(y.COLOR_ATTACHMENT0+Tn),ye.depthBuffer&&an.push(zn);const Wn=cn.__ignoreDepthValues!==void 0?cn.__ignoreDepthValues:!1;if(Wn===!1&&(ye.depthBuffer&&(Wt|=y.DEPTH_BUFFER_BIT),ye.stencilBuffer&&(Wt|=y.STENCIL_BUFFER_BIT)),ft&&y.framebufferRenderbuffer(y.READ_FRAMEBUFFER,y.COLOR_ATTACHMENT0,y.RENDERBUFFER,cn.__webglColorRenderbuffer[Tn]),Wn===!0&&(y.invalidateFramebuffer(y.READ_FRAMEBUFFER,[zn]),y.invalidateFramebuffer(y.DRAW_FRAMEBUFFER,[zn])),ft){const Cn=d.get(le[Tn]).__webglTexture;y.framebufferTexture2D(y.DRAW_FRAMEBUFFER,y.COLOR_ATTACHMENT0,y.TEXTURE_2D,Cn,0)}y.blitFramebuffer(0,0,Ke,Dt,0,0,Ke,Dt,Wt,y.NEAREST),z&&y.invalidateFramebuffer(y.READ_FRAMEBUFFER,an)}if(c.bindFramebuffer(y.READ_FRAMEBUFFER,null),c.bindFramebuffer(y.DRAW_FRAMEBUFFER,null),ft)for(let Tn=0;Tn<le.length;Tn++){c.bindFramebuffer(y.FRAMEBUFFER,cn.__webglMultisampledFramebuffer),y.framebufferRenderbuffer(y.FRAMEBUFFER,y.COLOR_ATTACHMENT0+Tn,y.RENDERBUFFER,cn.__webglColorRenderbuffer[Tn]);const Wn=d.get(le[Tn]).__webglTexture;c.bindFramebuffer(y.FRAMEBUFFER,cn.__webglFramebuffer),y.framebufferTexture2D(y.DRAW_FRAMEBUFFER,y.COLOR_ATTACHMENT0+Tn,y.TEXTURE_2D,Wn,0)}c.bindFramebuffer(y.DRAW_FRAMEBUFFER,cn.__webglMultisampledFramebuffer)}}function kn(ye){return Math.min(k,ye.samples)}function Pn(ye){const le=d.get(ye);return C&&ye.samples>0&&s.has("WEBGL_multisampled_render_to_texture")===!0&&le.__useRenderToTexture!==!1}function Qi(ye){const le=x.render.frame;V.get(ye)!==le&&(V.set(ye,le),ye.update())}function Fi(ye,le){const Ke=ye.encoding,Dt=ye.format,Wt=ye.type;return ye.isCompressedTexture===!0||ye.isVideoTexture===!0||ye.format===oA||Ke!==jc&&(Ke===$i?C===!1?s.has("EXT_sRGB")===!0&&Dt===ir?(ye.format=oA,ye.minFilter=bt,ye.generateMipmaps=!1):le=qv.sRGBToLinear(le):(Dt!==ir||Wt!==Ln)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",Ke)),le}this.allocateTextureUnit=at,this.resetTextureUnits=Et,this.setTexture2D=Je,this.setTexture2DArray=Tt,this.setTexture3D=It,this.setTextureCube=Pt,this.rebindTextures=Ut,this.setupRenderTarget=bn,this.updateRenderTargetMipmap=sn,this.updateMultisampleRenderTarget=ei,this.setupDepthRenderbuffer=ct,this.setupFrameBufferTexture=on,this.useMultisampledRTT=Pn}function E1(y,s,c){const d=c.isWebGL2;function p(_,x=null){let C;if(_===Ln)return y.UNSIGNED_BYTE;if(_===Gi)return y.UNSIGNED_SHORT_4_4_4_4;if(_===jr)return y.UNSIGNED_SHORT_5_5_5_1;if(_===Ce)return y.BYTE;if(_===Rt)return y.SHORT;if(_===kt)return y.UNSIGNED_SHORT;if(_===Ie)return y.INT;if(_===Ct)return y.UNSIGNED_INT;if(_===wn)return y.FLOAT;if(_===di)return d?y.HALF_FLOAT:(C=s.get("OES_texture_half_float"),C!==null?C.HALF_FLOAT_OES:null);if(_===Ir)return y.ALPHA;if(_===ir)return y.RGBA;if(_===Ja)return y.LUMINANCE;if(_===fh)return y.LUMINANCE_ALPHA;if(_===mo)return y.DEPTH_COMPONENT;if(_===Rr)return y.DEPTH_STENCIL;if(_===Gu)return y.RED;if(_===js)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),y.RGBA;if(_===oA)return C=s.get("EXT_sRGB"),C!==null?C.SRGB_ALPHA_EXT:null;if(_===he)return y.RED_INTEGER;if(_===ze)return y.RG;if(_===Ue)return y.RG_INTEGER;if(_===ke)return y.RGBA_INTEGER;if(_===nt||_===j||_===ie||_===pe)if(x===$i)if(C=s.get("WEBGL_compressed_texture_s3tc_srgb"),C!==null){if(_===nt)return C.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(_===j)return C.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(_===ie)return C.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(_===pe)return C.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(C=s.get("WEBGL_compressed_texture_s3tc"),C!==null){if(_===nt)return C.COMPRESSED_RGB_S3TC_DXT1_EXT;if(_===j)return C.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(_===ie)return C.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(_===pe)return C.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(_===Ee||_===Ve||_===De||_===Ze)if(C=s.get("WEBGL_compressed_texture_pvrtc"),C!==null){if(_===Ee)return C.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(_===Ve)return C.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(_===De)return C.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(_===Ze)return C.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(_===lt)return C=s.get("WEBGL_compressed_texture_etc1"),C!==null?C.COMPRESSED_RGB_ETC1_WEBGL:null;if(_===St||_===ut)if(C=s.get("WEBGL_compressed_texture_etc"),C!==null){if(_===St)return x===$i?C.COMPRESSED_SRGB8_ETC2:C.COMPRESSED_RGB8_ETC2;if(_===ut)return x===$i?C.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:C.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(_===xt||_===Kt||_===wt||_===vn||_===fn||_===$t||_===un||_===Fn||_===Ci||_===Kn||_===Wi||_===fi||_===In||_===Li)if(C=s.get("WEBGL_compressed_texture_astc"),C!==null){if(_===xt)return x===$i?C.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:C.COMPRESSED_RGBA_ASTC_4x4_KHR;if(_===Kt)return x===$i?C.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:C.COMPRESSED_RGBA_ASTC_5x4_KHR;if(_===wt)return x===$i?C.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:C.COMPRESSED_RGBA_ASTC_5x5_KHR;if(_===vn)return x===$i?C.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:C.COMPRESSED_RGBA_ASTC_6x5_KHR;if(_===fn)return x===$i?C.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:C.COMPRESSED_RGBA_ASTC_6x6_KHR;if(_===$t)return x===$i?C.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:C.COMPRESSED_RGBA_ASTC_8x5_KHR;if(_===un)return x===$i?C.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:C.COMPRESSED_RGBA_ASTC_8x6_KHR;if(_===Fn)return x===$i?C.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:C.COMPRESSED_RGBA_ASTC_8x8_KHR;if(_===Ci)return x===$i?C.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:C.COMPRESSED_RGBA_ASTC_10x5_KHR;if(_===Kn)return x===$i?C.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:C.COMPRESSED_RGBA_ASTC_10x6_KHR;if(_===Wi)return x===$i?C.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:C.COMPRESSED_RGBA_ASTC_10x8_KHR;if(_===fi)return x===$i?C.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:C.COMPRESSED_RGBA_ASTC_10x10_KHR;if(_===In)return x===$i?C.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:C.COMPRESSED_RGBA_ASTC_12x10_KHR;if(_===Li)return x===$i?C.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:C.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(_===zs)if(C=s.get("EXT_texture_compression_bptc"),C!==null){if(_===zs)return x===$i?C.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:C.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;return _===vi?d?y.UNSIGNED_INT_24_8:(C=s.get("WEBGL_depth_texture"),C!==null?C.UNSIGNED_INT_24_8_WEBGL:null):y[_]!==void 0?y[_]:null}return{convert:p}}class C1 extends Xs{constructor(s=[]){super(),this.isArrayCamera=!0,this.cameras=s}}class cd extends wi{constructor(){super(),this.isGroup=!0,this.type="Group"}}const xG={type:"move"};class bx{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new cd,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new cd,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new de,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new de),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new cd,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new de,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new de),this._grip}dispatchEvent(s){return this._targetRay!==null&&this._targetRay.dispatchEvent(s),this._grip!==null&&this._grip.dispatchEvent(s),this._hand!==null&&this._hand.dispatchEvent(s),this}disconnect(s){return this.dispatchEvent({type:"disconnected",data:s}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(s,c,d){let p=null,_=null,x=null;const C=this._targetRay,P=this._grip,L=this._hand;if(s&&c.session.visibilityState!=="visible-blurred"){if(L&&s.hand){x=!0;for(const H of s.hand.values()){const G=c.getJointPose(H,d);if(L.joints[H.jointName]===void 0){const Z=new cd;Z.matrixAutoUpdate=!1,Z.visible=!1,L.joints[H.jointName]=Z,L.add(Z)}const X=L.joints[H.jointName];G!==null&&(X.matrix.fromArray(G.transform.matrix),X.matrix.decompose(X.position,X.rotation,X.scale),X.jointRadius=G.radius),X.visible=G!==null}const O=L.joints["index-finger-tip"],k=L.joints["thumb-tip"],N=O.position.distanceTo(k.position),z=.02,V=.005;L.inputState.pinching&&N>z+V?(L.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:s.handedness,target:this})):!L.inputState.pinching&&N<=z-V&&(L.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:s.handedness,target:this}))}else P!==null&&s.gripSpace&&(_=c.getPose(s.gripSpace,d),_!==null&&(P.matrix.fromArray(_.transform.matrix),P.matrix.decompose(P.position,P.rotation,P.scale),_.linearVelocity?(P.hasLinearVelocity=!0,P.linearVelocity.copy(_.linearVelocity)):P.hasLinearVelocity=!1,_.angularVelocity?(P.hasAngularVelocity=!0,P.angularVelocity.copy(_.angularVelocity)):P.hasAngularVelocity=!1));C!==null&&(p=c.getPose(s.targetRaySpace,d),p===null&&_!==null&&(p=_),p!==null&&(C.matrix.fromArray(p.transform.matrix),C.matrix.decompose(C.position,C.rotation,C.scale),p.linearVelocity?(C.hasLinearVelocity=!0,C.linearVelocity.copy(p.linearVelocity)):C.hasLinearVelocity=!1,p.angularVelocity?(C.hasAngularVelocity=!0,C.angularVelocity.copy(p.angularVelocity)):C.hasAngularVelocity=!1,this.dispatchEvent(xG)))}return C!==null&&(C.visible=p!==null),P!==null&&(P.visible=_!==null),L!==null&&(L.visible=x!==null),this}}class S1 extends Ps{constructor(s,c,d,p,_,x,C,P,L,O){if(O=O!==void 0?O:mo,O!==mo&&O!==Rr)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");d===void 0&&O===mo&&(d=Ct),d===void 0&&O===Rr&&(d=vi),super(null,p,_,x,C,P,O,d,L),this.isDepthTexture=!0,this.image={width:s,height:c},this.magFilter=C!==void 0?C:pt,this.minFilter=P!==void 0?P:pt,this.flipY=!1,this.generateMipmaps=!1}}class wG extends Za{constructor(s,c){super();const d=this;let p=null,_=1,x=null,C="local-floor",P=null,L=null,O=null,k=null,N=null,z=null;const V=c.getContextAttributes();let H=null,G=null;const X=[],Z=[],ne=new Xs;ne.layers.enable(1),ne.viewport=new Ri;const te=new Xs;te.layers.enable(2),te.viewport=new Ri;const oe=[ne,te],ue=new C1;ue.layers.enable(1),ue.layers.enable(2);let be=null,$=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(We){let Je=X[We];return Je===void 0&&(Je=new bx,X[We]=Je),Je.getTargetRaySpace()},this.getControllerGrip=function(We){let Je=X[We];return Je===void 0&&(Je=new bx,X[We]=Je),Je.getGripSpace()},this.getHand=function(We){let Je=X[We];return Je===void 0&&(Je=new bx,X[We]=Je),Je.getHandSpace()};function ge(We){const Je=Z.indexOf(We.inputSource);if(Je===-1)return;const Tt=X[Je];Tt!==void 0&&Tt.dispatchEvent({type:We.type,data:We.inputSource})}function Se(){p.removeEventListener("select",ge),p.removeEventListener("selectstart",ge),p.removeEventListener("selectend",ge),p.removeEventListener("squeeze",ge),p.removeEventListener("squeezestart",ge),p.removeEventListener("squeezeend",ge),p.removeEventListener("end",Se),p.removeEventListener("inputsourceschange",et);for(let We=0;We<X.length;We++){const Je=Z[We];Je!==null&&(Z[We]=null,X[We].disconnect(Je))}be=null,$=null,s.setRenderTarget(H),N=null,k=null,O=null,p=null,G=null,at.stop(),d.isPresenting=!1,d.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(We){_=We,d.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(We){C=We,d.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return P||x},this.setReferenceSpace=function(We){P=We},this.getBaseLayer=function(){return k!==null?k:N},this.getBinding=function(){return O},this.getFrame=function(){return z},this.getSession=function(){return p},this.setSession=async function(We){if(p=We,p!==null){if(H=s.getRenderTarget(),p.addEventListener("select",ge),p.addEventListener("selectstart",ge),p.addEventListener("selectend",ge),p.addEventListener("squeeze",ge),p.addEventListener("squeezestart",ge),p.addEventListener("squeezeend",ge),p.addEventListener("end",Se),p.addEventListener("inputsourceschange",et),V.xrCompatible!==!0&&await c.makeXRCompatible(),p.renderState.layers===void 0||s.capabilities.isWebGL2===!1){const Je={antialias:p.renderState.layers===void 0?V.antialias:!0,alpha:V.alpha,depth:V.depth,stencil:V.stencil,framebufferScaleFactor:_};N=new XRWebGLLayer(p,c,Je),p.updateRenderState({baseLayer:N}),G=new _o(N.framebufferWidth,N.framebufferHeight,{format:ir,type:Ln,encoding:s.outputEncoding,stencilBuffer:V.stencil})}else{let Je=null,Tt=null,It=null;V.depth&&(It=V.stencil?c.DEPTH24_STENCIL8:c.DEPTH_COMPONENT24,Je=V.stencil?Rr:mo,Tt=V.stencil?vi:Ct);const Pt={colorFormat:c.RGBA8,depthFormat:It,scaleFactor:_};O=new XRWebGLBinding(p,c),k=O.createProjectionLayer(Pt),p.updateRenderState({layers:[k]}),G=new _o(k.textureWidth,k.textureHeight,{format:ir,type:Ln,depthTexture:new S1(k.textureWidth,k.textureHeight,Tt,void 0,void 0,void 0,void 0,void 0,void 0,Je),stencilBuffer:V.stencil,encoding:s.outputEncoding,samples:V.antialias?4:0});const An=s.properties.get(G);An.__ignoreDepthValues=k.ignoreDepthValues}G.isXRRenderTarget=!0,this.setFoveation(1),P=null,x=await p.requestReferenceSpace(C),at.setContext(p),at.start(),d.isPresenting=!0,d.dispatchEvent({type:"sessionstart"})}};function et(We){for(let Je=0;Je<We.removed.length;Je++){const Tt=We.removed[Je],It=Z.indexOf(Tt);It>=0&&(Z[It]=null,X[It].dispatchEvent({type:"disconnected",data:Tt}))}for(let Je=0;Je<We.added.length;Je++){const Tt=We.added[Je];let It=Z.indexOf(Tt);if(It===-1){for(let An=0;An<X.length;An++)if(An>=Z.length){Z.push(Tt),It=An;break}else if(Z[An]===null){Z[An]=Tt,It=An;break}if(It===-1)break}const Pt=X[It];Pt&&Pt.dispatchEvent({type:"connected",data:Tt})}}const Mt=new de,Ye=new de;function Oe(We,Je,Tt){Mt.setFromMatrixPosition(Je.matrixWorld),Ye.setFromMatrixPosition(Tt.matrixWorld);const It=Mt.distanceTo(Ye),Pt=Je.projectionMatrix.elements,An=Tt.projectionMatrix.elements,Hn=Pt[14]/(Pt[10]-1),Ne=Pt[14]/(Pt[10]+1),ai=(Pt[9]+1)/Pt[5],Dn=(Pt[9]-1)/Pt[5],Vn=(Pt[8]-1)/Pt[0],on=(An[8]+1)/An[0],li=Hn*Vn,dt=Hn*on,ct=It/(-Vn+on),Ut=ct*-Vn;Je.matrixWorld.decompose(We.position,We.quaternion,We.scale),We.translateX(Ut),We.translateZ(ct),We.matrixWorld.compose(We.position,We.quaternion,We.scale),We.matrixWorldInverse.copy(We.matrixWorld).invert();const bn=Hn+ct,sn=Ne+ct,ei=li-Ut,kn=dt+(It-Ut),Pn=ai*Ne/sn*bn,Qi=Dn*Ne/sn*bn;We.projectionMatrix.makePerspective(ei,kn,Pn,Qi,bn,sn)}function rt(We,Je){Je===null?We.matrixWorld.copy(We.matrix):We.matrixWorld.multiplyMatrices(Je.matrixWorld,We.matrix),We.matrixWorldInverse.copy(We.matrixWorld).invert()}this.updateCamera=function(We){if(p===null)return;ue.near=te.near=ne.near=We.near,ue.far=te.far=ne.far=We.far,(be!==ue.near||$!==ue.far)&&(p.updateRenderState({depthNear:ue.near,depthFar:ue.far}),be=ue.near,$=ue.far);const Je=We.parent,Tt=ue.cameras;rt(ue,Je);for(let Pt=0;Pt<Tt.length;Pt++)rt(Tt[Pt],Je);ue.matrixWorld.decompose(ue.position,ue.quaternion,ue.scale),We.matrix.copy(ue.matrix),We.matrix.decompose(We.position,We.quaternion,We.scale);const It=We.children;for(let Pt=0,An=It.length;Pt<An;Pt++)It[Pt].updateMatrixWorld(!0);Tt.length===2?Oe(ue,ne,te):ue.projectionMatrix.copy(ne.projectionMatrix)},this.getCamera=function(){return ue},this.getFoveation=function(){if(k!==null)return k.fixedFoveation;if(N!==null)return N.fixedFoveation},this.setFoveation=function(We){k!==null&&(k.fixedFoveation=We),N!==null&&N.fixedFoveation!==void 0&&(N.fixedFoveation=We)};let gt=null;function Et(We,Je){if(L=Je.getViewerPose(P||x),z=Je,L!==null){const Tt=L.views;N!==null&&(s.setRenderTargetFramebuffer(G,N.framebuffer),s.setRenderTarget(G));let It=!1;Tt.length!==ue.cameras.length&&(ue.cameras.length=0,It=!0);for(let Pt=0;Pt<Tt.length;Pt++){const An=Tt[Pt];let Hn=null;if(N!==null)Hn=N.getViewport(An);else{const ai=O.getViewSubImage(k,An);Hn=ai.viewport,Pt===0&&(s.setRenderTargetTextures(G,ai.colorTexture,k.ignoreDepthValues?void 0:ai.depthStencilTexture),s.setRenderTarget(G))}let Ne=oe[Pt];Ne===void 0&&(Ne=new Xs,Ne.layers.enable(Pt),Ne.viewport=new Ri,oe[Pt]=Ne),Ne.matrix.fromArray(An.transform.matrix),Ne.projectionMatrix.fromArray(An.projectionMatrix),Ne.viewport.set(Hn.x,Hn.y,Hn.width,Hn.height),Pt===0&&ue.matrix.copy(Ne.matrix),It===!0&&ue.cameras.push(Ne)}}for(let Tt=0;Tt<X.length;Tt++){const It=Z[Tt],Pt=X[Tt];It!==null&&Pt!==void 0&&Pt.update(It,Je,P||x)}gt&&gt(We,Je),z=null}const at=new KM;at.setAnimationLoop(Et),this.setAnimationLoop=function(We){gt=We},this.dispose=function(){}}}function bG(y,s){function c(H,G){H.fogColor.value.copy(G.color),G.isFog?(H.fogNear.value=G.near,H.fogFar.value=G.far):G.isFogExp2&&(H.fogDensity.value=G.density)}function d(H,G,X,Z,ne){G.isMeshBasicMaterial||G.isMeshLambertMaterial?p(H,G):G.isMeshToonMaterial?(p(H,G),O(H,G)):G.isMeshPhongMaterial?(p(H,G),L(H,G)):G.isMeshStandardMaterial?(p(H,G),k(H,G),G.isMeshPhysicalMaterial&&N(H,G,ne)):G.isMeshMatcapMaterial?(p(H,G),z(H,G)):G.isMeshDepthMaterial?p(H,G):G.isMeshDistanceMaterial?(p(H,G),V(H,G)):G.isMeshNormalMaterial?p(H,G):G.isLineBasicMaterial?(_(H,G),G.isLineDashedMaterial&&x(H,G)):G.isPointsMaterial?C(H,G,X,Z):G.isSpriteMaterial?P(H,G):G.isShadowMaterial?(H.color.value.copy(G.color),H.opacity.value=G.opacity):G.isShaderMaterial&&(G.uniformsNeedUpdate=!1)}function p(H,G){H.opacity.value=G.opacity,G.color&&H.diffuse.value.copy(G.color),G.emissive&&H.emissive.value.copy(G.emissive).multiplyScalar(G.emissiveIntensity),G.map&&(H.map.value=G.map),G.alphaMap&&(H.alphaMap.value=G.alphaMap),G.bumpMap&&(H.bumpMap.value=G.bumpMap,H.bumpScale.value=G.bumpScale,G.side===m&&(H.bumpScale.value*=-1)),G.displacementMap&&(H.displacementMap.value=G.displacementMap,H.displacementScale.value=G.displacementScale,H.displacementBias.value=G.displacementBias),G.emissiveMap&&(H.emissiveMap.value=G.emissiveMap),G.normalMap&&(H.normalMap.value=G.normalMap,H.normalScale.value.copy(G.normalScale),G.side===m&&H.normalScale.value.negate()),G.specularMap&&(H.specularMap.value=G.specularMap),G.alphaTest>0&&(H.alphaTest.value=G.alphaTest);const X=s.get(G).envMap;if(X&&(H.envMap.value=X,H.flipEnvMap.value=X.isCubeTexture&&X.isRenderTargetTexture===!1?-1:1,H.reflectivity.value=G.reflectivity,H.ior.value=G.ior,H.refractionRatio.value=G.refractionRatio),G.lightMap){H.lightMap.value=G.lightMap;const te=y.physicallyCorrectLights!==!0?Math.PI:1;H.lightMapIntensity.value=G.lightMapIntensity*te}G.aoMap&&(H.aoMap.value=G.aoMap,H.aoMapIntensity.value=G.aoMapIntensity);let Z;G.map?Z=G.map:G.specularMap?Z=G.specularMap:G.displacementMap?Z=G.displacementMap:G.normalMap?Z=G.normalMap:G.bumpMap?Z=G.bumpMap:G.roughnessMap?Z=G.roughnessMap:G.metalnessMap?Z=G.metalnessMap:G.alphaMap?Z=G.alphaMap:G.emissiveMap?Z=G.emissiveMap:G.clearcoatMap?Z=G.clearcoatMap:G.clearcoatNormalMap?Z=G.clearcoatNormalMap:G.clearcoatRoughnessMap?Z=G.clearcoatRoughnessMap:G.iridescenceMap?Z=G.iridescenceMap:G.iridescenceThicknessMap?Z=G.iridescenceThicknessMap:G.specularIntensityMap?Z=G.specularIntensityMap:G.specularColorMap?Z=G.specularColorMap:G.transmissionMap?Z=G.transmissionMap:G.thicknessMap?Z=G.thicknessMap:G.sheenColorMap?Z=G.sheenColorMap:G.sheenRoughnessMap&&(Z=G.sheenRoughnessMap),Z!==void 0&&(Z.isWebGLRenderTarget&&(Z=Z.texture),Z.matrixAutoUpdate===!0&&Z.updateMatrix(),H.uvTransform.value.copy(Z.matrix));let ne;G.aoMap?ne=G.aoMap:G.lightMap&&(ne=G.lightMap),ne!==void 0&&(ne.isWebGLRenderTarget&&(ne=ne.texture),ne.matrixAutoUpdate===!0&&ne.updateMatrix(),H.uv2Transform.value.copy(ne.matrix))}function _(H,G){H.diffuse.value.copy(G.color),H.opacity.value=G.opacity}function x(H,G){H.dashSize.value=G.dashSize,H.totalSize.value=G.dashSize+G.gapSize,H.scale.value=G.scale}function C(H,G,X,Z){H.diffuse.value.copy(G.color),H.opacity.value=G.opacity,H.size.value=G.size*X,H.scale.value=Z*.5,G.map&&(H.map.value=G.map),G.alphaMap&&(H.alphaMap.value=G.alphaMap),G.alphaTest>0&&(H.alphaTest.value=G.alphaTest);let ne;G.map?ne=G.map:G.alphaMap&&(ne=G.alphaMap),ne!==void 0&&(ne.matrixAutoUpdate===!0&&ne.updateMatrix(),H.uvTransform.value.copy(ne.matrix))}function P(H,G){H.diffuse.value.copy(G.color),H.opacity.value=G.opacity,H.rotation.value=G.rotation,G.map&&(H.map.value=G.map),G.alphaMap&&(H.alphaMap.value=G.alphaMap),G.alphaTest>0&&(H.alphaTest.value=G.alphaTest);let X;G.map?X=G.map:G.alphaMap&&(X=G.alphaMap),X!==void 0&&(X.matrixAutoUpdate===!0&&X.updateMatrix(),H.uvTransform.value.copy(X.matrix))}function L(H,G){H.specular.value.copy(G.specular),H.shininess.value=Math.max(G.shininess,1e-4)}function O(H,G){G.gradientMap&&(H.gradientMap.value=G.gradientMap)}function k(H,G){H.roughness.value=G.roughness,H.metalness.value=G.metalness,G.roughnessMap&&(H.roughnessMap.value=G.roughnessMap),G.metalnessMap&&(H.metalnessMap.value=G.metalnessMap),s.get(G).envMap&&(H.envMapIntensity.value=G.envMapIntensity)}function N(H,G,X){H.ior.value=G.ior,G.sheen>0&&(H.sheenColor.value.copy(G.sheenColor).multiplyScalar(G.sheen),H.sheenRoughness.value=G.sheenRoughness,G.sheenColorMap&&(H.sheenColorMap.value=G.sheenColorMap),G.sheenRoughnessMap&&(H.sheenRoughnessMap.value=G.sheenRoughnessMap)),G.clearcoat>0&&(H.clearcoat.value=G.clearcoat,H.clearcoatRoughness.value=G.clearcoatRoughness,G.clearcoatMap&&(H.clearcoatMap.value=G.clearcoatMap),G.clearcoatRoughnessMap&&(H.clearcoatRoughnessMap.value=G.clearcoatRoughnessMap),G.clearcoatNormalMap&&(H.clearcoatNormalScale.value.copy(G.clearcoatNormalScale),H.clearcoatNormalMap.value=G.clearcoatNormalMap,G.side===m&&H.clearcoatNormalScale.value.negate())),G.iridescence>0&&(H.iridescence.value=G.iridescence,H.iridescenceIOR.value=G.iridescenceIOR,H.iridescenceThicknessMinimum.value=G.iridescenceThicknessRange[0],H.iridescenceThicknessMaximum.value=G.iridescenceThicknessRange[1],G.iridescenceMap&&(H.iridescenceMap.value=G.iridescenceMap),G.iridescenceThicknessMap&&(H.iridescenceThicknessMap.value=G.iridescenceThicknessMap)),G.transmission>0&&(H.transmission.value=G.transmission,H.transmissionSamplerMap.value=X.texture,H.transmissionSamplerSize.value.set(X.width,X.height),G.transmissionMap&&(H.transmissionMap.value=G.transmissionMap),H.thickness.value=G.thickness,G.thicknessMap&&(H.thicknessMap.value=G.thicknessMap),H.attenuationDistance.value=G.attenuationDistance,H.attenuationColor.value.copy(G.attenuationColor)),H.specularIntensity.value=G.specularIntensity,H.specularColor.value.copy(G.specularColor),G.specularIntensityMap&&(H.specularIntensityMap.value=G.specularIntensityMap),G.specularColorMap&&(H.specularColorMap.value=G.specularColorMap)}function z(H,G){G.matcap&&(H.matcap.value=G.matcap)}function V(H,G){H.referencePosition.value.copy(G.referencePosition),H.nearDistance.value=G.nearDistance,H.farDistance.value=G.farDistance}return{refreshFogUniforms:c,refreshMaterialUniforms:d}}function EG(y,s,c,d){let p={},_={},x=[];const C=c.isWebGL2?y.getParameter(y.MAX_UNIFORM_BUFFER_BINDINGS):0;function P(Z,ne){const te=ne.program;d.uniformBlockBinding(Z,te)}function L(Z,ne){let te=p[Z.id];te===void 0&&(V(Z),te=O(Z),p[Z.id]=te,Z.addEventListener("dispose",G));const oe=ne.program;d.updateUBOMapping(Z,oe);const ue=s.render.frame;_[Z.id]!==ue&&(N(Z),_[Z.id]=ue)}function O(Z){const ne=k();Z.__bindingPointIndex=ne;const te=y.createBuffer(),oe=Z.__size,ue=Z.usage;return y.bindBuffer(y.UNIFORM_BUFFER,te),y.bufferData(y.UNIFORM_BUFFER,oe,ue),y.bindBuffer(y.UNIFORM_BUFFER,null),y.bindBufferBase(y.UNIFORM_BUFFER,ne,te),te}function k(){for(let Z=0;Z<C;Z++)if(x.indexOf(Z)===-1)return x.push(Z),Z;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function N(Z){const ne=p[Z.id],te=Z.uniforms,oe=Z.__cache;y.bindBuffer(y.UNIFORM_BUFFER,ne);for(let ue=0,be=te.length;ue<be;ue++){const $=te[ue];if(z($,ue,oe)===!0){const ge=$.value,Se=$.__offset;typeof ge=="number"?($.__data[0]=ge,y.bufferSubData(y.UNIFORM_BUFFER,Se,$.__data)):($.value.isMatrix3?($.__data[0]=$.value.elements[0],$.__data[1]=$.value.elements[1],$.__data[2]=$.value.elements[2],$.__data[3]=$.value.elements[0],$.__data[4]=$.value.elements[3],$.__data[5]=$.value.elements[4],$.__data[6]=$.value.elements[5],$.__data[7]=$.value.elements[0],$.__data[8]=$.value.elements[6],$.__data[9]=$.value.elements[7],$.__data[10]=$.value.elements[8],$.__data[11]=$.value.elements[0]):ge.toArray($.__data),y.bufferSubData(y.UNIFORM_BUFFER,Se,$.__data))}}y.bindBuffer(y.UNIFORM_BUFFER,null)}function z(Z,ne,te){const oe=Z.value;if(te[ne]===void 0)return typeof oe=="number"?te[ne]=oe:te[ne]=oe.clone(),!0;if(typeof oe=="number"){if(te[ne]!==oe)return te[ne]=oe,!0}else{const ue=te[ne];if(ue.equals(oe)===!1)return ue.copy(oe),!0}return!1}function V(Z){const ne=Z.uniforms;let te=0;const oe=16;let ue=0;for(let be=0,$=ne.length;be<$;be++){const ge=ne[be],Se=H(ge);if(ge.__data=new Float32Array(Se.storage/Float32Array.BYTES_PER_ELEMENT),ge.__offset=te,be>0){ue=te%oe;const et=oe-ue;ue!==0&&et-Se.boundary<0&&(te+=oe-ue,ge.__offset=te)}te+=Se.storage}return ue=te%oe,ue>0&&(te+=oe-ue),Z.__size=te,Z.__cache={},this}function H(Z){const ne=Z.value,te={boundary:0,storage:0};return typeof ne=="number"?(te.boundary=4,te.storage=4):ne.isVector2?(te.boundary=8,te.storage=8):ne.isVector3||ne.isColor?(te.boundary=16,te.storage=12):ne.isVector4?(te.boundary=16,te.storage=16):ne.isMatrix3?(te.boundary=48,te.storage=48):ne.isMatrix4?(te.boundary=64,te.storage=64):ne.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",ne),te}function G(Z){const ne=Z.target;ne.removeEventListener("dispose",G);const te=x.indexOf(ne.__bindingPointIndex);x.splice(te,1),y.deleteBuffer(p[ne.id]),delete p[ne.id],delete _[ne.id]}function X(){for(const Z in p)y.deleteBuffer(p[Z]);x=[],p={},_={}}return{bind:P,update:L,dispose:X}}function CG(){const y=ap("canvas");return y.style.display="block",y}function M1(y={}){this.isWebGLRenderer=!0;const s=y.canvas!==void 0?y.canvas:CG(),c=y.context!==void 0?y.context:null,d=y.depth!==void 0?y.depth:!0,p=y.stencil!==void 0?y.stencil:!0,_=y.antialias!==void 0?y.antialias:!1,x=y.premultipliedAlpha!==void 0?y.premultipliedAlpha:!0,C=y.preserveDrawingBuffer!==void 0?y.preserveDrawingBuffer:!1,P=y.powerPreference!==void 0?y.powerPreference:"default",L=y.failIfMajorPerformanceCaveat!==void 0?y.failIfMajorPerformanceCaveat:!1;let O;c!==null?O=c.getContextAttributes().alpha:O=y.alpha!==void 0?y.alpha:!1;let k=null,N=null;const z=[],V=[];this.domElement=s,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=jc,this.physicallyCorrectLights=!1,this.toneMapping=yn,this.toneMappingExposure=1,Object.defineProperties(this,{gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}});const H=this;let G=!1,X=0,Z=0,ne=null,te=-1,oe=null;const ue=new Ri,be=new Ri;let $=null,ge=s.width,Se=s.height,et=1,Mt=null,Ye=null;const Oe=new Ri(0,0,ge,Se),rt=new Ri(0,0,ge,Se);let gt=!1;const Et=new PA;let at=!1,We=!1,Je=null;const Tt=new $n,It=new mt,Pt=new de,An={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Hn(){return ne===null?et:1}let Ne=c;function ai(fe,qe){for(let st=0;st<fe.length;st++){const Ge=fe[st],ot=s.getContext(Ge,qe);if(ot!==null)return ot}return null}try{const fe={alpha:!0,depth:d,stencil:p,antialias:_,premultipliedAlpha:x,preserveDrawingBuffer:C,powerPreference:P,failIfMajorPerformanceCaveat:L};if("setAttribute"in s&&s.setAttribute("data-engine",`three.js r${a}`),s.addEventListener("webglcontextlost",Nn,!1),s.addEventListener("webglcontextrestored",ri,!1),s.addEventListener("webglcontextcreationerror",Bi,!1),Ne===null){const qe=["webgl2","webgl","experimental-webgl"];if(H.isWebGL1Renderer===!0&&qe.shift(),Ne=ai(qe,fe),Ne===null)throw ai(qe)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}Ne.getShaderPrecisionFormat===void 0&&(Ne.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(fe){throw console.error("THREE.WebGLRenderer: "+fe.message),fe}let Dn,Vn,on,li,dt,ct,Ut,bn,sn,ei,kn,Pn,Qi,Fi,ye,le,Ke,Dt,Wt,an,zn,cn,ft,Tn;function Wn(){Dn=new GU(Ne),Vn=new OU(Ne,Dn,y),Dn.init(Vn),cn=new E1(Ne,Dn,Vn),on=new yG(Ne,Dn,Vn),li=new WU(Ne),dt=new aG,ct=new vG(Ne,Dn,on,dt,Vn,cn,li),Ut=new kU(H),bn=new zU(H),sn=new Lk(Ne,Vn),ft=new LU(Ne,Dn,sn,Vn),ei=new HU(Ne,sn,li,ft),kn=new XU(Ne,ei,sn,li),Wt=new qU(Ne,Vn,ct),le=new FU(dt),Pn=new oG(H,Ut,bn,Dn,Vn,ft,le),Qi=new bG(H,dt),Fi=new lG,ye=new mG(Dn,Vn),Dt=new BU(H,Ut,on,kn,O,x),Ke=new _G(H,kn,Vn),Tn=new EG(Ne,li,Vn,on),an=new DU(Ne,Dn,li,Vn),zn=new VU(Ne,Dn,li,Vn),li.programs=Pn.programs,H.capabilities=Vn,H.extensions=Dn,H.properties=dt,H.renderLists=Fi,H.shadowMap=Ke,H.state=on,H.info=li}Wn();const Cn=new wG(H,Ne);this.xr=Cn,this.getContext=function(){return Ne},this.getContextAttributes=function(){return Ne.getContextAttributes()},this.forceContextLoss=function(){const fe=Dn.get("WEBGL_lose_context");fe&&fe.loseContext()},this.forceContextRestore=function(){const fe=Dn.get("WEBGL_lose_context");fe&&fe.restoreContext()},this.getPixelRatio=function(){return et},this.setPixelRatio=function(fe){fe!==void 0&&(et=fe,this.setSize(ge,Se,!1))},this.getSize=function(fe){return fe.set(ge,Se)},this.setSize=function(fe,qe,st){if(Cn.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}ge=fe,Se=qe,s.width=Math.floor(fe*et),s.height=Math.floor(qe*et),st!==!1&&(s.style.width=fe+"px",s.style.height=qe+"px"),this.setViewport(0,0,fe,qe)},this.getDrawingBufferSize=function(fe){return fe.set(ge*et,Se*et).floor()},this.setDrawingBufferSize=function(fe,qe,st){ge=fe,Se=qe,et=st,s.width=Math.floor(fe*st),s.height=Math.floor(qe*st),this.setViewport(0,0,fe,qe)},this.getCurrentViewport=function(fe){return fe.copy(ue)},this.getViewport=function(fe){return fe.copy(Oe)},this.setViewport=function(fe,qe,st,Ge){fe.isVector4?Oe.set(fe.x,fe.y,fe.z,fe.w):Oe.set(fe,qe,st,Ge),on.viewport(ue.copy(Oe).multiplyScalar(et).floor())},this.getScissor=function(fe){return fe.copy(rt)},this.setScissor=function(fe,qe,st,Ge){fe.isVector4?rt.set(fe.x,fe.y,fe.z,fe.w):rt.set(fe,qe,st,Ge),on.scissor(be.copy(rt).multiplyScalar(et).floor())},this.getScissorTest=function(){return gt},this.setScissorTest=function(fe){on.setScissorTest(gt=fe)},this.setOpaqueSort=function(fe){Mt=fe},this.setTransparentSort=function(fe){Ye=fe},this.getClearColor=function(fe){return fe.copy(Dt.getClearColor())},this.setClearColor=function(){Dt.setClearColor.apply(Dt,arguments)},this.getClearAlpha=function(){return Dt.getClearAlpha()},this.setClearAlpha=function(){Dt.setClearAlpha.apply(Dt,arguments)},this.clear=function(fe=!0,qe=!0,st=!0){let Ge=0;fe&&(Ge|=Ne.COLOR_BUFFER_BIT),qe&&(Ge|=Ne.DEPTH_BUFFER_BIT),st&&(Ge|=Ne.STENCIL_BUFFER_BIT),Ne.clear(Ge)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){s.removeEventListener("webglcontextlost",Nn,!1),s.removeEventListener("webglcontextrestored",ri,!1),s.removeEventListener("webglcontextcreationerror",Bi,!1),Fi.dispose(),ye.dispose(),dt.dispose(),Ut.dispose(),bn.dispose(),kn.dispose(),ft.dispose(),Tn.dispose(),Pn.dispose(),Cn.dispose(),Cn.removeEventListener("sessionstart",Un),Cn.removeEventListener("sessionend",ji),Je&&(Je.dispose(),Je=null),ps.stop()};function Nn(fe){fe.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),G=!0}function ri(){console.log("THREE.WebGLRenderer: Context Restored."),G=!1;const fe=li.autoReset,qe=Ke.enabled,st=Ke.autoUpdate,Ge=Ke.needsUpdate,ot=Ke.type;Wn(),li.autoReset=fe,Ke.enabled=qe,Ke.autoUpdate=st,Ke.needsUpdate=Ge,Ke.type=ot}function Bi(fe){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",fe.statusMessage)}function Pe(fe){const qe=fe.target;qe.removeEventListener("dispose",Pe),_n(qe)}function _n(fe){Qt(fe),dt.remove(fe)}function Qt(fe){const qe=dt.get(fe).programs;qe!==void 0&&(qe.forEach(function(st){Pn.releaseProgram(st)}),fe.isShaderMaterial&&Pn.releaseShaderCache(fe))}this.renderBufferDirect=function(fe,qe,st,Ge,ot,Rn){qe===null&&(qe=An);const Qn=ot.isMesh&&ot.matrixWorld.determinant()<0,ci=GH(fe,qe,st,Ge,ot);on.setMaterial(Ge,Qn);let Yn=st.index;const Pi=st.attributes.position;if(Yn===null){if(Pi===void 0||Pi.count===0)return}else if(Yn.count===0)return;let mi=1;Ge.wireframe===!0&&(Yn=ei.getWireframeAttribute(st),mi=2),ft.setup(ot,Ge,ci,st,Yn);let gi,rs=an;Yn!==null&&(gi=sn.get(Yn),rs=zn,rs.setIndex(gi));const kh=Yn!==null?Yn.count:Pi.count,vd=st.drawRange.start*mi,xd=st.drawRange.count*mi,va=Rn!==null?Rn.start*mi:0,Si=Rn!==null?Rn.count*mi:1/0,wd=Math.max(vd,va),ws=Math.min(kh,vd+xd,va+Si)-1,bo=Math.max(0,ws-wd+1);if(bo!==0){if(ot.isMesh)Ge.wireframe===!0?(on.setLineWidth(Ge.wireframeLinewidth*Hn()),rs.setMode(Ne.LINES)):rs.setMode(Ne.TRIANGLES);else if(ot.isLine){let hl=Ge.linewidth;hl===void 0&&(hl=1),on.setLineWidth(hl*Hn()),ot.isLineSegments?rs.setMode(Ne.LINES):ot.isLineLoop?rs.setMode(Ne.LINE_LOOP):rs.setMode(Ne.LINE_STRIP)}else ot.isPoints?rs.setMode(Ne.POINTS):ot.isSprite&&rs.setMode(Ne.TRIANGLES);if(ot.isInstancedMesh)rs.renderInstances(wd,bo,ot.count);else if(st.isInstancedBufferGeometry){const hl=Math.min(st.instanceCount,st._maxInstanceCount);rs.renderInstances(wd,bo,hl)}else rs.render(wd,bo)}},this.compile=function(fe,qe){function st(Ge,ot,Rn){Ge.transparent===!0&&Ge.side===A?(Ge.side=m,Ge.needsUpdate=!0,d0(Ge,ot,Rn),Ge.side=g,Ge.needsUpdate=!0,d0(Ge,ot,Rn),Ge.side=A):d0(Ge,ot,Rn)}N=ye.get(fe),N.init(),V.push(N),fe.traverseVisible(function(Ge){Ge.isLight&&Ge.layers.test(qe.layers)&&(N.pushLight(Ge),Ge.castShadow&&N.pushShadow(Ge))}),N.setupLights(H.physicallyCorrectLights),fe.traverse(function(Ge){const ot=Ge.material;if(ot)if(Array.isArray(ot))for(let Rn=0;Rn<ot.length;Rn++){const Qn=ot[Rn];st(Qn,fe,Ge)}else st(ot,fe,Ge)}),V.pop(),N=null};let ht=null;function Yt(fe){ht&&ht(fe)}function Un(){ps.stop()}function ji(){ps.start()}const ps=new KM;ps.setAnimationLoop(Yt),typeof self<"u"&&ps.setContext(self),this.setAnimationLoop=function(fe){ht=fe,Cn.setAnimationLoop(fe),fe===null?ps.stop():ps.start()},Cn.addEventListener("sessionstart",Un),Cn.addEventListener("sessionend",ji),this.render=function(fe,qe){if(qe!==void 0&&qe.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(G===!0)return;fe.matrixWorldAutoUpdate===!0&&fe.updateMatrixWorld(),qe.parent===null&&qe.matrixWorldAutoUpdate===!0&&qe.updateMatrixWorld(),Cn.enabled===!0&&Cn.isPresenting===!0&&(Cn.cameraAutoUpdate===!0&&Cn.updateCamera(qe),qe=Cn.getCamera()),fe.isScene===!0&&fe.onBeforeRender(H,fe,qe,ne),N=ye.get(fe,V.length),N.init(),V.push(N),Tt.multiplyMatrices(qe.projectionMatrix,qe.matrixWorldInverse),Et.setFromProjectionMatrix(Tt),We=this.localClippingEnabled,at=le.init(this.clippingPlanes,We,qe),k=Fi.get(fe,z.length),k.init(),z.push(k),ll(fe,qe,0,H.sortObjects),k.finish(),H.sortObjects===!0&&k.sort(Mt,Ye),at===!0&&le.beginShadows();const st=N.state.shadowsArray;if(Ke.render(st,fe,qe),at===!0&&le.endShadows(),this.info.autoReset===!0&&this.info.reset(),Dt.render(k,fe),N.setupLights(H.physicallyCorrectLights),qe.isArrayCamera){const Ge=qe.cameras;for(let ot=0,Rn=Ge.length;ot<Rn;ot++){const Qn=Ge[ot];ss(k,fe,Qn,Qn.viewport)}}else ss(k,fe,qe);ne!==null&&(ct.updateMultisampleRenderTarget(ne),ct.updateRenderTargetMipmap(ne)),fe.isScene===!0&&fe.onAfterRender(H,fe,qe),ft.resetDefaultState(),te=-1,oe=null,V.pop(),V.length>0?N=V[V.length-1]:N=null,z.pop(),z.length>0?k=z[z.length-1]:k=null};function ll(fe,qe,st,Ge){if(fe.visible===!1)return;if(fe.layers.test(qe.layers)){if(fe.isGroup)st=fe.renderOrder;else if(fe.isLOD)fe.autoUpdate===!0&&fe.update(qe);else if(fe.isLight)N.pushLight(fe),fe.castShadow&&N.pushShadow(fe);else if(fe.isSprite){if(!fe.frustumCulled||Et.intersectsSprite(fe)){Ge&&Pt.setFromMatrixPosition(fe.matrixWorld).applyMatrix4(Tt);const Qn=kn.update(fe),ci=fe.material;ci.visible&&k.push(fe,Qn,ci,st,Pt.z,null)}}else if((fe.isMesh||fe.isLine||fe.isPoints)&&(fe.isSkinnedMesh&&fe.skeleton.frame!==li.render.frame&&(fe.skeleton.update(),fe.skeleton.frame=li.render.frame),!fe.frustumCulled||Et.intersectsObject(fe))){Ge&&Pt.setFromMatrixPosition(fe.matrixWorld).applyMatrix4(Tt);const Qn=kn.update(fe),ci=fe.material;if(Array.isArray(ci)){const Yn=Qn.groups;for(let Pi=0,mi=Yn.length;Pi<mi;Pi++){const gi=Yn[Pi],rs=ci[gi.materialIndex];rs&&rs.visible&&k.push(fe,Qn,rs,st,Pt.z,gi)}}else ci.visible&&k.push(fe,Qn,ci,st,Pt.z,null)}}const Rn=fe.children;for(let Qn=0,ci=Rn.length;Qn<ci;Qn++)ll(Rn[Qn],qe,st,Ge)}function ss(fe,qe,st,Ge){const ot=fe.opaque,Rn=fe.transmissive,Qn=fe.transparent;N.setupLightsView(st),Rn.length>0&&cc(ot,qe,st),Ge&&on.viewport(ue.copy(Ge)),ot.length>0&&wo(ot,qe,st),Rn.length>0&&wo(Rn,qe,st),Qn.length>0&&wo(Qn,qe,st),on.buffers.depth.setTest(!0),on.buffers.depth.setMask(!0),on.buffers.color.setMask(!0),on.setPolygonOffset(!1)}function cc(fe,qe,st){const Ge=Vn.isWebGL2;Je===null&&(Je=new _o(1,1,{generateMipmaps:!0,type:Dn.has("EXT_color_buffer_half_float")?di:Ln,minFilter:Ht,samples:Ge&&_===!0?4:0})),H.getDrawingBufferSize(It),Ge?Je.setSize(It.x,It.y):Je.setSize(aA(It.x),aA(It.y));const ot=H.getRenderTarget();H.setRenderTarget(Je),H.clear();const Rn=H.toneMapping;H.toneMapping=yn,wo(fe,qe,st),H.toneMapping=Rn,ct.updateMultisampleRenderTarget(Je),ct.updateRenderTargetMipmap(Je),H.setRenderTarget(ot)}function wo(fe,qe,st){const Ge=qe.isScene===!0?qe.overrideMaterial:null;for(let ot=0,Rn=fe.length;ot<Rn;ot++){const Qn=fe[ot],ci=Qn.object,Yn=Qn.geometry,Pi=Ge===null?Qn.material:Ge,mi=Qn.group;ci.layers.test(st.layers)&&zH(ci,qe,st,Yn,Pi,mi)}}function zH(fe,qe,st,Ge,ot,Rn){fe.onBeforeRender(H,qe,st,Ge,ot,Rn),fe.modelViewMatrix.multiplyMatrices(st.matrixWorldInverse,fe.matrixWorld),fe.normalMatrix.getNormalMatrix(fe.modelViewMatrix),ot.onBeforeRender(H,qe,st,Ge,fe,Rn),ot.transparent===!0&&ot.side===A?(ot.side=m,ot.needsUpdate=!0,H.renderBufferDirect(st,qe,Ge,ot,fe,Rn),ot.side=g,ot.needsUpdate=!0,H.renderBufferDirect(st,qe,Ge,ot,fe,Rn),ot.side=A):H.renderBufferDirect(st,qe,Ge,ot,fe,Rn),fe.onAfterRender(H,qe,st,Ge,ot,Rn)}function d0(fe,qe,st){qe.isScene!==!0&&(qe=An);const Ge=dt.get(fe),ot=N.state.lights,Rn=N.state.shadowsArray,Qn=ot.state.version,ci=Pn.getParameters(fe,ot.state,Rn,qe,st),Yn=Pn.getProgramCacheKey(ci);let Pi=Ge.programs;Ge.environment=fe.isMeshStandardMaterial?qe.environment:null,Ge.fog=qe.fog,Ge.envMap=(fe.isMeshStandardMaterial?bn:Ut).get(fe.envMap||Ge.environment),Pi===void 0&&(fe.addEventListener("dispose",Pe),Pi=new Map,Ge.programs=Pi);let mi=Pi.get(Yn);if(mi!==void 0){if(Ge.currentProgram===mi&&Ge.lightsStateVersion===Qn)return lI(fe,ci),mi}else ci.uniforms=Pn.getUniforms(fe),fe.onBuild(st,ci,H),fe.onBeforeCompile(ci,H),mi=Pn.acquireProgram(ci,Yn),Pi.set(Yn,mi),Ge.uniforms=ci.uniforms;const gi=Ge.uniforms;(!fe.isShaderMaterial&&!fe.isRawShaderMaterial||fe.clipping===!0)&&(gi.clippingPlanes=le.uniform),lI(fe,ci),Ge.needsLights=VH(fe),Ge.lightsStateVersion=Qn,Ge.needsLights&&(gi.ambientLightColor.value=ot.state.ambient,gi.lightProbe.value=ot.state.probe,gi.directionalLights.value=ot.state.directional,gi.directionalLightShadows.value=ot.state.directionalShadow,gi.spotLights.value=ot.state.spot,gi.spotLightShadows.value=ot.state.spotShadow,gi.rectAreaLights.value=ot.state.rectArea,gi.ltc_1.value=ot.state.rectAreaLTC1,gi.ltc_2.value=ot.state.rectAreaLTC2,gi.pointLights.value=ot.state.point,gi.pointLightShadows.value=ot.state.pointShadow,gi.hemisphereLights.value=ot.state.hemi,gi.directionalShadowMap.value=ot.state.directionalShadowMap,gi.directionalShadowMatrix.value=ot.state.directionalShadowMatrix,gi.spotShadowMap.value=ot.state.spotShadowMap,gi.spotLightMatrix.value=ot.state.spotLightMatrix,gi.spotLightMap.value=ot.state.spotLightMap,gi.pointShadowMap.value=ot.state.pointShadowMap,gi.pointShadowMatrix.value=ot.state.pointShadowMatrix);const rs=mi.getUniforms(),kh=OA.seqWithValue(rs.seq,gi);return Ge.currentProgram=mi,Ge.uniformsList=kh,mi}function lI(fe,qe){const st=dt.get(fe);st.outputEncoding=qe.outputEncoding,st.instancing=qe.instancing,st.skinning=qe.skinning,st.morphTargets=qe.morphTargets,st.morphNormals=qe.morphNormals,st.morphColors=qe.morphColors,st.morphTargetsCount=qe.morphTargetsCount,st.numClippingPlanes=qe.numClippingPlanes,st.numIntersection=qe.numClipIntersection,st.vertexAlphas=qe.vertexAlphas,st.vertexTangents=qe.vertexTangents,st.toneMapping=qe.toneMapping}function GH(fe,qe,st,Ge,ot){qe.isScene!==!0&&(qe=An),ct.resetTextureUnits();const Rn=qe.fog,Qn=Ge.isMeshStandardMaterial?qe.environment:null,ci=ne===null?H.outputEncoding:ne.isXRRenderTarget===!0?ne.texture.encoding:jc,Yn=(Ge.isMeshStandardMaterial?bn:Ut).get(Ge.envMap||Qn),Pi=Ge.vertexColors===!0&&!!st.attributes.color&&st.attributes.color.itemSize===4,mi=!!Ge.normalMap&&!!st.attributes.tangent,gi=!!st.morphAttributes.position,rs=!!st.morphAttributes.normal,kh=!!st.morphAttributes.color,vd=Ge.toneMapped?H.toneMapping:yn,xd=st.morphAttributes.position||st.morphAttributes.normal||st.morphAttributes.color,va=xd!==void 0?xd.length:0,Si=dt.get(Ge),wd=N.state.lights;if(at===!0&&(We===!0||fe!==oe)){const Zr=fe===oe&&Ge.id===te;le.setState(Ge,fe,Zr)}let ws=!1;Ge.version===Si.__version?(Si.needsLights&&Si.lightsStateVersion!==wd.state.version||Si.outputEncoding!==ci||ot.isInstancedMesh&&Si.instancing===!1||!ot.isInstancedMesh&&Si.instancing===!0||ot.isSkinnedMesh&&Si.skinning===!1||!ot.isSkinnedMesh&&Si.skinning===!0||Si.envMap!==Yn||Ge.fog===!0&&Si.fog!==Rn||Si.numClippingPlanes!==void 0&&(Si.numClippingPlanes!==le.numPlanes||Si.numIntersection!==le.numIntersection)||Si.vertexAlphas!==Pi||Si.vertexTangents!==mi||Si.morphTargets!==gi||Si.morphNormals!==rs||Si.morphColors!==kh||Si.toneMapping!==vd||Vn.isWebGL2===!0&&Si.morphTargetsCount!==va)&&(ws=!0):(ws=!0,Si.__version=Ge.version);let bo=Si.currentProgram;ws===!0&&(bo=d0(Ge,qe,ot));let hl=!1,Vp=!1,ow=!1;const vr=bo.getUniforms(),Nh=Si.uniforms;if(on.useProgram(bo.program)&&(hl=!0,Vp=!0,ow=!0),Ge.id!==te&&(te=Ge.id,Vp=!0),hl||oe!==fe){if(vr.setValue(Ne,"projectionMatrix",fe.projectionMatrix),Vn.logarithmicDepthBuffer&&vr.setValue(Ne,"logDepthBufFC",2/(Math.log(fe.far+1)/Math.LN2)),oe!==fe&&(oe=fe,Vp=!0,ow=!0),Ge.isShaderMaterial||Ge.isMeshPhongMaterial||Ge.isMeshToonMaterial||Ge.isMeshStandardMaterial||Ge.envMap){const Zr=vr.map.cameraPosition;Zr!==void 0&&Zr.setValue(Ne,Pt.setFromMatrixPosition(fe.matrixWorld))}(Ge.isMeshPhongMaterial||Ge.isMeshToonMaterial||Ge.isMeshLambertMaterial||Ge.isMeshBasicMaterial||Ge.isMeshStandardMaterial||Ge.isShaderMaterial)&&vr.setValue(Ne,"isOrthographic",fe.isOrthographicCamera===!0),(Ge.isMeshPhongMaterial||Ge.isMeshToonMaterial||Ge.isMeshLambertMaterial||Ge.isMeshBasicMaterial||Ge.isMeshStandardMaterial||Ge.isShaderMaterial||Ge.isShadowMaterial||ot.isSkinnedMesh)&&vr.setValue(Ne,"viewMatrix",fe.matrixWorldInverse)}if(ot.isSkinnedMesh){vr.setOptional(Ne,ot,"bindMatrix"),vr.setOptional(Ne,ot,"bindMatrixInverse");const Zr=ot.skeleton;Zr&&(Vn.floatVertexTextures?(Zr.boneTexture===null&&Zr.computeBoneTexture(),vr.setValue(Ne,"boneTexture",Zr.boneTexture,ct),vr.setValue(Ne,"boneTextureSize",Zr.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const aw=st.morphAttributes;if((aw.position!==void 0||aw.normal!==void 0||aw.color!==void 0&&Vn.isWebGL2===!0)&&Wt.update(ot,st,Ge,bo),(Vp||Si.receiveShadow!==ot.receiveShadow)&&(Si.receiveShadow=ot.receiveShadow,vr.setValue(Ne,"receiveShadow",ot.receiveShadow)),Ge.isMeshGouraudMaterial&&Ge.envMap!==null&&(Nh.envMap.value=Yn,Nh.flipEnvMap.value=Yn.isCubeTexture&&Yn.isRenderTargetTexture===!1?-1:1),Vp&&(vr.setValue(Ne,"toneMappingExposure",H.toneMappingExposure),Si.needsLights&&HH(Nh,ow),Rn&&Ge.fog===!0&&Qi.refreshFogUniforms(Nh,Rn),Qi.refreshMaterialUniforms(Nh,Ge,et,Se,Je),OA.upload(Ne,Si.uniformsList,Nh,ct)),Ge.isShaderMaterial&&Ge.uniformsNeedUpdate===!0&&(OA.upload(Ne,Si.uniformsList,Nh,ct),Ge.uniformsNeedUpdate=!1),Ge.isSpriteMaterial&&vr.setValue(Ne,"center",ot.center),vr.setValue(Ne,"modelViewMatrix",ot.modelViewMatrix),vr.setValue(Ne,"normalMatrix",ot.normalMatrix),vr.setValue(Ne,"modelMatrix",ot.matrixWorld),Ge.isShaderMaterial||Ge.isRawShaderMaterial){const Zr=Ge.uniformsGroups;for(let cw=0,WH=Zr.length;cw<WH;cw++)if(Vn.isWebGL2){const hI=Zr[cw];Tn.update(hI,bo),Tn.bind(hI,bo)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return bo}function HH(fe,qe){fe.ambientLightColor.needsUpdate=qe,fe.lightProbe.needsUpdate=qe,fe.directionalLights.needsUpdate=qe,fe.directionalLightShadows.needsUpdate=qe,fe.pointLights.needsUpdate=qe,fe.pointLightShadows.needsUpdate=qe,fe.spotLights.needsUpdate=qe,fe.spotLightShadows.needsUpdate=qe,fe.rectAreaLights.needsUpdate=qe,fe.hemisphereLights.needsUpdate=qe}function VH(fe){return fe.isMeshLambertMaterial||fe.isMeshToonMaterial||fe.isMeshPhongMaterial||fe.isMeshStandardMaterial||fe.isShadowMaterial||fe.isShaderMaterial&&fe.lights===!0}this.getActiveCubeFace=function(){return X},this.getActiveMipmapLevel=function(){return Z},this.getRenderTarget=function(){return ne},this.setRenderTargetTextures=function(fe,qe,st){dt.get(fe.texture).__webglTexture=qe,dt.get(fe.depthTexture).__webglTexture=st;const Ge=dt.get(fe);Ge.__hasExternalTextures=!0,Ge.__hasExternalTextures&&(Ge.__autoAllocateDepthBuffer=st===void 0,Ge.__autoAllocateDepthBuffer||Dn.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Ge.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(fe,qe){const st=dt.get(fe);st.__webglFramebuffer=qe,st.__useDefaultFramebuffer=qe===void 0},this.setRenderTarget=function(fe,qe=0,st=0){ne=fe,X=qe,Z=st;let Ge=!0;if(fe){const Yn=dt.get(fe);Yn.__useDefaultFramebuffer!==void 0?(on.bindFramebuffer(Ne.FRAMEBUFFER,null),Ge=!1):Yn.__webglFramebuffer===void 0?ct.setupRenderTarget(fe):Yn.__hasExternalTextures&&ct.rebindTextures(fe,dt.get(fe.texture).__webglTexture,dt.get(fe.depthTexture).__webglTexture)}let ot=null,Rn=!1,Qn=!1;if(fe){const Yn=fe.texture;(Yn.isData3DTexture||Yn.isDataArrayTexture)&&(Qn=!0);const Pi=dt.get(fe).__webglFramebuffer;fe.isWebGLCubeRenderTarget?(ot=Pi[qe],Rn=!0):Vn.isWebGL2&&fe.samples>0&&ct.useMultisampledRTT(fe)===!1?ot=dt.get(fe).__webglMultisampledFramebuffer:ot=Pi,ue.copy(fe.viewport),be.copy(fe.scissor),$=fe.scissorTest}else ue.copy(Oe).multiplyScalar(et).floor(),be.copy(rt).multiplyScalar(et).floor(),$=gt;if(on.bindFramebuffer(Ne.FRAMEBUFFER,ot)&&Vn.drawBuffers&&Ge&&on.drawBuffers(fe,ot),on.viewport(ue),on.scissor(be),on.setScissorTest($),Rn){const Yn=dt.get(fe.texture);Ne.framebufferTexture2D(Ne.FRAMEBUFFER,Ne.COLOR_ATTACHMENT0,Ne.TEXTURE_CUBE_MAP_POSITIVE_X+qe,Yn.__webglTexture,st)}else if(Qn){const Yn=dt.get(fe.texture),Pi=qe||0;Ne.framebufferTextureLayer(Ne.FRAMEBUFFER,Ne.COLOR_ATTACHMENT0,Yn.__webglTexture,st||0,Pi)}te=-1},this.readRenderTargetPixels=function(fe,qe,st,Ge,ot,Rn,Qn){if(!(fe&&fe.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let ci=dt.get(fe).__webglFramebuffer;if(fe.isWebGLCubeRenderTarget&&Qn!==void 0&&(ci=ci[Qn]),ci){on.bindFramebuffer(Ne.FRAMEBUFFER,ci);try{const Yn=fe.texture,Pi=Yn.format,mi=Yn.type;if(Pi!==ir&&cn.convert(Pi)!==Ne.getParameter(Ne.IMPLEMENTATION_COLOR_READ_FORMAT)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const gi=mi===di&&(Dn.has("EXT_color_buffer_half_float")||Vn.isWebGL2&&Dn.has("EXT_color_buffer_float"));if(mi!==Ln&&cn.convert(mi)!==Ne.getParameter(Ne.IMPLEMENTATION_COLOR_READ_TYPE)&&!(mi===wn&&(Vn.isWebGL2||Dn.has("OES_texture_float")||Dn.has("WEBGL_color_buffer_float")))&&!gi){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}qe>=0&&qe<=fe.width-Ge&&st>=0&&st<=fe.height-ot&&Ne.readPixels(qe,st,Ge,ot,cn.convert(Pi),cn.convert(mi),Rn)}finally{const Yn=ne!==null?dt.get(ne).__webglFramebuffer:null;on.bindFramebuffer(Ne.FRAMEBUFFER,Yn)}}},this.copyFramebufferToTexture=function(fe,qe,st=0){const Ge=Math.pow(2,-st),ot=Math.floor(qe.image.width*Ge),Rn=Math.floor(qe.image.height*Ge);ct.setTexture2D(qe,0),Ne.copyTexSubImage2D(Ne.TEXTURE_2D,st,0,0,fe.x,fe.y,ot,Rn),on.unbindTexture()},this.copyTextureToTexture=function(fe,qe,st,Ge=0){const ot=qe.image.width,Rn=qe.image.height,Qn=cn.convert(st.format),ci=cn.convert(st.type);ct.setTexture2D(st,0),Ne.pixelStorei(Ne.UNPACK_FLIP_Y_WEBGL,st.flipY),Ne.pixelStorei(Ne.UNPACK_PREMULTIPLY_ALPHA_WEBGL,st.premultiplyAlpha),Ne.pixelStorei(Ne.UNPACK_ALIGNMENT,st.unpackAlignment),qe.isDataTexture?Ne.texSubImage2D(Ne.TEXTURE_2D,Ge,fe.x,fe.y,ot,Rn,Qn,ci,qe.image.data):qe.isCompressedTexture?Ne.compressedTexSubImage2D(Ne.TEXTURE_2D,Ge,fe.x,fe.y,qe.mipmaps[0].width,qe.mipmaps[0].height,Qn,qe.mipmaps[0].data):Ne.texSubImage2D(Ne.TEXTURE_2D,Ge,fe.x,fe.y,Qn,ci,qe.image),Ge===0&&st.generateMipmaps&&Ne.generateMipmap(Ne.TEXTURE_2D),on.unbindTexture()},this.copyTextureToTexture3D=function(fe,qe,st,Ge,ot=0){if(H.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const Rn=fe.max.x-fe.min.x+1,Qn=fe.max.y-fe.min.y+1,ci=fe.max.z-fe.min.z+1,Yn=cn.convert(Ge.format),Pi=cn.convert(Ge.type);let mi;if(Ge.isData3DTexture)ct.setTexture3D(Ge,0),mi=Ne.TEXTURE_3D;else if(Ge.isDataArrayTexture)ct.setTexture2DArray(Ge,0),mi=Ne.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}Ne.pixelStorei(Ne.UNPACK_FLIP_Y_WEBGL,Ge.flipY),Ne.pixelStorei(Ne.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Ge.premultiplyAlpha),Ne.pixelStorei(Ne.UNPACK_ALIGNMENT,Ge.unpackAlignment);const gi=Ne.getParameter(Ne.UNPACK_ROW_LENGTH),rs=Ne.getParameter(Ne.UNPACK_IMAGE_HEIGHT),kh=Ne.getParameter(Ne.UNPACK_SKIP_PIXELS),vd=Ne.getParameter(Ne.UNPACK_SKIP_ROWS),xd=Ne.getParameter(Ne.UNPACK_SKIP_IMAGES),va=st.isCompressedTexture?st.mipmaps[0]:st.image;Ne.pixelStorei(Ne.UNPACK_ROW_LENGTH,va.width),Ne.pixelStorei(Ne.UNPACK_IMAGE_HEIGHT,va.height),Ne.pixelStorei(Ne.UNPACK_SKIP_PIXELS,fe.min.x),Ne.pixelStorei(Ne.UNPACK_SKIP_ROWS,fe.min.y),Ne.pixelStorei(Ne.UNPACK_SKIP_IMAGES,fe.min.z),st.isDataTexture||st.isData3DTexture?Ne.texSubImage3D(mi,ot,qe.x,qe.y,qe.z,Rn,Qn,ci,Yn,Pi,va.data):st.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),Ne.compressedTexSubImage3D(mi,ot,qe.x,qe.y,qe.z,Rn,Qn,ci,Yn,va.data)):Ne.texSubImage3D(mi,ot,qe.x,qe.y,qe.z,Rn,Qn,ci,Yn,Pi,va),Ne.pixelStorei(Ne.UNPACK_ROW_LENGTH,gi),Ne.pixelStorei(Ne.UNPACK_IMAGE_HEIGHT,rs),Ne.pixelStorei(Ne.UNPACK_SKIP_PIXELS,kh),Ne.pixelStorei(Ne.UNPACK_SKIP_ROWS,vd),Ne.pixelStorei(Ne.UNPACK_SKIP_IMAGES,xd),ot===0&&Ge.generateMipmaps&&Ne.generateMipmap(mi),on.unbindTexture()},this.initTexture=function(fe){fe.isCubeTexture?ct.setTextureCube(fe,0):fe.isData3DTexture?ct.setTexture3D(fe,0):fe.isDataArrayTexture?ct.setTexture2DArray(fe,0):ct.setTexture2D(fe,0),on.unbindTexture()},this.resetState=function(){X=0,Z=0,ne=null,on.reset(),ft.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}class T1 extends M1{}T1.prototype.isWebGL1Renderer=!0;class FA{constructor(s,c=25e-5){this.isFogExp2=!0,this.name="",this.color=new dn(s),this.density=c}clone(){return new FA(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}class kA{constructor(s,c=1,d=1e3){this.isFog=!0,this.name="",this.color=new dn(s),this.near=c,this.far=d}clone(){return new kA(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}class I1 extends wi{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(s,c){return super.copy(s,c),s.background!==null&&(this.background=s.background.clone()),s.environment!==null&&(this.environment=s.environment.clone()),s.fog!==null&&(this.fog=s.fog.clone()),s.overrideMaterial!==null&&(this.overrideMaterial=s.overrideMaterial.clone()),this.matrixAutoUpdate=s.matrixAutoUpdate,this}toJSON(s){const c=super.toJSON(s);return this.fog!==null&&(c.object.fog=this.fog.toJSON()),c}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(s){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=s}}class NA{constructor(s,c){this.isInterleavedBuffer=!0,this.array=s,this.stride=c,this.count=s!==void 0?s.length/c:0,this.usage=sp,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=qr()}onUploadCallback(){}set needsUpdate(s){s===!0&&this.version++}setUsage(s){return this.usage=s,this}copy(s){return this.array=new s.array.constructor(s.array),this.count=s.count,this.stride=s.stride,this.usage=s.usage,this}copyAt(s,c,d){s*=this.stride,d*=c.stride;for(let p=0,_=this.stride;p<_;p++)this.array[s+p]=c.array[d+p];return this}set(s,c=0){return this.array.set(s,c),this}clone(s){s.arrayBuffers===void 0&&(s.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=qr()),s.arrayBuffers[this.array.buffer._uuid]===void 0&&(s.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const c=new this.array.constructor(s.arrayBuffers[this.array.buffer._uuid]),d=new this.constructor(c,this.stride);return d.setUsage(this.usage),d}onUpload(s){return this.onUploadCallback=s,this}toJSON(s){return s.arrayBuffers===void 0&&(s.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=qr()),s.arrayBuffers[this.array.buffer._uuid]===void 0&&(s.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const _r=new de;class Ch{constructor(s,c,d,p=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=s,this.itemSize=c,this.offset=d,this.normalized=p===!0}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(s){this.data.needsUpdate=s}applyMatrix4(s){for(let c=0,d=this.data.count;c<d;c++)_r.fromBufferAttribute(this,c),_r.applyMatrix4(s),this.setXYZ(c,_r.x,_r.y,_r.z);return this}applyNormalMatrix(s){for(let c=0,d=this.count;c<d;c++)_r.fromBufferAttribute(this,c),_r.applyNormalMatrix(s),this.setXYZ(c,_r.x,_r.y,_r.z);return this}transformDirection(s){for(let c=0,d=this.count;c<d;c++)_r.fromBufferAttribute(this,c),_r.transformDirection(s),this.setXYZ(c,_r.x,_r.y,_r.z);return this}setX(s,c){return this.normalized&&(c=Di(c,this.array)),this.data.array[s*this.data.stride+this.offset]=c,this}setY(s,c){return this.normalized&&(c=Di(c,this.array)),this.data.array[s*this.data.stride+this.offset+1]=c,this}setZ(s,c){return this.normalized&&(c=Di(c,this.array)),this.data.array[s*this.data.stride+this.offset+2]=c,this}setW(s,c){return this.normalized&&(c=Di(c,this.array)),this.data.array[s*this.data.stride+this.offset+3]=c,this}getX(s){let c=this.data.array[s*this.data.stride+this.offset];return this.normalized&&(c=Ka(c,this.array)),c}getY(s){let c=this.data.array[s*this.data.stride+this.offset+1];return this.normalized&&(c=Ka(c,this.array)),c}getZ(s){let c=this.data.array[s*this.data.stride+this.offset+2];return this.normalized&&(c=Ka(c,this.array)),c}getW(s){let c=this.data.array[s*this.data.stride+this.offset+3];return this.normalized&&(c=Ka(c,this.array)),c}setXY(s,c,d){return s=s*this.data.stride+this.offset,this.normalized&&(c=Di(c,this.array),d=Di(d,this.array)),this.data.array[s+0]=c,this.data.array[s+1]=d,this}setXYZ(s,c,d,p){return s=s*this.data.stride+this.offset,this.normalized&&(c=Di(c,this.array),d=Di(d,this.array),p=Di(p,this.array)),this.data.array[s+0]=c,this.data.array[s+1]=d,this.data.array[s+2]=p,this}setXYZW(s,c,d,p,_){return s=s*this.data.stride+this.offset,this.normalized&&(c=Di(c,this.array),d=Di(d,this.array),p=Di(p,this.array),_=Di(_,this.array)),this.data.array[s+0]=c,this.data.array[s+1]=d,this.data.array[s+2]=p,this.data.array[s+3]=_,this}clone(s){if(s===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will deinterleave buffer data.");const c=[];for(let d=0;d<this.count;d++){const p=d*this.data.stride+this.offset;for(let _=0;_<this.itemSize;_++)c.push(this.data.array[p+_])}return new Oi(new this.array.constructor(c),this.itemSize,this.normalized)}else return s.interleavedBuffers===void 0&&(s.interleavedBuffers={}),s.interleavedBuffers[this.data.uuid]===void 0&&(s.interleavedBuffers[this.data.uuid]=this.data.clone(s)),new Ch(s.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(s){if(s===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will deinterleave buffer data.");const c=[];for(let d=0;d<this.count;d++){const p=d*this.data.stride+this.offset;for(let _=0;_<this.itemSize;_++)c.push(this.data.array[p+_])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:c,normalized:this.normalized}}else return s.interleavedBuffers===void 0&&(s.interleavedBuffers={}),s.interleavedBuffers[this.data.uuid]===void 0&&(s.interleavedBuffers[this.data.uuid]=this.data.toJSON(s)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class Ex extends rr{constructor(s){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new dn(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(s)}copy(s){return super.copy(s),this.color.copy(s.color),this.map=s.map,this.alphaMap=s.alphaMap,this.rotation=s.rotation,this.sizeAttenuation=s.sizeAttenuation,this.fog=s.fog,this}}let ld;const mp=new de,hd=new de,ud=new de,dd=new mt,gp=new mt,R1=new $n,UA=new de,Ap=new de,zA=new de,P1=new mt,Cx=new mt,B1=new mt;class L1 extends wi{constructor(s){if(super(),this.isSprite=!0,this.type="Sprite",ld===void 0){ld=new si;const c=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),d=new NA(c,5);ld.setIndex([0,1,2,0,2,3]),ld.setAttribute("position",new Ch(d,3,0,!1)),ld.setAttribute("uv",new Ch(d,2,3,!1))}this.geometry=ld,this.material=s!==void 0?s:new Ex,this.center=new mt(.5,.5)}raycast(s,c){s.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),hd.setFromMatrixScale(this.matrixWorld),R1.copy(s.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(s.camera.matrixWorldInverse,this.matrixWorld),ud.setFromMatrixPosition(this.modelViewMatrix),s.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&hd.multiplyScalar(-ud.z);const d=this.material.rotation;let p,_;d!==0&&(_=Math.cos(d),p=Math.sin(d));const x=this.center;GA(UA.set(-.5,-.5,0),ud,x,hd,p,_),GA(Ap.set(.5,-.5,0),ud,x,hd,p,_),GA(zA.set(.5,.5,0),ud,x,hd,p,_),P1.set(0,0),Cx.set(1,0),B1.set(1,1);let C=s.ray.intersectTriangle(UA,Ap,zA,!1,mp);if(C===null&&(GA(Ap.set(-.5,.5,0),ud,x,hd,p,_),Cx.set(0,1),C=s.ray.intersectTriangle(UA,zA,Ap,!1,mp),C===null))return;const P=s.ray.origin.distanceTo(mp);P<s.near||P>s.far||c.push({distance:P,point:mp.clone(),uv:yo.getUV(mp,UA,Ap,zA,P1,Cx,B1,new mt),face:null,object:this})}copy(s,c){return super.copy(s,c),s.center!==void 0&&this.center.copy(s.center),this.material=s.material,this}}function GA(y,s,c,d,p,_){dd.subVectors(y,c).addScalar(.5).multiply(d),p!==void 0?(gp.x=_*dd.x-p*dd.y,gp.y=p*dd.x+_*dd.y):gp.copy(dd),y.copy(s),y.x+=gp.x,y.y+=gp.y,y.applyMatrix4(R1)}const HA=new de,D1=new de;class O1 extends wi{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(s){super.copy(s,!1);const c=s.levels;for(let d=0,p=c.length;d<p;d++){const _=c[d];this.addLevel(_.object.clone(),_.distance)}return this.autoUpdate=s.autoUpdate,this}addLevel(s,c=0){c=Math.abs(c);const d=this.levels;let p;for(p=0;p<d.length&&!(c<d[p].distance);p++);return d.splice(p,0,{distance:c,object:s}),this.add(s),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(s){const c=this.levels;if(c.length>0){let d,p;for(d=1,p=c.length;d<p&&!(s<c[d].distance);d++);return c[d-1].object}return null}raycast(s,c){if(this.levels.length>0){HA.setFromMatrixPosition(this.matrixWorld);const p=s.ray.origin.distanceTo(HA);this.getObjectForDistance(p).raycast(s,c)}}update(s){const c=this.levels;if(c.length>1){HA.setFromMatrixPosition(s.matrixWorld),D1.setFromMatrixPosition(this.matrixWorld);const d=HA.distanceTo(D1)/s.zoom;c[0].object.visible=!0;let p,_;for(p=1,_=c.length;p<_&&d>=c[p].distance;p++)c[p-1].object.visible=!1,c[p].object.visible=!0;for(this._currentLevel=p-1;p<_;p++)c[p].object.visible=!1}}toJSON(s){const c=super.toJSON(s);this.autoUpdate===!1&&(c.object.autoUpdate=!1),c.object.levels=[];const d=this.levels;for(let p=0,_=d.length;p<_;p++){const x=d[p];c.object.levels.push({object:x.object.uuid,distance:x.distance})}return c}}const F1=new de,k1=new Ri,N1=new Ri,SG=new de,U1=new $n;class z1 extends qs{constructor(s,c){super(s,c),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new $n,this.bindMatrixInverse=new $n}copy(s,c){return super.copy(s,c),this.bindMode=s.bindMode,this.bindMatrix.copy(s.bindMatrix),this.bindMatrixInverse.copy(s.bindMatrixInverse),this.skeleton=s.skeleton,this}bind(s,c){this.skeleton=s,c===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),c=this.matrixWorld),this.bindMatrix.copy(c),this.bindMatrixInverse.copy(c).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const s=new Ri,c=this.geometry.attributes.skinWeight;for(let d=0,p=c.count;d<p;d++){s.fromBufferAttribute(c,d);const _=1/s.manhattanLength();_!==1/0?s.multiplyScalar(_):s.set(1,0,0,0),c.setXYZW(d,s.x,s.y,s.z,s.w)}}updateMatrixWorld(s){super.updateMatrixWorld(s),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(s,c){const d=this.skeleton,p=this.geometry;k1.fromBufferAttribute(p.attributes.skinIndex,s),N1.fromBufferAttribute(p.attributes.skinWeight,s),F1.copy(c).applyMatrix4(this.bindMatrix),c.set(0,0,0);for(let _=0;_<4;_++){const x=N1.getComponent(_);if(x!==0){const C=k1.getComponent(_);U1.multiplyMatrices(d.bones[C].matrixWorld,d.boneInverses[C]),c.addScaledVector(SG.copy(F1).applyMatrix4(U1),x)}}return c.applyMatrix4(this.bindMatrixInverse)}}class Sx extends wi{constructor(){super(),this.isBone=!0,this.type="Bone"}}class fd extends Ps{constructor(s=null,c=1,d=1,p,_,x,C,P,L=pt,O=pt,k,N){super(null,x,C,P,L,O,p,_,k,N),this.isDataTexture=!0,this.image={data:s,width:c,height:d},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const G1=new $n,MG=new $n;class VA{constructor(s=[],c=[]){this.uuid=qr(),this.bones=s.slice(0),this.boneInverses=c,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const s=this.bones,c=this.boneInverses;if(this.boneMatrices=new Float32Array(s.length*16),c.length===0)this.calculateInverses();else if(s.length!==c.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let d=0,p=this.bones.length;d<p;d++)this.boneInverses.push(new $n)}}calculateInverses(){this.boneInverses.length=0;for(let s=0,c=this.bones.length;s<c;s++){const d=new $n;this.bones[s]&&d.copy(this.bones[s].matrixWorld).invert(),this.boneInverses.push(d)}}pose(){for(let s=0,c=this.bones.length;s<c;s++){const d=this.bones[s];d&&d.matrixWorld.copy(this.boneInverses[s]).invert()}for(let s=0,c=this.bones.length;s<c;s++){const d=this.bones[s];d&&(d.parent&&d.parent.isBone?(d.matrix.copy(d.parent.matrixWorld).invert(),d.matrix.multiply(d.matrixWorld)):d.matrix.copy(d.matrixWorld),d.matrix.decompose(d.position,d.quaternion,d.scale))}}update(){const s=this.bones,c=this.boneInverses,d=this.boneMatrices,p=this.boneTexture;for(let _=0,x=s.length;_<x;_++){const C=s[_]?s[_].matrixWorld:MG;G1.multiplyMatrices(C,c[_]),G1.toArray(d,_*16)}p!==null&&(p.needsUpdate=!0)}clone(){return new VA(this.bones,this.boneInverses)}computeBoneTexture(){let s=Math.sqrt(this.bones.length*4);s=OM(s),s=Math.max(s,4);const c=new Float32Array(s*s*4);c.set(this.boneMatrices);const d=new fd(c,s,s,ir,wn);return d.needsUpdate=!0,this.boneMatrices=c,this.boneTexture=d,this.boneTextureSize=s,this}getBoneByName(s){for(let c=0,d=this.bones.length;c<d;c++){const p=this.bones[c];if(p.name===s)return p}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(s,c){this.uuid=s.uuid;for(let d=0,p=s.bones.length;d<p;d++){const _=s.bones[d];let x=c[_];x===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",_),x=new Sx),this.bones.push(x),this.boneInverses.push(new $n().fromArray(s.boneInverses[d]))}return this.init(),this}toJSON(){const s={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};s.uuid=this.uuid;const c=this.bones,d=this.boneInverses;for(let p=0,_=c.length;p<_;p++){const x=c[p];s.bones.push(x.uuid);const C=d[p];s.boneInverses.push(C.toArray())}return s}}class pd extends Oi{constructor(s,c,d,p=1){super(s,c,d),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=p}copy(s){return super.copy(s),this.meshPerAttribute=s.meshPerAttribute,this}toJSON(){const s=super.toJSON();return s.meshPerAttribute=this.meshPerAttribute,s.isInstancedBufferAttribute=!0,s}}const H1=new $n,V1=new $n,WA=[],_p=new qs;class W1 extends qs{constructor(s,c,d){super(s,c),this.isInstancedMesh=!0,this.instanceMatrix=new pd(new Float32Array(d*16),16),this.instanceColor=null,this.count=d,this.frustumCulled=!1}copy(s,c){return super.copy(s,c),this.instanceMatrix.copy(s.instanceMatrix),s.instanceColor!==null&&(this.instanceColor=s.instanceColor.clone()),this.count=s.count,this}getColorAt(s,c){c.fromArray(this.instanceColor.array,s*3)}getMatrixAt(s,c){c.fromArray(this.instanceMatrix.array,s*16)}raycast(s,c){const d=this.matrixWorld,p=this.count;if(_p.geometry=this.geometry,_p.material=this.material,_p.material!==void 0)for(let _=0;_<p;_++){this.getMatrixAt(_,H1),V1.multiplyMatrices(d,H1),_p.matrixWorld=V1,_p.raycast(s,WA);for(let x=0,C=WA.length;x<C;x++){const P=WA[x];P.instanceId=_,P.object=this,c.push(P)}WA.length=0}}setColorAt(s,c){this.instanceColor===null&&(this.instanceColor=new pd(new Float32Array(this.instanceMatrix.count*3),3)),c.toArray(this.instanceColor.array,s*3)}setMatrixAt(s,c){c.toArray(this.instanceMatrix.array,s*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class yr extends rr{constructor(s){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new dn(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(s)}copy(s){return super.copy(s),this.color.copy(s.color),this.linewidth=s.linewidth,this.linecap=s.linecap,this.linejoin=s.linejoin,this.fog=s.fog,this}}const Q1=new de,j1=new de,q1=new $n,Mx=new hp,QA=new wh;class rl extends wi{constructor(s=new si,c=new yr){super(),this.isLine=!0,this.type="Line",this.geometry=s,this.material=c,this.updateMorphTargets()}copy(s,c){return super.copy(s,c),this.material=s.material,this.geometry=s.geometry,this}computeLineDistances(){const s=this.geometry;if(s.index===null){const c=s.attributes.position,d=[0];for(let p=1,_=c.count;p<_;p++)Q1.fromBufferAttribute(c,p-1),j1.fromBufferAttribute(c,p),d[p]=d[p-1],d[p]+=Q1.distanceTo(j1);s.setAttribute("lineDistance",new gn(d,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(s,c){const d=this.geometry,p=this.matrixWorld,_=s.params.Line.threshold,x=d.drawRange;if(d.boundingSphere===null&&d.computeBoundingSphere(),QA.copy(d.boundingSphere),QA.applyMatrix4(p),QA.radius+=_,s.ray.intersectsSphere(QA)===!1)return;q1.copy(p).invert(),Mx.copy(s.ray).applyMatrix4(q1);const C=_/((this.scale.x+this.scale.y+this.scale.z)/3),P=C*C,L=new de,O=new de,k=new de,N=new de,z=this.isLineSegments?2:1,V=d.index,G=d.attributes.position;if(V!==null){const X=Math.max(0,x.start),Z=Math.min(V.count,x.start+x.count);for(let ne=X,te=Z-1;ne<te;ne+=z){const oe=V.getX(ne),ue=V.getX(ne+1);if(L.fromBufferAttribute(G,oe),O.fromBufferAttribute(G,ue),Mx.distanceSqToSegment(L,O,N,k)>P)continue;N.applyMatrix4(this.matrixWorld);const $=s.ray.origin.distanceTo(N);$<s.near||$>s.far||c.push({distance:$,point:k.clone().applyMatrix4(this.matrixWorld),index:ne,face:null,faceIndex:null,object:this})}}else{const X=Math.max(0,x.start),Z=Math.min(G.count,x.start+x.count);for(let ne=X,te=Z-1;ne<te;ne+=z){if(L.fromBufferAttribute(G,ne),O.fromBufferAttribute(G,ne+1),Mx.distanceSqToSegment(L,O,N,k)>P)continue;N.applyMatrix4(this.matrixWorld);const ue=s.ray.origin.distanceTo(N);ue<s.near||ue>s.far||c.push({distance:ue,point:k.clone().applyMatrix4(this.matrixWorld),index:ne,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const c=this.geometry.morphAttributes,d=Object.keys(c);if(d.length>0){const p=c[d[0]];if(p!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let _=0,x=p.length;_<x;_++){const C=p[_].name||String(_);this.morphTargetInfluences.push(0),this.morphTargetDictionary[C]=_}}}}}const X1=new de,Y1=new de;class _a extends rl{constructor(s,c){super(s,c),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const s=this.geometry;if(s.index===null){const c=s.attributes.position,d=[];for(let p=0,_=c.count;p<_;p+=2)X1.fromBufferAttribute(c,p),Y1.fromBufferAttribute(c,p+1),d[p]=p===0?0:d[p-1],d[p+1]=d[p]+X1.distanceTo(Y1);s.setAttribute("lineDistance",new gn(d,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class J1 extends rl{constructor(s,c){super(s,c),this.isLineLoop=!0,this.type="LineLoop"}}class Tx extends rr{constructor(s){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new dn(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(s)}copy(s){return super.copy(s),this.color.copy(s.color),this.map=s.map,this.alphaMap=s.alphaMap,this.size=s.size,this.sizeAttenuation=s.sizeAttenuation,this.fog=s.fog,this}}const Z1=new $n,Ix=new hp,jA=new wh,qA=new de;class K1 extends wi{constructor(s=new si,c=new Tx){super(),this.isPoints=!0,this.type="Points",this.geometry=s,this.material=c,this.updateMorphTargets()}copy(s,c){return super.copy(s,c),this.material=s.material,this.geometry=s.geometry,this}raycast(s,c){const d=this.geometry,p=this.matrixWorld,_=s.params.Points.threshold,x=d.drawRange;if(d.boundingSphere===null&&d.computeBoundingSphere(),jA.copy(d.boundingSphere),jA.applyMatrix4(p),jA.radius+=_,s.ray.intersectsSphere(jA)===!1)return;Z1.copy(p).invert(),Ix.copy(s.ray).applyMatrix4(Z1);const C=_/((this.scale.x+this.scale.y+this.scale.z)/3),P=C*C,L=d.index,k=d.attributes.position;if(L!==null){const N=Math.max(0,x.start),z=Math.min(L.count,x.start+x.count);for(let V=N,H=z;V<H;V++){const G=L.getX(V);qA.fromBufferAttribute(k,G),$1(qA,G,P,p,s,c,this)}}else{const N=Math.max(0,x.start),z=Math.min(k.count,x.start+x.count);for(let V=N,H=z;V<H;V++)qA.fromBufferAttribute(k,V),$1(qA,V,P,p,s,c,this)}}updateMorphTargets(){const c=this.geometry.morphAttributes,d=Object.keys(c);if(d.length>0){const p=c[d[0]];if(p!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let _=0,x=p.length;_<x;_++){const C=p[_].name||String(_);this.morphTargetInfluences.push(0),this.morphTargetDictionary[C]=_}}}}}function $1(y,s,c,d,p,_,x){const C=Ix.distanceSqToPoint(y);if(C<c){const P=new de;Ix.closestPointToPoint(y,P),P.applyMatrix4(d);const L=p.ray.origin.distanceTo(P);if(L<p.near||L>p.far)return;_.push({distance:L,distanceToRay:Math.sqrt(C),point:P,index:s,face:null,object:x})}}class TG extends Ps{constructor(s,c,d,p,_,x,C,P,L){super(s,c,d,p,_,x,C,P,L),this.isVideoTexture=!0,this.minFilter=x!==void 0?x:bt,this.magFilter=_!==void 0?_:bt,this.generateMipmaps=!1;const O=this;function k(){O.needsUpdate=!0,s.requestVideoFrameCallback(k)}"requestVideoFrameCallback"in s&&s.requestVideoFrameCallback(k)}clone(){return new this.constructor(this.image).copy(this)}update(){const s=this.image;"requestVideoFrameCallback"in s===!1&&s.readyState>=s.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class IG extends Ps{constructor(s,c,d){super({width:s,height:c}),this.isFramebufferTexture=!0,this.format=d,this.magFilter=pt,this.minFilter=pt,this.generateMipmaps=!1,this.needsUpdate=!0}}class eT extends Ps{constructor(s,c,d,p,_,x,C,P,L,O,k,N){super(null,x,C,P,L,O,p,_,k,N),this.isCompressedTexture=!0,this.image={width:c,height:d},this.mipmaps=s,this.flipY=!1,this.generateMipmaps=!1}}class RG extends Ps{constructor(s,c,d,p,_,x,C,P,L){super(s,c,d,p,_,x,C,P,L),this.isCanvasTexture=!0,this.needsUpdate=!0}}class qo{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(s,c){const d=this.getUtoTmapping(s);return this.getPoint(d,c)}getPoints(s=5){const c=[];for(let d=0;d<=s;d++)c.push(this.getPoint(d/s));return c}getSpacedPoints(s=5){const c=[];for(let d=0;d<=s;d++)c.push(this.getPointAt(d/s));return c}getLength(){const s=this.getLengths();return s[s.length-1]}getLengths(s=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===s+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const c=[];let d,p=this.getPoint(0),_=0;c.push(0);for(let x=1;x<=s;x++)d=this.getPoint(x/s),_+=d.distanceTo(p),c.push(_),p=d;return this.cacheArcLengths=c,c}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(s,c){const d=this.getLengths();let p=0;const _=d.length;let x;c?x=c:x=s*d[_-1];let C=0,P=_-1,L;for(;C<=P;)if(p=Math.floor(C+(P-C)/2),L=d[p]-x,L<0)C=p+1;else if(L>0)P=p-1;else{P=p;break}if(p=P,d[p]===x)return p/(_-1);const O=d[p],N=d[p+1]-O,z=(x-O)/N;return(p+z)/(_-1)}getTangent(s,c){let p=s-1e-4,_=s+1e-4;p<0&&(p=0),_>1&&(_=1);const x=this.getPoint(p),C=this.getPoint(_),P=c||(x.isVector2?new mt:new de);return P.copy(C).sub(x).normalize(),P}getTangentAt(s,c){const d=this.getUtoTmapping(s);return this.getTangent(d,c)}computeFrenetFrames(s,c){const d=new de,p=[],_=[],x=[],C=new de,P=new $n;for(let z=0;z<=s;z++){const V=z/s;p[z]=this.getTangentAt(V,new de)}_[0]=new de,x[0]=new de;let L=Number.MAX_VALUE;const O=Math.abs(p[0].x),k=Math.abs(p[0].y),N=Math.abs(p[0].z);O<=L&&(L=O,d.set(1,0,0)),k<=L&&(L=k,d.set(0,1,0)),N<=L&&d.set(0,0,1),C.crossVectors(p[0],d).normalize(),_[0].crossVectors(p[0],C),x[0].crossVectors(p[0],_[0]);for(let z=1;z<=s;z++){if(_[z]=_[z-1].clone(),x[z]=x[z-1].clone(),C.crossVectors(p[z-1],p[z]),C.length()>Number.EPSILON){C.normalize();const V=Math.acos(ds(p[z-1].dot(p[z]),-1,1));_[z].applyMatrix4(P.makeRotationAxis(C,V))}x[z].crossVectors(p[z],_[z])}if(c===!0){let z=Math.acos(ds(_[0].dot(_[s]),-1,1));z/=s,p[0].dot(C.crossVectors(_[0],_[s]))>0&&(z=-z);for(let V=1;V<=s;V++)_[V].applyMatrix4(P.makeRotationAxis(p[V],z*V)),x[V].crossVectors(p[V],_[V])}return{tangents:p,normals:_,binormals:x}}clone(){return new this.constructor().copy(this)}copy(s){return this.arcLengthDivisions=s.arcLengthDivisions,this}toJSON(){const s={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return s.arcLengthDivisions=this.arcLengthDivisions,s.type=this.type,s}fromJSON(s){return this.arcLengthDivisions=s.arcLengthDivisions,this}}class XA extends qo{constructor(s=0,c=0,d=1,p=1,_=0,x=Math.PI*2,C=!1,P=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=s,this.aY=c,this.xRadius=d,this.yRadius=p,this.aStartAngle=_,this.aEndAngle=x,this.aClockwise=C,this.aRotation=P}getPoint(s,c){const d=c||new mt,p=Math.PI*2;let _=this.aEndAngle-this.aStartAngle;const x=Math.abs(_)<Number.EPSILON;for(;_<0;)_+=p;for(;_>p;)_-=p;_<Number.EPSILON&&(x?_=0:_=p),this.aClockwise===!0&&!x&&(_===p?_=-p:_=_-p);const C=this.aStartAngle+s*_;let P=this.aX+this.xRadius*Math.cos(C),L=this.aY+this.yRadius*Math.sin(C);if(this.aRotation!==0){const O=Math.cos(this.aRotation),k=Math.sin(this.aRotation),N=P-this.aX,z=L-this.aY;P=N*O-z*k+this.aX,L=N*k+z*O+this.aY}return d.set(P,L)}copy(s){return super.copy(s),this.aX=s.aX,this.aY=s.aY,this.xRadius=s.xRadius,this.yRadius=s.yRadius,this.aStartAngle=s.aStartAngle,this.aEndAngle=s.aEndAngle,this.aClockwise=s.aClockwise,this.aRotation=s.aRotation,this}toJSON(){const s=super.toJSON();return s.aX=this.aX,s.aY=this.aY,s.xRadius=this.xRadius,s.yRadius=this.yRadius,s.aStartAngle=this.aStartAngle,s.aEndAngle=this.aEndAngle,s.aClockwise=this.aClockwise,s.aRotation=this.aRotation,s}fromJSON(s){return super.fromJSON(s),this.aX=s.aX,this.aY=s.aY,this.xRadius=s.xRadius,this.yRadius=s.yRadius,this.aStartAngle=s.aStartAngle,this.aEndAngle=s.aEndAngle,this.aClockwise=s.aClockwise,this.aRotation=s.aRotation,this}}class tT extends XA{constructor(s,c,d,p,_,x){super(s,c,d,d,p,_,x),this.isArcCurve=!0,this.type="ArcCurve"}}function Rx(){let y=0,s=0,c=0,d=0;function p(_,x,C,P){y=_,s=C,c=-3*_+3*x-2*C-P,d=2*_-2*x+C+P}return{initCatmullRom:function(_,x,C,P,L){p(x,C,L*(C-_),L*(P-x))},initNonuniformCatmullRom:function(_,x,C,P,L,O,k){let N=(x-_)/L-(C-_)/(L+O)+(C-x)/O,z=(C-x)/O-(P-x)/(O+k)+(P-C)/k;N*=O,z*=O,p(x,C,N,z)},calc:function(_){const x=_*_,C=x*_;return y+s*_+c*x+d*C}}}const YA=new de,Px=new Rx,Bx=new Rx,Lx=new Rx;class nT extends qo{constructor(s=[],c=!1,d="centripetal",p=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=s,this.closed=c,this.curveType=d,this.tension=p}getPoint(s,c=new de){const d=c,p=this.points,_=p.length,x=(_-(this.closed?0:1))*s;let C=Math.floor(x),P=x-C;this.closed?C+=C>0?0:(Math.floor(Math.abs(C)/_)+1)*_:P===0&&C===_-1&&(C=_-2,P=1);let L,O;this.closed||C>0?L=p[(C-1)%_]:(YA.subVectors(p[0],p[1]).add(p[0]),L=YA);const k=p[C%_],N=p[(C+1)%_];if(this.closed||C+2<_?O=p[(C+2)%_]:(YA.subVectors(p[_-1],p[_-2]).add(p[_-1]),O=YA),this.curveType==="centripetal"||this.curveType==="chordal"){const z=this.curveType==="chordal"?.5:.25;let V=Math.pow(L.distanceToSquared(k),z),H=Math.pow(k.distanceToSquared(N),z),G=Math.pow(N.distanceToSquared(O),z);H<1e-4&&(H=1),V<1e-4&&(V=H),G<1e-4&&(G=H),Px.initNonuniformCatmullRom(L.x,k.x,N.x,O.x,V,H,G),Bx.initNonuniformCatmullRom(L.y,k.y,N.y,O.y,V,H,G),Lx.initNonuniformCatmullRom(L.z,k.z,N.z,O.z,V,H,G)}else this.curveType==="catmullrom"&&(Px.initCatmullRom(L.x,k.x,N.x,O.x,this.tension),Bx.initCatmullRom(L.y,k.y,N.y,O.y,this.tension),Lx.initCatmullRom(L.z,k.z,N.z,O.z,this.tension));return d.set(Px.calc(P),Bx.calc(P),Lx.calc(P)),d}copy(s){super.copy(s),this.points=[];for(let c=0,d=s.points.length;c<d;c++){const p=s.points[c];this.points.push(p.clone())}return this.closed=s.closed,this.curveType=s.curveType,this.tension=s.tension,this}toJSON(){const s=super.toJSON();s.points=[];for(let c=0,d=this.points.length;c<d;c++){const p=this.points[c];s.points.push(p.toArray())}return s.closed=this.closed,s.curveType=this.curveType,s.tension=this.tension,s}fromJSON(s){super.fromJSON(s),this.points=[];for(let c=0,d=s.points.length;c<d;c++){const p=s.points[c];this.points.push(new de().fromArray(p))}return this.closed=s.closed,this.curveType=s.curveType,this.tension=s.tension,this}}function iT(y,s,c,d,p){const _=(d-s)*.5,x=(p-c)*.5,C=y*y,P=y*C;return(2*c-2*d+_+x)*P+(-3*c+3*d-2*_-x)*C+_*y+c}function PG(y,s){const c=1-y;return c*c*s}function BG(y,s){return 2*(1-y)*y*s}function LG(y,s){return y*y*s}function yp(y,s,c,d){return PG(y,s)+BG(y,c)+LG(y,d)}function DG(y,s){const c=1-y;return c*c*c*s}function OG(y,s){const c=1-y;return 3*c*c*y*s}function FG(y,s){return 3*(1-y)*y*y*s}function kG(y,s){return y*y*y*s}function vp(y,s,c,d,p){return DG(y,s)+OG(y,c)+FG(y,d)+kG(y,p)}class Dx extends qo{constructor(s=new mt,c=new mt,d=new mt,p=new mt){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=s,this.v1=c,this.v2=d,this.v3=p}getPoint(s,c=new mt){const d=c,p=this.v0,_=this.v1,x=this.v2,C=this.v3;return d.set(vp(s,p.x,_.x,x.x,C.x),vp(s,p.y,_.y,x.y,C.y)),d}copy(s){return super.copy(s),this.v0.copy(s.v0),this.v1.copy(s.v1),this.v2.copy(s.v2),this.v3.copy(s.v3),this}toJSON(){const s=super.toJSON();return s.v0=this.v0.toArray(),s.v1=this.v1.toArray(),s.v2=this.v2.toArray(),s.v3=this.v3.toArray(),s}fromJSON(s){return super.fromJSON(s),this.v0.fromArray(s.v0),this.v1.fromArray(s.v1),this.v2.fromArray(s.v2),this.v3.fromArray(s.v3),this}}class sT extends qo{constructor(s=new de,c=new de,d=new de,p=new de){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=s,this.v1=c,this.v2=d,this.v3=p}getPoint(s,c=new de){const d=c,p=this.v0,_=this.v1,x=this.v2,C=this.v3;return d.set(vp(s,p.x,_.x,x.x,C.x),vp(s,p.y,_.y,x.y,C.y),vp(s,p.z,_.z,x.z,C.z)),d}copy(s){return super.copy(s),this.v0.copy(s.v0),this.v1.copy(s.v1),this.v2.copy(s.v2),this.v3.copy(s.v3),this}toJSON(){const s=super.toJSON();return s.v0=this.v0.toArray(),s.v1=this.v1.toArray(),s.v2=this.v2.toArray(),s.v3=this.v3.toArray(),s}fromJSON(s){return super.fromJSON(s),this.v0.fromArray(s.v0),this.v1.fromArray(s.v1),this.v2.fromArray(s.v2),this.v3.fromArray(s.v3),this}}class JA extends qo{constructor(s=new mt,c=new mt){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=s,this.v2=c}getPoint(s,c=new mt){const d=c;return s===1?d.copy(this.v2):(d.copy(this.v2).sub(this.v1),d.multiplyScalar(s).add(this.v1)),d}getPointAt(s,c){return this.getPoint(s,c)}getTangent(s,c){const d=c||new mt;return d.copy(this.v2).sub(this.v1).normalize(),d}copy(s){return super.copy(s),this.v1.copy(s.v1),this.v2.copy(s.v2),this}toJSON(){const s=super.toJSON();return s.v1=this.v1.toArray(),s.v2=this.v2.toArray(),s}fromJSON(s){return super.fromJSON(s),this.v1.fromArray(s.v1),this.v2.fromArray(s.v2),this}}class rT extends qo{constructor(s=new de,c=new de){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=s,this.v2=c}getPoint(s,c=new de){const d=c;return s===1?d.copy(this.v2):(d.copy(this.v2).sub(this.v1),d.multiplyScalar(s).add(this.v1)),d}getPointAt(s,c){return this.getPoint(s,c)}copy(s){return super.copy(s),this.v1.copy(s.v1),this.v2.copy(s.v2),this}toJSON(){const s=super.toJSON();return s.v1=this.v1.toArray(),s.v2=this.v2.toArray(),s}fromJSON(s){return super.fromJSON(s),this.v1.fromArray(s.v1),this.v2.fromArray(s.v2),this}}class Ox extends qo{constructor(s=new mt,c=new mt,d=new mt){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=s,this.v1=c,this.v2=d}getPoint(s,c=new mt){const d=c,p=this.v0,_=this.v1,x=this.v2;return d.set(yp(s,p.x,_.x,x.x),yp(s,p.y,_.y,x.y)),d}copy(s){return super.copy(s),this.v0.copy(s.v0),this.v1.copy(s.v1),this.v2.copy(s.v2),this}toJSON(){const s=super.toJSON();return s.v0=this.v0.toArray(),s.v1=this.v1.toArray(),s.v2=this.v2.toArray(),s}fromJSON(s){return super.fromJSON(s),this.v0.fromArray(s.v0),this.v1.fromArray(s.v1),this.v2.fromArray(s.v2),this}}class Fx extends qo{constructor(s=new de,c=new de,d=new de){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=s,this.v1=c,this.v2=d}getPoint(s,c=new de){const d=c,p=this.v0,_=this.v1,x=this.v2;return d.set(yp(s,p.x,_.x,x.x),yp(s,p.y,_.y,x.y),yp(s,p.z,_.z,x.z)),d}copy(s){return super.copy(s),this.v0.copy(s.v0),this.v1.copy(s.v1),this.v2.copy(s.v2),this}toJSON(){const s=super.toJSON();return s.v0=this.v0.toArray(),s.v1=this.v1.toArray(),s.v2=this.v2.toArray(),s}fromJSON(s){return super.fromJSON(s),this.v0.fromArray(s.v0),this.v1.fromArray(s.v1),this.v2.fromArray(s.v2),this}}class kx extends qo{constructor(s=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=s}getPoint(s,c=new mt){const d=c,p=this.points,_=(p.length-1)*s,x=Math.floor(_),C=_-x,P=p[x===0?x:x-1],L=p[x],O=p[x>p.length-2?p.length-1:x+1],k=p[x>p.length-3?p.length-1:x+2];return d.set(iT(C,P.x,L.x,O.x,k.x),iT(C,P.y,L.y,O.y,k.y)),d}copy(s){super.copy(s),this.points=[];for(let c=0,d=s.points.length;c<d;c++){const p=s.points[c];this.points.push(p.clone())}return this}toJSON(){const s=super.toJSON();s.points=[];for(let c=0,d=this.points.length;c<d;c++){const p=this.points[c];s.points.push(p.toArray())}return s}fromJSON(s){super.fromJSON(s),this.points=[];for(let c=0,d=s.points.length;c<d;c++){const p=s.points[c];this.points.push(new mt().fromArray(p))}return this}}var Nx=Object.freeze({__proto__:null,ArcCurve:tT,CatmullRomCurve3:nT,CubicBezierCurve:Dx,CubicBezierCurve3:sT,EllipseCurve:XA,LineCurve:JA,LineCurve3:rT,QuadraticBezierCurve:Ox,QuadraticBezierCurve3:Fx,SplineCurve:kx});class oT extends qo{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(s){this.curves.push(s)}closePath(){const s=this.curves[0].getPoint(0),c=this.curves[this.curves.length-1].getPoint(1);s.equals(c)||this.curves.push(new JA(c,s))}getPoint(s,c){const d=s*this.getLength(),p=this.getCurveLengths();let _=0;for(;_<p.length;){if(p[_]>=d){const x=p[_]-d,C=this.curves[_],P=C.getLength(),L=P===0?0:1-x/P;return C.getPointAt(L,c)}_++}return null}getLength(){const s=this.getCurveLengths();return s[s.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const s=[];let c=0;for(let d=0,p=this.curves.length;d<p;d++)c+=this.curves[d].getLength(),s.push(c);return this.cacheLengths=s,s}getSpacedPoints(s=40){const c=[];for(let d=0;d<=s;d++)c.push(this.getPoint(d/s));return this.autoClose&&c.push(c[0]),c}getPoints(s=12){const c=[];let d;for(let p=0,_=this.curves;p<_.length;p++){const x=_[p],C=x.isEllipseCurve?s*2:x.isLineCurve||x.isLineCurve3?1:x.isSplineCurve?s*x.points.length:s,P=x.getPoints(C);for(let L=0;L<P.length;L++){const O=P[L];d&&d.equals(O)||(c.push(O),d=O)}}return this.autoClose&&c.length>1&&!c[c.length-1].equals(c[0])&&c.push(c[0]),c}copy(s){super.copy(s),this.curves=[];for(let c=0,d=s.curves.length;c<d;c++){const p=s.curves[c];this.curves.push(p.clone())}return this.autoClose=s.autoClose,this}toJSON(){const s=super.toJSON();s.autoClose=this.autoClose,s.curves=[];for(let c=0,d=this.curves.length;c<d;c++){const p=this.curves[c];s.curves.push(p.toJSON())}return s}fromJSON(s){super.fromJSON(s),this.autoClose=s.autoClose,this.curves=[];for(let c=0,d=s.curves.length;c<d;c++){const p=s.curves[c];this.curves.push(new Nx[p.type]().fromJSON(p))}return this}}class xp extends oT{constructor(s){super(),this.type="Path",this.currentPoint=new mt,s&&this.setFromPoints(s)}setFromPoints(s){this.moveTo(s[0].x,s[0].y);for(let c=1,d=s.length;c<d;c++)this.lineTo(s[c].x,s[c].y);return this}moveTo(s,c){return this.currentPoint.set(s,c),this}lineTo(s,c){const d=new JA(this.currentPoint.clone(),new mt(s,c));return this.curves.push(d),this.currentPoint.set(s,c),this}quadraticCurveTo(s,c,d,p){const _=new Ox(this.currentPoint.clone(),new mt(s,c),new mt(d,p));return this.curves.push(_),this.currentPoint.set(d,p),this}bezierCurveTo(s,c,d,p,_,x){const C=new Dx(this.currentPoint.clone(),new mt(s,c),new mt(d,p),new mt(_,x));return this.curves.push(C),this.currentPoint.set(_,x),this}splineThru(s){const c=[this.currentPoint.clone()].concat(s),d=new kx(c);return this.curves.push(d),this.currentPoint.copy(s[s.length-1]),this}arc(s,c,d,p,_,x){const C=this.currentPoint.x,P=this.currentPoint.y;return this.absarc(s+C,c+P,d,p,_,x),this}absarc(s,c,d,p,_,x){return this.absellipse(s,c,d,d,p,_,x),this}ellipse(s,c,d,p,_,x,C,P){const L=this.currentPoint.x,O=this.currentPoint.y;return this.absellipse(s+L,c+O,d,p,_,x,C,P),this}absellipse(s,c,d,p,_,x,C,P){const L=new XA(s,c,d,p,_,x,C,P);if(this.curves.length>0){const k=L.getPoint(0);k.equals(this.currentPoint)||this.lineTo(k.x,k.y)}this.curves.push(L);const O=L.getPoint(1);return this.currentPoint.copy(O),this}copy(s){return super.copy(s),this.currentPoint.copy(s.currentPoint),this}toJSON(){const s=super.toJSON();return s.currentPoint=this.currentPoint.toArray(),s}fromJSON(s){return super.fromJSON(s),this.currentPoint.fromArray(s.currentPoint),this}}class md extends si{constructor(s=[new mt(0,-.5),new mt(.5,0),new mt(0,.5)],c=12,d=0,p=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:s,segments:c,phiStart:d,phiLength:p},c=Math.floor(c),p=ds(p,0,Math.PI*2);const _=[],x=[],C=[],P=[],L=[],O=1/c,k=new de,N=new mt,z=new de,V=new de,H=new de;let G=0,X=0;for(let Z=0;Z<=s.length-1;Z++)switch(Z){case 0:G=s[Z+1].x-s[Z].x,X=s[Z+1].y-s[Z].y,z.x=X*1,z.y=-G,z.z=X*0,H.copy(z),z.normalize(),P.push(z.x,z.y,z.z);break;case s.length-1:P.push(H.x,H.y,H.z);break;default:G=s[Z+1].x-s[Z].x,X=s[Z+1].y-s[Z].y,z.x=X*1,z.y=-G,z.z=X*0,V.copy(z),z.x+=H.x,z.y+=H.y,z.z+=H.z,z.normalize(),P.push(z.x,z.y,z.z),H.copy(V)}for(let Z=0;Z<=c;Z++){const ne=d+Z*O*p,te=Math.sin(ne),oe=Math.cos(ne);for(let ue=0;ue<=s.length-1;ue++){k.x=s[ue].x*te,k.y=s[ue].y,k.z=s[ue].x*oe,x.push(k.x,k.y,k.z),N.x=Z/c,N.y=ue/(s.length-1),C.push(N.x,N.y);const be=P[3*ue+0]*te,$=P[3*ue+1],ge=P[3*ue+0]*oe;L.push(be,$,ge)}}for(let Z=0;Z<c;Z++)for(let ne=0;ne<s.length-1;ne++){const te=ne+Z*s.length,oe=te,ue=te+s.length,be=te+s.length+1,$=te+1;_.push(oe,ue,$),_.push(be,$,ue)}this.setIndex(_),this.setAttribute("position",new gn(x,3)),this.setAttribute("uv",new gn(C,2)),this.setAttribute("normal",new gn(L,3))}static fromJSON(s){return new md(s.points,s.segments,s.phiStart,s.phiLength)}}class wp extends md{constructor(s=1,c=1,d=4,p=8){const _=new xp;_.absarc(0,-c/2,s,Math.PI*1.5,0),_.absarc(0,c/2,s,0,Math.PI*.5),super(_.getPoints(d),p),this.type="CapsuleGeometry",this.parameters={radius:s,height:c,capSegments:d,radialSegments:p}}static fromJSON(s){return new wp(s.radius,s.length,s.capSegments,s.radialSegments)}}class bp extends si{constructor(s=1,c=8,d=0,p=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:s,segments:c,thetaStart:d,thetaLength:p},c=Math.max(3,c);const _=[],x=[],C=[],P=[],L=new de,O=new mt;x.push(0,0,0),C.push(0,0,1),P.push(.5,.5);for(let k=0,N=3;k<=c;k++,N+=3){const z=d+k/c*p;L.x=s*Math.cos(z),L.y=s*Math.sin(z),x.push(L.x,L.y,L.z),C.push(0,0,1),O.x=(x[N]/s+1)/2,O.y=(x[N+1]/s+1)/2,P.push(O.x,O.y)}for(let k=1;k<=c;k++)_.push(k,k+1,0);this.setIndex(_),this.setAttribute("position",new gn(x,3)),this.setAttribute("normal",new gn(C,3)),this.setAttribute("uv",new gn(P,2))}static fromJSON(s){return new bp(s.radius,s.segments,s.thetaStart,s.thetaLength)}}class Sh extends si{constructor(s=1,c=1,d=1,p=8,_=1,x=!1,C=0,P=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:s,radiusBottom:c,height:d,radialSegments:p,heightSegments:_,openEnded:x,thetaStart:C,thetaLength:P};const L=this;p=Math.floor(p),_=Math.floor(_);const O=[],k=[],N=[],z=[];let V=0;const H=[],G=d/2;let X=0;Z(),x===!1&&(s>0&&ne(!0),c>0&&ne(!1)),this.setIndex(O),this.setAttribute("position",new gn(k,3)),this.setAttribute("normal",new gn(N,3)),this.setAttribute("uv",new gn(z,2));function Z(){const te=new de,oe=new de;let ue=0;const be=(c-s)/d;for(let $=0;$<=_;$++){const ge=[],Se=$/_,et=Se*(c-s)+s;for(let Mt=0;Mt<=p;Mt++){const Ye=Mt/p,Oe=Ye*P+C,rt=Math.sin(Oe),gt=Math.cos(Oe);oe.x=et*rt,oe.y=-Se*d+G,oe.z=et*gt,k.push(oe.x,oe.y,oe.z),te.set(rt,be,gt).normalize(),N.push(te.x,te.y,te.z),z.push(Ye,1-Se),ge.push(V++)}H.push(ge)}for(let $=0;$<p;$++)for(let ge=0;ge<_;ge++){const Se=H[ge][$],et=H[ge+1][$],Mt=H[ge+1][$+1],Ye=H[ge][$+1];O.push(Se,et,Ye),O.push(et,Mt,Ye),ue+=6}L.addGroup(X,ue,0),X+=ue}function ne(te){const oe=V,ue=new mt,be=new de;let $=0;const ge=te===!0?s:c,Se=te===!0?1:-1;for(let Mt=1;Mt<=p;Mt++)k.push(0,G*Se,0),N.push(0,Se,0),z.push(.5,.5),V++;const et=V;for(let Mt=0;Mt<=p;Mt++){const Oe=Mt/p*P+C,rt=Math.cos(Oe),gt=Math.sin(Oe);be.x=ge*gt,be.y=G*Se,be.z=ge*rt,k.push(be.x,be.y,be.z),N.push(0,Se,0),ue.x=rt*.5+.5,ue.y=gt*.5*Se+.5,z.push(ue.x,ue.y),V++}for(let Mt=0;Mt<p;Mt++){const Ye=oe+Mt,Oe=et+Mt;te===!0?O.push(Oe,Oe+1,Ye):O.push(Oe+1,Oe,Ye),$+=3}L.addGroup(X,$,te===!0?1:2),X+=$}}static fromJSON(s){return new Sh(s.radiusTop,s.radiusBottom,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength)}}class Ep extends Sh{constructor(s=1,c=1,d=8,p=1,_=!1,x=0,C=Math.PI*2){super(0,s,c,d,p,_,x,C),this.type="ConeGeometry",this.parameters={radius:s,height:c,radialSegments:d,heightSegments:p,openEnded:_,thetaStart:x,thetaLength:C}}static fromJSON(s){return new Ep(s.radius,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength)}}class sc extends si{constructor(s=[],c=[],d=1,p=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:s,indices:c,radius:d,detail:p};const _=[],x=[];C(p),L(d),O(),this.setAttribute("position",new gn(_,3)),this.setAttribute("normal",new gn(_.slice(),3)),this.setAttribute("uv",new gn(x,2)),p===0?this.computeVertexNormals():this.normalizeNormals();function C(Z){const ne=new de,te=new de,oe=new de;for(let ue=0;ue<c.length;ue+=3)z(c[ue+0],ne),z(c[ue+1],te),z(c[ue+2],oe),P(ne,te,oe,Z)}function P(Z,ne,te,oe){const ue=oe+1,be=[];for(let $=0;$<=ue;$++){be[$]=[];const ge=Z.clone().lerp(te,$/ue),Se=ne.clone().lerp(te,$/ue),et=ue-$;for(let Mt=0;Mt<=et;Mt++)Mt===0&&$===ue?be[$][Mt]=ge:be[$][Mt]=ge.clone().lerp(Se,Mt/et)}for(let $=0;$<ue;$++)for(let ge=0;ge<2*(ue-$)-1;ge++){const Se=Math.floor(ge/2);ge%2===0?(N(be[$][Se+1]),N(be[$+1][Se]),N(be[$][Se])):(N(be[$][Se+1]),N(be[$+1][Se+1]),N(be[$+1][Se]))}}function L(Z){const ne=new de;for(let te=0;te<_.length;te+=3)ne.x=_[te+0],ne.y=_[te+1],ne.z=_[te+2],ne.normalize().multiplyScalar(Z),_[te+0]=ne.x,_[te+1]=ne.y,_[te+2]=ne.z}function O(){const Z=new de;for(let ne=0;ne<_.length;ne+=3){Z.x=_[ne+0],Z.y=_[ne+1],Z.z=_[ne+2];const te=G(Z)/2/Math.PI+.5,oe=X(Z)/Math.PI+.5;x.push(te,1-oe)}V(),k()}function k(){for(let Z=0;Z<x.length;Z+=6){const ne=x[Z+0],te=x[Z+2],oe=x[Z+4],ue=Math.max(ne,te,oe),be=Math.min(ne,te,oe);ue>.9&&be<.1&&(ne<.2&&(x[Z+0]+=1),te<.2&&(x[Z+2]+=1),oe<.2&&(x[Z+4]+=1))}}function N(Z){_.push(Z.x,Z.y,Z.z)}function z(Z,ne){const te=Z*3;ne.x=s[te+0],ne.y=s[te+1],ne.z=s[te+2]}function V(){const Z=new de,ne=new de,te=new de,oe=new de,ue=new mt,be=new mt,$=new mt;for(let ge=0,Se=0;ge<_.length;ge+=9,Se+=6){Z.set(_[ge+0],_[ge+1],_[ge+2]),ne.set(_[ge+3],_[ge+4],_[ge+5]),te.set(_[ge+6],_[ge+7],_[ge+8]),ue.set(x[Se+0],x[Se+1]),be.set(x[Se+2],x[Se+3]),$.set(x[Se+4],x[Se+5]),oe.copy(Z).add(ne).add(te).divideScalar(3);const et=G(oe);H(ue,Se+0,Z,et),H(be,Se+2,ne,et),H($,Se+4,te,et)}}function H(Z,ne,te,oe){oe<0&&Z.x===1&&(x[ne]=Z.x-1),te.x===0&&te.z===0&&(x[ne]=oe/2/Math.PI+.5)}function G(Z){return Math.atan2(Z.z,-Z.x)}function X(Z){return Math.atan2(-Z.y,Math.sqrt(Z.x*Z.x+Z.z*Z.z))}}static fromJSON(s){return new sc(s.vertices,s.indices,s.radius,s.details)}}class Cp extends sc{constructor(s=1,c=0){const d=(1+Math.sqrt(5))/2,p=1/d,_=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-p,-d,0,-p,d,0,p,-d,0,p,d,-p,-d,0,-p,d,0,p,-d,0,p,d,0,-d,0,-p,d,0,-p,-d,0,p,d,0,p],x=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(_,x,s,c),this.type="DodecahedronGeometry",this.parameters={radius:s,detail:c}}static fromJSON(s){return new Cp(s.radius,s.detail)}}const ZA=new de,KA=new de,Ux=new de,$A=new yo;class aT extends si{constructor(s=null,c=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:s,thresholdAngle:c},s!==null){const p=Math.pow(10,4),_=Math.cos(mh*c),x=s.getIndex(),C=s.getAttribute("position"),P=x?x.count:C.count,L=[0,0,0],O=["a","b","c"],k=new Array(3),N={},z=[];for(let V=0;V<P;V+=3){x?(L[0]=x.getX(V),L[1]=x.getX(V+1),L[2]=x.getX(V+2)):(L[0]=V,L[1]=V+1,L[2]=V+2);const{a:H,b:G,c:X}=$A;if(H.fromBufferAttribute(C,L[0]),G.fromBufferAttribute(C,L[1]),X.fromBufferAttribute(C,L[2]),$A.getNormal(Ux),k[0]=`${Math.round(H.x*p)},${Math.round(H.y*p)},${Math.round(H.z*p)}`,k[1]=`${Math.round(G.x*p)},${Math.round(G.y*p)},${Math.round(G.z*p)}`,k[2]=`${Math.round(X.x*p)},${Math.round(X.y*p)},${Math.round(X.z*p)}`,!(k[0]===k[1]||k[1]===k[2]||k[2]===k[0]))for(let Z=0;Z<3;Z++){const ne=(Z+1)%3,te=k[Z],oe=k[ne],ue=$A[O[Z]],be=$A[O[ne]],$=`${te}_${oe}`,ge=`${oe}_${te}`;ge in N&&N[ge]?(Ux.dot(N[ge].normal)<=_&&(z.push(ue.x,ue.y,ue.z),z.push(be.x,be.y,be.z)),N[ge]=null):$ in N||(N[$]={index0:L[Z],index1:L[ne],normal:Ux.clone()})}}for(const V in N)if(N[V]){const{index0:H,index1:G}=N[V];ZA.fromBufferAttribute(C,H),KA.fromBufferAttribute(C,G),z.push(ZA.x,ZA.y,ZA.z),z.push(KA.x,KA.y,KA.z)}this.setAttribute("position",new gn(z,3))}}}class Mh extends xp{constructor(s){super(s),this.uuid=qr(),this.type="Shape",this.holes=[]}getPointsHoles(s){const c=[];for(let d=0,p=this.holes.length;d<p;d++)c[d]=this.holes[d].getPoints(s);return c}extractPoints(s){return{shape:this.getPoints(s),holes:this.getPointsHoles(s)}}copy(s){super.copy(s),this.holes=[];for(let c=0,d=s.holes.length;c<d;c++){const p=s.holes[c];this.holes.push(p.clone())}return this}toJSON(){const s=super.toJSON();s.uuid=this.uuid,s.holes=[];for(let c=0,d=this.holes.length;c<d;c++){const p=this.holes[c];s.holes.push(p.toJSON())}return s}fromJSON(s){super.fromJSON(s),this.uuid=s.uuid,this.holes=[];for(let c=0,d=s.holes.length;c<d;c++){const p=s.holes[c];this.holes.push(new xp().fromJSON(p))}return this}}const NG={triangulate:function(y,s,c=2){const d=s&&s.length,p=d?s[0]*c:y.length;let _=cT(y,0,p,c,!0);const x=[];if(!_||_.next===_.prev)return x;let C,P,L,O,k,N,z;if(d&&(_=VG(y,s,_,c)),y.length>80*c){C=L=y[0],P=O=y[1];for(let V=c;V<p;V+=c)k=y[V],N=y[V+1],k<C&&(C=k),N<P&&(P=N),k>L&&(L=k),N>O&&(O=N);z=Math.max(L-C,O-P),z=z!==0?1/z:0}return Sp(_,x,c,C,P,z),x}};function cT(y,s,c,d,p){let _,x;if(p===e4(y,s,c,d)>0)for(_=s;_<c;_+=d)x=uT(_,y[_],y[_+1],x);else for(_=c-d;_>=s;_-=d)x=uT(_,y[_],y[_+1],x);return x&&e0(x,x.next)&&(Tp(x),x=x.next),x}function ol(y,s){if(!y)return y;s||(s=y);let c=y,d;do if(d=!1,!c.steiner&&(e0(c,c.next)||es(c.prev,c,c.next)===0)){if(Tp(c),c=s=c.prev,c===c.next)break;d=!0}else c=c.next;while(d||c!==s);return s}function Sp(y,s,c,d,p,_,x){if(!y)return;!x&&_&&XG(y,d,p,_);let C=y,P,L;for(;y.prev!==y.next;){if(P=y.prev,L=y.next,_?zG(y,d,p,_):UG(y)){s.push(P.i/c),s.push(y.i/c),s.push(L.i/c),Tp(y),y=L.next,C=L.next;continue}if(y=L,y===C){x?x===1?(y=GG(ol(y),s,c),Sp(y,s,c,d,p,_,2)):x===2&&HG(y,s,c,d,p,_):Sp(ol(y),s,c,d,p,_,1);break}}}function UG(y){const s=y.prev,c=y,d=y.next;if(es(s,c,d)>=0)return!1;let p=y.next.next;for(;p!==y.prev;){if(gd(s.x,s.y,c.x,c.y,d.x,d.y,p.x,p.y)&&es(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function zG(y,s,c,d){const p=y.prev,_=y,x=y.next;if(es(p,_,x)>=0)return!1;const C=p.x<_.x?p.x<x.x?p.x:x.x:_.x<x.x?_.x:x.x,P=p.y<_.y?p.y<x.y?p.y:x.y:_.y<x.y?_.y:x.y,L=p.x>_.x?p.x>x.x?p.x:x.x:_.x>x.x?_.x:x.x,O=p.y>_.y?p.y>x.y?p.y:x.y:_.y>x.y?_.y:x.y,k=zx(C,P,s,c,d),N=zx(L,O,s,c,d);let z=y.prevZ,V=y.nextZ;for(;z&&z.z>=k&&V&&V.z<=N;){if(z!==y.prev&&z!==y.next&&gd(p.x,p.y,_.x,_.y,x.x,x.y,z.x,z.y)&&es(z.prev,z,z.next)>=0||(z=z.prevZ,V!==y.prev&&V!==y.next&&gd(p.x,p.y,_.x,_.y,x.x,x.y,V.x,V.y)&&es(V.prev,V,V.next)>=0))return!1;V=V.nextZ}for(;z&&z.z>=k;){if(z!==y.prev&&z!==y.next&&gd(p.x,p.y,_.x,_.y,x.x,x.y,z.x,z.y)&&es(z.prev,z,z.next)>=0)return!1;z=z.prevZ}for(;V&&V.z<=N;){if(V!==y.prev&&V!==y.next&&gd(p.x,p.y,_.x,_.y,x.x,x.y,V.x,V.y)&&es(V.prev,V,V.next)>=0)return!1;V=V.nextZ}return!0}function GG(y,s,c){let d=y;do{const p=d.prev,_=d.next.next;!e0(p,_)&&lT(p,d,d.next,_)&&Mp(p,_)&&Mp(_,p)&&(s.push(p.i/c),s.push(d.i/c),s.push(_.i/c),Tp(d),Tp(d.next),d=y=_),d=d.next}while(d!==y);return ol(d)}function HG(y,s,c,d,p,_){let x=y;do{let C=x.next.next;for(;C!==x.prev;){if(x.i!==C.i&&ZG(x,C)){let P=hT(x,C);x=ol(x,x.next),P=ol(P,P.next),Sp(x,s,c,d,p,_),Sp(P,s,c,d,p,_);return}C=C.next}x=x.next}while(x!==y)}function VG(y,s,c,d){const p=[];let _,x,C,P,L;for(_=0,x=s.length;_<x;_++)C=s[_]*d,P=_<x-1?s[_+1]*d:y.length,L=cT(y,C,P,d,!1),L===L.next&&(L.steiner=!0),p.push(JG(L));for(p.sort(WG),_=0;_<p.length;_++)QG(p[_],c),c=ol(c,c.next);return c}function WG(y,s){return y.x-s.x}function QG(y,s){if(s=jG(y,s),s){const c=hT(s,y);ol(s,s.next),ol(c,c.next)}}function jG(y,s){let c=s;const d=y.x,p=y.y;let _=-1/0,x;do{if(p<=c.y&&p>=c.next.y&&c.next.y!==c.y){const N=c.x+(p-c.y)*(c.next.x-c.x)/(c.next.y-c.y);if(N<=d&&N>_){if(_=N,N===d){if(p===c.y)return c;if(p===c.next.y)return c.next}x=c.x<c.next.x?c:c.next}}c=c.next}while(c!==s);if(!x)return null;if(d===_)return x;const C=x,P=x.x,L=x.y;let O=1/0,k;c=x;do d>=c.x&&c.x>=P&&d!==c.x&&gd(p<L?d:_,p,P,L,p<L?_:d,p,c.x,c.y)&&(k=Math.abs(p-c.y)/(d-c.x),Mp(c,y)&&(k<O||k===O&&(c.x>x.x||c.x===x.x&&qG(x,c)))&&(x=c,O=k)),c=c.next;while(c!==C);return x}function qG(y,s){return es(y.prev,y,s.prev)<0&&es(s.next,y,y.next)<0}function XG(y,s,c,d){let p=y;do p.z===null&&(p.z=zx(p.x,p.y,s,c,d)),p.prevZ=p.prev,p.nextZ=p.next,p=p.next;while(p!==y);p.prevZ.nextZ=null,p.prevZ=null,YG(p)}function YG(y){let s,c,d,p,_,x,C,P,L=1;do{for(c=y,y=null,_=null,x=0;c;){for(x++,d=c,C=0,s=0;s<L&&(C++,d=d.nextZ,!!d);s++);for(P=L;C>0||P>0&&d;)C!==0&&(P===0||!d||c.z<=d.z)?(p=c,c=c.nextZ,C--):(p=d,d=d.nextZ,P--),_?_.nextZ=p:y=p,p.prevZ=_,_=p;c=d}_.nextZ=null,L*=2}while(x>1);return y}function zx(y,s,c,d,p){return y=32767*(y-c)*p,s=32767*(s-d)*p,y=(y|y<<8)&16711935,y=(y|y<<4)&252645135,y=(y|y<<2)&858993459,y=(y|y<<1)&1431655765,s=(s|s<<8)&16711935,s=(s|s<<4)&252645135,s=(s|s<<2)&858993459,s=(s|s<<1)&1431655765,y|s<<1}function JG(y){let s=y,c=y;do(s.x<c.x||s.x===c.x&&s.y<c.y)&&(c=s),s=s.next;while(s!==y);return c}function gd(y,s,c,d,p,_,x,C){return(p-x)*(s-C)-(y-x)*(_-C)>=0&&(y-x)*(d-C)-(c-x)*(s-C)>=0&&(c-x)*(_-C)-(p-x)*(d-C)>=0}function ZG(y,s){return y.next.i!==s.i&&y.prev.i!==s.i&&!KG(y,s)&&(Mp(y,s)&&Mp(s,y)&&$G(y,s)&&(es(y.prev,y,s.prev)||es(y,s.prev,s))||e0(y,s)&&es(y.prev,y,y.next)>0&&es(s.prev,s,s.next)>0)}function es(y,s,c){return(s.y-y.y)*(c.x-s.x)-(s.x-y.x)*(c.y-s.y)}function e0(y,s){return y.x===s.x&&y.y===s.y}function lT(y,s,c,d){const p=n0(es(y,s,c)),_=n0(es(y,s,d)),x=n0(es(c,d,y)),C=n0(es(c,d,s));return!!(p!==_&&x!==C||p===0&&t0(y,c,s)||_===0&&t0(y,d,s)||x===0&&t0(c,y,d)||C===0&&t0(c,s,d))}function t0(y,s,c){return s.x<=Math.max(y.x,c.x)&&s.x>=Math.min(y.x,c.x)&&s.y<=Math.max(y.y,c.y)&&s.y>=Math.min(y.y,c.y)}function n0(y){return y>0?1:y<0?-1:0}function KG(y,s){let c=y;do{if(c.i!==y.i&&c.next.i!==y.i&&c.i!==s.i&&c.next.i!==s.i&&lT(c,c.next,y,s))return!0;c=c.next}while(c!==y);return!1}function Mp(y,s){return es(y.prev,y,y.next)<0?es(y,s,y.next)>=0&&es(y,y.prev,s)>=0:es(y,s,y.prev)<0||es(y,y.next,s)<0}function $G(y,s){let c=y,d=!1;const p=(y.x+s.x)/2,_=(y.y+s.y)/2;do c.y>_!=c.next.y>_&&c.next.y!==c.y&&p<(c.next.x-c.x)*(_-c.y)/(c.next.y-c.y)+c.x&&(d=!d),c=c.next;while(c!==y);return d}function hT(y,s){const c=new Gx(y.i,y.x,y.y),d=new Gx(s.i,s.x,s.y),p=y.next,_=s.prev;return y.next=s,s.prev=y,c.next=p,p.prev=c,d.next=c,c.prev=d,_.next=d,d.prev=_,d}function uT(y,s,c,d){const p=new Gx(y,s,c);return d?(p.next=d.next,p.prev=d,d.next.prev=p,d.next=p):(p.prev=p,p.next=p),p}function Tp(y){y.next.prev=y.prev,y.prev.next=y.next,y.prevZ&&(y.prevZ.nextZ=y.nextZ),y.nextZ&&(y.nextZ.prevZ=y.prevZ)}function Gx(y,s,c){this.i=y,this.x=s,this.y=c,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function e4(y,s,c,d){let p=0;for(let _=s,x=c-d;_<c;_+=d)p+=(y[x]-y[_])*(y[_+1]+y[x+1]),x=_;return p}class ya{static area(s){const c=s.length;let d=0;for(let p=c-1,_=0;_<c;p=_++)d+=s[p].x*s[_].y-s[_].x*s[p].y;return d*.5}static isClockWise(s){return ya.area(s)<0}static triangulateShape(s,c){const d=[],p=[],_=[];dT(s),fT(d,s);let x=s.length;c.forEach(dT);for(let P=0;P<c.length;P++)p.push(x),x+=c[P].length,fT(d,c[P]);const C=NG.triangulate(d,p);for(let P=0;P<C.length;P+=3)_.push(C.slice(P,P+3));return _}}function dT(y){const s=y.length;s>2&&y[s-1].equals(y[0])&&y.pop()}function fT(y,s){for(let c=0;c<s.length;c++)y.push(s[c].x),y.push(s[c].y)}class Ip extends si{constructor(s=new Mh([new mt(.5,.5),new mt(-.5,.5),new mt(-.5,-.5),new mt(.5,-.5)]),c={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:s,options:c},s=Array.isArray(s)?s:[s];const d=this,p=[],_=[];for(let C=0,P=s.length;C<P;C++){const L=s[C];x(L)}this.setAttribute("position",new gn(p,3)),this.setAttribute("uv",new gn(_,2)),this.computeVertexNormals();function x(C){const P=[],L=c.curveSegments!==void 0?c.curveSegments:12,O=c.steps!==void 0?c.steps:1,k=c.depth!==void 0?c.depth:1;let N=c.bevelEnabled!==void 0?c.bevelEnabled:!0,z=c.bevelThickness!==void 0?c.bevelThickness:.2,V=c.bevelSize!==void 0?c.bevelSize:z-.1,H=c.bevelOffset!==void 0?c.bevelOffset:0,G=c.bevelSegments!==void 0?c.bevelSegments:3;const X=c.extrudePath,Z=c.UVGenerator!==void 0?c.UVGenerator:t4;let ne,te=!1,oe,ue,be,$;X&&(ne=X.getSpacedPoints(O),te=!0,N=!1,oe=X.computeFrenetFrames(O,!1),ue=new de,be=new de,$=new de),N||(G=0,z=0,V=0,H=0);const ge=C.extractPoints(L);let Se=ge.shape;const et=ge.holes;if(!ya.isClockWise(Se)){Se=Se.reverse();for(let dt=0,ct=et.length;dt<ct;dt++){const Ut=et[dt];ya.isClockWise(Ut)&&(et[dt]=Ut.reverse())}}const Ye=ya.triangulateShape(Se,et),Oe=Se;for(let dt=0,ct=et.length;dt<ct;dt++){const Ut=et[dt];Se=Se.concat(Ut)}function rt(dt,ct,Ut){return ct||console.error("THREE.ExtrudeGeometry: vec does not exist"),ct.clone().multiplyScalar(Ut).add(dt)}const gt=Se.length,Et=Ye.length;function at(dt,ct,Ut){let bn,sn,ei;const kn=dt.x-ct.x,Pn=dt.y-ct.y,Qi=Ut.x-dt.x,Fi=Ut.y-dt.y,ye=kn*kn+Pn*Pn,le=kn*Fi-Pn*Qi;if(Math.abs(le)>Number.EPSILON){const Ke=Math.sqrt(ye),Dt=Math.sqrt(Qi*Qi+Fi*Fi),Wt=ct.x-Pn/Ke,an=ct.y+kn/Ke,zn=Ut.x-Fi/Dt,cn=Ut.y+Qi/Dt,ft=((zn-Wt)*Fi-(cn-an)*Qi)/(kn*Fi-Pn*Qi);bn=Wt+kn*ft-dt.x,sn=an+Pn*ft-dt.y;const Tn=bn*bn+sn*sn;if(Tn<=2)return new mt(bn,sn);ei=Math.sqrt(Tn/2)}else{let Ke=!1;kn>Number.EPSILON?Qi>Number.EPSILON&&(Ke=!0):kn<-Number.EPSILON?Qi<-Number.EPSILON&&(Ke=!0):Math.sign(Pn)===Math.sign(Fi)&&(Ke=!0),Ke?(bn=-Pn,sn=kn,ei=Math.sqrt(ye)):(bn=kn,sn=Pn,ei=Math.sqrt(ye/2))}return new mt(bn/ei,sn/ei)}const We=[];for(let dt=0,ct=Oe.length,Ut=ct-1,bn=dt+1;dt<ct;dt++,Ut++,bn++)Ut===ct&&(Ut=0),bn===ct&&(bn=0),We[dt]=at(Oe[dt],Oe[Ut],Oe[bn]);const Je=[];let Tt,It=We.concat();for(let dt=0,ct=et.length;dt<ct;dt++){const Ut=et[dt];Tt=[];for(let bn=0,sn=Ut.length,ei=sn-1,kn=bn+1;bn<sn;bn++,ei++,kn++)ei===sn&&(ei=0),kn===sn&&(kn=0),Tt[bn]=at(Ut[bn],Ut[ei],Ut[kn]);Je.push(Tt),It=It.concat(Tt)}for(let dt=0;dt<G;dt++){const ct=dt/G,Ut=z*Math.cos(ct*Math.PI/2),bn=V*Math.sin(ct*Math.PI/2)+H;for(let sn=0,ei=Oe.length;sn<ei;sn++){const kn=rt(Oe[sn],We[sn],bn);ai(kn.x,kn.y,-Ut)}for(let sn=0,ei=et.length;sn<ei;sn++){const kn=et[sn];Tt=Je[sn];for(let Pn=0,Qi=kn.length;Pn<Qi;Pn++){const Fi=rt(kn[Pn],Tt[Pn],bn);ai(Fi.x,Fi.y,-Ut)}}}const Pt=V+H;for(let dt=0;dt<gt;dt++){const ct=N?rt(Se[dt],It[dt],Pt):Se[dt];te?(be.copy(oe.normals[0]).multiplyScalar(ct.x),ue.copy(oe.binormals[0]).multiplyScalar(ct.y),$.copy(ne[0]).add(be).add(ue),ai($.x,$.y,$.z)):ai(ct.x,ct.y,0)}for(let dt=1;dt<=O;dt++)for(let ct=0;ct<gt;ct++){const Ut=N?rt(Se[ct],It[ct],Pt):Se[ct];te?(be.copy(oe.normals[dt]).multiplyScalar(Ut.x),ue.copy(oe.binormals[dt]).multiplyScalar(Ut.y),$.copy(ne[dt]).add(be).add(ue),ai($.x,$.y,$.z)):ai(Ut.x,Ut.y,k/O*dt)}for(let dt=G-1;dt>=0;dt--){const ct=dt/G,Ut=z*Math.cos(ct*Math.PI/2),bn=V*Math.sin(ct*Math.PI/2)+H;for(let sn=0,ei=Oe.length;sn<ei;sn++){const kn=rt(Oe[sn],We[sn],bn);ai(kn.x,kn.y,k+Ut)}for(let sn=0,ei=et.length;sn<ei;sn++){const kn=et[sn];Tt=Je[sn];for(let Pn=0,Qi=kn.length;Pn<Qi;Pn++){const Fi=rt(kn[Pn],Tt[Pn],bn);te?ai(Fi.x,Fi.y+ne[O-1].y,ne[O-1].x+Ut):ai(Fi.x,Fi.y,k+Ut)}}}An(),Hn();function An(){const dt=p.length/3;if(N){let ct=0,Ut=gt*ct;for(let bn=0;bn<Et;bn++){const sn=Ye[bn];Dn(sn[2]+Ut,sn[1]+Ut,sn[0]+Ut)}ct=O+G*2,Ut=gt*ct;for(let bn=0;bn<Et;bn++){const sn=Ye[bn];Dn(sn[0]+Ut,sn[1]+Ut,sn[2]+Ut)}}else{for(let ct=0;ct<Et;ct++){const Ut=Ye[ct];Dn(Ut[2],Ut[1],Ut[0])}for(let ct=0;ct<Et;ct++){const Ut=Ye[ct];Dn(Ut[0]+gt*O,Ut[1]+gt*O,Ut[2]+gt*O)}}d.addGroup(dt,p.length/3-dt,0)}function Hn(){const dt=p.length/3;let ct=0;Ne(Oe,ct),ct+=Oe.length;for(let Ut=0,bn=et.length;Ut<bn;Ut++){const sn=et[Ut];Ne(sn,ct),ct+=sn.length}d.addGroup(dt,p.length/3-dt,1)}function Ne(dt,ct){let Ut=dt.length;for(;--Ut>=0;){const bn=Ut;let sn=Ut-1;sn<0&&(sn=dt.length-1);for(let ei=0,kn=O+G*2;ei<kn;ei++){const Pn=gt*ei,Qi=gt*(ei+1),Fi=ct+bn+Pn,ye=ct+sn+Pn,le=ct+sn+Qi,Ke=ct+bn+Qi;Vn(Fi,ye,le,Ke)}}}function ai(dt,ct,Ut){P.push(dt),P.push(ct),P.push(Ut)}function Dn(dt,ct,Ut){on(dt),on(ct),on(Ut);const bn=p.length/3,sn=Z.generateTopUV(d,p,bn-3,bn-2,bn-1);li(sn[0]),li(sn[1]),li(sn[2])}function Vn(dt,ct,Ut,bn){on(dt),on(ct),on(bn),on(ct),on(Ut),on(bn);const sn=p.length/3,ei=Z.generateSideWallUV(d,p,sn-6,sn-3,sn-2,sn-1);li(ei[0]),li(ei[1]),li(ei[3]),li(ei[1]),li(ei[2]),li(ei[3])}function on(dt){p.push(P[dt*3+0]),p.push(P[dt*3+1]),p.push(P[dt*3+2])}function li(dt){_.push(dt.x),_.push(dt.y)}}}toJSON(){const s=super.toJSON(),c=this.parameters.shapes,d=this.parameters.options;return n4(c,d,s)}static fromJSON(s,c){const d=[];for(let _=0,x=s.shapes.length;_<x;_++){const C=c[s.shapes[_]];d.push(C)}const p=s.options.extrudePath;return p!==void 0&&(s.options.extrudePath=new Nx[p.type]().fromJSON(p)),new Ip(d,s.options)}}const t4={generateTopUV:function(y,s,c,d,p){const _=s[c*3],x=s[c*3+1],C=s[d*3],P=s[d*3+1],L=s[p*3],O=s[p*3+1];return[new mt(_,x),new mt(C,P),new mt(L,O)]},generateSideWallUV:function(y,s,c,d,p,_){const x=s[c*3],C=s[c*3+1],P=s[c*3+2],L=s[d*3],O=s[d*3+1],k=s[d*3+2],N=s[p*3],z=s[p*3+1],V=s[p*3+2],H=s[_*3],G=s[_*3+1],X=s[_*3+2];return Math.abs(C-O)<Math.abs(x-L)?[new mt(x,1-P),new mt(L,1-k),new mt(N,1-V),new mt(H,1-X)]:[new mt(C,1-P),new mt(O,1-k),new mt(z,1-V),new mt(G,1-X)]}};function n4(y,s,c){if(c.shapes=[],Array.isArray(y))for(let d=0,p=y.length;d<p;d++){const _=y[d];c.shapes.push(_.uuid)}else c.shapes.push(y.uuid);return c.options=Object.assign({},s),s.extrudePath!==void 0&&(c.options.extrudePath=s.extrudePath.toJSON()),c}class Rp extends sc{constructor(s=1,c=0){const d=(1+Math.sqrt(5))/2,p=[-1,d,0,1,d,0,-1,-d,0,1,-d,0,0,-1,d,0,1,d,0,-1,-d,0,1,-d,d,0,-1,d,0,1,-d,0,-1,-d,0,1],_=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(p,_,s,c),this.type="IcosahedronGeometry",this.parameters={radius:s,detail:c}}static fromJSON(s){return new Rp(s.radius,s.detail)}}class Ad extends sc{constructor(s=1,c=0){const d=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],p=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(d,p,s,c),this.type="OctahedronGeometry",this.parameters={radius:s,detail:c}}static fromJSON(s){return new Ad(s.radius,s.detail)}}class Pp extends si{constructor(s=.5,c=1,d=8,p=1,_=0,x=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:s,outerRadius:c,thetaSegments:d,phiSegments:p,thetaStart:_,thetaLength:x},d=Math.max(3,d),p=Math.max(1,p);const C=[],P=[],L=[],O=[];let k=s;const N=(c-s)/p,z=new de,V=new mt;for(let H=0;H<=p;H++){for(let G=0;G<=d;G++){const X=_+G/d*x;z.x=k*Math.cos(X),z.y=k*Math.sin(X),P.push(z.x,z.y,z.z),L.push(0,0,1),V.x=(z.x/c+1)/2,V.y=(z.y/c+1)/2,O.push(V.x,V.y)}k+=N}for(let H=0;H<p;H++){const G=H*(d+1);for(let X=0;X<d;X++){const Z=X+G,ne=Z,te=Z+d+1,oe=Z+d+2,ue=Z+1;C.push(ne,te,ue),C.push(te,oe,ue)}}this.setIndex(C),this.setAttribute("position",new gn(P,3)),this.setAttribute("normal",new gn(L,3)),this.setAttribute("uv",new gn(O,2))}static fromJSON(s){return new Pp(s.innerRadius,s.outerRadius,s.thetaSegments,s.phiSegments,s.thetaStart,s.thetaLength)}}class Bp extends si{constructor(s=new Mh([new mt(0,.5),new mt(-.5,-.5),new mt(.5,-.5)]),c=12){super(),this.type="ShapeGeometry",this.parameters={shapes:s,curveSegments:c};const d=[],p=[],_=[],x=[];let C=0,P=0;if(Array.isArray(s)===!1)L(s);else for(let O=0;O<s.length;O++)L(s[O]),this.addGroup(C,P,O),C+=P,P=0;this.setIndex(d),this.setAttribute("position",new gn(p,3)),this.setAttribute("normal",new gn(_,3)),this.setAttribute("uv",new gn(x,2));function L(O){const k=p.length/3,N=O.extractPoints(c);let z=N.shape;const V=N.holes;ya.isClockWise(z)===!1&&(z=z.reverse());for(let G=0,X=V.length;G<X;G++){const Z=V[G];ya.isClockWise(Z)===!0&&(V[G]=Z.reverse())}const H=ya.triangulateShape(z,V);for(let G=0,X=V.length;G<X;G++){const Z=V[G];z=z.concat(Z)}for(let G=0,X=z.length;G<X;G++){const Z=z[G];p.push(Z.x,Z.y,0),_.push(0,0,1),x.push(Z.x,Z.y)}for(let G=0,X=H.length;G<X;G++){const Z=H[G],ne=Z[0]+k,te=Z[1]+k,oe=Z[2]+k;d.push(ne,te,oe),P+=3}}}toJSON(){const s=super.toJSON(),c=this.parameters.shapes;return i4(c,s)}static fromJSON(s,c){const d=[];for(let p=0,_=s.shapes.length;p<_;p++){const x=c[s.shapes[p]];d.push(x)}return new Bp(d,s.curveSegments)}}function i4(y,s){if(s.shapes=[],Array.isArray(y))for(let c=0,d=y.length;c<d;c++){const p=y[c];s.shapes.push(p.uuid)}else s.shapes.push(y.uuid);return s}class _d extends si{constructor(s=1,c=32,d=16,p=0,_=Math.PI*2,x=0,C=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:s,widthSegments:c,heightSegments:d,phiStart:p,phiLength:_,thetaStart:x,thetaLength:C},c=Math.max(3,Math.floor(c)),d=Math.max(2,Math.floor(d));const P=Math.min(x+C,Math.PI);let L=0;const O=[],k=new de,N=new de,z=[],V=[],H=[],G=[];for(let X=0;X<=d;X++){const Z=[],ne=X/d;let te=0;X==0&&x==0?te=.5/c:X==d&&P==Math.PI&&(te=-.5/c);for(let oe=0;oe<=c;oe++){const ue=oe/c;k.x=-s*Math.cos(p+ue*_)*Math.sin(x+ne*C),k.y=s*Math.cos(x+ne*C),k.z=s*Math.sin(p+ue*_)*Math.sin(x+ne*C),V.push(k.x,k.y,k.z),N.copy(k).normalize(),H.push(N.x,N.y,N.z),G.push(ue+te,1-ne),Z.push(L++)}O.push(Z)}for(let X=0;X<d;X++)for(let Z=0;Z<c;Z++){const ne=O[X][Z+1],te=O[X][Z],oe=O[X+1][Z],ue=O[X+1][Z+1];(X!==0||x>0)&&z.push(ne,te,ue),(X!==d-1||P<Math.PI)&&z.push(te,oe,ue)}this.setIndex(z),this.setAttribute("position",new gn(V,3)),this.setAttribute("normal",new gn(H,3)),this.setAttribute("uv",new gn(G,2))}static fromJSON(s){return new _d(s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength)}}class Lp extends sc{constructor(s=1,c=0){const d=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],p=[2,1,0,0,3,2,1,3,0,2,3,1];super(d,p,s,c),this.type="TetrahedronGeometry",this.parameters={radius:s,detail:c}}static fromJSON(s){return new Lp(s.radius,s.detail)}}class Dp extends si{constructor(s=1,c=.4,d=8,p=6,_=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:s,tube:c,radialSegments:d,tubularSegments:p,arc:_},d=Math.floor(d),p=Math.floor(p);const x=[],C=[],P=[],L=[],O=new de,k=new de,N=new de;for(let z=0;z<=d;z++)for(let V=0;V<=p;V++){const H=V/p*_,G=z/d*Math.PI*2;k.x=(s+c*Math.cos(G))*Math.cos(H),k.y=(s+c*Math.cos(G))*Math.sin(H),k.z=c*Math.sin(G),C.push(k.x,k.y,k.z),O.x=s*Math.cos(H),O.y=s*Math.sin(H),N.subVectors(k,O).normalize(),P.push(N.x,N.y,N.z),L.push(V/p),L.push(z/d)}for(let z=1;z<=d;z++)for(let V=1;V<=p;V++){const H=(p+1)*z+V-1,G=(p+1)*(z-1)+V-1,X=(p+1)*(z-1)+V,Z=(p+1)*z+V;x.push(H,G,Z),x.push(G,X,Z)}this.setIndex(x),this.setAttribute("position",new gn(C,3)),this.setAttribute("normal",new gn(P,3)),this.setAttribute("uv",new gn(L,2))}static fromJSON(s){return new Dp(s.radius,s.tube,s.radialSegments,s.tubularSegments,s.arc)}}class Op extends si{constructor(s=1,c=.4,d=64,p=8,_=2,x=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:s,tube:c,tubularSegments:d,radialSegments:p,p:_,q:x},d=Math.floor(d),p=Math.floor(p);const C=[],P=[],L=[],O=[],k=new de,N=new de,z=new de,V=new de,H=new de,G=new de,X=new de;for(let ne=0;ne<=d;++ne){const te=ne/d*_*Math.PI*2;Z(te,_,x,s,z),Z(te+.01,_,x,s,V),G.subVectors(V,z),X.addVectors(V,z),H.crossVectors(G,X),X.crossVectors(H,G),H.normalize(),X.normalize();for(let oe=0;oe<=p;++oe){const ue=oe/p*Math.PI*2,be=-c*Math.cos(ue),$=c*Math.sin(ue);k.x=z.x+(be*X.x+$*H.x),k.y=z.y+(be*X.y+$*H.y),k.z=z.z+(be*X.z+$*H.z),P.push(k.x,k.y,k.z),N.subVectors(k,z).normalize(),L.push(N.x,N.y,N.z),O.push(ne/d),O.push(oe/p)}}for(let ne=1;ne<=d;ne++)for(let te=1;te<=p;te++){const oe=(p+1)*(ne-1)+(te-1),ue=(p+1)*ne+(te-1),be=(p+1)*ne+te,$=(p+1)*(ne-1)+te;C.push(oe,ue,$),C.push(ue,be,$)}this.setIndex(C),this.setAttribute("position",new gn(P,3)),this.setAttribute("normal",new gn(L,3)),this.setAttribute("uv",new gn(O,2));function Z(ne,te,oe,ue,be){const $=Math.cos(ne),ge=Math.sin(ne),Se=oe/te*ne,et=Math.cos(Se);be.x=ue*(2+et)*.5*$,be.y=ue*(2+et)*ge*.5,be.z=ue*Math.sin(Se)*.5}}static fromJSON(s){return new Op(s.radius,s.tube,s.tubularSegments,s.radialSegments,s.p,s.q)}}class Fp extends si{constructor(s=new Fx(new de(-1,-1,0),new de(-1,1,0),new de(1,1,0)),c=64,d=1,p=8,_=!1){super(),this.type="TubeGeometry",this.parameters={path:s,tubularSegments:c,radius:d,radialSegments:p,closed:_};const x=s.computeFrenetFrames(c,_);this.tangents=x.tangents,this.normals=x.normals,this.binormals=x.binormals;const C=new de,P=new de,L=new mt;let O=new de;const k=[],N=[],z=[],V=[];H(),this.setIndex(V),this.setAttribute("position",new gn(k,3)),this.setAttribute("normal",new gn(N,3)),this.setAttribute("uv",new gn(z,2));function H(){for(let ne=0;ne<c;ne++)G(ne);G(_===!1?c:0),Z(),X()}function G(ne){O=s.getPointAt(ne/c,O);const te=x.normals[ne],oe=x.binormals[ne];for(let ue=0;ue<=p;ue++){const be=ue/p*Math.PI*2,$=Math.sin(be),ge=-Math.cos(be);P.x=ge*te.x+$*oe.x,P.y=ge*te.y+$*oe.y,P.z=ge*te.z+$*oe.z,P.normalize(),N.push(P.x,P.y,P.z),C.x=O.x+d*P.x,C.y=O.y+d*P.y,C.z=O.z+d*P.z,k.push(C.x,C.y,C.z)}}function X(){for(let ne=1;ne<=c;ne++)for(let te=1;te<=p;te++){const oe=(p+1)*(ne-1)+(te-1),ue=(p+1)*ne+(te-1),be=(p+1)*ne+te,$=(p+1)*(ne-1)+te;V.push(oe,ue,$),V.push(ue,be,$)}}function Z(){for(let ne=0;ne<=c;ne++)for(let te=0;te<=p;te++)L.x=ne/c,L.y=te/p,z.push(L.x,L.y)}}toJSON(){const s=super.toJSON();return s.path=this.parameters.path.toJSON(),s}static fromJSON(s){return new Fp(new Nx[s.path.type]().fromJSON(s.path),s.tubularSegments,s.radius,s.radialSegments,s.closed)}}class pT extends si{constructor(s=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:s},s!==null){const c=[],d=new Set,p=new de,_=new de;if(s.index!==null){const x=s.attributes.position,C=s.index;let P=s.groups;P.length===0&&(P=[{start:0,count:C.count,materialIndex:0}]);for(let L=0,O=P.length;L<O;++L){const k=P[L],N=k.start,z=k.count;for(let V=N,H=N+z;V<H;V+=3)for(let G=0;G<3;G++){const X=C.getX(V+G),Z=C.getX(V+(G+1)%3);p.fromBufferAttribute(x,X),_.fromBufferAttribute(x,Z),mT(p,_,d)===!0&&(c.push(p.x,p.y,p.z),c.push(_.x,_.y,_.z))}}}else{const x=s.attributes.position;for(let C=0,P=x.count/3;C<P;C++)for(let L=0;L<3;L++){const O=3*C+L,k=3*C+(L+1)%3;p.fromBufferAttribute(x,O),_.fromBufferAttribute(x,k),mT(p,_,d)===!0&&(c.push(p.x,p.y,p.z),c.push(_.x,_.y,_.z))}}this.setAttribute("position",new gn(c,3))}}}function mT(y,s,c){const d=`${y.x},${y.y},${y.z}-${s.x},${s.y},${s.z}`,p=`${s.x},${s.y},${s.z}-${y.x},${y.y},${y.z}`;return c.has(d)===!0||c.has(p)===!0?!1:(c.add(d),c.add(p),!0)}var gT=Object.freeze({__proto__:null,BoxGeometry:il,CapsuleGeometry:wp,CircleGeometry:bp,ConeGeometry:Ep,CylinderGeometry:Sh,DodecahedronGeometry:Cp,EdgesGeometry:aT,ExtrudeGeometry:Ip,IcosahedronGeometry:Rp,LatheGeometry:md,OctahedronGeometry:Ad,PlaneGeometry:sd,PolyhedronGeometry:sc,RingGeometry:Pp,ShapeGeometry:Bp,SphereGeometry:_d,TetrahedronGeometry:Lp,TorusGeometry:Dp,TorusKnotGeometry:Op,TubeGeometry:Fp,WireframeGeometry:pT});class AT extends rr{constructor(s){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new dn(0),this.transparent=!0,this.fog=!0,this.setValues(s)}copy(s){return super.copy(s),this.color.copy(s.color),this.fog=s.fog,this}}class _T extends Aa{constructor(s){super(s),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class Hx extends rr{constructor(s){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new dn(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new dn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=qc,this.normalScale=new mt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(s)}copy(s){return super.copy(s),this.defines={STANDARD:""},this.color.copy(s.color),this.roughness=s.roughness,this.metalness=s.metalness,this.map=s.map,this.lightMap=s.lightMap,this.lightMapIntensity=s.lightMapIntensity,this.aoMap=s.aoMap,this.aoMapIntensity=s.aoMapIntensity,this.emissive.copy(s.emissive),this.emissiveMap=s.emissiveMap,this.emissiveIntensity=s.emissiveIntensity,this.bumpMap=s.bumpMap,this.bumpScale=s.bumpScale,this.normalMap=s.normalMap,this.normalMapType=s.normalMapType,this.normalScale.copy(s.normalScale),this.displacementMap=s.displacementMap,this.displacementScale=s.displacementScale,this.displacementBias=s.displacementBias,this.roughnessMap=s.roughnessMap,this.metalnessMap=s.metalnessMap,this.alphaMap=s.alphaMap,this.envMap=s.envMap,this.envMapIntensity=s.envMapIntensity,this.wireframe=s.wireframe,this.wireframeLinewidth=s.wireframeLinewidth,this.wireframeLinecap=s.wireframeLinecap,this.wireframeLinejoin=s.wireframeLinejoin,this.flatShading=s.flatShading,this.fog=s.fog,this}}class yT extends Hx{constructor(s){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new mt(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return ds(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(c){this.ior=(1+.4*c)/(1-.4*c)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new dn(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new dn(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new dn(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._iridescence=0,this._transmission=0,this.setValues(s)}get sheen(){return this._sheen}set sheen(s){this._sheen>0!=s>0&&this.version++,this._sheen=s}get clearcoat(){return this._clearcoat}set clearcoat(s){this._clearcoat>0!=s>0&&this.version++,this._clearcoat=s}get iridescence(){return this._iridescence}set iridescence(s){this._iridescence>0!=s>0&&this.version++,this._iridescence=s}get transmission(){return this._transmission}set transmission(s){this._transmission>0!=s>0&&this.version++,this._transmission=s}copy(s){return super.copy(s),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=s.clearcoat,this.clearcoatMap=s.clearcoatMap,this.clearcoatRoughness=s.clearcoatRoughness,this.clearcoatRoughnessMap=s.clearcoatRoughnessMap,this.clearcoatNormalMap=s.clearcoatNormalMap,this.clearcoatNormalScale.copy(s.clearcoatNormalScale),this.ior=s.ior,this.iridescence=s.iridescence,this.iridescenceMap=s.iridescenceMap,this.iridescenceIOR=s.iridescenceIOR,this.iridescenceThicknessRange=[...s.iridescenceThicknessRange],this.iridescenceThicknessMap=s.iridescenceThicknessMap,this.sheen=s.sheen,this.sheenColor.copy(s.sheenColor),this.sheenColorMap=s.sheenColorMap,this.sheenRoughness=s.sheenRoughness,this.sheenRoughnessMap=s.sheenRoughnessMap,this.transmission=s.transmission,this.transmissionMap=s.transmissionMap,this.thickness=s.thickness,this.thicknessMap=s.thicknessMap,this.attenuationDistance=s.attenuationDistance,this.attenuationColor.copy(s.attenuationColor),this.specularIntensity=s.specularIntensity,this.specularIntensityMap=s.specularIntensityMap,this.specularColor.copy(s.specularColor),this.specularColorMap=s.specularColorMap,this}}class vT extends rr{constructor(s){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new dn(16777215),this.specular=new dn(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new dn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=qc,this.normalScale=new mt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Xt,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(s)}copy(s){return super.copy(s),this.color.copy(s.color),this.specular.copy(s.specular),this.shininess=s.shininess,this.map=s.map,this.lightMap=s.lightMap,this.lightMapIntensity=s.lightMapIntensity,this.aoMap=s.aoMap,this.aoMapIntensity=s.aoMapIntensity,this.emissive.copy(s.emissive),this.emissiveMap=s.emissiveMap,this.emissiveIntensity=s.emissiveIntensity,this.bumpMap=s.bumpMap,this.bumpScale=s.bumpScale,this.normalMap=s.normalMap,this.normalMapType=s.normalMapType,this.normalScale.copy(s.normalScale),this.displacementMap=s.displacementMap,this.displacementScale=s.displacementScale,this.displacementBias=s.displacementBias,this.specularMap=s.specularMap,this.alphaMap=s.alphaMap,this.envMap=s.envMap,this.combine=s.combine,this.reflectivity=s.reflectivity,this.refractionRatio=s.refractionRatio,this.wireframe=s.wireframe,this.wireframeLinewidth=s.wireframeLinewidth,this.wireframeLinecap=s.wireframeLinecap,this.wireframeLinejoin=s.wireframeLinejoin,this.flatShading=s.flatShading,this.fog=s.fog,this}}class xT extends rr{constructor(s){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new dn(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new dn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=qc,this.normalScale=new mt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(s)}copy(s){return super.copy(s),this.color.copy(s.color),this.map=s.map,this.gradientMap=s.gradientMap,this.lightMap=s.lightMap,this.lightMapIntensity=s.lightMapIntensity,this.aoMap=s.aoMap,this.aoMapIntensity=s.aoMapIntensity,this.emissive.copy(s.emissive),this.emissiveMap=s.emissiveMap,this.emissiveIntensity=s.emissiveIntensity,this.bumpMap=s.bumpMap,this.bumpScale=s.bumpScale,this.normalMap=s.normalMap,this.normalMapType=s.normalMapType,this.normalScale.copy(s.normalScale),this.displacementMap=s.displacementMap,this.displacementScale=s.displacementScale,this.displacementBias=s.displacementBias,this.alphaMap=s.alphaMap,this.wireframe=s.wireframe,this.wireframeLinewidth=s.wireframeLinewidth,this.wireframeLinecap=s.wireframeLinecap,this.wireframeLinejoin=s.wireframeLinejoin,this.fog=s.fog,this}}class wT extends rr{constructor(s){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=qc,this.normalScale=new mt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(s)}copy(s){return super.copy(s),this.bumpMap=s.bumpMap,this.bumpScale=s.bumpScale,this.normalMap=s.normalMap,this.normalMapType=s.normalMapType,this.normalScale.copy(s.normalScale),this.displacementMap=s.displacementMap,this.displacementScale=s.displacementScale,this.displacementBias=s.displacementBias,this.wireframe=s.wireframe,this.wireframeLinewidth=s.wireframeLinewidth,this.flatShading=s.flatShading,this}}class bT extends rr{constructor(s){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new dn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new dn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=qc,this.normalScale=new mt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Xt,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(s)}copy(s){return super.copy(s),this.color.copy(s.color),this.map=s.map,this.lightMap=s.lightMap,this.lightMapIntensity=s.lightMapIntensity,this.aoMap=s.aoMap,this.aoMapIntensity=s.aoMapIntensity,this.emissive.copy(s.emissive),this.emissiveMap=s.emissiveMap,this.emissiveIntensity=s.emissiveIntensity,this.bumpMap=s.bumpMap,this.bumpScale=s.bumpScale,this.normalMap=s.normalMap,this.normalMapType=s.normalMapType,this.normalScale.copy(s.normalScale),this.displacementMap=s.displacementMap,this.displacementScale=s.displacementScale,this.displacementBias=s.displacementBias,this.specularMap=s.specularMap,this.alphaMap=s.alphaMap,this.envMap=s.envMap,this.combine=s.combine,this.reflectivity=s.reflectivity,this.refractionRatio=s.refractionRatio,this.wireframe=s.wireframe,this.wireframeLinewidth=s.wireframeLinewidth,this.wireframeLinecap=s.wireframeLinecap,this.wireframeLinejoin=s.wireframeLinejoin,this.flatShading=s.flatShading,this.fog=s.fog,this}}class ET extends rr{constructor(s){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new dn(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=qc,this.normalScale=new mt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(s)}copy(s){return super.copy(s),this.defines={MATCAP:""},this.color.copy(s.color),this.matcap=s.matcap,this.map=s.map,this.bumpMap=s.bumpMap,this.bumpScale=s.bumpScale,this.normalMap=s.normalMap,this.normalMapType=s.normalMapType,this.normalScale.copy(s.normalScale),this.displacementMap=s.displacementMap,this.displacementScale=s.displacementScale,this.displacementBias=s.displacementBias,this.alphaMap=s.alphaMap,this.flatShading=s.flatShading,this.fog=s.fog,this}}class CT extends yr{constructor(s){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(s)}copy(s){return super.copy(s),this.scale=s.scale,this.dashSize=s.dashSize,this.gapSize=s.gapSize,this}}function xo(y,s,c){return Vx(y)?new y.constructor(y.subarray(s,c!==void 0?c:y.length)):y.slice(s,c)}function Th(y,s,c){return!y||!c&&y.constructor===s?y:typeof s.BYTES_PER_ELEMENT=="number"?new s(y):Array.prototype.slice.call(y)}function Vx(y){return ArrayBuffer.isView(y)&&!(y instanceof DataView)}function ST(y){function s(p,_){return y[p]-y[_]}const c=y.length,d=new Array(c);for(let p=0;p!==c;++p)d[p]=p;return d.sort(s),d}function Wx(y,s,c){const d=y.length,p=new y.constructor(d);for(let _=0,x=0;x!==d;++_){const C=c[_]*s;for(let P=0;P!==s;++P)p[x++]=y[C+P]}return p}function Qx(y,s,c,d){let p=1,_=y[0];for(;_!==void 0&&_[d]===void 0;)_=y[p++];if(_===void 0)return;let x=_[d];if(x!==void 0)if(Array.isArray(x))do x=_[d],x!==void 0&&(s.push(_.time),c.push.apply(c,x)),_=y[p++];while(_!==void 0);else if(x.toArray!==void 0)do x=_[d],x!==void 0&&(s.push(_.time),x.toArray(c,c.length)),_=y[p++];while(_!==void 0);else do x=_[d],x!==void 0&&(s.push(_.time),c.push(x)),_=y[p++];while(_!==void 0)}function s4(y,s,c,d,p=30){const _=y.clone();_.name=s;const x=[];for(let P=0;P<_.tracks.length;++P){const L=_.tracks[P],O=L.getValueSize(),k=[],N=[];for(let z=0;z<L.times.length;++z){const V=L.times[z]*p;if(!(V<c||V>=d)){k.push(L.times[z]);for(let H=0;H<O;++H)N.push(L.values[z*O+H])}}k.length!==0&&(L.times=Th(k,L.times.constructor),L.values=Th(N,L.values.constructor),x.push(L))}_.tracks=x;let C=1/0;for(let P=0;P<_.tracks.length;++P)C>_.tracks[P].times[0]&&(C=_.tracks[P].times[0]);for(let P=0;P<_.tracks.length;++P)_.tracks[P].shift(-1*C);return _.resetDuration(),_}function r4(y,s=0,c=y,d=30){d<=0&&(d=30);const p=c.tracks.length,_=s/d;for(let x=0;x<p;++x){const C=c.tracks[x],P=C.ValueTypeName;if(P==="bool"||P==="string")continue;const L=y.tracks.find(function(X){return X.name===C.name&&X.ValueTypeName===P});if(L===void 0)continue;let O=0;const k=C.getValueSize();C.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(O=k/3);let N=0;const z=L.getValueSize();L.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(N=z/3);const V=C.times.length-1;let H;if(_<=C.times[0]){const X=O,Z=k-O;H=xo(C.values,X,Z)}else if(_>=C.times[V]){const X=V*k+O,Z=X+k-O;H=xo(C.values,X,Z)}else{const X=C.createInterpolant(),Z=O,ne=k-O;X.evaluate(_),H=xo(X.resultBuffer,Z,ne)}P==="quaternion"&&new Br().fromArray(H).normalize().conjugate().toArray(H);const G=L.times.length;for(let X=0;X<G;++X){const Z=X*z+N;if(P==="quaternion")Br.multiplyQuaternionsFlat(L.values,Z,H,0,L.values,Z);else{const ne=z-N*2;for(let te=0;te<ne;++te)L.values[Z+te]-=H[te]}}}return y.blendMode=Gv,y}var o4=Object.freeze({__proto__:null,arraySlice:xo,convertArray:Th,isTypedArray:Vx,getKeyframeOrder:ST,sortedArray:Wx,flattenJSON:Qx,subclip:s4,makeClipAdditive:r4});class kp{constructor(s,c,d,p){this.parameterPositions=s,this._cachedIndex=0,this.resultBuffer=p!==void 0?p:new c.constructor(d),this.sampleValues=c,this.valueSize=d,this.settings=null,this.DefaultSettings_={}}evaluate(s){const c=this.parameterPositions;let d=this._cachedIndex,p=c[d],_=c[d-1];e:{t:{let x;n:{i:if(!(s<p)){for(let C=d+2;;){if(p===void 0){if(s<_)break i;return d=c.length,this._cachedIndex=d,this.copySampleValue_(d-1)}if(d===C)break;if(_=p,p=c[++d],s<p)break t}x=c.length;break n}if(!(s>=_)){const C=c[1];s<C&&(d=2,_=C);for(let P=d-2;;){if(_===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(d===P)break;if(p=_,_=c[--d-1],s>=_)break t}x=d,d=0;break n}break e}for(;d<x;){const C=d+x>>>1;s<c[C]?x=C:d=C+1}if(p=c[d],_=c[d-1],_===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(p===void 0)return d=c.length,this._cachedIndex=d,this.copySampleValue_(d-1)}this._cachedIndex=d,this.intervalChanged_(d,_,p)}return this.interpolate_(d,_,s,p)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(s){const c=this.resultBuffer,d=this.sampleValues,p=this.valueSize,_=s*p;for(let x=0;x!==p;++x)c[x]=d[_+x];return c}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class MT extends kp{constructor(s,c,d,p){super(s,c,d,p),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:go,endingEnd:go}}intervalChanged_(s,c,d){const p=this.parameterPositions;let _=s-2,x=s+1,C=p[_],P=p[x];if(C===void 0)switch(this.getSettings_().endingStart){case ph:_=s,C=2*c-d;break;case ip:_=p.length-2,C=c+p[_]-p[_+1];break;default:_=s,C=d}if(P===void 0)switch(this.getSettings_().endingEnd){case ph:x=s,P=2*d-c;break;case ip:x=1,P=d+p[1]-p[0];break;default:x=s-1,P=c}const L=(d-c)*.5,O=this.valueSize;this._weightPrev=L/(c-C),this._weightNext=L/(P-d),this._offsetPrev=_*O,this._offsetNext=x*O}interpolate_(s,c,d,p){const _=this.resultBuffer,x=this.sampleValues,C=this.valueSize,P=s*C,L=P-C,O=this._offsetPrev,k=this._offsetNext,N=this._weightPrev,z=this._weightNext,V=(d-c)/(p-c),H=V*V,G=H*V,X=-N*G+2*N*H-N*V,Z=(1+N)*G+(-1.5-2*N)*H+(-.5+N)*V+1,ne=(-1-z)*G+(1.5+z)*H+.5*V,te=z*G-z*H;for(let oe=0;oe!==C;++oe)_[oe]=X*x[O+oe]+Z*x[L+oe]+ne*x[P+oe]+te*x[k+oe];return _}}class jx extends kp{constructor(s,c,d,p){super(s,c,d,p)}interpolate_(s,c,d,p){const _=this.resultBuffer,x=this.sampleValues,C=this.valueSize,P=s*C,L=P-C,O=(d-c)/(p-c),k=1-O;for(let N=0;N!==C;++N)_[N]=x[L+N]*k+x[P+N]*O;return _}}class TT extends kp{constructor(s,c,d,p){super(s,c,d,p)}interpolate_(s){return this.copySampleValue_(s-1)}}class Xo{constructor(s,c,d,p){if(s===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(c===void 0||c.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+s);this.name=s,this.times=Th(c,this.TimeBufferType),this.values=Th(d,this.ValueBufferType),this.setInterpolation(p||this.DefaultInterpolation)}static toJSON(s){const c=s.constructor;let d;if(c.toJSON!==this.toJSON)d=c.toJSON(s);else{d={name:s.name,times:Th(s.times,Array),values:Th(s.values,Array)};const p=s.getInterpolation();p!==s.DefaultInterpolation&&(d.interpolation=p)}return d.type=s.ValueTypeName,d}InterpolantFactoryMethodDiscrete(s){return new TT(this.times,this.values,this.getValueSize(),s)}InterpolantFactoryMethodLinear(s){return new jx(this.times,this.values,this.getValueSize(),s)}InterpolantFactoryMethodSmooth(s){return new MT(this.times,this.values,this.getValueSize(),s)}setInterpolation(s){let c;switch(s){case gr:c=this.InterpolantFactoryMethodDiscrete;break;case Ho:c=this.InterpolantFactoryMethodLinear;break;case Ar:c=this.InterpolantFactoryMethodSmooth;break}if(c===void 0){const d="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(s!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(d);return console.warn("THREE.KeyframeTrack:",d),this}return this.createInterpolant=c,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return gr;case this.InterpolantFactoryMethodLinear:return Ho;case this.InterpolantFactoryMethodSmooth:return Ar}}getValueSize(){return this.values.length/this.times.length}shift(s){if(s!==0){const c=this.times;for(let d=0,p=c.length;d!==p;++d)c[d]+=s}return this}scale(s){if(s!==1){const c=this.times;for(let d=0,p=c.length;d!==p;++d)c[d]*=s}return this}trim(s,c){const d=this.times,p=d.length;let _=0,x=p-1;for(;_!==p&&d[_]<s;)++_;for(;x!==-1&&d[x]>c;)--x;if(++x,_!==0||x!==p){_>=x&&(x=Math.max(x,1),_=x-1);const C=this.getValueSize();this.times=xo(d,_,x),this.values=xo(this.values,_*C,x*C)}return this}validate(){let s=!0;const c=this.getValueSize();c-Math.floor(c)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),s=!1);const d=this.times,p=this.values,_=d.length;_===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),s=!1);let x=null;for(let C=0;C!==_;C++){const P=d[C];if(typeof P=="number"&&isNaN(P)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,C,P),s=!1;break}if(x!==null&&x>P){console.error("THREE.KeyframeTrack: Out of order keys.",this,C,P,x),s=!1;break}x=P}if(p!==void 0&&Vx(p))for(let C=0,P=p.length;C!==P;++C){const L=p[C];if(isNaN(L)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,C,L),s=!1;break}}return s}optimize(){const s=xo(this.times),c=xo(this.values),d=this.getValueSize(),p=this.getInterpolation()===Ar,_=s.length-1;let x=1;for(let C=1;C<_;++C){let P=!1;const L=s[C],O=s[C+1];if(L!==O&&(C!==1||L!==s[0]))if(p)P=!0;else{const k=C*d,N=k-d,z=k+d;for(let V=0;V!==d;++V){const H=c[k+V];if(H!==c[N+V]||H!==c[z+V]){P=!0;break}}}if(P){if(C!==x){s[x]=s[C];const k=C*d,N=x*d;for(let z=0;z!==d;++z)c[N+z]=c[k+z]}++x}}if(_>0){s[x]=s[_];for(let C=_*d,P=x*d,L=0;L!==d;++L)c[P+L]=c[C+L];++x}return x!==s.length?(this.times=xo(s,0,x),this.values=xo(c,0,x*d)):(this.times=s,this.values=c),this}clone(){const s=xo(this.times,0),c=xo(this.values,0),d=this.constructor,p=new d(this.name,s,c);return p.createInterpolant=this.createInterpolant,p}}Xo.prototype.TimeBufferType=Float32Array,Xo.prototype.ValueBufferType=Float32Array,Xo.prototype.DefaultInterpolation=Ho;class Ih extends Xo{}Ih.prototype.ValueTypeName="bool",Ih.prototype.ValueBufferType=Array,Ih.prototype.DefaultInterpolation=gr,Ih.prototype.InterpolantFactoryMethodLinear=void 0,Ih.prototype.InterpolantFactoryMethodSmooth=void 0;class qx extends Xo{}qx.prototype.ValueTypeName="color";class Np extends Xo{}Np.prototype.ValueTypeName="number";class IT extends kp{constructor(s,c,d,p){super(s,c,d,p)}interpolate_(s,c,d,p){const _=this.resultBuffer,x=this.sampleValues,C=this.valueSize,P=(d-c)/(p-c);let L=s*C;for(let O=L+C;L!==O;L+=4)Br.slerpFlat(_,0,x,L-C,x,L,P);return _}}class yd extends Xo{InterpolantFactoryMethodLinear(s){return new IT(this.times,this.values,this.getValueSize(),s)}}yd.prototype.ValueTypeName="quaternion",yd.prototype.DefaultInterpolation=Ho,yd.prototype.InterpolantFactoryMethodSmooth=void 0;class Rh extends Xo{}Rh.prototype.ValueTypeName="string",Rh.prototype.ValueBufferType=Array,Rh.prototype.DefaultInterpolation=gr,Rh.prototype.InterpolantFactoryMethodLinear=void 0,Rh.prototype.InterpolantFactoryMethodSmooth=void 0;class Up extends Xo{}Up.prototype.ValueTypeName="vector";class zp{constructor(s,c=-1,d,p=sA){this.name=s,this.tracks=d,this.duration=c,this.blendMode=p,this.uuid=qr(),this.duration<0&&this.resetDuration()}static parse(s){const c=[],d=s.tracks,p=1/(s.fps||1);for(let x=0,C=d.length;x!==C;++x)c.push(c4(d[x]).scale(p));const _=new this(s.name,s.duration,c,s.blendMode);return _.uuid=s.uuid,_}static toJSON(s){const c=[],d=s.tracks,p={name:s.name,duration:s.duration,tracks:c,uuid:s.uuid,blendMode:s.blendMode};for(let _=0,x=d.length;_!==x;++_)c.push(Xo.toJSON(d[_]));return p}static CreateFromMorphTargetSequence(s,c,d,p){const _=c.length,x=[];for(let C=0;C<_;C++){let P=[],L=[];P.push((C+_-1)%_,C,(C+1)%_),L.push(0,1,0);const O=ST(P);P=Wx(P,1,O),L=Wx(L,1,O),!p&&P[0]===0&&(P.push(_),L.push(L[0])),x.push(new Np(".morphTargetInfluences["+c[C].name+"]",P,L).scale(1/d))}return new this(s,-1,x)}static findByName(s,c){let d=s;if(!Array.isArray(s)){const p=s;d=p.geometry&&p.geometry.animations||p.animations}for(let p=0;p<d.length;p++)if(d[p].name===c)return d[p];return null}static CreateClipsFromMorphTargetSequences(s,c,d){const p={},_=/^([\w-]*?)([\d]+)$/;for(let C=0,P=s.length;C<P;C++){const L=s[C],O=L.name.match(_);if(O&&O.length>1){const k=O[1];let N=p[k];N||(p[k]=N=[]),N.push(L)}}const x=[];for(const C in p)x.push(this.CreateFromMorphTargetSequence(C,p[C],c,d));return x}static parseAnimation(s,c){if(!s)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const d=function(k,N,z,V,H){if(z.length!==0){const G=[],X=[];Qx(z,G,X,V),G.length!==0&&H.push(new k(N,G,X))}},p=[],_=s.name||"default",x=s.fps||30,C=s.blendMode;let P=s.length||-1;const L=s.hierarchy||[];for(let k=0;k<L.length;k++){const N=L[k].keys;if(!(!N||N.length===0))if(N[0].morphTargets){const z={};let V;for(V=0;V<N.length;V++)if(N[V].morphTargets)for(let H=0;H<N[V].morphTargets.length;H++)z[N[V].morphTargets[H]]=-1;for(const H in z){const G=[],X=[];for(let Z=0;Z!==N[V].morphTargets.length;++Z){const ne=N[V];G.push(ne.time),X.push(ne.morphTarget===H?1:0)}p.push(new Np(".morphTargetInfluence["+H+"]",G,X))}P=z.length*x}else{const z=".bones["+c[k].name+"]";d(Up,z+".position",N,"pos",p),d(yd,z+".quaternion",N,"rot",p),d(Up,z+".scale",N,"scl",p)}}return p.length===0?null:new this(_,P,p,C)}resetDuration(){const s=this.tracks;let c=0;for(let d=0,p=s.length;d!==p;++d){const _=this.tracks[d];c=Math.max(c,_.times[_.times.length-1])}return this.duration=c,this}trim(){for(let s=0;s<this.tracks.length;s++)this.tracks[s].trim(0,this.duration);return this}validate(){let s=!0;for(let c=0;c<this.tracks.length;c++)s=s&&this.tracks[c].validate();return s}optimize(){for(let s=0;s<this.tracks.length;s++)this.tracks[s].optimize();return this}clone(){const s=[];for(let c=0;c<this.tracks.length;c++)s.push(this.tracks[c].clone());return new this.constructor(this.name,this.duration,s,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function a4(y){switch(y.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Np;case"vector":case"vector2":case"vector3":case"vector4":return Up;case"color":return qx;case"quaternion":return yd;case"bool":case"boolean":return Ih;case"string":return Rh}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+y)}function c4(y){if(y.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const s=a4(y.type);if(y.times===void 0){const c=[],d=[];Qx(y.keys,c,d,"value"),y.times=c,y.values=d}return s.parse!==void 0?s.parse(y):new s(y.name,y.times,y.values,y.interpolation)}const Ph={enabled:!1,files:{},add:function(y,s){this.enabled!==!1&&(this.files[y]=s)},get:function(y){if(this.enabled!==!1)return this.files[y]},remove:function(y){delete this.files[y]},clear:function(){this.files={}}};class Xx{constructor(s,c,d){const p=this;let _=!1,x=0,C=0,P;const L=[];this.onStart=void 0,this.onLoad=s,this.onProgress=c,this.onError=d,this.itemStart=function(O){C++,_===!1&&p.onStart!==void 0&&p.onStart(O,x,C),_=!0},this.itemEnd=function(O){x++,p.onProgress!==void 0&&p.onProgress(O,x,C),x===C&&(_=!1,p.onLoad!==void 0&&p.onLoad())},this.itemError=function(O){p.onError!==void 0&&p.onError(O)},this.resolveURL=function(O){return P?P(O):O},this.setURLModifier=function(O){return P=O,this},this.addHandler=function(O,k){return L.push(O,k),this},this.removeHandler=function(O){const k=L.indexOf(O);return k!==-1&&L.splice(k,2),this},this.getHandler=function(O){for(let k=0,N=L.length;k<N;k+=2){const z=L[k],V=L[k+1];if(z.global&&(z.lastIndex=0),z.test(O))return V}return null}}}const RT=new Xx;class Jr{constructor(s){this.manager=s!==void 0?s:RT,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(s,c){const d=this;return new Promise(function(p,_){d.load(s,p,c,_)})}parse(){}setCrossOrigin(s){return this.crossOrigin=s,this}setWithCredentials(s){return this.withCredentials=s,this}setPath(s){return this.path=s,this}setResourcePath(s){return this.resourcePath=s,this}setRequestHeader(s){return this.requestHeader=s,this}}const rc={};class l4 extends Error{constructor(s,c){super(s),this.response=c}}class oc extends Jr{constructor(s){super(s)}load(s,c,d,p){s===void 0&&(s=""),this.path!==void 0&&(s=this.path+s),s=this.manager.resolveURL(s);const _=Ph.get(s);if(_!==void 0)return this.manager.itemStart(s),setTimeout(()=>{c&&c(_),this.manager.itemEnd(s)},0),_;if(rc[s]!==void 0){rc[s].push({onLoad:c,onProgress:d,onError:p});return}rc[s]=[],rc[s].push({onLoad:c,onProgress:d,onError:p});const x=new Request(s,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),C=this.mimeType,P=this.responseType;fetch(x).then(L=>{if(L.status===200||L.status===0){if(L.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||L.body===void 0||L.body.getReader===void 0)return L;const O=rc[s],k=L.body.getReader(),N=L.headers.get("Content-Length"),z=N?parseInt(N):0,V=z!==0;let H=0;const G=new ReadableStream({start(X){Z();function Z(){k.read().then(({done:ne,value:te})=>{if(ne)X.close();else{H+=te.byteLength;const oe=new ProgressEvent("progress",{lengthComputable:V,loaded:H,total:z});for(let ue=0,be=O.length;ue<be;ue++){const $=O[ue];$.onProgress&&$.onProgress(oe)}X.enqueue(te),Z()}})}}});return new Response(G)}else throw new l4(`fetch for "${L.url}" responded with ${L.status}: ${L.statusText}`,L)}).then(L=>{switch(P){case"arraybuffer":return L.arrayBuffer();case"blob":return L.blob();case"document":return L.text().then(O=>new DOMParser().parseFromString(O,C));case"json":return L.json();default:if(C===void 0)return L.text();{const k=/charset="?([^;"\s]*)"?/i.exec(C),N=k&&k[1]?k[1].toLowerCase():void 0,z=new TextDecoder(N);return L.arrayBuffer().then(V=>z.decode(V))}}}).then(L=>{Ph.add(s,L);const O=rc[s];delete rc[s];for(let k=0,N=O.length;k<N;k++){const z=O[k];z.onLoad&&z.onLoad(L)}}).catch(L=>{const O=rc[s];if(O===void 0)throw this.manager.itemError(s),L;delete rc[s];for(let k=0,N=O.length;k<N;k++){const z=O[k];z.onError&&z.onError(L)}this.manager.itemError(s)}).finally(()=>{this.manager.itemEnd(s)}),this.manager.itemStart(s)}setResponseType(s){return this.responseType=s,this}setMimeType(s){return this.mimeType=s,this}}class h4 extends Jr{constructor(s){super(s)}load(s,c,d,p){const _=this,x=new oc(this.manager);x.setPath(this.path),x.setRequestHeader(this.requestHeader),x.setWithCredentials(this.withCredentials),x.load(s,function(C){try{c(_.parse(JSON.parse(C)))}catch(P){p?p(P):console.error(P),_.manager.itemError(s)}},d,p)}parse(s){const c=[];for(let d=0;d<s.length;d++){const p=zp.parse(s[d]);c.push(p)}return c}}class u4 extends Jr{constructor(s){super(s)}load(s,c,d,p){const _=this,x=[],C=new eT,P=new oc(this.manager);P.setPath(this.path),P.setResponseType("arraybuffer"),P.setRequestHeader(this.requestHeader),P.setWithCredentials(_.withCredentials);let L=0;function O(k){P.load(s[k],function(N){const z=_.parse(N,!0);x[k]={width:z.width,height:z.height,format:z.format,mipmaps:z.mipmaps},L+=1,L===6&&(z.mipmapCount===1&&(C.minFilter=bt),C.image=x,C.format=z.format,C.needsUpdate=!0,c&&c(C))},d,p)}if(Array.isArray(s))for(let k=0,N=s.length;k<N;++k)O(k);else P.load(s,function(k){const N=_.parse(k,!0);if(N.isCubemap){const z=N.mipmaps.length/N.mipmapCount;for(let V=0;V<z;V++){x[V]={mipmaps:[]};for(let H=0;H<N.mipmapCount;H++)x[V].mipmaps.push(N.mipmaps[V*N.mipmapCount+H]),x[V].format=N.format,x[V].width=N.width,x[V].height=N.height}C.image=x}else C.image.width=N.width,C.image.height=N.height,C.mipmaps=N.mipmaps;N.mipmapCount===1&&(C.minFilter=bt),C.format=N.format,C.needsUpdate=!0,c&&c(C)},d,p);return C}}class Gp extends Jr{constructor(s){super(s)}load(s,c,d,p){this.path!==void 0&&(s=this.path+s),s=this.manager.resolveURL(s);const _=this,x=Ph.get(s);if(x!==void 0)return _.manager.itemStart(s),setTimeout(function(){c&&c(x),_.manager.itemEnd(s)},0),x;const C=ap("img");function P(){O(),Ph.add(s,this),c&&c(this),_.manager.itemEnd(s)}function L(k){O(),p&&p(k),_.manager.itemError(s),_.manager.itemEnd(s)}function O(){C.removeEventListener("load",P,!1),C.removeEventListener("error",L,!1)}return C.addEventListener("load",P,!1),C.addEventListener("error",L,!1),s.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(C.crossOrigin=this.crossOrigin),_.manager.itemStart(s),C.src=s,C}}class d4 extends Jr{constructor(s){super(s)}load(s,c,d,p){const _=new fp,x=new Gp(this.manager);x.setCrossOrigin(this.crossOrigin),x.setPath(this.path);let C=0;function P(L){x.load(s[L],function(O){_.images[L]=O,C++,C===6&&(_.needsUpdate=!0,c&&c(_))},void 0,p)}for(let L=0;L<s.length;++L)P(L);return _}}class f4 extends Jr{constructor(s){super(s)}load(s,c,d,p){const _=this,x=new fd,C=new oc(this.manager);return C.setResponseType("arraybuffer"),C.setRequestHeader(this.requestHeader),C.setPath(this.path),C.setWithCredentials(_.withCredentials),C.load(s,function(P){const L=_.parse(P);!L||(L.image!==void 0?x.image=L.image:L.data!==void 0&&(x.image.width=L.width,x.image.height=L.height,x.image.data=L.data),x.wrapS=L.wrapS!==void 0?L.wrapS:Qe,x.wrapT=L.wrapT!==void 0?L.wrapT:Qe,x.magFilter=L.magFilter!==void 0?L.magFilter:bt,x.minFilter=L.minFilter!==void 0?L.minFilter:bt,x.anisotropy=L.anisotropy!==void 0?L.anisotropy:1,L.encoding!==void 0&&(x.encoding=L.encoding),L.flipY!==void 0&&(x.flipY=L.flipY),L.format!==void 0&&(x.format=L.format),L.type!==void 0&&(x.type=L.type),L.mipmaps!==void 0&&(x.mipmaps=L.mipmaps,x.minFilter=Ht),L.mipmapCount===1&&(x.minFilter=bt),L.generateMipmaps!==void 0&&(x.generateMipmaps=L.generateMipmaps),x.needsUpdate=!0,c&&c(x,L))},d,p),x}}class p4 extends Jr{constructor(s){super(s)}load(s,c,d,p){const _=new Ps,x=new Gp(this.manager);return x.setCrossOrigin(this.crossOrigin),x.setPath(this.path),x.load(s,function(C){_.image=C,_.needsUpdate=!0,c!==void 0&&c(_)},d,p),_}}class al extends wi{constructor(s,c=1){super(),this.isLight=!0,this.type="Light",this.color=new dn(s),this.intensity=c}dispose(){}copy(s,c){return super.copy(s,c),this.color.copy(s.color),this.intensity=s.intensity,this}toJSON(s){const c=super.toJSON(s);return c.object.color=this.color.getHex(),c.object.intensity=this.intensity,this.groundColor!==void 0&&(c.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(c.object.distance=this.distance),this.angle!==void 0&&(c.object.angle=this.angle),this.decay!==void 0&&(c.object.decay=this.decay),this.penumbra!==void 0&&(c.object.penumbra=this.penumbra),this.shadow!==void 0&&(c.object.shadow=this.shadow.toJSON()),c}}class PT extends al{constructor(s,c,d){super(s,d),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(wi.DefaultUp),this.updateMatrix(),this.groundColor=new dn(c)}copy(s,c){return super.copy(s,c),this.groundColor.copy(s.groundColor),this}}const Yx=new $n,BT=new de,LT=new de;class Jx{constructor(s){this.camera=s,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new mt(512,512),this.map=null,this.mapPass=null,this.matrix=new $n,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new PA,this._frameExtents=new mt(1,1),this._viewportCount=1,this._viewports=[new Ri(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(s){const c=this.camera,d=this.matrix;BT.setFromMatrixPosition(s.matrixWorld),c.position.copy(BT),LT.setFromMatrixPosition(s.target.matrixWorld),c.lookAt(LT),c.updateMatrixWorld(),Yx.multiplyMatrices(c.projectionMatrix,c.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Yx),d.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),d.multiply(Yx)}getViewport(s){return this._viewports[s]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(s){return this.camera=s.camera.clone(),this.bias=s.bias,this.radius=s.radius,this.mapSize.copy(s.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const s={};return this.bias!==0&&(s.bias=this.bias),this.normalBias!==0&&(s.normalBias=this.normalBias),this.radius!==1&&(s.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(s.mapSize=this.mapSize.toArray()),s.camera=this.camera.toJSON(!1).object,delete s.camera.matrix,s}}class m4 extends Jx{constructor(){super(new Xs(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(s){const c=this.camera,d=rp*2*s.angle*this.focus,p=this.mapSize.width/this.mapSize.height,_=s.distance||c.far;(d!==c.fov||p!==c.aspect||_!==c.far)&&(c.fov=d,c.aspect=p,c.far=_,c.updateProjectionMatrix()),super.updateMatrices(s)}copy(s){return super.copy(s),this.focus=s.focus,this}}class DT extends al{constructor(s,c,d=0,p=Math.PI/3,_=0,x=1){super(s,c),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(wi.DefaultUp),this.updateMatrix(),this.target=new wi,this.distance=d,this.angle=p,this.penumbra=_,this.decay=x,this.map=null,this.shadow=new m4}get power(){return this.intensity*Math.PI}set power(s){this.intensity=s/Math.PI}dispose(){this.shadow.dispose()}copy(s,c){return super.copy(s,c),this.distance=s.distance,this.angle=s.angle,this.penumbra=s.penumbra,this.decay=s.decay,this.target=s.target.clone(),this.shadow=s.shadow.clone(),this}}const OT=new $n,Hp=new de,Zx=new de;class g4 extends Jx{constructor(){super(new Xs(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new mt(4,2),this._viewportCount=6,this._viewports=[new Ri(2,1,1,1),new Ri(0,1,1,1),new Ri(3,1,1,1),new Ri(1,1,1,1),new Ri(3,0,1,1),new Ri(1,0,1,1)],this._cubeDirections=[new de(1,0,0),new de(-1,0,0),new de(0,0,1),new de(0,0,-1),new de(0,1,0),new de(0,-1,0)],this._cubeUps=[new de(0,1,0),new de(0,1,0),new de(0,1,0),new de(0,1,0),new de(0,0,1),new de(0,0,-1)]}updateMatrices(s,c=0){const d=this.camera,p=this.matrix,_=s.distance||d.far;_!==d.far&&(d.far=_,d.updateProjectionMatrix()),Hp.setFromMatrixPosition(s.matrixWorld),d.position.copy(Hp),Zx.copy(d.position),Zx.add(this._cubeDirections[c]),d.up.copy(this._cubeUps[c]),d.lookAt(Zx),d.updateMatrixWorld(),p.makeTranslation(-Hp.x,-Hp.y,-Hp.z),OT.multiplyMatrices(d.projectionMatrix,d.matrixWorldInverse),this._frustum.setFromProjectionMatrix(OT)}}class FT extends al{constructor(s,c,d=0,p=1){super(s,c),this.isPointLight=!0,this.type="PointLight",this.distance=d,this.decay=p,this.shadow=new g4}get power(){return this.intensity*4*Math.PI}set power(s){this.intensity=s/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(s,c){return super.copy(s,c),this.distance=s.distance,this.decay=s.decay,this.shadow=s.shadow.clone(),this}}class A4 extends Jx{constructor(){super(new BA(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class kT extends al{constructor(s,c){super(s,c),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(wi.DefaultUp),this.updateMatrix(),this.target=new wi,this.shadow=new A4}dispose(){this.shadow.dispose()}copy(s){return super.copy(s),this.target=s.target.clone(),this.shadow=s.shadow.clone(),this}}class NT extends al{constructor(s,c){super(s,c),this.isAmbientLight=!0,this.type="AmbientLight"}}class UT extends al{constructor(s,c,d=10,p=10){super(s,c),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=d,this.height=p}get power(){return this.intensity*this.width*this.height*Math.PI}set power(s){this.intensity=s/(this.width*this.height*Math.PI)}copy(s){return super.copy(s),this.width=s.width,this.height=s.height,this}toJSON(s){const c=super.toJSON(s);return c.object.width=this.width,c.object.height=this.height,c}}class zT{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let s=0;s<9;s++)this.coefficients.push(new de)}set(s){for(let c=0;c<9;c++)this.coefficients[c].copy(s[c]);return this}zero(){for(let s=0;s<9;s++)this.coefficients[s].set(0,0,0);return this}getAt(s,c){const d=s.x,p=s.y,_=s.z,x=this.coefficients;return c.copy(x[0]).multiplyScalar(.282095),c.addScaledVector(x[1],.488603*p),c.addScaledVector(x[2],.488603*_),c.addScaledVector(x[3],.488603*d),c.addScaledVector(x[4],1.092548*(d*p)),c.addScaledVector(x[5],1.092548*(p*_)),c.addScaledVector(x[6],.315392*(3*_*_-1)),c.addScaledVector(x[7],1.092548*(d*_)),c.addScaledVector(x[8],.546274*(d*d-p*p)),c}getIrradianceAt(s,c){const d=s.x,p=s.y,_=s.z,x=this.coefficients;return c.copy(x[0]).multiplyScalar(.886227),c.addScaledVector(x[1],2*.511664*p),c.addScaledVector(x[2],2*.511664*_),c.addScaledVector(x[3],2*.511664*d),c.addScaledVector(x[4],2*.429043*d*p),c.addScaledVector(x[5],2*.429043*p*_),c.addScaledVector(x[6],.743125*_*_-.247708),c.addScaledVector(x[7],2*.429043*d*_),c.addScaledVector(x[8],.429043*(d*d-p*p)),c}add(s){for(let c=0;c<9;c++)this.coefficients[c].add(s.coefficients[c]);return this}addScaledSH(s,c){for(let d=0;d<9;d++)this.coefficients[d].addScaledVector(s.coefficients[d],c);return this}scale(s){for(let c=0;c<9;c++)this.coefficients[c].multiplyScalar(s);return this}lerp(s,c){for(let d=0;d<9;d++)this.coefficients[d].lerp(s.coefficients[d],c);return this}equals(s){for(let c=0;c<9;c++)if(!this.coefficients[c].equals(s.coefficients[c]))return!1;return!0}copy(s){return this.set(s.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(s,c=0){const d=this.coefficients;for(let p=0;p<9;p++)d[p].fromArray(s,c+p*3);return this}toArray(s=[],c=0){const d=this.coefficients;for(let p=0;p<9;p++)d[p].toArray(s,c+p*3);return s}static getBasisAt(s,c){const d=s.x,p=s.y,_=s.z;c[0]=.282095,c[1]=.488603*p,c[2]=.488603*_,c[3]=.488603*d,c[4]=1.092548*d*p,c[5]=1.092548*p*_,c[6]=.315392*(3*_*_-1),c[7]=1.092548*d*_,c[8]=.546274*(d*d-p*p)}}class i0 extends al{constructor(s=new zT,c=1){super(void 0,c),this.isLightProbe=!0,this.sh=s}copy(s){return super.copy(s),this.sh.copy(s.sh),this}fromJSON(s){return this.intensity=s.intensity,this.sh.fromArray(s.sh),this}toJSON(s){const c=super.toJSON(s);return c.object.sh=this.sh.toArray(),c}}class s0 extends Jr{constructor(s){super(s),this.textures={}}load(s,c,d,p){const _=this,x=new oc(_.manager);x.setPath(_.path),x.setRequestHeader(_.requestHeader),x.setWithCredentials(_.withCredentials),x.load(s,function(C){try{c(_.parse(JSON.parse(C)))}catch(P){p?p(P):console.error(P),_.manager.itemError(s)}},d,p)}parse(s){const c=this.textures;function d(_){return c[_]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",_),c[_]}const p=s0.createMaterialFromType(s.type);if(s.uuid!==void 0&&(p.uuid=s.uuid),s.name!==void 0&&(p.name=s.name),s.color!==void 0&&p.color!==void 0&&p.color.setHex(s.color),s.roughness!==void 0&&(p.roughness=s.roughness),s.metalness!==void 0&&(p.metalness=s.metalness),s.sheen!==void 0&&(p.sheen=s.sheen),s.sheenColor!==void 0&&(p.sheenColor=new dn().setHex(s.sheenColor)),s.sheenRoughness!==void 0&&(p.sheenRoughness=s.sheenRoughness),s.emissive!==void 0&&p.emissive!==void 0&&p.emissive.setHex(s.emissive),s.specular!==void 0&&p.specular!==void 0&&p.specular.setHex(s.specular),s.specularIntensity!==void 0&&(p.specularIntensity=s.specularIntensity),s.specularColor!==void 0&&p.specularColor!==void 0&&p.specularColor.setHex(s.specularColor),s.shininess!==void 0&&(p.shininess=s.shininess),s.clearcoat!==void 0&&(p.clearcoat=s.clearcoat),s.clearcoatRoughness!==void 0&&(p.clearcoatRoughness=s.clearcoatRoughness),s.iridescence!==void 0&&(p.iridescence=s.iridescence),s.iridescenceIOR!==void 0&&(p.iridescenceIOR=s.iridescenceIOR),s.iridescenceThicknessRange!==void 0&&(p.iridescenceThicknessRange=s.iridescenceThicknessRange),s.transmission!==void 0&&(p.transmission=s.transmission),s.thickness!==void 0&&(p.thickness=s.thickness),s.attenuationDistance!==void 0&&(p.attenuationDistance=s.attenuationDistance),s.attenuationColor!==void 0&&p.attenuationColor!==void 0&&p.attenuationColor.setHex(s.attenuationColor),s.fog!==void 0&&(p.fog=s.fog),s.flatShading!==void 0&&(p.flatShading=s.flatShading),s.blending!==void 0&&(p.blending=s.blending),s.combine!==void 0&&(p.combine=s.combine),s.side!==void 0&&(p.side=s.side),s.shadowSide!==void 0&&(p.shadowSide=s.shadowSide),s.opacity!==void 0&&(p.opacity=s.opacity),s.transparent!==void 0&&(p.transparent=s.transparent),s.alphaTest!==void 0&&(p.alphaTest=s.alphaTest),s.depthTest!==void 0&&(p.depthTest=s.depthTest),s.depthWrite!==void 0&&(p.depthWrite=s.depthWrite),s.colorWrite!==void 0&&(p.colorWrite=s.colorWrite),s.stencilWrite!==void 0&&(p.stencilWrite=s.stencilWrite),s.stencilWriteMask!==void 0&&(p.stencilWriteMask=s.stencilWriteMask),s.stencilFunc!==void 0&&(p.stencilFunc=s.stencilFunc),s.stencilRef!==void 0&&(p.stencilRef=s.stencilRef),s.stencilFuncMask!==void 0&&(p.stencilFuncMask=s.stencilFuncMask),s.stencilFail!==void 0&&(p.stencilFail=s.stencilFail),s.stencilZFail!==void 0&&(p.stencilZFail=s.stencilZFail),s.stencilZPass!==void 0&&(p.stencilZPass=s.stencilZPass),s.wireframe!==void 0&&(p.wireframe=s.wireframe),s.wireframeLinewidth!==void 0&&(p.wireframeLinewidth=s.wireframeLinewidth),s.wireframeLinecap!==void 0&&(p.wireframeLinecap=s.wireframeLinecap),s.wireframeLinejoin!==void 0&&(p.wireframeLinejoin=s.wireframeLinejoin),s.rotation!==void 0&&(p.rotation=s.rotation),s.linewidth!==1&&(p.linewidth=s.linewidth),s.dashSize!==void 0&&(p.dashSize=s.dashSize),s.gapSize!==void 0&&(p.gapSize=s.gapSize),s.scale!==void 0&&(p.scale=s.scale),s.polygonOffset!==void 0&&(p.polygonOffset=s.polygonOffset),s.polygonOffsetFactor!==void 0&&(p.polygonOffsetFactor=s.polygonOffsetFactor),s.polygonOffsetUnits!==void 0&&(p.polygonOffsetUnits=s.polygonOffsetUnits),s.dithering!==void 0&&(p.dithering=s.dithering),s.alphaToCoverage!==void 0&&(p.alphaToCoverage=s.alphaToCoverage),s.premultipliedAlpha!==void 0&&(p.premultipliedAlpha=s.premultipliedAlpha),s.visible!==void 0&&(p.visible=s.visible),s.toneMapped!==void 0&&(p.toneMapped=s.toneMapped),s.userData!==void 0&&(p.userData=s.userData),s.vertexColors!==void 0&&(typeof s.vertexColors=="number"?p.vertexColors=s.vertexColors>0:p.vertexColors=s.vertexColors),s.uniforms!==void 0)for(const _ in s.uniforms){const x=s.uniforms[_];switch(p.uniforms[_]={},x.type){case"t":p.uniforms[_].value=d(x.value);break;case"c":p.uniforms[_].value=new dn().setHex(x.value);break;case"v2":p.uniforms[_].value=new mt().fromArray(x.value);break;case"v3":p.uniforms[_].value=new de().fromArray(x.value);break;case"v4":p.uniforms[_].value=new Ri().fromArray(x.value);break;case"m3":p.uniforms[_].value=new Pr().fromArray(x.value);break;case"m4":p.uniforms[_].value=new $n().fromArray(x.value);break;default:p.uniforms[_].value=x.value}}if(s.defines!==void 0&&(p.defines=s.defines),s.vertexShader!==void 0&&(p.vertexShader=s.vertexShader),s.fragmentShader!==void 0&&(p.fragmentShader=s.fragmentShader),s.glslVersion!==void 0&&(p.glslVersion=s.glslVersion),s.extensions!==void 0)for(const _ in s.extensions)p.extensions[_]=s.extensions[_];if(s.size!==void 0&&(p.size=s.size),s.sizeAttenuation!==void 0&&(p.sizeAttenuation=s.sizeAttenuation),s.map!==void 0&&(p.map=d(s.map)),s.matcap!==void 0&&(p.matcap=d(s.matcap)),s.alphaMap!==void 0&&(p.alphaMap=d(s.alphaMap)),s.bumpMap!==void 0&&(p.bumpMap=d(s.bumpMap)),s.bumpScale!==void 0&&(p.bumpScale=s.bumpScale),s.normalMap!==void 0&&(p.normalMap=d(s.normalMap)),s.normalMapType!==void 0&&(p.normalMapType=s.normalMapType),s.normalScale!==void 0){let _=s.normalScale;Array.isArray(_)===!1&&(_=[_,_]),p.normalScale=new mt().fromArray(_)}return s.displacementMap!==void 0&&(p.displacementMap=d(s.displacementMap)),s.displacementScale!==void 0&&(p.displacementScale=s.displacementScale),s.displacementBias!==void 0&&(p.displacementBias=s.displacementBias),s.roughnessMap!==void 0&&(p.roughnessMap=d(s.roughnessMap)),s.metalnessMap!==void 0&&(p.metalnessMap=d(s.metalnessMap)),s.emissiveMap!==void 0&&(p.emissiveMap=d(s.emissiveMap)),s.emissiveIntensity!==void 0&&(p.emissiveIntensity=s.emissiveIntensity),s.specularMap!==void 0&&(p.specularMap=d(s.specularMap)),s.specularIntensityMap!==void 0&&(p.specularIntensityMap=d(s.specularIntensityMap)),s.specularColorMap!==void 0&&(p.specularColorMap=d(s.specularColorMap)),s.envMap!==void 0&&(p.envMap=d(s.envMap)),s.envMapIntensity!==void 0&&(p.envMapIntensity=s.envMapIntensity),s.reflectivity!==void 0&&(p.reflectivity=s.reflectivity),s.refractionRatio!==void 0&&(p.refractionRatio=s.refractionRatio),s.lightMap!==void 0&&(p.lightMap=d(s.lightMap)),s.lightMapIntensity!==void 0&&(p.lightMapIntensity=s.lightMapIntensity),s.aoMap!==void 0&&(p.aoMap=d(s.aoMap)),s.aoMapIntensity!==void 0&&(p.aoMapIntensity=s.aoMapIntensity),s.gradientMap!==void 0&&(p.gradientMap=d(s.gradientMap)),s.clearcoatMap!==void 0&&(p.clearcoatMap=d(s.clearcoatMap)),s.clearcoatRoughnessMap!==void 0&&(p.clearcoatRoughnessMap=d(s.clearcoatRoughnessMap)),s.clearcoatNormalMap!==void 0&&(p.clearcoatNormalMap=d(s.clearcoatNormalMap)),s.clearcoatNormalScale!==void 0&&(p.clearcoatNormalScale=new mt().fromArray(s.clearcoatNormalScale)),s.iridescenceMap!==void 0&&(p.iridescenceMap=d(s.iridescenceMap)),s.iridescenceThicknessMap!==void 0&&(p.iridescenceThicknessMap=d(s.iridescenceThicknessMap)),s.transmissionMap!==void 0&&(p.transmissionMap=d(s.transmissionMap)),s.thicknessMap!==void 0&&(p.thicknessMap=d(s.thicknessMap)),s.sheenColorMap!==void 0&&(p.sheenColorMap=d(s.sheenColorMap)),s.sheenRoughnessMap!==void 0&&(p.sheenRoughnessMap=d(s.sheenRoughnessMap)),p}setTextures(s){return this.textures=s,this}static createMaterialFromType(s){const c={ShadowMaterial:AT,SpriteMaterial:Ex,RawShaderMaterial:_T,ShaderMaterial:Aa,PointsMaterial:Tx,MeshPhysicalMaterial:yT,MeshStandardMaterial:Hx,MeshPhongMaterial:vT,MeshToonMaterial:xT,MeshNormalMaterial:wT,MeshLambertMaterial:bT,MeshDepthMaterial:xx,MeshDistanceMaterial:wx,MeshBasicMaterial:$c,MeshMatcapMaterial:ET,LineDashedMaterial:CT,LineBasicMaterial:yr,Material:rr};return new c[s]}}class Kx{static decodeText(s){if(typeof TextDecoder<"u")return new TextDecoder().decode(s);let c="";for(let d=0,p=s.length;d<p;d++)c+=String.fromCharCode(s[d]);try{return decodeURIComponent(escape(c))}catch{return c}}static extractUrlBase(s){const c=s.lastIndexOf("/");return c===-1?"./":s.slice(0,c+1)}static resolveURL(s,c){return typeof s!="string"||s===""?"":(/^https?:\/\//i.test(c)&&/^\//.test(s)&&(c=c.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(s)||/^data:.*,.*$/i.test(s)||/^blob:.*$/i.test(s)?s:c+s)}}class GT extends si{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(s){return super.copy(s),this.instanceCount=s.instanceCount,this}clone(){return new this.constructor().copy(this)}toJSON(){const s=super.toJSON(this);return s.instanceCount=this.instanceCount,s.isInstancedBufferGeometry=!0,s}}class HT extends Jr{constructor(s){super(s)}load(s,c,d,p){const _=this,x=new oc(_.manager);x.setPath(_.path),x.setRequestHeader(_.requestHeader),x.setWithCredentials(_.withCredentials),x.load(s,function(C){try{c(_.parse(JSON.parse(C)))}catch(P){p?p(P):console.error(P),_.manager.itemError(s)}},d,p)}parse(s){const c={},d={};function p(z,V){if(c[V]!==void 0)return c[V];const G=z.interleavedBuffers[V],X=_(z,G.buffer),Z=Hu(G.type,X),ne=new NA(Z,G.stride);return ne.uuid=G.uuid,c[V]=ne,ne}function _(z,V){if(d[V]!==void 0)return d[V];const G=z.arrayBuffers[V],X=new Uint32Array(G).buffer;return d[V]=X,X}const x=s.isInstancedBufferGeometry?new GT:new si,C=s.data.index;if(C!==void 0){const z=Hu(C.type,C.array);x.setIndex(new Oi(z,1))}const P=s.data.attributes;for(const z in P){const V=P[z];let H;if(V.isInterleavedBufferAttribute){const G=p(s.data,V.data);H=new Ch(G,V.itemSize,V.offset,V.normalized)}else{const G=Hu(V.type,V.array),X=V.isInstancedBufferAttribute?pd:Oi;H=new X(G,V.itemSize,V.normalized)}V.name!==void 0&&(H.name=V.name),V.usage!==void 0&&H.setUsage(V.usage),V.updateRange!==void 0&&(H.updateRange.offset=V.updateRange.offset,H.updateRange.count=V.updateRange.count),x.setAttribute(z,H)}const L=s.data.morphAttributes;if(L)for(const z in L){const V=L[z],H=[];for(let G=0,X=V.length;G<X;G++){const Z=V[G];let ne;if(Z.isInterleavedBufferAttribute){const te=p(s.data,Z.data);ne=new Ch(te,Z.itemSize,Z.offset,Z.normalized)}else{const te=Hu(Z.type,Z.array);ne=new Oi(te,Z.itemSize,Z.normalized)}Z.name!==void 0&&(ne.name=Z.name),H.push(ne)}x.morphAttributes[z]=H}s.data.morphTargetsRelative&&(x.morphTargetsRelative=!0);const k=s.data.groups||s.data.drawcalls||s.data.offsets;if(k!==void 0)for(let z=0,V=k.length;z!==V;++z){const H=k[z];x.addGroup(H.start,H.count,H.materialIndex)}const N=s.data.boundingSphere;if(N!==void 0){const z=new de;N.center!==void 0&&z.fromArray(N.center),x.boundingSphere=new wh(z,N.radius)}return s.name&&(x.name=s.name),s.userData&&(x.userData=s.userData),x}}class _4 extends Jr{constructor(s){super(s)}load(s,c,d,p){const _=this,x=this.path===""?Kx.extractUrlBase(s):this.path;this.resourcePath=this.resourcePath||x;const C=new oc(this.manager);C.setPath(this.path),C.setRequestHeader(this.requestHeader),C.setWithCredentials(this.withCredentials),C.load(s,function(P){let L=null;try{L=JSON.parse(P)}catch(k){p!==void 0&&p(k),console.error("THREE:ObjectLoader: Can't parse "+s+".",k.message);return}const O=L.metadata;if(O===void 0||O.type===void 0||O.type.toLowerCase()==="geometry"){console.error("THREE.ObjectLoader: Can't load "+s);return}_.parse(L,c)},d,p)}async loadAsync(s,c){const d=this,p=this.path===""?Kx.extractUrlBase(s):this.path;this.resourcePath=this.resourcePath||p;const _=new oc(this.manager);_.setPath(this.path),_.setRequestHeader(this.requestHeader),_.setWithCredentials(this.withCredentials);const x=await _.loadAsync(s,c),C=JSON.parse(x),P=C.metadata;if(P===void 0||P.type===void 0||P.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+s);return await d.parseAsync(C)}parse(s,c){const d=this.parseAnimations(s.animations),p=this.parseShapes(s.shapes),_=this.parseGeometries(s.geometries,p),x=this.parseImages(s.images,function(){c!==void 0&&c(L)}),C=this.parseTextures(s.textures,x),P=this.parseMaterials(s.materials,C),L=this.parseObject(s.object,_,P,C,d),O=this.parseSkeletons(s.skeletons,L);if(this.bindSkeletons(L,O),c!==void 0){let k=!1;for(const N in x)if(x[N].data instanceof HTMLImageElement){k=!0;break}k===!1&&c(L)}return L}async parseAsync(s){const c=this.parseAnimations(s.animations),d=this.parseShapes(s.shapes),p=this.parseGeometries(s.geometries,d),_=await this.parseImagesAsync(s.images),x=this.parseTextures(s.textures,_),C=this.parseMaterials(s.materials,x),P=this.parseObject(s.object,p,C,x,c),L=this.parseSkeletons(s.skeletons,P);return this.bindSkeletons(P,L),P}parseShapes(s){const c={};if(s!==void 0)for(let d=0,p=s.length;d<p;d++){const _=new Mh().fromJSON(s[d]);c[_.uuid]=_}return c}parseSkeletons(s,c){const d={},p={};if(c.traverse(function(_){_.isBone&&(p[_.uuid]=_)}),s!==void 0)for(let _=0,x=s.length;_<x;_++){const C=new VA().fromJSON(s[_],p);d[C.uuid]=C}return d}parseGeometries(s,c){const d={};if(s!==void 0){const p=new HT;for(let _=0,x=s.length;_<x;_++){let C;const P=s[_];switch(P.type){case"BufferGeometry":case"InstancedBufferGeometry":C=p.parse(P);break;default:P.type in gT?C=gT[P.type].fromJSON(P,c):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${P.type}"`)}C.uuid=P.uuid,P.name!==void 0&&(C.name=P.name),C.isBufferGeometry===!0&&P.userData!==void 0&&(C.userData=P.userData),d[P.uuid]=C}}return d}parseMaterials(s,c){const d={},p={};if(s!==void 0){const _=new s0;_.setTextures(c);for(let x=0,C=s.length;x<C;x++){const P=s[x];d[P.uuid]===void 0&&(d[P.uuid]=_.parse(P)),p[P.uuid]=d[P.uuid]}}return p}parseAnimations(s){const c={};if(s!==void 0)for(let d=0;d<s.length;d++){const p=s[d],_=zp.parse(p);c[_.uuid]=_}return c}parseImages(s,c){const d=this,p={};let _;function x(P){return d.manager.itemStart(P),_.load(P,function(){d.manager.itemEnd(P)},void 0,function(){d.manager.itemError(P),d.manager.itemEnd(P)})}function C(P){if(typeof P=="string"){const L=P,O=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(L)?L:d.resourcePath+L;return x(O)}else return P.data?{data:Hu(P.type,P.data),width:P.width,height:P.height}:null}if(s!==void 0&&s.length>0){const P=new Xx(c);_=new Gp(P),_.setCrossOrigin(this.crossOrigin);for(let L=0,O=s.length;L<O;L++){const k=s[L],N=k.url;if(Array.isArray(N)){const z=[];for(let V=0,H=N.length;V<H;V++){const G=N[V],X=C(G);X!==null&&(X instanceof HTMLImageElement?z.push(X):z.push(new fd(X.data,X.width,X.height)))}p[k.uuid]=new Ah(z)}else{const z=C(k.url);p[k.uuid]=new Ah(z)}}}return p}async parseImagesAsync(s){const c=this,d={};let p;async function _(x){if(typeof x=="string"){const C=x,P=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(C)?C:c.resourcePath+C;return await p.loadAsync(P)}else return x.data?{data:Hu(x.type,x.data),width:x.width,height:x.height}:null}if(s!==void 0&&s.length>0){p=new Gp(this.manager),p.setCrossOrigin(this.crossOrigin);for(let x=0,C=s.length;x<C;x++){const P=s[x],L=P.url;if(Array.isArray(L)){const O=[];for(let k=0,N=L.length;k<N;k++){const z=L[k],V=await _(z);V!==null&&(V instanceof HTMLImageElement?O.push(V):O.push(new fd(V.data,V.width,V.height)))}d[P.uuid]=new Ah(O)}else{const O=await _(P.url);d[P.uuid]=new Ah(O)}}}return d}parseTextures(s,c){function d(_,x){return typeof _=="number"?_:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",_),x[_])}const p={};if(s!==void 0)for(let _=0,x=s.length;_<x;_++){const C=s[_];C.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',C.uuid),c[C.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",C.image);const P=c[C.image],L=P.data;let O;Array.isArray(L)?(O=new fp,L.length===6&&(O.needsUpdate=!0)):(L&&L.data?O=new fd:O=new Ps,L&&(O.needsUpdate=!0)),O.source=P,O.uuid=C.uuid,C.name!==void 0&&(O.name=C.name),C.mapping!==void 0&&(O.mapping=d(C.mapping,y4)),C.offset!==void 0&&O.offset.fromArray(C.offset),C.repeat!==void 0&&O.repeat.fromArray(C.repeat),C.center!==void 0&&O.center.fromArray(C.center),C.rotation!==void 0&&(O.rotation=C.rotation),C.wrap!==void 0&&(O.wrapS=d(C.wrap[0],VT),O.wrapT=d(C.wrap[1],VT)),C.format!==void 0&&(O.format=C.format),C.type!==void 0&&(O.type=C.type),C.encoding!==void 0&&(O.encoding=C.encoding),C.minFilter!==void 0&&(O.minFilter=d(C.minFilter,WT)),C.magFilter!==void 0&&(O.magFilter=d(C.magFilter,WT)),C.anisotropy!==void 0&&(O.anisotropy=C.anisotropy),C.flipY!==void 0&&(O.flipY=C.flipY),C.premultiplyAlpha!==void 0&&(O.premultiplyAlpha=C.premultiplyAlpha),C.unpackAlignment!==void 0&&(O.unpackAlignment=C.unpackAlignment),C.userData!==void 0&&(O.userData=C.userData),p[C.uuid]=O}return p}parseObject(s,c,d,p,_){let x;function C(N){return c[N]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",N),c[N]}function P(N){if(N!==void 0){if(Array.isArray(N)){const z=[];for(let V=0,H=N.length;V<H;V++){const G=N[V];d[G]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",G),z.push(d[G])}return z}return d[N]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",N),d[N]}}function L(N){return p[N]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",N),p[N]}let O,k;switch(s.type){case"Scene":x=new I1,s.background!==void 0&&(Number.isInteger(s.background)?x.background=new dn(s.background):x.background=L(s.background)),s.environment!==void 0&&(x.environment=L(s.environment)),s.fog!==void 0&&(s.fog.type==="Fog"?x.fog=new kA(s.fog.color,s.fog.near,s.fog.far):s.fog.type==="FogExp2"&&(x.fog=new FA(s.fog.color,s.fog.density)));break;case"PerspectiveCamera":x=new Xs(s.fov,s.aspect,s.near,s.far),s.focus!==void 0&&(x.focus=s.focus),s.zoom!==void 0&&(x.zoom=s.zoom),s.filmGauge!==void 0&&(x.filmGauge=s.filmGauge),s.filmOffset!==void 0&&(x.filmOffset=s.filmOffset),s.view!==void 0&&(x.view=Object.assign({},s.view));break;case"OrthographicCamera":x=new BA(s.left,s.right,s.top,s.bottom,s.near,s.far),s.zoom!==void 0&&(x.zoom=s.zoom),s.view!==void 0&&(x.view=Object.assign({},s.view));break;case"AmbientLight":x=new NT(s.color,s.intensity);break;case"DirectionalLight":x=new kT(s.color,s.intensity);break;case"PointLight":x=new FT(s.color,s.intensity,s.distance,s.decay);break;case"RectAreaLight":x=new UT(s.color,s.intensity,s.width,s.height);break;case"SpotLight":x=new DT(s.color,s.intensity,s.distance,s.angle,s.penumbra,s.decay);break;case"HemisphereLight":x=new PT(s.color,s.groundColor,s.intensity);break;case"LightProbe":x=new i0().fromJSON(s);break;case"SkinnedMesh":O=C(s.geometry),k=P(s.material),x=new z1(O,k),s.bindMode!==void 0&&(x.bindMode=s.bindMode),s.bindMatrix!==void 0&&x.bindMatrix.fromArray(s.bindMatrix),s.skeleton!==void 0&&(x.skeleton=s.skeleton);break;case"Mesh":O=C(s.geometry),k=P(s.material),x=new qs(O,k);break;case"InstancedMesh":O=C(s.geometry),k=P(s.material);const N=s.count,z=s.instanceMatrix,V=s.instanceColor;x=new W1(O,k,N),x.instanceMatrix=new pd(new Float32Array(z.array),16),V!==void 0&&(x.instanceColor=new pd(new Float32Array(V.array),V.itemSize));break;case"LOD":x=new O1;break;case"Line":x=new rl(C(s.geometry),P(s.material));break;case"LineLoop":x=new J1(C(s.geometry),P(s.material));break;case"LineSegments":x=new _a(C(s.geometry),P(s.material));break;case"PointCloud":case"Points":x=new K1(C(s.geometry),P(s.material));break;case"Sprite":x=new L1(P(s.material));break;case"Group":x=new cd;break;case"Bone":x=new Sx;break;default:x=new wi}if(x.uuid=s.uuid,s.name!==void 0&&(x.name=s.name),s.matrix!==void 0?(x.matrix.fromArray(s.matrix),s.matrixAutoUpdate!==void 0&&(x.matrixAutoUpdate=s.matrixAutoUpdate),x.matrixAutoUpdate&&x.matrix.decompose(x.position,x.quaternion,x.scale)):(s.position!==void 0&&x.position.fromArray(s.position),s.rotation!==void 0&&x.rotation.fromArray(s.rotation),s.quaternion!==void 0&&x.quaternion.fromArray(s.quaternion),s.scale!==void 0&&x.scale.fromArray(s.scale)),s.castShadow!==void 0&&(x.castShadow=s.castShadow),s.receiveShadow!==void 0&&(x.receiveShadow=s.receiveShadow),s.shadow&&(s.shadow.bias!==void 0&&(x.shadow.bias=s.shadow.bias),s.shadow.normalBias!==void 0&&(x.shadow.normalBias=s.shadow.normalBias),s.shadow.radius!==void 0&&(x.shadow.radius=s.shadow.radius),s.shadow.mapSize!==void 0&&x.shadow.mapSize.fromArray(s.shadow.mapSize),s.shadow.camera!==void 0&&(x.shadow.camera=this.parseObject(s.shadow.camera))),s.visible!==void 0&&(x.visible=s.visible),s.frustumCulled!==void 0&&(x.frustumCulled=s.frustumCulled),s.renderOrder!==void 0&&(x.renderOrder=s.renderOrder),s.userData!==void 0&&(x.userData=s.userData),s.layers!==void 0&&(x.layers.mask=s.layers),s.children!==void 0){const N=s.children;for(let z=0;z<N.length;z++)x.add(this.parseObject(N[z],c,d,p,_))}if(s.animations!==void 0){const N=s.animations;for(let z=0;z<N.length;z++){const V=N[z];x.animations.push(_[V])}}if(s.type==="LOD"){s.autoUpdate!==void 0&&(x.autoUpdate=s.autoUpdate);const N=s.levels;for(let z=0;z<N.length;z++){const V=N[z],H=x.getObjectByProperty("uuid",V.object);H!==void 0&&x.addLevel(H,V.distance)}}return x}bindSkeletons(s,c){Object.keys(c).length!==0&&s.traverse(function(d){if(d.isSkinnedMesh===!0&&d.skeleton!==void 0){const p=c[d.skeleton];p===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",d.skeleton):d.bind(p,d.bindMatrix)}})}}const y4={UVMapping:En,CubeReflectionMapping:Zt,CubeRefractionMapping:ln,EquirectangularReflectionMapping:ii,EquirectangularRefractionMapping:Zn,CubeUVReflectionMapping:me},VT={RepeatWrapping:ce,ClampToEdgeWrapping:Qe,MirroredRepeatWrapping:At},WT={NearestFilter:pt,NearestMipmapNearestFilter:zt,NearestMipmapLinearFilter:we,LinearFilter:bt,LinearMipmapNearestFilter:hn,LinearMipmapLinearFilter:Ht};class v4 extends Jr{constructor(s){super(s),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(s){return this.options=s,this}load(s,c,d,p){s===void 0&&(s=""),this.path!==void 0&&(s=this.path+s),s=this.manager.resolveURL(s);const _=this,x=Ph.get(s);if(x!==void 0)return _.manager.itemStart(s),setTimeout(function(){c&&c(x),_.manager.itemEnd(s)},0),x;const C={};C.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",C.headers=this.requestHeader,fetch(s,C).then(function(P){return P.blob()}).then(function(P){return createImageBitmap(P,Object.assign(_.options,{colorSpaceConversion:"none"}))}).then(function(P){Ph.add(s,P),c&&c(P),_.manager.itemEnd(s)}).catch(function(P){p&&p(P),_.manager.itemError(s),_.manager.itemEnd(s)}),_.manager.itemStart(s)}}let r0;const $x={getContext:function(){return r0===void 0&&(r0=new(window.AudioContext||window.webkitAudioContext)),r0},setContext:function(y){r0=y}};class x4 extends Jr{constructor(s){super(s)}load(s,c,d,p){const _=this,x=new oc(this.manager);x.setResponseType("arraybuffer"),x.setPath(this.path),x.setRequestHeader(this.requestHeader),x.setWithCredentials(this.withCredentials),x.load(s,function(C){try{const P=C.slice(0);$x.getContext().decodeAudioData(P,function(O){c(O)})}catch(P){p?p(P):console.error(P),_.manager.itemError(s)}},d,p)}}class w4 extends i0{constructor(s,c,d=1){super(void 0,d),this.isHemisphereLightProbe=!0;const p=new dn().set(s),_=new dn().set(c),x=new de(p.r,p.g,p.b),C=new de(_.r,_.g,_.b),P=Math.sqrt(Math.PI),L=P*Math.sqrt(.75);this.sh.coefficients[0].copy(x).add(C).multiplyScalar(P),this.sh.coefficients[1].copy(x).sub(C).multiplyScalar(L)}}class b4 extends i0{constructor(s,c=1){super(void 0,c),this.isAmbientLightProbe=!0;const d=new dn().set(s);this.sh.coefficients[0].set(d.r,d.g,d.b).multiplyScalar(2*Math.sqrt(Math.PI))}}const QT=new $n,jT=new $n,Bh=new $n;class E4{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Xs,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Xs,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(s){const c=this._cache;if(c.focus!==s.focus||c.fov!==s.fov||c.aspect!==s.aspect*this.aspect||c.near!==s.near||c.far!==s.far||c.zoom!==s.zoom||c.eyeSep!==this.eyeSep){c.focus=s.focus,c.fov=s.fov,c.aspect=s.aspect*this.aspect,c.near=s.near,c.far=s.far,c.zoom=s.zoom,c.eyeSep=this.eyeSep,Bh.copy(s.projectionMatrix);const p=c.eyeSep/2,_=p*c.near/c.focus,x=c.near*Math.tan(mh*c.fov*.5)/c.zoom;let C,P;jT.elements[12]=-p,QT.elements[12]=p,C=-x*c.aspect+_,P=x*c.aspect+_,Bh.elements[0]=2*c.near/(P-C),Bh.elements[8]=(P+C)/(P-C),this.cameraL.projectionMatrix.copy(Bh),C=-x*c.aspect-_,P=x*c.aspect-_,Bh.elements[0]=2*c.near/(P-C),Bh.elements[8]=(P+C)/(P-C),this.cameraR.projectionMatrix.copy(Bh)}this.cameraL.matrixWorld.copy(s.matrixWorld).multiply(jT),this.cameraR.matrixWorld.copy(s.matrixWorld).multiply(QT)}}class qT{constructor(s=!0){this.autoStart=s,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=XT(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let s=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const c=XT();s=(c-this.oldTime)/1e3,this.oldTime=c,this.elapsedTime+=s}return s}}function XT(){return(typeof performance>"u"?Date:performance).now()}const Lh=new de,YT=new Br,C4=new de,Dh=new de;class S4 extends wi{constructor(){super(),this.type="AudioListener",this.context=$x.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new qT}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(s){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=s,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(s){return this.gain.gain.setTargetAtTime(s,this.context.currentTime,.01),this}updateMatrixWorld(s){super.updateMatrixWorld(s);const c=this.context.listener,d=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Lh,YT,C4),Dh.set(0,0,-1).applyQuaternion(YT),c.positionX){const p=this.context.currentTime+this.timeDelta;c.positionX.linearRampToValueAtTime(Lh.x,p),c.positionY.linearRampToValueAtTime(Lh.y,p),c.positionZ.linearRampToValueAtTime(Lh.z,p),c.forwardX.linearRampToValueAtTime(Dh.x,p),c.forwardY.linearRampToValueAtTime(Dh.y,p),c.forwardZ.linearRampToValueAtTime(Dh.z,p),c.upX.linearRampToValueAtTime(d.x,p),c.upY.linearRampToValueAtTime(d.y,p),c.upZ.linearRampToValueAtTime(d.z,p)}else c.setPosition(Lh.x,Lh.y,Lh.z),c.setOrientation(Dh.x,Dh.y,Dh.z,d.x,d.y,d.z)}}class JT extends wi{constructor(s){super(),this.type="Audio",this.listener=s,this.context=s.context,this.gain=this.context.createGain(),this.gain.connect(s.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(s){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=s,this.connect(),this}setMediaElementSource(s){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(s),this.connect(),this}setMediaStreamSource(s){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(s),this.connect(),this}setBuffer(s){return this.buffer=s,this.sourceType="buffer",this.autoplay&&this.play(),this}play(s=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+s;const c=this.context.createBufferSource();return c.buffer=this.buffer,c.loop=this.loop,c.loopStart=this.loopStart,c.loopEnd=this.loopEnd,c.onended=this.onEnded.bind(this),c.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=c,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let s=1,c=this.filters.length;s<c;s++)this.filters[s-1].connect(this.filters[s]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let s=1,c=this.filters.length;s<c;s++)this.filters[s-1].disconnect(this.filters[s]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(s){return s||(s=[]),this._connected===!0?(this.disconnect(),this.filters=s.slice(),this.connect()):this.filters=s.slice(),this}setDetune(s){if(this.detune=s,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(s){return this.setFilters(s?[s]:[])}setPlaybackRate(s){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=s,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(s){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=s,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(s){return this.loopStart=s,this}setLoopEnd(s){return this.loopEnd=s,this}getVolume(){return this.gain.gain.value}setVolume(s){return this.gain.gain.setTargetAtTime(s,this.context.currentTime,.01),this}}const Oh=new de,ZT=new Br,M4=new de,Fh=new de;class T4 extends JT{constructor(s){super(s),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(s){return this.panner.refDistance=s,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(s){return this.panner.rolloffFactor=s,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(s){return this.panner.distanceModel=s,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(s){return this.panner.maxDistance=s,this}setDirectionalCone(s,c,d){return this.panner.coneInnerAngle=s,this.panner.coneOuterAngle=c,this.panner.coneOuterGain=d,this}updateMatrixWorld(s){if(super.updateMatrixWorld(s),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(Oh,ZT,M4),Fh.set(0,0,1).applyQuaternion(ZT);const c=this.panner;if(c.positionX){const d=this.context.currentTime+this.listener.timeDelta;c.positionX.linearRampToValueAtTime(Oh.x,d),c.positionY.linearRampToValueAtTime(Oh.y,d),c.positionZ.linearRampToValueAtTime(Oh.z,d),c.orientationX.linearRampToValueAtTime(Fh.x,d),c.orientationY.linearRampToValueAtTime(Fh.y,d),c.orientationZ.linearRampToValueAtTime(Fh.z,d)}else c.setPosition(Oh.x,Oh.y,Oh.z),c.setOrientation(Fh.x,Fh.y,Fh.z)}}class I4{constructor(s,c=2048){this.analyser=s.context.createAnalyser(),this.analyser.fftSize=c,this.data=new Uint8Array(this.analyser.frequencyBinCount),s.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let s=0;const c=this.getFrequencyData();for(let d=0;d<c.length;d++)s+=c[d];return s/c.length}}class KT{constructor(s,c,d){this.binding=s,this.valueSize=d;let p,_,x;switch(c){case"quaternion":p=this._slerp,_=this._slerpAdditive,x=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(d*6),this._workIndex=5;break;case"string":case"bool":p=this._select,_=this._select,x=this._setAdditiveIdentityOther,this.buffer=new Array(d*5);break;default:p=this._lerp,_=this._lerpAdditive,x=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(d*5)}this._mixBufferRegion=p,this._mixBufferRegionAdditive=_,this._setIdentity=x,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(s,c){const d=this.buffer,p=this.valueSize,_=s*p+p;let x=this.cumulativeWeight;if(x===0){for(let C=0;C!==p;++C)d[_+C]=d[C];x=c}else{x+=c;const C=c/x;this._mixBufferRegion(d,_,0,C,p)}this.cumulativeWeight=x}accumulateAdditive(s){const c=this.buffer,d=this.valueSize,p=d*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(c,p,0,s,d),this.cumulativeWeightAdditive+=s}apply(s){const c=this.valueSize,d=this.buffer,p=s*c+c,_=this.cumulativeWeight,x=this.cumulativeWeightAdditive,C=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,_<1){const P=c*this._origIndex;this._mixBufferRegion(d,p,P,1-_,c)}x>0&&this._mixBufferRegionAdditive(d,p,this._addIndex*c,1,c);for(let P=c,L=c+c;P!==L;++P)if(d[P]!==d[P+c]){C.setValue(d,p);break}}saveOriginalState(){const s=this.binding,c=this.buffer,d=this.valueSize,p=d*this._origIndex;s.getValue(c,p);for(let _=d,x=p;_!==x;++_)c[_]=c[p+_%d];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const s=this.valueSize*3;this.binding.setValue(this.buffer,s)}_setAdditiveIdentityNumeric(){const s=this._addIndex*this.valueSize,c=s+this.valueSize;for(let d=s;d<c;d++)this.buffer[d]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const s=this._origIndex*this.valueSize,c=this._addIndex*this.valueSize;for(let d=0;d<this.valueSize;d++)this.buffer[c+d]=this.buffer[s+d]}_select(s,c,d,p,_){if(p>=.5)for(let x=0;x!==_;++x)s[c+x]=s[d+x]}_slerp(s,c,d,p){Br.slerpFlat(s,c,s,c,s,d,p)}_slerpAdditive(s,c,d,p,_){const x=this._workIndex*_;Br.multiplyQuaternionsFlat(s,x,s,c,s,d),Br.slerpFlat(s,c,s,c,s,x,p)}_lerp(s,c,d,p,_){const x=1-p;for(let C=0;C!==_;++C){const P=c+C;s[P]=s[P]*x+s[d+C]*p}}_lerpAdditive(s,c,d,p,_){for(let x=0;x!==_;++x){const C=c+x;s[C]=s[C]+s[d+x]*p}}}const ew="\\[\\]\\.:\\/",R4=new RegExp("["+ew+"]","g"),tw="[^"+ew+"]",P4="[^"+ew.replace("\\.","")+"]",B4=/((?:WC+[\/:])*)/.source.replace("WC",tw),L4=/(WCOD+)?/.source.replace("WCOD",P4),D4=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",tw),O4=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",tw),F4=new RegExp("^"+B4+L4+D4+O4+"$"),k4=["material","materials","bones","map"];class N4{constructor(s,c,d){const p=d||pi.parseTrackName(c);this._targetGroup=s,this._bindings=s.subscribe_(c,p)}getValue(s,c){this.bind();const d=this._targetGroup.nCachedObjects_,p=this._bindings[d];p!==void 0&&p.getValue(s,c)}setValue(s,c){const d=this._bindings;for(let p=this._targetGroup.nCachedObjects_,_=d.length;p!==_;++p)d[p].setValue(s,c)}bind(){const s=this._bindings;for(let c=this._targetGroup.nCachedObjects_,d=s.length;c!==d;++c)s[c].bind()}unbind(){const s=this._bindings;for(let c=this._targetGroup.nCachedObjects_,d=s.length;c!==d;++c)s[c].unbind()}}class pi{constructor(s,c,d){this.path=c,this.parsedPath=d||pi.parseTrackName(c),this.node=pi.findNode(s,this.parsedPath.nodeName)||s,this.rootNode=s,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(s,c,d){return s&&s.isAnimationObjectGroup?new pi.Composite(s,c,d):new pi(s,c,d)}static sanitizeNodeName(s){return s.replace(/\s/g,"_").replace(R4,"")}static parseTrackName(s){const c=F4.exec(s);if(c===null)throw new Error("PropertyBinding: Cannot parse trackName: "+s);const d={nodeName:c[2],objectName:c[3],objectIndex:c[4],propertyName:c[5],propertyIndex:c[6]},p=d.nodeName&&d.nodeName.lastIndexOf(".");if(p!==void 0&&p!==-1){const _=d.nodeName.substring(p+1);k4.indexOf(_)!==-1&&(d.nodeName=d.nodeName.substring(0,p),d.objectName=_)}if(d.propertyName===null||d.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+s);return d}static findNode(s,c){if(c===void 0||c===""||c==="."||c===-1||c===s.name||c===s.uuid)return s;if(s.skeleton){const d=s.skeleton.getBoneByName(c);if(d!==void 0)return d}if(s.children){const d=function(_){for(let x=0;x<_.length;x++){const C=_[x];if(C.name===c||C.uuid===c)return C;const P=d(C.children);if(P)return P}return null},p=d(s.children);if(p)return p}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(s,c){s[c]=this.targetObject[this.propertyName]}_getValue_array(s,c){const d=this.resolvedProperty;for(let p=0,_=d.length;p!==_;++p)s[c++]=d[p]}_getValue_arrayElement(s,c){s[c]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(s,c){this.resolvedProperty.toArray(s,c)}_setValue_direct(s,c){this.targetObject[this.propertyName]=s[c]}_setValue_direct_setNeedsUpdate(s,c){this.targetObject[this.propertyName]=s[c],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(s,c){this.targetObject[this.propertyName]=s[c],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(s,c){const d=this.resolvedProperty;for(let p=0,_=d.length;p!==_;++p)d[p]=s[c++]}_setValue_array_setNeedsUpdate(s,c){const d=this.resolvedProperty;for(let p=0,_=d.length;p!==_;++p)d[p]=s[c++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(s,c){const d=this.resolvedProperty;for(let p=0,_=d.length;p!==_;++p)d[p]=s[c++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(s,c){this.resolvedProperty[this.propertyIndex]=s[c]}_setValue_arrayElement_setNeedsUpdate(s,c){this.resolvedProperty[this.propertyIndex]=s[c],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(s,c){this.resolvedProperty[this.propertyIndex]=s[c],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(s,c){this.resolvedProperty.fromArray(s,c)}_setValue_fromArray_setNeedsUpdate(s,c){this.resolvedProperty.fromArray(s,c),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(s,c){this.resolvedProperty.fromArray(s,c),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(s,c){this.bind(),this.getValue(s,c)}_setValue_unbound(s,c){this.bind(),this.setValue(s,c)}bind(){let s=this.node;const c=this.parsedPath,d=c.objectName,p=c.propertyName;let _=c.propertyIndex;if(s||(s=pi.findNode(this.rootNode,c.nodeName)||this.rootNode,this.node=s),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!s){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(d){let L=c.objectIndex;switch(d){case"materials":if(!s.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!s.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}s=s.material.materials;break;case"bones":if(!s.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}s=s.skeleton.bones;for(let O=0;O<s.length;O++)if(s[O].name===L){L=O;break}break;case"map":if("map"in s){s=s.map;break}if(!s.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!s.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}s=s.material.map;break;default:if(s[d]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}s=s[d]}if(L!==void 0){if(s[L]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,s);return}s=s[L]}}const x=s[p];if(x===void 0){const L=c.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+L+"."+p+" but it wasn't found.",s);return}let C=this.Versioning.None;this.targetObject=s,s.needsUpdate!==void 0?C=this.Versioning.NeedsUpdate:s.matrixWorldNeedsUpdate!==void 0&&(C=this.Versioning.MatrixWorldNeedsUpdate);let P=this.BindingType.Direct;if(_!==void 0){if(p==="morphTargetInfluences"){if(!s.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!s.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}s.morphTargetDictionary[_]!==void 0&&(_=s.morphTargetDictionary[_])}P=this.BindingType.ArrayElement,this.resolvedProperty=x,this.propertyIndex=_}else x.fromArray!==void 0&&x.toArray!==void 0?(P=this.BindingType.HasFromToArray,this.resolvedProperty=x):Array.isArray(x)?(P=this.BindingType.EntireArray,this.resolvedProperty=x):this.propertyName=p;this.getValue=this.GetterByBindingType[P],this.setValue=this.SetterByBindingTypeAndVersioning[P][C]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}pi.Composite=N4,pi.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},pi.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},pi.prototype.GetterByBindingType=[pi.prototype._getValue_direct,pi.prototype._getValue_array,pi.prototype._getValue_arrayElement,pi.prototype._getValue_toArray],pi.prototype.SetterByBindingTypeAndVersioning=[[pi.prototype._setValue_direct,pi.prototype._setValue_direct_setNeedsUpdate,pi.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[pi.prototype._setValue_array,pi.prototype._setValue_array_setNeedsUpdate,pi.prototype._setValue_array_setMatrixWorldNeedsUpdate],[pi.prototype._setValue_arrayElement,pi.prototype._setValue_arrayElement_setNeedsUpdate,pi.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[pi.prototype._setValue_fromArray,pi.prototype._setValue_fromArray_setNeedsUpdate,pi.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class U4{constructor(){this.isAnimationObjectGroup=!0,this.uuid=qr(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const s={};this._indicesByUUID=s;for(let d=0,p=arguments.length;d!==p;++d)s[arguments[d].uuid]=d;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const c=this;this.stats={objects:{get total(){return c._objects.length},get inUse(){return this.total-c.nCachedObjects_}},get bindingsPerObject(){return c._bindings.length}}}add(){const s=this._objects,c=this._indicesByUUID,d=this._paths,p=this._parsedPaths,_=this._bindings,x=_.length;let C,P=s.length,L=this.nCachedObjects_;for(let O=0,k=arguments.length;O!==k;++O){const N=arguments[O],z=N.uuid;let V=c[z];if(V===void 0){V=P++,c[z]=V,s.push(N);for(let H=0,G=x;H!==G;++H)_[H].push(new pi(N,d[H],p[H]))}else if(V<L){C=s[V];const H=--L,G=s[H];c[G.uuid]=V,s[V]=G,c[z]=H,s[H]=N;for(let X=0,Z=x;X!==Z;++X){const ne=_[X],te=ne[H];let oe=ne[V];ne[V]=te,oe===void 0&&(oe=new pi(N,d[X],p[X])),ne[H]=oe}}else s[V]!==C&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=L}remove(){const s=this._objects,c=this._indicesByUUID,d=this._bindings,p=d.length;let _=this.nCachedObjects_;for(let x=0,C=arguments.length;x!==C;++x){const P=arguments[x],L=P.uuid,O=c[L];if(O!==void 0&&O>=_){const k=_++,N=s[k];c[N.uuid]=O,s[O]=N,c[L]=k,s[k]=P;for(let z=0,V=p;z!==V;++z){const H=d[z],G=H[k],X=H[O];H[O]=G,H[k]=X}}}this.nCachedObjects_=_}uncache(){const s=this._objects,c=this._indicesByUUID,d=this._bindings,p=d.length;let _=this.nCachedObjects_,x=s.length;for(let C=0,P=arguments.length;C!==P;++C){const L=arguments[C],O=L.uuid,k=c[O];if(k!==void 0)if(delete c[O],k<_){const N=--_,z=s[N],V=--x,H=s[V];c[z.uuid]=k,s[k]=z,c[H.uuid]=N,s[N]=H,s.pop();for(let G=0,X=p;G!==X;++G){const Z=d[G],ne=Z[N],te=Z[V];Z[k]=ne,Z[N]=te,Z.pop()}}else{const N=--x,z=s[N];N>0&&(c[z.uuid]=k),s[k]=z,s.pop();for(let V=0,H=p;V!==H;++V){const G=d[V];G[k]=G[N],G.pop()}}}this.nCachedObjects_=_}subscribe_(s,c){const d=this._bindingsIndicesByPath;let p=d[s];const _=this._bindings;if(p!==void 0)return _[p];const x=this._paths,C=this._parsedPaths,P=this._objects,L=P.length,O=this.nCachedObjects_,k=new Array(L);p=_.length,d[s]=p,x.push(s),C.push(c),_.push(k);for(let N=O,z=P.length;N!==z;++N){const V=P[N];k[N]=new pi(V,s,c)}return k}unsubscribe_(s){const c=this._bindingsIndicesByPath,d=c[s];if(d!==void 0){const p=this._paths,_=this._parsedPaths,x=this._bindings,C=x.length-1,P=x[C],L=s[C];c[L]=d,x[d]=P,x.pop(),_[d]=_[C],_.pop(),p[d]=p[C],p.pop()}}}class z4{constructor(s,c,d=null,p=c.blendMode){this._mixer=s,this._clip=c,this._localRoot=d,this.blendMode=p;const _=c.tracks,x=_.length,C=new Array(x),P={endingStart:go,endingEnd:go};for(let L=0;L!==x;++L){const O=_[L].createInterpolant(null);C[L]=O,O.settings=P}this._interpolantSettings=P,this._interpolants=C,this._propertyBindings=new Array(x),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=xi,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(s){return this._startTime=s,this}setLoop(s,c){return this.loop=s,this.repetitions=c,this}setEffectiveWeight(s){return this.weight=s,this._effectiveWeight=this.enabled?s:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(s){return this._scheduleFading(s,0,1)}fadeOut(s){return this._scheduleFading(s,1,0)}crossFadeFrom(s,c,d){if(s.fadeOut(c),this.fadeIn(c),d){const p=this._clip.duration,_=s._clip.duration,x=_/p,C=p/_;s.warp(1,x,c),this.warp(C,1,c)}return this}crossFadeTo(s,c,d){return s.crossFadeFrom(this,c,d)}stopFading(){const s=this._weightInterpolant;return s!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(s)),this}setEffectiveTimeScale(s){return this.timeScale=s,this._effectiveTimeScale=this.paused?0:s,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(s){return this.timeScale=this._clip.duration/s,this.stopWarping()}syncWith(s){return this.time=s.time,this.timeScale=s.timeScale,this.stopWarping()}halt(s){return this.warp(this._effectiveTimeScale,0,s)}warp(s,c,d){const p=this._mixer,_=p.time,x=this.timeScale;let C=this._timeScaleInterpolant;C===null&&(C=p._lendControlInterpolant(),this._timeScaleInterpolant=C);const P=C.parameterPositions,L=C.sampleValues;return P[0]=_,P[1]=_+d,L[0]=s/x,L[1]=c/x,this}stopWarping(){const s=this._timeScaleInterpolant;return s!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(s)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(s,c,d,p){if(!this.enabled){this._updateWeight(s);return}const _=this._startTime;if(_!==null){const P=(s-_)*d;P<0||d===0?c=0:(this._startTime=null,c=d*P)}c*=this._updateTimeScale(s);const x=this._updateTime(c),C=this._updateWeight(s);if(C>0){const P=this._interpolants,L=this._propertyBindings;switch(this.blendMode){case Gv:for(let O=0,k=P.length;O!==k;++O)P[O].evaluate(x),L[O].accumulateAdditive(C);break;case sA:default:for(let O=0,k=P.length;O!==k;++O)P[O].evaluate(x),L[O].accumulate(p,C)}}}_updateWeight(s){let c=0;if(this.enabled){c=this.weight;const d=this._weightInterpolant;if(d!==null){const p=d.evaluate(s)[0];c*=p,s>d.parameterPositions[1]&&(this.stopFading(),p===0&&(this.enabled=!1))}}return this._effectiveWeight=c,c}_updateTimeScale(s){let c=0;if(!this.paused){c=this.timeScale;const d=this._timeScaleInterpolant;d!==null&&(c*=d.evaluate(s)[0],s>d.parameterPositions[1]&&(this.stopWarping(),c===0?this.paused=!0:this.timeScale=c))}return this._effectiveTimeScale=c,c}_updateTime(s){const c=this._clip.duration,d=this.loop;let p=this.time+s,_=this._loopCount;const x=d===Ii;if(s===0)return _===-1?p:x&&(_&1)===1?c-p:p;if(d===Yi){_===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(p>=c)p=c;else if(p<0)p=0;else{this.time=p;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=p,this._mixer.dispatchEvent({type:"finished",action:this,direction:s<0?-1:1})}}else{if(_===-1&&(s>=0?(_=0,this._setEndings(!0,this.repetitions===0,x)):this._setEndings(this.repetitions===0,!0,x)),p>=c||p<0){const C=Math.floor(p/c);p-=c*C,_+=Math.abs(C);const P=this.repetitions-_;if(P<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,p=s>0?c:0,this.time=p,this._mixer.dispatchEvent({type:"finished",action:this,direction:s>0?1:-1});else{if(P===1){const L=s<0;this._setEndings(L,!L,x)}else this._setEndings(!1,!1,x);this._loopCount=_,this.time=p,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:C})}}else this.time=p;if(x&&(_&1)===1)return c-p}return p}_setEndings(s,c,d){const p=this._interpolantSettings;d?(p.endingStart=ph,p.endingEnd=ph):(s?p.endingStart=this.zeroSlopeAtStart?ph:go:p.endingStart=ip,c?p.endingEnd=this.zeroSlopeAtEnd?ph:go:p.endingEnd=ip)}_scheduleFading(s,c,d){const p=this._mixer,_=p.time;let x=this._weightInterpolant;x===null&&(x=p._lendControlInterpolant(),this._weightInterpolant=x);const C=x.parameterPositions,P=x.sampleValues;return C[0]=_,P[0]=c,C[1]=_+s,P[1]=d,this}}const G4=new Float32Array(1);class H4 extends Za{constructor(s){super(),this._root=s,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(s,c){const d=s._localRoot||this._root,p=s._clip.tracks,_=p.length,x=s._propertyBindings,C=s._interpolants,P=d.uuid,L=this._bindingsByRootAndName;let O=L[P];O===void 0&&(O={},L[P]=O);for(let k=0;k!==_;++k){const N=p[k],z=N.name;let V=O[z];if(V!==void 0)++V.referenceCount,x[k]=V;else{if(V=x[k],V!==void 0){V._cacheIndex===null&&(++V.referenceCount,this._addInactiveBinding(V,P,z));continue}const H=c&&c._propertyBindings[k].binding.parsedPath;V=new KT(pi.create(d,z,H),N.ValueTypeName,N.getValueSize()),++V.referenceCount,this._addInactiveBinding(V,P,z),x[k]=V}C[k].resultBuffer=V.buffer}}_activateAction(s){if(!this._isActiveAction(s)){if(s._cacheIndex===null){const d=(s._localRoot||this._root).uuid,p=s._clip.uuid,_=this._actionsByClip[p];this._bindAction(s,_&&_.knownActions[0]),this._addInactiveAction(s,p,d)}const c=s._propertyBindings;for(let d=0,p=c.length;d!==p;++d){const _=c[d];_.useCount++===0&&(this._lendBinding(_),_.saveOriginalState())}this._lendAction(s)}}_deactivateAction(s){if(this._isActiveAction(s)){const c=s._propertyBindings;for(let d=0,p=c.length;d!==p;++d){const _=c[d];--_.useCount===0&&(_.restoreOriginalState(),this._takeBackBinding(_))}this._takeBackAction(s)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const s=this;this.stats={actions:{get total(){return s._actions.length},get inUse(){return s._nActiveActions}},bindings:{get total(){return s._bindings.length},get inUse(){return s._nActiveBindings}},controlInterpolants:{get total(){return s._controlInterpolants.length},get inUse(){return s._nActiveControlInterpolants}}}}_isActiveAction(s){const c=s._cacheIndex;return c!==null&&c<this._nActiveActions}_addInactiveAction(s,c,d){const p=this._actions,_=this._actionsByClip;let x=_[c];if(x===void 0)x={knownActions:[s],actionByRoot:{}},s._byClipCacheIndex=0,_[c]=x;else{const C=x.knownActions;s._byClipCacheIndex=C.length,C.push(s)}s._cacheIndex=p.length,p.push(s),x.actionByRoot[d]=s}_removeInactiveAction(s){const c=this._actions,d=c[c.length-1],p=s._cacheIndex;d._cacheIndex=p,c[p]=d,c.pop(),s._cacheIndex=null;const _=s._clip.uuid,x=this._actionsByClip,C=x[_],P=C.knownActions,L=P[P.length-1],O=s._byClipCacheIndex;L._byClipCacheIndex=O,P[O]=L,P.pop(),s._byClipCacheIndex=null;const k=C.actionByRoot,N=(s._localRoot||this._root).uuid;delete k[N],P.length===0&&delete x[_],this._removeInactiveBindingsForAction(s)}_removeInactiveBindingsForAction(s){const c=s._propertyBindings;for(let d=0,p=c.length;d!==p;++d){const _=c[d];--_.referenceCount===0&&this._removeInactiveBinding(_)}}_lendAction(s){const c=this._actions,d=s._cacheIndex,p=this._nActiveActions++,_=c[p];s._cacheIndex=p,c[p]=s,_._cacheIndex=d,c[d]=_}_takeBackAction(s){const c=this._actions,d=s._cacheIndex,p=--this._nActiveActions,_=c[p];s._cacheIndex=p,c[p]=s,_._cacheIndex=d,c[d]=_}_addInactiveBinding(s,c,d){const p=this._bindingsByRootAndName,_=this._bindings;let x=p[c];x===void 0&&(x={},p[c]=x),x[d]=s,s._cacheIndex=_.length,_.push(s)}_removeInactiveBinding(s){const c=this._bindings,d=s.binding,p=d.rootNode.uuid,_=d.path,x=this._bindingsByRootAndName,C=x[p],P=c[c.length-1],L=s._cacheIndex;P._cacheIndex=L,c[L]=P,c.pop(),delete C[_],Object.keys(C).length===0&&delete x[p]}_lendBinding(s){const c=this._bindings,d=s._cacheIndex,p=this._nActiveBindings++,_=c[p];s._cacheIndex=p,c[p]=s,_._cacheIndex=d,c[d]=_}_takeBackBinding(s){const c=this._bindings,d=s._cacheIndex,p=--this._nActiveBindings,_=c[p];s._cacheIndex=p,c[p]=s,_._cacheIndex=d,c[d]=_}_lendControlInterpolant(){const s=this._controlInterpolants,c=this._nActiveControlInterpolants++;let d=s[c];return d===void 0&&(d=new jx(new Float32Array(2),new Float32Array(2),1,G4),d.__cacheIndex=c,s[c]=d),d}_takeBackControlInterpolant(s){const c=this._controlInterpolants,d=s.__cacheIndex,p=--this._nActiveControlInterpolants,_=c[p];s.__cacheIndex=p,c[p]=s,_.__cacheIndex=d,c[d]=_}clipAction(s,c,d){const p=c||this._root,_=p.uuid;let x=typeof s=="string"?zp.findByName(p,s):s;const C=x!==null?x.uuid:s,P=this._actionsByClip[C];let L=null;if(d===void 0&&(x!==null?d=x.blendMode:d=sA),P!==void 0){const k=P.actionByRoot[_];if(k!==void 0&&k.blendMode===d)return k;L=P.knownActions[0],x===null&&(x=L._clip)}if(x===null)return null;const O=new z4(this,x,c,d);return this._bindAction(O,L),this._addInactiveAction(O,C,_),O}existingAction(s,c){const d=c||this._root,p=d.uuid,_=typeof s=="string"?zp.findByName(d,s):s,x=_?_.uuid:s,C=this._actionsByClip[x];return C!==void 0&&C.actionByRoot[p]||null}stopAllAction(){const s=this._actions,c=this._nActiveActions;for(let d=c-1;d>=0;--d)s[d].stop();return this}update(s){s*=this.timeScale;const c=this._actions,d=this._nActiveActions,p=this.time+=s,_=Math.sign(s),x=this._accuIndex^=1;for(let L=0;L!==d;++L)c[L]._update(p,s,_,x);const C=this._bindings,P=this._nActiveBindings;for(let L=0;L!==P;++L)C[L].apply(x);return this}setTime(s){this.time=0;for(let c=0;c<this._actions.length;c++)this._actions[c].time=0;return this.update(s)}getRoot(){return this._root}uncacheClip(s){const c=this._actions,d=s.uuid,p=this._actionsByClip,_=p[d];if(_!==void 0){const x=_.knownActions;for(let C=0,P=x.length;C!==P;++C){const L=x[C];this._deactivateAction(L);const O=L._cacheIndex,k=c[c.length-1];L._cacheIndex=null,L._byClipCacheIndex=null,k._cacheIndex=O,c[O]=k,c.pop(),this._removeInactiveBindingsForAction(L)}delete p[d]}}uncacheRoot(s){const c=s.uuid,d=this._actionsByClip;for(const x in d){const C=d[x].actionByRoot,P=C[c];P!==void 0&&(this._deactivateAction(P),this._removeInactiveAction(P))}const p=this._bindingsByRootAndName,_=p[c];if(_!==void 0)for(const x in _){const C=_[x];C.restoreOriginalState(),this._removeInactiveBinding(C)}}uncacheAction(s,c){const d=this.existingAction(s,c);d!==null&&(this._deactivateAction(d),this._removeInactiveAction(d))}}class nw{constructor(s){this.value=s}clone(){return new nw(this.value.clone===void 0?this.value:this.value.clone())}}let V4=0;class W4 extends Za{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:V4++}),this.name="",this.usage=sp,this.uniforms=[]}add(s){return this.uniforms.push(s),this}remove(s){const c=this.uniforms.indexOf(s);return c!==-1&&this.uniforms.splice(c,1),this}setName(s){return this.name=s,this}setUsage(s){return this.usage=s,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(s){this.name=s.name,this.usage=s.usage;const c=s.uniforms;this.uniforms.length=0;for(let d=0,p=c.length;d<p;d++)this.uniforms.push(c[d].clone());return this}clone(){return new this.constructor().copy(this)}}class Q4 extends NA{constructor(s,c,d=1){super(s,c),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=d}copy(s){return super.copy(s),this.meshPerAttribute=s.meshPerAttribute,this}clone(s){const c=super.clone(s);return c.meshPerAttribute=this.meshPerAttribute,c}toJSON(s){const c=super.toJSON(s);return c.isInstancedInterleavedBuffer=!0,c.meshPerAttribute=this.meshPerAttribute,c}}class j4{constructor(s,c,d,p,_){this.isGLBufferAttribute=!0,this.buffer=s,this.type=c,this.itemSize=d,this.elementSize=p,this.count=_,this.version=0}set needsUpdate(s){s===!0&&this.version++}setBuffer(s){return this.buffer=s,this}setType(s,c){return this.type=s,this.elementSize=c,this}setItemSize(s){return this.itemSize=s,this}setCount(s){return this.count=s,this}}class q4{constructor(s,c,d=0,p=1/0){this.ray=new hp(s,c),this.near=d,this.far=p,this.camera=null,this.layers=new _A,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(s,c){this.ray.set(s,c)}setFromCamera(s,c){c.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(c.matrixWorld),this.ray.direction.set(s.x,s.y,.5).unproject(c).sub(this.ray.origin).normalize(),this.camera=c):c.isOrthographicCamera?(this.ray.origin.set(s.x,s.y,(c.near+c.far)/(c.near-c.far)).unproject(c),this.ray.direction.set(0,0,-1).transformDirection(c.matrixWorld),this.camera=c):console.error("THREE.Raycaster: Unsupported camera type: "+c.type)}intersectObject(s,c=!0,d=[]){return iw(s,this,d,c),d.sort($T),d}intersectObjects(s,c=!0,d=[]){for(let p=0,_=s.length;p<_;p++)iw(s[p],this,d,c);return d.sort($T),d}}function $T(y,s){return y.distance-s.distance}function iw(y,s,c,d){if(y.layers.test(s.layers)&&y.raycast(s,c),d===!0){const p=y.children;for(let _=0,x=p.length;_<x;_++)iw(p[_],s,c,!0)}}class X4{constructor(s=1,c=0,d=0){return this.radius=s,this.phi=c,this.theta=d,this}set(s,c,d){return this.radius=s,this.phi=c,this.theta=d,this}copy(s){return this.radius=s.radius,this.phi=s.phi,this.theta=s.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(s){return this.setFromCartesianCoords(s.x,s.y,s.z)}setFromCartesianCoords(s,c,d){return this.radius=Math.sqrt(s*s+c*c+d*d),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(s,d),this.phi=Math.acos(ds(c/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class Y4{constructor(s=1,c=0,d=0){return this.radius=s,this.theta=c,this.y=d,this}set(s,c,d){return this.radius=s,this.theta=c,this.y=d,this}copy(s){return this.radius=s.radius,this.theta=s.theta,this.y=s.y,this}setFromVector3(s){return this.setFromCartesianCoords(s.x,s.y,s.z)}setFromCartesianCoords(s,c,d){return this.radius=Math.sqrt(s*s+d*d),this.theta=Math.atan2(s,d),this.y=c,this}clone(){return new this.constructor().copy(this)}}const eI=new mt;class J4{constructor(s=new mt(1/0,1/0),c=new mt(-1/0,-1/0)){this.isBox2=!0,this.min=s,this.max=c}set(s,c){return this.min.copy(s),this.max.copy(c),this}setFromPoints(s){this.makeEmpty();for(let c=0,d=s.length;c<d;c++)this.expandByPoint(s[c]);return this}setFromCenterAndSize(s,c){const d=eI.copy(c).multiplyScalar(.5);return this.min.copy(s).sub(d),this.max.copy(s).add(d),this}clone(){return new this.constructor().copy(this)}copy(s){return this.min.copy(s.min),this.max.copy(s.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(s){return this.isEmpty()?s.set(0,0):s.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(s){return this.isEmpty()?s.set(0,0):s.subVectors(this.max,this.min)}expandByPoint(s){return this.min.min(s),this.max.max(s),this}expandByVector(s){return this.min.sub(s),this.max.add(s),this}expandByScalar(s){return this.min.addScalar(-s),this.max.addScalar(s),this}containsPoint(s){return!(s.x<this.min.x||s.x>this.max.x||s.y<this.min.y||s.y>this.max.y)}containsBox(s){return this.min.x<=s.min.x&&s.max.x<=this.max.x&&this.min.y<=s.min.y&&s.max.y<=this.max.y}getParameter(s,c){return c.set((s.x-this.min.x)/(this.max.x-this.min.x),(s.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(s){return!(s.max.x<this.min.x||s.min.x>this.max.x||s.max.y<this.min.y||s.min.y>this.max.y)}clampPoint(s,c){return c.copy(s).clamp(this.min,this.max)}distanceToPoint(s){return eI.copy(s).clamp(this.min,this.max).sub(s).length()}intersect(s){return this.min.max(s.min),this.max.min(s.max),this}union(s){return this.min.min(s.min),this.max.max(s.max),this}translate(s){return this.min.add(s),this.max.add(s),this}equals(s){return s.min.equals(this.min)&&s.max.equals(this.max)}}const tI=new de,o0=new de;class Z4{constructor(s=new de,c=new de){this.start=s,this.end=c}set(s,c){return this.start.copy(s),this.end.copy(c),this}copy(s){return this.start.copy(s.start),this.end.copy(s.end),this}getCenter(s){return s.addVectors(this.start,this.end).multiplyScalar(.5)}delta(s){return s.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(s,c){return this.delta(c).multiplyScalar(s).add(this.start)}closestPointToPointParameter(s,c){tI.subVectors(s,this.start),o0.subVectors(this.end,this.start);const d=o0.dot(o0);let _=o0.dot(tI)/d;return c&&(_=ds(_,0,1)),_}closestPointToPoint(s,c,d){const p=this.closestPointToPointParameter(s,c);return this.delta(d).multiplyScalar(p).add(this.start)}applyMatrix4(s){return this.start.applyMatrix4(s),this.end.applyMatrix4(s),this}equals(s){return s.start.equals(this.start)&&s.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const nI=new de;class K4 extends wi{constructor(s,c){super(),this.light=s,this.light.updateMatrixWorld(),this.matrix=s.matrixWorld,this.matrixAutoUpdate=!1,this.color=c;const d=new si,p=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let x=0,C=1,P=32;x<P;x++,C++){const L=x/P*Math.PI*2,O=C/P*Math.PI*2;p.push(Math.cos(L),Math.sin(L),1,Math.cos(O),Math.sin(O),1)}d.setAttribute("position",new gn(p,3));const _=new yr({fog:!1,toneMapped:!1});this.cone=new _a(d,_),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const s=this.light.distance?this.light.distance:1e3,c=s*Math.tan(this.light.angle);this.cone.scale.set(c,c,s),nI.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(nI),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const cl=new de,a0=new $n,sw=new $n;class $4 extends _a{constructor(s){const c=iI(s),d=new si,p=[],_=[],x=new dn(0,0,1),C=new dn(0,1,0);for(let L=0;L<c.length;L++){const O=c[L];O.parent&&O.parent.isBone&&(p.push(0,0,0),p.push(0,0,0),_.push(x.r,x.g,x.b),_.push(C.r,C.g,C.b))}d.setAttribute("position",new gn(p,3)),d.setAttribute("color",new gn(_,3));const P=new yr({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(d,P),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=s,this.bones=c,this.matrix=s.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(s){const c=this.bones,d=this.geometry,p=d.getAttribute("position");sw.copy(this.root.matrixWorld).invert();for(let _=0,x=0;_<c.length;_++){const C=c[_];C.parent&&C.parent.isBone&&(a0.multiplyMatrices(sw,C.matrixWorld),cl.setFromMatrixPosition(a0),p.setXYZ(x,cl.x,cl.y,cl.z),a0.multiplyMatrices(sw,C.parent.matrixWorld),cl.setFromMatrixPosition(a0),p.setXYZ(x+1,cl.x,cl.y,cl.z),x+=2)}d.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(s)}dispose(){this.geometry.dispose(),this.material.dispose()}}function iI(y){const s=[];y.isBone===!0&&s.push(y);for(let c=0;c<y.children.length;c++)s.push.apply(s,iI(y.children[c]));return s}class eH extends qs{constructor(s,c,d){const p=new _d(c,4,2),_=new $c({wireframe:!0,fog:!1,toneMapped:!1});super(p,_),this.light=s,this.light.updateMatrixWorld(),this.color=d,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const tH=new de,sI=new dn,rI=new dn;class nH extends wi{constructor(s,c,d){super(),this.light=s,this.light.updateMatrixWorld(),this.matrix=s.matrixWorld,this.matrixAutoUpdate=!1,this.color=d;const p=new Ad(c);p.rotateY(Math.PI*.5),this.material=new $c({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const _=p.getAttribute("position"),x=new Float32Array(_.count*3);p.setAttribute("color",new Oi(x,3)),this.add(new qs(p,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const s=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const c=s.geometry.getAttribute("color");sI.copy(this.light.color),rI.copy(this.light.groundColor);for(let d=0,p=c.count;d<p;d++){const _=d<p/2?sI:rI;c.setXYZ(d,_.r,_.g,_.b)}c.needsUpdate=!0}s.lookAt(tH.setFromMatrixPosition(this.light.matrixWorld).negate())}}class iH extends _a{constructor(s=10,c=10,d=4473924,p=8947848){d=new dn(d),p=new dn(p);const _=c/2,x=s/c,C=s/2,P=[],L=[];for(let N=0,z=0,V=-C;N<=c;N++,V+=x){P.push(-C,0,V,C,0,V),P.push(V,0,-C,V,0,C);const H=N===_?d:p;H.toArray(L,z),z+=3,H.toArray(L,z),z+=3,H.toArray(L,z),z+=3,H.toArray(L,z),z+=3}const O=new si;O.setAttribute("position",new gn(P,3)),O.setAttribute("color",new gn(L,3));const k=new yr({vertexColors:!0,toneMapped:!1});super(O,k),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class sH extends _a{constructor(s=10,c=16,d=8,p=64,_=4473924,x=8947848){_=new dn(_),x=new dn(x);const C=[],P=[];if(c>1)for(let k=0;k<c;k++){const N=k/c*(Math.PI*2),z=Math.sin(N)*s,V=Math.cos(N)*s;C.push(0,0,0),C.push(z,0,V);const H=k&1?_:x;P.push(H.r,H.g,H.b),P.push(H.r,H.g,H.b)}for(let k=0;k<d;k++){const N=k&1?_:x,z=s-s/d*k;for(let V=0;V<p;V++){let H=V/p*(Math.PI*2),G=Math.sin(H)*z,X=Math.cos(H)*z;C.push(G,0,X),P.push(N.r,N.g,N.b),H=(V+1)/p*(Math.PI*2),G=Math.sin(H)*z,X=Math.cos(H)*z,C.push(G,0,X),P.push(N.r,N.g,N.b)}}const L=new si;L.setAttribute("position",new gn(C,3)),L.setAttribute("color",new gn(P,3));const O=new yr({vertexColors:!0,toneMapped:!1});super(L,O),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const oI=new de,c0=new de,aI=new de;class rH extends wi{constructor(s,c,d){super(),this.light=s,this.light.updateMatrixWorld(),this.matrix=s.matrixWorld,this.matrixAutoUpdate=!1,this.color=d,c===void 0&&(c=1);let p=new si;p.setAttribute("position",new gn([-c,c,0,c,c,0,c,-c,0,-c,-c,0,-c,c,0],3));const _=new yr({fog:!1,toneMapped:!1});this.lightPlane=new rl(p,_),this.add(this.lightPlane),p=new si,p.setAttribute("position",new gn([0,0,0,0,0,1],3)),this.targetLine=new rl(p,_),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){oI.setFromMatrixPosition(this.light.matrixWorld),c0.setFromMatrixPosition(this.light.target.matrixWorld),aI.subVectors(c0,oI),this.lightPlane.lookAt(c0),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(c0),this.targetLine.scale.z=aI.length()}}const l0=new de,is=new IA;class oH extends _a{constructor(s){const c=new si,d=new yr({color:16777215,vertexColors:!0,toneMapped:!1}),p=[],_=[],x={};C("n1","n2"),C("n2","n4"),C("n4","n3"),C("n3","n1"),C("f1","f2"),C("f2","f4"),C("f4","f3"),C("f3","f1"),C("n1","f1"),C("n2","f2"),C("n3","f3"),C("n4","f4"),C("p","n1"),C("p","n2"),C("p","n3"),C("p","n4"),C("u1","u2"),C("u2","u3"),C("u3","u1"),C("c","t"),C("p","c"),C("cn1","cn2"),C("cn3","cn4"),C("cf1","cf2"),C("cf3","cf4");function C(V,H){P(V),P(H)}function P(V){p.push(0,0,0),_.push(0,0,0),x[V]===void 0&&(x[V]=[]),x[V].push(p.length/3-1)}c.setAttribute("position",new gn(p,3)),c.setAttribute("color",new gn(_,3)),super(c,d),this.type="CameraHelper",this.camera=s,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=s.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=x,this.update();const L=new dn(16755200),O=new dn(16711680),k=new dn(43775),N=new dn(16777215),z=new dn(3355443);this.setColors(L,O,k,N,z)}setColors(s,c,d,p,_){const C=this.geometry.getAttribute("color");C.setXYZ(0,s.r,s.g,s.b),C.setXYZ(1,s.r,s.g,s.b),C.setXYZ(2,s.r,s.g,s.b),C.setXYZ(3,s.r,s.g,s.b),C.setXYZ(4,s.r,s.g,s.b),C.setXYZ(5,s.r,s.g,s.b),C.setXYZ(6,s.r,s.g,s.b),C.setXYZ(7,s.r,s.g,s.b),C.setXYZ(8,s.r,s.g,s.b),C.setXYZ(9,s.r,s.g,s.b),C.setXYZ(10,s.r,s.g,s.b),C.setXYZ(11,s.r,s.g,s.b),C.setXYZ(12,s.r,s.g,s.b),C.setXYZ(13,s.r,s.g,s.b),C.setXYZ(14,s.r,s.g,s.b),C.setXYZ(15,s.r,s.g,s.b),C.setXYZ(16,s.r,s.g,s.b),C.setXYZ(17,s.r,s.g,s.b),C.setXYZ(18,s.r,s.g,s.b),C.setXYZ(19,s.r,s.g,s.b),C.setXYZ(20,s.r,s.g,s.b),C.setXYZ(21,s.r,s.g,s.b),C.setXYZ(22,s.r,s.g,s.b),C.setXYZ(23,s.r,s.g,s.b),C.setXYZ(24,c.r,c.g,c.b),C.setXYZ(25,c.r,c.g,c.b),C.setXYZ(26,c.r,c.g,c.b),C.setXYZ(27,c.r,c.g,c.b),C.setXYZ(28,c.r,c.g,c.b),C.setXYZ(29,c.r,c.g,c.b),C.setXYZ(30,c.r,c.g,c.b),C.setXYZ(31,c.r,c.g,c.b),C.setXYZ(32,d.r,d.g,d.b),C.setXYZ(33,d.r,d.g,d.b),C.setXYZ(34,d.r,d.g,d.b),C.setXYZ(35,d.r,d.g,d.b),C.setXYZ(36,d.r,d.g,d.b),C.setXYZ(37,d.r,d.g,d.b),C.setXYZ(38,p.r,p.g,p.b),C.setXYZ(39,p.r,p.g,p.b),C.setXYZ(40,_.r,_.g,_.b),C.setXYZ(41,_.r,_.g,_.b),C.setXYZ(42,_.r,_.g,_.b),C.setXYZ(43,_.r,_.g,_.b),C.setXYZ(44,_.r,_.g,_.b),C.setXYZ(45,_.r,_.g,_.b),C.setXYZ(46,_.r,_.g,_.b),C.setXYZ(47,_.r,_.g,_.b),C.setXYZ(48,_.r,_.g,_.b),C.setXYZ(49,_.r,_.g,_.b),C.needsUpdate=!0}update(){const s=this.geometry,c=this.pointMap,d=1,p=1;is.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),fs("c",c,s,is,0,0,-1),fs("t",c,s,is,0,0,1),fs("n1",c,s,is,-d,-p,-1),fs("n2",c,s,is,d,-p,-1),fs("n3",c,s,is,-d,p,-1),fs("n4",c,s,is,d,p,-1),fs("f1",c,s,is,-d,-p,1),fs("f2",c,s,is,d,-p,1),fs("f3",c,s,is,-d,p,1),fs("f4",c,s,is,d,p,1),fs("u1",c,s,is,d*.7,p*1.1,-1),fs("u2",c,s,is,-d*.7,p*1.1,-1),fs("u3",c,s,is,0,p*2,-1),fs("cf1",c,s,is,-d,0,1),fs("cf2",c,s,is,d,0,1),fs("cf3",c,s,is,0,-p,1),fs("cf4",c,s,is,0,p,1),fs("cn1",c,s,is,-d,0,-1),fs("cn2",c,s,is,d,0,-1),fs("cn3",c,s,is,0,-p,-1),fs("cn4",c,s,is,0,p,-1),s.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function fs(y,s,c,d,p,_,x){l0.set(p,_,x).unproject(d);const C=s[y];if(C!==void 0){const P=c.getAttribute("position");for(let L=0,O=C.length;L<O;L++)P.setXYZ(C[L],l0.x,l0.y,l0.z)}}const h0=new _h;class aH extends _a{constructor(s,c=16776960){const d=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),p=new Float32Array(8*3),_=new si;_.setIndex(new Oi(d,1)),_.setAttribute("position",new Oi(p,3)),super(_,new yr({color:c,toneMapped:!1})),this.object=s,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(s){if(s!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&h0.setFromObject(this.object),h0.isEmpty())return;const c=h0.min,d=h0.max,p=this.geometry.attributes.position,_=p.array;_[0]=d.x,_[1]=d.y,_[2]=d.z,_[3]=c.x,_[4]=d.y,_[5]=d.z,_[6]=c.x,_[7]=c.y,_[8]=d.z,_[9]=d.x,_[10]=c.y,_[11]=d.z,_[12]=d.x,_[13]=d.y,_[14]=c.z,_[15]=c.x,_[16]=d.y,_[17]=c.z,_[18]=c.x,_[19]=c.y,_[20]=c.z,_[21]=d.x,_[22]=c.y,_[23]=c.z,p.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(s){return this.object=s,this.update(),this}copy(s,c){return super.copy(s,c),this.object=s.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class cH extends _a{constructor(s,c=16776960){const d=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),p=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],_=new si;_.setIndex(new Oi(d,1)),_.setAttribute("position",new gn(p,3)),super(_,new yr({color:c,toneMapped:!1})),this.box=s,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(s){const c=this.box;c.isEmpty()||(c.getCenter(this.position),c.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(s))}dispose(){this.geometry.dispose(),this.material.dispose()}}class lH extends rl{constructor(s,c=1,d=16776960){const p=d,_=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],x=new si;x.setAttribute("position",new gn(_,3)),x.computeBoundingSphere(),super(x,new yr({color:p,toneMapped:!1})),this.type="PlaneHelper",this.plane=s,this.size=c;const C=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],P=new si;P.setAttribute("position",new gn(C,3)),P.computeBoundingSphere(),this.add(new qs(P,new $c({color:p,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(s){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(s)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const cI=new de;let u0,rw;class hH extends wi{constructor(s=new de(0,0,1),c=new de(0,0,0),d=1,p=16776960,_=d*.2,x=_*.2){super(),this.type="ArrowHelper",u0===void 0&&(u0=new si,u0.setAttribute("position",new gn([0,0,0,0,1,0],3)),rw=new Sh(0,.5,1,5,1),rw.translate(0,-.5,0)),this.position.copy(c),this.line=new rl(u0,new yr({color:p,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new qs(rw,new $c({color:p,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(s),this.setLength(d,_,x)}setDirection(s){if(s.y>.99999)this.quaternion.set(0,0,0,1);else if(s.y<-.99999)this.quaternion.set(1,0,0,0);else{cI.set(s.z,0,-s.x).normalize();const c=Math.acos(s.y);this.quaternion.setFromAxisAngle(cI,c)}}setLength(s,c=s*.2,d=c*.2){this.line.scale.set(1,Math.max(1e-4,s-c),1),this.line.updateMatrix(),this.cone.scale.set(d,c,d),this.cone.position.y=s,this.cone.updateMatrix()}setColor(s){this.line.material.color.set(s),this.cone.material.color.set(s)}copy(s){return super.copy(s,!1),this.line.copy(s.line),this.cone.copy(s.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class uH extends _a{constructor(s=1){const c=[0,0,0,s,0,0,0,0,0,0,s,0,0,0,0,0,0,s],d=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],p=new si;p.setAttribute("position",new gn(c,3)),p.setAttribute("color",new gn(d,3));const _=new yr({vertexColors:!0,toneMapped:!1});super(p,_),this.type="AxesHelper"}setColors(s,c,d){const p=new dn,_=this.geometry.attributes.color.array;return p.set(s),p.toArray(_,0),p.toArray(_,3),p.set(c),p.toArray(_,6),p.toArray(_,9),p.set(d),p.toArray(_,12),p.toArray(_,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class dH{constructor(){this.type="ShapePath",this.color=new dn,this.subPaths=[],this.currentPath=null}moveTo(s,c){return this.currentPath=new xp,this.subPaths.push(this.currentPath),this.currentPath.moveTo(s,c),this}lineTo(s,c){return this.currentPath.lineTo(s,c),this}quadraticCurveTo(s,c,d,p){return this.currentPath.quadraticCurveTo(s,c,d,p),this}bezierCurveTo(s,c,d,p,_,x){return this.currentPath.bezierCurveTo(s,c,d,p,_,x),this}splineThru(s){return this.currentPath.splineThru(s),this}toShapes(s){function c(X){const Z=[];for(let ne=0,te=X.length;ne<te;ne++){const oe=X[ne],ue=new Mh;ue.curves=oe.curves,Z.push(ue)}return Z}function d(X,Z){const ne=Z.length;let te=!1;for(let oe=ne-1,ue=0;ue<ne;oe=ue++){let be=Z[oe],$=Z[ue],ge=$.x-be.x,Se=$.y-be.y;if(Math.abs(Se)>Number.EPSILON){if(Se<0&&(be=Z[ue],ge=-ge,$=Z[oe],Se=-Se),X.y<be.y||X.y>$.y)continue;if(X.y===be.y){if(X.x===be.x)return!0}else{const et=Se*(X.x-be.x)-ge*(X.y-be.y);if(et===0)return!0;if(et<0)continue;te=!te}}else{if(X.y!==be.y)continue;if($.x<=X.x&&X.x<=be.x||be.x<=X.x&&X.x<=$.x)return!0}}return te}const p=ya.isClockWise,_=this.subPaths;if(_.length===0)return[];let x,C,P;const L=[];if(_.length===1)return C=_[0],P=new Mh,P.curves=C.curves,L.push(P),L;let O=!p(_[0].getPoints());O=s?!O:O;const k=[],N=[];let z=[],V=0,H;N[V]=void 0,z[V]=[];for(let X=0,Z=_.length;X<Z;X++)C=_[X],H=C.getPoints(),x=p(H),x=s?!x:x,x?(!O&&N[V]&&V++,N[V]={s:new Mh,p:H},N[V].s.curves=C.curves,O&&V++,z[V]=[]):z[V].push({h:C,p:H[0]});if(!N[0])return c(_);if(N.length>1){let X=!1,Z=0;for(let ne=0,te=N.length;ne<te;ne++)k[ne]=[];for(let ne=0,te=N.length;ne<te;ne++){const oe=z[ne];for(let ue=0;ue<oe.length;ue++){const be=oe[ue];let $=!0;for(let ge=0;ge<N.length;ge++)d(be.p,N[ge].p)&&(ne!==ge&&Z++,$?($=!1,k[ge].push(be)):X=!0);$&&k[ne].push(be)}}Z>0&&X===!1&&(z=k)}let G;for(let X=0,Z=N.length;X<Z;X++){P=N[X].s,L.push(P),G=z[X];for(let ne=0,te=G.length;ne<te;ne++)P.holes.push(G[ne].h)}return L}}const ac=fH();function fH(){const y=new ArrayBuffer(4),s=new Float32Array(y),c=new Uint32Array(y),d=new Uint32Array(512),p=new Uint32Array(512);for(let P=0;P<256;++P){const L=P-127;L<-27?(d[P]=0,d[P|256]=32768,p[P]=24,p[P|256]=24):L<-14?(d[P]=1024>>-L-14,d[P|256]=1024>>-L-14|32768,p[P]=-L-1,p[P|256]=-L-1):L<=15?(d[P]=L+15<<10,d[P|256]=L+15<<10|32768,p[P]=13,p[P|256]=13):L<128?(d[P]=31744,d[P|256]=64512,p[P]=24,p[P|256]=24):(d[P]=31744,d[P|256]=64512,p[P]=13,p[P|256]=13)}const _=new Uint32Array(2048),x=new Uint32Array(64),C=new Uint32Array(64);for(let P=1;P<1024;++P){let L=P<<13,O=0;for(;(L&8388608)===0;)L<<=1,O-=8388608;L&=-8388609,O+=947912704,_[P]=L|O}for(let P=1024;P<2048;++P)_[P]=939524096+(P-1024<<13);for(let P=1;P<31;++P)x[P]=P<<23;x[31]=1199570944,x[32]=2147483648;for(let P=33;P<63;++P)x[P]=2147483648+(P-32<<23);x[63]=3347054592;for(let P=1;P<64;++P)P!==32&&(C[P]=1024);return{floatView:s,uint32View:c,baseTable:d,shiftTable:p,mantissaTable:_,exponentTable:x,offsetTable:C}}function pH(y){Math.abs(y)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),y=ds(y,-65504,65504),ac.floatView[0]=y;const s=ac.uint32View[0],c=s>>23&511;return ac.baseTable[c]+((s&8388607)>>ac.shiftTable[c])}function mH(y){const s=y>>10;return ac.uint32View[0]=ac.mantissaTable[ac.offsetTable[s]+(y&1023)]+ac.exponentTable[s],ac.floatView[0]}var gH=Object.freeze({__proto__:null,toHalfFloat:pH,fromHalfFloat:mH});function AH(){console.error("THREE.ImmediateRenderObject has been removed.")}class _H extends _o{constructor(s,c,d){console.error('THREE.WebGLMultisampleRenderTarget has been removed. Use a normal render target and set the "samples" property to greater 0 to enable multisampling.'),super(s,c,d),this.samples=4}}class yH extends cp{constructor(s,c,d,p){console.warn("THREE.DataTexture2DArray has been renamed to DataArrayTexture."),super(s,c,d,p)}}class vH extends uA{constructor(s,c,d,p){console.warn("THREE.DataTexture3D has been renamed to Data3DTexture."),super(s,c,d,p)}}class xH extends il{constructor(s,c,d,p,_,x){console.warn("THREE.BoxBufferGeometry has been renamed to THREE.BoxGeometry."),super(s,c,d,p,_,x)}}class wH extends wp{constructor(s,c,d,p){console.warn("THREE.CapsuleBufferGeometry has been renamed to THREE.CapsuleGeometry."),super(s,c,d,p)}}class bH extends bp{constructor(s,c,d,p){console.warn("THREE.CircleBufferGeometry has been renamed to THREE.CircleGeometry."),super(s,c,d,p)}}class EH extends Ep{constructor(s,c,d,p,_,x,C){console.warn("THREE.ConeBufferGeometry has been renamed to THREE.ConeGeometry."),super(s,c,d,p,_,x,C)}}class CH extends Sh{constructor(s,c,d,p,_,x,C,P){console.warn("THREE.CylinderBufferGeometry has been renamed to THREE.CylinderGeometry."),super(s,c,d,p,_,x,C,P)}}class SH extends Cp{constructor(s,c){console.warn("THREE.DodecahedronBufferGeometry has been renamed to THREE.DodecahedronGeometry."),super(s,c)}}class MH extends Ip{constructor(s,c){console.warn("THREE.ExtrudeBufferGeometry has been renamed to THREE.ExtrudeGeometry."),super(s,c)}}class TH extends Rp{constructor(s,c){console.warn("THREE.IcosahedronBufferGeometry has been renamed to THREE.IcosahedronGeometry."),super(s,c)}}class IH extends md{constructor(s,c,d,p){console.warn("THREE.LatheBufferGeometry has been renamed to THREE.LatheGeometry."),super(s,c,d,p)}}class RH extends Ad{constructor(s,c){console.warn("THREE.OctahedronBufferGeometry has been renamed to THREE.OctahedronGeometry."),super(s,c)}}class PH extends sd{constructor(s,c,d,p){console.warn("THREE.PlaneBufferGeometry has been renamed to THREE.PlaneGeometry."),super(s,c,d,p)}}class BH extends sc{constructor(s,c,d,p){console.warn("THREE.PolyhedronBufferGeometry has been renamed to THREE.PolyhedronGeometry."),super(s,c,d,p)}}class LH extends Pp{constructor(s,c,d,p,_,x){console.warn("THREE.RingBufferGeometry has been renamed to THREE.RingGeometry."),super(s,c,d,p,_,x)}}class DH extends Bp{constructor(s,c){console.warn("THREE.ShapeBufferGeometry has been renamed to THREE.ShapeGeometry."),super(s,c)}}class OH extends _d{constructor(s,c,d,p,_,x,C){console.warn("THREE.SphereBufferGeometry has been renamed to THREE.SphereGeometry."),super(s,c,d,p,_,x,C)}}class FH extends Lp{constructor(s,c){console.warn("THREE.TetrahedronBufferGeometry has been renamed to THREE.TetrahedronGeometry."),super(s,c)}}class kH extends Dp{constructor(s,c,d,p,_){console.warn("THREE.TorusBufferGeometry has been renamed to THREE.TorusGeometry."),super(s,c,d,p,_)}}class NH extends Op{constructor(s,c,d,p,_,x){console.warn("THREE.TorusKnotBufferGeometry has been renamed to THREE.TorusKnotGeometry."),super(s,c,d,p,_,x)}}class UH extends Fp{constructor(s,c,d,p,_){console.warn("THREE.TubeBufferGeometry has been renamed to THREE.TubeGeometry."),super(s,c,d,p,_)}}return typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:a}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=a),K.ACESFilmicToneMapping=Jt,K.AddEquation=I,K.AddOperation=Ft,K.AdditiveAnimationBlendMode=Gv,K.AdditiveBlending=b,K.AlphaFormat=Ir,K.AlwaysDepth=Be,K.AlwaysStencilFunc=LM,K.AmbientLight=NT,K.AmbientLightProbe=b4,K.AnimationClip=zp,K.AnimationLoader=h4,K.AnimationMixer=H4,K.AnimationObjectGroup=U4,K.AnimationUtils=o4,K.ArcCurve=tT,K.ArrayCamera=C1,K.ArrowHelper=hH,K.Audio=JT,K.AudioAnalyser=I4,K.AudioContext=$x,K.AudioListener=S4,K.AudioLoader=x4,K.AxesHelper=uH,K.BackSide=m,K.BasicDepthPacking=RM,K.BasicShadowMap=l,K.Bone=Sx,K.BooleanKeyframeTrack=Ih,K.Box2=J4,K.Box3=_h,K.Box3Helper=cH,K.BoxBufferGeometry=xH,K.BoxGeometry=il,K.BoxHelper=aH,K.BufferAttribute=Oi,K.BufferGeometry=si,K.BufferGeometryLoader=HT,K.ByteType=Ce,K.Cache=Ph,K.Camera=IA,K.CameraHelper=oH,K.CanvasTexture=RG,K.CapsuleBufferGeometry=wH,K.CapsuleGeometry=wp,K.CatmullRomCurve3=nT,K.CineonToneMapping=vt,K.CircleBufferGeometry=bH,K.CircleGeometry=bp,K.ClampToEdgeWrapping=Qe,K.Clock=qT,K.Color=dn,K.ColorKeyframeTrack=qx,K.ColorManagement=Ao,K.CompressedTexture=eT,K.CompressedTextureLoader=u4,K.ConeBufferGeometry=EH,K.ConeGeometry=Ep,K.CubeCamera=JM,K.CubeReflectionMapping=Zt,K.CubeRefractionMapping=ln,K.CubeTexture=fp,K.CubeTextureLoader=d4,K.CubeUVReflectionMapping=me,K.CubicBezierCurve=Dx,K.CubicBezierCurve3=sT,K.CubicInterpolant=MT,K.CullFaceBack=i,K.CullFaceFront=r,K.CullFaceFrontBack=o,K.CullFaceNone=n,K.Curve=qo,K.CurvePath=oT,K.CustomBlending=M,K.CustomToneMapping=Lt,K.CylinderBufferGeometry=CH,K.CylinderGeometry=Sh,K.Cylindrical=Y4,K.Data3DTexture=uA,K.DataArrayTexture=cp,K.DataTexture=fd,K.DataTexture2DArray=yH,K.DataTexture3D=vH,K.DataTextureLoader=f4,K.DataUtils=gH,K.DecrementStencilOp=SF,K.DecrementWrapStencilOp=TF,K.DefaultLoadingManager=RT,K.DepthFormat=mo,K.DepthStencilFormat=Rr,K.DepthTexture=S1,K.DirectionalLight=kT,K.DirectionalLightHelper=rH,K.DiscreteInterpolant=TT,K.DodecahedronBufferGeometry=SH,K.DodecahedronGeometry=Cp,K.DoubleSide=A,K.DstAlphaFactor=se,K.DstColorFactor=ve,K.DynamicCopyUsage=VF,K.DynamicDrawUsage=kF,K.DynamicReadUsage=zF,K.EdgesGeometry=aT,K.EllipseCurve=XA,K.EqualDepth=yt,K.EqualStencilFunc=BF,K.EquirectangularReflectionMapping=ii,K.EquirectangularRefractionMapping=Zn,K.Euler=Xu,K.EventDispatcher=Za,K.ExtrudeBufferGeometry=MH,K.ExtrudeGeometry=Ip,K.FileLoader=oc,K.Float16BufferAttribute=Ek,K.Float32BufferAttribute=gn,K.Float64BufferAttribute=Ck,K.FloatType=wn,K.Fog=kA,K.FogExp2=FA,K.FramebufferTexture=IG,K.FrontSide=g,K.Frustum=PA,K.GLBufferAttribute=j4,K.GLSL1=QF,K.GLSL3=Hv,K.GreaterDepth=He,K.GreaterEqualDepth=Nt,K.GreaterEqualStencilFunc=FF,K.GreaterStencilFunc=DF,K.GridHelper=iH,K.Group=cd,K.HalfFloatType=di,K.HemisphereLight=PT,K.HemisphereLightHelper=nH,K.HemisphereLightProbe=w4,K.IcosahedronBufferGeometry=TH,K.IcosahedronGeometry=Rp,K.ImageBitmapLoader=v4,K.ImageLoader=Gp,K.ImageUtils=qv,K.ImmediateRenderObject=AH,K.IncrementStencilOp=CF,K.IncrementWrapStencilOp=MF,K.InstancedBufferAttribute=pd,K.InstancedBufferGeometry=GT,K.InstancedInterleavedBuffer=Q4,K.InstancedMesh=W1,K.Int16BufferAttribute=wk,K.Int32BufferAttribute=bk,K.Int8BufferAttribute=yk,K.IntType=Ie,K.InterleavedBuffer=NA,K.InterleavedBufferAttribute=Ch,K.Interpolant=kp,K.InterpolateDiscrete=gr,K.InterpolateLinear=Ho,K.InterpolateSmooth=Ar,K.InvertStencilOp=IF,K.KeepStencilOp=rA,K.KeyframeTrack=Xo,K.LOD=O1,K.LatheBufferGeometry=IH,K.LatheGeometry=md,K.Layers=_A,K.LessDepth=Le,K.LessEqualDepth=$e,K.LessEqualStencilFunc=LF,K.LessStencilFunc=PF,K.Light=al,K.LightProbe=i0,K.Line=rl,K.Line3=Z4,K.LineBasicMaterial=yr,K.LineCurve=JA,K.LineCurve3=rT,K.LineDashedMaterial=CT,K.LineLoop=J1,K.LineSegments=_a,K.LinearEncoding=jc,K.LinearFilter=bt,K.LinearInterpolant=jx,K.LinearMipMapLinearFilter=Bn,K.LinearMipMapNearestFilter=nn,K.LinearMipmapLinearFilter=Ht,K.LinearMipmapNearestFilter=hn,K.LinearSRGBColorSpace=Xc,K.LinearToneMapping=it,K.Loader=Jr,K.LoaderUtils=Kx,K.LoadingManager=Xx,K.LoopOnce=Yi,K.LoopPingPong=Ii,K.LoopRepeat=xi,K.LuminanceAlphaFormat=fh,K.LuminanceFormat=Ja,K.MOUSE=e,K.Material=rr,K.MaterialLoader=s0,K.MathUtils=rk,K.Matrix3=Pr,K.Matrix4=$n,K.MaxEquation=D,K.Mesh=qs,K.MeshBasicMaterial=$c,K.MeshDepthMaterial=xx,K.MeshDistanceMaterial=wx,K.MeshLambertMaterial=bT,K.MeshMatcapMaterial=ET,K.MeshNormalMaterial=wT,K.MeshPhongMaterial=vT,K.MeshPhysicalMaterial=yT,K.MeshStandardMaterial=Hx,K.MeshToonMaterial=xT,K.MinEquation=F,K.MirroredRepeatWrapping=At,K.MixOperation=pn,K.MultiplyBlending=R,K.MultiplyOperation=Xt,K.NearestFilter=pt,K.NearestMipMapLinearFilter=Fe,K.NearestMipMapNearestFilter=Mn,K.NearestMipmapLinearFilter=we,K.NearestMipmapNearestFilter=zt,K.NeverDepth=Me,K.NeverStencilFunc=RF,K.NoBlending=v,K.NoColorSpace=wF,K.NoToneMapping=yn,K.NormalAnimationBlendMode=sA,K.NormalBlending=w,K.NotEqualDepth=mn,K.NotEqualStencilFunc=OF,K.NumberKeyframeTrack=Np,K.Object3D=wi,K.ObjectLoader=_4,K.ObjectSpaceNormalMap=BM,K.OctahedronBufferGeometry=RH,K.OctahedronGeometry=Ad,K.OneFactor=W,K.OneMinusDstAlphaFactor=ae,K.OneMinusDstColorFactor=xe,K.OneMinusSrcAlphaFactor=Y,K.OneMinusSrcColorFactor=ee,K.OrthographicCamera=BA,K.PCFShadowMap=h,K.PCFSoftShadowMap=u,K.PMREMGenerator=Ax,K.Path=xp,K.PerspectiveCamera=Xs,K.Plane=sl,K.PlaneBufferGeometry=PH,K.PlaneGeometry=sd,K.PlaneHelper=lH,K.PointLight=FT,K.PointLightHelper=eH,K.Points=K1,K.PointsMaterial=Tx,K.PolarGridHelper=sH,K.PolyhedronBufferGeometry=BH,K.PolyhedronGeometry=sc,K.PositionalAudio=T4,K.PropertyBinding=pi,K.PropertyMixer=KT,K.QuadraticBezierCurve=Ox,K.QuadraticBezierCurve3=Fx,K.Quaternion=Br,K.QuaternionKeyframeTrack=yd,K.QuaternionLinearInterpolant=IT,K.REVISION=a,K.RGBADepthPacking=PM,K.RGBAFormat=ir,K.RGBAIntegerFormat=ke,K.RGBA_ASTC_10x10_Format=fi,K.RGBA_ASTC_10x5_Format=Ci,K.RGBA_ASTC_10x6_Format=Kn,K.RGBA_ASTC_10x8_Format=Wi,K.RGBA_ASTC_12x10_Format=In,K.RGBA_ASTC_12x12_Format=Li,K.RGBA_ASTC_4x4_Format=xt,K.RGBA_ASTC_5x4_Format=Kt,K.RGBA_ASTC_5x5_Format=wt,K.RGBA_ASTC_6x5_Format=vn,K.RGBA_ASTC_6x6_Format=fn,K.RGBA_ASTC_8x5_Format=$t,K.RGBA_ASTC_8x6_Format=un,K.RGBA_ASTC_8x8_Format=Fn,K.RGBA_BPTC_Format=zs,K.RGBA_ETC2_EAC_Format=ut,K.RGBA_PVRTC_2BPPV1_Format=Ze,K.RGBA_PVRTC_4BPPV1_Format=De,K.RGBA_S3TC_DXT1_Format=j,K.RGBA_S3TC_DXT3_Format=ie,K.RGBA_S3TC_DXT5_Format=pe,K.RGBFormat=js,K.RGB_ETC1_Format=lt,K.RGB_ETC2_Format=St,K.RGB_PVRTC_2BPPV1_Format=Ve,K.RGB_PVRTC_4BPPV1_Format=Ee,K.RGB_S3TC_DXT1_Format=nt,K.RGFormat=ze,K.RGIntegerFormat=Ue,K.RawShaderMaterial=_T,K.Ray=hp,K.Raycaster=q4,K.RectAreaLight=UT,K.RedFormat=Gu,K.RedIntegerFormat=he,K.ReinhardToneMapping=tt,K.RepeatWrapping=ce,K.ReplaceStencilOp=EF,K.ReverseSubtractEquation=B,K.RingBufferGeometry=LH,K.RingGeometry=Pp,K.SRGBColorSpace=ga,K.Scene=I1,K.ShaderChunk=oi,K.ShaderLib=jo,K.ShaderMaterial=Aa,K.ShadowMaterial=AT,K.Shape=Mh,K.ShapeBufferGeometry=DH,K.ShapeGeometry=Bp,K.ShapePath=dH,K.ShapeUtils=ya,K.ShortType=Rt,K.Skeleton=VA,K.SkeletonHelper=$4,K.SkinnedMesh=z1,K.Source=Ah,K.Sphere=wh,K.SphereBufferGeometry=OH,K.SphereGeometry=_d,K.Spherical=X4,K.SphericalHarmonics3=zT,K.SplineCurve=kx,K.SpotLight=DT,K.SpotLightHelper=K4,K.Sprite=L1,K.SpriteMaterial=Ex,K.SrcAlphaFactor=Q,K.SrcAlphaSaturateFactor=Ae,K.SrcColorFactor=J,K.StaticCopyUsage=HF,K.StaticDrawUsage=sp,K.StaticReadUsage=UF,K.StereoCamera=E4,K.StreamCopyUsage=WF,K.StreamDrawUsage=NF,K.StreamReadUsage=GF,K.StringKeyframeTrack=Rh,K.SubtractEquation=T,K.SubtractiveBlending=S,K.TOUCH=t,K.TangentSpaceNormalMap=qc,K.TetrahedronBufferGeometry=FH,K.TetrahedronGeometry=Lp,K.Texture=Ps,K.TextureLoader=p4,K.TorusBufferGeometry=kH,K.TorusGeometry=Dp,K.TorusKnotBufferGeometry=NH,K.TorusKnotGeometry=Op,K.Triangle=yo,K.TriangleFanDrawMode=xF,K.TriangleStripDrawMode=vF,K.TrianglesDrawMode=yF,K.TubeBufferGeometry=UH,K.TubeGeometry=Fp,K.UVMapping=En,K.Uint16BufferAttribute=ox,K.Uint32BufferAttribute=ax,K.Uint8BufferAttribute=vk,K.Uint8ClampedBufferAttribute=xk,K.Uniform=nw,K.UniformsGroup=W4,K.UniformsLib=Vt,K.UniformsUtils=YM,K.UnsignedByteType=Ln,K.UnsignedInt248Type=vi,K.UnsignedIntType=Ct,K.UnsignedShort4444Type=Gi,K.UnsignedShort5551Type=jr,K.UnsignedShortType=kt,K.VSMShadowMap=f,K.Vector2=mt,K.Vector3=de,K.Vector4=Ri,K.VectorKeyframeTrack=Up,K.VideoTexture=TG,K.WebGL1Renderer=T1,K.WebGL3DRenderTarget=lk,K.WebGLArrayRenderTarget=ck,K.WebGLCubeRenderTarget=ZM,K.WebGLMultipleRenderTargets=hk,K.WebGLMultisampleRenderTarget=_H,K.WebGLRenderTarget=_o,K.WebGLRenderer=M1,K.WebGLUtils=E1,K.WireframeGeometry=pT,K.WrapAroundEnding=ip,K.ZeroCurvatureEnding=go,K.ZeroFactor=U,K.ZeroSlopeEnding=ph,K.ZeroStencilOp=bF,K._SRGBAFormat=oA,K.sRGBEncoding=$i,K}(function(a,e){(function(){var t=this,n=typeof wE<"u",i=t.THREE||n&&wte();if(!i)throw new Error("MeshLine requires three.js");class r extends i.BufferGeometry{constructor(){super(),this.isMeshLine=!0,this.type="MeshLine",this.positions=[],this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[],this.counters=[],this._points=[],this._geom=null,this.widthCallback=null,this.matrixWorld=new i.Matrix4,Object.defineProperties(this,{geometry:{enumerable:!0,get:function(){return this}},geom:{enumerable:!0,get:function(){return this._geom},set:function(f){this.setGeometry(f,this.widthCallback)}},points:{enumerable:!0,get:function(){return this._points},set:function(f){this.setPoints(f,this.widthCallback)}}})}}r.prototype.setMatrixWorld=function(u){this.matrixWorld=u},r.prototype.setGeometry=function(u,f){this._geometry=u,this.setPoints(u.getAttribute("position").array,f)},r.prototype.setPoints=function(u,f){if(!(u instanceof Float32Array)&&!(u instanceof Array)){console.error("ERROR: The BufferArray of points is not instancied correctly.");return}if(this._points=u,this.widthCallback=f,this.positions=[],this.counters=[],u.length&&u[0]instanceof i.Vector3)for(var g=0;g<u.length;g++){var m=u[g],A=g/u.length;this.positions.push(m.x,m.y,m.z),this.positions.push(m.x,m.y,m.z),this.counters.push(A),this.counters.push(A)}else for(var g=0;g<u.length;g+=3){var A=g/u.length;this.positions.push(u[g],u[g+1],u[g+2]),this.positions.push(u[g],u[g+1],u[g+2]),this.counters.push(A),this.counters.push(A)}this.process()};function o(u,f){var g=new i.Matrix4,m=new i.Ray,A=new i.Sphere,v=new i.Vector3,w=this.geometry;if(w.boundingSphere||w.computeBoundingSphere(),A.copy(w.boundingSphere),A.applyMatrix4(this.matrixWorld),u.ray.intersectSphere(A,v)!==!1){g.copy(this.matrixWorld).invert(),m.copy(u.ray).applyMatrix4(g);var b=new i.Vector3,S=new i.Vector3,R=new i.Vector3,M=this instanceof i.LineSegments?2:1,I=w.index,T=w.attributes;if(I!==null)for(var B=I.array,F=T.position.array,D=T.width.array,U=0,W=B.length-1;U<W;U+=M){var J=B[U],ee=B[U+1];b.fromArray(F,J*3),S.fromArray(F,ee*3);var Q=D[Math.floor(U/3)]!==void 0?D[Math.floor(U/3)]:1,Y=u.params.Line.threshold+this.material.lineWidth*Q/2,se=Y*Y,ae=m.distanceSqToSegment(b,S,v,R);if(!(ae>se)){v.applyMatrix4(this.matrixWorld);var ve=u.ray.origin.distanceTo(v);ve<u.near||ve>u.far||(f.push({distance:ve,point:R.clone().applyMatrix4(this.matrixWorld),index:U,face:null,faceIndex:null,object:this}),U=W)}}}}r.prototype.raycast=o,r.prototype.compareV3=function(u,f){var g=u*6,m=f*6;return this.positions[g]===this.positions[m]&&this.positions[g+1]===this.positions[m+1]&&this.positions[g+2]===this.positions[m+2]},r.prototype.copyV3=function(u){var f=u*6;return[this.positions[f],this.positions[f+1],this.positions[f+2]]},r.prototype.process=function(){var u=this.positions.length/6;this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[];var f,g;this.compareV3(0,u-1)?g=this.copyV3(u-2):g=this.copyV3(0),this.previous.push(g[0],g[1],g[2]),this.previous.push(g[0],g[1],g[2]);for(var m=0;m<u;m++){if(this.side.push(1),this.side.push(-1),this.widthCallback?f=this.widthCallback(m/(u-1)):f=1,this.width.push(f),this.width.push(f),this.uvs.push(m/(u-1),0),this.uvs.push(m/(u-1),1),m<u-1){g=this.copyV3(m),this.previous.push(g[0],g[1],g[2]),this.previous.push(g[0],g[1],g[2]);var A=m*2;this.indices_array.push(A,A+1,A+2),this.indices_array.push(A+2,A+1,A+3)}m>0&&(g=this.copyV3(m),this.next.push(g[0],g[1],g[2]),this.next.push(g[0],g[1],g[2]))}this.compareV3(u-1,0)?g=this.copyV3(1):g=this.copyV3(u-1),this.next.push(g[0],g[1],g[2]),this.next.push(g[0],g[1],g[2]),!this._attributes||this._attributes.position.count!==this.positions.length?this._attributes={position:new i.BufferAttribute(new Float32Array(this.positions),3),previous:new i.BufferAttribute(new Float32Array(this.previous),3),next:new i.BufferAttribute(new Float32Array(this.next),3),side:new i.BufferAttribute(new Float32Array(this.side),1),width:new i.BufferAttribute(new Float32Array(this.width),1),uv:new i.BufferAttribute(new Float32Array(this.uvs),2),index:new i.BufferAttribute(new Uint16Array(this.indices_array),1),counters:new i.BufferAttribute(new Float32Array(this.counters),1)}:(this._attributes.position.copyArray(new Float32Array(this.positions)),this._attributes.position.needsUpdate=!0,this._attributes.previous.copyArray(new Float32Array(this.previous)),this._attributes.previous.needsUpdate=!0,this._attributes.next.copyArray(new Float32Array(this.next)),this._attributes.next.needsUpdate=!0,this._attributes.side.copyArray(new Float32Array(this.side)),this._attributes.side.needsUpdate=!0,this._attributes.width.copyArray(new Float32Array(this.width)),this._attributes.width.needsUpdate=!0,this._attributes.uv.copyArray(new Float32Array(this.uvs)),this._attributes.uv.needsUpdate=!0,this._attributes.index.copyArray(new Uint16Array(this.indices_array)),this._attributes.index.needsUpdate=!0),this.setAttribute("position",this._attributes.position),this.setAttribute("previous",this._attributes.previous),this.setAttribute("next",this._attributes.next),this.setAttribute("side",this._attributes.side),this.setAttribute("width",this._attributes.width),this.setAttribute("uv",this._attributes.uv),this.setAttribute("counters",this._attributes.counters),this.setIndex(this._attributes.index),this.computeBoundingSphere(),this.computeBoundingBox()};function l(u,f,g,m,A){var v;if(u=u.subarray||u.slice?u:u.buffer,g=g.subarray||g.slice?g:g.buffer,u=f?u.subarray?u.subarray(f,A&&f+A):u.slice(f,A&&f+A):u,g.set)g.set(u,m);else for(v=0;v<u.length;v++)g[v+m]=u[v];return g}r.prototype.advance=function(u){var f=this._attributes.position.array,g=this._attributes.previous.array,m=this._attributes.next.array,A=f.length;l(f,0,g,0,A),l(f,6,f,0,A-6),f[A-6]=u.x,f[A-5]=u.y,f[A-4]=u.z,f[A-3]=u.x,f[A-2]=u.y,f[A-1]=u.z,l(f,6,m,0,A-6),m[A-6]=u.x,m[A-5]=u.y,m[A-4]=u.z,m[A-3]=u.x,m[A-2]=u.y,m[A-1]=u.z,this._attributes.position.needsUpdate=!0,this._attributes.previous.needsUpdate=!0,this._attributes.next.needsUpdate=!0},i.ShaderChunk.meshline_vert=["",i.ShaderChunk.logdepthbuf_pars_vertex,i.ShaderChunk.fog_pars_vertex,"","attribute vec3 previous;","attribute vec3 next;","attribute float side;","attribute float width;","attribute float counters;","","uniform vec2 resolution;","uniform float lineWidth;","uniform vec3 color;","uniform float opacity;","uniform float sizeAttenuation;","","varying vec2 vUV;","varying vec4 vColor;","varying float vCounters;","","vec2 fix( vec4 i, float aspect ) {","","    vec2 res = i.xy / i.w;","    res.x *= aspect;","	 vCounters = counters;","    return res;","","}","","void main() {","","    float aspect = resolution.x / resolution.y;","","    vColor = vec4( color, opacity );","    vUV = uv;","","    mat4 m = projectionMatrix * modelViewMatrix;","    vec4 finalPosition = m * vec4( position, 1.0 );","    vec4 prevPos = m * vec4( previous, 1.0 );","    vec4 nextPos = m * vec4( next, 1.0 );","","    vec2 currentP = fix( finalPosition, aspect );","    vec2 prevP = fix( prevPos, aspect );","    vec2 nextP = fix( nextPos, aspect );","","    float w = lineWidth * width;","","    vec2 dir;","    if( nextP == currentP ) dir = normalize( currentP - prevP );","    else if( prevP == currentP ) dir = normalize( nextP - currentP );","    else {","        vec2 dir1 = normalize( currentP - prevP );","        vec2 dir2 = normalize( nextP - currentP );","        dir = normalize( dir1 + dir2 );","","        vec2 perp = vec2( -dir1.y, dir1.x );","        vec2 miter = vec2( -dir.y, dir.x );","        //w = clamp( w / dot( miter, perp ), 0., 4. * lineWidth * width );","","    }","","    //vec2 normal = ( cross( vec3( dir, 0. ), vec3( 0., 0., 1. ) ) ).xy;","    vec4 normal = vec4( -dir.y, dir.x, 0., 1. );","    normal.xy *= .5 * w;","    normal *= projectionMatrix;","    if( sizeAttenuation == 0. ) {","        normal.xy *= finalPosition.w;","        normal.xy /= ( vec4( resolution, 0., 1. ) * projectionMatrix ).xy;","    }","","    finalPosition.xy += normal.xy * side;","","    gl_Position = finalPosition;","",i.ShaderChunk.logdepthbuf_vertex,i.ShaderChunk.fog_vertex&&"    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",i.ShaderChunk.fog_vertex,"}"].join(`
`),i.ShaderChunk.meshline_frag=["",i.ShaderChunk.fog_pars_fragment,i.ShaderChunk.logdepthbuf_pars_fragment,"","uniform sampler2D map;","uniform sampler2D alphaMap;","uniform float useMap;","uniform float useAlphaMap;","uniform float useDash;","uniform float dashArray;","uniform float dashOffset;","uniform float dashRatio;","uniform float visibility;","uniform float alphaTest;","uniform vec2 repeat;","","varying vec2 vUV;","varying vec4 vColor;","varying float vCounters;","","void main() {","",i.ShaderChunk.logdepthbuf_fragment,"","    vec4 c = vColor;","    if( useMap == 1. ) c *= texture2D( map, vUV * repeat );","    if( useAlphaMap == 1. ) c.a *= texture2D( alphaMap, vUV * repeat ).a;","    if( c.a < alphaTest ) discard;","    if( useDash == 1. ){","        c.a *= ceil(mod(vCounters + dashOffset, dashArray) - (dashArray * dashRatio));","    }","    gl_FragColor = c;","    gl_FragColor.a *= step(vCounters, visibility);","",i.ShaderChunk.fog_fragment,"}"].join(`
`);class h extends i.ShaderMaterial{constructor(f){super({uniforms:Object.assign({},i.UniformsLib.fog,{lineWidth:{value:1},map:{value:null},useMap:{value:0},alphaMap:{value:null},useAlphaMap:{value:0},color:{value:new i.Color(16777215)},opacity:{value:1},resolution:{value:new i.Vector2(1,1)},sizeAttenuation:{value:1},dashArray:{value:0},dashOffset:{value:0},dashRatio:{value:.5},useDash:{value:0},visibility:{value:1},alphaTest:{value:0},repeat:{value:new i.Vector2(1,1)}}),vertexShader:i.ShaderChunk.meshline_vert,fragmentShader:i.ShaderChunk.meshline_frag}),this.isMeshLineMaterial=!0,this.type="MeshLineMaterial",Object.defineProperties(this,{lineWidth:{enumerable:!0,get:function(){return this.uniforms.lineWidth.value},set:function(g){this.uniforms.lineWidth.value=g}},map:{enumerable:!0,get:function(){return this.uniforms.map.value},set:function(g){this.uniforms.map.value=g}},useMap:{enumerable:!0,get:function(){return this.uniforms.useMap.value},set:function(g){this.uniforms.useMap.value=g}},alphaMap:{enumerable:!0,get:function(){return this.uniforms.alphaMap.value},set:function(g){this.uniforms.alphaMap.value=g}},useAlphaMap:{enumerable:!0,get:function(){return this.uniforms.useAlphaMap.value},set:function(g){this.uniforms.useAlphaMap.value=g}},color:{enumerable:!0,get:function(){return this.uniforms.color.value},set:function(g){this.uniforms.color.value=g}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(g){this.uniforms.opacity.value=g}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(g){this.uniforms.resolution.value.copy(g)}},sizeAttenuation:{enumerable:!0,get:function(){return this.uniforms.sizeAttenuation.value},set:function(g){this.uniforms.sizeAttenuation.value=g}},dashArray:{enumerable:!0,get:function(){return this.uniforms.dashArray.value},set:function(g){this.uniforms.dashArray.value=g,this.useDash=g!==0?1:0}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(g){this.uniforms.dashOffset.value=g}},dashRatio:{enumerable:!0,get:function(){return this.uniforms.dashRatio.value},set:function(g){this.uniforms.dashRatio.value=g}},useDash:{enumerable:!0,get:function(){return this.uniforms.useDash.value},set:function(g){this.uniforms.useDash.value=g}},visibility:{enumerable:!0,get:function(){return this.uniforms.visibility.value},set:function(g){this.uniforms.visibility.value=g}},alphaTest:{enumerable:!0,get:function(){return this.uniforms.alphaTest.value},set:function(g){this.uniforms.alphaTest.value=g}},repeat:{enumerable:!0,get:function(){return this.uniforms.repeat.value},set:function(g){this.uniforms.repeat.value.copy(g)}}}),this.setValues(f)}}h.prototype.copy=function(u){return i.ShaderMaterial.prototype.copy.call(this,u),this.lineWidth=u.lineWidth,this.map=u.map,this.useMap=u.useMap,this.alphaMap=u.alphaMap,this.useAlphaMap=u.useAlphaMap,this.color.copy(u.color),this.opacity=u.opacity,this.resolution.copy(u.resolution),this.sizeAttenuation=u.sizeAttenuation,this.dashArray.copy(u.dashArray),this.dashOffset.copy(u.dashOffset),this.dashRatio.copy(u.dashRatio),this.useDash=u.useDash,this.visibility=u.visibility,this.alphaTest=u.alphaTest,this.repeat.copy(u.repeat),this},a.exports&&(e=a.exports={MeshLine:r,MeshLineMaterial:h,MeshLineRaycast:o}),e.MeshLine=r,e.MeshLineMaterial=h,e.MeshLineRaycast=o}).call(gm)})(ug,ug.exports);const IM=class{constructor(e,t){E(this,"id",0);E(this,"points",[]);E(this,"line",new ug.exports.MeshLine);E(this,"material");E(this,"mesh");E(this,"defaultLineMaterial",new ug.exports.MeshLineMaterial({color:10066329,lineWidth:.01}));if(t&&(this.material=t.material),this.material||(this.material=this.defaultLineMaterial),t){const n=t.options;n&&Object.assign(this.material,n)}this.mesh=new _t(this.line,this.material),e.add(this.mesh)}appendPoint(e){var i;let t=IM.wp;t.set(e.x,e.y,e.z);const n=(i=this.mesh)==null?void 0:i.parent;return n&&(t=n.worldToLocal(t),e.x=t.x,e.y=t.y,e.z=t.z),this.points.push(e.x,e.y,e.z),this.line.setPoints(this.points),e}};let Om=IM;E(Om,"wp",new q);class WE extends Bt{constructor(){super(...arguments);E(this,"finished",[]);E(this,"inFlight",[]);E(this,"buffer",{});E(this,"freeBuffer",new Array)}startLine(t,n){const i=Math.random()*Number.MAX_SAFE_INTEGER;return this.internalStartLine(t,i,!0,n)}updateLine(t,n){const i=this.inFlight[t.id];if(!i)return;n.point&&(n.point=i.appendPoint(n.point));const r=this.buffer[t.id];r&&(n.point&&r.push(n.point.x,n.point.y,n.point.z),r.length>5&&(this.sendLineUpdate(i,!1,void 0,r),r.length=0))}endLine(t,n=!0){const i=this.inFlight[t.id];if(!i)return;this.finished.push(i),delete this.inFlight[t.id],n&&this.sendLineUpdate(i,!0,0);const r=this.buffer[t.id];if(r){delete this.buffer[t.id];const o=r;o.length=0,this.freeBuffer.push(o)}return i}getLine(t){return this.inFlight[t.id]}awake(){this.context.connection.beginListen("line-start",t=>{this.onEnsureLine(t.id,t.parentGuid)}),this.context.connection.beginListen("line-update",t=>{let n=this.onEnsureLine(t.guid,t.parentGuid);n&&t.points&&(t.startIndex<=0?n.points=t.points:t.startIndex>=n.points.length&&n.points.push(...t.points),n.line.setPoints(n.points),n.material.lineWidth=t.width,n.material.color.fromArray(t.color),t.finished===!0&&this.endLine({id:n.id},!1))})}onEnsureLine(t,n){if(this.inFlight[t])return this.inFlight[t];let i=Te.findByGuid(n,this.context.scene);if(!!i)return this.internalStartLine(i,t,!1),this.inFlight[t]}internalStartLine(t,n,i=!0,r){const o=new Om(t!=null?t:this.context.scene,r);o.id=n,this.inFlight[n]=o,i&&this.sendLineStart(o);let l;return this.freeBuffer.length<=0?l=new Array:l=this.freeBuffer.pop(),this.buffer[n]=l,{id:n}}sendLineStart(t){const n=t.mesh.parent;this.context.connection.send("line-start",{id:t.id,parentGuid:n?n.guid:void 0})}sendLineUpdate(t,n,i,r){if(t){const o={parentGuid:t.mesh.parent.guid,guid:t.id,points:r?[...r]:t.points,width:t.material.lineWidth,color:t.material.color.toArray(),startIndex:i!==void 0?i:t.points.length,finished:n};this.context.connection.send("line-update",o)}}}class mB{constructor(){E(this,"isDrawing");E(this,"lastHit");E(this,"currentHandle");E(this,"maxDistance");E(this,"prevDistance");E(this,"lastParent");this.isDrawing=!1,this.lastHit=new q,this.currentHandle=null,this.maxDistance=0,this.prevDistance=0,this.lastParent=null}}const by=class extends Bt{constructor(){super(...arguments);E(this,"lines");E(this,"colliders");E(this,"alignToSurface",!0);E(this,"addToPaintedObject",!0);E(this,"orbit");E(this,"_states",{});E(this,"_raycastOptions",new Wc)}start(){var n;this.lines||(this.lines=Te.getComponent(this.gameObject,WE),this.lines||(this.lines=Te.addNewComponent(this.gameObject,WE))),this.orbit=(n=Te.findObjectOfType(Ff,this.context))!=null?n:void 0,this._states.mouse=new mB;const t={};gs.addEventListener(Vl.SelectStart,(i,r)=>{t[i.controller.uuid]=!0}),gs.addEventListener(Vl.Update,(i,r)=>{if(t[i.controller.uuid]===!0){const o=i.getRay();this.updateLine(i.controller.uuid,o,!0,!1,!1)}}),gs.addEventListener(Vl.SelectEnd,(i,r)=>{t[i.controller.uuid]=!1;const o=i.getRay();this.updateLine(i.controller.uuid,o,!0,!0,!1)})}update(){this.orbit&&this._states.mouse&&this.orbit&&(this.orbit.enabled=!this._states.mouse.isDrawing);const t=this.context.input.getPointerPressedCount()>1,n=this.context.input.getPointerPositionRC(0);by._raycaster.setFromCamera(n,this.context.mainCamera);const i=by._raycaster.ray;this.updateLine("mouse",i,this.context.input.getPointerPressed(0),this.context.input.getPointerUp(0),t||this.context.input.isKeyPressed(Dc.ALT))}updateLine(t,n,i,r,o=!1){var h;let l=this._states[t];if(l||(this._states[t]=new mB,l=this._states[t]),r)l.isDrawing=!1,l.currentHandle&&(this.lines.endLine(l.currentHandle),l.currentHandle=null);else if(i){if(o)return l;const u=this.getHit(n);let f=null,g=l.prevDistance;if(u)l.currentHandle||(l.maxDistance=u.distance),f=u.point,f.add(u.face.normal.multiplyScalar(.01)),l.prevDistance=u.distance;else if(l.maxDistance>0){if(l.maxDistance,!l.currentHandle&&l.lastHit){const m=ti(this.context.mainCamera);l.lastHit.distanceTo(m)}f=n.origin.add(n.direction.multiplyScalar(l.maxDistance)),l.prevDistance=l.maxDistance}if(f){if(!l.currentHandle){let m=(h=l.lastParent)!=null?h:this.gameObject;this.addToPaintedObject&&u&&(m=u.object),l.lastParent=m,l.currentHandle=this.lines.startLine(m,{material:this.createRandomMaterial()})}if(this.alignToSurface&&(l.prevDistance>l.maxDistance||Math.abs(g-l.prevDistance)>.2)){const m=l.maxDistance;f=n.origin.add(n.direction.multiplyScalar(m)),l.prevDistance=m}if(l.lastHit&&l.lastHit.distanceTo(f)<l.prevDistance*.01)return l;this.lines.updateLine(l.currentHandle,{point:f}),l.lastHit.copy(f)}l.isDrawing=l.currentHandle!==null}return l}getHit(t){(!this.colliders||this.colliders.length===0)&&(this.colliders=[this.gameObject]),this._raycastOptions.targets=this.colliders,this._raycastOptions.ray=t;const n=this.context.physics.raycast(this._raycastOptions);if(n.length>0){for(const i of n)if(!!Te.isActiveInHierarchy(i.object))return i}return null}createRandomMaterial(){let t;return this.context.connection.connectionId?t=eh.colorFromHashCode(eh.hashCode(this.context.connection.connectionId)):t=new _e("hsl("+(Math.random()*100).toFixed(0)+", 80%, 30%)"),new ug.exports.MeshLineMaterial({color:t,lineWidth:Ei.lerp(.005,.01,Math.random())})}};let U_=by;E(U_,"_raycaster",new Du);var bte=Object.defineProperty,Ete=Object.getOwnPropertyDescriptor,sF=(a,e,t,n)=>{for(var i=n>1?void 0:n?Ete(e,t):e,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&bte(e,t,i),i};class rF extends Bt{constructor(){super(...arguments);E(this,"asset");E(this,"joinedRoomFunction")}awake(){this.watchTabVisible(),this.joinedRoomFunction=this.onUserJoined.bind(this)}onEnable(){this.context.connection.beginListen(ha.JoinedRoom,this.joinedRoomFunction)}onDisable(){this.context.connection.stopListening(ha.JoinedRoom,this.joinedRoomFunction)}async onUserJoined(t){var i;const n=await((i=this.asset)==null?void 0:i.instantiateSynced({parent:this.gameObject},!0));if(n){let r=Te.getComponent(n,Fm);r&&(r.owner=this.context.connection.connectionId)}}watchTabVisible(){window.addEventListener("visibilitychange",t=>{if(document.visibilityState==="visible")for(let n=Fm.all.length-1;n>=0;n--){const i=Fm.all[n];(!i.owner||!this.context.connection.userIsInRoom(i.owner))&&i.doDestroy()}})}}sF([Re(Nc)],rF.prototype,"asset",2);var y_;const $o=(y_=class extends Bt{constructor(){super(...arguments);E(this,"owner")}static get all(){return $o._all}static get local(){return $o._local}static isLocalPlayer(e){var t,n,i,r;return e instanceof qt?(n=(t=Te.getComponentInParent(e,$o))==null?void 0:t.isLocalPlayer)!=null?n:!1:e instanceof Ro&&(r=(i=Te.getComponentInParent(e.gameObject,$o))==null?void 0:i.isLocalPlayer)!=null?r:!1}get isLocalPlayer(){return this.owner===this.context.connection.connectionId}awake(){this.isLocalPlayer&&$o.local.push(this),$o.all.push(this),this.context.connection.beginListen(ha.UserLeftRoom,e=>{if(e.userId===this.owner){this.doDestroy();return}})}start(){if(!this.owner||!this.context.connection.userIsInRoom(this.owner)){this.doDestroy();return}}doDestroy(){eS(this.gameObject,this.context.connection)}onDestroy(){if($o.all.splice($o.all.indexOf(this),1),this.isLocalPlayer){const e=$o._local.indexOf(this);e>=0&&$o._local.splice(e,1)}}},E(y_,"_all",[]),E(y_,"_local",[]),y_);let Fm=$o;sF([i3(),Re()],Fm.prototype,"owner",2);je.add("AlignmentConstraint",rv);je.add("Animation",Hl);je.add("AnimationCurve",gS);je.add("Animator",rh);je.add("AnimatorController",bf);je.add("AudioListener",ig);je.add("AudioSource",Wr);je.add("AvatarModel",AS);je.add("AvatarLoader",_S);je.add("AxesHelper",Ng);je.add("BasicIKConstraint",ZD);je.add("BoxHelperComponent",Ic);je.add("Camera",Us);je.add("Collider",Uf);je.add("SphereCollider",ov);je.add("BoxCollider",av);je.add("InstantiateOptions",Fo);je.add("UnityObject",$D);je.add("DeleteBox",xS);je.add("Deletable",eO);je.add("DeviceFlag",wS);je.add("DragControls",Pc);je.add("DropListener",cv);je.add("Duplicatable",Gf);je.add("CallInfo",rg);je.add("EventListEvent",MS);je.add("EventList",ua);je.add("EventTrigger",aO);je.add("FlyControls",cO);je.add("BoxGizmo",Gg);je.add("GltfExportBox",uO);je.add("GltfExport",Ol);je.add("GridHelper",Hg);je.add("GroundProjectedEnv",Vg);je.add("Interactable",Ug);je.add("UsageMarker",zg);je.add("Light",Go);je.add("LODModel",Hf);je.add("LODGroup",hv);je.add("LookAtConstraint",nv);je.add("NavMesh",dO);je.add("NavMeshAgent",fO);je.add("NestedGltf",BS);je.add("Networking",Ru);je.add("OffsetConstraint",Vf);je.add("OrbitControls",Ff);je.add("ParticleSystemRenderer",LS);je.add("ParticleSystem",_O);je.add("MainModule",pO);je.add("EmissionModule",mO);je.add("ShapeModule",gO);je.add("PlayerColor",eh);je.add("FieldWithDefault",ID);je.add("Renderer",Vr);je.add("MeshRenderer",lS);je.add("SkinnedMeshRenderer",PD);je.add("InstancingUtil",ro);je.add("RendererLightmap",ty);je.add("Rigidbody",Tr);je.add("ScreenCapture",yO);je.add("ShadowCatcher",dv);je.add("RemoteSkybox",fv);je.add("SmoothFollow",pv);je.add("SpatialTriggerReceiver",Oc);je.add("SpatialTrigger",mv);je.add("SpectatorCamera",o3);je.add("SpringJoint",a3);je.add("Sprite",qS);je.add("SpriteRenderer",Jg);je.add("SyncedCamera",Av);je.add("SyncedRoom",Nu);je.add("SyncedTransform",$l);je.add("TestRunner",l3);je.add("TestSimulateUserData",h3);je.add("TransformGizmo",XS);je.add("VideoPlayer",Xa);je.add("Voip",lh);je.add("VolumeParameter",f3);je.add("VolumeComponent",Kf);je.add("ToneMapping",_v);je.add("ColorAdjustments",yv);je.add("VolumeProfile",vv);je.add("Volume",YS);je.add("WebARSessionRoot",zf);je.add("WebXR",Ti);je.add("WebAR",uf);je.add("AvatarMarker",fr);je.add("WebXRAvatar",Rc);je.add("TeleportTarget",ES);je.add("WebXRController",gs);je.add("AttachedObject",oa);je.add("XRGrabModel",JS);je.add("XRGrabRendering",p3);je.add("XRRig",CS);je.add("VRUserState",Da);je.add("WebXRSync",cy);je.add("XRState",Ha);je.add("XRFlag",ur);je.add("AvatarBlink_Simple",$f);je.add("AvatarEyeLook_Rotation",Kg);je.add("Avatar_POI",zr);je.add("Avatar_Brain_LookAt",ay);je.add("Avatar_MouthShapes",wv);je.add("Avatar_MustacheShake",A3);je.add("LogStats",_3);je.add("RGBAColor",oo);je.add("PlayableDirector",pf);je.add("SignalAsset",KS);je.add("SignalReceiverEvent",$S);je.add("SignalReceiver",bv);je.add("AnimationTrackHandler",eM);je.add("AudioTrackHandler",tM);je.add("SignalTrackHandler",Ay);je.add("ControlTrackHandler",ff);je.add("BaseUIComponent",Qc);je.add("UIRootComponent",Ov);je.add("Button",dh);je.add("Canvas",da);je.add("CanvasGroup",eA);je.add("EventSystem",aa);je.add("Graphic",Uu);je.add("MaskableGraphic",kv);je.add("Image",Nv);je.add("RawImage",xM);je.add("InputField",np);je.add("Keyboard",K3);je.add("LayoutGroup",tA);je.add("VerticalLayoutGroup",$3);je.add("HorizontalLayoutGroup",eF);je.add("GridLayoutGroup",tF);je.add("PointerEventData",of);je.add("Raycaster",bM);je.add("ObjectRaycaster",hg);je.add("GraphicRaycaster",nF);je.add("Size",q3);je.add("Rect",yM);je.add("RectTransform",uh);je.add("SpatialHtml",iF);je.add("Text",Qr);je.add("PresentationMode",xte);je.add("LinesDrawer",U_);je.add("LineInstanceHandler",Om);je.add("LinesManager",WE);je.add("PlayerSync",rF);je.add("PlayerState",Fm);class Cte extends kg{constructor(){super([_e,oo])}onDeserialize(e){if(e!=null)return e.a!==void 0?new oo(e.r,e.g,e.b,e.a):e.alpha!==void 0?new oo(e.r,e.g,e.b,e.alpha):new _e(e.r,e.g,e.b)}onSerialize(e){if(e!=null)return e.a!==void 0?{r:e.r,g:e.g,b:e.b,a:e.a}:{r:e.r,g:e.g,b:e.b}}}new Cte;class Ste extends kg{constructor(){super(qt)}onSerialize(e,t){if(t.objectToNode!==void 0&&e.uuid){const n=t.objectToNode[e.uuid];return ao&&console.log(n,e.name,e.uuid),{node:n}}}onDeserialize(e,t){var n;if(e){if(e.node!==void 0&&t.nodeToObject){const i=t.nodeToObject[e.node];return ao&&console.log("Deserialized object reference?",e,i,t==null?void 0:t.nodeToObject),i||console.warn("Did not find node: "+e.node,t.nodeToObject,t.object),i}else if(e.guid){if(!t.context){console.error("Missing context");return}let i,r=(n=t.gltf)==null?void 0:n.scene;return r&&(i=Te.findByGuid(e.guid,r)),i||(i=Te.findByGuid(e.guid,t.context.scene)),i?ao&&console.log("Deserialized object reference?",e,i,t==null?void 0:t.nodeToObject):console.warn("could not resolve reference",e,t.target,t.path,t.context.scene),i}}}}const Mte=new Ste;class Tte extends kg{constructor(){super([Ro,Bt])}onSerialize(e,t){if(e!=null&&e.guid)return{guid:e.guid}}onDeserialize(e,t){var n;if(e!=null&&e.guid){ao&&console.log(e.guid,t.root,t.object,t.target);const i=this.findObjectForGuid(e.guid,t.root);if(i)return i;if(t.context)return this.findObjectForGuid(e.guid,(n=t.context)==null?void 0:n.scene)}}findObjectForGuid(e,t){if(t.guid===e)return t;const n=Te.foreachComponent(t,i=>{if(i.guid===e)return i},!1);if(n!==void 0)return n;for(let i=0;i<t.children.length;i++){const r=t.children[i],o=this.findObjectForGuid(e,r);if(o)return o}}}const Tb=new Tte;class Ite extends kg{constructor(){super([ua])}onSerialize(e,t){console.log("TODO: SERIALIZE EVENT")}onDeserialize(e,t){var n,i,r,o;if(e&&e.type==="EventList"){ao&&console.log("DESERIALIZE EVENT",e);const l=new Array;for(const f of e.calls){ao&&console.log(f);let g=Tb.findObjectForGuid(f.target,t.root);!g&&((n=t.context)==null?void 0:n.scene)&&(g=Tb.findObjectForGuid(f.target,(i=t.context)==null?void 0:i.scene));const m=((r=f.method)==null?void 0:r.length)>0;if(g&&m){const b=()=>console.warn(`Could not find method ${f.method} on object ${g.name}`,g,typeof g[f.method]);if(typeof g[f.method]!="function"){let S=!1;f.method.startsWith("set_")&&f.method.length>4&&(f.method=f.method.substring(4),g[f.method]!==void 0&&(S=!0)),S||b()}}let A,v=f.argument;f.argument!==void 0?(typeof v=="object"&&(v=Mte.onDeserialize(f.argument,t),v||(v=Tb.onDeserialize(f.argument,t))),A=new rg(m?(...b)=>w(...b):void 0,f.enabled)):A=new rg(m?(...b)=>w(...b):void 0,f.enabled);const w=(...b)=>{const S=g[f.method];typeof S=="function"?v!==void 0?S==null||S.call(g,v):S==null||S.call(g,...b):g[f.method]=v};if(A.method||(A.__debuginfo=(o=t.object)==null?void 0:o.name),!g||!A.method){const b=t.object?"Current object: "+t.object.name+", "+t.object.guid:null;g?console.warn('EventList method not found: "'+f.method+'" on',g):console.warn("EventList is missing target - will be ignored",f.target,b,e)}else l.push(A)}const h=new ua(l);ao&&console.log(h);const u=t.target;return u!==void 0&&t.path!==void 0&&h.setEventTarget(t.path,u),h}}}new Ite;const oF=ao;function Rte(a,e){const n=DJ(a,e);return n!==void 0?n:null}async function aF(a,e,t,n=null,i){if(!t)return;let r=n;typeof r=="number"&&(r=new la(n));const o=new HD(t.scene);o.gltfId=e,o.context=a,o.gltf=t,o.nodeToObject=i==null?void 0:i.nodeToObjectMap;const l=[];if(t.scenes)for(const h of t.scenes)await jE(o,h,l);if(t.children)for(const h of t.children)await jE(o,h,l);a.new_scripts_pre_setup_callbacks.push(()=>{for(const h of l)Pte(h,o);if(r){QE(t,r);for(const h of t.scenes)QE(h,r)}})}function QE(a,e){if(e!==null&&!!a){if(a.guid=e.generateUUID(),a&&a.userData&&a.userData.components)for(const t of a.userData.components)t!==null&&(t.guid=e.generateUUID());if(a.children)for(const t of a.children)QE(t,e)}}const dm=[];async function jE(a,e,t,n){if(!e)return;const i=e.userData;if(i){const r=i.builtin_components;if(r&&r.length>0)for(const o of r)try{if(o===null)continue;const l=je.get(o.name);if(l!=null){const h=new l;h.sourceId=a.gltfId,mS(h,o),E2(h,e,!1),t.push({instance:h,compData:o,obj:e})}else oF&&console.debug("unknown component: "+o.name),dm.includes(o.name)||dm.push(o.name)}catch(l){console.error(o.name+" - "+l.message,l)}if(dm.length>0){const o=dm.join(", ");console.warn("unknown components: "+o),dm.length=0}}if(e.children)for(const r of e.children)await jE(a,r,t)}function Pte(a,e){const{instance:t,compData:n,obj:i}=a;e.object=i,e.target=t,SE(t,n,e),oF&&console.debug("add "+n.name,n,t)}new Fs;const nA=new Uint8Array(4);nA[0]=255;nA[1]=255;nA[2]=255;nA[3]=255;const Bte=new Na(nA,1,1,us);function Lte(a,e=1){const t="alpha"in a,n=e*e,i=new Uint8Array(4*n),r=Math.floor(a.r*255),o=Math.floor(a.g*255),l=Math.floor(a.b*255);for(let u=0;u<n;u++){const f=u*4;i[f+0]=r,i[f+1]=o,i[f+2]=l,t?i[f+3]=Math.floor(a.alpha*255):i[f+3]=255}const h=new Na(i,e,e);return h.needsUpdate=!0,h}function Dte(a,e,t,n=1,i=3){const o=n*i,l=[a,e,t],h=l.length,u=new Uint8Array(4*h*o),f=new _e;for(let m=0;m<i;m++){const A=Math.floor(m/i*h),v=Ei.clamp(A+1,0,h-1),w=l[A],b=l[v],S=m/i*h%1;f.lerpColors(w,b,S);const R=Math.floor(f.r*255),M=Math.floor(f.g*255),I=Math.floor(f.b*255);for(let T=0;T<n;T++){const B=(m*n+T)*4;u[B+0]=R,u[B+1]=M,u[B+2]=I,u[B+3]=255}}const g=new Na(u,n,i);return g.needsUpdate=!0,g}function yy(a,e){const t=a.elements;e||(e=[]),e.length=0;for(let n=0;n<16;n+=4){const i=t[n],r=t[n+1],o=t[n+2],l=t[n+3],h=new On(i,r,o,l);e.push(h)}return e}const Ib=[],gB=[];function cF(a,e){if(Ib.length===0)for(let t=0;t<27;t++)Ib.push(0);e||(e=Ib);for(let t=0;t<27;t++)gB[t]=e[t];e=gB,a.unity_SHAr={value:new On(e[9],e[3],e[6],e[0])},a.unity_SHBr={value:new On(e[12],e[15],e[18],e[21])},a.unity_SHAg={value:new On(e[10],e[4],e[7],e[1])},a.unity_SHBg={value:new On(e[13],e[16],e[19],e[22])},a.unity_SHAb={value:new On(e[11],e[5],e[8],e[2])},a.unity_SHBb={value:new On(e[14],e[17],e[20],e[23])},a.unity_SHC={value:new On(e[24],e[25],e[26],1)}}class Ote{constructor(e,t,n){E(this,"vertexShader");E(this,"fragmentShader");E(this,"technique");this.vertexShader=e,this.fragmentShader=t,this.technique=n}}async function Fte(a,e){if(!a)return console.error("Can not find technique: no shader data"),null;const t=a.programs[e],n=t.vertexShader,i=t.fragmentShader;if(n!==void 0&&i!==void 0){const r=a.shaders[n],o=a.shaders[i];if(r.uri&&o.uri||r.code&&o.code){if(!r.code&&r.uri&&await AB(r),!o.code&&o.uri&&await AB(o),!r.code||!o.code)return null;const l=a.techniques[e];return new Ote(r.code,o.code,l)}}return console.error("Shader technique not found",e),null}async function AB(a){const e=a.uri;if(!!e)if(e.endsWith(".glsl")){const n=await new Fs().loadAsync(e);a.code=n.toString()}else a.code=kte(a.uri)}function kte(a){return decodeURIComponent(Array.prototype.map.call(atob(a),function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""))}var lF=(a=>(a[a.INT=5124]="INT",a[a.FLOAT=5126]="FLOAT",a[a.FLOAT_VEC2=35664]="FLOAT_VEC2",a[a.FLOAT_VEC3=35665]="FLOAT_VEC3",a[a.FLOAT_VEC4=35666]="FLOAT_VEC4",a[a.INT_VEC2=35667]="INT_VEC2",a[a.INT_VEC3=35668]="INT_VEC3",a[a.INT_VEC4=35669]="INT_VEC4",a[a.BOOL=35670]="BOOL",a[a.BOOL_VEC2=35671]="BOOL_VEC2",a[a.BOOL_VEC3=35672]="BOOL_VEC3",a[a.BOOL_VEC4=35673]="BOOL_VEC4",a[a.FLOAT_MAT2=35674]="FLOAT_MAT2",a[a.FLOAT_MAT3=35675]="FLOAT_MAT3",a[a.FLOAT_MAT4=35676]="FLOAT_MAT4",a[a.SAMPLER_2D=35678]="SAMPLER_2D",a[a.SAMPLER_3D=35680]="SAMPLER_3D",a[a.SAMPLER_CUBE=35681]="SAMPLER_CUBE",a[a.UNKNOWN=0]="UNKNOWN",a))(lF||{});const Ec=jt("debugshaders"),qd="NEEDLE_techniques_webgl";class Nte{constructor(){E(this,"objectToWorldMatrix",new xn);E(this,"worldToObjectMatrix",new xn);E(this,"objectToWorld",new Array);E(this,"worldToObject",new Array)}updateFrom(e){this.objectToWorldMatrix.copy(e.matrixWorld),yy(this.objectToWorldMatrix,this.objectToWorld),this.worldToObjectMatrix.copy(e.matrixWorld).invert(),yy(this.worldToObjectMatrix,this.worldToObject)}}const Ji=class extends BC{constructor(t,...n){super(...n);E(this,"identifier");E(this,"onBeforeRenderSceneCallback",this.onBeforeRenderScene.bind(this));E(this,"_sphericalHarmonicsName","unity_SpecCube0");E(this,"_objToWorldName","hlslcc_mtx4x4unity_ObjectToWorld");E(this,"_worldToObjectName","hlslcc_mtx4x4unity_WorldToObject");E(this,"_viewProjectionName","hlslcc_mtx4x4unity_MatrixVP");E(this,"_viewMatrixName","hlslcc_mtx4x4unity_MatrixV");E(this,"_rendererData",new Nte);this.identifier=t,Ec&&console.log(this),this.type="NEEDLE_CUSTOM_SHADER",this.uniforms[this._objToWorldName]||(this.uniforms[this._objToWorldName]={value:[]}),this.uniforms[this._worldToObjectName]||(this.uniforms[this._worldToObjectName]={value:[]}),this.uniforms[this._viewProjectionName]||(this.uniforms[this._viewProjectionName]={value:[]}),this.uniforms[this._sphericalHarmonicsName]&&this.waitForLighting(),(this.depthTextureUniform||this.opaqueTextureUniform)&&_i.Current.pre_render_callbacks.push(this.onBeforeRenderSceneCallback)}dispose(){super.dispose();const t=_i.Current.pre_render_callbacks.indexOf(this.onBeforeRenderSceneCallback);t>=0&&_i.Current.pre_render_callbacks.splice(t,1)}async waitForLighting(){const t=_i.Current;if(!t){console.error("Missing context");return}const n=await t.rendererData.getSceneLightingData(this.identifier);if(!n||!n.array){console.warn("Missing lighting data for custom shader, getSceneLightingData did not return anything");return}Ec&&console.log(n);const i=n.array,r=n.texture;this.uniforms.unity_SpecCube0={value:r},cF(this.uniforms,i);const o=Math.sqrt(Math.PI*.5);this.uniforms.unity_SpecCube0_HDR={value:new On(o,o,o,o)},Ec&&console.log("Set environment lighting",this.uniforms)}get depthTextureUniform(){if(!!this.uniforms)return this.uniforms._CameraDepthTexture}get opaqueTextureUniform(){if(!!this.uniforms)return this.uniforms._CameraOpaqueTexture}onBeforeRenderScene(){this.opaqueTextureUniform&&_i.Current.setRequireColor(!0),this.depthTextureUniform&&_i.Current.setRequireDepth(!0)}onBeforeRender(t,n,i,r,o,l){r.attributes.tangent||r.computeTangents(),this.onUpdateUniforms(i,o)}onUpdateUniforms(t,n){const i=_i.Current;t&&(Ji.viewProjection&&this.uniforms[this._viewProjectionName]&&(Ji.viewProjection.copy(t.projectionMatrix).multiply(t.matrixWorldInverse),yy(Ji.viewProjection,Ji._viewProjectionValues)),Ji.viewMatrix&&this.uniforms[this._viewMatrixName]&&(Ji.viewMatrix.copy(t.matrixWorldInverse),yy(Ji.viewMatrix,Ji._viewMatrixValues)),this.uniforms[Ji._worldSpaceCameraPosName]&&Ji._worldSpaceCameraPos.setFromMatrixPosition(t.matrixWorld)),this.uniforms._TimeParameters&&(this.uniforms._TimeParameters.value=i.rendererData.timeVec4);const r=i==null?void 0:i.mainLight;if(r){const h=r.getWorldPosition(Ji._mainLightPosition);this.uniforms._MainLightPosition={value:h.normalize()},Ji._mainLightColor.set(r.color.r,r.color.g,r.color.b,0),this.uniforms._MainLightColor={value:Ji._mainLightColor};const u=r.intensity;Ji._lightData.z=u,this.uniforms.unity_LightData={value:Ji._lightData}}if(t&&(Ji.viewProjection&&this.uniforms[this._viewProjectionName]&&(this.uniforms[this._viewProjectionName].value=Ji._viewProjectionValues),Ji.viewMatrix&&this.uniforms[this._viewMatrixName]&&(this.uniforms[this._viewMatrixName].value=Ji._viewMatrixValues),this.uniforms[Ji._worldSpaceCameraPosName]&&(this.uniforms[Ji._worldSpaceCameraPosName]={value:Ji._worldSpaceCameraPos}),i.mainCameraComponent)){if(this.uniforms._ProjectionParams){const h=this.uniforms._ProjectionParams.value;h.x=1,h.y=i.mainCameraComponent.nearClipPlane,h.z=i.mainCameraComponent.farClipPlane,h.w=1/h.z,this.uniforms._ProjectionParams.value=h}if(this.uniforms._ZBufferParams){const h=this.uniforms._ZBufferParams.value,u=i.mainCameraComponent;h.x=1-u.farClipPlane/u.nearClipPlane,h.y=u.farClipPlane/u.nearClipPlane,h.z=h.x/u.farClipPlane,h.w=h.y/u.farClipPlane,this.uniforms._ZBufferParams.value=h}if(this.uniforms._ScreenParams){const h=this.uniforms._ScreenParams.value;h.x=i.domWidth,h.y=i.domHeight,h.z=1+1/h.x,h.w=1+1/h.y,this.uniforms._ScreenParams.value=h}}const o=this.depthTextureUniform;o&&(o.value=i.depthTexture);const l=this.opaqueTextureUniform;if(l&&(l.value=i.opaqueColorTexture),n){const h=this._rendererData;h.updateFrom(n),this.uniforms[this._worldToObjectName].value=h.worldToObject,this.uniforms[this._objToWorldName].value=h.objectToWorld}this.uniformsNeedUpdate=!0}};let To=Ji;E(To,"viewProjection",new xn),E(To,"_viewProjectionValues",[]),E(To,"viewMatrix",new xn),E(To,"_viewMatrixValues",[]),E(To,"_worldSpaceCameraPosName","_WorldSpaceCameraPos"),E(To,"_worldSpaceCameraPos",new q),E(To,"_mainLightColor",new On),E(To,"_mainLightPosition",new q),E(To,"_lightData",new On);class Ute{constructor(e,t){E(this,"parser");E(this,"identifier");this.parser=e,this.identifier=t}get name(){return qd}loadMaterial(e){const t=this.parser.json.materials[e];if(!t)return Ec&&console.log(e,this.parser.json.materials),null;if(!t.extensions||!t.extensions[qd])return Ec&&console.log("material "+e+" does not use NEEDLE_techniques_webgl"),null;const n=t.extensions[qd].technique;if(n<0)return null;const i=this.parser.json.extensions[qd];if(!i)return null;Ec&&console.log(i);const r=i.techniques[n];return r?new Promise(async(o,l)=>{var b,S,R;const h=await Fte(i,r.program),u=h==null?void 0:h.fragmentShader,f=h==null?void 0:h.vertexShader;if(!u||!f)return l();Ec&&console.log("loadMaterial",t,h);const g={},m=r.uniforms;for(const M in m){const I=M;switch(I){case"_TimeParameters":const T=new On;g[I]={value:T};break;case"hlslcc_mtx4x4unity_MatrixV":case"hlslcc_mtx4x4unity_MatrixVP":g[I]={value:[]};break;case"_MainLightPosition":case"_MainLightColor":case"_WorldSpaceCameraPos":g[I]={value:[0,0,0,1]};break;case"unity_OrthoParams":break;case"unity_SpecCube0":g[I]={value:null};break;default:case"_ScreenParams":case"_ZBufferParams":case"_ProjectionParams":g[I]={value:[0,0,0,0]};break;case"_CameraOpaqueTexture":case"_CameraDepthTexture":g[I]={value:null};break}}let A=!1;if(t.extensions&&t.extensions[qd]){const M=t.extensions[qd];if(M.technique===n){Ec&&console.log(t.name,"Material Properties",M);for(const I in M.values){const T=M.values[I];if(typeof T=="string"){if(T.startsWith("/textures/")){const B=T.substring(10),F=Number.parseInt(B);if(F>=0){const D=await this.parser.getDependency("texture",F);D&&(D.encoding=pr,D.needsUpdate=!0),g[I]={value:D};continue}}switch(I){case"alphaMode":T==="BLEND"&&(A=!0);continue}}if(Array.isArray(T)&&T.length===4){g[I]={value:new On(T[0],T[1],T[2],T[3])};continue}g[I]={value:T}}}}const v=new To(this.identifier,{name:(b=t.name)!=null?b:"",uniforms:g,vertexShader:f,fragmentShader:u,lights:!1});switch((S=g._Cull)==null?void 0:S.value){case 0:v.side=er;break;case 1:v.side=Ur;break;case 2:v.side=Oo;break;default:v.side=Oo;break}v.transparent=A,A&&(v.depthWrite=!1),cF(g),v.onUpdateUniforms();for(const M in m){const I=M,T=m[M].type;if(((R=g[I])==null?void 0:R.value)===void 0)switch(T){case lF.SAMPLER_2D:g[I]={value:Bte},console.warn("Missing/unassigned texture, fallback to white: "+I);break;default:console.warn("TODO: EXPECTED UNIFORM / fallback NOT SET: "+I,m[M]);break}}Ec&&console.log(v.uuid,g),o(v)}):null}}const Rb=jt("debugexr");class zte{constructor(e){this.parser=e,this.name="EXT_texture_exr",Rb&&console.log(e)}loadTexture(e){const t=this.name,n=this.parser,r=n.json.textures[e];if(Rb&&console.log("EXT_texture_exr.loadTexture",e,r),!r.extensions||!r.extensions[t])return null;const o=r.extensions[t];let l=new e3(n.options.manager);return Rb&&console.log("EXT_texture_exr.loadTexture",o,l),n.loadTextureImage(e,o.source,l)}}const _B="NEEDLE_gameobject_data";class Gte{constructor(e){E(this,"parser");this.parser=e}get name(){return _B}afterRoot(e){const t=[];for(let n=0;n<this.parser.json.nodes.length;n++){const i=this.parser.json.nodes[n];if(i&&i.extensions){const r=i.extensions[_B];if(r){const o=this.findAndApplyExtensionData(n,r);t.push(o)}}}return Promise.all(t).then(()=>{})}async findAndApplyExtensionData(e,t){const n=await this.parser.getDependency("node",e);n&&this.applyExtensionData(n,t)}applyExtensionData(e,t){e.userData.layer=t.layers,e.userData.tag=t.tag,e.userData.hideFlags=t.hideFlags,e.userData.static=t.static,e.visible=t.activeSelf,e.guid=t.guid}}const yB="NEEDLE_lightmaps",Hte=jt("debuglightmapsextension");var zl=(a=>(a[a.Lightmap=0]="Lightmap",a[a.Skybox=1]="Skybox",a[a.Reflection=2]="Reflection",a))(zl||{});class Vte{constructor(e,t,n){E(this,"parser");E(this,"registry");E(this,"source");this.parser=e,this.registry=t,this.source=n}get name(){return yB}afterRoot(e){const t=this.parser.json.extensions;if(t){const n=t[yB];if(n){const i=n.textures;return i.length?(Hte&&console.log(n),new Promise(async(r,o)=>{const l=[];for(const h of i)if(h.pointer){const u=pS(this.parser,h.pointer).then(f=>{const g=f;g!=null&&g.isTexture&&(this.registry?(h.type!==0&&(g.encoding=Gn),(g.type==Ms||g.type==Os)&&(g.flipY=!0),this.registry.registerTexture(this.source,h.type,g,h.index)):console.log(zl[h.type],h.pointer,g))});l.push(u)}await Promise.all(l),r()})):null}}return null}}class Wte{static fromCubeTexture(e){let t=0;const n=new q,i=new q,r=new _e,o=[0,0,0,0,0,0,0,0,0],l=new rf,h=l.coefficients;for(let f=0;f<6;f++){const g=e.image[f],m=g.width,A=g.height,v=document.createElement("canvas");v.width=m,v.height=A;const w=v.getContext("2d");w.drawImage(g,0,0,m,A);const b=w.getImageData(0,0,m,A),S=b.data,R=b.width,M=2/R;for(let I=0,T=S.length;I<T;I+=4){r.setRGB(S[I]/255,S[I+1]/255,S[I+2]/255),vB(r,e.encoding);const B=I/4,F=-1+(B%R+.5)*M,D=1-(Math.floor(B/R)+.5)*M;switch(f){case 0:n.set(-1,D,-F);break;case 1:n.set(1,D,F);break;case 2:n.set(-F,1,-D);break;case 3:n.set(-F,-1,D);break;case 4:n.set(-F,D,1);break;case 5:n.set(F,D,-1);break}const U=n.lengthSq(),W=4/(Math.sqrt(U)*U);t+=W,i.copy(n).normalize(),rf.getBasisAt(i,o);for(let J=0;J<9;J++)h[J].x+=o[J]*r.r*W,h[J].y+=o[J]*r.g*W,h[J].z+=o[J]*r.b*W}}const u=4*Math.PI/t;for(let f=0;f<9;f++)h[f].x*=u,h[f].y*=u,h[f].z*=u;return new xf(l)}static fromCubeRenderTarget(e,t){let n=0;const i=new q,r=new q,o=new _e,l=[0,0,0,0,0,0,0,0,0],h=new rf,u=h.coefficients;for(let g=0;g<6;g++){const m=t.width,A=new Uint8Array(m*m*4);e.readRenderTargetPixels(t,0,0,m,m,A,g);const v=2/m;for(let w=0,b=A.length;w<b;w+=4){o.setRGB(A[w]/255,A[w+1]/255,A[w+2]/255),vB(o,t.texture.encoding);const S=w/4,R=-1+(S%m+.5)*v,M=1-(Math.floor(S/m)+.5)*v;switch(g){case 0:i.set(1,M,-R);break;case 1:i.set(-1,M,R);break;case 2:i.set(R,1,-M);break;case 3:i.set(R,-1,M);break;case 4:i.set(R,M,1);break;case 5:i.set(-R,M,-1);break}const I=i.lengthSq(),T=4/(Math.sqrt(I)*I);n+=T,r.copy(i).normalize(),rf.getBasisAt(r,l);for(let B=0;B<9;B++)u[B].x+=l[B]*o.r*T,u[B].y+=l[B]*o.g*T,u[B].z+=l[B]*o.b*T}}const f=4*Math.PI/n;for(let g=0;g<9;g++)u[g].x*=f,u[g].y*=f,u[g].z*=f;return new xf(h)}}function vB(a,e){switch(e){case Gn:a.convertSRGBToLinear();break;case pr:break;default:console.warn("WARNING: LightProbeGenerator convertColorToLinear() encountered an unsupported encoding.");break}return a}const qE=jt("debugenvlight");var km=(a=>(a[a.Skybox=0]="Skybox",a[a.Trilight=1]="Trilight",a[a.Flat=3]="Flat",a[a.Custom=4]="Custom",a))(km||{}),XE=(a=>(a[a.Skybox=0]="Skybox",a[a.Custom=1]="Custom",a))(XE||{});class Qte{constructor(e){E(this,"context");E(this,"sceneLightSettings");E(this,"_timevec4",new On);E(this,"_waitPromise");E(this,"_lighting",{});this.context=e,this.context.pre_update_callbacks.push(this.preUpdate.bind(this))}preUpdate(){const e=this.context.time;this._timevec4.x=e.time,this._timevec4.y=Math.sin(e.time),this._timevec4.z=Math.cos(e.time),this._timevec4.w=e.deltaTime}get timeVec4(){return this._timevec4}get environmentIntensity(){return this.sceneLightSettings?this.sceneLightSettings.ambientIntensity:1}registerSceneLightSettings(e){this.sceneLightSettings=e}registerReflection(e,t){const n=new jte(this.context,t,1);this._lighting[e]=n}getReflection(e){return this._lighting[e]}enableReflection(e){var t,n,i;switch(qE&&console.log(this.sceneLightSettings?km[this.sceneLightSettings.ambientMode]:"Unknown ambient mode"),(t=this.sceneLightSettings)==null?void 0:t.ambientMode){case 0:case 4:const r=this.getReflection(e);if(r&&r.Source){const o=this.context.scene,l=r.Source;l.encoding=Gn,l.mapping=ka,o.environment=l;return}break}if(((n=this.sceneLightSettings)==null?void 0:n.environmentReflectionSource)===1)switch((i=this.sceneLightSettings)==null?void 0:i.ambientMode){case 1:if(this.sceneLightSettings.ambientTrilight){const r=this.sceneLightSettings.ambientTrilight,o=Dte(r[0],r[1],r[2],64,64);o.encoding=Gn,o.mapping=ka,this.context.scene.environment=o}else console.error("Missing ambient trilight",this.sceneLightSettings.sourceId);return;case 3:if(this.sceneLightSettings.ambientLight){const r=Lte(this.sceneLightSettings.ambientLight,64);r.encoding=Gn,r.mapping=ka,this.context.scene.environment=r}else console.error("Missing ambientlight",this.sceneLightSettings.sourceId);return;default:return}}disableReflection(){const e=this.context.scene;e.environment=null}async getSceneLightingData(e){return qE&&console.log("GET SCENE LIGHT DATA"),this._waitPromise?this._waitPromise:(this._waitPromise=new Promise((t,n)=>{let i=setInterval(async()=>{var o,l;const r=this.getReflection(e);r&&(clearInterval(i),t(r.getSphericalHarmonicsArray((l=(o=this.sceneLightSettings)==null?void 0:o.ambientIntensity)!=null?l:1)))},10)}),this._waitPromise)}}class jte{constructor(e,t,n=1){E(this,"_context");E(this,"_source");E(this,"_sphericalHarmonics",null);E(this,"_sphericalHarmonicsArray");E(this,"_ambientScale",1);E(this,"_lightProbe");this._context=e,this._source=t,this._ambientScale=n,t.mapping=ka,t.encoding=Gn}get Source(){return this._source}get Array(){return this._sphericalHarmonicsArray}getSphericalHarmonicsArray(e=1){var t;if(((t=this._sphericalHarmonicsArray)==null?void 0:t.length)&&this._source)return{array:this._sphericalHarmonicsArray,texture:this._source,lightProbe:this._lightProbe};try{const n=this._source;let i=null;if(n){qE&&console.log("GENERATING LIGHT PROBE",n);const r=Math.min(n.image.width,512);i=new fC(r).fromEquirectangularTexture(this._context.renderer,n),this._source=i.texture}if(this._sphericalHarmonicsArray=[],i){const r=Wte.fromCubeRenderTarget(this._context.renderer,i);this._lightProbe=r;const o=this._ambientScale*(e*e*Math.PI*.5)-1;this._sphericalHarmonics=r.sh,this._sphericalHarmonicsArray=this._sphericalHarmonics.toArray();const l=e/(Math.PI*.5);for(let h=0;h<this._sphericalHarmonicsArray.length;h++)this._sphericalHarmonicsArray[h]*=l;if(r.sh.scale(o),this._source)return{array:this._sphericalHarmonicsArray,texture:this._source,lightProbe:r}}}catch(n){console.error(n)}return null}}const xB="NEEDLE_lighting_settings",xm=jt("debugenvlight");class qte{constructor(e,t,n){E(this,"parser");E(this,"sourceId");E(this,"context");this.parser=e,this.sourceId=t,this.context=n}get name(){return xB}afterRoot(e){const t=this.parser.json.extensions;if(t){const n=t[xB];if(n){xm&&console.log(n);const i=Te.addNewComponent(e.scene,Xte,!1);i.sourceId=this.sourceId,i.ambientIntensity=n.ambientIntensity,i.ambientLight=new _e().fromArray(n.ambientLight),Array.isArray(n.ambientTrilight)&&(i.ambientTrilight=n.ambientTrilight.map(r=>new _e().fromArray(r))),i.ambientMode=n.ambientMode,i.environmentReflectionSource=n.environmentReflectionSource,this.context&&this.context.rendererData.registerSceneLightSettings(i)}}return null}}class Xte extends Bt{constructor(){super(...arguments);E(this,"ambientMode",km.Skybox);E(this,"ambientLight");E(this,"ambientTrilight");E(this,"ambientIntensity",1);E(this,"environmentReflectionSource",XE.Skybox);E(this,"_hasReflection",!1);E(this,"_ambientLightObj");E(this,"_lightProbeObj")}awake(){if(this.sourceId){const t=this.environmentReflectionSource===XE.Skybox?zl.Skybox:zl.Reflection,n=this.context.lightmaps.tryGet(this.sourceId,t,0);this._hasReflection=n!=null,n&&this.context.rendererData.registerReflection(this.sourceId,n)}xm&&window.addEventListener("keydown",t=>{switch(t.key){case"l":this.enabled=!this.enabled;break}})}onEnable(){var n,i;const t=((n=this.context.mainCameraComponent)==null?void 0:n.sourceId)===this.sourceId;if(xm&&console.log("enable",this.sourceId,t,this,(i=this.context.mainCameraComponent)==null?void 0:i.sourceId),this.ambientMode==km.Flat)this.ambientLight&&(this._ambientLightObj=new zC(this.ambientLight,Math.PI*this.ambientIntensity)),this._ambientLightObj&&this.gameObject.add(this._ambientLightObj),this._lightProbeObj&&this._lightProbeObj.removeFromParent();else if(this.ambientMode===km.Trilight){if(this.ambientTrilight){const r=this.ambientTrilight[0],o=this.ambientTrilight[this.ambientTrilight.length-1],l=new NC(o,r,this.ambientIntensity);this.gameObject.add(l)}}else this._ambientLightObj&&this._ambientLightObj.removeFromParent(),this._lightProbeObj?this.enabled&&this.destroyed&&this._lightProbeObj&&this.scene.add(this._lightProbeObj):this.sourceId&&this.context.rendererData.getSceneLightingData(this.sourceId).then(r=>{xm&&console.log(r),r&&(this._lightProbeObj=r.lightProbe,this.enabled&&!this.destroyed&&this._lightProbeObj&&this.scene.add(this._lightProbeObj))});this.sourceId&&this.context.rendererData.enableReflection(this.sourceId)}onDisable(){xm&&console.log("disable",this.sourceId,this),this._lightProbeObj&&this._lightProbeObj.removeFromParent(),this.sourceId&&this.context.rendererData.disableReflection()}}function hF(a){const e=new hO;return a.register(t=>(e.parser=t,e)),e}class Yte{resolvePath(e){return e.includes("/extensions/builtin_components/")&&(e=e.replace("/extensions/builtin_components/","/userData/components/")),e}}function uF(a,e,t){a.register(i=>new Gte(i)),a.register(i=>new BJ(i)),a.register(i=>new Vte(i,e.lightmaps,t)),a.register(i=>new qte(i,t,e)),a.register(i=>new Ute(i,t)),a.register(i=>new Rm(i,t)),a.register(i=>new pu(i,t,e)),a.register(i=>new zte(i));const n=a.setAnimationPointerResolver;typeof n=="function"&&n.bind(a)(new Yte)}const Jte=jt("printGltf");var dF=(a=>(a[a.BeforeLoad=0]="BeforeLoad",a[a.AfterLoaded=1]="AfterLoaded",a[a.FinishedSetup=10]="FinishedSetup",a))(dF||{});class Eu{constructor(e,t,n,i){E(this,"context");E(this,"loader");E(this,"path");E(this,"gltf");this.context=e,this.path=t,this.loader=n,this.gltf=i}}const Ql={};function Zte(a,e){Ql[a]=Ql[a]||[],Ql[a].push(e)}function Kte(a,e){if(Ql[a]){const t=Ql[a].indexOf(e);t>=0&&Ql[a].splice(t,1)}}function mf(a,e){if(Ql[a])for(const t of Ql[a])t(e)}async function fF(a,e,t,n,i){Jte&&console.log(t),await a.assets.registerGltf(t),await aF(a,e,t,n,i)}function zv(a,e,t,n){typeof t!="string"&&console.warn("Parse gltf binary without path, this might lead to errors in resolving extensions. Please provide the source path of the gltf/glb file",t,typeof t);const i=new Df;uF(i,a,t);const o=hF(i);return new Promise((l,h)=>{try{Xy(i,a),mf(0,new Eu(a,t,i)),i.parse(e,t,async u=>{mf(1,new Eu(a,t,i,u)),await fF(a,t,u,n,o),mf(10,new Eu(a,t,i,u)),l(u)},u=>{console.error("failed loading "+t,u),l(void 0)})}catch(u){console.error(u),h(u)}})}function iA(a,e,t,n=!1,i){const r=new Df;uF(r,a,e);const l=hF(r);return new Promise((h,u)=>{try{Xy(r,a),mf(0,new Eu(a,e,r)),r.load(e,async f=>{mf(1,new Eu(a,e,r,f)),await fF(a,e,f,t,l),mf(10,new Eu(a,e,r,f)),h(f)},f=>{i==null||i.call(r,f)},f=>{console.error("failed loading "+e,f),h(void 0)})}catch(f){console.error(f),u(f)}})}function $te(a,e,t,n=!1){e&&e.animations&&e.animations.length>0&&t.push(()=>{pF(e,n)})}function pF(a,e=!1){var n;if(!a||!a.animations||!a.scene||!e&&!Te.getComponentInChildren(a.scene,Hl))return;for(let i=0;i<a.animations.length;i++){const r=a.animations[i];if(!(!r.tracks||r.tracks.length<=0))for(const o in r.tracks){const l=r.tracks[o],h=(n=l.__objectName)!=null?n:l.name.substring(0,l.name.indexOf(".")),u=a.scene.getObjectByName(h);if(!u)continue;let f=t(u);if(!f)if(e)f=Te.addNewComponent(a.scene,Hl);else{console.warn("Failed finding animator for",l.name,h);continue}const g=f.animations=f.animations||[];r.name_animator=f.name,g.indexOf(r)<0&&g.push(r)}}function t(i){var o;if(!i)return;const r=(o=i.userData)==null?void 0:o.components;if(r&&r.length>0)for(let l=0;l<r.length;l++){const h=r[l];if(h instanceof rh||h instanceof Hl)return i}return t(i.parent)}}function mF(a,e,t=!0){if(e.userData&&e.userData.name===a)return e;if(e.children&&e.children.length>0)for(let n=0;n<e.children.length;n++){const i=e.children[n],r=mF(a,i,t);if(r)return r}}function ene(a,e,t=!0){return wf(a,e,t)}function tne(a,e=null){const t=e!=null?e:_i.Current.scripts;for(const n in t){const i=t[n];if(i&&i.guid===a)return i}return null}const nne=Object.freeze(Object.defineProperty({__proto__:null,GltfLoadEventType:dF,GltfLoadEvent:Eu,addGltfLoadEventListener:Zte,removeGltfLoadEventListener:Kte,parseSync:zv,loadSync:iA,findAnimationsLate:$te,findAnimations:pF,tryFindObjectByName:mF,tryFindObject:ene,tryFindScript:tne},Symbol.toStringTag,{value:"Module"}));function EM(a,e,t){var r;let n=Te.getComponentInChildren(a,Pc);if(n||(n=Te.addNewComponent(a,Pc,!1),n.guid=e.generateUUID()),n&&!Te.getComponent(n.gameObject,$l)){const o=Te.addNewComponent(n.gameObject,$l,!1);o.guid=e.generateUUID()}if(n&&!Te.getComponentInParent(n.gameObject,hg)){const o=Te.addNewComponent(n.gameObject,hg,!1);o.guid=e.generateUUID()}if(t&&((r=t.animations)==null?void 0:r.length)>0){const o=t.animations[0],l=Te.addNewComponent(a,Hl,!1);l.animations=[o]}let i=!1;a.traverse(o=>{!o||o.isSkinnedMesh===!0&&(i||console.log("Disabling frustum culling for skinned meshes",t),i=!0,o.frustumCulled=!1)})}class ine{constructor(e,t,n,i,r,o,l,h){E(this,"guid");E(this,"file_name");E(this,"file_hash");E(this,"file_size");E(this,"position");E(this,"seed");E(this,"sender");E(this,"serverUrl");E(this,"parentGuid");E(this,"boundsSize");this.seed=t,this.guid=n,this.file_name=i,this.file_hash=r,this.file_size=o,this.position=l,this.sender=e,this.serverUrl=h}}async function sne(a,e,t){const n=a.name;return n.endsWith(".gltf")||n.endsWith(".glb")?new Promise((i,r)=>{const o=new FileReader;o.readAsDataURL(a),o.onloadend=async l=>{const h=o.result,u=tS(),f=new la(u),g=await iA(e,h,f,!0);if(g&&g.scene){const m=g.scene;if(!m.guid){const A=new la(u);m.guid=A.generateUUID()}t&&ane(e.connection,a,u,m,t),EM(m,f,g),i(g)}}}):(console.warn("Unsupported file type: "+n),console.log(a),null)}async function rne(a,e){return new Promise(async(t,n)=>{const i=tS(),r=new la(i),o=await iA(e,a.toString(),r,!0);if(o&&o.scene){const l=o.scene;EM(l,r,o),t(o)}else console.warn("Unsupported file type: "+a.toString())})}function one(a){a.connection.beginListen("file-spawned",async e=>{if(e.sender!==a.connection.connectionId){console.log("received file event",e),cne(e,a);let t=null;try{t=await JD(e.file_name,e.file_hash,e.file_size,e.serverUrl)}finally{lne(e)}if(t){const n=new la(e.seed),i=await zv(a,t,null,n);if(i&&i.scene){const r=i.scene;if(EM(r,n,i),e.parentGuid){const o=Te.findByGuid(e.parentGuid,a.scene);"add"in o&&o.add(r)}r.parent||a.scene.add(r),e.position!==null&&r.position.copy(e.position)}}else console.error("download didnt return file")}})}async function ane(a,e,t,n,i){var l;if(!a.connectionId){console.error("Can not upload file - no connection id");return}if(!n.guid){console.error("Can not upload file - no guid",n,n.guid);return}const r=await tZ(e,i);if(!r)return;if(!r.filename){console.error("Can not send upload event - no filename",e.name);return}if(!r.hash){console.error("Can not send upload event - no hash",e.name);return}const o=new ine(a.connectionId,t,n.guid,r.filename,r.hash,e.size,n.position,(l=r.url)!=null?l:i);n.parent&&(o.parentGuid=n.parent.guid),a.send("file-spawned",o)}const YE={};function cne(a,e){const t=new Ui,n=new _t(t,new Hi({color:65280})),i=new QC(n,5592405);if(YE[a.guid]=i,e.scene.add(i),a.parentGuid){const r=Te.findByGuid(a.parentGuid,e.scene);r&&r.add(i)}a.position&&i.position.copy(a.position)}function lne(a,e){const t=a.guid,n=YE[t];n&&(delete YE[t],n.removeFromParent())}jt("debugassets");class hne{constructor(){E(this,"texturesLoader",new Pg);E(this,"textures",{});E(this,"texturesLoading",{});E(this,"_materials",new Map);E(this,"_meshes",new Map);E(this,"_textures",new Map);window.addEventListener("unhandledrejection",e=>{var n;if(e.defaultPrevented)return;const t=(n=e==null?void 0:e.reason)==null?void 0:n.path;if(t){const i=t[0];i&&i.tagName==="IMG"&&(console.warn(`Could not load image:
`+i.src),e.preventDefault())}})}async loadTexture(e){if(this.textures[e])return this.textures[e];if(this.texturesLoading[e])return await this.texturesLoading[e];const t=this.texturesLoader.loadAsync(e);this.texturesLoading[e]=t;const n=await t;return delete this.texturesLoading[e],this.textures[e]=n,n}getTexture(e){return this._textures.get(e)||null}findTexture(e){for(const t of this._textures.values())if(t.name===e)return t;return null}findMesh(e){for(const t of this._meshes.values())if(t.name===e)return t;return null}findMaterial(e){for(const t of this._materials.values())if(t.name===e)return t;return null}async registerGltf(e){}registerAsset(e){}}var Nm=function(){var a=0,e=document.createElement("div");e.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",e.addEventListener("click",function(f){f.preventDefault(),n(++a%e.children.length)},!1);function t(f){return e.appendChild(f.dom),f}function n(f){for(var g=0;g<e.children.length;g++)e.children[g].style.display=g===f?"block":"none";a=f}var i=(performance||Date).now(),r=i,o=0,l=t(new Nm.Panel("FPS","#0ff","#002")),h=t(new Nm.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var u=t(new Nm.Panel("MB","#f08","#201"));return n(0),{REVISION:16,dom:e,addPanel:t,showPanel:n,begin:function(){i=(performance||Date).now()},end:function(){o++;var f=(performance||Date).now();if(h.update(f-i,200),f>=r+1e3&&(l.update(o*1e3/(f-r),100),r=f,o=0,u)){var g=performance.memory;u.update(g.usedJSHeapSize/1048576,g.jsHeapSizeLimit/1048576)}return f},update:function(){i=this.end()},domElement:e,setMode:n}};Nm.Panel=function(a,e,t){var n=1/0,i=0,r=Math.round,o=r(window.devicePixelRatio||1),l=80*o,h=48*o,u=3*o,f=2*o,g=3*o,m=15*o,A=74*o,v=30*o,w=document.createElement("canvas");w.width=l,w.height=h,w.style.cssText="width:80px;height:48px";var b=w.getContext("2d");return b.font="bold "+9*o+"px Helvetica,Arial,sans-serif",b.textBaseline="top",b.fillStyle=t,b.fillRect(0,0,l,h),b.fillStyle=e,b.fillText(a,u,f),b.fillRect(g,m,A,v),b.fillStyle=t,b.globalAlpha=.9,b.fillRect(g,m,A,v),{dom:w,update:function(S,R){n=Math.min(n,S),i=Math.max(i,S),b.fillStyle=t,b.globalAlpha=1,b.fillRect(0,0,l,m),b.fillStyle=e,b.fillText(r(S)+" "+a+" ("+r(n)+"-"+r(i)+")",u,f),b.drawImage(w,g+o,m,A-o,v,g,m,A-o,v),b.fillRect(g+A-o,m,o,v),b.fillStyle=t,b.globalAlpha=.9,b.fillRect(g+A-o,m,o,r((1-S/R)*v))}}};const wB=!!jt("debuglightmaps");class une{constructor(e){E(this,"_context");E(this,"_lightmaps",new Map);this._context=e}registerTexture(e,t,n,i){var l;wB&&console.log("Registering lightmap",e,zl[t],n),this._lightmaps.has(e)||this._lightmaps.set(e,new Map);const r=this._lightmaps.get(e),o=(l=r==null?void 0:r.get(t))!=null?l:[];o.length<i&&(o.length=i+1),o[i]=n,r==null||r.set(t,o)}tryGetLightmap(e,t=0){return this.tryGet(e,zl.Lightmap,t)}tryGetSkybox(e){return this.tryGet(e,zl.Skybox,0)}tryGetReflection(e){return this.tryGet(e,zl.Reflection,0)}tryGet(e,t,n){var r,o;if(!e)return wB&&console.warn("Missing source id"),null;const i=(o=(r=this._lightmaps.get(e))==null?void 0:r.get(t))!=null?o:null;return!(i!=null&&i.length)||i.length<=n?null:i[n]}}qn.lights_fragment_maps=qn.lights_fragment_maps.replace("vec4 lightMapTexel = texture2D( lightMap, vUv2 );",`

    vec2 lUv = vUv2.xy * lightmapScaleOffset.xy + vec2(lightmapScaleOffset.z, (1. - (lightmapScaleOffset.y + lightmapScaleOffset.w)));
    vec4 lightMapTexel = texture2D( lightMap, lUv);
    // The range of RGBM lightmaps goes from 0 to 34.49 (5^2.2) in linear space, and from 0 to 5 in gamma space.
    lightMapTexel.rgb *= lightMapTexel.a * 8.; // no idea where that "8" comes from... heuristically derived
    lightMapTexel.a = 1.;
    lightMapTexel = conv_sRGBToLinear(lightMapTexel);
    `);qn.lightmap_pars_fragment=`
    #ifdef USE_LIGHTMAP
        uniform sampler2D lightMap;
        uniform float lightMapIntensity;
        uniform vec4 lightmapScaleOffset;
        
        // took from threejs 05fc79cd52b79e8c3e8dec1e7dca72c5c39983a4
        vec4 conv_sRGBToLinear( in vec4 value ) {
            return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
        }
    #endif
    `;qn.lights_fragment_begin=qn.lights_fragment_begin.replace("irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );",`
#if defined(USE_LIGHTMAP)
irradiance += 0.;
#else
irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
#endif`);Gt.lightmap.lightmapScaleOffset={value:new On(1,1,0,0)};const dne=jt("debugSetup"),fne=jt("stats"),z_={};class pne{constructor(e){E(this,"name");E(this,"alias");E(this,"domElement");E(this,"renderer");this.domElement=e!=null?e:document.body}}var No=(a=>(a[a.EarlyUpdate=0]="EarlyUpdate",a[a.Update=1]="Update",a[a.LateUpdate=2]="LateUpdate",a[a.OnBeforeRender=3]="OnBeforeRender",a[a.OnAfterRender=4]="OnAfterRender",a[a.PhysicsStep=10]="PhysicsStep",a))(No||{});const no=class{constructor(e){E(this,"name");E(this,"alias");E(this,"isManagedExternally",!1);E(this,"domElement");E(this,"_resolutionScaleFactor",1);E(this,"scene");E(this,"renderer");E(this,"composer",null);E(this,"scripts",[]);E(this,"scripts_earlyUpdate",[]);E(this,"scripts_update",[]);E(this,"scripts_lateUpdate",[]);E(this,"scripts_onBeforeRender",[]);E(this,"scripts_onAfterRender",[]);E(this,"scripts_WithCorroutines",[]);E(this,"coroutines",{});E(this,"mainCameraComponent");E(this,"post_setup_callbacks",[]);E(this,"pre_update_callbacks",[]);E(this,"pre_render_callbacks",[]);E(this,"post_render_callbacks",[]);E(this,"new_scripts",[]);E(this,"new_script_start",[]);E(this,"new_scripts_pre_setup_callbacks",[]);E(this,"new_scripts_post_setup_callbacks",[]);E(this,"application");E(this,"time");E(this,"input");E(this,"physics");E(this,"connection");E(this,"assets");E(this,"mainLight",null);E(this,"rendererData");E(this,"addressables");E(this,"lightmaps");E(this,"_sizeChanged",!1);E(this,"_isCreated",!1);E(this,"_stats",fne?Nm():null);E(this,"_cameraStack",[]);E(this,"_onBeforeRenderListeners",{});E(this,"_requireDepthTexture",!1);E(this,"_requireColorTexture",!1);E(this,"_renderTarget");E(this,"_isRendering",!1);if(this.name=(e==null?void 0:e.name)||"",this.alias=e==null?void 0:e.alias,this.domElement=(e==null?void 0:e.domElement)||document.body,e!=null&&e.renderer)this.renderer=e.renderer,this.isManagedExternally=!0;else{const n=jt("postfx");this.renderer=new Ag({antialias:!0}),this.renderer.toneMappingExposure=1,this.renderer.toneMapping=ca,this.renderer.setClearColor(new _e("lightgrey"),0),this.renderer.antialias=!0,this.renderer.alpha=!1,this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=ZE,this.renderer.setSize(this.domWidth,this.domHeight),this.renderer.outputEncoding=Gn,this.renderer.physicallyCorrectLights=!0,this.composer=n?new CJ(this.renderer):null}this.scene=new vu,this.application=new JJ(this),this.time=new K7,this.input=new c9(this),this.physics=new Z7(this),this.connection=new uJ(this),this.assets=new hne,this.rendererData=new Qte(this),this.addressables=new XZ(this),this.lightmaps=new une(this),window.addEventListener("resize",this.updateSize.bind(this)),new ResizeObserver(n=>this._sizeChanged=!0).observe(this.domElement)}static get Current(){return this._current}static set Current(e){this._current=e}get resolutionScaleFactor(){return this._resolutionScaleFactor}set resolutionScaleFactor(e){if(e!==this._resolutionScaleFactor&&typeof e=="number"){if(e<=0){console.error("Invalid resolution scale factor",e);return}this._resolutionScaleFactor=e,this.updateSize()}}get domWidth(){return this.domElement.clientWidth}get domHeight(){return this.domElement.clientHeight}get domX(){return this.domElement.offsetLeft}get domY(){return this.domElement.offsetTop}get isInXR(){var e;return((e=this.renderer.xr)==null?void 0:e.isPresenting)||!1}get xrSession(){var e;return(e=this.renderer.xr)==null?void 0:e.getSession()}get arOverlayElement(){const e=this.domElement;return typeof e.getAROverlayContainer=="function"?e.getAROverlayContainer():this.domElement}get mainCamera(){if(this.mainCameraComponent){const e=this.mainCameraComponent;return e.cam||e.buildCamera(),e.cam}return null}updateSize(){if(!this.isManagedExternally&&!this.renderer.xr.isPresenting){this._sizeChanged=!1;const e=this.resolutionScaleFactor,t=this.domWidth*e,n=this.domHeight*e,i=this.mainCamera;this.updateAspect(i),this.renderer.setSize(t,n),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.domElement.style.width=this.domWidth+"px",this.renderer.domElement.style.height=this.domHeight+"px",this.composer&&(this.composer.setSize(t,n),this.composer.setPixelRatio(window.devicePixelRatio))}}updateAspect(e){if(!e)return;const t=this.domWidth,n=this.domHeight,i=e.aspect;e.aspect=t/n,i!==e.aspect&&e.updateProjectionMatrix()}onCreate(e,t){return this._isCreated?(console.warn("Context already created"),null):(this._isCreated=!0,this.internalOnCreate(e,t))}onDestroy(){var e,t;!this._isCreated||(this._isCreated=!1,Te.destroy(this.scene,!0),(e=this.renderer)==null||e.setAnimationLoop(null),this.isManagedExternally||(t=this.renderer)==null||t.dispose())}registerCoroutineUpdate(e,t,n){return this.coroutines[n]||(this.coroutines[n]=[]),this.coroutines[n].push({comp:e,main:t}),t}unregisterCoroutineUpdate(e,t){if(!this.coroutines[t])return;const n=this.coroutines[t].findIndex(i=>i.main===e);n>=0&&this.coroutines[t].splice(n,1)}stopAllCoroutinesFrom(e){for(const t in this.coroutines){const n=this.coroutines[t];for(let i=n.length-1;i>=0;i--)n[i].comp===e&&n.splice(i,1)}}setCurrentCamera(e){var i;if(!e)return;if(e.cam||e.buildCamera(),!e.cam){console.warn("Camera component is missing camera",e);return}const t=this._cameraStack.indexOf(e);t>=0&&this._cameraStack.splice(t,1),this._cameraStack.push(e),this.mainCameraComponent=e;const n=e.cam;n.isPerspectiveCamera&&this.updateAspect(n),(i=this.mainCameraComponent)==null||i.applyClearFlagsIfIsActiveCamera()}addBeforeRenderListener(e,t){if(!this._onBeforeRenderListeners[e.uuid]){this._onBeforeRenderListeners[e.uuid]=[];const n=(i,r,o,l,h,u)=>{const f=this._onBeforeRenderListeners[e.uuid];if(!!f)for(let g=0;g<f.length;g++){const m=f[g];m(i,r,o,l,h,u)}};e.onBeforeRender=n}this._onBeforeRenderListeners[e.uuid].push(t)}removeBeforeRenderListener(e,t){if(this._onBeforeRenderListeners[e.uuid]){const n=this._onBeforeRenderListeners[e.uuid],i=n.indexOf(t);i>=0&&n.splice(i,1)}}get isRendering(){return this._isRendering}setRequireDepth(e){this._requireDepthTexture=e}setRequireColor(e){this._requireColorTexture=e}get depthTexture(){var e;return((e=this._renderTarget)==null?void 0:e.depthTexture)||null}get opaqueColorTexture(){var e;return((e=this._renderTarget)==null?void 0:e.texture)||null}async internalOnCreate(e,t){var r;let n=!0;try{no.Current=this,e&&await e(this,t)}catch(o){console.error(o),n=!1}if(!n)return;this.isManagedExternally||this.domElement.prepend(this.renderer.domElement),i9(this),t9(this),one(this),no._current=this;for(let o=0;o<this.new_scripts.length;o++){const l=this.new_scripts[o];if(l.gameObject!==void 0&&l.gameObject!==null){l.gameObject.userData===void 0&&(l.gameObject.userData={}),l.gameObject.userData.components===void 0&&(l.gameObject.userData.components=[]);const h=l.gameObject.userData.components;h.includes(l)||h.push(l)}}if(this.post_setup_callbacks)for(let o=0;o<this.post_setup_callbacks.length;o++)no._current=this,await this.post_setup_callbacks[o](this);if(!this.mainCamera){no._current=this;const o=Te.findObjectsOfType(Us,this),l=(r=o.find(h=>h.tag=="MainCamera"))!=null?r:o.find(h=>!0);if(l)l.tag!=="MainCamera"&&console.warn('No mainCamera configured. Some components rely on a mainCamera object being present. When exporting your scene, make sure to set the mainCamera tag on your camera. Using "'+l.name+'" as mainCamera now.'),this.setCurrentCamera(l);else{console.error("No camera found");const h=xJ(this.scene);this.setCurrentCamera(h)}}no._current=this,Km(this);const i=this.mainCameraComponent;if(i&&i.applyClearFlagsIfIsActiveCamera(),!this.isManagedExternally&&this.composer&&this.mainCamera){const o=new SJ(this.scene,this.mainCamera);this.renderer.setSize(this.domWidth,this.domHeight),this.composer.addPass(o),this.composer.setSize(this.domWidth,this.domHeight)}this._sizeChanged=!0,this._stats&&(this._stats.showPanel(1),this.domElement.appendChild(this._stats.dom)),this.renderer.setAnimationLoop(this.render.bind(this)),dne&&dE(this.scene,!0)}render(e,t){var n,i;for((n=this._stats)==null||n.begin(),no._current=this,this.time.update(),Km(this),Mq(),Cq(this);this._cameraStack.length>0&&(!this.mainCameraComponent||this.mainCameraComponent.destroyed);){this._cameraStack.splice(this._cameraStack.length-1,1);const r=this._cameraStack[this._cameraStack.length-1];this.setCurrentCamera(r)}if(this.pre_update_callbacks)for(const r in this.pre_update_callbacks)this.pre_update_callbacks[r]();for(let r=0;r<this.scripts_earlyUpdate.length;r++){const o=this.scripts_earlyUpdate[r];!o.activeAndEnabled||o.earlyUpdate!==void 0&&(no._current=this,o.earlyUpdate())}this.executeCoroutines(0);for(let r=0;r<this.scripts_update.length;r++){const o=this.scripts_update[r];!o.activeAndEnabled||o.update!==void 0&&(no._current=this,o.update())}this.executeCoroutines(1);for(let r=0;r<this.scripts_lateUpdate.length;r++){const o=this.scripts_lateUpdate[r];!o.activeAndEnabled||o.lateUpdate!==void 0&&(no._current=this,o.lateUpdate())}this.mainLight=null,this.executeCoroutines(2);try{const o=this.time.deltaTime/2;for(let l=0;l<2;l++)this.physics.step(o),this.executeCoroutines(10)}catch(r){console.error(r)}this.physics.postStep();for(let r=0;r<this.scripts_onBeforeRender.length;r++){const o=this.scripts_onBeforeRender[r];!o.activeAndEnabled||o.onBeforeRender!==void 0&&(no._current=this,o.onBeforeRender(t))}if(this.executeCoroutines(3),this._sizeChanged&&this.updateSize(),this.pre_render_callbacks)for(const r in this.pre_render_callbacks)this.pre_render_callbacks[r]();this._isRendering=!0,this.renderRequiredTextures(),this.isManagedExternally||(this.composer?this.composer.render():this.mainCamera&&this.renderer.render(this.scene,this.mainCamera)),this._isRendering=!1;for(let r=0;r<this.scripts_onAfterRender.length;r++){const o=this.scripts_onAfterRender[r];!o.activeAndEnabled||o.onAfterRender!==void 0&&(no._current=this,o.onAfterRender())}if(this.executeCoroutines(4),this.post_render_callbacks)for(const r in this.post_render_callbacks)this.post_render_callbacks[r]();this.connection.sendBufferedMessagesNow(),(i=this._stats)==null||i.end()}renderRequiredTextures(){if(!this.mainCamera||!this._requireDepthTexture&&!this._requireColorTexture)return;if(!this._renderTarget){if(this._renderTarget=new Hr(this.domWidth,this.domHeight),this._requireDepthTexture){const n=new AC(this.domWidth,this.domHeight);this._renderTarget.depthTexture=n}this._requireColorTexture&&(this._renderTarget.texture=new Vi,this._renderTarget.texture.generateMipmaps=!1,this._renderTarget.texture.minFilter=Ki,this._renderTarget.texture.magFilter=Ki,this._renderTarget.texture.format=us)}const e=this._renderTarget;e.texture&&(e.texture.encoding=this.renderer.outputEncoding);const t=this.renderer.getRenderTarget();this.renderer.setRenderTarget(e),this.renderer.render(this.scene,this.mainCamera),this.renderer.setRenderTarget(t)}executeCoroutines(e){if(this.coroutines[e]){const n=this.coroutines[e];for(let i=0;i<n.length;i++){const r=n[i];if(!r.comp||r.comp.destroyed||!r.main||r.comp.enabled===!1){n.splice(i,1),--i;continue}const l=r.chained;if(l&&l.length>0){const g=l[l.length-1].next();if(g.done&&l.pop(),t(g)&&(r.chained||(r.chained=[]),r.chained.push(g.value)),!g.done)continue}const h=r.main.next();if(h.done===!0){n.splice(i,1),--i;continue}const u=h.value;if(t(u)){if(u.next().done)continue;r.chained||(r.chained=[]),r.chained.push(u)}}}function t(n){return!!(n&&n.next&&n.return)}}};let _i=no;E(_i,"_current");const mne=Object.freeze(Object.defineProperty({__proto__:null,build_scene_functions:z_,ContextArgs:pne,FrameEvent:No,Context:_i},Symbol.toStringTag,{value:"Module"})),mu="ar",gne="quit-ar";class Ane{constructor(){E(this,"arContainer",null);E(this,"closeARCallback");E(this,"currentSession",null);E(this,"registeredCloseEventElements",[]);E(this,"_createdAROnlyElements",[]);E(this,"_reparentedObjects",[]);this.closeARCallback=this.onRequestedEndAR.bind(this)}get ARContainer(){return this.arContainer}requestEndAR(){this.onRequestedEndAR()}onBegin(e,t,n){this.currentSession=n,this.arContainer=t,e.domElement.querySelectorAll(`.${mu}`).forEach(o=>{var l;!o||o!==this.arContainer&&(this._reparentedObjects.push({el:o,previousParent:o.parentElement}),(l=this.arContainer)==null||l.appendChild(o))});const r=t.getElementsByClassName(gne);if(!r||r.length<=0)console.warn("Missing quit AR elements"),this.createFallbackCloseARButton(this.arContainer);else for(let o=0;o<r.length;o++){const l=r[o];!l||(l.addEventListener("click",this.closeARCallback),this.registeredCloseEventElements.push(l))}}onEnd(e){var t;for(const n of this._createdAROnlyElements)n.remove&&n.remove();for(const n of this._reparentedObjects){const i=n.el;(t=n.previousParent)==null||t.appendChild(i)}this._reparentedObjects.length=0}findOrCreateARContainer(e){if(e.classList.contains(mu))return e;if(e.children){for(const n of e.children)if(!(!n||!n.classList)&&n.classList.contains(mu))return n}const t=document.createElement("div");return t.classList.add(mu),e.appendChild(t)}onRequestedEndAR(){if(!!this.currentSession){this.currentSession.end(),this.currentSession=null;for(const e of this.registeredCloseEventElements)e.removeEventListener("click",this.closeARCallback);this.registeredCloseEventElements.length=0}}createFallbackCloseARButton(e){var t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("width","38px"),t.setAttribute("height","38px"),t.style.position="absolute",t.style.right="20px",t.style.top="40px",t.style.zIndex="9999",t.style.pointerEvents="auto",t.addEventListener("click",this.closeARCallback),e.appendChild(t),this._createdAROnlyElements.push(t);var n=document.createElementNS("http://www.w3.org/2000/svg","path");n.setAttribute("d","M 12,12 L 28,28 M 28,12 12,28"),n.setAttribute("stroke","#eee"),n.setAttribute("stroke-width","2px"),t.appendChild(n),this._createdAROnlyElements.push(n)}}const _ne=jt("debugdebug"),yne=jt("noerrors"),Pb=new Map;function vne(){if(!yne&&OD()){_ne&&console.log(window.location.hostname);const a=console.error;console.error=(...e)=>{a.apply(console,e),bB(2,e)},window.addEventListener("error",e=>{!e||bB(2,e.error,e.filename,e.lineno)})}}function bB(a,e,t,n){const i=_i.Current;if(!!i&&a===2){Array.isArray(e)&&(e=e.join(" "));const r=i.domElement;wne(r,e)}}function xne(a){if(Pb.has(a))return Pb.get(a);{const e=document.createElement("div");return e.classList.add(mu),e.classList.add("desktop"),e.style.position="absolute",e.style.top="0",e.style.left="0",e.style.margin="5px",e.style.width="calc(100% - 10px)",e.style.zIndex="1000",e.style.pointerEvents="none",e.style.display="flex",e.style.alignItems="end",e.style.flexDirection="column",e.style.color="white",e.style.overflow="auto",a.appendChild(e),Pb.set(a,e),e}}function wne(a,e,t){const n=xne(a);if(n.childElementCount>=5)return;const i=document.createElement("div");n.appendChild(i),i.style.display="flex",i.style.alignItems="start",i.style.flexDirection="row",i.style.padding=".2em",i.style.backgroundColor="rgba(0,0,0,1)",i.style.marginBottom="2px",i.style.borderRadius="8px",i.style.color="#ff5555",i.style.fontWeight="bold",i.title="Open developer console to debug",i.style.pointerEvents="all",i.style.userSelect="text";const r=document.createElement("div"),o=document.createElement("div");i.appendChild(r),i.appendChild(o),e.length>200&&(e=e.substring(0,200)+"..."),r.innerText=e,o.innerText=t||"",setTimeout(()=>{n.removeChild(i)},1e4)}vne();const gF={...mne,...nne,RGBAColor:oo},bne=async function(a,e){const t=a.scene;a.new_scripts;const n=await gF.loadSync(a,"assets/scene.glb",null,!1,i=>{var r;return(r=e==null?void 0:e.progress)==null?void 0:r.call(e,{name:"scene.glb",progress:i,index:0,count:1})});n&&t.add(n.scene),a.scripts};gF.build_scene_functions.loadScene=bne;console.log("Made with \u2665 by \u{1F335} needle - https://needle.tools \u2014 Version 2.32.0-pre");const Ene=jt("debugloadingbar");function AF(a){return a.index/a.count+a.progress.loaded/a.progress.total/a.count}class Cne{constructor(e,t){E(this,"loadingProgress",0);E(this,"container");E(this,"_progress",0);E(this,"_allowCustomLoadingElement",!1);E(this,"_loadingElement");E(this,"_loadingTextContainer",null);E(this,"_loadingBar",null);E(this,"_messageContainer",null);E(this,"_loadingElementOptions");E(this,"_progressLoop");this.container=e,this._loadingElementOptions=t}onLoadingBegin(e){if(!this._loadingElement){for(let t=0;t<this.container.children.length;t++){const n=this.container.children[t];if(n.classList.contains("loading")){if(!this._allowCustomLoadingElement){this.container.removeChild(n);continue}this._loadingElement=this.createLoadingElement();return}}this._loadingElement=this.createLoadingElement()}this._progress=0,this.loadingProgress=0,this._loadingElement.style.display="",this.container.appendChild(this._loadingElement),this.smoothProgressLoop(),this.setMessage(e!=null?e:"")}onLoadingUpdate(e,t){var i;(i=this._loadingElement)!=null&&i.parentElement||this.onLoadingBegin(t);let n=0;typeof e=="number"?n=e:("index"in e&&(n=AF(e)),!t&&"name"in e&&this.setMessage(e.name)),this.loadingProgress=n,t&&this.setMessage(t),this.updateDisplay()}onLoadingFinished(e){this.loadingProgress=1,this.setMessage(e!=null?e:"")}setMessage(e){this._messageContainer&&(this._messageContainer.innerText=e)}smoothProgressLoop(){if(this._progressLoop)return;let e=1/12;Ene&&(e=.001);const t=1-.05;this._progressLoop=setInterval(()=>{if(this.loadingProgress>=1&&this._progress>=t){this._loadingElement&&(this._loadingElement.style.display="none",this._loadingElement.remove()),clearInterval(this._progressLoop),this._progressLoop=null;return}this._progress=Ei.lerp(this._progress,this.loadingProgress,e*this.loadingProgress),this.updateDisplay()},e)}updateDisplay(){const e=this._progress,t=(e*100).toFixed(0)+"%";this._loadingBar&&(this._loadingBar.style.width=e*100+"%"),this._loadingTextContainer&&(this._loadingTextContainer.textContent=t)}createLoadingElement(e){var l,h,u;this._loadingElement=e||document.createElement("div");const t=(h=(l=this._loadingElementOptions)==null?void 0:l.className)!=null?h:"loading";if(this._loadingElement.classList.add(t),(u=this._loadingElementOptions)!=null&&u.additionalClasses)for(const f of this._loadingElementOptions.additionalClasses)this._loadingElement.classList.add(f);e||(this._loadingElement.style.color="white",this._loadingElement.style.display="flex");const n=document.createElement("div"),i=20;n.style.display="flex",n.style.width=i+"%",n.style.height="2px",n.style.background="rgba(255,255,255,.1)",this._loadingElement.appendChild(n),this._loadingBar=document.createElement("div"),n.appendChild(this._loadingBar);const r=function(f){return Ei.lerp(i*.5,100-i*.5,f)+"%"};this._loadingBar.style.background=`linear-gradient(90deg, #02022B ${r(0)}, #0BA398 ${r(.4)}, #99CC33 ${r(.5)}, #D7DB0A ${r(1)})`,this._loadingBar.style.backgroundAttachment="fixed",this._loadingBar.style.width="0%",this._loadingBar.style.height="100%",this._loadingTextContainer=document.createElement("div"),this._loadingTextContainer.style.display="flex",this._loadingTextContainer.style.justifyContent="center",this._loadingTextContainer.style.marginTop=".9em",this._loadingElement.appendChild(this._loadingTextContainer);const o=document.createElement("div");return this._messageContainer=o,o.style.display="flex",o.style.fontSize=".8em",o.style.paddingTop=".5em",o.style.color="rgba(255,255,255,.5)",this._loadingElement.appendChild(o),this._loadingElement}}const Zh=jt("debugwebcomponent");class Sne{constructor(e,t){E(this,"id");E(this,"context");E(this,"previouslyAdded");E(this,"previousSource");E(this,"networkEvent");this.id=e,this.context=t,this.networkEvent="needle-engine-source-changed",this.id&&(this.networkEvent+="-"+this.id),this.context.connection.beginListen(this.networkEvent,n=>{this.onSourceChanged(n,!0)})}async onSourceChanged(e,t=!1,n=!1){this.previouslyAdded&&(t&&e===this.previousSource||Te.destroySynced(this.previouslyAdded)),this.previouslyAdded=null,t||this.context.connection.send(this.networkEvent,e),this.previousSource=e,_i.Current=this.context;const i=await iA(this.context,e,this.getHashFromString(e));n||Km(this.context);const r=i==null?void 0:i.scene;r&&(this.previouslyAdded=r,this.context.scene.add(r))}getHashFromString(e){let t=0;for(let n=0;n<e.length;n++)t=e.charCodeAt(n)+((t<<5)-t);return t}}const Mne="needle-engine",Tne="vr",Ine="desktop",Rne=[mu,Tne,Ine];class Pne extends HTMLElement{constructor(){super();E(this,"gameObject",Te);E(this,"GameObject",Te);E(this,"_context",null);E(this,"_overlay_ar");E(this,"_loadingProgress01",0);E(this,"_watcher");E(this,"_loadingView");this._overlay_ar=new Ane}get loadingProgress01(){return this._loadingProgress01}get loadingFinished(){return this.loadingProgress01>.999}getContext(){return new Promise((t,n)=>{if(this._context&&this.loadingFinished)t(this._context);else{const i=()=>{this.removeEventListener("loadfinished",i),this._context&&this.loadingFinished&&t(this._context)};this.addEventListener("loadfinished",i)}})}get Context(){return this._context}async connectedCallback(){var l,h,u,f,g;this.onSetupDesktop();var t=new MutationObserver(this.onElementsChanged.bind(this));t.observe(this,{childList:!0});const n=()=>{const m=this.getAttribute("src");return(m==null?void 0:m.endsWith(".glb"))||(m==null?void 0:m.endsWith(".gltf"))?m:null};let i="loadScene";const r=n();r&&(i=r);const o=this.getAttribute("alias");if(this._context=new _i({name:i,domElement:this,alias:o}),this._watcher=new Sne((h=(l=this.getAttribute("id"))!=null?l:o)!=null?h:"",this._context),i&&i.length>0){if(!r)for(;Object.keys(z_).length<=0;){if(!this.isConnected)return;await xq(10)}let m=(u=z_[i])!=null?u:window[i],A=null;if((!m||r)&&(r&&(i=r),m=async v=>{const w=n();w&&this._watcher&&(A=w,await this._watcher.onSourceChanged(w,!0,!0))}),m){this.classList.add("loading"),console.log("Needle Engine: Begin loading",o!=null?o:"");const v=this.dispatchEvent(new CustomEvent("loadstart",{detail:{context:this._context,alias:o},cancelable:!0}));!this._loadingView&&v&&(this._loadingView=new Cne(this)),v&&((f=this._loadingView)==null||f.onLoadingBegin("begin load"));const w=(S,R)=>{var M;this._loadingProgress01=AF(S),v&&((M=this._loadingView)==null||M.onLoadingUpdate(S,R)),this.dispatchEvent(new CustomEvent("progress",{detail:{context:this._context,name:S.name,progress:S.progress,index:S.index,count:S.count,totalProgress01:this._loadingProgress01}}))};this.onBeforeBeginLoading(),await this._context.onCreate(m,{progress:w});const b=n();b&&b!==A&&await this._watcher.onSourceChanged(b,!0,!0),this._loadingProgress01=1,v&&((g=this._loadingView)==null||g.onLoadingFinished("create scene")),this.classList.remove("loading"),this.classList.add("loading-finished"),console.log("Needle Engine: finished loading",o!=null?o:""),this.dispatchEvent(new CustomEvent("loadfinished",{detail:{context:this._context,src:o!=null?o:i}})),this.onSetupDesktop()}else console.error('Could not find scene function named "'+i+'", it must be either in global scope or added to build_scene_functions',z_)}else console.error("Missing src attribute - please provide a function name",this)}disconnectedCallback(){this._context&&this._context.onDestroy()}static get observedAttributes(){return["src","loadstart","progress","loadfinished","dracoDecoderPath","dracoDecoderType","ktx2DecoderPath"]}attributeChangedCallback(t,n,i){var r;switch(t){case"src":(r=this._watcher)==null||r.onSourceChanged(i);break;case"loadstart":case"progress":case"loadfinished":typeof i=="string"&&i.length>0&&(Zh&&console.log(t+" attribute changed",i),this.registerEventFromAttribute(t,i));break;case"dracoDecoderPath":Zh&&console.log("dracoDecoderPath",i),pP(i);break;case"dracoDecoderType":i==="wasm"||i==="js"?(Zh&&console.log("dracoDecoderType",i),mP(i)):console.error("Invalid dracoDecoderType",i,"expected js or wasm");break;case"ktx2DecoderPath":Zh&&console.log("ktx2DecoderPath",i),gP(i);break}}registerEventFromAttribute(t,n){if(typeof n=="string"&&n.length>0){const i=(0,eval)(n);typeof i=="function"&&this.addEventListener(t,r=>i==null?void 0:i.call(globalThis,this._context,r))}}getAROverlayContainer(){return this._overlay_ar.findOrCreateARContainer(this)}getVROverlayContainer(){for(let t=0;t<this.children.length;t++){const n=this.children[t];if(n.classList.contains("vr"))return n}return null}onEnterAR(t,n){var i;this.onSetupAR(),this._overlay_ar.onBegin(this._context,n,t),this.dispatchEvent(new CustomEvent("enter-ar",{detail:{session:t,context:this._context,htmlContainer:(i=this._overlay_ar)==null?void 0:i.ARContainer}}))}onExitAR(t){var n;this._overlay_ar.onEnd(this._context),this.onSetupDesktop(),this.dispatchEvent(new CustomEvent("exit-ar",{detail:{session:t,context:this._context,htmlContainer:(n=this._overlay_ar)==null?void 0:n.ARContainer}}))}onEnterVR(t){this.onSetupVR(),this.dispatchEvent(new CustomEvent("enter-vr",{detail:{session:t,context:this._context}}))}onExitVR(t){this.onSetupDesktop(),this.dispatchEvent(new CustomEvent("exit-vr",{detail:{session:t,context:this._context}}))}onElementsChanged(){}onSetupAR(){this.classList.add("ar-session-active"),this.classList.remove("desktop-session-active"),this.foreachHtmlElement(t=>this.setupElementsForMode(t,mu))}onSetupVR(){this.classList.remove("ar-session-active"),this.classList.remove("desktop-session-active"),this.foreachHtmlElement(t=>this.setupElementsForMode(t,"vr"))}onSetupDesktop(){this.classList.remove("ar-session-active"),this.classList.add("desktop-session-active"),this.foreachHtmlElement(t=>this.setupElementsForMode(t,"desktop"))}setupElementsForMode(t,n,i=null){var o;if(t===((o=this._context)==null?void 0:o.renderer.domElement)||t.id==="VRButton"||t.id==="ARButton")return;if(t.style.position="absolute",t.classList.contains(n))t.style.visibility="visible",t.style.display==="none"&&(t.style.display="block");else for(const l of Rne)t.classList.contains(l)&&(t.style.visibility="hidden",t.style.display="none")}foreachHtmlElement(t){for(let n=0;n<this.children.length;n++){const i=this.children[n];i.style&&t(i)}}onBeforeBeginLoading(){const t=this.getAttribute("dracoDecoderPath");t&&(Zh&&console.log("using custom draco decoder path",t),pP(t));const n=this.getAttribute("dracoDecoderType");n&&(Zh&&console.log("using custom draco decoder type",n),mP(n));const i=this.getAttribute("ktx2DecoderPath");i&&(Zh&&console.log("using custom ktx2 decoder path",i),gP(i))}}window.customElements.define(Mne,Pne);const Bne=Object.freeze(Object.defineProperty({__proto__:null,AlignmentConstraint:rv,Animation:Hl,AnimationCurve:gS,Animator:rh,AnimatorController:bf,AudioListener:ig,AudioSource:Wr,AvatarModel:AS,AvatarLoader:_S,AxesHelper:Ng,BasicIKConstraint:ZD,BoxHelperComponent:Ic,Camera:Us,Collider:Uf,SphereCollider:ov,BoxCollider:av,InstantiateOptions:Fo,UnityObject:$D,DeleteBox:xS,Deletable:eO,DeviceFlag:wS,DragControls:Pc,DropListener:cv,Duplicatable:Gf,CallInfo:rg,EventListEvent:MS,EventList:ua,EventTrigger:aO,FlyControls:cO,BoxGizmo:Gg,GltfExportBox:uO,GltfExport:Ol,GridHelper:Hg,GroundProjectedEnv:Vg,Interactable:Ug,UsageMarker:zg,Light:Go,LODModel:Hf,LODGroup:hv,LookAtConstraint:nv,NavMesh:dO,NavMeshAgent:fO,NestedGltf:BS,Networking:Ru,OffsetConstraint:Vf,OrbitControls:Ff,ParticleSystemRenderer:LS,ParticleSystem:_O,MainModule:pO,EmissionModule:mO,ShapeModule:gO,PlayerColor:eh,FieldWithDefault:ID,Renderer:Vr,MeshRenderer:lS,SkinnedMeshRenderer:PD,InstancingUtil:ro,RendererLightmap:ty,Rigidbody:Tr,ScreenCapture:yO,ShadowCatcher:dv,RemoteSkybox:fv,SmoothFollow:pv,SpatialTriggerReceiver:Oc,SpatialTrigger:mv,SpectatorCamera:o3,SpringJoint:a3,Sprite:qS,SpriteRenderer:Jg,SyncedCamera:Av,SyncedRoom:Nu,SyncedTransform:$l,TestRunner:l3,TestSimulateUserData:h3,TransformGizmo:XS,VideoPlayer:Xa,Voip:lh,VolumeParameter:f3,VolumeComponent:Kf,ToneMapping:_v,ColorAdjustments:yv,VolumeProfile:vv,Volume:YS,WebARSessionRoot:zf,WebXR:Ti,WebAR:uf,AvatarMarker:fr,WebXRAvatar:Rc,TeleportTarget:ES,WebXRController:gs,AttachedObject:oa,XRGrabModel:JS,XRGrabRendering:p3,XRRig:CS,VRUserState:Da,WebXRSync:cy,XRState:Ha,XRFlag:ur,AvatarBlink_Simple:$f,AvatarEyeLook_Rotation:Kg,Avatar_POI:zr,Avatar_Brain_LookAt:ay,Avatar_MouthShapes:wv,Avatar_MustacheShake:A3,LogStats:_3,RGBAColor:oo,PlayableDirector:pf,SignalAsset:KS,SignalReceiverEvent:$S,SignalReceiver:bv,AnimationTrackHandler:eM,AudioTrackHandler:tM,SignalTrackHandler:Ay,ControlTrackHandler:ff,BaseUIComponent:Qc,UIRootComponent:Ov,Button:dh,Canvas:da,CanvasGroup:eA,EventSystem:aa,Graphic:Uu,MaskableGraphic:kv,Image:Nv,RawImage:xM,InputField:np,Keyboard:K3,LayoutGroup:tA,VerticalLayoutGroup:$3,HorizontalLayoutGroup:eF,GridLayoutGroup:tF,PointerEventData:of,Raycaster:bM,ObjectRaycaster:hg,GraphicRaycaster:nF,Size:q3,Rect:yM,RectTransform:uh,SpatialHtml:iF,Text:Qr},Symbol.toStringTag,{value:"Module"})),CM={Context:_i};globalThis.Needle=CM;function _F(a){for(const e in a)CM[e]=a[e]}_F(a9);_F(Bne);for(const a of Object.getOwnPropertyNames(Te))switch(a){case"prototype":case"constructor":case"length":case"name":continue;default:CM[a]=Te[a];break}globalThis.THREE?console.warn("Threejs is already imported"):globalThis.THREE=gq;
